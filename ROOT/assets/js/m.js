/*!            
    C+edition for Desktop, Community Edition.
    Copyright (C) 2021 Cplusedition Limited.  All rights reserved.
    
    The author licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at
    
        http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
"use strict";var _stack,_cursor,_date_1,_path_1,_basepath,_url_1,_basedir,_decodedPath_1,_tree_1,_element,_indent,_populated_1,_data_1,_root,_tab_1,_listeners_1,_selection_1,_data_2,_nodes_1,_touchTimer,_container_1,_showDelay,_hideDelay,_state_1,_infoToaster,_warnToaster,_errorToaster,_modalToaster,_dateFormat_1,_info_1,_container_2,_zindex_1,_opacity_1,_bgColor_1,_element_1,_handlers,_subscriptions_1,_isShown_1,_count_1,_showTimer,_element_2,_selector,_style_1,_duration_1,_subscription_1,_onCallback,_offCallback,_timer_1,_container_3,_duration_2,_color_1,_spotlight_1,_timer_2,_destroyed,_shown_1,_destroyed_1,_destroyed0,_destroyed_2,_destroyed_3,_position,_lastMatch,_destroyed_4,_destroyed_5,_destroyed_6,_destroyed_7,_destroyed_8,_destroyed_9,_destroyed_10,_destroyed_11,_destroyed_12,_toolbar_1,_searchbar_1,_searchbox_1,_finder,_shown_2,ColorValue$,Unicode$,__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},exports={};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GradientPicker=exports.BotResult=exports.IBotOKResult=exports.IBotResult=void 0;class IBotResult{}exports.IBotResult=IBotResult;class IBotOKResult extends IBotResult{}exports.IBotOKResult=IBotOKResult;class BotResult{constructor(t,e){this._result=t,this._failure=e}static ok_(t){return new BotResult(t,null)}static fail_(t){if(null==t)throw new Error("Failure value must not be null or undefined");return new BotResult(null,t)}static failKey_(t){return this.fail_(MSG.string_(t))}static failKey1_(t,e){return this.fail_(MSG.string1_(t,e))}static failKey2_(t,e,i){return this.fail_(MSG.string2_(t,e,i))}static failArrayKey_(t,...e){return this.fail_([MSG.string_(t),...e])}isOK_(){return null===this._failure}isFail_(){return null!==this._failure}mapOK_(t){return null!==this._failure?BotResult.fail_(this.failure_()):BotResult.ok_(t)}mapFail_(t){return(this._failure=null)?BotResult.ok_(this.result_()):BotResult.fail_(t)}fail_(){return BotResult.fail_(this.failure_())}ok_(){return BotResult.ok_(this.result_())}failure_(){return this._failure}ifOK_(t){return null===this._failure?t(this.result_()):this.fail_()}onFail_(t=null){return null!=t&&null!==this._failure&&t(this.failure_(),this),this}onOK_(t){return null===this._failure?t(this.result_()):null}result_(){return this._result}}exports.BotResult=BotResult;class Ut{static nan_(...t){return t.some(t=>Number.isNaN(t))}static parseInt_(t,e=NaN,i=10){if(null==t)return e;const n=parseInt(t,i);return Number.isNaN(n)?e:n}static parseInt2_(t,e,i=10){if(null==t)return;const n=parseInt(t,i);Number.isNaN(n)||e(n)}static parseDouble_(t,e=NaN){if(null==t)return e;try{const i=parseFloat(t);return Number.isNaN(i)?e:i}catch(t){return e}}static parseDoublePx_(t,e=NaN){return null==t||void 0===t||t.lastIndexOf("px")!=t.length-2?e:Ut.parseDouble_(t.substring(0,t.length-2),e)}static padStart_(t,e,i=" "){if(0==i.length)return t;for(;t.length<e;)t=i+t;return t}static timeString_(t,e=6){return t>=1e5?Ut.padStart_(`${(t/1e3).toFixed(0)}s`,e):t>=1e3?Ut.padStart_(`${(t/1e3).toFixed(2)}s`,e):Ut.padStart_(`${t.toFixed(0)}ms`,e)}static spliceString_(t,e,i){if(0==i)return t;if(0==e&&i==t.length)return"";const n=0==e?"":t.slice(0,e),s=e+i>=t.length?"":t.slice(e+i);return 0==n.length?s:0==s.length?n:n+s}static isEmpty_(t){return null==t||0==t.length}static isNotEmpty_(t){return!this.isEmpty_(t)}static repeatString_(t,e){let i="";for(;--e>=0;)i+=t;return i}static charcodes_(t){const e=t.length;let i=Array();for(let n=0;n<e;++n){const e=t.charCodeAt(n);i.push(isNaN(e)?void 0:e)}return i}static charcodesOrFail_(t){let e=Array();return this.charcodesOf_(t,(i,n)=>{if(void 0===i)throw new Error(`${t}@${n}`);e.push(i)}),e}static charcodesOf_(t,e){let i=t.length;for(let n=0;n<i;++n){const i=t.charCodeAt(n);e(isNaN(i)?void 0:i,n,t)}}static isHighSurrogate_(t){return 55296<=t&&t<=56319}static isLowSurrogate_(t){return 56320<=t&&t<=57343}static isSurrogatePair_(t,e){return e+1<t.length&&this.isHighSurrogate_(t.charCodeAt(e))&&this.isLowSurrogate_(t.charCodeAt(e+1))}static codepoints_(t){let e=Array();for(let i=0,n=t.length;i<n;++i)e.push(t.codePointAt(i)),this.isSurrogatePair_(t,i)&&++i;return e}static codepointsOrFail_(t){let e=Array();return this.codepointsOf_(t,(i,n)=>{if(void 0===i)throw new Error(`${t}@${n}`);e.push(i)}),e}static codepointsOf_(t,e){let i=t.length;for(let n=0;n<i;++n)e(t.codePointAt(n),n,t),this.isSurrogatePair_(t,n)&&++n}static mapToObject_(t){let e={};for(let[i,n]of t)e[i]=n;return e}static objectToMap_(t){var e;let i=new Map;for(let n of Object.keys(t))i.set(n,null===(e=Object.getOwnPropertyDescriptor(t,n))||void 0===e?void 0:e.value);return i}static isObject_(t){return!("object"!=typeof t||null===t||Array.isArray(t)||t instanceof RegExp||t instanceof Date)}static asyncIterate_(t,e,i=null){this._asyncIterate(t,0,e,i)}static _asyncIterate(t,e,i,n=null){i(t[e],e,s=>{++e,!0===s||e>=t.length?null==n||n(e):this._asyncIterate(t,e,i,n)})}}class TextUt{static splitAt_(t,e,i=e){return e<0?[t,""]:[t.substring(0,e),t.substring(i)]}}function map_(...t){return new Map(t)}function mapFromStringMap_(t){return new Map(Object.entries(t))}function mapOf_(t,e){return(new Map).set(t,e)}function smap_(...t){return StringMap.from_(...t)}function ssmap_(...t){return StringMap.from_(...t)}function smapOf_(t,e){return StringMap.of_(t,e)}function sarray_(){return new Array}function json_(...t){return StringMap.from_(...t)}function jsonOf_(t,e){return StringMap.of_(t,e)}function replaceAll_(t,e,i){return t.split(e).join(i)}TextUt.lineSep$="\n";class StringMap{static of_(t,e){let i=new StringMap;return i[t]=e,i}static from_(...t){let e=new StringMap;for(let i of t)e[i[0]]=i[1];return e}static copyOf_(t){return this.from_(...Object.entries(t))}static filter_(t,e){return this.from_(...Object.entries(t).filter(e))}static d_(t){return"{ "+Object.entries(t).map(([t,e])=>`${t}: ${e}`).join(", ")+" }"}}class With{static exceptionOrNull_(t){try{return t(),null}catch(t){return t}}static exceptionOrFail_(t){try{t()}catch(t){return}throw new Error}static range_(t,e,i){for(let n=t;n<e;++n)i(n)}static lines_(t,e){let i=[];return t.split(TextUt.lineSep$).map(t=>{let n=e(t);null!=n&&i.push(n)}),i}static value_(t,e){return e(t),t}static optionalOrFalse_(t,e){return null!=t&&(e(t),!0)}static optional_(t,e){return null==t?null:(e(t),t)}static optional0_(t,e){return null==t?null:(setTimeout(()=>e(t),0),t)}static null_(t,e){return null==t?e():t}static notnull_(t,e){return null==t?null:e(t)}static notnullOrFail_(t,e){if(null==t)throw new Error;return e(t)}}class ArrayUt{static first_(t){if(null!=t){if(t instanceof Array){return 0==t.length?void 0:t[0]}{let e=t.next();if(!0===e.done)return;return e.value}}}static last_(t){if(null!=t){if(t instanceof Array){let e=t.length;return 0==e?void 0:t[e-1]}{let e=void 0;for(;;){let i=t.next();if(!0===i.done)return e;e=i.value}}}}static delete_(t,e){let i=t.indexOf(e);return i>=0&&(t.splice(i,1),!0)}static insert_(t,e,i){return t.splice(e,0,i),t}static addAll_(t,...e){for(const i of e)t.push(i);return t}static any_(t,e){for(const i of t)if(e(i))return!0;return!1}static unique_(t){return Array.from(new Set(t).values())}static findIndex_(t,e){let i=0;for(const n of t){if(e(n))return i;++i}return-1}static fill_(t,e){for(let i=0,n=t.length;i<n;++i)t[i]=e;return t}static strictEqual_(t,e){const i=t.length;return e.length===i&&t.every((t,i)=>e[i]===t)}static equal_(t,e){const i=t.length;return e.length===i&&t.every((t,i)=>e[i]==t)}}class Stack{constructor(){this.x_array=[]}length_(){return this.x_array.length}clear_(){return this.x_array.length=0,this}push_(...t){return this.x_array.push(...t),this}pop_(){return this.x_array.pop()}peek_(){const t=this.x_array.length;return t>0?this.x_array[t-1]:void 0}}class DomUt{static stopEvent_(t){try{t.stopPropagation(),t.preventDefault()}catch(t){}}static queryAll_(t,e){return t?Array.from(t.querySelectorAll(e)):[]}static query_(t,e){return t.querySelector(e)}static asHTMLDocument_(t){return null!=t&&(t instanceof HTMLDocument||"[object HTMLDocument]"==Object.prototype.toString.call(t))?t:null}static asHTMLElement_(t){return null!=t&&(t instanceof HTMLElement||this._ELMPAT.test(Object.prototype.toString.call(t)))?t:null}static matchingTarget_(t,e){if(null==e)return null;let i=this.asHTMLElement_(t.target),n=this.asHTMLElement_(t.currentTarget);if(null!=i&&null!=n){const t=n.parentElement;do{if(null!=i&&i.matches(e))return i;i=i.parentElement}while(null!=i&&i!=t)}return null}}DomUt._ELMPAT=new RegExp("^\\[object HTML\\w*Element\\]$");class NullableItemsIterable{constructor(t){this.items$=t,this.index$=0,this.length$=t.length}[Symbol.iterator](){return this}next(){return this.index$<this.length$?{value:this.items$.item(this.index$++),done:!1}:{value:void 0,done:!0}}}class ItemsIterable{constructor(t){this.items$=t,this.index$=0,this.length$=t.length}[Symbol.iterator](){return this}next(){for(;this.index$<this.length$;){let t=this.items$.item(this.index$);if(++this.index$,null!=t)return{value:t,done:!1}}return{value:void 0,done:!0}}}class JSONUt{static stringArray(t,e){const i=t[e];return i instanceof Array?i.filter(t=>{}):null}static string(t,e,i){const n=t[e];return null!=n&&"string"==typeof n?n:i}}class DomBuilder{constructor(t,e=null){_stack.set(this,new Stack),_cursor.set(this,void 0),__classPrivateFieldSet(this,_cursor,DomBuilder.attrs1_(t,e))}static attr1_(t,e,i){return null==i?t.removeAttribute(e):t.setAttribute(e,i),t}static attrs1_(t,e=null){if(null!=e)for(const[i,n]of Object.entries(e))this.attr1_(t,i,n);return t}static createText_(t){return new Text(t)}static offline1_(t,e,...i){return new DomBuilder(t.createElement(e)).addClasses_(i)}static offline_(t,e,i=null){return new DomBuilder(t.createElement(e),i)}indent_(...t){return this}attr_(t,e){return DomBuilder.attr1_(__classPrivateFieldGet(this,_cursor),t,e),this}attrs_(t){return DomBuilder.attrs1_(__classPrivateFieldGet(this,_cursor),t),this}attrx_(t){for(const e of t)e instanceof Array?this.attr_(e[0],e[1]):this.attrs_(e);return this}addClass_(t){return t.length>0&&__classPrivateFieldGet(this,_cursor).classList.add(t),this}addClasses_(t){for(const e of t)e.length>0&&__classPrivateFieldGet(this,_cursor).classList.add(e);return this}addStyle_(t,e){return __classPrivateFieldGet(this,_cursor).style.setProperty(t,e),this}addStyles_(...t){const e=__classPrivateFieldGet(this,_cursor).style;for(const i of t)if(i instanceof Array&&2==i.length)e.setProperty(i[0],i[1]);else for(const[t,n]of Object.entries(i))e.setProperty(t,n);return this}append_(t,e=null){return __classPrivateFieldGet(this,_cursor).appendChild("string"==typeof t?this.createElement_(t,e):DomBuilder.attrs1_(t,e)),this}appendNodes_(...t){for(const e of t)__classPrivateFieldGet(this,_cursor).appendChild(e);return this}append1_(t,...e){return this.append_(t,smapOf_("class",e.join(" ")))}append2_(t,e,i){return this.append_(t,smapOf_(e,i))}insertBefore_(t,e,i=null){if(e instanceof Array)for(const i of e)__classPrivateFieldGet(this,_cursor).insertBefore(i,t);else __classPrivateFieldGet(this,_cursor).insertBefore("string"==typeof e?this.createElement_(e,i):e.nodeType==Node.ELEMENT_NODE?DomBuilder.attrs1_(e,i):e,t);return this}prepend_(t,e=null){return this.insertBefore_(__classPrivateFieldGet(this,_cursor).firstChild,t,e)}prependNodes_(...t){const e=__classPrivateFieldGet(this,_cursor).firstChild;for(const i of t)this.insertBefore_(e,i);return this}prepend1_(t,...e){return this.prepend_(t,smapOf_("class",e.join(" ")))}prepend2_(t,e,i){return this.prepend_(t,smapOf_(e,i))}child_(t,e=null){return __classPrivateFieldSet(this,_cursor,__classPrivateFieldGet(this,_cursor).appendChild("string"==typeof t?this.createElement_(t,e):DomBuilder.attrs1_(t,e))),this}child1_(t,...e){return this.child_(t).addClasses_(e)}child2_(t,e,i){return this.child_(t).attr_(e,i)}childBefore_(t,e,i=null){return __classPrivateFieldSet(this,_cursor,__classPrivateFieldGet(this,_cursor).insertBefore("string"==typeof e?this.createElement_(e,i):DomBuilder.attrs1_(e,i),t)),this}childBefore1_(t,e,...i){return this.childBefore_(t,e).addClasses_(i)}childBefore2_(t,e,i,n){return this.childBefore_(t,e).attr_(i,n)}childBeforeFirst_(t,e=null){return this.childBefore_(__classPrivateFieldGet(this,_cursor).firstChild,t,e)}childBeforeFirst1_(t,...e){return this.childBefore_(__classPrivateFieldGet(this,_cursor).firstChild,t).addClasses_(e)}childBeforeFirst2_(t,e,i){return this.childBefore_(__classPrivateFieldGet(this,_cursor).firstChild,t).attr_(e,i)}siblingBefore_(t,e=null){return __classPrivateFieldSet(this,_cursor,__classPrivateFieldGet(this,_cursor).parentNode.insertBefore("string"==typeof t?this.createElement_(t,e):DomBuilder.attrs1_(t,e),__classPrivateFieldGet(this,_cursor))),this}siblingAfter_(t,e=null){return __classPrivateFieldSet(this,_cursor,__classPrivateFieldGet(this,_cursor).parentNode.insertBefore("string"==typeof t?this.createElement_(t,e):DomBuilder.attrs1_(t,e),__classPrivateFieldGet(this,_cursor).nextSibling)),this}text_(t){return __classPrivateFieldGet(this,_cursor).appendChild(DomBuilder.createText_(t)),this}textBefore_(t,e){return __classPrivateFieldGet(this,_cursor).insertBefore(DomBuilder.createText_(e),t),this}textSiblingAfter_(t){const e=DomBuilder.createText_(t);return __classPrivateFieldGet(this,_cursor).parentNode.insertBefore(e,__classPrivateFieldGet(this,_cursor).nextSibling),e}removeChild_(t){var e;return null===(e=t.parentNode)||void 0===e||e.removeChild(t),this}removeChildren_(t){var e;for(const i of t)null===(e=i.parentNode)||void 0===e||e.removeChild(i);return this}replaceChild_(t,e){var i;return __classPrivateFieldGet(this,_cursor).insertBefore(e,t),null===(i=t.parentNode)||void 0===i||i.removeChild(t),this}moveChildren_(t,e){var i;let n=t;for(;null!=n&&n!=e;){const t=n.nextSibling;null===(i=n.parentNode)||void 0===i||i.removeChild(n),__classPrivateFieldGet(this,_cursor).append(n),n=t}return this}moveChildrenBefore_(t,e,i){var n;let s=e;for(;null!=s&&s!=i;){const e=s.nextSibling;null===(n=s.parentNode)||void 0===n||n.removeChild(s),__classPrivateFieldGet(this,_cursor).insertBefore(s,t),s=e}return this}wrap_(t,e){const i=this.cursor_();return this.up_().childBefore_(i,t,e).push_().up_().removeChild_(i).pop_().appendNodes_(i),this}unwrap_(t){var e;return this.moveChildrenBefore_(t,t.firstChild,null),null===(e=t.parentNode)||void 0===e||e.removeChild(t),this}empty_(){for(let t=__classPrivateFieldGet(this,_cursor).firstChild;null!=t;){const e=t.nextSibling;t.remove(),t=e}return this}push_(){return __classPrivateFieldGet(this,_stack).push_(__classPrivateFieldGet(this,_cursor)),this}pop_(t=1){for(;--t>=0;){const t=__classPrivateFieldGet(this,_stack).pop_();if(void 0===t)throw new Error;__classPrivateFieldSet(this,_cursor,t)}return this}peek_(){return __classPrivateFieldSet(this,_cursor,__classPrivateFieldGet(this,_stack).peek_()),this}swap_(){const t=__classPrivateFieldGet(this,_stack).pop_();return __classPrivateFieldGet(this,_stack).push_(__classPrivateFieldGet(this,_cursor)),__classPrivateFieldSet(this,_cursor,t),this}up_(){const t=__classPrivateFieldGet(this,_cursor).parentElement;if(null==t)throw new Error;return __classPrivateFieldSet(this,_cursor,t),this}right_(){const t=__classPrivateFieldGet(this,_cursor).nextElementSibling;if(null==t)throw new Error;return __classPrivateFieldSet(this,_cursor,t),this}left_(){const t=__classPrivateFieldGet(this,_cursor).previousElementSibling;if(null==t)throw new Error;return __classPrivateFieldSet(this,_cursor,t),this}first_(){const t=__classPrivateFieldGet(this,_cursor).firstElementChild;if(null==t)throw new Error;return __classPrivateFieldSet(this,_cursor,t),this}setCursor_(t){return __classPrivateFieldSet(this,_cursor,t),this}cursor_(){return __classPrivateFieldGet(this,_cursor)}classList_(){return __classPrivateFieldGet(this,_cursor).classList}doc_(){return __classPrivateFieldGet(this,_cursor).ownerDocument}select_(t=null,e=null){var i;const n=null===(i=this.doc_().defaultView)||void 0===i?void 0:i.getSelection();return null!=n&&(n.removeAllRanges(),n.addRange(this.rangeOf_(t,e))),this}selectTextRange_(t,e,i){var n;const s=null===(n=this.doc_().defaultView)||void 0===n?void 0:n.getSelection();if(null!=s){const n=this.createRange_();n.setStart(t,e),n.setEnd(t,i),s.removeAllRanges(),s.addRange(n)}return this}scrollTo_(t,e){var i;return null===(i=this.doc_().defaultView)||void 0===i||i.scrollTo(t,e),this}exec_(t){return t(__classPrivateFieldGet(this,_cursor)),this}children_(t){for(let e=__classPrivateFieldGet(this,_cursor).firstChild;null!=e&&t(e,__classPrivateFieldGet(this,_cursor));e=e.nextSibling);return this}each_(t,e,i){for(let n=t;null!=n&&n!=e;){const t=n.nextSibling;if(!i(n,__classPrivateFieldGet(this,_cursor)))break;n=t}return this}createElement_(t,e=null){return DomBuilder.attrs1_(__classPrivateFieldGet(this,_cursor).ownerDocument.createElement(t),e)}indexOf_(t){let e=0;for(let i=__classPrivateFieldGet(this,_cursor).firstChild;null!=i;i=i.nextSibling,++e)if(i===t)return e;return-1}rangeOf_(t,e=null){var i;const n=this.createRange_();return null==t?n.selectNode(__classPrivateFieldGet(this,_cursor)):(n.setStartBefore(t),n.setEndAfter(null!==(i=null!=e?e:__classPrivateFieldGet(this,_cursor).lastChild)&&void 0!==i?i:t)),n}createRange_(){return __classPrivateFieldGet(this,_cursor).ownerDocument.createRange()}cursorPop_(t=1){const e=this.cursor_();return this.pop_(t),e}iframe_(...t){return this.child_("iframe").attrx_(t)}iframe1_(...t){return this.child1_("iframe",...t)}div_(...t){return this.child_("div").attrx_(t)}div1_(...t){return this.child1_("div",...t)}div2_(t,e){return this.child2_("div",t,e)}span_(...t){return this.child_("span").attrx_(t)}span1_(...t){return this.child1_("span",...t)}span2_(t,e){return this.child2_("span",t,e)}br_(...t){return this.child_("br").attrx_(t)}br1_(...t){return this.child1_("br",...t)}br2_(t,e){return this.child2_("br",t,e)}hr_(...t){return this.child_("hr").attrx_(t)}hr1_(...t){return this.child1_("hr",...t)}hr2_(t,e){return this.child2_("hr",t,e)}ul_(...t){return this.child_("ul").attrx_(t)}ul1_(...t){return this.child1_("ul",...t)}ul2_(t,e){return this.child2_("ul",t,e)}li_(...t){return this.child_("li").attrx_(t)}li1_(...t){return this.child1_("li",...t)}li2_(t,e){return this.child2_("li",t,e)}input_(...t){return this.child_("input").attrx_(t)}input1_(...t){return this.child1_("input",...t)}input2_(t,e){return this.child2_("input",t,e)}option_(...t){return this.child_("option").attrx_(t)}option1_(...t){return this.child1_("option",...t)}option2_(t,e){return this.child2_("option",t,e)}textarea_(...t){return this.child_("textarea").attrx_(t)}textarea1_(...t){return this.child1_("textarea",...t)}textarea2_(t,e){return this.child2_("textarea",t,e)}table_(...t){return this.child_("table").attrx_(t)}table1_(...t){return this.child1_("table",...t)}table2_(t,e){return this.child2_("table",t,e)}tbody_(...t){return this.child_("tbody").attrx_(t)}tbody1_(...t){return this.child1_("tbody",...t)}tbody2_(t,e){return this.child2_("tbody",t,e)}tr_(...t){return this.child_("tr").attrx_(t)}tr1_(...t){return this.child1_("tr",...t)}tr2_(t,e){return this.child2_("tr",t,e)}td_(...t){return this.child_("td").attrx_(t)}td1_(...t){return this.child1_("td",...t)}td2_(t,e){return this.child2_("td",t,e)}th_(...t){return this.child_("th").attrx_(t)}th1_(...t){return this.child1_("th",...t)}th2_(t,e){return this.child2_("th",t,e)}button_(...t){return this.child_("button").attrx_(t)}button1_(...t){return this.child1_("button",...t)}button2_(t,e){return this.child2_("button",t,e)}b_(...t){return this.child_("b").attrx_(t)}b1_(...t){return this.child1_("b",...t)}b2_(t,e){return this.child2_("b",t,e)}code_(...t){return this.child_("code").attrx_(t)}code1_(...t){return this.child1_("code",...t)}code2_(t,e){return this.child2_("code",t,e)}a_(...t){return this.child_("a").attrx_(t)}a1_(...t){return this.child1_("a",...t)}a2_(t,e){return this.child2_("a",t,e)}ahref_(t=null,...e){return null!=t&&("string"==typeof t?t.length>0&&e.unshift(["href",t]):e.unshift(t)),this.child_("a").attrx_(e)}ahref1_(t,...e){return this.ahref_(t).addClasses_(e)}img_(t=null,...e){return null!=t&&("string"==typeof t?t.length>0&&e.unshift(["src",t]):e.unshift(t)),this.child_("img").attrx_(e)}img1_(t,...e){return this.img_(t).addClasses_(e)}img2_(t,e){return this.child2_("img",t,e)}}_stack=new WeakMap,_cursor=new WeakMap;class ColorValue{constructor(t=0,e=0,i=0,n=1){this._r=t,this._g=e,this._b=i,this._a=n}static from_(t,e=1){if(null==t||0==t.length)return null;if(t.startsWith("#"))return t=t.substring(1),this.parseHex_(t,e);if(!t.includes(","))return this.parseHex_(t,e);let i=ColorValue.X_RGBA.exec(t);return null!=i&&(t=i[1]),this.parseDec_(t,e)}static fromRGB_(t,e,i){return new ColorValue(t,e,i)}static fromRGBA_(t,e,i,n){return new ColorValue(t,e,i,n)}static copy(t){return new ColorValue(t._r,t._g,t._b,t._a)}static parseSafe_(t,e=1){if(null==t||0==t.length)return null;try{let i=ColorValue.from_(t,e);if(null!=i)return i}catch(t){}return null}get r$(){return this._r}get g$(){return this._g}get b$(){return this._b}get a$(){return this._a}static parseDec_(t,e){let i=t.split(ColorValue.X_COMMA),n=i.length;if(3!=n&&4!=n)return null;let s=Ut.parseInt_(i[0],-1),o=Ut.parseInt_(i[1],-1),l=Ut.parseInt_(i[2],-1),a=e;return 4==n&&(a=Ut.parseDouble_(i[3])),s<0||s>255||o<0||o>255||l<0||l>255||a<0||a>1?null:new ColorValue(s,o,l,a)}static parseHex_(t,e){let i,n=t.split(ColorValue.X_COMMA),s=n.length,o=e;if(1==s){if(3!=(i=n[0]).length&&6!=i.length&&8!=i.length)return null;8==i.length&&(i=i.substring(0,6),o=Ut.parseInt_(`0x${i.substring(6,8)}`,-1)/255)}else{if(2!=s)return null;if(3!=(i=n[0]).length&&6!=i.length)return null;o=Ut.parseDouble_(n[1])}if(o<0||o>1)return null;if(3==i.length){let t=i.substring(0,1),e=i.substring(1,2),n=i.substring(2,3);i=`${t}${t}${e}${e}${n}${n}`}let l=i.substring(0,2),a=i.substring(2,4),r=i.substring(4,6),_=parseInt(l,16),c=parseInt(a,16),h=parseInt(r,16);return Ut.nan_(_,c,h)?null:new ColorValue(_,c,h,o)}mult_(t){return ColorValue.fromRGB_(Math.floor(this._r*t),Math.floor(this._g*t),Math.floor(this._b*t))}add_(t){return ColorValue.fromRGB_(Math.floor(this._r+t._r),Math.floor(this._g+t._g),Math.floor(this._b+t._b))}minus_(t){return ColorValue.fromRGB_(Math.floor(this._r-t._r),Math.floor(this._g-t._g),Math.floor(this._b-t._b))}equals_(t){return null!=t&&this._r==t._r&&this._g==t._g&&this._b==t._b&&this.alphaString_()==t.alphaString_()}rgbEquals_(t){return null!=t&&this._r==t._r&&this._g==t._g&&this._b==t._b}get isOpaque$(){return null==this._a||1==this._a}alphaString_(){return null==this._a?"1.00":this._a.toFixed(2)}toRgbArray_(){return[this._r,this._g,this._b]}toRgbaString_(){return`${this._r}, ${this._g}, ${this._b}, ${this.alphaString_()}`}toRgbString_(){return`${this._r}, ${this._g}, ${this._b}`}toHex3String_(){return`${this.hex_(this.r$)}${this.hex_(this.g$)}${this.hex_(this.b$)}`}toRgbOrRgbaString_(){return this.isOpaque$?this.toRgbString_():this.toRgbaString_()}toHexOrRgbaString_(){return this.isOpaque$?`#${this.toHex3String_()}`:this.toRgbaString_()}toCSSString_(){return this.isOpaque$?`rgb(${this.toRgbString_()})`:`rgba(${this.toRgbaString_()})`}toHexOrCSSString_(){return this.isOpaque$?`#${this.toHex3String_()}`:`rgba(${this.toRgbaString_()})`}toString_(){return`rgba(${this.toRgbaString_()})`}hex_(t){return t.toString(16).padStart(2,"0")}}ColorValue.X_RGBA=new RegExp("rgba?\\(\\s*(.*?)\\s*\\)"),ColorValue.X_COMMA=new RegExp("\\s*,\\s*","g"),ColorValue.X_TRANSPARENT=ColorValue.fromRGBA_(255,255,255,0),ColorValue.X_TRANSPARENT_DARK=ColorValue.fromRGBA_(0,0,0,.5),ColorValue.X_WHITE=ColorValue.fromRGBA_(255,255,255,1),ColorValue.X_GREY=ColorValue.fromRGBA_(127,127,127,1),ColorValue.X_RED=ColorValue.fromRGBA_(255,0,0,1),ColorValue.X_BLACK=ColorValue.fromRGBA_(0,0,0,1);class DumbSnapper{snap(t,e,i){i(t,e)}}class PinchZoomListener{constructor(t,e,i){this._useTouch=e,this._callback=i,this._pointers=null,this._dist0=null,this._dist1=null,this._center=null,this._delta=0,t.addEventListener(Conf.touchstart,this.onTouchStart),t.addEventListener(Conf.touchmove,this.onTouchMove),t.addEventListener(Conf.touchend,this.onTouchEnd)}onTouchStart(t){if(this._pointers=this._useTouch?this._touchPointers(t):this._mousePointers(t,null),null==this._pointers)return void this._reset();An.stopevent_(t),this._dist0=An.dist1_(this._pointers,0),this._dist1=this._dist0;const e=this._useTouch?this._midx(this._pointers):this._pointers[0],i=this._useTouch?this._midy(this._pointers):this._pointers[1];this._center=new Point(e,i),this._delta=0,this._callback(this._center,this._delta)}onTouchMove(t){if(null!=this._dist0){An.stopevent_(t);const e=this._useTouch?this._touchPointers(t):this._mousePointers(t,this._pointers);if(null!=e){const t=An.dist1_(e,null);null!=t&&(this._delta=this._callback(null,this._delta+t-this._dist1),this._dist1=t)}}}onTouchEnd(t){if(null!=this._dist0){An.stopevent_(t);const e=this._useTouch?this._touchPointers(t):this._mousePointers(t,this._pointers);if(null!=e){const t=An.dist1_(e,null);null!=t&&(this._callback(null,this._delta+t-this._dist1),this._reset())}}}_touchPointers(t){const e=t.touches;if(null!=e&&2==e.length){const t=[];for(const i of new ItemsIterable(e))t.push(Math.floor(i.screenX)),t.push(Math.floor(i.screenY));return t}return null}_mousePointers(t,e){if(t.ctrlKey){const i=[];return null!=e&&e.length>=2&&(i.push(e[0]),i.push(e[1])),i.push(Math.floor(t.screenX)),i.push(Math.floor(t.screenY)),i}return null}_reset(){this._dist0=null,this._dist1=null,this._pointers=null,this._center=null,this._delta=0}_midx(t){return(t[0]+t[2])/2}_midy(t){return(t[1]+t[3])/2}}PinchZoomListener.MAX_ZOOM=2;class GradientPicker{constructor(t,e,i,n,s,o,l,a){this._width=e,this._height=i,this._onChangeCallback=a,this._radius=4,this._cX=0,this._cY=0,s=1-s,this._snapper=null!=l?l:new DumbSnapper,this._canvas=t.ownerDocument.createElement("canvas"),this._canvas.width=e,this._canvas.height=i,this._ctx=this._canvas.getContext("2d"),this._ctx.fillStyle="rgba(255, 255, 255, 1.0)",this._ctx.fillRect(0,0,e,i),this._mouseListener=o?new ColorValue$.TouchListener(this._canvas,!0):new ColorValue$.MouseListener(this._canvas,!0),this._mouseListener.onPointerDown((t,e,i)=>this.onMouseDown(t,e,i)),this._mouseListener.onPointerMoved((t,e,i)=>this.onMouseMoved(t,e,i)),this._snapper.snap(n,s,(t,n)=>{this._cX=Math.round(e*t),this._cY=Math.round(i*n),this._draw(),this._onChange()})}get canvas$(){return this._canvas}setValue(t,e){this._setCursorPosition(Math.floor(this._width*t),Math.floor(this._height*e))}_draw(){this._drawCursor()}_drawCursor(){this._ctx.strokeStyle="rgba(0, 0, 0, 1.0)",this._ctx.beginPath(),this._ctx.arc(this._cX,this._cY,this._radius,0,2*Math.PI,!1),this._ctx.closePath(),this._ctx.stroke()}onMouseDown(t,e,i){return this._setCursorPosition(t,e),!0}onMouseMoved(t,e,i){this._setCursorPosition(t,e)}_setCursorPosition(t,e){this._snapper.snap(t/this._width,e/this._height,(t,e)=>{const i=Math.round(this._width*t),n=Math.round(this._height*e);this._ctx.fillRect(this._cX-2*this._radius,this._cY-2*this._radius,4*this._radius,4*this._radius),this._cX=i,this._cY=n,this._onChange(),this._draw()})}_onChange(){var t;null===(t=this._onChangeCallback)||void 0===t||t.call(this,this._cX/this._width,1-this._cY/this._height)}}exports.GradientPicker=GradientPicker,function(t){class e{static getColorLuma_(t){return(.3*t.r$+.59*t.g$+.11*t.b$)/255}static getHsvValueComponent_(t){return Math.max(Math.max(t.r$,t.g$),t.b$)}static getHueColor_(t){const e=[ColorValue.fromRGB_(255,0,0),ColorValue.fromRGB_(255,255,0),ColorValue.fromRGB_(0,255,0),ColorValue.fromRGB_(0,255,255),ColorValue.fromRGB_(0,0,255),ColorValue.fromRGB_(255,0,255)];let i=Math.round(180*t/Math.PI);const n=(i%=360)/60,s=Math.floor(n),o=n-s,l=e[s];return e[(s+1)%e.length].minus_(l).mult_(o).add_(l)}}class i{constructor(t,e=!0){this.element=t,this.dragMode=e,this._handlerMoveRef=null,this._handlerUpRef=null,this._onMouseDown=null,this._onMouseMoved=null,this._onMouseUp=null,this.startMouseEvent=null,this.startMouseX=null,this.startMouseY=null,this._cursorX=0,this._cursorY=0,this._capturing=!1,this._handlerDownRef=An.subscriptEvent_(t,"mousedown",t=>this._handlerDown(t)),this._limiter=new FrameLimiter(2),e||(this._handlerUpRef=An.subscriptEvent_(t,"mouseup",t=>this._handlerUp(t)),this._handlerMoveRef=An.subscriptEvent_(t,"mousemove",t=>this._handlerMove(t)))}dispose(){this._handlerDownRef.cancel_(),null!=this._handlerUpRef&&this._handlerUpRef.cancel_(),null!=this._handlerMoveRef&&this._handlerMoveRef.cancel_()}onPointerDown(t){this._onMouseDown=t}onPointerMoved(t){this._onMouseMoved=t}onPointerUp(t){this._onMouseUp=t}_handlerDown(t){const e=t;this._capturing=!1,this.startMouseEvent=e,this.startMouseX=e.offsetX,this.startMouseY=e.offsetY,this._cursorX=this.startMouseX,this._cursorY=this.startMouseY,this._cursorX=Math.max(0,Math.min(this.element.clientWidth,this._cursorX)),this._cursorY=Math.max(0,Math.min(this.element.clientHeight,this._cursorY)),(null==this._onMouseDown||this._onMouseDown(this._cursorX,this._cursorY,e.buttons))&&(DomUt.stopEvent_(e),this.dragMode&&(this._handlerMoveRef=An.subscriptEvent_(document.body,"mousemove",t=>this._handlerMove(t)),this._handlerUpRef=An.subscriptEvent_(document.body,"mouseup",t=>this._handlerUp(t))),this._capturing=!0)}_handlerMove(t){this._capturing&&(DomUt.stopEvent_(t),this._cursorX=this.startMouseX+t.pageX-this.startMouseEvent.pageX,this._cursorY=this.startMouseY+t.pageY-this.startMouseEvent.pageY,this._cursorX=Math.max(0,Math.min(this.element.clientWidth,this._cursorX)),this._cursorY=Math.max(0,Math.min(this.element.clientHeight,this._cursorY)),this._limiter.queue_(()=>{var e;null===(e=this._onMouseMoved)||void 0===e||e.call(this,this._cursorX,this._cursorY,t.buttons)}))}_handlerUp(t){this._capturing&&(DomUt.stopEvent_(t),this._cursorX=this.startMouseX+t.pageX-this.startMouseEvent.pageX,this._cursorY=this.startMouseY+t.pageY-this.startMouseEvent.pageY,this._cursorX=Math.max(0,Math.min(this.element.clientWidth,this._cursorX)),this._cursorY=Math.max(0,Math.min(this.element.clientHeight,this._cursorY)),this.dragMode&&(null!=this._handlerMoveRef&&this._handlerMoveRef.cancel_(),null!=this._handlerUpRef&&this._handlerUpRef.cancel_()),this._limiter.queue_(()=>{var e;null===(e=this._onMouseUp)||void 0===e||e.call(this,this._cursorX,this._cursorY,t.buttons)}))}}t.MouseListener=i;class n{constructor(t,e=!0){this.element=t,this.dragMode=e,this._handlerMoveRef=null,this._handlerUpRef=null,this._handlerCancelRef=null,this._onMouseDown=null,this._onMouseMoved=null,this._onMouseUp=null,this.startMouseEvent=null,this._elementX=null,this._elementY=null,this.touchId=null,this.startMouseX=null,this.startMouseY=null,this._cursorX=0,this._cursorY=0,this._capturing=!1,this._handlerDownRef=An.subscriptEvent_(t,"touchstart",t=>this._handlerDown(t)),this._limiter=new FrameLimiter(4),e||(this._handlerUpRef=An.subscriptEvent_(t,"touchend",t=>this._handlerUp(t)),this._handlerMoveRef=An.subscriptEvent_(t,"touchmove",t=>this._handlerMove(t)))}dispose(){this._handlerDownRef.cancel_(),null!=this._handlerUpRef&&this._handlerUpRef.cancel_(),null!=this._handlerMoveRef&&this._handlerMoveRef.cancel_()}onPointerDown(t){this._onMouseDown=t}onPointerMoved(t){this._onMouseMoved=t}onPointerUp(t){this._onMouseUp=t}_handlerDown(t){this._capturing=!1;const e=t.changedTouches;if(e.length<1)return;const i=e[0];let n=An.documentOffset_(this.element);this._elementX=n.x,this._elementY=n.y,this.startMouseEvent=i,this.touchId=i.identifier,this.startMouseX=i.pageX-this._elementX,this.startMouseY=i.pageY-this._elementY,this._cursorX=this.startMouseX,this._cursorY=this.startMouseY,this._cursorX=Math.max(0,Math.min(this.element.clientWidth,this._cursorX)),this._cursorY=Math.max(0,Math.min(this.element.clientHeight,this._cursorY)),(null==this._onMouseDown||this._onMouseDown(this._cursorX,this._cursorY,t.touches.length))&&(DomUt.stopEvent_(t),this.dragMode&&(this._handlerMoveRef=An.subscriptEvent_(document.body,"touchmove",t=>this._handlerMove(t)),this._handlerUpRef=An.subscriptEvent_(document.body,"touchend",t=>this._handlerUp(t)),this._handlerCancelRef=An.subscriptEvent_(document.body,"touchcancel",t=>this._handlerUp(t))),this._capturing=!0)}_handlerMove(t){if(this._capturing)for(const e of new ItemsIterable(t.changedTouches))if(e.identifier==this.touchId)return DomUt.stopEvent_(t),this._cursorX=this.startMouseX+e.pageX-this.startMouseEvent.pageX,this._cursorY=this.startMouseY+e.pageY-this.startMouseEvent.pageY,this._cursorX=Math.max(0,Math.min(this.element.clientWidth,this._cursorX)),this._cursorY=Math.max(0,Math.min(this.element.clientHeight,this._cursorY)),void(null!=this._onMouseMoved&&this._limiter.queue_(()=>{this._onMouseMoved(this._cursorX,this._cursorY,t.touches.length)}))}_handlerUp(t){if(this._capturing)for(const e of new ItemsIterable(t.changedTouches))e.identifier==this.touchId&&(DomUt.stopEvent_(t),this._cursorX=this.startMouseX+e.pageX-this.startMouseEvent.pageX,this._cursorY=this.startMouseY+e.pageY-this.startMouseEvent.pageY,this._cursorX=Math.max(0,Math.min(this.element.clientWidth,this._cursorX)),this._cursorY=Math.max(0,Math.min(this.element.clientHeight,this._cursorY)),this.dragMode&&(null!=this._handlerMoveRef&&this._handlerMoveRef.cancel_(),null!=this._handlerUpRef&&this._handlerUpRef.cancel_(),null!=this._handlerCancelRef&&this._handlerCancelRef.cancel_()),this._limiter.queue_(()=>{var e;null===(e=this._onMouseUp)||void 0===e||e.call(this,this._cursorX,this._cursorY,t.touches.length)}))}}t.TouchListener=n;t.HsvGradientPicker=class{constructor(t,e,s,o=!1){this.colorChangeListener=null,this._color=new ColorValue,this.hueColor=null,this.cursorRadius=4,this.buffer=null,this._cursorX=0,this._cursorY=0,this.canvas=t.ownerDocument.createElement("canvas"),this.canvas.width=e,this.canvas.height=s,this.canvas.classList.add("color-picker-hsv-gradient"),this.context=this.canvas.getContext("2d"),this._mouseListener=o?new n(this.canvas,!0):new i(this.canvas,!0),this._mouseListener.onPointerDown((t,e,i)=>this.onMouseDown(t,e,i)),this._mouseListener.onPointerMoved((t,e,i)=>this.onMouseMoved(t,e,i)),this._rebuildColor(),this._draw(),this._notifyColorChanged()}get color$(){return this._color}set color$(t){this._color.rgbEquals_(t)||(this._color=t,this._rebuildColor(),this._draw())}_rebuildColor(){this._calculateHSV(!0),this._rebuildGradient(),this._cursorX=Math.floor(this.canvas.width*this.saturation),this._cursorY=Math.floor(this.canvas.height*(1-this.value/255))}_rebuildGradient(){this.buffer=this.context.createImageData(this.canvas.width,this.canvas.height);const t=this.buffer.height,e=this.buffer.width,i=1/(e-1),n=this.buffer.data;let s=0;for(let o=0;o<t;o++){const l=(t-1-o)/(t-1),a=Math.floor(255*l),r=ColorValue.fromRGB_(a,a,a),_=this.hueColor.mult_(l);let c=0;for(let t=0;t<e;t++){const t=_.minus_(r).mult_(c).add_(r);n[s++]=t.r$,n[s++]=t.g$,n[s++]=t.b$,n[s++]=255,c+=i}}}_calculateHSV(t=!1){if(this.value=e.getHsvValueComponent_(this._color),t){const t=(2*this._color.r$-this._color.g$-this._color.b$)/2,e=Math.sqrt(3)/2*(this._color.g$-this._color.b$);this.hue=Math.atan2(e,t),this.hue<0&&(this.hue+=2*Math.PI),this.chroma=Math.sqrt(t*t+e*e),this.saturation=0==this.chroma?0:this.chroma/this.value}this.hueColor=e.getHueColor_(this.hue)}_draw(){this.context.putImageData(this.buffer,0,0),this._drawCursor()}onHueChanged(t){this.hue=t,this.hueColor=e.getHueColor_(this.hue),this._recalculateColorFromCursor(),this._rebuildGradient(),this._draw(),this._notifyColorChanged()}_drawCursor(){let t="black";e.getColorLuma_(this._color)<.5&&(t="white"),this.context.strokeStyle=t,this.context.beginPath(),this.context.arc(this._cursorX,this._cursorY,this.cursorRadius,0,2*Math.PI,!1),this.context.closePath(),this.context.stroke()}onMouseDown(t,e,i){return this._setCursorPosition(t,e),!0}onMouseMoved(t,e,i){this._setCursorPosition(t,e)}_setCursorPosition(t,e){this._cursorX=t,this._cursorY=e,this._recalculateColorFromCursor(),this._calculateHSV(),this._notifyColorChanged(),this._draw()}_recalculateColorFromCursor(){this.saturation=this._cursorX/this.canvas.width,this.value=(this.canvas.height-this._cursorY)/this.canvas.height*255;const t=this.value/255,e=this.hueColor.mult_(t),i=Math.round(255*t),n=ColorValue.fromRGB_(i,i,i),s=e;this._color=s.minus_(n).mult_(this.saturation).add_(n)}_notifyColorChanged(){null!=this.colorChangeListener&&this.colorChangeListener(this._color,this.hue,this.saturation,this.value)}};t.HueSlider=class{constructor(t,e,s,o=!1){this.hueChangelistener=null,this._hueAngle=0,this.canvas=t.ownerDocument.createElement("canvas"),this.canvas.width=e,this.canvas.height=s,this.canvas.classList.add("color-picker-hue-slider"),this._mouseListener=o?new n(this.canvas,!0):new i(this.canvas,!0),this._mouseListener.onPointerDown((t,e,i)=>this.onMouseDown(t,e,i)),this._mouseListener.onPointerMoved((t,e,i)=>this.onMouseMoved(t,e,i)),this._buildGradient(),this._draw()}get hueAngle$(){return this._hueAngle}set hueAngle$(t){this._hueAngle=t,this._draw()}_draw(){const t=this.canvas.getContext("2d");t.fillStyle=this.gradient,t.fillRect(0,0,this.canvas.width,this.canvas.height);let i="black";const n=e.getHueColor_(this._hueAngle);e.getColorLuma_(n)<.5&&(i="white");const s=this.canvas.height*this._hueAngle/(2*Math.PI)+.5;t.save(),t.strokeStyle=i,t.lineWidth=1,t.beginPath(),t.moveTo(0,s),t.lineTo(this.canvas.width,s),t.closePath(),t.stroke(),t.restore()}_buildGradient(){const t=[ColorValue.fromRGB_(255,0,0),ColorValue.fromRGB_(255,255,0),ColorValue.fromRGB_(0,255,0),ColorValue.fromRGB_(0,255,255),ColorValue.fromRGB_(0,0,255),ColorValue.fromRGB_(255,0,255),ColorValue.fromRGB_(255,0,0)],e=this.canvas.getContext("2d");this.gradient=e.createLinearGradient(0,0,0,this.canvas.height);const i=1/(t.length-1);let n=0;for(let e=0;e<t.length-1;e++)this.gradient.addColorStop(n,t[e].toString_()),n+=i;this.gradient.addColorStop(1,ArrayUt.last_(t).toString_())}onMouseDown(t,e,i){return this._updateHue(t,e),!0}onMouseMoved(t,e,i){this._updateHue(t,e)}_updateHue(t,e){const i=(e%=this.canvas.height)/this.canvas.height;this._hueAngle=2*Math.PI*i,null!=this.hueChangelistener&&this.hueChangelistener.onHueChanged(this._hueAngle),this._draw()}}}(ColorValue$||(ColorValue$={})),function(t){class e{constructor(){this.basicList=new Array,this.itemsLength=0}get isEmpty$(){return 0==this.basicList.length}get isNotEmpty$(){return!this.isEmpty$}get first$(){if(0==this.itemsLength)throw new Error("No elements");return this.elementAt(0)}get last$(){if(0==this.itemsLength)throw new Error("No elements");return this.elementAt(this.itemsLength-1)}get length$(){return this.itemsLength}elementAt(t){return this.basicList[this._chunkPositionForElementAt(t)][2]}get itemList$(){const t=new Array;let e,i;return this.basicList.forEach(n=>{e=n[1],i=n[2];for(let n=0;n<e;n++)t.push(i)}),t}toList(t=!0){return Array.from(this.itemList$)}forEach(t){const e=this.itemsLength;let i,n;this.basicList.forEach(s=>{i=s[1],n=s[2];for(let s=0;s<i;s++)if(t(n),e!=this.itemsLength)throw new Error})}static from(t){const i=new e;let n,s,o;for(let e=0;e<t.length;e++)s!=(n=t[e])?(o=[e,1,n],i.basicList.push(o)):ArrayUt.last_(i.basicList)[1]++,s=n;return i.itemsLength=t.length,i}static fromSparseList(t){const i=new e;return t.forEach(t=>{i.basicList.push(t),i.itemsLength=i.itemsLength+t[1]}),i}_chunkPositionForElementAt(t){if(this.length$<=t)throw new Error("Not enough elements");let e,i,n=null,s=Math.round(t*this.basicList.length/this.itemsLength);if(s>=this.basicList.length&&(s=this.basicList.length-1),t>=this.basicList[s][0]){for(let o=s;o<this.basicList.length;o++)if(i=(e=this.basicList[o][0])+this.basicList[o][1],t>=e&&t<i){n=o;break}}else for(let o=s-1;o<this.basicList.length;o--)if(i=(e=this.basicList[o][0])+this.basicList[o][1],t>=e&&t<i){n=o;break}if(null==n)throw new Error;return n}set(t,e){const i=this._chunkPositionForElementAt(t),n=this.basicList[i],s=n[2];if(e!=s){const o=[n[0],t-n[0],s],l=[t,1,e],a=[t+1,n[1]-o[1]-1,s];a[1]>0&&ArrayUt.insert_(this.basicList,i+1,a),ArrayUt.insert_(this.basicList,i+1,l),0==o[1]?this.basicList.splice(i,1):this.basicList[i]=o}}add(t){const e=[0,0,t];this.basicList.push(e),this.itemsLength++}addItem(t){this.basicList.push(t),this.itemsLength=this.itemsLength+t[1]}}const i=e.fromSparseList([[0,32,1],[32,1,29],[33,3,21],[36,1,23],[37,3,21],[40,1,22],[41,1,18],[42,1,21],[43,1,25],[44,1,21],[45,1,17],[46,2,21],[48,10,13],[58,2,21],[60,3,25],[63,2,21],[65,26,9],[91,1,22],[92,1,21],[93,1,18],[94,1,24],[95,1,16],[96,1,24],[97,26,5],[123,1,22],[124,1,25],[125,1,18],[126,1,25],[127,33,1],[160,1,29],[161,1,21],[162,4,23],[166,2,26],[168,1,24],[169,1,26],[170,1,5],[171,1,20],[172,1,25],[173,1,17],[174,1,26],[175,1,24],[176,1,26],[177,1,25],[178,2,15],[180,1,24],[181,1,5],[182,1,26],[183,1,21],[184,1,24],[185,1,15],[186,1,5],[187,1,19],[188,3,15],[191,1,21],[192,23,9],[215,1,25],[216,7,9],[223,24,5],[247,1,25],[248,8,5],[256,1,9],[257,1,5],[258,1,9],[259,1,5],[260,1,9],[261,1,5],[262,1,9],[263,1,5],[264,1,9],[265,1,5],[266,1,9],[267,1,5],[268,1,9],[269,1,5],[270,1,9],[271,1,5],[272,1,9],[273,1,5],[274,1,9],[275,1,5],[276,1,9],[277,1,5],[278,1,9],[279,1,5],[280,1,9],[281,1,5],[282,1,9],[283,1,5],[284,1,9],[285,1,5],[286,1,9],[287,1,5],[288,1,9],[289,1,5],[290,1,9],[291,1,5],[292,1,9],[293,1,5],[294,1,9],[295,1,5],[296,1,9],[297,1,5],[298,1,9],[299,1,5],[300,1,9],[301,1,5],[302,1,9],[303,1,5],[304,1,9],[305,1,5],[306,1,9],[307,1,5],[308,1,9],[309,1,5],[310,1,9],[311,2,5],[313,1,9],[314,1,5],[315,1,9],[316,1,5],[317,1,9],[318,1,5],[319,1,9],[320,1,5],[321,1,9],[322,1,5],[323,1,9],[324,1,5],[325,1,9],[326,1,5],[327,1,9],[328,2,5],[330,1,9],[331,1,5],[332,1,9],[333,1,5],[334,1,9],[335,1,5],[336,1,9],[337,1,5],[338,1,9],[339,1,5],[340,1,9],[341,1,5],[342,1,9],[343,1,5],[344,1,9],[345,1,5],[346,1,9],[347,1,5],[348,1,9],[349,1,5],[350,1,9],[351,1,5],[352,1,9],[353,1,5],[354,1,9],[355,1,5],[356,1,9],[357,1,5],[358,1,9],[359,1,5],[360,1,9],[361,1,5],[362,1,9],[363,1,5],[364,1,9],[365,1,5],[366,1,9],[367,1,5],[368,1,9],[369,1,5],[370,1,9],[371,1,5],[372,1,9],[373,1,5],[374,1,9],[375,1,5],[376,2,9],[378,1,5],[379,1,9],[380,1,5],[381,1,9],[382,3,5],[385,2,9],[387,1,5],[388,1,9],[389,1,5],[390,2,9],[392,1,5],[393,3,9],[396,2,5],[398,4,9],[402,1,5],[403,2,9],[405,1,5],[406,3,9],[409,3,5],[412,2,9],[414,1,5],[415,2,9],[417,1,5],[418,1,9],[419,1,5],[420,1,9],[421,1,5],[422,2,9],[424,1,5],[425,1,9],[426,2,5],[428,1,9],[429,1,5],[430,2,9],[432,1,5],[433,3,9],[436,1,5],[437,1,9],[438,1,5],[439,2,9],[441,2,5],[443,1,7],[444,1,9],[445,3,5],[448,4,7],[452,1,9],[453,1,8],[454,1,5],[455,1,9],[456,1,8],[457,1,5],[458,1,9],[459,1,8],[460,1,5],[461,1,9],[462,1,5],[463,1,9],[464,1,5],[465,1,9],[466,1,5],[467,1,9],[468,1,5],[469,1,9],[470,1,5],[471,1,9],[472,1,5],[473,1,9],[474,1,5],[475,1,9],[476,2,5],[478,1,9],[479,1,5],[480,1,9],[481,1,5],[482,1,9],[483,1,5],[484,1,9],[485,1,5],[486,1,9],[487,1,5],[488,1,9],[489,1,5],[490,1,9],[491,1,5],[492,1,9],[493,1,5],[494,1,9],[495,2,5],[497,1,9],[498,1,8],[499,1,5],[500,1,9],[501,1,5],[502,3,9],[505,1,5],[506,1,9],[507,1,5],[508,1,9],[509,1,5],[510,1,9],[511,1,5],[512,1,9],[513,1,5],[514,1,9],[515,1,5],[516,1,9],[517,1,5],[518,1,9],[519,1,5],[520,1,9],[521,1,5],[522,1,9],[523,1,5],[524,1,9],[525,1,5],[526,1,9],[527,1,5],[528,1,9],[529,1,5],[530,1,9],[531,1,5],[532,1,9],[533,1,5],[534,1,9],[535,1,5],[536,1,9],[537,1,5],[538,1,9],[539,1,5],[540,1,9],[541,1,5],[542,1,9],[543,1,5],[544,1,9],[545,1,0],[546,1,9],[547,1,5],[548,1,9],[549,1,5],[550,1,9],[551,1,5],[552,1,9],[553,1,5],[554,1,9],[555,1,5],[556,1,9],[557,1,5],[558,1,9],[559,1,5],[560,1,9],[561,1,5],[562,1,9],[563,1,5],[564,28,0],[592,94,5],[686,2,0],[688,9,6],[697,2,24],[699,7,6],[706,14,24],[720,2,6],[722,14,24],[736,5,6],[741,9,24],[750,1,6],[751,17,0],[768,80,12],[848,16,0],[864,16,12],[880,4,0],[884,2,24],[886,4,0],[890,1,6],[891,3,0],[894,1,21],[895,5,0],[900,2,24],[902,1,9],[903,1,21],[904,3,9],[907,1,0],[908,1,9],[909,1,0],[910,2,9],[912,1,5],[913,17,9],[930,1,0],[931,9,9],[940,35,5],[975,1,0],[976,2,5],[978,3,9],[981,3,5],[984,1,9],[985,1,5],[986,1,9],[987,1,5],[988,1,9],[989,1,5],[990,1,9],[991,1,5],[992,1,9],[993,1,5],[994,1,9],[995,1,5],[996,1,9],[997,1,5],[998,1,9],[999,1,5],[1e3,1,9],[1001,1,5],[1002,1,9],[1003,1,5],[1004,1,9],[1005,1,5],[1006,1,9],[1007,5,5],[1012,1,9],[1013,1,5],[1014,1,25],[1015,9,0],[1024,48,9],[1072,48,5],[1120,1,9],[1121,1,5],[1122,1,9],[1123,1,5],[1124,1,9],[1125,1,5],[1126,1,9],[1127,1,5],[1128,1,9],[1129,1,5],[1130,1,9],[1131,1,5],[1132,1,9],[1133,1,5],[1134,1,9],[1135,1,5],[1136,1,9],[1137,1,5],[1138,1,9],[1139,1,5],[1140,1,9],[1141,1,5],[1142,1,9],[1143,1,5],[1144,1,9],[1145,1,5],[1146,1,9],[1147,1,5],[1148,1,9],[1149,1,5],[1150,1,9],[1151,1,5],[1152,1,9],[1153,1,5],[1154,1,26],[1155,4,12],[1159,1,0],[1160,2,11],[1162,1,9],[1163,1,5],[1164,1,9],[1165,1,5],[1166,1,9],[1167,1,5],[1168,1,9],[1169,1,5],[1170,1,9],[1171,1,5],[1172,1,9],[1173,1,5],[1174,1,9],[1175,1,5],[1176,1,9],[1177,1,5],[1178,1,9],[1179,1,5],[1180,1,9],[1181,1,5],[1182,1,9],[1183,1,5],[1184,1,9],[1185,1,5],[1186,1,9],[1187,1,5],[1188,1,9],[1189,1,5],[1190,1,9],[1191,1,5],[1192,1,9],[1193,1,5],[1194,1,9],[1195,1,5],[1196,1,9],[1197,1,5],[1198,1,9],[1199,1,5],[1200,1,9],[1201,1,5],[1202,1,9],[1203,1,5],[1204,1,9],[1205,1,5],[1206,1,9],[1207,1,5],[1208,1,9],[1209,1,5],[1210,1,9],[1211,1,5],[1212,1,9],[1213,1,5],[1214,1,9],[1215,1,5],[1216,2,9],[1218,1,5],[1219,1,9],[1220,1,5],[1221,1,9],[1222,1,5],[1223,1,9],[1224,1,5],[1225,1,9],[1226,1,5],[1227,1,9],[1228,1,5],[1229,1,9],[1230,1,5],[1231,1,0],[1232,1,9],[1233,1,5],[1234,1,9],[1235,1,5],[1236,1,9],[1237,1,5],[1238,1,9],[1239,1,5],[1240,1,9],[1241,1,5],[1242,1,9],[1243,1,5],[1244,1,9],[1245,1,5],[1246,1,9],[1247,1,5],[1248,1,9],[1249,1,5],[1250,1,9],[1251,1,5],[1252,1,9],[1253,1,5],[1254,1,9],[1255,1,5],[1256,1,9],[1257,1,5],[1258,1,9],[1259,1,5],[1260,1,9],[1261,1,5],[1262,1,9],[1263,1,5],[1264,1,9],[1265,1,5],[1266,1,9],[1267,1,5],[1268,1,9],[1269,1,5],[1270,2,0],[1272,1,9],[1273,1,5],[1274,6,0],[1280,1,9],[1281,1,5],[1282,1,9],[1283,1,5],[1284,1,9],[1285,1,5],[1286,1,9],[1287,1,5],[1288,1,9],[1289,1,5],[1290,1,9],[1291,1,5],[1292,1,9],[1293,1,5],[1294,1,9],[1295,1,5],[1296,33,0],[1329,38,9],[1367,2,0],[1369,1,6],[1370,6,21],[1376,1,0],[1377,39,5],[1416,1,0],[1417,1,21],[1418,1,17],[1419,6,0],[1425,17,12],[1442,1,0],[1443,23,12],[1466,1,0],[1467,3,12],[1470,1,21],[1471,1,12],[1472,1,21],[1473,2,12],[1475,1,21],[1476,1,12],[1477,11,0],[1488,27,7],[1515,5,0],[1520,3,7],[1523,2,21],[1525,23,0],[1548,1,21],[1549,14,0],[1563,1,21],[1564,3,0],[1567,1,21],[1568,1,0],[1569,26,7],[1595,5,0],[1600,1,6],[1601,10,7],[1611,11,12],[1622,10,0],[1632,10,13],[1642,4,21],[1646,2,7],[1648,1,12],[1649,99,7],[1748,1,21],[1749,1,7],[1750,7,12],[1757,1,2],[1758,1,11],[1759,6,12],[1765,2,6],[1767,2,12],[1769,1,26],[1770,4,12],[1774,2,0],[1776,10,13],[1786,3,7],[1789,2,26],[1791,1,0],[1792,14,21],[1806,1,0],[1807,1,2],[1808,1,7],[1809,1,12],[1810,27,7],[1837,3,0],[1840,27,12],[1867,53,0],[1920,38,7],[1958,11,12],[1969,1,7],[1970,335,0],[2305,2,12],[2307,1,10],[2308,1,0],[2309,53,7],[2362,2,0],[2364,1,12],[2365,1,7],[2366,3,10],[2369,8,12],[2377,4,10],[2381,1,12],[2382,2,0],[2384,1,7],[2385,4,12],[2389,3,0],[2392,10,7],[2402,2,12],[2404,2,21],[2406,10,13],[2416,1,21],[2417,16,0],[2433,1,12],[2434,2,10],[2436,1,0],[2437,8,7],[2445,2,0],[2447,2,7],[2449,2,0],[2451,22,7],[2473,1,0],[2474,7,7],[2481,1,0],[2482,1,7],[2483,3,0],[2486,4,7],[2490,2,0],[2492,1,12],[2493,1,0],[2494,3,10],[2497,4,12],[2501,2,0],[2503,2,10],[2505,2,0],[2507,2,10],[2509,1,12],[2510,9,0],[2519,1,10],[2520,4,0],[2524,2,7],[2526,1,0],[2527,3,7],[2530,2,12],[2532,2,0],[2534,10,13],[2544,2,7],[2546,2,23],[2548,6,15],[2554,1,26],[2555,7,0],[2562,1,12],[2563,2,0],[2565,6,7],[2571,4,0],[2575,2,7],[2577,2,0],[2579,22,7],[2601,1,0],[2602,7,7],[2609,1,0],[2610,2,7],[2612,1,0],[2613,2,7],[2615,1,0],[2616,2,7],[2618,2,0],[2620,1,12],[2621,1,0],[2622,3,10],[2625,2,12],[2627,4,0],[2631,2,12],[2633,2,0],[2635,3,12],[2638,11,0],[2649,4,7],[2653,1,0],[2654,1,7],[2655,7,0],[2662,10,13],[2672,2,12],[2674,3,7],[2677,12,0],[2689,2,12],[2691,1,10],[2692,1,0],[2693,7,7],[2700,1,0],[2701,1,7],[2702,1,0],[2703,3,7],[2706,1,0],[2707,22,7],[2729,1,0],[2730,7,7],[2737,1,0],[2738,2,7],[2740,1,0],[2741,5,7],[2746,2,0],[2748,1,12],[2749,1,7],[2750,3,10],[2753,5,12],[2758,1,0],[2759,2,12],[2761,1,10],[2762,1,0],[2763,2,10],[2765,1,12],[2766,2,0],[2768,1,7],[2769,15,0],[2784,1,7],[2785,5,0],[2790,10,13],[2800,17,0],[2817,1,12],[2818,2,10],[2820,1,0],[2821,8,7],[2829,2,0],[2831,2,7],[2833,2,0],[2835,22,7],[2857,1,0],[2858,7,7],[2865,1,0],[2866,2,7],[2868,2,0],[2870,4,7],[2874,2,0],[2876,1,12],[2877,1,7],[2878,1,10],[2879,1,12],[2880,1,10],[2881,3,12],[2884,3,0],[2887,2,10],[2889,2,0],[2891,2,10],[2893,1,12],[2894,8,0],[2902,1,12],[2903,1,10],[2904,4,0],[2908,2,7],[2910,1,0],[2911,3,7],[2914,4,0],[2918,10,13],[2928,1,26],[2929,17,0],[2946,1,12],[2947,1,7],[2948,1,0],[2949,6,7],[2955,3,0],[2958,3,7],[2961,1,0],[2962,4,7],[2966,3,0],[2969,2,7],[2971,1,0],[2972,1,7],[2973,1,0],[2974,2,7],[2976,3,0],[2979,2,7],[2981,3,0],[2984,3,7],[2987,3,0],[2990,8,7],[2998,1,0],[2999,3,7],[3002,4,0],[3006,2,10],[3008,1,12],[3009,2,10],[3011,3,0],[3014,3,10],[3017,1,0],[3018,3,10],[3021,1,12],[3022,9,0],[3031,1,10],[3032,15,0],[3047,9,13],[3056,3,15],[3059,14,0],[3073,3,10],[3076,1,0],[3077,8,7],[3085,1,0],[3086,3,7],[3089,1,0],[3090,23,7],[3113,1,0],[3114,10,7],[3124,1,0],[3125,5,7],[3130,4,0],[3134,3,12],[3137,4,10],[3141,1,0],[3142,3,12],[3145,1,0],[3146,4,12],[3150,7,0],[3157,2,12],[3159,9,0],[3168,2,7],[3170,4,0],[3174,10,13],[3184,18,0],[3202,2,10],[3204,1,0],[3205,8,7],[3213,1,0],[3214,3,7],[3217,1,0],[3218,23,7],[3241,1,0],[3242,10,7],[3252,1,0],[3253,5,7],[3258,4,0],[3262,1,10],[3263,1,12],[3264,5,10],[3269,1,0],[3270,1,12],[3271,2,10],[3273,1,0],[3274,2,10],[3276,2,12],[3278,7,0],[3285,2,10],[3287,7,0],[3294,1,7],[3295,1,0],[3296,2,7],[3298,4,0],[3302,10,13],[3312,18,0],[3330,2,10],[3332,1,0],[3333,8,7],[3341,1,0],[3342,3,7],[3345,1,0],[3346,23,7],[3369,1,0],[3370,16,7],[3386,4,0],[3390,3,10],[3393,3,12],[3396,2,0],[3398,3,10],[3401,1,0],[3402,3,10],[3405,1,12],[3406,9,0],[3415,1,10],[3416,8,0],[3424,2,7],[3426,4,0],[3430,10,13],[3440,18,0],[3458,2,10],[3460,1,0],[3461,18,7],[3479,3,0],[3482,24,7],[3506,1,0],[3507,9,7],[3516,1,0],[3517,1,7],[3518,2,0],[3520,7,7],[3527,3,0],[3530,1,12],[3531,4,0],[3535,3,10],[3538,3,12],[3541,1,0],[3542,1,12],[3543,1,0],[3544,8,10],[3552,18,0],[3570,2,10],[3572,1,21],[3573,12,0],[3585,48,7],[3633,1,12],[3634,2,7],[3636,7,12],[3643,4,0],[3647,1,23],[3648,6,7],[3654,1,6],[3655,8,12],[3663,1,21],[3664,10,13],[3674,2,21],[3676,37,0],[3713,2,7],[3715,1,0],[3716,1,7],[3717,2,0],[3719,2,7],[3721,1,0],[3722,1,7],[3723,2,0],[3725,1,7],[3726,6,0],[3732,4,7],[3736,1,0],[3737,7,7],[3744,1,0],[3745,3,7],[3748,1,0],[3749,1,7],[3750,1,0],[3751,1,7],[3752,2,0],[3754,2,7],[3756,1,0],[3757,4,7],[3761,1,12],[3762,2,7],[3764,6,12],[3770,1,0],[3771,2,12],[3773,1,7],[3774,2,0],[3776,5,7],[3781,1,0],[3782,1,6],[3783,1,0],[3784,6,12],[3790,2,0],[3792,10,13],[3802,2,0],[3804,2,7],[3806,34,0],[3840,1,7],[3841,3,26],[3844,15,21],[3859,5,26],[3864,2,12],[3866,6,26],[3872,10,13],[3882,10,15],[3892,1,26],[3893,1,12],[3894,1,26],[3895,1,12],[3896,1,26],[3897,1,12],[3898,1,22],[3899,1,18],[3900,1,22],[3901,1,18],[3902,2,10],[3904,8,7],[3912,1,0],[3913,34,7],[3947,6,0],[3953,14,12],[3967,1,10],[3968,5,12],[3973,1,21],[3974,2,12],[3976,4,7],[3980,4,0],[3984,8,12],[3992,1,0],[3993,36,12],[4029,1,0],[4030,8,26],[4038,1,12],[4039,6,26],[4045,2,0],[4047,1,26],[4048,48,0],[4096,34,7],[4130,1,0],[4131,5,7],[4136,1,0],[4137,2,7],[4139,1,0],[4140,1,10],[4141,4,12],[4145,1,10],[4146,1,12],[4147,3,0],[4150,2,12],[4152,1,10],[4153,1,12],[4154,6,0],[4160,10,13],[4170,6,21],[4176,6,7],[4182,2,10],[4184,2,12],[4186,70,0],[4256,38,9],[4294,10,0],[4304,41,7],[4345,2,0],[4347,1,21],[4348,4,0],[4352,90,7],[4442,5,0],[4447,68,7],[4515,5,0],[4520,82,7],[4602,6,0],[4608,7,7],[4615,1,0],[4616,63,7],[4679,1,0],[4680,1,7],[4681,1,0],[4682,4,7],[4686,2,0],[4688,7,7],[4695,1,0],[4696,1,7],[4697,1,0],[4698,4,7],[4702,2,0],[4704,39,7],[4743,1,0],[4744,1,7],[4745,1,0],[4746,4,7],[4750,2,0],[4752,31,7],[4783,1,0],[4784,1,7],[4785,1,0],[4786,4,7],[4790,2,0],[4792,7,7],[4799,1,0],[4800,1,7],[4801,1,0],[4802,4,7],[4806,2,0],[4808,7,7],[4815,1,0],[4816,7,7],[4823,1,0],[4824,23,7],[4847,1,0],[4848,31,7],[4879,1,0],[4880,1,7],[4881,1,0],[4882,4,7],[4886,2,0],[4888,7,7],[4895,1,0],[4896,39,7],[4935,1,0],[4936,19,7],[4955,6,0],[4961,8,21],[4969,9,13],[4978,11,15],[4989,35,0],[5024,85,7],[5109,12,0],[5121,620,7],[5741,2,21],[5743,8,7],[5751,9,0],[5760,1,29],[5761,26,7],[5787,1,22],[5788,1,18],[5789,3,0],[5792,75,7],[5867,3,21],[5870,3,14],[5873,15,0],[5888,13,7],[5901,1,0],[5902,4,7],[5906,3,12],[5909,11,0],[5920,18,7],[5938,3,12],[5941,2,21],[5943,9,0],[5952,18,7],[5970,2,12],[5972,12,0],[5984,13,7],[5997,1,0],[5998,3,7],[6001,1,0],[6002,2,12],[6004,12,0],[6016,52,7],[6068,3,10],[6071,7,12],[6078,8,10],[6086,1,12],[6087,2,10],[6089,11,12],[6100,3,21],[6103,1,6],[6104,3,21],[6107,1,23],[6108,1,7],[6109,3,0],[6112,10,13],[6122,22,0],[6144,6,21],[6150,1,17],[6151,4,21],[6155,3,12],[6158,1,2],[6159,1,0],[6160,10,13],[6170,6,0],[6176,35,7],[6211,1,6],[6212,52,7],[6264,8,0],[6272,41,7],[6313,1,12],[6314,1366,0],[7680,1,9],[7681,1,5],[7682,1,9],[7683,1,5],[7684,1,9],[7685,1,5],[7686,1,9],[7687,1,5],[7688,1,9],[7689,1,5],[7690,1,9],[7691,1,5],[7692,1,9],[7693,1,5],[7694,1,9],[7695,1,5],[7696,1,9],[7697,1,5],[7698,1,9],[7699,1,5],[7700,1,9],[7701,1,5],[7702,1,9],[7703,1,5],[7704,1,9],[7705,1,5],[7706,1,9],[7707,1,5],[7708,1,9],[7709,1,5],[7710,1,9],[7711,1,5],[7712,1,9],[7713,1,5],[7714,1,9],[7715,1,5],[7716,1,9],[7717,1,5],[7718,1,9],[7719,1,5],[7720,1,9],[7721,1,5],[7722,1,9],[7723,1,5],[7724,1,9],[7725,1,5],[7726,1,9],[7727,1,5],[7728,1,9],[7729,1,5],[7730,1,9],[7731,1,5],[7732,1,9],[7733,1,5],[7734,1,9],[7735,1,5],[7736,1,9],[7737,1,5],[7738,1,9],[7739,1,5],[7740,1,9],[7741,1,5],[7742,1,9],[7743,1,5],[7744,1,9],[7745,1,5],[7746,1,9],[7747,1,5],[7748,1,9],[7749,1,5],[7750,1,9],[7751,1,5],[7752,1,9],[7753,1,5],[7754,1,9],[7755,1,5],[7756,1,9],[7757,1,5],[7758,1,9],[7759,1,5],[7760,1,9],[7761,1,5],[7762,1,9],[7763,1,5],[7764,1,9],[7765,1,5],[7766,1,9],[7767,1,5],[7768,1,9],[7769,1,5],[7770,1,9],[7771,1,5],[7772,1,9],[7773,1,5],[7774,1,9],[7775,1,5],[7776,1,9],[7777,1,5],[7778,1,9],[7779,1,5],[7780,1,9],[7781,1,5],[7782,1,9],[7783,1,5],[7784,1,9],[7785,1,5],[7786,1,9],[7787,1,5],[7788,1,9],[7789,1,5],[7790,1,9],[7791,1,5],[7792,1,9],[7793,1,5],[7794,1,9],[7795,1,5],[7796,1,9],[7797,1,5],[7798,1,9],[7799,1,5],[7800,1,9],[7801,1,5],[7802,1,9],[7803,1,5],[7804,1,9],[7805,1,5],[7806,1,9],[7807,1,5],[7808,1,9],[7809,1,5],[7810,1,9],[7811,1,5],[7812,1,9],[7813,1,5],[7814,1,9],[7815,1,5],[7816,1,9],[7817,1,5],[7818,1,9],[7819,1,5],[7820,1,9],[7821,1,5],[7822,1,9],[7823,1,5],[7824,1,9],[7825,1,5],[7826,1,9],[7827,1,5],[7828,1,9],[7829,7,5],[7836,4,0],[7840,1,9],[7841,1,5],[7842,1,9],[7843,1,5],[7844,1,9],[7845,1,5],[7846,1,9],[7847,1,5],[7848,1,9],[7849,1,5],[7850,1,9],[7851,1,5],[7852,1,9],[7853,1,5],[7854,1,9],[7855,1,5],[7856,1,9],[7857,1,5],[7858,1,9],[7859,1,5],[7860,1,9],[7861,1,5],[7862,1,9],[7863,1,5],[7864,1,9],[7865,1,5],[7866,1,9],[7867,1,5],[7868,1,9],[7869,1,5],[7870,1,9],[7871,1,5],[7872,1,9],[7873,1,5],[7874,1,9],[7875,1,5],[7876,1,9],[7877,1,5],[7878,1,9],[7879,1,5],[7880,1,9],[7881,1,5],[7882,1,9],[7883,1,5],[7884,1,9],[7885,1,5],[7886,1,9],[7887,1,5],[7888,1,9],[7889,1,5],[7890,1,9],[7891,1,5],[7892,1,9],[7893,1,5],[7894,1,9],[7895,1,5],[7896,1,9],[7897,1,5],[7898,1,9],[7899,1,5],[7900,1,9],[7901,1,5],[7902,1,9],[7903,1,5],[7904,1,9],[7905,1,5],[7906,1,9],[7907,1,5],[7908,1,9],[7909,1,5],[7910,1,9],[7911,1,5],[7912,1,9],[7913,1,5],[7914,1,9],[7915,1,5],[7916,1,9],[7917,1,5],[7918,1,9],[7919,1,5],[7920,1,9],[7921,1,5],[7922,1,9],[7923,1,5],[7924,1,9],[7925,1,5],[7926,1,9],[7927,1,5],[7928,1,9],[7929,1,5],[7930,6,0],[7936,8,5],[7944,8,9],[7952,6,5],[7958,2,0],[7960,6,9],[7966,2,0],[7968,8,5],[7976,8,9],[7984,8,5],[7992,8,9],[8e3,6,5],[8006,2,0],[8008,6,9],[8014,2,0],[8016,8,5],[8024,1,0],[8025,1,9],[8026,1,0],[8027,1,9],[8028,1,0],[8029,1,9],[8030,1,0],[8031,1,9],[8032,8,5],[8040,8,9],[8048,14,5],[8062,2,0],[8064,8,5],[8072,8,8],[8080,8,5],[8088,8,8],[8096,8,5],[8104,8,8],[8112,5,5],[8117,1,0],[8118,2,5],[8120,4,9],[8124,1,8],[8125,1,24],[8126,1,5],[8127,3,24],[8130,3,5],[8133,1,0],[8134,2,5],[8136,4,9],[8140,1,8],[8141,3,24],[8144,4,5],[8148,2,0],[8150,2,5],[8152,4,9],[8156,1,0],[8157,3,24],[8160,8,5],[8168,5,9],[8173,3,24],[8176,2,0],[8178,3,5],[8181,1,0],[8182,2,5],[8184,4,9],[8188,1,8],[8189,2,24],[8191,1,0],[8192,12,29],[8204,4,2],[8208,6,17],[8214,2,21],[8216,1,20],[8217,1,19],[8218,1,22],[8219,2,20],[8221,1,19],[8222,1,22],[8223,1,20],[8224,8,21],[8232,1,27],[8233,1,28],[8234,5,2],[8239,1,29],[8240,9,21],[8249,1,20],[8250,1,19],[8251,4,21],[8255,2,16],[8257,3,21],[8260,1,25],[8261,1,22],[8262,1,18],[8263,11,21],[8274,1,25],[8275,4,0],[8279,1,21],[8280,7,0],[8287,1,29],[8288,4,2],[8292,6,0],[8298,6,2],[8304,1,15],[8305,1,5],[8306,2,0],[8308,6,15],[8314,3,25],[8317,1,22],[8318,1,18],[8319,1,5],[8320,10,15],[8330,3,25],[8333,1,22],[8334,1,18],[8335,17,0],[8352,18,23],[8370,30,0],[8400,13,12],[8413,4,11],[8417,1,12],[8418,3,11],[8421,6,12],[8427,21,0],[8448,2,26],[8450,1,9],[8451,4,26],[8455,1,9],[8456,2,26],[8458,1,5],[8459,3,9],[8462,2,5],[8464,3,9],[8467,1,5],[8468,1,26],[8469,1,9],[8470,3,26],[8473,5,9],[8478,6,26],[8484,1,9],[8485,1,26],[8486,1,9],[8487,1,26],[8488,1,9],[8489,1,26],[8490,4,9],[8494,1,26],[8495,1,5],[8496,2,9],[8498,1,26],[8499,1,9],[8500,1,5],[8501,4,7],[8505,1,5],[8506,1,26],[8507,2,0],[8509,1,5],[8510,2,9],[8512,5,25],[8517,1,9],[8518,4,5],[8522,1,26],[8523,1,25],[8524,7,0],[8531,13,15],[8544,36,14],[8580,12,0],[8592,5,25],[8597,5,26],[8602,2,25],[8604,4,26],[8608,1,25],[8609,2,26],[8611,1,25],[8612,2,26],[8614,1,25],[8615,7,26],[8622,1,25],[8623,31,26],[8654,2,25],[8656,2,26],[8658,1,25],[8659,1,26],[8660,1,25],[8661,31,26],[8692,268,25],[8960,8,26],[8968,4,25],[8972,20,26],[8992,2,25],[8994,7,26],[9001,1,22],[9002,1,18],[9003,81,26],[9084,1,25],[9085,30,26],[9115,25,25],[9140,1,22],[9141,1,18],[9142,1,21],[9143,24,26],[9167,49,0],[9216,39,26],[9255,25,0],[9280,11,26],[9291,21,0],[9312,60,15],[9372,78,26],[9450,21,15],[9471,1,0],[9472,183,26],[9655,1,25],[9656,9,26],[9665,1,25],[9666,54,26],[9720,8,25],[9728,20,26],[9748,2,0],[9750,2,26],[9752,1,0],[9753,86,26],[9839,1,25],[9840,14,26],[9854,2,0],[9856,10,26],[9866,119,0],[9985,4,26],[9989,1,0],[9990,4,26],[9994,2,0],[9996,28,26],[10024,1,0],[10025,35,26],[10060,1,0],[10061,1,26],[10062,1,0],[10063,4,26],[10067,3,0],[10070,1,26],[10071,1,0],[10072,7,26],[10079,2,0],[10081,7,26],[10088,1,22],[10089,1,18],[10090,1,22],[10091,1,18],[10092,1,22],[10093,1,18],[10094,1,22],[10095,1,18],[10096,1,22],[10097,1,18],[10098,1,22],[10099,1,18],[10100,1,22],[10101,1,18],[10102,30,15],[10132,1,26],[10133,3,0],[10136,24,26],[10160,1,0],[10161,14,26],[10175,17,0],[10192,22,25],[10214,1,22],[10215,1,18],[10216,1,22],[10217,1,18],[10218,1,22],[10219,1,18],[10220,4,0],[10224,16,25],[10240,256,26],[10496,131,25],[10627,1,22],[10628,1,18],[10629,1,22],[10630,1,18],[10631,1,22],[10632,1,18],[10633,1,22],[10634,1,18],[10635,1,22],[10636,1,18],[10637,1,22],[10638,1,18],[10639,1,22],[10640,1,18],[10641,1,22],[10642,1,18],[10643,1,22],[10644,1,18],[10645,1,22],[10646,1,18],[10647,1,22],[10648,1,18],[10649,63,25],[10712,1,22],[10713,1,18],[10714,1,22],[10715,1,18],[10716,32,25],[10748,1,22],[10749,1,18],[10750,258,25],[11008,896,0],[11904,26,26],[11930,1,0],[11931,89,26],[12020,12,0],[12032,214,26],[12246,26,0],[12272,12,26],[12284,4,0],[12288,1,29],[12289,3,21],[12292,1,26],[12293,1,6],[12294,1,7],[12295,1,14],[12296,1,22],[12297,1,18],[12298,1,22],[12299,1,18],[12300,1,22],[12301,1,18],[12302,1,22],[12303,1,18],[12304,1,22],[12305,1,18],[12306,2,26],[12308,1,22],[12309,1,18],[12310,1,22],[12311,1,18],[12312,1,22],[12313,1,18],[12314,1,22],[12315,1,18],[12316,1,17],[12317,1,22],[12318,2,18],[12320,1,26],[12321,9,14],[12330,6,12],[12336,1,17],[12337,5,6],[12342,2,26],[12344,3,14],[12347,1,6],[12348,1,7],[12349,1,21],[12350,2,26],[12352,1,0],[12353,86,7],[12439,2,0],[12441,2,12],[12443,2,24],[12445,2,6],[12447,1,7],[12448,1,17],[12449,90,7],[12539,1,16],[12540,3,6],[12543,1,7],[12544,5,0],[12549,40,7],[12589,4,0],[12593,94,7],[12687,1,0],[12688,2,26],[12690,4,15],[12694,10,26],[12704,24,7],[12728,56,0],[12784,16,7],[12800,29,26],[12829,3,0],[12832,10,15],[12842,26,26],[12868,13,0],[12881,15,15],[12896,28,26],[12924,3,0],[12927,1,26],[12928,10,15],[12938,39,26],[12977,15,15],[12992,12,26],[13004,4,0],[13008,47,26],[13055,1,0],[13056,119,26],[13175,4,0],[13179,99,26],[13278,2,0],[13280,31,26],[13311,1,0],[13312,6582,7],[19894,74,0],[19968,20902,7],[40870,90,0],[40960,1165,7],[42125,3,0],[42128,55,26],[42183,1849,0],[44032,11264,7],[55296,1,4],[55297,894,0],[56191,2,4],[56193,126,0],[56319,2,4],[56321,1022,0],[57343,1,4],[57344,1,3],[57345,6398,0],[63743,1,3],[63744,302,7],[64046,2,0],[64048,59,7],[64107,149,0],[64256,7,5],[64263,12,0],[64275,5,5],[64280,5,0],[64285,1,7],[64286,1,12],[64287,10,7],[64297,1,25],[64298,13,7],[64311,1,0],[64312,5,7],[64317,1,0],[64318,1,7],[64319,1,0],[64320,2,7],[64322,1,0],[64323,2,7],[64325,1,0],[64326,108,7],[64434,33,0],[64467,363,7],[64830,1,22],[64831,1,18],[64832,16,0],[64848,64,7],[64912,2,0],[64914,54,7],[64968,40,0],[65008,12,7],[65020,1,23],[65021,3,0],[65024,16,12],[65040,16,0],[65056,4,12],[65060,12,0],[65072,1,21],[65073,2,17],[65075,2,16],[65077,1,22],[65078,1,18],[65079,1,22],[65080,1,18],[65081,1,22],[65082,1,18],[65083,1,22],[65084,1,18],[65085,1,22],[65086,1,18],[65087,1,22],[65088,1,18],[65089,1,22],[65090,1,18],[65091,1,22],[65092,1,18],[65093,2,21],[65095,2,0],[65097,4,21],[65101,3,16],[65104,3,21],[65107,1,0],[65108,4,21],[65112,1,17],[65113,1,22],[65114,1,18],[65115,1,22],[65116,1,18],[65117,1,22],[65118,1,18],[65119,3,21],[65122,1,25],[65123,1,17],[65124,3,25],[65127,1,0],[65128,1,21],[65129,1,23],[65130,2,21],[65132,4,0],[65136,5,7],[65141,1,0],[65142,135,7],[65277,2,0],[65279,1,2],[65280,1,0],[65281,3,21],[65284,1,23],[65285,3,21],[65288,1,22],[65289,1,18],[65290,1,21],[65291,1,25],[65292,1,21],[65293,1,17],[65294,2,21],[65296,10,13],[65306,2,21],[65308,3,25],[65311,2,21],[65313,26,9],[65339,1,22],[65340,1,21],[65341,1,18],[65342,1,24],[65343,1,16],[65344,1,24],[65345,26,5],[65371,1,22],[65372,1,25],[65373,1,18],[65374,1,25],[65375,1,22],[65376,1,18],[65377,1,21],[65378,1,22],[65379,1,18],[65380,1,21],[65381,1,16],[65382,10,7],[65392,1,6],[65393,45,7],[65438,2,6],[65440,31,7],[65471,3,0],[65474,6,7],[65480,2,0],[65482,6,7],[65488,2,0],[65490,6,7],[65496,2,0],[65498,3,7],[65501,3,0],[65504,2,23],[65506,1,25],[65507,1,24],[65508,1,26],[65509,2,23],[65511,1,0],[65512,1,26],[65513,4,25],[65517,2,26],[65519,10,0],[65529,3,2],[65532,2,26],[65534,770,0],[66304,31,7],[66335,1,0],[66336,4,15],[66340,12,0],[66352,26,7],[66378,1,14],[66379,181,0],[66560,38,9],[66598,2,0],[66600,38,5],[66638,52146,0],[118784,246,26],[119030,10,0],[119040,39,26],[119079,3,0],[119082,59,26],[119141,2,10],[119143,3,12],[119146,3,26],[119149,6,10],[119155,8,2],[119163,8,12],[119171,2,26],[119173,7,12],[119180,30,26],[119210,4,12],[119214,48,26],[119262,546,0],[119808,26,9],[119834,26,5],[119860,26,9],[119886,7,5],[119893,1,0],[119894,18,5],[119912,26,9],[119938,26,5],[119964,1,9],[119965,1,0],[119966,2,9],[119968,2,0],[119970,1,9],[119971,2,0],[119973,2,9],[119975,2,0],[119977,4,9],[119981,1,0],[119982,8,9],[119990,4,5],[119994,1,0],[119995,1,5],[119996,1,0],[119997,4,5],[120001,1,0],[120002,2,5],[120004,1,0],[120005,11,5],[120016,26,9],[120042,26,5],[120068,2,9],[120070,1,0],[120071,4,9],[120075,2,0],[120077,8,9],[120085,1,0],[120086,7,9],[120093,1,0],[120094,26,5],[120120,2,9],[120122,1,0],[120123,4,9],[120127,1,0],[120128,5,9],[120133,1,0],[120134,1,9],[120135,3,0],[120138,7,9],[120145,1,0],[120146,26,5],[120172,26,9],[120198,26,5],[120224,26,9],[120250,26,5],[120276,26,9],[120302,26,5],[120328,26,9],[120354,26,5],[120380,26,9],[120406,26,5],[120432,26,9],[120458,26,5],[120484,4,0],[120488,25,9],[120513,1,25],[120514,25,5],[120539,1,25],[120540,6,5],[120546,25,9],[120571,1,25],[120572,25,5],[120597,1,25],[120598,6,5],[120604,25,9],[120629,1,25],[120630,25,5],[120655,1,25],[120656,6,5],[120662,25,9],[120687,1,25],[120688,25,5],[120713,1,25],[120714,6,5],[120720,25,9],[120745,1,25],[120746,25,5],[120771,1,25],[120772,6,5],[120778,4,0],[120782,50,13],[120832,10240,0],[131072,1,7],[131073,42709,0],[173782,1,7],[173783,20777,0],[194560,542,7],[195102,722403,0],[917505,1,2],[917506,30,0],[917536,96,2]]);class n{}n.Cn=0,n.Cc=1,n.Cf=2,n.Co=3,n.Cs=4,n.Ll=5,n.Lm=6,n.Lo=7,n.Lt=8,n.Lu=9,n.Mc=10,n.Me=11,n.Mn=12,n.Nd=13,n.Nl=14,n.No=15,n.Pc=16,n.Pd=17,n.Pe=18,n.Pf=19,n.Pi=20,n.Po=21,n.Ps=22,n.Sc=23,n.Sk=24,n.Sm=25,n.So=26,n.Zl=27,n.Zp=28,n.Zs=29,t.Cat=n,t.unicodeCat_=function(t){return i.elementAt(t)},t.isValidUnicode_=function(e){const n=i.elementAt(e);return n>t.Cat.Cn&&n<=t.Cat.Zs}}(Unicode$||(Unicode$={}));class CF{}CF.HOST="localhost",CF.SCHEME="http",CF.HOSTPORT="localhost:8080",CF.SCHEME_HOSTPORT="http://localhost:8080",CF.SCHEME_HOSTPORT_="http://localhost:8080/",CF.PORT=8080;class RS{}RS.AudioDataIsOverLimit="XyI",RS.action_Delete="Xt8",RS.Moved1file="XRU",RS.Tooltips_ColorPalette="XpE",RS.MatchFoundButNotVisible="Xgt",RS.Name="Xx2",RS.Repeat="X3n",RS.AddStylesheetMessage="Xwg",RS.GameOver="XkS",RS.NoMoreItems="X0F",RS.Custom="XKq",RS.ToasterHint="XdI",RS.Tooltips_IgnoreCase="XBZ",RS.app_name="XRI",RS.MissingTemplateParameter="Xe6",RS.RestoreDataFailed="XUa",RS.DestinationNotDeletable="Xt9",RS.AssertIndexOfNodeNotFound_="XUc",RS.BackupKeyImportTooltips="Xx7",RS.AssertNotReach="XWN",RS.NothingToUndo="XA2",RS.Tooltips_TextShadow="XiY",RS.MODERATE="XII",RS.Tooltips_BorderThin="X68",RS.GameMinesNewGame="Xzd",RS.ConfirmRestoreFullBackupFrom_="Xu3",RS.Tooltips_InsertSymbol="Xgl",RS.Adjust="XTf",RS.ImportFailed="XLm",RS.FullTextSearchNotAvailable="XnJ",RS.ListElementNotFound="XFX",RS.NotMoving="Xoq",RS.SpecifiedFileDoesNotExistsPleaseTryAgain="X5t",RS.Tooltips_PageTemplates="XRp",RS.Result="X58",RS.LoginFailed="XEU",RS.widgetAnnotationType="XxR",RS.CorrectionOptionCrop="XSv",RS.BarcodeGenerateTitle="Xne",RS.ErrorCreatingFile_="XPM",RS.Style="XU0",RS.DocumentBrowsingSaved="XcG",RS.widgetShoppingTitle="XJi",RS.app_name_alpha="Xt2",RS.AssertFail_="XiF",RS.StylesheetNotFound="Xsu",RS.action_DestructSlideshow="XzT",RS.DeleteFailed_="XBS",RS.PleaseEnterSearchText="XFg",RS.BackupKeyDeleteTooltips="XPL",RS.Fit="Xvm",RS.Kind="Xda",RS.Files="XNc",RS.VideoQualityHigh="XgR",RS.AudioRecorderError="Xeg",RS.Layer3="XwD",RS.AStyleValidatorIsRequired="XcA",RS.Tooltips_Annotation="XfI",RS.Tooltips_GameMinds="XS2",RS.FilenameMustNotStartsWithSpaces="Xeb",RS.Tooltips_Highlight="X4R",RS.Scribbler_MissingImageURI="Xsi",RS.Tooltips_EditStyle="XX4",RS.Redo="Xgx",RS.FailedToWriteLoginCf="XHk",RS.CannotChangeFileExt="X6p",RS.Tooltips_ColorNames="Xxv",RS.Tooltips_ExportEvents="XqG",RS.Paragraph="XMT",RS.ConfirmUnlinkStylesheet="XY8",RS.Tooltips_ToggleIgnoreCase="XL2",RS.action_InsertTextSibling="X4B",RS.AlarmPosted_="XR5",RS.Tooltips_EnterAsText="XEf",RS.InvalidEncryptedData="XQx",RS.ExportingWholeCanvas="Xyw",RS.NotOverwritingDestination="Xbh",RS.DestinationMustBeAFile="XVg",RS.Help_GameMinds="XH6",RS.FactoryResetOption2="XJm",RS.Tooltips_HideWhitespaceNodes="XDv",RS.DesktopOperationRecordAudioNotAvailable="XgL",RS.AssertMutationObserverSupportIsRequired="XVe",RS.UnexpectedException_="Xpv",RS.confirmDeletingElement="XXR",RS.ColorDialogBG="XUz",RS.RenameFailed_="Xi5",RS.DocumentNotFound="XcP",RS.ConfirmDeletingRuleset="XcI",RS.Tooltips_Cleanup="XHd",RS.Tooltips_DocumentStyles="XWw",RS.BackupFileMustUnderInternalOrExternal="XLn",RS.Tooltips_RotateImage="XSY",RS.ErrorRemovingEvents="Xmr",RS.VERY_HARD="X1N",RS.NothingToRedo="Xij",RS.SearchFromEnd="XE4",RS.Tooltips_CloneFile="Xxi",RS.InvalidEncryptedFile="XmF",RS.EditRulesetTitle="XBC",RS.ExpectingCSS="Xem",RS.ScribblerEmbeddedImage="XgS",RS.widgetStickerStyleCanvas="Xse",RS.Tooltips_FilesPanel="XoO",RS.Operand="XkO",RS.ActionRequireASelectionWithASrcOrHrefAttribute="X5O",RS.Tooltips_AddNextPageLink="XKx",RS.ErrorGettingMemoryInfo="XDU",RS.action_Paste="XJT",RS.Tooltips_CollapseAll="XFk",RS.ReachedEndOfDocument="Xe7",RS.BackupKeyDeleteConfirmMesesage="XJl",RS.invalidAction_="XRa",RS.Tooltips_SetBackgroundColor="XVS",RS.NotFound_="X9G",RS.ExpectingAnOperator="XQu",RS.Wait="Xmt",RS.SelectedNodeIsNotEditableStylesheet="XRC",RS.InvalidCharacter_="Xs5",RS.FailedToDecrypt_="Xp9",RS.StyleSize="XFv",RS.Scribbler_GridMessage="XaM",RS.Done="X9j",RS.DurationMs="XCG",RS.Cut_="XSS",RS.GradientRepeatingRadialCircle="Xvz",RS.DestinationDir="X8o",RS.CSS="XLo",RS.Tooltips_CopyToLocalClipboard="X2T",RS.ChangePasswordTitle="Xyz",RS.Tooltips_RestoreData="XHs",RS.RefuseToProcessImageLargerThan_="XK6",RS.Tooltips_SaveAndQuit="XQJ",RS.Tooltips_EventDone="XOI",RS.HARD="XMp",RS.Tooltips_ListWithoutBullet="XMu",RS.Tooltips_RestoreDataFromFullBackup="XC5",RS.Margin="X0B",RS.NoSuitableMediaFileFound="XS1",RS.Center="XHg",RS.Tooltips_Backup="Xzs",RS.ErrorImportingImage_="XAR",RS.PickColor="Xgc",RS.TagIsRequired="Xwx",RS.EditImgTitle="XaR",RS.Tooltips_Delete="X0y",RS.FailedToDecryptData="X8p",RS.action_DestructAnnotation="Xw6",RS.Tooltips_ImageViewerContextmenu="XCI",RS.URLInputMustNotBeEmpty="XVj",RS.IllegalFilenameCharacter_="Xqv",RS.Tooltips_CreateTextNode="Xiv",RS.SearchResultIsEmpty="XET",RS.RecipientsSelected="XKA",RS.AValidatorIsRequired="XOt",RS.Tooltips_InsertElement="XER",RS.Tooltips_RecordVideo="Xx9",RS.InvalidCSSRule_="XUX",RS.Tooltips_EventDetails="XsP",RS.Tooltips_ClearEvents="XVq",RS.Alignment="X70",RS.Tooltips_TakePhoto="Xmx",RS.DestinationIsNotADirectory="XTl",RS.widgetAnnotationStyleVBox="XB0",RS.ActionRequireASingleNodeSelection="XDB",RS.InvalidInputMimeType="Xd2",RS.CannotReplaceReservedSymbol="XbX",RS.ErrorRestoringRecentsList="XgZ",RS.EnterLoginPasswordOrBiometric="XI6",RS.InsertTextTitle="XpG",RS.Tooltips_HideSelection="XZs",RS.LineHeight="XIG",RS.BackupFailed="XX9",RS.Tooltips_UndoTextEdit="XAc",RS.history_nongrouped="Xch",RS.Tooltips_ColorWhite="XWM",RS.LeftOrRight="XZ7",RS.Tooltips_Preview="XxM",RS.Tooltips_RestoreCalendarEvents="X76",RS.ImportOK="Xdu",RS.ErrorFormattingDocument="X1y",RS.DestinationAlreadyExists="X9Z",RS.Tooltips_CutNotDone="XmJ",RS.BackupDataOK="XHT",RS.widgetGlassTitle="XZL",RS.Tooltips_ListStyles="XAo",RS.Scribbler_MissingDataForEmbeddedImageAction="XmN",RS.InvalidEvent="Xxw",RS.Tooltips_EditStylesheet="XOe",RS.Converting="XTn",RS.TextCorrection="XtB",RS.Tooltips_ClearHistory="Xxy",RS.InvalidCSSClassName="Xng",RS.ScribblerRectangle="Xu2",RS.widgetGlassMessage="X9z",RS.Tooltips_Refresh="Xhz",RS.imageAreaLimit="Xyf",RS.ErrorCreatingAudioPlayer="XAI",RS.GameRestoreSnapshot="X0J",RS.removed_events="Xfh",RS.TodoItemNotFound="XnV",RS.Caption="XI1",RS.BackdropFilterSamplesTooltips="Xwv",RS.ActionRequireASelectionThatStartsAndEndsUnderTheSameParent="XVN",RS.sec="Xpu",RS.TnWidth="XrQ",RS.ImageFilterSamplesTooltips="XZZ",RS.FactoryResetPrompt="XPB",RS.Help_AddCSSRuleMessage="XYR",RS.YouMustLoginToExportEvents="XM4",RS.VideoNotFound="Xcd",RS.QualityPercent="XP0",RS.Content="XJj",RS.Tooltips_ShowMainToolbar="XGU",RS.Tooltips_AlignCenter="XCZ",RS.PleaseSpecifyADestinationDirectory="XGr",RS.DestinationNotValid="XQa",RS.BackupKeyManagerTitle="XfW",RS.InvalidWidgetStructureForUndo="XTR",RS.BackupSyncFilesActionTooltips="X1u",RS.Static="Xsy",RS.Tooltips_ToggleShowHex="XmL",RS.Tooltips_Opacity="X2Z",RS.NotExists="Xk7",RS.dash="XW4",RS.EditAlign="Xrb",RS.LiteOperationDrawingCanvasNotAvailable="XeJ",RS.EnterBackupFilePasswordForRestore="XqX",RS.TakePhotoOK="Xib",RS.action_restore="XH9",RS.Weight="Xhp",RS.RequirePassword="XFG",RS.InvalidFilepath="Xxc",RS.invalidFileExt_="XbW",RS.Tooltips_Reset="XaW",RS.PickFiles="XJN",RS.LitePanelNotAvailable="XPJ",RS.HighlightColor="XLV",RS.DropTextCopiedToClipboard="XHE",RS.ErrorSavingRecentsList="XrI",RS.action_EditLink="X4S",RS.Tomorrow="XDL",RS.DestinationIsADirectory="XuI",RS.CannotDeleteNonEmptyDirectory_="XXK",RS.LiteOperationRecordAudioNotAvailable="XPR",RS.YouMustLoginToClearEvents="X4K",RS.destructWidget="XMg",RS.UnexpectedException="X8u",RS.MissingOperandFor_="XcC",RS.ActionRequireASingleElementSelection="XIY",RS.Theme_Light="Xe4",RS.Tooltips_EditEvent="XaU",RS.deletedEverything="Xxs",RS.TemplateShoppingTitle="Xlx",RS.LeftAndRightSplitpanelAlreadyExistsAbort="Xvb",RS.ConfirmCreateDestinationDirectory="XbB",RS.IllegalArguments="XDa",RS.FloatRight="X2Q",RS.SourceNotReadable="XS4",RS.Pending="XEu",RS.ErrorCreatingDocumentFromTemplate="X6t",RS.MissingPathParameter="X5F",RS.ActionRequirePermission_="Xdb",RS.Positioning="X12",RS.Tooltips_Gradient="Xjg",RS.Help_GalleryItemThreshold="XeU",RS.RecentsNoMoreHistoryAvailable="XbY",RS.CannotRepositionResizeOrRotateElement="X14",RS.Tooltips_Up="Xod",RS.AudioRecordingStopFailed="XRw",RS.LiteOperationTakePhotoNotAvailable="Xow",RS.InsertLinkTitle="XIi",RS.ErrorClearingEvents="Xd5",RS.NoEnclosingBlockElementFound="Xh0",RS.EditText="Xd0",RS.CannotRenameToSelf="XVI",RS.FixPerspectiveUncroppedSize="Xnv",RS.NothingToDelete="XwX",RS.Tooltips_DocumentLinks="X5a",RS.Tooltips="XcX",RS.Tooltips_ShowWhitespaceNodes="Xy7",RS.FilepathInputMustNotBeEmpty="XWa",RS.Shrink="Xik",RS.LeftAndRightSidepanelAlreadyExistsAbort="Xj2",RS.Tooltips_Keyboard="XWY",RS.Tooltips_RemoveBrokenEntries="XrZ",RS.ScribblerMore="XuL",RS.Tooltips_Recover="X4q",RS.AssertInvalidStateForUndo="X60",RS.CorrectionOptionCorrectPerspectiveCrop="XFY",RS.action_InsertParagraph="XBh",RS.Tooltips_CopyFileOrDirectory="XK8",RS.BackdropFilter="XR9",RS.Backspace="XZn",RS.destinationNotWritable_="XnD",RS.Removed="XxT",RS.PromptCopyNotWritable1="XD4",RS.Relative="XPV",RS.Tooltips_RenameFileOrDirectory="XbV",RS.Tooltips_ToggleNobackup="Xrd",RS.ConfirmRestoreIncrementalBackupFrom_="XUI",RS.InvalidLineNumber="XLP",RS.NoImageFound="XSr",RS.action_resetSettings="XH7",RS.RestoreEventsOK="XZu",RS.Audio="X44",RS.Tooltips_CloneObject="XDK",RS.Tooltips_Indent="XBo",RS.NotADirectory_="Xm5",RS.ActionRequireAValidSelection="XN7",RS.LiteOperationLocalSearchNotAvailable="XFC",RS.AudioRecorderMaxDurationReached="XZ2",RS.Test="XwI",RS.ExpectingCSSExt_="XjL",RS.PromptCopyInvalidClipboardContent="Xri",RS.Tooltips_ColorDodgerBlue="XO8",RS.action_InsertCalendar="Xi1",RS.Undo="XOd",RS.Tooltips_CreateCalendarEventsBackup="XT9",RS.NoEnclosingDivOrPElementFound="XQ9",RS.action_InsertNbsp="Xs4",RS.history_text="XFW",RS.CopiedToLocalAndSystemClipboard_="X1r",RS.Tooltips_MakeListCompact="Xdl",RS.MapSize="Xlo",RS.ExportDataOK="XuR",RS.Scroll="Xfx",RS.deleteFile="X4u",RS.widgetFlexboxTitle="X9T",RS.Tooltips_DocumentSettings="X84",RS.AudioRecordingAlreadyInProgress="XvB",RS.Tooltips_ColorRed="XBc",RS.PromptCopyCancelled="XeE",RS.InvalidSidebarStructure="Xck",RS.InvalidURL_="XMa",RS.ConfirmRemove_Event="XYv",RS.Recursive="Xmb",RS.GameStateSaved="Xmj",RS.SpecifiedFileAlreadyExistsPleaseTryAgain="XNS",RS.ScribblerShift="XvK",RS.ExpectingPDF="XrH",RS.action_PasteChild="Xtd",RS.Tooltips_Toolbar="Xx4",RS.ErrorDecodingAnnotation="XSj",RS.Transform="Xyh",RS.ErrorFindingFiles_="X2t",RS.InvalidUriChar_="XOg",RS.AlreadyAtTopLevel="XL6",RS.PlaceholderRequiredDuration="XRg",RS.InsertAudioTitle="XZS",RS.RepeatEvents="X67",RS.FactoryResetOptionTItle="XVy",RS.ErrorListingDirectory_="XQs",RS.action_MoveToPrev="XsY",RS.Image="Xii",RS.PromptSidebarTabTitle="XhP",RS.Tooltips_AlignRight="Xi8",RS.NoNextPage="X90",RS.Tooltips_SwapPositionWithPrevSibling="XLu",RS.BorderLeft="XyD",RS.app_name_x="XyV",RS.Tooltips_FloatRight="X2c",RS.Filter_invert="Xpt",RS.RestoreEventsFailed="XnF",RS.Rules="Xmv",RS.widgetPictureFrameTitle="XAN",RS.TakePhotoFailed="X79",RS.Tooltips_ToggleKeyboard="Xcz",RS.AudioPlaybackAlreadyInProgress="X27",RS.Tooltips_ImportEvents="XA1",RS.LiteOperationRecordVideoNotAvailable="Xq3",RS.TextIsRequired="XaA",RS.Cancel="XMB",RS.AnUrlValidatorIsRequired="XzX",RS.DeleteFailed="X7I",RS.Tooltips_SpawnSibling="XDV",RS.SourceIsADirectory="Xle",RS.FormatActionError="X2u",RS.GradientRadialCircle="X7M",RS.GameStateRestored="XWj",RS.WxH="XKk",RS.Overwriting="XvL",RS.Tooltips_Filterbar="XFH",RS.Copied1file="XY9",RS.Tooltips_DrawText="Xxx",RS.Cornering="XwR",RS.BackupPleaseSpecifyABackupFile="Xvt",RS.BackupKeyManagerTooltips="XBe",RS.InsertTextHere="XBt",RS.Tooltips_ExportToFile="X4c",RS.RepeatPassword="Xyu",RS.Tooltips_Symbols="XgC",RS.invalidImageExt_="Xjj",RS.Tooltips_EditNode="XPc",RS.FilenameMustBeEmpty="XOJ",RS.CopyOK="Xlh",RS.Tooltips_NextMatch="XOw",RS.Tooltips_PasteFromLocalClipboard="XOy",RS.VideoRecordingFailed="XMn",RS.OnlyUrlWithPathQueryFragmentPartsIsAllowed="Xnw",RS.StrokeColor="Xb8",RS.FontStyle="XP3",RS.PickDir="XMG",RS.InvalidSalt="XVP",RS.YouWin="XEH",RS.action_EditStyle="X9r",RS.Filename="XJo",RS.ReadingPassEndOfFile_="XVO",RS.Thumbnail="Xr7",RS.Help_GameMines="Xuq",RS.Tooltips_InsertLinebreak="X8C",RS.UnsupportedOutputFormat_="XLb",RS.PleaseSpecifySearchText="XRS",RS.ErrorWritingImage_="XCe",RS.widgetAnnotationImageTitle="XuJ",RS.ErrorSavingImage="XOA",RS.Tooltips_NextPage="XW1",RS.history_templateStyleAction="Xzq",RS.InvalidKeyAlias="XTr",RS.InvalidPath="XtN",RS.PlaceholderRequired="XYX",RS.APrevPageLinkAlreadyExists="XkX",RS.Tooltips_Underline="XGt",RS.Tooltips_GameMines="XuM",RS.Width="XAA",RS.InsertElementTitle="XIN",RS.ContextmenuNotAvailable="XLi",RS.InvalidKeyLength_="Xzb",RS.PromptCanvasTitle="X0H",RS.Left="XvP",RS.ExportCancelled="Xkf",RS.Link="XDQ",RS.EditStyleTitle="XSG",RS.InvalidURL="XKv",RS.MissingOutputImageSizeInfo="Xtj",RS.AddCSSRuleTitle="X1x",RS.InvalidInput_="Xp3",RS.Tooltips_ExportButton="XUn",RS.Tooltips_ExportZip="XZg",RS.Tooltips_NewDocument="X8r",RS.ScribblerBackground="XOU",RS.Tooltips_Subscript="XHq",RS.Tooltips_StartEditing="Xok",RS.InvalidRotation_="XQh",RS.CropTooltips="XmA",RS.Confirm="XSV",RS.Tooltips_KeywordSearch="Xi9",RS.Tooltips_Restore="Xxg",RS.BackupKeyOK="X7t",RS.Padding="XTG",RS.EditLinkTitle="X09",RS.Position="XFp",RS.widgetSlideshowInvalidSelection="XgK",RS.ErrorPostingEvent="Xf6",RS.FontSample="Xlc",RS.Cells="X93",RS.Tooltips_EditDrawingHistory="XXH",RS.Tooltips_SelectAnAreaForImport="XxH",RS.Monospace="Xnk",RS.NoImageInfoAvailable="Xcc",RS.LiteOperationGlobalSearchNotAvailable="Xaj",RS.action_EditAlign="Xgk",RS.Tooltips_SaveAndQuitEditing="X6L",RS.TemplateHomeTitle="XDr",RS.InvalidExpression="Xll",RS.Tooltips_RegexSearch="XeM",RS.AddStylesheetTitle="XBL",RS.Tooltips_ToggleShowBrokenLinksOnly="XCp",RS.PlaceholderOptional="XUm",RS.AlarmsPending_="XDu",RS.ScribblerPolycurve="XT2",RS.Tooltips_CreateOrOpenDocument="XCk",RS.On="Xtt",RS.BackupRestore="Xc7",RS.ClientActionClassesTitle="XWO",RS.Grow="XL8",RS.InsertCalendarTitle="XGF",RS.DocumentSaved="XCq",RS.Tooltips_DeleteFileOrDirectory="X3I",RS.ActionRequireASingleImgElementSelection="X7b",RS.action_List="XLt",RS.VideoQualityDefault="X9M",RS.failedToCreateElement_="X7G",RS.ADelegateIsRequired="Xab",RS.URL="X7l",RS.SaveAs="XAB",RS.FailedToCopy_="XTQ",RS.Tooltips_ShowInitialSelection="XdE",RS.ConfirmUnlinkDefaultStylesheet="Xgr",RS.ErrorGettingEvents="Xlb",RS.Tooltips_ColorGray="X7p",RS.Exported_OK="XQp",RS.AudioRecordingStopOK="XJk",RS.DropTargetInvalid="Xpa",RS.ImageDimension="XhR",RS.Subject="X4P",RS.Tooltips_CutToLocalClipboard="XRh",RS.Tooltips_ImportAudio="X2n",RS.InvalidFileKind_="X8M",RS.Tooltips_ResizeCanvas="X6c",RS.FailedToEncryptData="XKU",RS.Tooltips_Cancel="XIh",RS.promptDimensionMessage="XLB",RS.RestoreKeysPasswordMessage="XUr",RS.ImageURL="Xfi",RS.ErrorDeleting_="XyK",RS.StylePropertyNameInvalid_="Xub",RS.Assists="Xjm",RS.widgetTodoDesc="XBE",RS.NotExists_="XoM",RS.action_ListText="Xl3",RS.invalidFilepath_="X4f",RS.Scribbler_ExportImageOK="XRP",RS.ErrorParsingStyle="XFn",RS.ChangePasswordMessage="XMV",RS.Theme_Dark="Xb1",RS.InvalidValue_="XEy",RS.Tooltips_AddBorder="XVR",RS.Tooltips_GoBackInHistory="XU8",RS.UnsupportedImageFormat_="XBP",RS.ErrorCreatingCacheFile="Xmp",RS.InsertVideoTitle="Xav",RS.action_CharStyle="XC1",RS.Tooltips_RemoveLink="X2L",RS.DestinationMustBeADir="Xfq",RS.ExpectingUrlWithoutQueryOrFragment="XID",RS.UIFont="XsI",RS.Tooltips_ShowBackground="XXW",RS.Scribbler_GridTitle="XM2",RS.Tooltips_FontStyles="XN2",RS.Recover="XKZ",RS.CutOK="Xyp",RS.License="XW8",RS.ScribblerPolygon="XJy",RS.Tooltips_RotateElement="Xpk",RS.history_attributes="Xfs",RS.TemplateContextNotFound="X9B",RS.InvalidImagePath_="X6s",RS.Tooltips_SwapPositionWithNextSibling="Xvd",RS.ConfirmDeletingEmptyTextNodeOnBackspace="Xn2",RS.Tooltips_SortAlphaAsc="XnR",RS.Direction="XCl",RS.YouMustLoginToRestoreData="XXi",RS.Tooltips_Games="XtF",RS.PromptDateTimeTitle="XH5",RS.Absolute="Xra",RS.ErrorCreatingDirectory_="Xko",RS.NothingToFormat="XJU",RS.Tooltips_Logout="XEX",RS.ErrorSavingStylesheet="XY6",RS.FilenameMustNotBeNull="XVU",RS.Tooltips_ListItemWithDateBullet="XDp",RS.UnsupportedFileType_="Xkq",RS.BackupFile="Xkc",RS.InvalidDirectoryName_="X19",RS.BarcodeNotFound="XxO",RS.PasswordNotMatch="XrF",RS.Tooltips_GotoTargetDocumentDirectory="XRd",RS.PleaseSpecifyAnImageUri="Xsf",RS.actionRequireOneOfTheFollowingTags_="X2C",RS.Tooltips_ListItem="Xo9",RS.InvalidCSSStyle_="XqE",RS.Tooltips_ListItemWithSymbolBullet="XMQ",RS.ExpectingSimpleFilename="Xns",RS.CreateLoginMessage="XAZ",RS.Correction="X4G",RS.RestoreDataOK="X50",RS.RepeatMonthlyMarker="XLQ",RS.ErrorDeletingDirectory_="XHI",RS.ExportToPhotoLibraryOK="XWs",RS.PleaseLoginToProceed="XBO",RS.InvalidDimensionAbort="Xdf",RS.Dimensions="XHa",RS.VideoQualityLow="X3b",RS.Border="XXs",RS.UnsupportedFileType="Xb4",RS.AnnotateImage="Xvi",RS.InvalidRegex_="XMK",RS.NoMatchFound="X6Q",RS.SearchFromStart="XgO",RS.widgetAnnotationTitle="Xui",RS.TemplateTodoTitle="XRr",RS.Scale="X54",RS.InvalidDataUrl="XBf",RS.BGImageURL="XO9",RS.widgetFlexboxStyleImage="XPt",RS.PromptScribblerHistoryTitle="XkH",RS.SanitizeActionError="XGo",RS.ColorHeading="Xg0",RS.PleaseSelectAFileToOpen="XpW",RS.ChangePasswordFailed="XTq",RS.RepeatOffMarker="X5T",RS.Tooltips_ExportDirectoryAsZip="XpS",RS.Tooltips_DrawEllipses="X2j",RS.FillColor="X3x",RS.PromptFilepathTitle="XIK",RS.ConfirmBackupKeyTo_="Xjc",RS.RestoreCancelled="XAW",RS.BoxShadow="XXC",RS.Tooltips_Save="X1e",RS.Tooltips_OtherActions="Xyb",RS.ThereIsNoNextSibling="Xc5",RS.found_items="XM7",RS.FilenameMustNotEndsWithSpaces="XOi",RS.SourceNotValid="XGf",RS.ImportEventsOK="Xe3",RS.action_alarm="XHG",RS.ErrorUpdatingEvents="XZW",RS.ErrorCopyingAssets="XF2",RS.ResetToFactoryDefaultOK="Xq0",RS.ExpectingAudioExt="XpA",RS.Tooltips_Edit="Xuj",RS.Alarm="XbG",RS.FailedToEncrypt_="XO3",RS.ImageNotFound_="Xv9",RS.Tooltips_ToggleZoom="Xsb",RS.Tooltips_CanvasActions="XWG",RS.URLExpectingAnImageExt="XVL",RS.Tooltips_ExportToBackupDirectories="Xnd",RS.MissingCSSRuleParameter="XD8",RS.ImageFilter="X8l",RS.VideoRecordingAlreadyInProgress="X3D",RS.ScribblerCurve="XNj",RS.Tooltips_SelectParent="X1l",RS.GradientRepeatingLinear="X1b",RS.Tooltips_SidebarTemplates="Xyo",RS.PlaceholderRequiredHeight="X0m",RS.TemplateNotesTitle="X4e",RS.Tooltips_Clear="XoA",RS.action_EditTextNode="XCz",RS.BarcodeGenerateTooltips="XBk",RS.InvalidBackupArchive="XOX",RS.Tooltips_MoveUpAsNextSiblingOfParent="XZr",RS.NotDeletingNodeOnBackspace="Xje",RS.Tooltips_EditLink="XPj",RS.Filter_grayscale="X3t",RS.Tooltips_Print="XiG",RS.Filter_sepia="XRq",RS.ExpectingHtml="XFa",RS.PleaseWaitWhileIndexerIsBusy="X36",RS.ColorStops="XFq",RS.RepeatWeeklyMarker="XGC",RS.IllegalPasswordCharacter="Xhr",RS.ReachedStartOfDocument="XFf",RS.Dirs="X2p",RS.AudioPlaybackFailed="X9h",RS.Tooltips_PathKind="Xo2",RS.ErrorSavingImageData_="XGA",RS.UnsupportedMutationRecordType_="Xq1",RS.Tooltips_InsertText="Xe5",RS.widgetSplitpanelTitle="Xdg",RS.Tooltips_TextHighlight="Xeq",RS.UnsupportedBackupArchiveVersion_="XpZ",RS.Tooltips_Filter="XNB",RS.Tooltips_ShowKeyboard="XJQ",RS.Tooltips_ListUnordered="XRF",RS.LoginCredentialIsCorrupted="XAS",RS.Tooltips_Down="Xy4",RS.Tooltips_ImportExportCopy="Xvj",RS.AudioUsingSampleAsPlaceholder="Xog",RS.Tooltips_DrawRectangles="XKY",RS.app_name_beta="Xpg",RS.Zoom="Xpm",RS.NotCopying="XXQ",RS.Tooltips_OK="XUF",RS.Tooltips_Remove="XXh",RS.Tooltips_SelectAnAreaToExport="XQy",RS.Help_RestoreDataFilepicker="XWx",RS.CreateDirectoryFailed_="XCX",RS.ImportImageCancelled="X7g",RS.Tooltips_RecentsPanel="XhF",RS.DocumentIsNotEditable="Xto",RS.NoPreviousSiblingFound="XRB",RS.ErrorLoading="XhU",RS.YouMustLoginToPerformThisAction="Xqy",RS.TemplateMarkerNotFound="XHo",RS.Tooltips_Info="Xz6",RS.BGColor="XD2",RS.Tooltips_AlignLeft="XsU",RS.Filter_opacity="XMS",RS.action_ToSpace="XYO",RS.InvalidIntegerValue="Xpw",RS.Duration="XoL",RS.ConfirmDeletingPrevPageLink="Xit",RS.Tooltips_CreateFullDataBackup="Xk8",RS.LoginOK="X1Q",RS.dotted="X5D",RS.widgetSampleLink1="Xv2",RS.SourcePath="Xy8",RS.Tooltips_SearchRegex="XpB",RS.ErrorReadingBackup="XOQ",RS.Tooltips_ShowImageInfo="XG5",RS.Operator="Xoa",RS.TemplateInventoryTitle="XtC",RS.InvalidColor_="X0d",RS.PlaceholderRequiredText="XI7",RS.ConfirmDeletingEmptyDirectories="Xop",RS.Tooltips_EscapeText="X8P",RS.Tooltips_Superscript="XGx",RS.BorderBottom="XvO",RS.Tooltips_PasteAsNextSibling="X6Y",RS.Scrollable="X42",RS.Tooltips_PreviousMatch="X3p",RS.ActionClearHistoryMessage="XEw",RS.Tooltips_PickColor="XWH",RS.Borders="XlQ",RS.RedirectedToHomePage="XBi",RS.CreatedThumbnail="XJr",RS.ConfirmClearEvents="X9g",RS.Tooltips_Home="Xti",RS.TextColor="XSE",RS.Restore="XnT",RS.RecognizeTextTooltips="XyC",RS.CalculationContextNotFound="XXX",RS.Tooltips_ColorPlum="XpV",RS.action_EditIMG="Xmo",RS.ANextPageLinkAlreadyExists="Xgo",RS.DestinationParentDirectoriesCreationFailed="XAk",RS.Tooltips_InsertObjects="X5m",RS.InvalidOutputPath_="XFb",RS.Descending="X3P",RS.widgetAnnotationStyleImage="Xh9",RS.Tooltips_ClearSearchText="XX3",RS.FactoryResetOption3="Xt6",RS.action_InsertImage="X3u",RS.action_DestructSidepanel="X3v",RS.ConfirmAction="X0l",RS.MissingParameter_="X5k",RS.RoundCorners="XtI",RS.Size="XTO",RS.widgetAnnotationStylePhoto="XED",RS.Tooltips_Dismiss="Xmi",RS.FileNotFound="XUC",RS.FileNotFound_="XBQ",RS.UnsupportedTag="X0Q",RS.Tooltips_Rotate="XhM",RS.True="Xv8",RS.Tooltips_ListOrdered="XGY",RS.Tooltips_PickFromSamples="XZ9",RS.Description="Xv6",RS.ColorAnnotation="X9Q",RS.ErrorLoadingDocument="XTC",RS.Tooltips_ImageConversion="XT5",RS.GradientRepeatingRadialEllipse="XcN",RS.FailedToChangePassword="Xa2",RS.CreateAPasswordLoginWithTheLoginAction="XtD",RS.DestinationNotWritable="Xa4",RS.LinkURL="XWv",RS.VideoRecordingOK="XEg",RS.EditDrawingTitle="XZw",RS.InsertVideoTooltips="Xz9",RS.AssertUnsupportedOperation="Xob",RS.SelectedNodeIsNotEditable="XPG",RS.ImageNotFound="Xm1",RS.action_Spawn="X1E",RS.Tooltips_EditStyleAsRawText="Xpp",RS.Horizontal="XQG",RS.Tooltips_CreateIncrementalDataBackup="X5j",RS.placeholderImportImageDimension="XTK",RS.CannotDeleteTopOrRootDirectory="X4v",RS.SingleSection="XVh",RS.action_ListSymbol="Xmy",RS.Help_BackupFilepicker="XYK",RS.DropActionNotSupported="XfJ",RS.BackgroundImageSamplesTooltips="X9i",RS.Tooltips_BorderThick="Xaw",RS.Tooltips_GameSudoku="X06",RS.Tooltips_InsertImageElement="XZN",RS.BackupCancelled="X26",RS.RestoreKeysPasswordErrorMessage="Xl4",RS.PickSymbol="X5Z",RS.ExportFailed="Xzv",RS.Tooltips_PreviousBlog="XHM",RS.AssertSettingsMustNotBeNull="XY1",RS.action_AnnotateCanvas="XfD",RS.GradientLinear="XKS",RS.DirectoryMustUnderHome="Xhb",RS.action_ListDatetime="XPW",RS.InvalidSelection="XHS",RS.InvalidFilepickerCommand_="Xgp",RS.ErrorUpdatingSettings="Xk6",RS.ActionRequireACollapsedSelection="XlP",RS.failedToCreateDirectory_="XGb",RS.ImageAnnotator_ConfirmClearMessage="XmS",RS.Tooltips_MakeListNotCompact="X2X",RS.ToasterHolding="Xnt",RS.Clear="XWE",RS.Copying="X1I",RS.Recents="XWl",RS.ConfirmBackupEventsTo_="Xus",RS.ThereIsNoInitialDocumentSelection="Xwn",RS.Both="Xrc",RS.RecipientsSelf="XtX",RS.action_DestructSidebarTab="Xr0",RS.Tooltips_InsertParagraph="XZ0",RS.HistoryIgnore="XNp",RS.HistoryNoGroup="XNgp",RS.ErrorSaving="Xca",RS.FailedToEncryptKeys="X1p",RS.TextAlign="XYb";RS.action_changePassword="XQH",RS.Tooltips_CreateEvent="X4D",RS.Tooltips_WidgetTemplates="XtS",RS.NotFound="XXc",RS.ChangePassword="Xgd",RS.Resize="XuA",RS.Tooltips_ExtendSelection="Xqz",RS.Attributes="XvU",RS.InvalidOperator="XPd",RS.Tooltips_StopAudioPlayback="Xza",RS.SamplePerSecond="XjP",RS.ExpectingImageMime="XbL",RS.Tooltips_ShowOrHideDoneEvents="Xbq",RS.BarcodeKindQRCode="XOk",RS.ErrorDeletingFile_="X5y",RS.Attachment="Xp4",RS.HtmlAttributeInvalid_="Xlf",RS.InsertImageTitle="XJh",RS.action_MoveToNext="XUQ",RS.Tooltips_RecordAudio="Xct",RS.Tooltips_Calculator="XTa",RS.InvalidImageFileExt_="Xcu",RS.AreYouSureYouWantToCheat="Xxp",RS.EnterFilepath="XC4",RS.Tooltips_RemoveRuleset="XcL",RS.RecipientsAll="XoQ",RS.TimeFormat="XGj",RS.ScribblerImage="XA8",RS.min="X1F",RS.ContentNotMovable="X0Z",RS.InvalidPath_="XvR",RS.ERROR="XSU",RS.NoEnclosingElementFound="XSn",RS.PromptDimensionTitle="X4l",RS.Tooltips_DocumentStylesheet="XJH",RS.MediaTypeNotSupported="XOH",RS.action_ParaStyle="XvQ",RS.ClientActionClassesPlaceholder="XvJ",RS.TakePhotoAlreadyInProgress="XOf",RS.Tooltips_ImportPDF="Xce",RS.action_AddBorder="X2y",RS.Tooltips_ImportImageToTheSpecifiedPath="XSb",RS.day="XnK",RS.Tooltips_AddLink="XRL",RS.AnElementValidatorIsRequired="XIS",RS.Tooltips_AnnotateImage="XrB",RS.AudioRecorderMaxFileSizeReached="Xsa",RS.Tooltips_Today="X1S",RS.Boxes="Xgw",RS.Tooltips_MoveFileOrDirectory="XaJ",RS.NoMoreMatches="XS8",RS.ConfirmDeletingRecursively="Xb9",RS.Category="XVE",RS.ActionOnlyWorksWhenCurrentDocumentIsABlogPage="XRe",RS.ClientActionClassesLabel="Xvl",RS.TnHeight="Xbg",RS.action_backup="X0N",RS.Moved_files="X3O",RS.FactoryResetMessage="XKs",RS.ClickToDismiss="XM8",RS.TextBullet_Title="X1c",RS.Today="Xjx",RS.Tooltips_PasteAsFirstChild="XNR",RS.ResetSettingsOK="Xuo",RS.RepeatOnceMarker="XXj",RS.Tooltips_Settings="XP1",RS.NoMoreCheats="Xbp",RS.Tooltips_PickFile="XaX",RS.Tooltips_EditRuleset="XUx",RS.action_InsertElementSibling="XM9",RS.NotDeleting_="Xfp",RS.ResetSettingsCancelled="Xr8",RS.Directory="X3o",RS.BitPerSecond="Xg1",RS.Tooltips_Discard="XS6",RS.Scribbler_MissingSourceImage="XAb",RS.Tooltips_MoveDown="XXT",RS.Crop="X2v",RS.LicenseNotValid="XOj",RS.SourceDirectory="XeG",RS.DirectoryNotExists_="XVc",RS.Mime="X4E",RS.CreateEventTitle="XGv",RS.RecentsInvalidCommand="XXU",RS.history_templateButtonAction="XB5",RS.Height="Xy0",RS.editLinkMessage="Xw8",RS.Tooltips_ConvertSpacesToNonBreakSpaces="XMd",RS.Tooltips_ParagraphStyles="XV2",RS.Tooltips_RemoveStyles="XSt",RS.YouMustLoginToBackupData="XEd",RS.NoMoreChild="XuQ",RS.solid="XPE",RS.StyleEditorHint="XaI",RS.widgetTodoTitle="XHm",RS.ConfirmCreateIncrementalBackupTo_="X6I",RS.AudioRecordingTitle="XQQ",RS.Weekdays="Xml",RS.Tooltips_ConvertNonBreakSpacesToSpaces="Xbd",RS.ImportImageTitle="XPI",RS.EditElementTitle="XQn",RS.Tooltips_Undo="Xf7",RS.history_node="XQk",RS.ImportImageFailed="XN5",RS.Tooltips_CreateDirectory="Xcg",RS.Tooltips_SidebarExplore="X4H",RS.Gradient="X1o",RS.Tooltips_PreviousPage="XA6",RS.action_ToNbsp="X3z",RS.FailedToWriteTo_="XU9",RS.ClientActionClassesDeleteTooltips="XyY",RS.DeselectAll="Xpy",RS.Float="XDi",RS.action_UpdateVideoInfo="XSX",RS.Tooltips_GenerateGallery="XNf",RS.PleaseSpecifyAnImageId="XyG",RS.BackupEventsOK="X20",RS.insertElementFailed_="Xbm",RS.Tooltips_ShowContextmenu="XKm",RS.Tooltips_DrawCurves="XVC",RS.Tooltips_ImagePicker="X8L",RS.ActionRequireASingleImgOrCanvasElementSelection="XYA",RS.VideoQualityMedium="XWh",RS.BorderRight="X51",RS.ConfirmSaveOrDiscard="XBy",RS.ConfirmDiscard="X3h",RS.EnterBackupFilePasswordForBackup="XcU",RS.InvalidOperand="XkT",RS.RepeatDailyMarker="XMP",RS.FailedToRead_="XlB",RS.ImportImageOK="Xtk",RS.RotationDeg="XQc",RS.Tooltips_PasteFileOrDirectory="XuO",RS.Rotate="XyW",RS.ScribblerEllipse="XT1",RS.Tooltips_FilepathFilter="X5b",RS.SourceNotAFile="XJt",RS.Filter_dropShadow="XLY",RS.TakePhotoCancelled="XAO",RS.StickOnDocument="X4x",RS.VideoUsingSampleAsPlaceholder="Xy6",RS.EnterLoginPassword="XeC",RS.ms="XQT",RS.Tooltips_PasteAsChild="Xm2",RS.widgetTocTitle="Xg6",RS.Enable="Xj5",RS.Tooltips_ColorPicker="XjG",RS.Tooltips_Move="XTo",RS.elementNotEditable_="XaK",RS.Tooltips_RebuildKeywordSearchIndex="XQ1",RS.Tooltips_ShiftCanvas="Xwh",RS.Orientation="Xld",RS.GalleryUpdateFailed="XUA",RS.Tooltips_SearchFilename="XJf",RS.Tooltips_ListWithoutBulletAndIndent="Xul",RS.CopiedToSystemClipboard_="XA4",RS.Tooltips_GoForwardInHistory="Xnc",RS.widgetSlideshowNoImageFound="XAr",RS.Imported_OK="Xj8",RS.SaveOnPauseTitle="Xj3",RS.FGColor="XrO",RS.EMPTY="",RS.Rotation="XdO",RS.action_InsertAudio="Xst",RS.Tooltips_InsertDateTimeString="XdL",RS.action_InsertLink="XiB",RS.Tooltips_InsertNonBreakSpace="Xxb",RS.SaveOnPauseMessage="Xeu",RS.action_UpdateAudioInfo="X8z",RS.Result2="XUR",RS.ChangesNotPersistedToStylesheetFile_="XQz",RS.AssertMultiSelectionMustBeUnderTheSameParent="X0M",RS.DestinationFile="X2x",RS.DocumentChangesDiscarded="Xnb",RS.Tooltips_QuitWithoutSave="XWq",RS.YouMustLoginToImportEvents="Xp8",RS.Tooltips_CreateElement="XpJ",RS.Tooltips_PasteSymbol="Xrt",RS.Tooltips_SidebarDocument="XbN",RS.StylesheetSaveOK="X6q",RS.action_Drop="Xmq",RS.TemplateMemoTitle="X87",RS.Copy_="XSo",RS.Tooltips_ExpandAll="XX0",RS.AsIs="XYx",RS.PleaseWaitWhileProcessingData="XTM",RS.MissingBaseurlParameter="X1W",RS.ButtonSize="XAa",RS.Text="XNt",RS.WidgetNotFound="Xlw",RS.Tooltips_RelativePath="XQb",RS.Bottom="Xm3",RS.widgetAnnotationStyleHBox="XDN",RS.Tooltips_DestructWidget="XCW",RS.action_recording="Xsc",RS.deleteEverythingUnderDirectory="X2r",RS.SourceNotWritable="XrL",RS.Tooltips_EditNodeAsRawText="Xkw",RS.ValueMustBe0To100="XnB",RS.Copied_files="Xfw",RS.GameHistoryIsFull="XCO",RS.history_calcTotal="Xel",RS.PlaceholderRequiredWidth="XyU",RS.BackdropBlur="Xom",RS.PleaseSpecifyAFilename="Xzg",RS.widgetStickerStyleBadge="XSy",RS.NoSuchAlgorithm_="Xke",RS.Disallow="XA7",RS.Tooltips_FloatLeft="XuB",RS.Tooltips_ColorBlue="XXp",RS.FactoryResetOption1="XGP",RS.EditBGImageMessage="X0E",RS.MatchFound="XqS",RS.Tooltips_CutFileOrDirectory="Xew",RS.action_memoryInfo="XJW",RS.Tooltips_Italic="XNC",RS.ChangePasswordCancelled="Xz7",RS.AudioChannels="Xek",RS.LiteOperationNotAvailable="Xas",RS.FilenameMustNotBeEmpty="Xvw",RS.ExportOK="XTW",RS.NoPrevPage="Xv1",RS.ClipboardIsEmpty="XLI",RS.Tooltips_GotoInitialDirectory="Xqc",RS.EditAbortedTitle="XUN",RS.TnWxH="XK2",RS.MissingInputImageSizeInfo="X4g",RS.Tooltips_OpenOrAddPage="X47",RS.Filter_contrast="Xk9",RS.UnsupportedAudioFormat_="Xk1",RS.Tooltips_DrawPolylineOrPolygons="X6F",RS.InvalidDestination="XWm",RS.EditSpacingMessage="XRW",RS.PleaseSelectAnItemForTheAction="Xgz",RS.PromptCanvasMessage="XXz",RS.action_EditElement="X61",RS.ExportPublicKeyForSelf="Xh6",RS.InsertSymbolTitle="XjA",RS.DragPinchClick="XZF",RS.Tooltips_UndoHistory="XIV",RS.Months="XX7",RS.Tooltips_PickFont="XlY",RS.Corner="XsL",RS.Top="XlN",RS.ConfirmDiscardPhoto="Xmf",RS.TargetNodeNotExists="XgN",RS.SizePosition="Xdx",RS.AudioRecordingNotInProgress="XSi",RS.FailedToDecryptKeys="XdF",RS.Layer2="X0L",RS.imageDimensionLimit_="XOq",RS.InvalidDocument="X7k",RS.ScribblerExport="XgG",RS.Tooltips_ShowInfo="Xfk",RS.Tooltips_ColorOrange="XMv",RS.ConfirmRemove_Events="XGE",RS.Tooltips_More="XbK",RS.Tooltips_CreateKeysBackup="X4J",RS.ConfirmRestoreEventsFrom_="X1C",RS.Tooltips_ImportImageFile="XVw",RS.Date="XR1",RS.action_DestructFlexbox="XbH",RS.GameSaved="X8i",RS.TnSize="X0z",RS.NoNextSiblingFound="X5o",RS.ActionCancelled="X8b",RS.ReplaceSymbolTitle="XbE",RS.MissingImageMimeTypeParameter="Xps",RS.hour="Xfd",RS.action_InsertLinebreak="XmU",RS.ImportEventsFailed="XCJ",RS.FactoryResetOK="XBF",RS.RepeatYearlyMarker="Xpf",RS.StylesheetNotExists="XR7",RS.Tooltips_EditAlignments="Xcf",RS.ActionNotPermitted="XTb",RS.Vertical="X4s",RS.Tooltips_ResetUserSettings="XwG",RS.PlaceholderRequiredFilepath="XB9",RS.action_Cut="XBs",RS.False="XZY",RS.Tooltips_AnnotateImageOrCanvas="XNl",RS.Tooltips_ImportFromPhotoLibrary="Xhy",RS.Tooltips_CharacterStyles="XUh",RS.AudioNotFound="XAd",RS.RepeatWorkdaysMarker="Xk0",RS.EASY="Xb3",RS.CSSSyntaxError_="Xbo",RS.RowHeight="Xqd",RS.FailedToInitCipher="XMb",RS.CannotCopyToSelf="XbQ",RS.action_Reposition="X2o",RS.widgetAnnotationTypeDefault="XIE",RS.MissingURIParameter="Xpl",RS.action_MoveToParent="XNw",RS.Tooltips_InsertAsFirstChild="Xt4",RS.SourceNotDeletable="XAg",RS.inputMustNotBeEmpty_="Xhh",RS.ReplacedSymbol_="XFV",RS.Tooltips_ListItemWithTimeBullet="XY2",RS.Tooltips_RootFolder="X6G",RS.Tooltips_PickImage="XCS",RS.Tooltips_ColorDarkBlue="Xt5",RS.DivideByZeroError="Xup",RS.GradientFarthestCorner="Xwc",RS.BorderTop="XAe",RS.WildcardSearch="XX1",RS.Tooltips_NewGame="XQX",RS.DeleteLogin="XiM",RS.Tooltips_ImportExportMove="X5G",RS.Tooltips_ExportImage="XTL",RS.Tooltips_GlobalSearchPanel="XQ8",RS.Tooltips_ColorTeal="X3N",RS.Allow="Xae",RS.FixPerspectiveTooltips="XK5",RS.AudioPlaybackNotInProgress="Xey",RS.FontSize="XE5",RS.CancelEdit="X1j",RS.confirmDeletingTemplateInstance="XbJ",RS.Filter="XFR",RS.deleteEmptyDirectory="XHu",RS.action_DestructSticker="XUi",RS.action_RemoveStyles="Xou",RS.GalleryOverwriteWarning="XFF",RS.FilesRecursive="X3Y",RS.Tooltips_DocumentOutline="Xq8",RS.ConfirmOverwriting="XvE",RS.widgetFlexboxMessage="XLf",RS.Tooltips_TakePhotoAndImportToSpecifiedPath="XfU",RS.UnsupportedEncryptedFileVersion_="XZR",RS.ClientActionClassesConfirmDelete="XPq",RS.PlaceholderRequiredUrl="X8j",RS.widgetSidepanelTitle="XPp",RS.widgetSlideshowTitle="XMJ",RS.EditStylesheet="XrP",RS.Tooltips_CopySelection="X97",RS.Display="XiN",RS.AudioRecordingStarted="XLy",RS.ActionRequireDocumentVersion_0_OrAbove="XOD",RS.FailedToReadLoginCf="XSK",RS.GameMinesInstruction="XXJ",RS.Grid="Xon",RS.ExportDataCancelled="XyB",RS.Font="XTv",RS.ToggleAll="Xid",RS.ErrorReadingStyles="XX8",RS.Tooltips_InsertAsNextSibling="XYh",RS.Video="Xwk",RS.AssertInvalidPathKind_="XPs",RS.FactoryResetCancelled="XCE",RS.Tooltips_WrapSelection="XhS",RS.InvalidOutputMimeType="XgX",RS.hints="XgB",RS.action_DestructPictureFrame="Xql",RS.action_InsertTextChild="XLZ",RS.Tooltips_ToggleHidden="XPe",RS.Tooltips_AddRule="Xfv",RS.PickFile="Xy5",RS.widgetTocDesc="XXF",RS.Tooltips_ShowOrHideLeftSidepanel="XM6",RS.Effects="XeS",RS.Tooltips_SearchBar="XlG",RS.PickImage="Xlp",RS.emptyDirectories="XEL",RS.Tooltips_ExportAsImage="XlL",RS.Tooltips_ShowOrHideRightSidebar="XIr",RS.Filter_saturate="XHD",RS.Import="X1h",RS.Filter_hueRotate="XPA",RS.Tooltips_NextBlog="XzB",RS.SearchAborted="XAz",RS.DestinationNotExists="XfF",RS.PromptCopyOverwrite1="XwP",RS.ImageArea="XTT",RS.RecoverEveryDeletedFileInThisDirectory_Confirmation="X66",RS.Total_files="Xl7",RS.history_templateRadioAction="XgE",RS.GradientRadialEllipse="XD0",RS.Tooltips_AddRuleset="XIp",RS.BGPosition="Xs8",RS.action_RemoveStyle="X4t",RS.ATextValidatorIsRequired="Xr1",RS.BarcodeScanTooltips="XzC",RS.LoginCancelled="XNy",RS.DropDataTypeNotSupported="XDC",RS.ActionRequireASingleElementOrACollapsedSelection="XTs",RS.widgetStickerStyleBasic="XG2",RS.Tooltips_ImportVideo="XkM",RS.Tooltips_Bold="XWA",RS.widgetFlexboxStyleBasic="XQ3",RS.InputMustNotBeEmpty="XdH",RS.AddClientCssMessage="XkY",RS.action_PasteSibling="X5r",RS.widgetStickerStyleImage="XaO",RS.Title="Xf5",RS.ConfirmCreateFullBackupTo_="XDq",RS.widgetShoppingDesc="XPi",RS.Filter_blur="Xhn",RS.nameValueOutOfRange="XPY",RS.Filepath="XGl",RS.Tooltips_ExportToPhotoLibrary="X75",RS.action_AnnotateImage="Xam",RS.DestinationNotWritableFile="XbU",RS.Tooltips_Apply="X3U",RS.Tooltips_OpenFileOrDirectory="XrY",RS.PromptPasteTitle="XBv",RS.ClipboardPasteStringOnly="XRz",RS.Tooltips_InsertCalendar="X5Q",RS.Tooltips_Redo="X1L",RS.ActionRequireASingleNodeOrACollapsedSelection="Xjr",RS.destructWidgetAndContent="Xfr",RS.action_AnnotationShow="XZ4",RS.Key="X82",RS.FailedToGenerateKeys="XRT",RS.action_AnnotationHide="XZt",RS.Deleting="X8m",RS.action_Save="X2b",RS.action_InsertVideo="Xrs",RS.IllegalSearchText_="XLg",RS.Tooltips_EmbedImage="X8H",RS.history_toggle="Xs7",RS.Digits="XIw",RS.Quality="X1f",RS.cut0ItemsToClipboard="Xmn",RS.Tooltips_MoveUp="X5X",RS.InsertAudioTooltips="XTk",RS.Help_GameSudoku="XnL",RS.history_placeholders="Xif",RS.Tooltips_TargetDate="Xlq",RS.Tooltips_CreateThumbnail="XYC",RS.action_Rotate="XQf",RS.widgetAnnotationPhotoTitle="X64",RS.ExpectingHtmlExt="XnQ",RS.Tooltips_ListItemWithTextBullet="XmZ",RS.Tooltips_ToggleFullscreen="XYg",RS.StickOnScreen="XHJ",RS.Tooltips_ImportMedia="XCu",RS.SourceNotFound="XDm",RS.confirmOpenDocument1="Xl5",RS.Tooltips_ImportImage="XZd",RS.TextBullet_Message="XtO",RS.Tooltips_ResizeElement="Xed",RS.Gutter="X6R",RS.history_imageholder="X5W",RS.VERY_EASY="XYn",RS.Tooltips_BorderOnePx="XlM",RS.ErrorRestoringEvents="Xbs",RS.Right="Xho",RS.RenameMessage="XvA",RS.VideoRecordingTitle="X35",RS.action_EditRawStyle="XiA",RS.action_InsertSymbol="Xis",RS.Tooltips_EventsPanel="XRt",RS.ZIndex="XB7",RS.KeyAlias="XV5",RS.PM="X1n",RS.LiteTemplateCanvasNotAvailable="Xuk",RS.Tooltips_CalendarPanel="X91",RS.Tooltips_UnwrapSelection="XZx",RS.Tooltips_Media="Xxk",RS.Tooltips_AddPrevPageLink="XNx",RS.DateFormat="XJs",RS.ErrorStartingAudioRecording="XUW",RS.FixPerspectiveTitle="XxU",RS.Tooltips_GotoCurrentDocumentDirectory="Xsq",RS.PleaseSpecifyASourceImage="XvG",RS.FixPerspectiveCroppedSize="XJ0",RS.Dimension="XKp",RS.ConfirmDeletingNextPageLink="XxG",RS.Backup="Xay",RS.RecognizeTextNotFound="Xls",RS.DirsRecursive="XzI",RS.OriginalSize="X5n",RS.ScribblerText="XT4",RS.widgetStickerTitle="XC3",RS.at_center="Xpx",RS.AddBorder="XAi",RS.Private="XAv",RS.PasswordTooShort_="X57",RS.AssertExpectingStringListOrMap_="Xy2",RS.editAbortedMessage="Xu4",RS.UnauthorizedAccess_="XKO",RS.history_placeholder="XEi",RS.ImportCancelled="Xt7",RS.app_name_lite="XU6",RS.FileTooLarge="Xef",RS.ImageReadFailed="Xi6",RS.Tooltips_PasteFromSystemClipboard="Xtp",RS.ScribblerEdit="XLA",RS.Tooltips_CutDone="XJg",RS.invalidNameValue="XAF",RS.ResetToFactoryDefaultCancelled="XEa",RS.ActionNotPermittedOnElement_="X3T",RS.SearchFailed_="XUq",RS.action_Unwrap="X3K",RS.TotalSizeRecursive="Xw1",RS.DestinationPathIsRequired="XiP",RS.action_ToggleVisibility="X17",RS.ActionRequireMultipleElementsOrACollapsedSelection="XQL",RS.widgetSampleLink2="XJA",RS.Tooltips_StrikeThrough="XxS",RS.DesktopOperationTakePhotoNotAvailable="Xet",RS.Tooltips_CutSelection="XKR",RS.SelectAll="Xv0",RS.Tooltips_Recording="XwB",RS.FailedToCreateCipherOutputStream="XwY",RS.PlaceholderOptionalFilepath="XEc",RS.VerticalAlign="X3M",RS.widgetAnnotationTypeTransparent="XNb",RS.DestinationFileAlreadyExistsOpenInsteadOfCreating="XWi",RS.None="XvX",RS.DesktopOperationRecordVideoNotAvailable="XKJ",RS.FilenameMustNotStartsWithDot="XQA",RS.action_ListItem="XDZ",RS.widgetAccordionTitle="Xwd",RS.MustLoginForRestoringBackup="XYm",RS.InvalidTemplate="XRn",RS.Tooltips_EnterSearchText="XiW",RS.InvalidInputPath_="Xz0",RS.invalidStyle_="XId",RS.failed="XmG",RS.ConfirmNotSavingToStylesheetFile="Xjz",RS.Export="XIX",RS.ErrorReadingImage_="Xkv",RS.Tooltips_RestoreDataFromIncrementalBackup="XsV",RS.Tooltips_FactoryReset="X2D",RS.PromptElementMessage="XD3",RS.BackupExportTooltips="Xkt",RS.action_Wrap="Xnj",RS.Tooltips_HighlightStyles="XyQ",RS.ChangePasswordOK="XGa",RS.Tooltips_TextColor="Xn4",RS.WrapSelection="XvD",RS.MkdirTitle="XFS",RS.Tooltips_ChangePassword="Xuf",RS.OK="Xun",RS.Tooltips_StopAudioRecording="XDW",RS.action_DestructSplitpanel="Xg7",RS.Tooltips_ClearCanvasAndDrawingHistory="XR8",RS.ThereIsNoPreviousSibling="X2Y",RS.FloatLeft="XCC",RS.EnterPassword="XZv",RS.InvalidThumbnailKind_="XAJ",RS.TotalSize="Xrn",RS.widgetSampleAnnotation="XjF",RS.EventsRepeatEveryWorkdayNotSupported="X13",RS.Filter_brightness="X2M",RS.Tooltips_ImportFromBackupDirectories="X0g",RS.Tooltips_Replace="Xqg",RS.ColorLink="XQE",RS.CannotDelete_="XGs",RS.KeyFile="X6H",RS.FactoryResetTitle="XmD",RS.RequireBiometric="Xf3",RS.Tooltips_Fit="Xmd",RS.Tooltips_DateFormat="XaN",RS.Tooltips_ColorYellow="XSF",RS.Off="XEN",RS.PleaseWait="Xcx",RS.Tooltips_CreateLink="XoW",RS.PromptCloneTitle="XD1",RS.Tooltips_RemoveEmptyDirs="X5x",RS.Tooltips_ListWithSymbolBullet="XfC",RS.Tooltips_BorderNone="XLp",RS.ResetSettingsPrompt="XcV",RS.InvalidFilenameCharacter_="Xy9",RS.GradientRepeatingRadial="X86",RS.Tooltips_ColorBlack="Xbz",RS.UnexpectedEndOfFile="X0k",RS.CopyFailed_="Xjd",RS.ScribblerMove="XyR",RS.PromptCopy1="Xm8",RS.Login="Xe2",RS.CorrectionOptionCorrectPerspective="XlO",RS.Color="XQZ",RS.PickStyle="X1q",RS.ActionRequireANonCollapsedSelection="XbC",RS.Tooltips_ImportFile="XGy",RS.SourceDeletionFailed="XCQ",RS.PlacholderRegexSearch="XVT",RS.action_InsertElementChild="X3j",RS.Html="XRk",RS.Moving="X8E",RS.Tooltips_ZoomToFitScreen="Xpn",RS.Tooltips_Contextmenu="X78",RS.StyleEditorExpectingSingleRulesetOnly="X7n",RS.Tooltips_Login="XBB",RS.widgetAnnotationStyleList="XTU",RS.Scribbler_UnknownAction_="Xs2",RS.Tooltips_TimePicker="X37",RS.Tooltips_Search="X4r",RS.AssertInvalidZIndex_="XRD",RS.widgetAnnotationStyleBasic="XI2",RS.TakePhotoTitle="Xzl",RS.ClipboardIsEmptyOrInvalid="XiZ",RS.widgetSidebarTabTitle="XHB",RS.ConfirmExportDirectoryTo_="X3R",RS.Layer1="XgD",RS.BorderRadius="X1i",RS.UnknownInputDimension="XyL",RS.Logout_="Xxa",RS.Tooltips_Help="Xdn",RS.deletedFiles="X74",RS.action_factoryReset="Xqo",RS.Error="XVr",RS.history_templateCycleAction="XVQ",RS.ActionNotPermittedOnBodyElement="X3C",RS.ErrorReading_="XWX",RS.action_InsertDate="X6w",RS.Difficulty="Xad",RS.Tooltips_DatePicker="XoS",RS.ImageViewerTitle="XDz",RS.Tooltips_InsertLinkElement="X6i",RS.AssertNotNull="Xna",RS.CreateLogin="X8w",RS.Scribbler_MissingURIForImageAction="XBx",RS.PosterAt="Xja",RS.CopiedToLocalClipboard_="X03",RS.Layer0="X7Q",RS.EditBGImageTitle="Xmg",RS.Tooltips_InsertWidget="Xlv",RS.VideoRecordingCancelled="X48",RS.LogoutOK="XBw",RS.NotEditing="Xl0",RS.ExpectingFileExt_="XxF",RS.TemplateNotFound_="XGL",RS.Tooltips_InsertCanvas="Xrx",RS.GameHistoryIsEmpty="Xov",RS.ErrorCreatingThumbnail_="XfN",RS.Tooltips_DrawFreehandCurves="X22",RS.IndexingInProgress="Xtw",RS.GradientRadial="Xar",RS.Tooltips_PickSymbol="Xr9",RS.AbstractMethodNotImplemented="X6A",RS.loadingDefaultHomePage="Xqx",RS.Fragment="XFz",RS.RenameTitle="XNW",RS.AM="Xx0",RS.widgetSidepanelSample="Xxl",RS.Tooltips_ListWithDateBullet="XYM",RS.Recipients="Xs6",RS.NoItemFound="XmV",RS.Tooltips_GotoHomePage="XEt",RS.Tooltips_SelectDirectoryToExport="XqZ",RS.ErrorReadingCachedThumbnail_="XWS",RS.Tooltips_ColorGreen="X9P",RS.ExpectingImageExt="XLU",RS.InsertNbspTitle="XEn",RS.NotDeletable="X9D",RS.ErrorValidatingHtml="XAU",RS.Tooltips_CropCanvasToFitContent="XJ5",RS.ActionClearStylesMessage="XE7",RS.Tooltips_AlignJustify="Xaa",RS.Tooltips_GlobalSettingsPanel="Xol";class MSG{static string_(t){let e=MSG._stringObject[t];if(null==e)throw new Error(t);return e}static string1_(t,e){return`${MSG.string_(t)}${e}`}static string2_(t,e,i){return`${MSG.string_(t)}${e}${i}`}static stringArray_(t){let e=MSG._stringArrayObject[t];if(null==e)throw new Error(t);return e.split("\n")}static format1_(t,e){return MSG._stringObject[t].replace(MSG.X_RX0,e)}static format2_(t,e,i){return MSG._stringObject[t].replace(MSG.X_RX0,e).replace(MSG.X_RX1,i)}static format3_(t,e,i,n){return MSG._stringObject[t].replace(MSG.X_RX0,e).replace(MSG.X_RX1,i).replace(MSG.X_RX2,n)}static formatArray1_(t,e){return MSG.format1_(t,e).split("\n")}static formatArray2_(t,e,i){return MSG.format2_(t,e,i).split("\n")}static formatArray3_(t,e,i,n){return MSG.format3_(t,e,i,n).split("\n")}}MSG.X_RX0=new RegExp("\\$\\{0\\}"),MSG.X_RX1=new RegExp("\\$\\{1\\}"),MSG.X_RX2=new RegExp("\\$\\{2\\}"),MSG._resourcesObject=window.XxGR,MSG._stringObject=MSG._resourcesObject,MSG._stringArrayObject=MSG._resourcesObject,MSG.XXX$=MSG.string_(RS.InsertTextHere);class DateTime{constructor(t,e){_date_1.set(this,void 0),__classPrivateFieldSet(this,_date_1,t instanceof Date?t:new Date(t)),!1===e&&__classPrivateFieldSet(this,_date_1,new Date(__classPrivateFieldGet(this,_date_1).valueOf()+__classPrivateFieldGet(this,_date_1).getTimezoneOffset()*DateTime.MIN))}static local_(t,e,i,n,s,o,l){return new DateTime(Date.UTC(t,e-1,null!=i?i:1,null!=n?n:0,null!=s?s:0,null!=o?o:0,null!=l?l:0),!1)}static utc_(t,e,i,n,s,o,l){return new DateTime(Date.UTC(t,e-1,null!=i?i:1,null!=n?n:0,null!=s?s:0,null!=o?o:0,null!=l?l:0),!0)}static fromMillisecondsSinceEpoch_(t,e){return new DateTime(t,e)}static now_(){return new DateTime(new Date)}static ms_(){return Date.now()}static today_(){const t=this.now_();return t.year$.toFixed(0)+t.month$.toFixed(0).padStart(2,"0")+t.day$.toFixed(0).padStart(2,"0")}add_(t){return new DateTime(__classPrivateFieldGet(this,_date_1).valueOf()+t)}subtract_(t){return new DateTime(__classPrivateFieldGet(this,_date_1).valueOf()-t)}isAfter_(t){return this.millisecondsSinceEpoch$>t.millisecondsSinceEpoch$}get millisecondsSinceEpoch$(){return __classPrivateFieldGet(this,_date_1).getTime()}get day$(){return __classPrivateFieldGet(this,_date_1).getDate()}get weekday$(){return __classPrivateFieldGet(this,_date_1).getDay()}get month$(){return __classPrivateFieldGet(this,_date_1).getMonth()+1}get year$(){return __classPrivateFieldGet(this,_date_1).getFullYear()}get hour$(){return __classPrivateFieldGet(this,_date_1).getHours()}get minute$(){return __classPrivateFieldGet(this,_date_1).getMinutes()}get second$(){return __classPrivateFieldGet(this,_date_1).getSeconds()}}_date_1=new WeakMap,DateTime.FOREVER=1<<30,DateTime.MIN=6e4,DateTime.HOUR=60*DateTime.MIN,DateTime.DAY=24*DateTime.HOUR,DateTime.SUNDAY=0,DateTime.MONDAY=1,DateTime.TUEDAY=2,DateTime.WEDNESDAY=3,DateTime.THURSDAY=4,DateTime.FRIDAY=5,DateTime.SATURDAY=6;class Basepath{constructor(...t){_path_1.set(this,void 0),_basepath.set(this,void 0),__classPrivateFieldSet(this,_path_1,Basepath.cleanFilepath_(t.join("/"))),__classPrivateFieldSet(this,_basepath,Basepath.parse_(__classPrivateFieldGet(this,_path_1)))}static parse_(t){function e(t,e){if(""==e||"."==e)return{dir$:t,name$:"",base$:"",suffix$:""};if(".."==e)return{dir$:t,name$:"..",base$:"..",suffix$:""};const i=e.lastIndexOf("."),[n,s]=i<=0?[e,""]:TextUt.splitAt_(e,i);return{dir$:t,name$:e,base$:n,suffix$:s}}const i=t.lastIndexOf("/");if(i<0)return e(null,t);const n=t.substring(0,i);return e(""==n?"/":n,t.substring(i+1))}static cleanFilepath_(t){if(t.indexOf("/")<0)return t;const e=(t=t.trim().replace(RX.Slashes_g,"/")).split("/"),i=[];for(let t=0;t<e.length;++t){let n=e[t];if("."!=n){if(".."==n){let t=i.length;if(t>0&&i[t-1].length>0&&".."!=i[t-1]){i.pop();continue}}i.push(n)}else t==e.length-1&&i.push("")}const n=i.join("/");return t.startsWith("/")&&!n.startsWith("/")?"/"+n:n}static cleanPathSegments_(t){let e=t.length;if(0==e)return t;let i=[];for(let n=0;n<e;++n){let e=t[n];(0==e.length||"."==e)&&i.length>0||(".."==e&&i.length>0?i.pop():i.push(e))}return i}static rpathOrNull_(t,e){const i=this.cleanPathSegments_(t.split("/")),n=this.cleanPathSegments_(e.split("/"));if(n.includes("..")||i.includes(".."))return null;const s=i.length,o=n.length;let l=0;for(;l<s&&l<o&&i[l]==n[l];)++l;return l<s?null:n.slice(l,o).join("/")}static rpath_(t,e){const i=this.cleanPathSegments_(t.split("/")),n=this.cleanPathSegments_(e.split("/")),s=i.length,o=n.length;let l=0;for(;l<s&&l<o&&i[l]==n[l];)++l;const a=n.slice(l,o);if(l==s)return a.join("/");for(;++l<=s;)a.unshift("..");return a.join("/")}static rpathFromSegments_(t,e){let i=t.length,n=e.length,s=0;for(;s<i&&s<n&&t[s]==e[s];++s);let o=[];for(let t=s+1;t<i;++t)o.push("..");for(;s<n;++s)o.push(e[s]);return o}get path$(){return __classPrivateFieldGet(this,_path_1)}get dir$(){return __classPrivateFieldGet(this,_basepath).dir$}get nameWithSuffix$(){return __classPrivateFieldGet(this,_basepath).name$}get nameWithoutSuffix$(){return __classPrivateFieldGet(this,_basepath).base$}get suffix$(){return __classPrivateFieldGet(this,_basepath).suffix$}get lcSuffix$(){return __classPrivateFieldGet(this,_basepath).suffix$.toLowerCase()}get ext$(){let t=this.suffix$;return 0==t.length?null:t.substring(1)}get lcExt$(){let t=this.lcSuffix$;return 0==t.length?null:t.substring(1)}get parent$(){return null==this.dir$?null:new Basepath(this.dir$)}sibling_(t){return null==this.dir$?new Basepath(t):new Basepath(this.dir$,t)}file_(t){return new Basepath(this.path$,t)}changeNameWithSuffix_(t){return this.sibling_(t)}changeNameWithoutSuffix_(t){return this.changeNameWithSuffix_(t+this.suffix$)}changeSuffix_(t){return this.changeNameWithSuffix_(this.nameWithoutSuffix$+t)}dirAndNameWithoutSuffix_(){return Basepath.joinPath_(this.dir$,this.nameWithoutSuffix$)}toString(){return this.path$}static suffix_(t){return new Basepath(t).suffix$}static lcSuffix_(t){return Basepath.suffix_(t).toLowerCase()}static nameWithSuffix_(t){return new Basepath(t).nameWithSuffix$}static nameWithoutSuffix_(t){return new Basepath(t).nameWithoutSuffix$}static changeNameWithSuffix_(t,e){return new Basepath(t).changeNameWithSuffix_(e).toString()}static changeNameWithoutSuffix_(t,e){return new Basepath(t).changeNameWithoutSuffix_(e).toString()}static changeSuffix_(t,e){return new Basepath(t).changeSuffix_(e).toString()}static dir_(t){return new Basepath(t).dir$}static ext_(t){if(null==t)return null;let e=Basepath.suffix_(t);return 0==e.length?null:e.substring(1)}static lcExt_(t){if(null==t)return null;let e=Basepath.suffix_(t);return 0==e.length?null:e.substring(1).toLowerCase()}static nameAndSuffix_(t){const e=new Basepath(t);return[e.nameWithoutSuffix$,e.suffix$]}static join_(t){return t.join("/")}static joinPath_(t,e){return null==t?e:"/"==t?`/${e}`:`${t}/${e}`}static joinRpath_(t,e){return null==t||0==t.length?e:"/"==t?`/${e}`:`${t}/${e}`}static splitPath_(t){let e=Basepath.cleanFilepath_(t),i="";const n=e.lastIndexOf("/");return n>=0&&(i=e.substring(0,n),e=e.substring(n+1)),[i,"."==e?"":e]}static splitFirst_(t){const e=t.indexOf("/");return e<0?[null,t]:[t.substring(0,e),t.substring(e+1)]}static trim_(t,e="/"){let i=0,n=t.length,s=e.length;for(;i+s<=n&&t.startsWith(e,i);)i+=s;for(;i+s<=n&&t.endsWith(e,n);)n-=s;return 0==i&&n==t.length?t:t.substring(i,n)}static trimLeading_(t,e="/"){let i=0,n=t.length,s=e.length;for(;i+s<=n&&t.startsWith(e,i);)i+=s;return 0==i&&n==t.length?t:t.substring(i,n)}static trimTrailing_(t,e="/"){let i=t.length,n=e.length;for(;0+n<=i&&t.endsWith(e,i);)i-=n;return i==t.length?t:t.substring(0,i)}}_path_1=new WeakMap,_basepath=new WeakMap;class Uri{constructor(t,e,i,n){this.isRelative$=n,_url_1.set(this,void 0),_basedir.set(this,void 0),_decodedPath_1.set(this,void 0),__classPrivateFieldSet(this,_url_1,t),__classPrivateFieldSet(this,_basedir,e),__classPrivateFieldSet(this,_decodedPath_1,i)}static get ROOT$(){return Uri.from_("/")}static parse_(t,e){var i,n,s;let o=replaceAll_(replaceAll_(t,"[","%5B"),"]","%5D");const l=Uri.PAT.exec(o);if(null==l)throw new Error(MSG.string_(RS.InvalidURL));const a=null!==(i=l[1])&&void 0!==i?i:"",r=null!==(n=l[2])&&void 0!==n?n:"",_=null!==(s=l[3])&&void 0!==s?s:"",c=l[4],h=0==a.length&&0==r.length&&0==_.length&&!c.startsWith("/"),u=null==e?this.BASEURI:"string"==typeof e?new URL(e):__classPrivateFieldGet(e,_url_1),d=new URL(o,u),S=Basepath.cleanFilepath_(decodeURIComponent(d.pathname)),p=decodeURIComponent(u.pathname).split("/");p.length>0&&p.pop();let m=p.join("/");return m.startsWith("/")||(m="/"+m),new Uri(d,m,S,h)}static from_(t,e="",i="",n){let s="/";"string"==typeof t?s=t:t.length>0&&(s=t.map(t=>encodeURIComponent(t)).join("/"));let o="";if("string"==typeof e)o=e;else if(e.size>0){o="?";for(let[t,i]of e)o.length>1&&(o+="&"),o+=encodeURIComponent(t)+(i.length>0?"="+encodeURIComponent(i):"")}return Uri.parse_(s+o+i,n)}static asMap_(t){let e=new Map;return t.forEach((t,i)=>e.set(i,t)),e}get hash$(){return __classPrivateFieldGet(this,_url_1).hash}get host$(){return __classPrivateFieldGet(this,_url_1).host}get hostname$(){return __classPrivateFieldGet(this,_url_1).hostname}get href$(){return __classPrivateFieldGet(this,_url_1).href}get origin$(){return __classPrivateFieldGet(this,_url_1).origin}get password$(){return __classPrivateFieldGet(this,_url_1).password}get pathname$(){return __classPrivateFieldGet(this,_url_1).pathname}get port$(){return __classPrivateFieldGet(this,_url_1).port}get protocol$(){return __classPrivateFieldGet(this,_url_1).protocol}get search$(){return __classPrivateFieldGet(this,_url_1).search}get queryParameters$(){return __classPrivateFieldGet(this,_url_1).searchParams}get username$(){return __classPrivateFieldGet(this,_url_1).username}get hasQuery$(){return this.search$.length>0}get hasFragment$(){return this.hash$.length>0}get path$(){let t=this.isRelative$?Basepath.rpath_(__classPrivateFieldGet(this,_basedir),__classPrivateFieldGet(this,_decodedPath_1)):__classPrivateFieldGet(this,_decodedPath_1);return t.length>0&&__classPrivateFieldGet(this,_decodedPath_1).endsWith("/")&&!t.endsWith("/")?t+"/":t}get encodedPath$(){return this.path$.split("/").map(t=>encodeURIComponent(t)).join("/")}get pathSegments$(){return this.path$.split(Uri.SEP)}toRelative_(){return this.isRelative$?this:new Uri(__classPrivateFieldGet(this,_url_1),__classPrivateFieldGet(this,_basedir),__classPrivateFieldGet(this,_decodedPath_1),!0)}toAbsolute_(){return this.isRelative$?new Uri(__classPrivateFieldGet(this,_url_1),__classPrivateFieldGet(this,_basedir),__classPrivateFieldGet(this,_decodedPath_1),!1):this}resolveUri_(t){return t="string"==typeof t?t:t.toString(),Uri.parse_(t,this)}equals(t){return this.toString()==t.toString()}toShortString(){var t;return(null!==(t=ArrayUt.last_(this.pathSegments$))&&void 0!==t?t:"")+this.search$+this.hash$}toString(){return this.encodedPath$+this.search$+this.hash$}}_url_1=new WeakMap,_basedir=new WeakMap,_decodedPath_1=new WeakMap,Uri.SEP="/",Uri.BASEURI=new URL(CF.SCHEME_HOSTPORT_),Uri.PAT=new RegExp("^(\\w+:)?(//\\w+)?(:\\d+)?(.*?)(\\?.*)?(\\#.*?)?$");class UriUt{static split_(t){let e,[i,n]=TextUt.splitAt_(t,t.indexOf("?"));0==n.length?[i,e]=TextUt.splitAt_(i,i.indexOf("#")):[n,e]=TextUt.splitAt_(n,n.indexOf("#"));let s=i.indexOf("//");return s>=0&&(s=(i=i.substring(s+2)).indexOf("/"),i=s>=0?i.substring(s):""),[i,n,e]}}class Point{constructor(t,e){this.x=t,this.y=e}}class StringBuffer{constructor(t=""){this.buf=sarray_(),t.length>0&&this.buf.push(t)}write_(t){return t.length>0&&this.buf.push(t),this}get length$(){return this.buf.length}toString(t=""){return this.buf.join(t)}}class Timer{constructor(t,e){this.active$=!1,this.active$=!0,this.timer$=setTimeout(()=>{this.active$=!1,e()},t)}static sleep_(t,e){new Timer(t,e)}cancel_(){null!=this.timer$&&(this.active$=!1,clearTimeout(this.timer$),this.timer$=null)}isActive_(){return this.active$}}Timer.sleep0_=t=>{new Timer(0,t)},Timer.sleep00_=t=>{new Timer(0,()=>{new Timer(0,t)})},Timer.sleep1_=t=>{window.requestAnimationFrame(()=>{t()})},Timer.frame11_=t=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{t()})})},Timer.optional0_=(t,e)=>{null!=t&&Timer.sleep0_(()=>e(t))};class PeriodicTimer{constructor(t,e){this.active$=!1,this.active$=!0,this.timer$=setInterval(()=>{this.active$=!1,e(this.timer$)},t)}cancel_(){null!=this.timer$&&(this.active$=!1,clearTimeout(this.timer$),this.timer$=null)}isActive_(){return this.active$}}class StreamSubscription{constructor(t,e,i){this.receiver$=t,this.type$=e,this.listener$=i}cancel_(){this.receiver$.removeEventListener(this.type$,this.listener$)}}const BUILD_VERSION=3e4,K=1024,_H02=["00","01","02","03","04","05","06","07","08","09","0A","0B","0C","0D","0E","0F"],_HEX=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],INVALID_TAGS=["embed","frame","iframe","object","script"],_LINEBREAKS=[10,13,8232,8233],_SPACES=[9,11,12,65279,32,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8239,12288],_WHITESPACES=[10,13,8232,8233,9,11,12,65279,32,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8239,12288],AMP="&".codePointAt(0);class ATTR{}ATTR.style="style",ATTR.xFormat="x-f",ATTR.xInfo="x-i",ATTR.href="href",ATTR.xRole="x-role",ATTR.AnAction="x-xon",ATTR.xAction="x-action",ATTR.xPlaceholder="x-ph",ATTR.xTemplatePlaceholder="x-th",ATTR.xTooltips="x-t",ATTR.src="src",ATTR.autocapitalize="autocapitalize",ATTR.AnIndex="x-xo9",ATTR.spellcheck="spellcheck",ATTR.tabindex="tabindex",ATTR.AnSaved="x-x6q",ATTR.autocomplete="autocomplete",ATTR.xAnnotation="x-a",ATTR.AnNoClick="x-xm1",ATTR.placeholder="placeholder",ATTR.xPageTemplate="x-pt",ATTR.id="id",ATTR.AnUndoing="x-xe2",ATTR.classes="class",ATTR.AnRedoing="x-xe5",ATTR.autocorrect="autocorrect",ATTR.xButton="x-bt",ATTR.xTemplate="x-tp",ATTR.AnOptions="x-xra",ATTR.name$="name",ATTR.contenteditable="contenteditable",ATTR.AnInfo="x-xlo",ATTR.AnToggleGroup="x-xv2";class AVALUE{}AVALUE.xStop="stop";class AjaxAction{}AjaxAction.pause="XrB",AjaxAction.restore="XnO",AjaxAction.spinnerShow="XmN",AjaxAction.refreshEvents="Xoj",AjaxAction.gesture="XsQ",AjaxAction.ajax="XBc",AjaxAction.onResizeWindow="Xte",AjaxAction.toaster="XYp",AjaxAction.scanDocumentResult="Xie",AjaxAction.videoRecordingResult="XCx",AjaxAction.spinner="XN1",AjaxAction.hideCaret="XbY",AjaxAction.navigateBack="XBn",AjaxAction.browse="X1x",AjaxAction.resume="XKt",AjaxAction.onCallback="X7t",AjaxAction.audioStatusChanged="Xch",AjaxAction.showSidepanel="Xb5",AjaxAction.takePhotoResult="XXo",AjaxAction.onNotificationResponse="Xom",AjaxAction.spinnerHide="X1G",AjaxAction.backup="X8g",AjaxAction.loginResult="XaR",AjaxAction.login="XNA",AjaxAction.export="XX1";class CSS{}CSS.AnSmall="XGI",CSS.AnFlashHighlight="XCq",CSS.FaHeartO="X6o",CSS.AnTemplateContainer="Xak",CSS.AnFile="X7e",CSS.AnBoxShadow="Xzo",CSS.FaFolderOpenO="XHs",CSS.xDodgerblue="x-dodgerblue",CSS.xSubject="x-subject",CSS.xRightSidebarTab="x-rsb-tab",CSS.xWidgetShoppingStatus="x-w-shopping-status",CSS.AnSelect="X5J",CSS.AnLineNumberInput="XWY",CSS.xColorDodgerblue="x-color-dodgerblue",CSS.xColorGray="x-color-gray",CSS.AnHint="XWM",CSS.xAccordionButton="x-accordion-button",CSS.xFloatLeftClearNone="x-float-left-clear-none",CSS.AnTemplateCell="XbB",CSS.xSegment="x-segment",CSS.FaArrowCircleLeft="XyL",CSS.AnFullscreenVideoPlayer="XOF",CSS.xEmojiHome="x-emoji-home",CSS.xTodoItem="x-todo-item",CSS.xHideDone="x-hide-done",CSS.AnViewportContent="Xhq",CSS.FaTimesCircleO="Xg0",CSS.FaBell="X4A",CSS.FaClone="Xhs",CSS.AnHeading="Xf0",CSS.FaHistory="Xlg",CSS.FaRotateLeft="XIr",CSS.xFloatLeft="x-float-left",CSS.AnFull="XZz",CSS.FaCamera="XsU",CSS.AnAudioButton="XWd",CSS.AnButtonInline="XFT",CSS.xZMiddle="x-z-middle",CSS.FaInfoCircle="XpE",CSS.AnFlexColumnNoWrap="Xl9",CSS.AnUnderline="XLZ",CSS.FaMinus="XyU",CSS.AnFaDot="XsV",CSS.FaThList="X9r",CSS.FaVolumeDown="XSF",CSS.xZTop="x-z-top",CSS.xMedia="x-media",CSS.FaBellO="Xao",CSS.FaChevronCircleUp="XhE",CSS.xAudioFilename="x-audio-filename",CSS.FaKey="Xc8",CSS.FaHandORight="X5d",CSS.xCompact="x-compact",CSS.AnMenurow="XSD",CSS.AnLinkList="XhD",CSS.FaHeader="X7j",CSS.xHighlightRed="x-highlight-red",CSS.xViewport="x-viewport",CSS.FaCommentsO="Xh8",CSS.xBoxGray="x-box-gray",CSS.FaQrcode="XYj",CSS.xAlignCenter="x-align-center",CSS.xStyleDark="x-style-dark",CSS.AnAudioSlider="XNo",CSS.xSticker="x-sticker",CSS.xxTodo="xx-todo",CSS.AnFaNbsp="X4c",CSS.xxStatus="xx-status",CSS.xShadowYellow="x-shadow-yellow",CSS.AnEventsPanel="XuE",CSS.xEmojiPhoto="x-emoji-photo",CSS.FaBookmark="XGm",CSS.AnToaster="XI3",CSS.xAudioDatetime="x-audio-datetime",CSS.AnFaSpace="XTj",CSS.FaEyedropper="XcE",CSS.FaFolder="XJ3",CSS.FaCircleThin="Xm0",CSS.xHidetemp="x-hidetemp",CSS.AnTreeLeaf="XY8",CSS.AnFlexButton="XqB",CSS.AnSpacer5="X9B",CSS.xCalendar="x-calendar",CSS.xListContent="x-list-content",CSS.FaCut="Xcv",CSS.FaSearch="XMv",CSS.AnMenurow6="XAs",CSS.FaImage="XbO",CSS.FaAlignJustify="XXK",CSS.AnDir="XHn",CSS.AnInputButton="XiV",CSS.AnMenu="XJo",CSS.AnBorderSampleInner="XNE",CSS.FaCheckSquare="Xm8",CSS.xVideoPoster="x-video-poster",CSS.xEmojiBlank="x-emoji-blank",CSS.FaAngleDoubleLeft="XPu",CSS.FaFileO="X4I",CSS.AnPromptMsg="XNj",CSS.AnEventsRepeat="Xn7",CSS.AnSelected="XzN",CSS.FaCopy="XTO",CSS.AnAudioPlaytime="XOu",CSS.xPageBreakBefore="x-page-break-before",CSS.FaIndent="XAE",CSS.AnBlue="XFN",CSS.AnCalcOp="XP2",CSS.AnFaSlash="XMD",CSS.AnWidth4="XnC",CSS.AnWidth6="Xf6",CSS.FaRetweet="XNu",CSS.AnFileInfo="X09",CSS.AnErr="XUY",CSS.xPhotoDef="x-photo-def",CSS.AnColorCell="XeT",CSS.FaFolderOpen="X6H",CSS.xBlue="x-blue",CSS.FaEllipsisV="XOC",CSS.AnTextList="XaY",CSS.FaEye="XBC",CSS.AnColorInput2="XyC",CSS.xWidgetShopping="x-w-shopping",CSS.xShadowSeWhite="x-shadow-se-white",CSS.AnFlex00Auto="X4G",CSS.FaGear="Xav",CSS.AnGray="Xff",CSS.xHideInSmallScreen="x-hide-in-small-screen",CSS.AnAnnotationStyleText="XTp",CSS.FaFolderO="XxF",CSS.AnContentPanel="XuN",CSS.AnRecents="XGq",CSS.xVideoResolution="x-video-resolution",CSS.xButtonHeight="x-button-height",CSS.FaArrowRight="XmJ",CSS.AnPromptList="XV3",CSS.xNarrow="x-narrow",CSS.AnTxt="Xcd",CSS.xShadowRed="x-shadow-red",CSS.AnTreeControl="XSw",CSS.xAudioFilesize="x-audio-filesize",CSS.FaAlignRight="X6l",CSS.FaDotCircleO="XkA",CSS.xCalcItem="x-calc-item",CSS.FaHashtag="XQE",CSS.xSmall="x-small",CSS.FaParagraph="XEX",CSS.FaVideoCamera="Xnm",CSS.AnSidebarTab="Xo3",CSS.xWidgetTocs="x-w-tocs",CSS.xColorOrange="x-color-orange",CSS.FaShoppingCart="XHy",CSS.xAlignLeft="x-align-left",CSS.xWidgetTocStyle01="x-w-toc-style01",CSS.AnTab="X7w",CSS.AnLink="Xui",CSS.FaReplyAll="XkZ",CSS.AnTabbar="XhT",CSS.AnEventsTomorrow="XrT",CSS.AnColorBG="XEg",CSS.FaHandODown="XJM",CSS.FaSignOut="X14",CSS.FaRefresh="XUl",CSS.xZindex90="x-zindex-90",CSS.xPlaytime="x-playtime",CSS.FaExchange="Xue",CSS.xBulletText="x-bullet-text",CSS.xZindex80="x-zindex-80",CSS.xNone="x-none",CSS.xxDone="xx-done",CSS.xWidgetTodoStatus="x-w-todo-status",CSS.FaQuestionCircle="XMu",CSS.xHcaption="x-hcaption",CSS.xCalcTotal="x-calc-total",CSS.AnOutlineBottom="XzG",CSS.xHideable="x-hideable",CSS.FaShareSquare="XRZ",CSS.xEmojiBlog="x-emoji-blog",CSS.AnSmaller="Xrb",CSS.AnTreeSelected="X4b",CSS.xPhoto="x-photo",CSS.AnPanel="X1R",CSS.xSubscript="x-subscript",CSS.AnBox3="XEF",CSS.AnTreeExpanded="XIq",CSS.FaWindows="XVt",CSS.FaMagic="X1O",CSS.xSelected="x-selected",CSS.FaFlag="XpH",CSS.xItalic="x-italic",CSS.FaFileText="XFb",CSS.xGreen="x-green",CSS.FaCrop="Xkd",CSS.AnTag="Xiy",CSS.xHighlightGray="x-highlight-gray",CSS.FaPlay="XCQ",CSS.AnIndicatorAlarm="XHe",CSS.AnColorList="Xqo",CSS.AnSidepanelExplore="XHu",CSS.xTimeline="x-timeline",CSS.xAudio="x-audio",CSS.AnTemplateContent="Xds",CSS.FaPaintBrush="XBl",CSS.AnMarginV5="Xuy",CSS.FaList="Xro",CSS.xWidgetToc="x-w-toc",CSS.xHighlightColor="x-highlight-color",CSS.FaCutMarked="XfC",CSS.xColorTeal="x-color-teal",CSS.xTodoDone="x-todo-done",CSS.xWidgetShoppingStyle01="x-w-shopping-style01",CSS.xWidgetTocBullet="x-w-toc-bullet",CSS.FaClockO="Xet",CSS.AnPromptContentWithOutline="XB6",CSS.FaTrashO="Xem",CSS.xCalcSubtotal="x-calc-subtotal",CSS.xCalcQuantity="x-calc-quantity",CSS.FaToggleLeft="XW0",CSS.FaStop="XVs",CSS.AnPalette="XBT",CSS.xHead2="x-head2",CSS.xHeader="x-header",CSS.xSlideshow="x-slideshow",CSS.xEmojiShopping="x-emoji-shopping",CSS.FaExternalLinkSquare="XFo",CSS.AnTextButton="XIm",CSS.xAccordionShow="x-accordion-show",CSS.FaCutNotMarked="X1M",CSS.xSlideshowImage="x-slideshow-image",CSS.FaWrench="XNT",CSS.FaColumns="XG8",CSS.xZindex10="x-zindex-10",CSS.AnPromptInput="X3z",CSS.FaUnlockAlt="X0i",CSS.FaSquare="XLE",CSS.AnFlex="Xnc",CSS.FaRandom="XX1",CSS.xDatetime="x-datetime",CSS.FaToggleDown="X0E",CSS.AnToasterOK="XEQ",CSS.xCanvas="x-canvas",CSS.AnGalleryCell="XSa",CSS.xxTitle="xx-title",CSS.xZUpper="x-z-upper",CSS.xPortrait="x-portrait",CSS.FaUnlink="X7E",CSS.FaAlignCenter="XTA",CSS.AnButtonFlat="XFn",CSS.FaSmileO="X44",CSS.xWidgetTodo="x-w-todo",CSS.AnError="XMi",CSS.FaVolumeUp="XJD",CSS.xWidgetToc1="x-w-toc1",CSS.xColorBlue="x-color-blue",CSS.AnVerticalMenu="Xvu",CSS.AnFlexVertical="X4Y",CSS.FaPaste="XGd",CSS.AnFlex0="XjE",CSS.FaAngleDoubleUp="XUR",CSS.AnPadBottom="X39",CSS.xRoundedTop="x-rounded-top",CSS.xHighlightBlue="x-highlight-blue",CSS.AnAudioTimeline="Xce",CSS.xMediaMissing="x-media-missing",CSS.AnMenubar="XX5",CSS.AnTreeContent="Xt7",CSS.xWidgetToc2="x-w-toc2",CSS.xBorderLine="x-border-line",CSS.FaStickyNoteO="XUP",CSS.AnToggleOff="XhA",CSS.AnEventsDesc="XkL",CSS.FaToggleRight="XfO",CSS.FaTags="X1S",CSS.AnButton1="XGg",CSS.xEmojiMemo="x-emoji-memo",CSS.xStyle="x-style",CSS.xColorYellow="x-color-yellow",CSS.xImageDef="x-image-def",CSS.NotoColon="XEl",CSS.AnPromptStatus="X7Z",CSS.FaAngleDoubleDown="Xrz",CSS.FaCube="XcI",CSS.AnTextOverlay="XiC",CSS.xAlignRight="x-align-right",CSS.xCalHead="x-cal-head",CSS.FaHourglassO="X2m",CSS.AnTabbarAtBottom="X5w",CSS.xWidgetVideo="x-w-video",CSS.AnMarker="XDq",CSS.FaArrowUp="X91",CSS.xMediaStatus="x-media-status",CSS.AnRoundCorners="Xdn",CSS.AnTemplateHeader="XdS",CSS.AnToolbar="Xvp",CSS.FaTerminal="XKu",CSS.FaStrikethrough="X7t",CSS.AnContentViewport="Xtz",CSS.FaCalendarPlusO="X1D",CSS.FaCheckSquareO="XWO",CSS.xHead3="x-head3",CSS.xSegments="x-segments",CSS.AnSelectedHighlight="Xjm",CSS.xWidgetTodoSubject="x-w-todo-subject",CSS.AnMenuSelect="XRf",CSS.FaMicrophoneSlash="XQW",CSS.xSlider="x-slider",CSS.AnFilepicker="Xxa",CSS.FaPlus="XHR",CSS.xFlashRightsidebar="x-frsb",CSS.xZindex30="x-zindex-30",CSS.FaBomb="Xer",CSS.AnButtonDown="Xw1",CSS.xLinkColor="x-link-color",CSS.xSymbol="x-symbol",CSS.AnAnnotationStyleImage="XVx",CSS.FaArrowCircleDown="XCX",CSS.FaSearchPlus="Xz3",CSS.xWidgetShoppingHeader="x-w-shopping-header",CSS.AnEventsItem="X8L",CSS.xZLower="x-z-lower",CSS.FaPause="XWX",CSS.AnSpacerTop5="XsQ",CSS.AnEventsPending="XAr",CSS.FaBraille="XTd",CSS.xVideoDuration="x-video-duration",CSS.AnSearchbox="Xz6",CSS.xVideoDatetime="x-video-datetime",CSS.FaQuoteLeft="Xq5",CSS.AnDisabled="XO6",CSS.AnTabPanel="XVV",CSS.AnAtt="XMg",CSS.AnColorStops="Xi0",CSS.FaDesktop="XDR",CSS.AnFilename="XE2",CSS.FaDeviantart="XZX",CSS.xNowrap="x-nowrap",CSS.xButtonCell="x-button-cell",CSS.xStickOnScreenRoot="x-stick-on-screen-root",CSS.xColorBlack="x-color-black",CSS.AnToasterDetails="XaK",CSS.AnZebra="Xr5",CSS.FaArrowLeft="X3b",CSS.AnCalcDigit="XMl",CSS.AnSlider="XZk",CSS.AnEventsDone="Xlr",CSS.FaBellSlash="XDK",CSS.xEmojiTodo="x-emoji-todo",CSS.AnPromptViewport="XYT",CSS.AnToasterContent="Xqm",CSS.xDateHoliday="x-date-holiday",CSS.xAnnotationColor="x-annotation-color",CSS.FaUnlock="XfD",CSS.FaLongArrowUp="Xxi",CSS.FaAmbulance="XTy",CSS.FaLongArrowDown="XYg",CSS.xFooter="x-footer",CSS.xBlack="x-black",CSS.AnCalHead="XAp",CSS.xEmojiCards="x-emoji-cards",CSS.FaCheck="XFc",CSS.AnToasterBottom="XNO",CSS.FaCalculator="Xtu",CSS.AnEventsToday="Xhf",CSS.FaCalendar="X90",CSS.AnTreeCollapsed="Xeo",CSS.FaSearchMinus="Xqk",CSS.xDraggable="x-draggable",CSS.AnRuler1Dotted="Xww",CSS.FaTruck="X6z",CSS.AnTemplateMenu="XEL",CSS.xFlex="x-flex",CSS.FaArrowDown="XqO",CSS.FaLink="XqY",CSS.AnToasterError="X5N",CSS.FaBarcode="XQZ",CSS.xxError="xx-error",CSS.AnButtonInput="XFU",CSS.xShadowBlue="x-shadow-blue",CSS.xRightSidepanel="x-rightsidepanel",CSS.xColorDarkblue="x-color-darkblue",CSS.xAudioRate="x-audio-rate",CSS.xVideoinfo="x-videoinfo",CSS.xDocumentScan="x-document-scan",CSS.xCalcContext="x-calc-context",CSS.NotoLeftBrace="XbX",CSS.FaCircleO="XPd",CSS.AnVerticalViewportWide="XrI",CSS.xWidgetShoppingTotal="x-w-shopping-total",CSS.FaDownload="Xm2",CSS.xShadowSe2Gray="x-shadow-se2-gray",CSS.AnStyleRowHeight="XCT",CSS.xGray="x-gray",CSS.AnTreeNode="XuC",CSS.AnSpinner="XDd",CSS.AnFill="XbQ",CSS.FaBellSlashO="XOq",CSS.xAnchor="x-anchor",CSS.xDate="x-date",CSS.AnInput4="XVK",CSS.xxHide="xx-hide",CSS.xWidgetTodoBody="x-w-todo-body",CSS.AnUpperFontMenu="XiA",CSS.xWidgetTodoStyle01="x-w-todo-style01",CSS.xAudioinfo="x-audioinfo",CSS.FaAlignLeft="X0m",CSS.FaFileImageO="XG9",CSS.AnSidepanelTemplates="XMa",CSS.AnMarginTop5="XZP",CSS.FaUserSecret="XUc",CSS.AnDialog="XCb",CSS.AnViewport="XKK",CSS.xButtonWidth="x-button-width",CSS.xAnnotationStyleImage="x-a-style-image",CSS.AnAudioPlayer="Xg2",CSS.xWidgetShoppingPrice="x-w-shopping-price",CSS.AnFlex01Auto="XlK",CSS.xCalcError="x-calc-error",CSS.xPictureframe="x-pictureframe",CSS.xGutter="x-gutter",CSS.xOrange="x-orange",CSS.AnRoot="XvO",CSS.xBox="x-box",CSS.AnTemplateCategory="XdA",CSS.xShadowGreen="x-shadow-green",CSS.FaFileVideoO="XIL",CSS.xShort="x-short",CSS.xLeftSplitcontent="x-leftsplitcontent",CSS.AnWidth1="X7i",CSS.xSuperscript="x-superscript",CSS.xZindex40="x-zindex-40",CSS.AnPromptSelect="Xaj",CSS.AnUpperMainMenu="XsJ",CSS.xZindex60="x-zindex-60",CSS.FaCompress="Xu6",CSS.xUnderline="x-underline",CSS.FaPencilSquare="XA3",CSS.xAnnotation="x-annotation",CSS.xMediaFilesize="x-media-filesize",CSS.FaRotateRight="XOi",CSS.xLeftSidepanel="x-leftsidepanel",CSS.AnCalBody="XDH",CSS.xEmojiCanvas="x-emoji-canvas",CSS.xColorRed="x-color-red",CSS.AnGalleryContent="XKU",CSS.AnFlexBaseline="X6P",CSS.AnToasterTop="XRY",CSS.AnSpacer10="Xlq",CSS.FaShareSquareO="XNN",CSS.xStyleLight="x-style-light",CSS.xWhite="x-white",CSS.xxBullet="xx-bullet",CSS.xColorGreen="x-color-green",CSS.xPause="x-pause",CSS.xPara="x-para",CSS.AnIndicatorTopRight="Xb5",CSS.AnBullet="XiJ",CSS.AnRuler="XOx",CSS.xClientShow="x-client-show",CSS.FaRub="XnY",CSS.xWarn="x-warn",CSS.AnMarginH5="XeC",CSS.xHideInDesktop="x-hide-in-desktop",CSS.xRowHeight="x-rowheight",CSS.xMediaContent="x-media-content",CSS.xControl="x-control",CSS.xHighlightGreen="x-highlight-green",CSS.FaSignIn="XkH",CSS.xVcaption="x-vcaption",CSS.AnSymbolList="Xi7",CSS.xPlay="x-play",CSS.xWidgetAudio="x-w-audio",CSS.xVideoFilename="x-video-filename",CSS.xList="x-list",CSS.AnDirInfo="XuV",CSS.FaExpand="XvF",CSS.AnOverlayCanvas="Xe7",CSS.FaBan="Xpu",CSS.AnWidth3="XCz",CSS.xZBottom="x-z-bottom",CSS.xAccordionContent="x-accordion-content",CSS.AnMenuInput="XFu",CSS.xPre="x-pre",CSS.xVlayout="x-vlayout",CSS.AnDirpath="Xq3",CSS.FaBookmarkO="Xxs",CSS.xHideInWideScreen="x-hide-in-wide-screen",CSS.FaListOl="XXz",CSS.FaIdCardO="XJw",CSS.FaReply="XPf",CSS.FaGlobe="XXd",CSS.xEmojiCalendar="x-emoji-calendar",CSS.AnTabPanelContainer="XHL",CSS.xBorderThin="x-border-thin",CSS.AnPromptChecklist="XRa",CSS.xZindex70="x-zindex-70",CSS.xError="x-error",CSS.xContent="x-content",CSS.FaItalic="XoQ",CSS.xRoundedBottom="x-rounded-bottom",CSS.FaSlack="XsK",CSS.FaArrows="XOm",CSS.xSlideshowPlay="x-slideshow-play",CSS.xSmokescreen="x-smokescreen",CSS.AnIndicatorEvent="Xej",CSS.FaLongArrowRight="XTT",CSS.xMatchT="x-m-t",CSS.AnMarginLeft5="XrV",CSS.xZindex20="x-zindex-20",CSS.FaEyeSlash="Xuo",CSS.FaPlusCircle="XYA",CSS.AnAudioFilename="XBt",CSS.FaHandOUp="XEh",CSS.FaPrint="XMh",CSS.xCode="x-code",CSS.xTitle="x-title",CSS.xBulletDatetime="x-bullet-datetime",CSS.xCalBody="x-cal-body",CSS.AnButtonLeft="XAn",CSS.FaHome="XK4",CSS.AnPromptInputSlider="Xy1",CSS.xToolbarFontsize="x-toolbar-fontsize",CSS.AnFlashSpotlight="XTD",CSS.xAnnotationStyleText="x-a-style-text",CSS.xTemplateButton="x-t-button",CSS.xPageBreakAfter="x-page-break-after",CSS.AnPromptTextarea="Xsx",CSS.Noto="XO7",CSS.xBorderNone="x-border-none",CSS.xRightSidebarPadding="x-rsb-padding",CSS.xMediaCaption="x-media-caption",CSS.AnWsp="Xkm",CSS.FaTag="XCC",CSS.xEmojiAudio="x-emoji-audio",CSS.xPictureframeRotated="x-pictureframe-rotated",CSS.xIndent="x-indent",CSS.FaCalendarO="XLV",CSS.FaArrowCircleUp="Xvt",CSS.AnSmokescreen="Xc0",CSS.xRightSidebarContent="x-rsb-content",CSS.FaSubscript="XUs",CSS.xVideoFilesize="x-video-filesize",CSS.AnBulletList="XFO",CSS.xWidgetToc3="x-w-toc3",CSS.Fa="XrO",CSS.xShadowSe2Black="x-shadow-se2-black",CSS.xBorderOnePx="x-border-onepx",CSS.xVideo="x-video",CSS.FaSquareO="XcX",CSS.AnSpin="XmK",CSS.xBold="x-bold",CSS.xxDrawing="xx-drawing",CSS.xBullet="x-bullet",CSS.AnFlex11Auto="Xn2",CSS.xFloatRightClearNone="x-float-right-clear-none",CSS.AnToasterWarn="Xhz",CSS.AnWindow="XXw",CSS.xAnnotationTarget="x-a-target",CSS.AnPiano="XzW",CSS.AnTreeTable="XEA",CSS.FaCertificate="XZc",CSS.xShadowSe2White="x-shadow-se2-white",CSS.xClientHide="x-client-hide",CSS.FaEdit="Xrg",CSS.FaFlipHorizontal="XXb",CSS.FaClose="Xh7",CSS.FaArrowCircleRight="XVq",CSS.xPlaceholder="x-placeholder",CSS.FaSortAlphaAsc="Xrw",CSS.xHighlightYellow="x-highlight-yellow",CSS.FaLock="XRG",CSS.xWidgetShoppingDesc="x-w-shopping-desc",CSS.xWidgetShoppingQuantity="x-w-shopping-quantity",CSS.xHighlightOrange="x-highlight-orange",CSS.AnDateSelected="XzU",CSS.FaCommentO="XIx",CSS.xRotate="x-rotate",CSS.FaRecycle="XbG",CSS.xColorPlum="x-color-plum",CSS.xAlignJustify="x-align-justify",CSS.FaMicrophone="Xy3",CSS.AnSidepanel="XLs",CSS.xFa="x-fa",CSS.AnFlexCenter="XJg",CSS.xZindex00="x-zindex-00",CSS.AnRightAlignLabel="XKV",CSS.FaBars="X4X",CSS.AnNone="XPV",CSS.AnColorFG="XSu",CSS.FaMinusSquare="XBO",CSS.xEmojiNotes="x-emoji-notes",CSS.xImageholder="x-imageholder",CSS.xRightSplitcontent="x-rightsplitcontent",CSS.AnPromptCheckbox="XCl",CSS.xShadowSeGray="x-shadow-se-gray",CSS.xStickOnScreen="x-stick-on-screen",CSS.xAudioDuration="x-audio-duration",CSS.FaExternalLink="X08",CSS.AnContextmenu="Xg5",CSS.FaSuperscript="XPa",CSS.AnWarning="XPv",CSS.AnPromptSelectExt="XZt",CSS.xZindex50="x-zindex-50",CSS.xPlum="x-plum",CSS.FaChevronLeft="XAF",CSS.AnTreeContainer="XUH",CSS.AnRow="XMm",CSS.AnNot="Xcw",CSS.xHidden="x-hidden",CSS.AnGrayOption="Xsv",CSS.FaKeyboardO="XBa",CSS.AnDirtree="XNy",CSS.AnCalcCell="X1N",CSS.xTodoStatus="x-todo-status",CSS.xRightSplitpanel="x-rightsplitpanel",CSS.AnFlashLowlight="X9m",CSS.FaUpload="X17",CSS.AnFlexStretch="XMN",CSS.AnEventsDate="Xsn",CSS.AnTreeRoot="Xxc",CSS.FaMinusSquareO="X4m",CSS.FaShower="XPI",CSS.FaPlayCircleO="Xcg",CSS.AnCalcDisplay="XEW",CSS.FaFont="XlV",CSS.xFloatRight="x-float-right",CSS.xSlideshowContent="x-slideshow-content",CSS.AnToasterModal="XK8",CSS.AnFlexRowNoWrap="X0S",CSS.FaCode="XCK",CSS.xStickOnDocument="x-stick-on-document",CSS.xListStyleNone="x-list-style-none",CSS.xPeek="x-peek",CSS.FaShare="XPh",CSS.xFlexbox="x-flexbox",CSS.FaTrash="XIc",CSS.xDisabled="x-disabled",CSS.xStrikethrough="x-strikethrough",CSS.AnTitle="XKJ",CSS.FaFileTextO="X98",CSS.AnFilesPanel="X7V",CSS.AnWidth2="Xgo",CSS.FaFileAudioO="XM7",CSS.xShadowOrange="x-shadow-orange",CSS.xMsg="x-msg",CSS.FaEllipsisH="Xyb",CSS.AnButton="XWC",CSS.FaQuoteRight="Xwx",CSS.xWidgetTodoContent="x-w-todo-content",CSS.AnOK="X5p",CSS.xShowInEdit="x-show-in-edit",CSS.FaPlusSquare="XFa",CSS.xAudioChannels="x-audio-channels",CSS.xButton="x-button",CSS.xShadowGray="x-shadow-gray",CSS.AnSpotlight="Xnw",CSS.xAccordionHide="x-accordion-hide",CSS.FaUnderline="XSf",CSS.AnImageViewer="XX6",CSS.AnTn="Xn9",CSS.FaPencil="XQN",CSS.FaPlusSquareO="XfN",CSS.xHideInNarrowScreen="x-hide-in-narrow-screen",CSS.AnPromptContent="X9j",CSS.xLarge="x-large",CSS.xLandscape="x-landscape",CSS.xRed="x-red",CSS.xZindex100="x-zindex-100",CSS.FaThumbsOUp="XAj",CSS.FaRss="Xzn",CSS.AnDateHoliday="XWG",CSS.xWidgetToc4="x-w-toc4",CSS.xAlarm="x-alarm",CSS.FaListUl="XvD",CSS.xHlayout="x-hlayout",CSS.AnSec="XvE",CSS.xBorderThick="x-border-thick",CSS.AnVerticalViewport="Xzr",CSS.AnContextButton="Xcs",CSS.xColorWhite="x-color-white",CSS.AnBulletRow="XzA",CSS.xWide="x-wide",CSS.AnDirpathDir="Xo4",CSS.FaSave="X3K",CSS.FaSlideshare="Xs8",CSS.AnAudioBanner="Xpe",CSS.AnToasterInfo="XW3",CSS.FaShareAlt="XFl",CSS.AnNoto="XTU",CSS.AnButtonPadding="Xqe",CSS.FaGbp="Xcp",CSS.xWidgetTodos="x-w-todos",CSS.AnButtonFa="XV7",CSS.AnSliderHandle="X3t",CSS.xAnnotationContent="x-a-content",CSS.AnSettingsSample="XlE",CSS.xBubble="x-bubble",CSS.FaToggleOff="Xl4",CSS.xMatchA="x-m-a",CSS.xBulletFa="x-bullet-fa",CSS.AnBorderSample="XUB",CSS.FaStarO="XBV",CSS.FaTumblr="X5L",CSS.xBody="x-body",CSS.xxSymbol="xx-symbol",CSS.xMediaPhoto="x-media-photo",CSS.AnPromptAttributes="Xea",CSS.FaBold="XKz",CSS.FaInfo="Xya",CSS.xEmojiSticker="x-emoji-sticker",CSS.xRoundedCorners="x-rounded-corners",CSS.FaChevronRight="Xzy",CSS.xHideInLargeScreen="x-hide-in-large-screen",CSS.xBoldColor="x-bold-color",CSS.FaSpinner="Xoa",CSS.AnSidepanelDocument="XtO",CSS.xDarkblue="x-darkblue",CSS.AnLnk="XY5",CSS.AnSubmenuContainer="X2A",CSS.AnBold="XXS",CSS.xHead1="x-head1",CSS.xFontFixed="x-font-fixed",CSS.FaPaperclip="XVU",CSS.AnAudioControl="Xo0",CSS.xRoot="x-root",CSS.AnHalf="XnF",CSS.FaTimesCircle="X8D",CSS.xLeftSplitpanel="x-leftsplitpanel",CSS.xCalcPrice="x-calc-price",CSS.AnBulletLeft="Xur",CSS.xShadowSeBlack="x-shadow-se-black",CSS.AnRedoItem="X3D",CSS.FaToggleUp="Xb8",CSS.AnImageAnnotator="Xq6";class ClientAction{}ClientAction.move="m/",ClientAction.hide="hide/",ClientAction.show="show/",ClientAction.radio="r/",ClientAction.classes="classes/",ClientAction.style="s/",ClientAction.cycle1="C/",ClientAction.cycle="c/";class DEF{}DEF.contextmenuMargin=10,DEF.dialogMaxWidthMedium=9,DEF.keepLongerDays=7,DEF.templateCSSRule="name value;",DEF.htmlSuffix=".html",DEF.zindexClientShow=500,DEF.maxToastLen=64,DEF.dialogMaxWidthLarge=12,DEF.zindexSidepanel=2100,DEF.LF="\n",DEF.zindexPromptSave=2500,DEF.zindexToasterWarning=5100,DEF.backupKeyPrefix="#",DEF.webkitPrefix="-webkit-",DEF.galleryItemThreshold=24,DEF.zindexClientSearchResult=1200,DEF.zindexPrompt=4100,DEF.opacityEnabled=1,DEF.historyTextLength=64,DEF.Emoji="Emojis",DEF.derSuffix=".der",DEF.LINEBREAK="\n",DEF.BASIS_60=60,DEF.LBRACKET=91,DEF.trashAutoCleanupInterval=864e5,DEF.opacityDisabled=.25,DEF.opacityResizing=.1,DEF.toolbarBG="#ccc",DEF.dailyBackupDir="~DailyBackup~",DEF.CORRECTED=".~c~",DEF.zindexToolbar=1990,DEF.symbolFontSizeRatio=.45,DEF.FontAwesome="FontAwesome",DEF.opacitySmoke=.5,DEF.maxClientActionClassesLength=20,DEF.dialogMaxWidthSmall=7,DEF.backup="backup",DEF.opacityShowBackground=.35,DEF.css="css",DEF.jpegQualityHigh=95,DEF.cssSuffix=".css",DEF.zindexClientStickerOnScreen=75,DEF.themeBoxShadow="2px 2px 10px rgba(0,0,0,0.5)",DEF.zindexContextmenu=4e3,DEF.previewPhotoSize=1024,DEF.recentSymbolCount=100,DEF.themeBorderColor="rgba(0, 0, 0, 0.5)",DEF.jpegQuality=90,DEF.zoomScale=.025,DEF.events="events",DEF.SQUOTE=39,DEF.FRAGMENT=35,DEF.DOT=46,DEF.templateBlank="/assets/templates/blank/blank.html",DEF.opacityTransparent=0,DEF.maxLongToastLen=256,DEF.m4aSuffix=".m4a",DEF.BASIS_20=20,DEF.alarmMargin=500,DEF.System="System",DEF.zindexMax=9999,DEF.backupSuffix=".backup",DEF.heic="heic",DEF.FILESIZE_UNITS=["B","K","M","G","T"],DEF.eventsSuffix=".events",DEF.BASIS_40=40,DEF.pdf="pdf",DEF.keepShorterDays=1,DEF.themeBorderRadius="0.35rem",DEF.QUERY=63,DEF.thumbnailSize=512,DEF.zindexAbove10=10,DEF.zindexConfirm=4900,DEF.maxBarcodeScale=10,DEF.themeBorder="1px solid rgba(0, 0, 0, 0.5)",DEF.BASIS_34=34,DEF.lightBorder="1px solid rgba(0, 0, 0, 0.25)",DEF.jpegQualityThumbnail=85,DEF.ibackup="ibackup",DEF.thumbnailSizeMicro=96,DEF.BASIS_50=50,DEF.keepLongerSizeLimit=16777216,DEF.insertImgAttrString="style width:240px;max-width:50vw;",DEF.filepickerMaxWidth=640,DEF.der="der",DEF.BASIS_66=66,DEF.nobackup="~nobackup~",DEF.xmlNameChars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-",DEF.html="html",DEF.minFontSize=6,DEF.databaseKeyAlias="#db",DEF.maxNodeInfoLen=128,DEF.imageDimensionSnap=128,DEF.keysSuffix=".keys",DEF.zindexClientStickerOnDocument=50,DEF.sidepanelWidth=450,DEF.themeBorderWidthPx="1px",DEF.toolbarFontSizeRatio=.5,DEF.zindexSidebar=2e3,DEF.SEMICOLON=59,DEF.PERCENT=37,DEF.backupKeyAlias="#self",DEF.maxOutputImageArea=16777216,DEF.BASIS_25=25,DEF.zindexUnder=-1,DEF.opacityOpaque=1,DEF.themeBorderWidth=1,DEF.NO_SERIAL=-1,DEF.zindexClientSidepanel=1100,DEF.zipSuffix=".zip",DEF.maxFontSize=64,DEF.BASIS_80=80,DEF.templateCSSRuleset="selector {\n}\n",DEF.zindexResizer=6e3,DEF.tmpBackupSuffix="~tmp~.tmp",DEF.zindexToaster=5e3,DEF.QUOTE=34,DEF.zindexImageAnnotator=3e3,DEF.SLASH=47,DEF.xSidepanelWidth=50,DEF.pdfSuffix=".pdf",DEF.zindexClientSidebar=1800,DEF.heicSuffix=".heic",DEF.RBRACKET=93,DEF.DECIMAL_VALUE_UNITS=["","k","m","g","t"],DEF.dragBorderDivider=2,DEF.ibackupSuffix=".ibackup",DEF.dialogBorderWidth=10,DEF.zoomDelta=5,DEF.zindexClientAnnotation=1300,DEF.recentFilePositionCount=50,DEF.jpegQualityLow=75,DEF.sidepanelMarginBottom=10,DEF.dialogPaddingWidth=10,DEF.zindexAbove100=100,DEF.zindexToasterError=5200,DEF.NOOP="NOOP",DEF.dialogBG="#ddd",DEF.zip="zip";class Effect{}Effect.GRAY2=1,Effect.GRAY256=5,Effect.GRAY16=4,Effect.NONE=0,Effect.GRAY8=3,Effect.GRAY4=2;class EventKey{}EventKey.Done="done",EventKey.Repeat="repeat",EventKey.DoneMs="donems",EventKey.Lastms="lastms",EventKey.Color="color",EventKey.Events="A",EventKey.Ms="ms",EventKey.Version="V",EventKey.Id="id",EventKey.Serial="S",EventKey.Pending="pending",EventKey.Exists="exists",EventKey.Description="desc",EventKey.Private="private",EventKey.Url="url";class EventRepeat{}EventRepeat.Workdays="Workdays",EventRepeat.Yearly="Yearly",EventRepeat.Off="Off",EventRepeat.Weekly="Weekly",EventRepeat.Monthly="Monthly",EventRepeat.Once="Once",EventRepeat.Daily="Daily",EventRepeat.values=["Off","Once","Daily","Workdays","Weekly","Monthly","Yearly"];class FilepickerCmd{}FilepickerCmd.DELETE_DIRSUBTREE=13,FilepickerCmd.DELETE_ALL=14,FilepickerCmd.DELETE=11,FilepickerCmd.FILEINFO=1,FilepickerCmd.LOCAL_IMAGE_THUMBNAILS=18,FilepickerCmd.MKDIRS=7,FilepickerCmd.RENAME=8,FilepickerCmd.LIST_RECURSIVE=21,FilepickerCmd.DELETE_EMPTY_DIRS=20,FilepickerCmd.DIRINFO=23,FilepickerCmd.INVALID=0,FilepickerCmd.DELETE_INFO=15,FilepickerCmd.LISTDIR=4,FilepickerCmd.COPY_INFO=10,FilepickerCmd.COPY=9,FilepickerCmd.FILEINFOS=22,FilepickerCmd.LOCAL_IMAGE_INFOS=17;class FontCategories{}FontCategories.Monospace="Monospace",FontCategories.All="All",FontCategories.System="System",FontCategories.Decorative="Decorative",FontCategories.Serif="Serif",FontCategories.SansSerif="Sans Serif",FontCategories.Others="Others";class FontInfoKey{}FontInfoKey.glyphcount="glyphcount",FontInfoKey.fontfaceformat="fontfaceformat",FontInfoKey.size="size",FontInfoKey.styles="styles",FontInfoKey.glyphs="glyphs",FontInfoKey.url="url",FontInfoKey.license="license",FontInfoKey.category="category",FontInfoKey.glyphnames="glyphnames",FontInfoKey.subsets="subsets",FontInfoKey.fontname="fontname";class GestureEvent{}GestureEvent.leftOutward="lo",GestureEvent.rightOutward="ro",GestureEvent.leftInward="li",GestureEvent.pinchZoom="pz",GestureEvent.rightInward="ri";class GestureKey{}GestureKey.y="y",GestureKey.event="e";class ID{}ID.content="XsS",ID.xRightSidepanel="x-rightsidepanel",ID.xOpenLeftSidepanel="x-open-leftsidepanel",ID.xMarkers="x-markers",ID.sidepanel="Xuq",ID.focusbox="XDf",ID.xContent="x-content",ID.sidebarTemplates="XYK",ID.accessories="Xej",ID.xLeftSplitpanel="x-leftsplitpanel",ID.xLeftSidepanel="x-leftsidepanel",ID.sidebarExplore="Xzh",ID.xRightSidebar="x-rightsidebar",ID.contextmenuSelect="Xa8",ID.xRightSplitpanel="x-rightsplitpanel",ID.csseditor="code",ID.sidebarResize="X5K",ID.splash="Xeh",ID.sidebar="X7j",ID.xViewer="x-viewer",ID.toolbar="XbH",ID.sidebarDocument="XRf",ID.contentIFrame="XdK",ID.searchResult="X1S",ID.xOpenRightSidepanel="x-open-rightsidepanel";class Key{}Key.url="X2A",Key.isregex="XzQ",Key.key="XYE",Key.data="Xaw",Key.rpaths="XqL",Key.isloggedin="Xv2",Key.notcopying="XQp",Key.filename="XT8",Key.fails="X6p",Key.poster="XMf",Key.linkinfo="Xfc",Key.size="XJ9",Key.copying="XZj",Key.overwriting="X2T",Key.count="XS0",Key.isplaying="XOE",Key.expectedfailure="XgS",Key.baseurl="XzJ",Key.meminfo="X4z",Key.element="XPX",Key.stacktrace="Xom",Key.tag="XjR",Key.filter="XOT",Key.errors="XZ7",Key.style="XAK",Key.time="XbR",Key.free="XB9",Key.fileinfo="Xal",Key.result="XXc",Key.links="XhE",Key.busy="Xwn",Key.notdeleting="X3R",Key.cut="Xyy",Key.forward="XYr",Key.recorder="XN2",Key.serial="X8D",Key.dst="XOC",Key.filestat="XRp",Key.hold="Xsi",Key.mime="XXG",Key.filterIgnorecase="XaZ",Key.timestamp="X1J",Key.cssrule="Xs0",Key.pass="XhS",Key.warns="XcK",Key.attrs="XNZ",Key.deleting="Xwl",Key.mediainfo="XUO",Key.rpath="XNg",Key.path="Xv7",Key.dirpath="Xnn",Key.backward="XxN",Key.total="XXa",Key.width="X9J",Key.dimension="XLa",Key.cpath="XKs",Key.infos="XjB",Key.text="XX3",Key.imageinfo="XX2",Key.player="XrC",Key.dirtree="XDt",Key.status="XRb",Key.dirinfo="Xk0",Key.template="XtE",Key.expectedresult="Xvl",Key.tnpath="XHr",Key.src="X7G",Key.height="Xe4",Key.type="XKA",Key.searchIgnorecase="X1Z",Key.id="XRl";class LinkInfoKey{}LinkInfoKey.rel="r",LinkInfoKey.HEAD="H",LinkInfoKey.BODY="B",LinkInfoKey.targetpath="p",LinkInfoKey.status="s",LinkInfoKey.tag="t",LinkInfoKey.name$="n",LinkInfoKey.value="v";class LinkInfoStatus{}LinkInfoStatus.NOTEXISTS="N",LinkInfoStatus.EXISTS="E",LinkInfoStatus.INVALID="I";class LinkVerifierCmd{}LinkVerifierCmd.INVALID=0,LinkVerifierCmd.LINKINFO=2,LinkVerifierCmd.LINKINFOS=1;class MetainfoKey{}MetainfoKey.CreatedBy="C",MetainfoKey.FeatureCalc="Cc",MetainfoKey.Features="F",MetainfoKey.ModifiedBy="M",MetainfoKey.Patches="P";class NAME{}NAME.submenuList="X6w",NAME.submenuOthers="Xsc",NAME.contextmenuGallery="X2D",NAME.contextmenuHighlight="Xe3",NAME.submenuFont="XfT",NAME.contextmenuPara="X5o",NAME.contextmenuTemplate="XI3",NAME.contextmenu="XXB",NAME.contextmenuSelect="Xfu",NAME.submenuPara="XAz",NAME.contextmenuAssists="X8g",NAME.submenuChar="XnR",NAME.contextmenuClasses="XSY",NAME.submenuMedia="XUU",NAME.contextmenuWidget="Xhu",NAME.contextmenuChar="XR0",NAME.contextmenuImage="X8t",NAME.contextmenuPage="XFA";class PATH{}PATH._assetsMonoPng="/assets/images/res/mono.png",PATH._HomeVideos_="/Home/videos/",PATH._assetsGameSudokuCss="/assets/css/gamesudoku.css",PATH._PrivateDrafts_="/Private/drafts/",PATH._PrivateVideos_="/Private/videos/",PATH._internal="/Internal",PATH._HomeIndexHtml="/Home/index.html",PATH._assetsGameSudokuJs="/assets/js/g.js",PATH._Home_="/Home/",PATH._assetsImagesLandscapeSample="/assets/images/samples/backlight.jpg",PATH._assetsTemplates404Html="/assets/templates/res/404.html",PATH._assetsTemplatesIndexHtml="/assets/templates/res/index.html",PATH._assetsCSSEditorJs="/assets/js/c.js",PATH._assetsImagesSamplesAngels="/assets/images/samples/angels.jpg",PATH._HomeImages_="/Home/images/",PATH.HomeIndexHtml="Home/index.html",PATH.assetsCss_="assets/css/",PATH._assetsClientCss="/assets/css/client-v1.css",PATH._assetsManual_="/assets/manual/",PATH._Internal_="/Internal/",PATH._PrivateAudios_="/Private/audios/",PATH._assetsCSSEditorHtml="/assets/templates/res/csseditor.html",PATH._assetsTemplates_="/assets/templates/",PATH._PrivateImages_="/Private/images/",PATH._assetsImagesSig01Png="/assets/images/res/sig01.png",PATH._assetsGameMinesCss="/assets/css/gamemines.css",PATH.assetsTemplatesFaviconIco="assets/templates/res/favicon.ico",PATH.Internal="Internal",PATH.Home="Home",PATH._HomeAudios_="/Home/audios/",PATH.Internal_="Internal/",PATH._assetsAudioSample="/assets/manual/samples/audios/audio-33.m4a",PATH._assetsTemplatesBlogHtml="/assets/templates/blog/blog-v2.html",PATH._Home="/Home",PATH._assetsGameMinesJs="/assets/js/g.js",PATH.External_="External/",PATH._assetsImagesPortraitSample="/assets/images/samples-oilify/pink.jpg",PATH._External_="/External/",PATH._assetsCSSEditorCss="/assets/css/csseditor.css",PATH._assetsClient="/assets/css/client-",PATH._assetsCore="/assets/css/core-",PATH._assetsFontsPng="/assets/images/res/fonts.png",PATH._assetsTemplatesFaviconIco="/assets/templates/res/favicon.ico",PATH.drafts="drafts",PATH._assetsReleaseNotesHtml="/assets/manual/en/release-notes/release-notes.html",PATH._assetsGameSudokuHtml="/assets/templates/res/gamesudoku.html",PATH._assetsTemplates500Html="/assets/templates/res/500.html",PATH._assets_="/assets/",PATH._assetsCss_="/assets/css/",PATH.Home_="Home/",PATH._assetsGameMindsHtml="/assets/templates/res/gameminds.html",PATH._assetsGameMinesHtml="/assets/templates/res/gamemines.html",PATH._assetsVideoSample="/assets/manual/samples/videos/BasicEditing.mp4",PATH._assetsGameMindsCss="/assets/css/gameminds.css",PATH._assetsImagesSamplesLamp="/assets/images/samples/lamp.jpg",PATH.External="External",PATH.assetsTemplates_="assets/templates/",PATH._HomeDrafts_="/Home/drafts/",PATH.assetsTemplatesIndexHtml="assets/templates/res/index.html",PATH._assetsGameMindsJs="/assets/js/g.js";class Param{}Param.ignorecase="ignorecase",Param.create="create",Param.view="view",Param.seek="seek",Param.path="path",Param.save="save",Param.t="t",Param.fragment="fragment",Param.poster="poster",Param.mime="mime",Param.edit="edit",Param.isregex="isregex",Param.searchtext="searchtext",Param.session="s",Param.msg="msg",Param.redirect="redirect";class Placeholder{}Placeholder.xpShortDate="short-date",Placeholder.xpAnnotation="annotation",Placeholder.xpDatetime="datetime",Placeholder.xpAudio="audio",Placeholder.xpShortDatetime="short-datetime",Placeholder.xpCanvasPhoto="canvas-photo",Placeholder.xpAnnotationPhoto="a-photo",Placeholder.xpVideo="video",Placeholder.xpImage="image",Placeholder.xpCalendar="calendar",Placeholder.xpCanvas="canvas",Placeholder.xpImageNoCaption="image0",Placeholder.xpShortTime="short-time",Placeholder.xpAnnotationImage="a-image",Placeholder.xpAudio2="audio2",Placeholder.xpTime="time",Placeholder.xpDraggable="draggable",Placeholder.xpVideoinfo="videoinfo",Placeholder.xpPhoto="photo",Placeholder.xpAudioinfo="audioinfo",Placeholder.xpCanvasImage="canvas-image",Placeholder.xpDate="date";class ROLE{}ROLE.Generated="generated";class RecentsCmd{}RecentsCmd.INFO=3,RecentsCmd.BACK=4,RecentsCmd.CLEAN=2,RecentsCmd.INVALID=0,RecentsCmd.PEEK=5,RecentsCmd.CLEAR=1,RecentsCmd.FORWARD=6;class SessionParam{}SessionParam.y="y",SessionParam.poster="p",SessionParam.z="z",SessionParam.X_ROOT="x-root",SessionParam.type="t",SessionParam.x="x",SessionParam.XROOT="X";class SessionPreferencesKey{}SessionPreferencesKey.gameMindsDigits="GMDD",SessionPreferencesKey.symbolFamily="symbolFamily",SessionPreferencesKey.gameSudokuSave="GSDS",SessionPreferencesKey.trashAutoCleanupTimestamp="TACT",SessionPreferencesKey.indentTab="INDT",SessionPreferencesKey.imageDefaultOutputSize="IDOS",SessionPreferencesKey.sidepanelWidth="SPWD",SessionPreferencesKey.gameMinesSave="GMIS",SessionPreferencesKey.gameMinesDifficulty="GMID",SessionPreferencesKey.gameMinesMapSize="GMIM",SessionPreferencesKey.symbolRecents="symbolRecents",SessionPreferencesKey.gameSudokuDifficulty="GSDD",SessionPreferencesKey.gameSudokuAssists="GSDA",SessionPreferencesKey.gameMindsSave="GMDS",SessionPreferencesKey.filePositions="filePositions",SessionPreferencesKey.templatesRecents="TR",SessionPreferencesKey.showDoneEvents="showDoneEvents",SessionPreferencesKey.gameMindsCells="GMDC";class SettingsKey{}SettingsKey.buttonSize="buttonSize",SettingsKey.timeFormat="timeFormat",SettingsKey.fixedFontSize="fixedFontSize",SettingsKey.imageDimension="imageDimension",SettingsKey.current="current",SettingsKey.uiFontStyle="uiFontStyle",SettingsKey.bgImgSamples="bgImgSamples",SettingsKey.symbolFamilies="symbolFamilies",SettingsKey.annotationColor="annotationColor",SettingsKey.uiFontSize="uiFontSize",SettingsKey.highlightStyles="highlightStyles",SettingsKey.dateFormat="dateFormat",SettingsKey.fixedFontStyle="fixedFontStyle",SettingsKey.highlightColor="highlightColor",SettingsKey.fontFamilies="fontFamilies",SettingsKey.headingColor="boldColor",SettingsKey.uiFontName="uiFontName",SettingsKey.defaults="defaults",SettingsKey.dialogBGColor="dialogBGColor",SettingsKey.paraStyles="paraStyles",SettingsKey.fontCategories="fontCategories",SettingsKey.charStyles="charStyles",SettingsKey.fixedFontName="fixedFontName",SettingsKey.builtinParaStyles="builtinParaStyles",SettingsKey.builtinCharStyles="builtinCharStyles",SettingsKey.htmlTemplates="htmlTemplates",SettingsKey.linkColor="linkColor";class StyleKey{}StyleKey.label="label",StyleKey.group="group",StyleKey.name$="name";class TemplateAction{}TemplateAction.cutNotMarked="X",TemplateAction.form="form",TemplateAction.delete="d",TemplateAction.style="s",TemplateAction.radio="r",TemplateAction.cycle="c",TemplateAction.postAlarm="alarm",TemplateAction.show="show",TemplateAction.save="save",TemplateAction.cutMarked="x",TemplateAction.classes="classes",TemplateAction.drag="g",TemplateAction.blog="b",TemplateAction.cycle1="C",TemplateAction.template="t",TemplateAction.widget="widget",TemplateAction.annotation="a",TemplateAction.move="m",TemplateAction.hide="hide";class TemplateCat{}TemplateCat.Home="Home",TemplateCat.Photo="Photo",TemplateCat.Canvas="Canvas",TemplateCat.Blog="Blog",TemplateCat.Audio="Audio";class TemplateMenuKey{}TemplateMenuKey.backgroundImage="i",TemplateMenuKey.label="l",TemplateMenuKey.action="a",TemplateMenuKey.name$="n",TemplateMenuKey.background="b",TemplateMenuKey.symbol="s",TemplateMenuKey.menu="m",TemplateMenuKey.backgroundSize="S",TemplateMenuKey.classes="c",TemplateMenuKey.cmd="C",TemplateMenuKey.path="p",TemplateMenuKey.lcCat="t";class TemplateName{}TemplateName.homeSimpler="home-simpler",TemplateName.photoWall="photo-wall",TemplateName.mediaWall="media-wall",TemplateName.mediaSticker="media-sticker",TemplateName.photoSticker1="photo-sticker1",TemplateName.blogV2="blog-v2",TemplateName.audioV2="audio-v2";class XAction{}XAction.view="view";class XInfoKey{}XInfoKey.seek="seek";class XrefKey{}XrefKey.LINKS="l",XrefKey.POSITION="p";class XrefKind{}XrefKind.ANCHOR=2,XrefKind.VIDEO=16,XrefKind.IMAGE=4,XrefKind.SRCSET=1024,XrefKind.SRC=512,XrefKind.AUDIO=8,XrefKind.OTHER=128,XrefKind.STYLESHEET=1,XrefKind.HREF=256;class _TemplatesJSONKey{}_TemplatesJSONKey.label="label",_TemplatesJSONKey.aliases="aliases",_TemplatesJSONKey.emoji="emoji",_TemplatesJSONKey.category="category",_TemplatesJSONKey.name$="name",_TemplatesJSONKey.templates="templates",_TemplatesJSONKey.desc="desc",_TemplatesJSONKey.classes="classes",_TemplatesJSONKey.template="template",_TemplatesJSONKey.filepath="filepath";class EventInfo{constructor(t){this.event$=t}static of_(t){return null==t?null:new EventInfo(t)}static arrayOf_(t){return Object.values(t).map(t=>new EventInfo(t))}static create_(t,e,i,n,s,o){return new EventInfo(json_([EventKey.Id,t],[EventKey.Ms,e],[EventKey.Repeat,EventRepeat.Once],[EventKey.Private,i],[EventKey.Description,n],[EventKey.Color,s],[EventKey.Url,o]))}copy_(...t){const e=this.filter_();for(const[i,n]of t)e[i]=n;return e}filter_(t=null){return StringMap.filter_(this.event$,([e,i])=>("string"!=typeof i||i.length>0)&&("boolean"!=typeof i||!0===i)&&(null==t||t([e,i])))}filterx_(t=null){return this.filter_(([e,i])=>e!=EventKey.Exists&&e!=EventKey.Pending&&(null==t||t([e,i])))}createTodoItem(t){const e=this.done$?` ${XX.xxDone}`:"",i=DomBuilderEx.offline_(t,"li",smap_(["class",`${XX.xxTodo} xx-status04${e}`],[ATTR.xInfo,JSON.stringify(this.filterx_())],[ATTR.xRole,EventKey.Done])),n=i.cursor_();i.push_().span1_(XX.xxStatus),i.pop_().span1_(XX.xxContent).indent_(i.push_().code_(["class",`${XX.xxDate} ${XX.xxHighlight} ${CSS.xDate}`],[ATTR.xFormat,`${settings$.dateFormat_()};;${this.ms$}`],[ATTR.xRole,EventKey.Ms]).text_(settings$.dateString_(new DateTime(this.ms$))),i.peek_().text_(" "),i.peek_().span_(["class",`${XX.xxHighlight} ${CSS.xSubject}`],[ATTR.xRole,EventKey.Description]).text_(this.desc$),i.pop_().ul1_(CSS.xNone,CSS.xContent).indent_(i.push_().li1_(CSS.xList).indent_(i.push_().span_(["class",`${CSS.xBulletFa} fa-bell-o`]),i.pop_().span_([ATTR.xRole,EventKey.Repeat]).text_(this.repeat$)),i.pop_()));const s=this.url$,o=An.parseUriSafe_(s,null);if(s.length>0&&null!=o){const t=An.labelFromBasepath_(new Basepath(...o.pathSegments$));i.li1_(CSS.xList).indent_(i.push_().span_(["class",`${CSS.xBulletFa} fa-link`]),i.pop_().ahref_(s,[ATTR.xRole,EventKey.Url]).text_(t))}return n}get ms$(){return this.event$[EventKey.Ms]}get id$(){return this.event$[EventKey.Id]}get repeat$(){var t;return null!==(t=this.event$[EventKey.Repeat])&&void 0!==t?t:EventRepeat.Once}get desc$(){var t;return null!==(t=this.event$[EventKey.Description])&&void 0!==t?t:""}get color$(){var t;return null!==(t=this.event$[EventKey.Color])&&void 0!==t?t:""}get url$(){var t;return null!==(t=this.event$[EventKey.Url])&&void 0!==t?t:""}get done$(){return!0===this.event$[EventKey.Done]}get doneMs$(){return this.event$[EventKey.DoneMs]}get private$(){return!0===this.event$[EventKey.Private]}get pending$(){return!0===this.event$[EventKey.Pending]}get exists$(){return!0===this.event$[EventKey.Exists]}get date$(){return DateTime.fromMillisecondsSinceEpoch_(this.ms$)}}class SymbolInfo{static create_(t,e,i){return smap_([SymbolInfoKey.family,t],[SymbolInfoKey.name$,e],[SymbolInfoKey.text,i])}static family_(t){return t[SymbolInfoKey.family]}static name_(t){return t[SymbolInfoKey.name$]}static text_(t){return t[SymbolInfoKey.text]}}class EffectUtil extends Effect{static get_(t){let e=EffectUtil.Names.indexOf(t);return e>=0?e:0}static getAdjust(t,e){const i=this._defaultAdjust[t<0||t>=EffectUtil._defaultAdjust.length?0:t];return An.clamp_(0,100,An.parseDouble_(e,i[0]))*i[1]}static getDefaultAdjust_(t){return t<0||t>=EffectUtil._defaultAdjust.length?EffectUtil._defaultAdjust[0][0]:EffectUtil._defaultAdjust[t][0]}static tostring_(t){return t>=0&&t<EffectUtil.Names.length?EffectUtil.Names[t]:EffectUtil.Names[Effect.NONE]}}EffectUtil.Names=["","Black and white","Gray (4 levels)","Gray (8 levels)","Gray (16 levels)","Gray (256 levels)"],EffectUtil._defaultAdjust=[[0,1],[20,1],[20,.5],[40,.25],[40,.125],[80,1]];class BackdropFilter{}BackdropFilter.FILTERS$=[MSG.string_(RS.None),MSG.string_(RS.Filter_blur),MSG.string_(RS.Filter_brightness),MSG.string_(RS.Filter_contrast),MSG.string_(RS.Filter_grayscale),MSG.string_(RS.Filter_hueRotate),MSG.string_(RS.Filter_invert),MSG.string_(RS.Filter_opacity),MSG.string_(RS.Filter_saturate),MSG.string_(RS.Filter_sepia)],BackdropFilter.DEF$=["","50px","1.25","1.5","1.0","180deg","1.0","0.5","2.0","1.0"],BackdropFilter.RANGE$=[[0,0,0],[0,100,1],[0,10,.1],[0,10,.1],[0,1,.01],[0,360,5],[0,1,.01],[0,1,.01],[0,10,.1],[0,1,.01]];class DEFUtil{static dialogChromeWidth_(t){return 2*DEF.dialogBorderWidth+2*DEF.dialogPaddingWidth}static dialogChromeHeight_(t){return t+2*DEF.dialogBorderWidth+DEF.dialogPaddingWidth}static dialogBottom_(){return 20+DEF.dialogPaddingWidth+DEF.dialogBorderWidth+4}static dragBorder_(t){return DEF.dialogPaddingWidth}static sidepanelWidth_(t){return 7*t}}DEFUtil.prefixPhoto$="photo-",DEFUtil.prefixScan$="scan-",DEFUtil.undoHistorySize=99,DEFUtil.filterDelay$=500,DEFUtil.doubleClickDuration$=300,DEFUtil.flashDuration=150,DEFUtil.spotlightDuration$=500,DEFUtil.searchHighlightDuration$=5e3,DEFUtil.duration0$=0,DEFUtil.duration1$=1,DEFUtil.duration25$=25,DEFUtil.durationDay$=DateTime.DAY,DEFUtil.durationTooltips$=2e3,DEFUtil.hideKeyboardDelay$=0,DEFUtil.hideRightSidebarDuration$=5e3,DEFUtil.imageViewerTimeout$=5e3,DEFUtil.showKeyboardDelay$=0,DEFUtil.showSpinnerDelay$=250,DEFUtil.sidepanelTransition$=150,DEFUtil.toggleKeyboardDelay$=0;class PathUtil{static isValidFilepath(t){return null!=t&&0!=t.length&&this.isValidFilepathSegments(t.split("/"))}static isValidFilepathSegments(t){if(0==t.length)return!1;for(const e of t)if(!this.isValidFilename(e))return!1;return!0}static isValidFilename(t){if(t.startsWith(".")&&"."!=t&&".."!=t)return!1;for(const e of Ut.codepoints_(t))if(void 0===e||!An.isValidFilenameChar_(e))return!1;return t.trim().length==t.length}static isBackupsSubtree(t){return null!=t&&PathUtil._isUnder(t,PathUtil.internalExternal$)}static isDocumentsSubtree(t){return null!=t&&PathUtil._isUnder(t,PathUtil.homePrivate$)}static isDocumentsDir(t){return null!=t&&(PathUtil._isOneOf(t,PathUtil.homePrivate)||PathUtil._isOneOf(t,PathUtil.homePrivate$))}static isDocumentsTree(t){return null!=t&&(PathUtil._isUnder(t,PathUtil.homePrivate$)||PathUtil._isOneOf(t,PathUtil.homePrivate$)||PathUtil._isOneOf(t,PathUtil.homePrivate))}static isPublicDocumentsSubtree(t){return null!=t&&PathUtil._isUnder(t,PathUtil.home$)}static isTemplatesPath(t){return null!=t&&(t.startsWith(PATH._assetsTemplates_)||t.startsWith(PATH.assetsTemplates_))}static isCssPath(t){return null!=t&&(t.startsWith(PATH._assetsCss_)||t.startsWith(PATH.assetsCss_))}static isDefaultStylesheet(t){return null!=t&&t.endsWith(DEF.cssSuffix)&&(t.startsWith(PATH._assetsCss_)||t.startsWith(PATH.assetsCss_))}static getAudiosDir(t){return PATH._HomeAudios_}static getVideosDir(t){return PATH._HomeVideos_}static getDraftsDir(t){return PATH._HomeDrafts_}static getHomeDir(t){return PATH._Home_}static getImagesDir(t){return PATH._HomeImages_}static publicHomePath(t){return null==t?null:`${PATH._Home}/${An.removeLeadingSlashes_(t)}`}static notexistsAudioPath(){return`notexists.${MimeUtil.audioRecordingExt()}`}static notexistsVideoPath(){return`notexists.${MimeUtil.videoRecordingExt()}`}static getFilenameFromMediaInfo(t){let e=t.title_();if(null!=e)return e;let i=t.uri_();if(null==i)return null;try{let t=An.parseUri_(i,null).path$;return Basepath.nameWithSuffix_(t)}catch(t){}return null}static createOutputFilenameFromImageInfo(t,e){let i=PathUtil.getFilenameFromMediaInfo(e);return i=null==i?t+An.simpleDateTimeString_()+".jpg":PathUtil.createOutputImageExt(new Basepath(i))}static createOutputImageExt(t){let e=MimeUtil.imageMimeFromLcExt(t.lcExt$);return MimeUtil.JPEG==e||MimeUtil.PNG==e||MimeUtil.HEIC==e?t.nameWithSuffix$:t.nameWithoutSuffix$+".jpg"}static _isUnder(t,e){for(let i of e)if(t.startsWith(i)&&t.length>i.length)return!0;return!1}static _isOneOf(t,e){return e.indexOf(t)>=0}}PathUtil.home$=[PATH._Home_,PATH.Home_],PathUtil.homePrivate$=[PATH._Home_,PATH.Home_],PathUtil.homePrivate=[PATH._Home,PATH.Home],PathUtil.internalExternal$=[PATH._Internal_,PATH.Internal_,PATH._External_,PATH.External_];class TemplatesInfo{constructor(t){this.info$=t}static of_(t){return null==t?null:new TemplatesInfo(t)}aliases_(){return this.info$[_TemplatesJSONKey.aliases]}templates_(){return this.info$[_TemplatesJSONKey.templates]}template_(){return this.info$[_TemplatesJSONKey.template]}cat_(){return this.info$[_TemplatesJSONKey.category]}name_(){return this.info$[_TemplatesJSONKey.name$]}label_(){return this.info$[_TemplatesJSONKey.label]}classes_(){return this.info$[_TemplatesJSONKey.classes]}filepath_(){return this.info$[_TemplatesJSONKey.filepath]}emoji_(){return this.info$[_TemplatesJSONKey.emoji]}desc_(){return this.info$[_TemplatesJSONKey.desc]}lcCat_(){return this.cat_().toLowerCase()}}class SK{}SK.Display="display",SK.Position="position",SK.Visibility="visibility",SK.Width="width",SK.Height="height",SK.Top="top",SK.Left="left";class SV{}SV.Hidden="hidden",SV.Visible="visble",SV.None="none",SV.Inline="inline",SV.Block="block",SV.Flex="flex",SV.InlineFlex="inline-flex",SV.Relative="relative",SV.Absolute="absolute",SV.Fixed="fixed";class CSSLength{}CSSLength.PX="px",CSSLength.PT="pt",CSSLength.PC="pc",CSSLength.IN="in",CSSLength.CM="cm",CSSLength.MM="mm",CSSLength.REM="rem",CSSLength.EM="em",CSSLength.EX="ex",CSSLength.CH="ch",CSSLength.VW="vw",CSSLength.VH="vh",CSSLength.VMIN="vmin",CSSLength.VMAX="vmax",CSSLength.PERCENT="%";const CSSLengths=[CSSLength.PX,CSSLength.PT,CSSLength.PC,CSSLength.IN,CSSLength.CM,CSSLength.MM,CSSLength.REM,CSSLength.EM,CSSLength.EX,CSSLength.CH,CSSLength.VW,CSSLength.VH,CSSLength.VMIN,CSSLength.VMAX,CSSLength.PERCENT];class PV{}PV.TextAlign=["","center","justify","start","end","left","right","inherit","unset"],PV.VerticalAlign=["","middle","baseline","top","bottom","text-top","text-bottom","super","sub","inherit","unset"],PV.Float=["","none","left","right","inherit","unset"],PV.Clear=["","none","left","right","both","inherit","unset"],PV.Display=["","block","flex","inline","inline-block","inline-flex","inline-table","list-item","none","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","unset"];class RX{static regexOrNull(t,e){try{return RegExp(t,e)}catch(t){return null}}}RX.Comma1=new RegExp("^\\s*,\\s*(.*)$"),RX.CommaSeparated=new RegExp("\\s*,\\s*"),RX.CommaSpace=new RegExp("[,\\s]+"),RX.CommaSpace_g=new RegExp("[,\\s]+","g"),RX.SemicolonSpace=new RegExp("\\s*;\\s*"),RX.CSSValue=new RegExp("^(.*?)\\s*:\\s*(.*)$"),RX.CSSAngle=new RegExp("^(\\d+(deg|rad|grad|turn)|to(\\s+(top|right|bottom|left))(\\s+(top|right|bottom|left))?)$","i"),RX.CSSColorValue=new RegExp("^(.*?)(#[0-9a-fA-f]+|rgba?\\(.*?\\))(.*)$"),RX.CSSColorValue1=new RegExp("^(#[0-9a-fA-f]+|rgba?\\(.*?\\))(.*)$"),RX.CSSUrlValue=new RegExp("^(.*?)(url\\(.*?\\)\\s*)(.*)$"),RX.StartsWithDigit=new RegExp("^(\\d+)"),RX.Decimals=new RegExp("^\\d+$"),RX.EndsWithWhitespaces=new RegExp("[\\s\\r\\n\\f\\u200b]$"),RX.Funcall=new RegExp("^([-\\w]+)\\s*(\\(.*?\\)).*$"),RX.Gradients=new RegExp("^((repeating-)?(linear|radial)-gradient)\\("),RX.HostPort=new RegExp("^.*?://[^/]*(:\\d+)?"),RX.HtmlMime=new RegExp("^text/html(;.*)?$","i"),RX.HtmlAmp=new RegExp("&(amp|lt|gt|apos|quot);","i"),RX.HtmlEntity_G=new RegExp("&(#x([0-9a-fA-F]+)|#([0-9]+)|amp|lt|gt|apos|quot);","ig"),RX.IsWhitespaces=new RegExp("^[\\s\\r\\n\\f\\u200b]*$"),RX.InvalidFilenameChars=new RegExp("[\\\\?\\#\\%;\\[\\]]"),RX.Linebreaks=new RegExp("[\\r\\n]"),RX.Linebreaks_g=new RegExp("(\\r\\n?|\\n)","g"),RX.NonSpaces=new RegExp("(\\S+)"),RX.Sides2=new RegExp("^(top|right|bottom|left)(\\s+(top|right|bottom|left))?$","i"),RX.SizeUnit=new RegExp("^([\\d.]+)(.*)$"),RX.ValueUnit=new RegExp("^([-+]?[\\d.]+)(.*)$"),RX.Slashes=new RegExp("/+"),RX.Slashes_g=new RegExp("/+","g"),RX.Space=new RegExp("\\s"),RX.Spaces=new RegExp("\\s+"),RX.Spaces_g=new RegExp("\\s+","g"),RX.StartsWithWhitespaces=new RegExp("^[\\s\\r\\n\\f\\u200b]"),RX.Tn=new RegExp("^(.*)-tn(\\d+x?\\d*)?(\\.\\w+)\\s*$","i"),RX.UpperCaseLetter=new RegExp("([A-Z])"),RX.UpperCaseLetter_g=new RegExp("([A-Z])","g"),RX.Word1=new RegExp("^\\w+$"),RX.DoubleNumber=new RegExp("^.*?([-+]?\\s*([0-9][0-9,\\s]*(\\.\\s*[0-9][0-9,\\s]*)?|\\.\\s*[0-9][0-9,\\s]*)([eE]\\s*[-+]?\\s*[0-9][0-9,\\s]*)?).*$"),RX._CSSUrl=new RegExp("url\\(\\s*((?![\"']).*?)\\s*\\)"),RX._CSSUrlQQ=new RegExp('url\\(\\s*"([^"]+?)(")\\s*\\)'),RX._CSSUrlQ=new RegExp("url\\(\\s*'([^']+?)(')\\s*\\)"),RX._CSSUrlHostPort=new RegExp("(url\\()\\s*(?![\"'])\\w+://\\w+(:\\d+)?(.*?\\s*\\))"),RX._CSSUrlHostPortQQ=new RegExp('(url\\(\\s*")\\w+://\\w+(:\\d+)?(.*?"\\s*\\))'),RX._CSSUrlHostPortQ=new RegExp("(url\\(\\s*')w+://\\w+(:\\d+)?(.*?'\\s*\\))"),RX._QQ_G=new RegExp("[]","g"),RX._Q_G=new RegExp("[]","g");class Assert{static assertion_(t,e=""){if(!t)throw Assert._fail(e)}static assertionKey_(t,e){if(!t)throw Assert._fail(null==e?"":MSG.string_(e))}static fail_(t=""){throw Assert._fail(t)}static notNull_(t){if(null==t)throw Assert._fail(MSG.string_(RS.AssertNotNull));return t}static notReach_(t=null){let e=MSG.string_(RS.AssertNotReach);return Assert._fail(null==t?e:e+": "+t)}static invalidAction_(t){return Assert._fail(MSG.string_(RS.invalidAction_)+t)}static abstractMethod_(){return Assert._fail(MSG.string_(RS.AbstractMethodNotImplemented))}static unsupportedOperation_(t=null){let e=MSG.string_(RS.AssertUnsupportedOperation);return Assert._fail(null==t?e:e+": "+t)}static _fail(t){return MSG.string_(RS.AssertFail_)}}class Html5{static canEditTag(t){var e;return void 0===(null===(e=Html5._tags.get(t))||void 0===e?void 0:e.get(Html5._XEDIT))}static canSplitTag(t){var e;return!0===(null===(e=Html5._tags.get(t))||void 0===e?void 0:e.get(Html5._SPLIT))}static isEmptyTag(t){var e;return!0===(null===(e=Html5._tags.get(t))||void 0===e?void 0:e.get(Html5._EMPTY))}}Html5._EMPTY="E",Html5._XEDIT="X",Html5._SPLIT="S",Html5._tags=map_(["RP",null],["FORM",null],["FIELDSET",null],["LEGEND",null],["PARAM",map_([Html5._EMPTY,!0])],["RUBY",null],["BDI",null],["U",null],["A",null],["MAP",null],["ABBR",null],["DETAILS",null],["BDO",null],["Q",null],["FONT",null],["COLGROUP",null],["META",map_([Html5._EMPTY,!0])],["H3",null],["DEL",null],["TH",null],["OUTPUT",null],["DOCTYPE",map_([Html5._EMPTY,!0])],["CITE",null],["SELECT",null],["TABLE",null],["LI",map_([Html5._SPLIT,!0])],["ADDRESS",null],["DFN",null],["CANVAS",null],["H4",null],["H1",null],["COL",map_([Html5._EMPTY,!0])],["ASIDE",null],["DT",null],["STYLE",null],["OL",null],["UL",null],["HEADER",null],["B",null],["THEAD",null],["SOURCE",map_([Html5._EMPTY,!0])],["PICTURE",null],["FIGCAPTION",null],["SECTION",map_([Html5._SPLIT,!0])],["VAR",null],["S",null],["LINK",map_([Html5._EMPTY,!0])],["METER",null],["KEYGEN",null],["IMG",map_([Html5._EMPTY,!0])],["ARTICLE",map_([Html5._SPLIT,!0])],["SMALL",null],["DATA",null],["DL",map_([Html5._SPLIT,!0])],["SUP",null],["BLOCKQUOTE",null],["LABEL",null],["BASE",map_([Html5._EMPTY,!0])],["RT",null],["H5",null],["HR",map_([Html5._EMPTY,!0])],["TFOOT",null],["DIALOG",null],["MARK",map_([Html5._EMPTY,!0])],["NOSCRIPT",null],["TBODY",null],["P",null],["PROGRESS",null],["SAMP",null],["H6",null],["EM",null],["CODE",null],["FIGURE",null],["AUDIO",null],["TR",map_([Html5._SPLIT,!0])],["DATALIST",null],["OPTGROUP",null],["HTML",null],["BUTTON",null],["STRONG",null],["SUB",null],["BR",map_([Html5._EMPTY,!0])],["SUMMARY",null],["OPTION",null],["RTC",null],["MAIN",null],["CAPTION",null],["MENU",null],["TITLE",null],["TEXTAREA",null],["HEAD",null],["TD",null],["INS",null],["INPUT",map_([Html5._EMPTY,!0])],["DD",null],["DIV",null],["PRE",null],["RB",null],["TRACK",map_([Html5._EMPTY,!0])],["VIDEO",null],["NAV",null],["MENUITEM",null],["FOOTER",null],["SPAN",null],["TEMPLATE",null],["AREA",map_([Html5._EMPTY,!0])],["KBD",null],["WBR",map_([Html5._EMPTY,!0])],["H2",null],["TIME",null],["I",null],["EMBED",map_([Html5._XEDIT,!0],[Html5._EMPTY,!0])],["BODY",null]),Html5.validChildren=new Map([["OL",["LI"]],["UL",["LI"]],["DL",["DD","DT"]],["TABLE",["TBODY","THEAD","TFOOT","COLGROUP","CAPTION","TR"]],["TBODY",["TR"]],["THEAD",["TR"]],["TFOOT",["TR"]],["TR",["TD","TH"]],["AUDIO",["SOURCE","TRACK"]],["VIDEO",["SOURCE","TRACK"]]]),Html5.validParent=new Map([["LI",["OL","UL"]],["DD",["DL"]],["DT",["DL"]],["TD",["TR"]],["TR",["TABLE","TBODY","THEAD","TFOOT"]],["TBODY",["TABLE"]],["THEAD",["TABLE"]],["TFOOT",["TABLE"]],["COLGROUP",["TABLE"]],["CAPTION",["TABLE"]],["SOURCE",["AUDIO","VIDEO"]],["TRACK",["AUDIO","VIDEO"]]]);class Events{}Events.click="click",Events.touchstart="touchstart",Events.touchmove="touchmove",Events.touchend="touchend",Events.touchcancel="touchcancel",Events.mousedown="mousedown",Events.mousemove="mousemove",Events.mouseup="mouseup",Events.contextmenu="contextmenu";class ImageOutputInfo{constructor(t,e,i,n,s,o,l,a){this.filepath=t,this.cpath=e,this.width=i,this.height=n,this.rotation=s,this.effect=o,this.adjust=l,this.quality=a}}class ImageTnOutputInfo extends ImageOutputInfo{constructor(t,e,i,n,s,o,l,a,r,_){super(t,e,i,n,s,o,l,a),this.tnwidth=r,this.tnheight=_}static from_(t,e,i){return new ImageTnOutputInfo(t.filepath,t.cpath,t.width,t.height,t.rotation,t.effect,t.adjust,t.quality,e,i)}}class MediaInfo{constructor(t){this.info$=t}static of_(t){return null==t?null:new MediaInfo(t)}static arrayOf_(t){return null==t?null:t.map(t=>new MediaInfo(t))}json_(){return this.info$}id_(){return this.info$[MediaInfo.Id].toString()}title_(){var t;return null!==(t=this.info$[MediaInfo.Title])&&void 0!==t?t:null}bitrate_(){var t;return null!==(t=this.info$[MediaInfo.Bitrate])&&void 0!==t?t:null}channels_(){var t;return null!==(t=this.info$[MediaInfo.Channels])&&void 0!==t?t:null}creationDate_(){var t;return null!==(t=this.info$[MediaInfo.CreationDate])&&void 0!==t?t:null}fileDate_(){var t;return null!==(t=this.info$[MediaInfo.FileDate])&&void 0!==t?t:0}fileSize_(){var t;return null!==(t=this.info$[MediaInfo.FileSize])&&void 0!==t?t:0}fileExists_(){return!0===this.info$[MediaInfo.FileExists]}playable_(){return 1==this.info$[MediaInfo.Playable]}duration_(){var t;return null!==(t=this.info$[MediaInfo.Duration])&&void 0!==t?t:0}duration1_(t){var e;return null!==(e=this.info$[MediaInfo.Duration])&&void 0!==e?e:t}width_(){var t;return null!==(t=this.info$[MediaInfo.Width])&&void 0!==t?t:0}height_(){var t;return null!==(t=this.info$[MediaInfo.Height])&&void 0!==t?t:0}mime_(){var t;return null!==(t=this.info$[MediaInfo.Mime])&&void 0!==t?t:null}description_(t=""){var e;return null!==(e=this.info$[MediaInfo.Description])&&void 0!==e?e:t}uri_(){var t;return null!==(t=this.info$[MediaInfo.Uri])&&void 0!==t?t:null}rotation_(){var t;return null!==(t=this.info$[MediaInfo.Rotation])&&void 0!==t?t:null}hasStagingId_(){return null!=this.stagingId_()}isPrivate_(){return 1==this.info$[MediaInfo.Private]}stagingId_(){var t;return null!==(t=this.info$[MediaInfo.StagingId])&&void 0!==t?t:null}tnInfo_(){var t;return null!==(t=this.info$[MediaInfo.TnInfo])&&void 0!==t?t:null}setTnInfo_(t){this.info$[MediaInfo.TnInfo]=t}dataUrl_(){var t;return null!==(t=this.info$[MediaInfo.DataUrl])&&void 0!==t?t:null}tnDataUrl_(){var t,e;return null!==(e=null===(t=this.tnInfo_())||void 0===t?void 0:t[MediaInfo.DataUrl])&&void 0!==e?e:null}error_(){var t;return null!==(t=this.info$[MediaInfo.Error])&&void 0!==t?t:null}isVideo_(){var t,e;return null!==(e=null===(t=this.mime_())||void 0===t?void 0:t.startsWith("video/"))&&void 0!==e&&e}resolution_(t){let e=this.width_(),i=this.height_();return e>0&&i>0?`${e}x${i}`:t}tostring_(t,e){var i;const n=null!==(i=this.info$[t])&&void 0!==i?i:null;return null==n?e:n.toString()}static briefMessage_(t,e){let i=e.fileDate_(),n=e.fileSize_();return(null==i?"???":DateFormat.dateStringFromMs(t,i))+""+(null==n?"???":An.filesizeUnit4_(n))+""+e.title_()}}MediaInfo.CreationDate="#XqK",MediaInfo.StagingId="#Xoi",MediaInfo.Uri="#XOu",MediaInfo.SampleRate="#Xm8",MediaInfo.Private="#XsM",MediaInfo.Description="#XNL",MediaInfo.Rotation="#XHA",MediaInfo.FileSize="#X86",MediaInfo.DataUrl="#XUn",MediaInfo.Channels="#X7h",MediaInfo.Playable="#XEP",MediaInfo.Id="#Xt8",MediaInfo.FrameRate="#X1w",MediaInfo.Title="#XYA",MediaInfo.TnInfo="#XUq",MediaInfo.FileDate="#XP0",MediaInfo.Error="#Xnv",MediaInfo.Duration="#Xzr",MediaInfo.Width="#Xwt",MediaInfo.FileExists="#XHR",MediaInfo.Height="#XWL",MediaInfo.Bitrate="#XS7",MediaInfo.Mime="#Xhy";class MimeUtil{static imageExts(){return Array.from(this.imageExtByMime.values())}static audioPlaybackExts(){return Array.from(this.audioPlaybackMimeByExt.keys())}static audioRecordExts(){return Array.from(this.audioRecordMimeByExt.keys())}static videoPlaybackExts(){return Array.from(this.videoMimeByExt.keys())}static videoRecordExts(){return Array.from(this.videoRecordingMimeByExt.keys())}static videoTrackExts(){return Array.from(this.videoTrackMimeByExt.keys())}static backupExts(){return[DEF.ibackup,DEF.backup,DEF.der,DEF.zip]}static mimeFromPath(t){let e=Basepath.lcExt_(t);if(null==e)return null;switch(e){case"html":return MimeUtil.HTML;case"css":return MimeUtil.CSS;case"js":return MimeUtil.JS;default:return MimeUtil.mediaMimeFromLcExt(e)}}static mediaMimeFromPath(t){return MimeUtil.mediaMimeFromLcExt(Basepath.lcExt_(t))}static mediaMimeFromLcExt(t){var e,i,n;if(null==t)return null;let s=MimeUtil.imageMimeByExt.get(t);return null!=s?s:null!==(n=null!==(i=null!==(e=MimeUtil.audioPlaybackMimeByExt.get(t))&&void 0!==e?e:MimeUtil.pdfMimeByExt.get(t))&&void 0!==i?i:MimeUtil.videoMimeByExt.get(t))&&void 0!==n?n:null}static mediaMimeFromUri(t){let e=t.queryParameters$.get("mime");if(e)return e;let i=t.pathSegments$;if(i.length>0){let t=i[i.length-1];return MimeUtil.mediaMimeFromPath(t)}return null}static audioPlaybackMimeFromPath(t){var e;let i=Basepath.lcExt_(t);return null==i?null:null!==(e=MimeUtil.audioPlaybackMimeByExt.get(i))&&void 0!==e?e:null}static audioPlaybackMimeFromLcExt(t){var e;return null==t?null:null!==(e=MimeUtil.audioPlaybackMimeByExt.get(t))&&void 0!==e?e:null}static audioPlaybackMimeFromUri(t){return MimeUtil._fromUri(MimeUtil.audioPlaybackMimeByExt,t)}static audioRecordMimeFromPath(t){var e;let i=Basepath.lcExt_(t);return null==i?null:null!==(e=MimeUtil.audioRecordMimeByExt.get(i))&&void 0!==e?e:null}static audioRecordMimeFromLcExt(t){var e;return null==t?null:null!==(e=MimeUtil.audioRecordMimeByExt.get(t))&&void 0!==e?e:null}static audioRecordMimeFromUri(t){return MimeUtil._fromUri(MimeUtil.audioRecordMimeByExt,t)}static isAudioPlaybackLcExt(t){return null!=t&&MimeUtil.audioPlaybackMimeByExt.has(t)}static audioRecordingExt(){return MimeUtil.audioRecordMimeByExt.keys().next().value}static imageMimeFromPath(t){var e;let i=Basepath.lcExt_(t);return null==i?null:null!==(e=MimeUtil.imageMimeByExt.get(i))&&void 0!==e?e:null}static imageMimeFromLcExt(t){var e;return null==t?null:null!==(e=MimeUtil.imageMimeByExt.get(t))&&void 0!==e?e:null}static imageMimeFromUri(t){return MimeUtil._fromUri(MimeUtil.imageMimeByExt,t)}static imageExtFromMime(t){var e;return null==t?null:null!==(e=MimeUtil.imageExtByMime.get(t))&&void 0!==e?e:null}static isImagePath(t){return MimeUtil.isImageLcExt(Basepath.lcExt_(t))}static isImageLcExt(t){return null!=t&&MimeUtil.imageMimeByExt.has(t)}static isImageMime(t){return null!=t&&MimeUtil.imageExtByMime.has(t)}static isLossyImageLcExt(t){return null!=t&&MimeUtil.imageLossyLcExts.includes(t)}static canWriteImageLcExt(t){return null!=t&&MimeUtil.imageWritableLcExts.includes(t)}static isPhotoLcExt(t){return null!=t&&MimeUtil.photoMimeByExt.has(t)}static isVideoLcExt(t){return null!=t&&MimeUtil.videoMimeByExt.has(t)}static videoRecordingExt(){return MimeUtil.videoRecordingMimeByExt.keys().next().value}static videoExtFromMime(t){var e;return null==t?null:null!==(e=MimeUtil.videoExtByMime.get(t.toLowerCase()))&&void 0!==e?e:null}static videoMimeFromPath(t){var e;let i=Basepath.lcExt_(t);return null==i?null:null!==(e=MimeUtil.videoMimeByExt.get(i))&&void 0!==e?e:null}static videoMimeFromLcExt(t){var e;return null==t?null:null!==(e=MimeUtil.videoMimeByExt.get(t))&&void 0!==e?e:null}static videoMimeFromUri(t){return MimeUtil._fromUri(MimeUtil.videoMimeByExt,t)}static isHtmlPath(t){return"html"==Basepath.lcExt_(t)}static isExportableMediaMime(t){return null!=t&&(t==MimeUtil.PDF||MimeUtil.imageExtByMime.has(t)||MimeUtil.audioPlaybackExtByMime.has(t))}static isMediaLcExt(t){return null!=t&&(t==DEF.pdf||MimeUtil.isImageLcExt(t)||MimeUtil.isVideoLcExt(t)||MimeUtil.isAudioPlaybackLcExt(t))}static isExportableLcExt(t){return t==DEF.html||t==DEF.css||MimeUtil.isMediaLcExt(t)}static isSharableLcExt(t){return MimeUtil.isMediaLcExt(t)}static extFromUri(t){if(null==t)return null;let e=t.pathSegments$;if(e.length>0){let t=e[e.length-1];return Basepath.lcExt_(t)}return null}static _fromUri(t,e){var i;if(null==e)return null;let n=e.queryParameters$.get("mime");if(null!=n&&!n.endsWith("/*"))return n;let s=e.pathSegments$;if(s.length>0){let e=Basepath.lcExt_(s[s.length-1]);if(null!=e)return null!==(i=t.get(e))&&void 0!==i?i:null}return null}}MimeUtil.ALL="*/*",MimeUtil.AUDIO="audio/*",MimeUtil.BMP="image/bmp",MimeUtil.CSS="text/css",MimeUtil.GIF="image/gif",MimeUtil.HEIC="image/heic",MimeUtil.HTML="text/html",MimeUtil.ICO="image/vnd.microsoft.icon",MimeUtil.IMAGE="image/*",MimeUtil.JPEG="image/jpeg",MimeUtil.JS="text/javascript",MimeUtil.M4A="audio/mp4",MimeUtil.MOV="video/quicktime",MimeUtil.MP4="video/mp4",MimeUtil.MPEG="audio/mpeg",MimeUtil.VTT="video/vtt",MimeUtil.PDF="application/pdf",MimeUtil.PNG="image/png",MimeUtil.SVG="image/svg+xml",MimeUtil.TEXT_PLAIN="text/plain",MimeUtil.VIDEO="video/*",MimeUtil.WAV="audio/wav",MimeUtil.imageMimeByExt=new Map([["jpg",MimeUtil.JPEG],["jpeg",MimeUtil.JPEG],["heic",MimeUtil.HEIC],["png",MimeUtil.PNG],["gif",MimeUtil.GIF],["bmp",MimeUtil.BMP],["ico",MimeUtil.ICO],["svg",MimeUtil.SVG]]),MimeUtil.imageExtByMime=new Map([[MimeUtil.GIF,"gif"],[MimeUtil.BMP,"bmp"],[MimeUtil.ICO,"ico"],[MimeUtil.SVG,"svg"],[MimeUtil.JPEG,"jpg"],[MimeUtil.HEIC,"heic"],[MimeUtil.PNG,"png"]]),MimeUtil.imageLossyLcExts=["jpg","jpeg","heic"],MimeUtil.imageWritableLcExts=[...MimeUtil.imageMimeByExt.keys()].filter(t=>"ico"!=t&&"svg"!=t),MimeUtil.photoMimeByExt=new Map([["jpg",MimeUtil.JPEG],["jpeg",MimeUtil.JPEG],["heic",MimeUtil.HEIC],["png",MimeUtil.PNG]]),MimeUtil.audioPlaybackMimeByExt=new Map([["mp3",MimeUtil.MPEG],["m4a",MimeUtil.M4A],["wav",MimeUtil.WAV]]),MimeUtil.audioPlaybackExtByMime=new Map([[MimeUtil.MPEG,"mp3"],[MimeUtil.M4A,"m4a"],[MimeUtil.WAV,"wav"]]),MimeUtil.audioRecordMimeByExt=new Map([["m4a",MimeUtil.M4A]]),MimeUtil.pdfMimeByExt=new Map([["pdf",MimeUtil.PDF]]),MimeUtil.videoMimeByExt=new Map([["mov",MimeUtil.MOV],["mp4",MimeUtil.MP4],["m4v",MimeUtil.MP4]]),MimeUtil.videoExtByMime=new Map([[MimeUtil.MOV,"mov"],[MimeUtil.MP4,"mp4"]]),MimeUtil.videoRecordingMimeByExt=new Map([["mp4",MimeUtil.MP4]]),MimeUtil.videoTrackMimeByExt=new Map([["vtt",MimeUtil.VTT]]);class MediaUtil{static thumbnailPath_(t,e,i){return 0==e||0==i?t.toString():t.changeNameWithoutSuffix_(t.nameWithoutSuffix$+`- tn${e}x${i}`).path$}static fit_(t,e,i,n){if(0==t||0==e)return new Point(0,0);let s,o;return 1*t/e>=1*i/n?(s=i,o=Math.floor(e*i/t)):(o=n,s=Math.floor(t*n/e)),new Point(s,o)}static zoomOf_(t,e,i){return t.x>t.y?t.x/e:t.y/i}static zoomOf2_(t,e,i,n){return t>e?i/t:n/e}static limitImageArea_(t,e,i=DEF.maxOutputImageArea){let n=t*e;if(n>i){let s=Math.sqrt(1*i/n);t>e?(t=Math.floor(t*s),e=i/(t-=t%DEF.imageDimensionSnap)):(e=Math.floor(e*s),t=i/(e-=e%DEF.imageDimensionSnap))}return new Point(t,e)}static limitImageDimensionAndArea_(t,e,i,n=DEF.maxOutputImageArea){if(null!=i&&i>0&&(t>i||e>i)){let n=MediaUtil.fit_(t,e,i,i);t=n.x,e=n.y}return MediaUtil.limitImageArea_(t,e,n)}static optionalDimensionPx_(t,e,i,n){let s=0==t.length?null:An.parseIntPx_(t,-1),o=0==e.length?null:An.parseIntPx_(e,-1);return null!=s&&s<=0||null!=o&&o<=0?null:MediaUtil.optionalDimension1_(s,o,i,n)}static optionalDimension_(t,e,i,n){let s=0==t.length?null:An.parseInt_(t,-1),o=0==e.length?null:An.parseInt_(e,-1);return null!=s&&s<=0||null!=o&&o<=0?null:MediaUtil.optionalDimension1_(s,o,i,n)}static optionalDimension0_(t,e,i,n){return null!=t&&t<=0&&(t=null),null!=e&&e<=0&&(e=null),MediaUtil.optionalDimension1_(t,e,i,n)}static optionalDimension1_(t,e,i,n){return null==t?null==e?(t=i,e=n):t=Math.round(1*e*(i/n)):null==e&&(e=Math.round(1*t*(n/i))),new Point(t,e)}static greaterOfWidthOrHeight_(t,e){return t>=e?[`${t}`,""]:["",`${e}`]}static isInvalidDimension_(t,e){return null==t||null==e||t<=0||e<=0}}class FileInfoKey{}FileInfoKey._length="sz",FileInfoKey._flag="fl",FileInfoKey._notexists="ne",FileInfoKey._state="st",FileInfoKey._lastModified="dt",FileInfoKey._files="fs",FileInfoKey._notwritable="nw",FileInfoKey._lastDeleted="dl",FileInfoKey._isfile="if",FileInfoKey._rpath="rp",FileInfoKey._isdir="id",FileInfoKey._id="dd",FileInfoKey._checksum="cs",FileInfoKey._perm="pm",FileInfoKey._dir="di",FileInfoKey._notreadable="nr",FileInfoKey._name="nm",FileInfoKey._cpath="cp",FileInfoKey._isDeleted="ds",FileInfoKey._isroot="ir";class SymbolInfoKey{}SymbolInfoKey.family="f",SymbolInfoKey.text="t",SymbolInfoKey.name$="n";class FileStat{constructor(t){this.info$=t}static arrayOf_(t){return null==t?null:t.map(t=>new FileStat(t))}static of_(t){return null==t?null:new FileStat(t)}_istrue(t){return 1==this.info$[t]}get isdir$(){return this._istrue(FileInfoKey._isdir)}get isfile$(){return this.exists$&&!this.isdir$}get exists$(){return!this.notexists$}get notexists$(){return this._istrue(FileInfoKey._notexists)}get readable$(){return this.exists$&&!this._istrue(FileInfoKey._notreadable)}get writable$(){return this.exists$&&!this._istrue(FileInfoKey._notwritable)}get perm$(){return this._perm()}get sizeunit$(){return FileInfo._sizeunit7(this.info$[FileInfoKey._length])}get date$(){var t;return null!==(t=this.info$[FileInfoKey._lastModified])&&void 0!==t?t:0}get size$(){var t;return null!==(t=this.info$[FileInfoKey._length])&&void 0!==t?t:0}get state$(){var t;return null!==(t=this.info$[FileInfoKey._state])&&void 0!==t?t:null}get flag$(){return this._istrue(FileInfoKey._flag)}_perm(){return(this.readable$?"r":"-")+(this.writable$?"w":"-")}static _padleft7(t){const e=t.length;return e>=7?t:FileInfo._PADDING[e]+t}static _sizeunit7(t){return null==t||0==t?FileInfo._SIZEUNIT0:FileStat._padleft7(An.filesizeUnit4_(t))}}FileStat.SIZEUNIT_EMPTY="",FileStat.SIZEUNIT_DIR="",FileStat._SIZEUNIT0="0B",FileStat._PADDING=["","","","","","",""];class FileInfo extends FileStat{constructor(t){super(t)}static arrayOf_(t){return null==t?null:t.map(t=>new FileInfo(t))}static of_(t){return null==t?null:new FileInfo(t)}name_(){var t;return null!==(t=this.info$[FileInfoKey._name])&&void 0!==t?t:""}}FileInfo.NOT_EXISTS=new FileInfo(json_([FileInfoKey._name,"~NOTEXISTS~"],[FileInfoKey._notexists,!0],[FileInfoKey._perm,"   "],[FileInfoKey._length,0],[FileInfoKey._lastModified,""]));class DeletedFileStat extends FileInfo{constructor(t){super(t)}static arrayOf_(t){return null==t?null:t.map(t=>new DeletedFileStat(t))}static of_(t){return null==t?null:new DeletedFileStat(t)}id_(){return this.info$[FileInfoKey._id]}dir_(){return this.info$[FileInfoKey._dir]}lastDeleted_(){return this.info$[FileInfoKey._lastDeleted]}toJSON_(){return this.info$}toJSONString_(){return JSON.stringify(this.info$)}}class FileInfoUtil{constructor(t){this.handler=t}fileInfo_(t,e){this.handler.fileInfo_(t,e)}listDir_(t,e){this.handler.listDir_(t,e)}mkDirs_(t,e){this.handler.mkDirs_(t,e)}delete_(t,e){this.handler.delete_(t,e)}deleteAll_(t,e,i){this.handler.deleteAll_(t,e,i)}deleteInfo_(t,e){this.handler.deleteInfo_(t,e)}rename_(t,e,i){this.handler.rename_(t,e,i)}copy_(t,e,i,n,s,o){this.handler.copy_(t,e,i,n,s,o)}copyInfo_(t,e,i,n){this.handler.copyInfo_(t,e,i,n)}deleteDirSubtree_(t,e){this.handler.deleteDirSubtree_(t,e)}localImageInfos_(t,e){this.handler.localImageInfos_(t,e)}localImageThumbnails_(t,e,i){this.handler.localImageThumbnails_(t,e,i)}deleteEmptyDirs_(t,e){this.handler.deleteEmptyDirs_(t,e)}listRecursive_(t,e){this.handler.listRecursive_(t,e)}fileInfos_(t,e,i){this.handler.fileInfos_(t,e,i)}dirInfo_(t,e){this.handler.dirInfo_(t,e)}mkparent_(t,e){const i=Basepath.dir_(t);null==i||0==i.length?e():this.mkDirs_(i,e)}fileInfo1_(t,e,i){this.handler.fileInfo_(e,e=>{if(t.warn_(e))return;const n=FileInfo.of_(e[Key.fileinfo]);null!=n?i(n):t.warn_(An.jsonError_(RS.FileNotFound))})}fileinfo2_(t,e,i){this.handler.fileInfo_(t,t=>{if(An.hasMessage_(t))return void e(t);const n=FileInfo.of_(t[Key.fileinfo]);null!=n?i(n):e(An.jsonError_(RS.FileNotFound))})}dirAndFileInfo_(t,e){const i=Basepath.dir_(t);null!=i?this.fileinfo2_(i,e,i=>{this.handler.fileInfo_(t,t=>{An.hasMessage_(t)?e(t):(t[Key.dirinfo]=i,e(t))})}):e(An.jsonError_(RS.InvalidFilepath))}checkExists_(t,e){this.handler.fileInfo_(t,t=>{if(An.hasMessage_(t))return void e(!1);let i=FileInfo.of_(t[Key.fileinfo]);e(null!=i&&i.exists$)})}checkDirWritable_(t,e){this.handler.fileInfo_(t,t=>{if(An.hasMessage_(t))return void e(t);let i=FileInfo.of_(t[Key.fileinfo]);null!=i&&!i.notexists$&&i.isdir$&&i.writable$?e(t):e(An.jsonError_(RS.DestinationNotWritable))})}checkDirWritable2_(t,e,i){this.handler.fileInfo_(t,t=>{let n=t[Key.errors];if(An.hasMessage_(n))return void e(n);let s=FileInfo.of_(t[Key.fileinfo]);null!=s&&!s.notexists$&&s.isdir$&&s.writable$?i(s):e(MSG.string_(RS.DestinationNotWritable))})}checkFileWritable_(t,e){const i=Basepath.dir_(t);null!=i?this.handler.fileInfo_(t,t=>{if(An.hasMessage_(t))return void e(t);let n=FileInfo.of_(t[Key.fileinfo]);null==n||n.exists$&&(!n.writable$||n.isdir$)?e(An.jsonError_(RS.DestinationNotWritable)):this.checkDirWritable_(i,i=>{let n=An.messagesList_(i);n.length>0?e(smapOf_(Key.errors,n)):e(t)})}):e(An.jsonError_(RS.DestinationNotValid))}checkFileWritable2_(t,e,i){const n=Basepath.dir_(t);null!=n?this.handler.fileInfo_(t,t=>{let s=t[Key.errors];if(An.hasMessage_(s))return void e(s);let o=FileInfo.of_(t[Key.fileinfo]);if(null==o||!o.writable$||o.exists$&&o.isdir$)return void e(MSG.string_(RS.DestinationNotWritable));const l=o;this.checkDirWritable2_(n,e,t=>{i(l)})}):e(MSG.string_(RS.DestinationNotValid))}checkDirWritable1_(t,e,i){this.fileInfo1_(t,e,e=>{!e.notexists$&&e.isdir$&&e.writable$?i(e):t.warn_(MSG.string_(RS.DestinationNotWritable))})}checkFileWritable1_(t,e,i){const n=Basepath.dir_(e);null!=n?this.fileInfo1_(t,e,e=>{!e.exists$||!e.isdir$&&e.writable$?this.checkDirWritable1_(t,n,t=>{i(e)}):t.warn_(MSG.string_(RS.DestinationNotWritable))}):t.warn_(MSG.string_(RS.DestinationNotValid))}checkFileDeletable1_(t,e,i){this.fileInfo1_(t,e,n=>{if(!n.exists$)return void t.warn_(MSG.string_(RS.DestinationNotExists));const s=Basepath.dir_(e);null!=s?this.fileInfo1_(t,s,e=>{!e.notexists$&&e.isdir$&&e.writable$?i(e):t.warn_(MSG.string_(RS.DestinationNotDeletable))}):t.warn_(MSG.string_(RS.DestinationNotValid))})}}class HttpStatus{}HttpStatus.CONTINUE=100,HttpStatus.SWITCHING_PROTOCOLS=101,HttpStatus.OK=200,HttpStatus.CREATED=201,HttpStatus.ACCEPTED=202,HttpStatus.NON_AUTHORITATIVE_INFORMATION=203,HttpStatus.NO_CONTENT=204,HttpStatus.RESET_CONTENT=205,HttpStatus.PARTIAL_CONTENT=206,HttpStatus.MULTIPLE_CHOICES=300,HttpStatus.MOVED_PERMANENTLY=301,HttpStatus.FOUND=302,HttpStatus.MOVED_TEMPORARILY=302,HttpStatus.SEE_OTHER=303,HttpStatus.NOT_MODIFIED=304,HttpStatus.USE_PROXY=305,HttpStatus.TEMPORARY_REDIRECT=307,HttpStatus.BAD_REQUEST=400,HttpStatus.UNAUTHORIZED=401,HttpStatus.PAYMENT_REQUIRED=402,HttpStatus.FORBIDDEN=403,HttpStatus.NOT_FOUND=404,HttpStatus.METHOD_NOT_ALLOWED=405,HttpStatus.NOT_ACCEPTABLE=406,HttpStatus.PROXY_AUTHENTICATION_REQUIRED=407,HttpStatus.REQUEST_TIMEOUT=408,HttpStatus.CONFLICT=409,HttpStatus.GONE=410,HttpStatus.LENGTH_REQUIRED=411,HttpStatus.PRECONDITION_FAILED=412,HttpStatus.REQUEST_ENTITY_TOO_LARGE=413,HttpStatus.REQUEST_URI_TOO_LONG=414,HttpStatus.UNSUPPORTED_MEDIA_TYPE=415,HttpStatus.REQUESTED_RANGE_NOT_SATISFIABLE=416,HttpStatus.EXPECTATION_FAILED=417,HttpStatus.INTERNAL_SERVER_ERROR=500,HttpStatus.NOT_IMPLEMENTED=501,HttpStatus.BAD_GATEWAY=502,HttpStatus.SERVICE_UNAVAILABLE=503,HttpStatus.GATEWAY_TIMEOUT=504,HttpStatus.HTTP_VERSION_NOT_SUPPORTED=505,HttpStatus.NETWORK_CONNECT_TIMEOUT_ERROR=599;class StyleInfo{constructor(t){this.info$=t}group_(){return this.info$[StyleKey.group]}label_(){return this.info$[StyleKey.label]}name_(){return this.info$[StyleKey.name$]}}class FontInfo{constructor(t){this.info$=t}fontname_(){return this.info$[FontInfoKey.fontname]}url_(){return this.info$[FontInfoKey.url]}fontfaceformat_(){return this.info$[FontInfoKey.fontfaceformat]}size_(){return this.info$[FontInfoKey.size]}license_(){return this.info$[FontInfoKey.license]}category_(){return this.info$[FontInfoKey.category]}subsets_(){return this.info$[FontInfoKey.subsets]}glyphcount_(){return this.info$[FontInfoKey.glyphcount]}glyphs_(){return this.info$[FontInfoKey.glyphs]}glyphnames_(){return this.info$[FontInfoKey.glyphnames]}styles_(){return this.info$[FontInfoKey.styles]}}let _MONTH_ARRAY=MSG.stringArray_(RS.Months),_MONTHS=new Map([["01",_MONTH_ARRAY[0]],["02",_MONTH_ARRAY[1]],["03",_MONTH_ARRAY[2]],["04",_MONTH_ARRAY[3]],["05",_MONTH_ARRAY[4]],["06",_MONTH_ARRAY[5]],["07",_MONTH_ARRAY[6]],["08",_MONTH_ARRAY[7]],["09",_MONTH_ARRAY[8]],["10",_MONTH_ARRAY[9]],["11",_MONTH_ARRAY[10]],["12",_MONTH_ARRAY[11]]]);class DateFormat{static validate(t,e){return null==DateFormat.getDateFormatter(t)?e:t}static _getdateformatter(t){var e;return null!==(e=DateFormat._formatters.get(t))&&void 0!==e?e:null}static dateStringFromMs(t,e){return null==e?"":DateFormat.dateString(t,DateTime.fromMillisecondsSinceEpoch_(e))}static dateString(t,e){let i=An.to04d_(e.year$),n=An.to02d_(e.month$),s=An.to02d_(e.day$);return DateFormat.getDateFormatter(t)(i,n,s)}static getDateFormatter(t){let e=null;return null!=t&&(e=DateFormat._getdateformatter(t)),null==e&&(e=DateFormat._getdateformatter(DateFormat.DEF)),e}}DateFormat.DEF="mm/dd/yyyy",DateFormat.SIMPLE="yyyymmdd",DateFormat.SETTINGS_LIST=["mm/dd/yyyy","dd/mm/yyyy","yyyy/mm/dd","yyyy/dd/mm","mm-dd-yyyy","dd-mm-yyyy","yyyy-mm-dd","yyyy-dd-mm","mm.dd.yyyy","dd.mm.yyyy","yyyy.mm.dd","yyyy.dd.mm"],DateFormat.LIST=["","mm/dd/yyyy","mm/dd","mm/yyyy","yyyy/mm/dd","yyyy/mm","dd/mm/yyyy","dd/mm","yyyy/dd/mm","","dd-mm-yyyy","dd-mm","mm-yyyy","yyyy-mm-dd","yyyy-mm","mm-dd-yyyy","mm-dd","yyyy-dd-mm","","dd.mm.yyyy","dd.mm","mm.yyyy","yyyy.mm.dd","yyyy.mm","mm.dd.yyyy","mm.dd","yyyy.dd.mm","","mmm dd yyyy","mmm dd","mmm yyyy","dd mmm","dd mmm yyyy","yyyy mmm dd","yyyy mmm","","mmddyyyy","mmdd","mmyyyy","ddmm","ddmmyyyy","yyyymmdd","yyyymm","yyyy","mmm","mm","dd"],DateFormat._formatters=new Map([["mm/dd/yyyy",(t,e,i)=>`${e}/${i}/${t}`],["mm/yyyy",(t,e,i)=>`${e}/${t}`],["yyyy/mm/dd",(t,e,i)=>`${t}/${e}/${i}`],["yyyy/mm",(t,e,i)=>`${t}/${e}`],["mm/dd",(t,e,i)=>`${e}/${i}`],["dd/mm/yyyy",(t,e,i)=>`${i}/${e}/${t}`],["dd/mm",(t,e,i)=>`${i}/${e}`],["yyyy/dd/mm",(t,e,i)=>`${t}/${i}/${e}`],["dd-mm-yyyy",(t,e,i)=>`${i}-${e}-${t}`],["mm-yyyy",(t,e,i)=>`${e}-${t}`],["yyyy-mm-dd",(t,e,i)=>`${t}-${e}-${i}`],["yyyy-mm",(t,e,i)=>`${t}-${e}`],["dd-mm",(t,e,i)=>`${i}-${e}`],["mm-dd-yyyy",(t,e,i)=>`${e}-${i}-${t}`],["mm-dd",(t,e,i)=>`${e}-${i}`],["yyyy-dd-mm",(t,e,i)=>`${t}-${i}-${e}`],["dd.mm.yyyy",(t,e,i)=>`${i}.${e}.${t}`],["mm.yyyy",(t,e,i)=>`${e}.${t}`],["yyyy.mm.dd",(t,e,i)=>`${t}.${e}.${i}`],["yyyy.mm",(t,e,i)=>`${t}.${e}`],["dd.mm",(t,e,i)=>`${i}.${e}`],["mm.dd.yyyy",(t,e,i)=>`${e}.${i}.${t}`],["mm.dd",(t,e,i)=>`${e}.${i}`],["yyyy.dd.mm",(t,e,i)=>`${t}.${i}.${e}`],["mmm dd yyyy",(t,e,i)=>{var n;return`${null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"} ${i} ${t}`}],["dd mmm yyyy",(t,e,i)=>{var n;return`${i} ${null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"} ${t}`}],["mmm yyyy",(t,e,i)=>{var n;return`${null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"} ${t}`}],["yyyy mmm dd",(t,e,i)=>{var n;return`${t} ${null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"} ${i}`}],["yyyy mmm",(t,e,i)=>{var n;return`${t} ${null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"}`}],["mmm dd",(t,e,i)=>{var n;return`${null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"} ${i}`}],["dd mmm",(t,e,i)=>{var n;return`${i} ${null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"}`}],["mmddyyyy",(t,e,i)=>`${e}${i}${t}`],["ddmmyyyy",(t,e,i)=>`${i}${e}${t}`],["mmyyyy",(t,e,i)=>`${e}${t}`],["yyyymmdd",(t,e,i)=>`${t}${e}${i}`],["yyyymm",(t,e,i)=>`${t}${e}`],["mmdd",(t,e,i)=>`${e}${i}`],["ddmm",(t,e,i)=>`${i}${e}`],["yyyy",(t,e,i)=>`${t}`],["mmm",(t,e,i)=>{var n;return null!==(n=_MONTHS.get(e))&&void 0!==n?n:"???"}],["mm",(t,e,i)=>`${e}`],["dd",(t,e,i)=>`${i}`],["",(t,e,i)=>""]]);class TimeFormat{static validate(t,e){return null==TimeFormat.getFormatter(t)?e:t}static getFormatter(t){var e;return null==t?null:null!==(e=TimeFormat._formatters.get(t))&&void 0!==e?e:null}static timeString(t,e){let i=TimeFormat.getFormatter(t);return null==i&&(i=TimeFormat._formatters.get(TimeFormat.DEF)),i(e.hour$,An.to02d_(e.minute$),An.to02d_(e.second$))}static longString(t,e){const i=e.hour$,n=An.to02d_(e.minute$),s=An.to02d_(e.second$);switch(t){case"":return"";case TimeFormat.HH_MM_AP:{let t=i>12?i-12:i;return`${t<10?"":""}${t}:${n}:${s}${i>=12?TimeFormat.PM:TimeFormat.AM}`}case TimeFormat.AP_HH_MM:{let t=i>12?i-12:i;return`${i>=12?TimeFormat.PM:TimeFormat.AM}${t<10?"":""}${t}:${n}:${s}`}case TimeFormat.HH_MM:default:return`${An.to02d_(i)}:${n}:${s}`}}static hourString(t,e){switch(t){case"":return"";case TimeFormat.HH_MM_AP:case TimeFormat.HH_AP:{let t=e>12?e-12:e;return`${t<10?"":""}${t}${e>=12?TimeFormat.PM:TimeFormat.AM}`}case TimeFormat.AP_HH_MM:case TimeFormat.AP_HH:{let t=e>12?e-12:e;return`${e>=12?TimeFormat.PM:TimeFormat.AM}${t<10?"":""}${t}`}case TimeFormat.HH_MM:case TimeFormat.HH:case TimeFormat.HHMM:default:return An.to02d_(e)}}}TimeFormat.AM=MSG.string_(RS.AM),TimeFormat.PM=MSG.string_(RS.PM),TimeFormat.HH_MM="hh:mm",TimeFormat.HH="hh",TimeFormat.HH_MM_AP="hh:mm+M",TimeFormat.HH_AP="hh+M",TimeFormat.AP_HH_MM="M+hh:mm",TimeFormat.AP_HH="M+hh",TimeFormat.HHMM="hhmm",TimeFormat.DEF="hh:mm",TimeFormat.SETTINGS_LIST=[TimeFormat.HH_MM,TimeFormat.HH_MM_AP,TimeFormat.AP_HH_MM],TimeFormat.LIST=["",TimeFormat.HH_MM,TimeFormat.HH,TimeFormat.HH_MM_AP,TimeFormat.HH_AP,TimeFormat.AP_HH_MM,TimeFormat.AP_HH,TimeFormat.HHMM],TimeFormat._formatters=new Map([["",(t,e,i)=>""],[TimeFormat.HH_MM,(t,e,i)=>`${An.to02d_(t)}:${e}`],[TimeFormat.HH,(t,e,i)=>An.to02d_(t)],[TimeFormat.HH_MM_AP,(t,e,i)=>{let n=t>12?t-12:t;return`${n<10?"":""}${n}:${e}${t>=12?TimeFormat.PM:TimeFormat.AM}`}],[TimeFormat.HH_AP,(t,e,i)=>{let n=t>12?t-12:t;return`${n<10?"":""}${n}${t>=12?TimeFormat.PM:TimeFormat.AM}`}],[TimeFormat.AP_HH_MM,(t,e,i)=>{let n=t>12?t-12:t;return`${t>=12?TimeFormat.PM:TimeFormat.AM}${n<10?"":""}${n}:${e}`}],[TimeFormat.AP_HH,(t,e,i)=>{let n=t>12?t-12:t;return`${t>=12?TimeFormat.PM:TimeFormat.AM}${n<10?"":""}${n}`}],[TimeFormat.HHMM,(t,e,i)=>`${An.to02d_(t)}${e}`]]);class UISettings{constructor(t){this._settings=t}set_(t,e){this._settings[t]=e}get buttonSize$(){return this._settings[SettingsKey.buttonSize]}get uiFontName$(){return this._settings[SettingsKey.uiFontName]}get uiFontStyle$(){return this._settings[SettingsKey.uiFontStyle]}get uiFontSize$(){return this._settings[SettingsKey.uiFontSize]}get fixedFontName$(){return this._settings[SettingsKey.fixedFontName]}get fixedFontStyle$(){return this._settings[SettingsKey.fixedFontStyle]}get dialogBGColor$(){return this._settings[SettingsKey.dialogBGColor]}get headingColor$(){return this._settings[SettingsKey.headingColor]}get linkColor$(){return this._settings[SettingsKey.linkColor]}get annotationColor$(){return this._settings[SettingsKey.annotationColor]}get highlightColor$(){return this._settings[SettingsKey.highlightColor]}get dateFormat$(){return this._settings[SettingsKey.dateFormat]}get timeFormat$(){return this._settings[SettingsKey.timeFormat]}get imageDimension$(){let t=this._settings[SettingsKey.imageDimension];return null==t?0:t}set buttonSize$(t){this._settings[SettingsKey.buttonSize]=t}set uiFontName$(t){this._settings[SettingsKey.uiFontName]=t}set uiFontStyle$(t){this._settings[SettingsKey.uiFontStyle]=t}set uiFontSize$(t){this._settings[SettingsKey.uiFontSize]=t}set fixedFontName$(t){this._settings[SettingsKey.fixedFontName]=t}set fixedFontStyle$(t){this._settings[SettingsKey.fixedFontStyle]=t}set dialogBGColor$(t){this._settings[SettingsKey.dialogBGColor]=t}set headingColor$(t){this._settings[SettingsKey.headingColor]=t}set linkColor$(t){this._settings[SettingsKey.linkColor]=t}set annotationColor$(t){this._settings[SettingsKey.annotationColor]=t}set highlightColor$(t){this._settings[SettingsKey.highlightColor]=t}set dateFormat$(t){this._settings[SettingsKey.dateFormat]=t}set timeFormat$(t){this._settings[SettingsKey.timeFormat]=t}set imageDimension$(t){this._settings[SettingsKey.imageDimension]=t}toJSONString_(){return JSON.stringify(this._settings)}}class Settings{constructor(t){this._settings=t,this._current=new UISettings(t[SettingsKey.current]),this._defaults=new UISettings(t[SettingsKey.defaults]),this._sortedFonts=this.sortbyfontname(this._settings[SettingsKey.fontFamilies]),this._sortedSymbolFonts=this.sortbyfontname(this._settings[SettingsKey.symbolFamilies]),this._sortedFontFaces=this.sortedfontfaces(),this._fontsByFontname=new Map(this._sortedFonts.map(t=>[t.fontname_(),t])),this._htmlTemplatesByName=this.sortHtmlTemplatesByName(),this._charStylesByName=this.sortbystylename(this._settings[SettingsKey.charStyles]),this._highlightStylesByName=this.sortbystylename(this._settings[SettingsKey.highlightStyles]),this._paraStylesByName=this.sortbystylename(this._settings[SettingsKey.paraStyles]),this._builtinCharStylesByName=this.sortbystylename(this._settings[SettingsKey.builtinCharStyles]),this._builtinParaStylesByName=this.sortbystylename(this._settings[SettingsKey.builtinParaStyles])}sortbyfontname(t){return Object.keys(t).sort().map(e=>new FontInfo(t[e]))}sortbystylename(t){let e=new Map;return t.map(t=>{const e=new StyleInfo(t);return[e.name_(),e]}).sort((t,e)=>t[0]>e[0]?1:t[0]<e[0]?-1:0).forEach(t=>{e.set(t[0],t[1])}),e}sortedfontfaces(){var t,e;let i=new Map;for(let n of this.fontFamilies_()){let s=null!==(t=n.fontname_())&&void 0!==t?t:null,o=null!==(e=n.styles_())&&void 0!==e?e:null;if(null!=s&&null!=o)for(let t of o){let e=An.isempty_(t)?s:s+"-"+t;i.set(e,e)}}return[...i.keys()]}sortHtmlTemplatesByName(){const t=new Map,e=this.htmlTemplates_();for(const[i,n]of Object.entries(e))for(const e of n){const i=new TemplatesInfo(e);t.set(i.name_(),i)}const i=new TemplatesInfo(this._settings[SettingsKey.htmlTemplates]).aliases_();for(const[e,n]of Object.entries(i)){const i=t.get(n);void 0!==i&&t.set(e,i)}return t}onIFrameLoad_(){}onResize_(){}port_(){return null}serial_(){return this._settings[Key.serial]}current_(){return this._current}defaults_(){return this._defaults}fontCategories_(){return this._settings[SettingsKey.fontCategories]}fontFaces_(){return null==this._sortedFontFaces&&(this._sortedFontFaces=this.sortedfontfaces()),this._sortedFontFaces}fontFamilies_(){return this._sortedFonts}fontInfo_(t){var e;return null!==(e=this._fontsByFontname.get(t))&&void 0!==e?e:null}symbolFamilies_(){return this._sortedSymbolFonts}charStyles_(){return Array.from(this._charStylesByName.values())}highlightStyles_(){return Array.from(this._highlightStylesByName.values())}paraStyles_(){return Array.from(this._paraStylesByName.values())}builtinCharStyles_(){return Array.from(this._builtinCharStylesByName.values())}builtinParaStyles_(){return Array.from(this._builtinParaStylesByName.values())}charStylesByName_(){return this._charStylesByName}highlightStylesByName_(){return this._highlightStylesByName}paraStylesByName_(){return this._paraStylesByName}builtinCharStylesByName_(){return this._builtinCharStylesByName}builtinParaStylesByName_(){return this._builtinParaStylesByName}getBgImgSamples(){return this._settings[SettingsKey.bgImgSamples]}htmlTemplates_(){return new TemplatesInfo(this._settings[SettingsKey.htmlTemplates]).templates_()}htmlTemplatesByName_(){return this._htmlTemplatesByName}dateFormat_(){return this._current.dateFormat$}shortDateFormat_(){return Settings._shortFormat(this._current.dateFormat$)}monthFormat_(){return Settings._monthFormat(this._current.dateFormat$)}timeFormat_(){return this._current.timeFormat$}getUrl_(t){let e=this.port_(),i=null==e||0==e?"":`:${e}`;return`${Conf.scheme}://${Conf.hostport}${i}${t}`}timeString_(t){return TimeFormat.timeString(this._current.timeFormat$,t)}monthString_(t){return Settings._monthString(this._current.dateFormat$,t)}dateString_(t){return DateFormat.dateString(this._current.dateFormat$,t)}mediumDateString_(t){return Settings._mediumDateString(this._current.dateFormat$,t)}shortDateString_(t){return Settings._shortDateString(this._current.dateFormat$,t)}mediumDatetimeString_(t){return this.mediumDateString_(t)+" "+this.timeString_(t)}datetimeString_(t){return this.dateString_(t)+" "+this.timeString_(t)}shortDatetimeString_(t){return this.shortDateString_(t)+" "+this.timeString_(t)}static getShortFormatter(t){let e=null;return null!=t&&(e=Settings._short(t)),null==e&&(e=Settings._short(DateFormat.DEF)),e}static getMonthFormatter(t){let e=null;return null!=t&&(e=Settings._month(t)),null==e&&(e=Settings._month(DateFormat.DEF)),e}static _shortFormat(t){var e;return null!==(e=Settings._shortFormats.get(t))&&void 0!==e?e:null}static _monthFormat(t){var e;return null!==(e=Settings._monthFormats.get(t))&&void 0!==e?e:null}static _mediumDateString(t,e){let i=An.to02d_(e.year$%100),n=An.to02d_(e.month$),s=An.to02d_(e.day$);return DateFormat.getDateFormatter(t)(i,n,s)}static _shortDateString(t,e){let i=An.to02d_(e.month$),n=An.to02d_(e.day$);return Settings.getShortFormatter(t)("",i,n)}static _monthString(t,e){let i=An.to04d_(e.year$),n=An.to02d_(e.month$),s=An.to02d_(e.day$);return Settings.getMonthFormatter(t)(i,n,s)}static _short(t){let e=Settings._shortFormat(t);return null==e?null:DateFormat.getDateFormatter(e)}static _month(t){let e=Settings._monthFormat(t);return null==e?null:DateFormat.getDateFormatter(e)}}Settings._shortFormats=new Map([["mm/dd/yyyy","mm/dd"],["dd/mm/yyyy","dd/mm"],["yyyy/mm/dd","mm/dd"],["yyyy/dd/mm","dd/mm"],["dd-mm-yyyy","dd-mm"],["mm-dd-yyyy","mm-dd"],["yyyy-dd-mm","dd-mm"],["yyyy-mm-dd","mm-dd"],["dd.mm.yyyy","dd.mm"],["mm.dd.yyyy","mm.dd"],["yyyy.dd.mm","dd.mm"],["yyyy.mm.dd","mm.dd"]]),Settings._monthFormats=new Map([["mm/dd/yyyy","mm/yyyy"],["dd/mm/yyyy","mm/yyyy"],["yyyy/mm/dd","yyyy/mm"],["yyyy/dd/mm","yyyy/mm"],["dd-mm-yyyy","mm-yyyy"],["mm-dd-yyyy","mm-yyyy"],["yyyy-dd-mm","yyyy-mm"],["yyyy-mm-dd","yyyy-mm"],["dd.mm.yyyy","mm.yyyy"],["mm.dd.yyyy","mm.yyyy"],["yyyy.dd.mm","yyyy.mm"],["yyyy.mm.dd","yyyy.mm"]]);class AnRange{constructor(t,e){this.start$=t,this.end$=e}}class MapClipboardKey{}MapClipboardKey.value="Xy8",MapClipboardKey.kind="XTh",MapClipboardKey.context="XM4";class MapClipboardKind{}MapClipboardKind.string="X6X",MapClipboardKind.map="Xil",MapClipboardKind.dom="XYD";class ColorUtil{static getAlphaColor_(t,e){let i=t.r$/255,n=t.g$/255,s=t.b$/255,o=1-Math.min(Math.min(i,n),s);e<o&&(e=o);let l=Math.round(255*(1-(1-i)/e)),a=Math.round(255*(1-(1-n)/e)),r=Math.round(255*(1-(1-s)/e));return ColorValue.fromRGBA_(l,a,r,e)}static validateColor_(t,e=""){if(An.isempty_(t))return e;let i=ColorUtil.findByName_(t.toLowerCase());if(null!=i&&ColorUtil.isCSSColor_(i))return i[0];let n=ColorValue.parseSafe_(t);return null==n?e:t.startsWith("#")?n.toHexOrRgbaString_():n.toRgbOrRgbaString_()}static validateCSSColor_(t,e=""){if(An.isempty_(t))return e;let i=ColorUtil.findByName_(t.toLowerCase());if(null!=i&&ColorUtil.isCSSColor_(i))return i[0];let n=ColorValue.parseSafe_(t);return null==n?e:t.startsWith("#")?n.toHexOrCSSString_():n.toCSSString_()}static toHexOrRgbString_(t,e){return null==t?"":e?"#"+t.toHex3String_():t.toRgbString_()}static formatString_(t,e){if(null==e)return"";if(null==t)return e.toRgbOrRgbaString_();switch(t){case ColorUtil.NULL:return"";case ColorUtil.HEX:return e.toHexOrRgbaString_();case ColorUtil.DEC:return e.toRgbOrRgbaString_();default:return t}}static getColorValue_(t,e){if(null==t||0==t.length)return null;let i=ColorUtil.findByName_(t.toLowerCase());null!=i&&(t=i[1]);const n=ColorValue.parseSafe_(t);return void 0===e||null==n?n:ColorValue.fromRGBA_(n.r$,n.g$,n.b$,e)}static getFormat_(t){if(An.isempty_(t))return ColorUtil.NULL;let e=t.toLowerCase(),i=ColorUtil.findByName_(e);return ColorUtil.isCSSColor_(i)?t:t.startsWith("#")||null!=i?ColorUtil.HEX:ColorUtil.DEC}static findByName_(t){var e;return null!==(e=x11Colors.get(t))&&void 0!==e?e:null}static findByHex_(t){var e;return null!==(e=X11ColorsByHex.get(t))&&void 0!==e?e:null}static findIndexByName_(t){let e=0;for(let i in x11Colors){if(t==i)return e;++e}return-1}static findIndexByHex_(t){let e=0;for(let i of X11ColorsByHex.keys()){if(t==i)return e;++e}return-1}static formatCSSString_(t,e){if(null==e)return"";if(null==t)return e.toCSSString_();switch(t){case ColorUtil.NULL:return"";case ColorUtil.HEX:return e.toHexOrCSSString_();case ColorUtil.DEC:return e.toCSSString_();default:return t}}static isCSSColor_(t){return null!=t&&t[2].length>0}static getForegroundColor_(t){if(null==t)return null;let e=t[3];return An.isempty_(e)?null:e}}ColorUtil.NULL="",ColorUtil.HEX="#",ColorUtil.DEC="@";class Rect{constructor(t,e,i,n){this.left=t,this.top=e,this.width=i,this.height=n}static fromRect_(t){return new Rect(t.left,t.top,t.width,t.height)}set_(t,e,i,n){return this.left=t,this.top=e,this.width=i,this.height=n,this}setRect_(t){return this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,this}clampSize_(t,e){return this.left=An.clamp_(t,e,this.left),this.top=An.clamp_(t,e,this.top),this.width=An.clamp_(t,e,this.width),this.height=An.clamp_(t,e,this.height),this.left+this.width>e&&(this.width=e-this.left),this.top+this.height>e&&(this.height=e-this.top),this}scaledBy_(t,e){return new Rect(Math.round(this.left*t),Math.round(this.top*e),Math.round(this.width*t),Math.round(this.height*e))}toString(){return`[${this.left}, ${this.top}, ${this.width}, ${this.height}]`}}const x11Colors=new Map([["aliceblue",["aliceblue","#f0f8ff","*",""]],["antiquewhite",["antiquewhite","#faebd7","*",""]],["antiquewhite01",["antiquewhite01","#ffefdb","",""]],["antiquewhite02",["antiquewhite02","#eedfcc","",""]],["antiquewhite03",["antiquewhite03","#cdc0b0","",""]],["antiquewhite04",["antiquewhite04","#8b8378","","#fff"]],["aqua",["aqua","#00ffff","*",""]],["aquamarine",["aquamarine","#7fffd4","*",""]],["aquamarine02",["aquamarine02","#76eec6","",""]],["aquamarine04",["aquamarine04","#458b74","","#fff"]],["azure",["azure","#f0ffff","*",""]],["azure02",["azure02","#e0eeee","",""]],["azure03",["azure03","#c1cdcd","",""]],["azure04",["azure04","#838b8b","","#fff"]],["beige",["beige","#f5f5dc","*",""]],["bisque",["bisque","#ffe4c4","*",""]],["bisque02",["bisque02","#eed5b7","",""]],["bisque03",["bisque03","#cdb79e","",""]],["bisque04",["bisque04","#8b7d6b","","#fff"]],["black",["black","#000000","*","#fff"]],["blanchedalmond",["blanchedalmond","#ffebcd","*",""]],["blue",["blue","#0000ff","*","#fff"]],["blue02",["blue02","#0000ee","","#fff"]],["blueviolet",["blueviolet","#8a2be2","*","#fff"]],["brown",["brown","#a52a2a","*","#fff"]],["brown01",["brown01","#ff4040","",""]],["brown02",["brown02","#ee3b3b","",""]],["brown03",["brown03","#cd3333","","#fff"]],["brown04",["brown04","#8b2323","","#fff"]],["burlywood",["burlywood","#deb887","*",""]],["burlywood01",["burlywood01","#ffd39b","",""]],["burlywood02",["burlywood02","#eec591","",""]],["burlywood03",["burlywood03","#cdaa7d","",""]],["burlywood04",["burlywood04","#8b7355","","#fff"]],["cadetblue",["cadetblue","#5f9ea0","*","#fff"]],["cadetblue01",["cadetblue01","#98f5ff","",""]],["cadetblue02",["cadetblue02","#8ee5ee","",""]],["cadetblue03",["cadetblue03","#7ac5cd","",""]],["cadetblue04",["cadetblue04","#53868b","","#fff"]],["chartreuse",["chartreuse","#7fff00","*",""]],["chartreuse02",["chartreuse02","#76ee00","",""]],["chartreuse03",["chartreuse03","#66cd00","",""]],["chartreuse04",["chartreuse04","#458b00","","#fff"]],["chocolate",["chocolate","#d2691e","*",""]],["chocolate01",["chocolate01","#ff7f24","",""]],["chocolate02",["chocolate02","#ee7621","",""]],["chocolate03",["chocolate03","#cd661d","",""]],["coral",["coral","#ff7f50","*",""]],["coral01",["coral01","#ff7256","",""]],["coral02",["coral02","#ee6a50","",""]],["coral03",["coral03","#cd5b45","",""]],["coral04",["coral04","#8b3e2f","","#fff"]],["cornflowerblue",["cornflowerblue","#6495ed","*",""]],["cornsilk",["cornsilk","#fff8dc","*",""]],["cornsilk02",["cornsilk02","#eee8cd","",""]],["cornsilk03",["cornsilk03","#cdc8b1","",""]],["cornsilk04",["cornsilk04","#8b8878","","#fff"]],["crimson",["crimson","#dc143c","*","#fff"]],["cyan",["cyan","#00ffff","*",""]],["cyan02",["cyan02","#00eeee","",""]],["cyan03",["cyan03","#00cdcd","",""]],["darkblue",["darkblue","#00008b","*","#fff"]],["darkcyan",["darkcyan","#008b8b","*","#fff"]],["darkgoldenrod",["darkgoldenrod","#b8860b","*","#fff"]],["darkgoldenrod01",["darkgoldenrod01","#ffb90f","",""]],["darkgoldenrod02",["darkgoldenrod02","#eead0e","",""]],["darkgoldenrod03",["darkgoldenrod03","#cd950c","",""]],["darkgoldenrod04",["darkgoldenrod04","#8b6508","","#fff"]],["darkgray",["darkgray","#a9a9a9","*",""]],["darkgreen",["darkgreen","#006400","*","#fff"]],["darkgrey",["darkgrey","#a9a9a9","*",""]],["darkkhaki",["darkkhaki","#bdb76b","*",""]],["darkmagenta",["darkmagenta","#8b008b","*","#fff"]],["darkolivegreen",["darkolivegreen","#556b2f","*","#fff"]],["darkolivegreen01",["darkolivegreen01","#caff70","",""]],["darkolivegreen02",["darkolivegreen02","#bcee68","",""]],["darkolivegreen03",["darkolivegreen03","#a2cd5a","",""]],["darkolivegreen04",["darkolivegreen04","#6e8b3d","","#fff"]],["darkorange",["darkorange","#ff8c00","*",""]],["darkorange01",["darkorange01","#ff7f00","",""]],["darkorange02",["darkorange02","#ee7600","",""]],["darkorange03",["darkorange03","#cd6600","",""]],["darkorange04",["darkorange04","#8b4500","","#fff"]],["darkorchid",["darkorchid","#9932cc","*","#fff"]],["darkorchid01",["darkorchid01","#bf3eff","","#fff"]],["darkorchid02",["darkorchid02","#b23aee","","#fff"]],["darkorchid03",["darkorchid03","#9a32cd","","#fff"]],["darkorchid04",["darkorchid04","#68228b","","#fff"]],["darkred",["darkred","#8b0000","*","#fff"]],["darksalmon",["darksalmon","#e9967a","*",""]],["darkseagreen",["darkseagreen","#8fbc8f","*",""]],["darkseagreen01",["darkseagreen01","#c1ffc1","",""]],["darkseagreen02",["darkseagreen02","#b4eeb4","",""]],["darkseagreen03",["darkseagreen03","#9bcd9b","",""]],["darkseagreen04",["darkseagreen04","#698b69","","#fff"]],["darkslateblue",["darkslateblue","#483d8b","*","#fff"]],["darkslategray",["darkslategray","#2f4f4f","*","#fff"]],["darkslategray01",["darkslategray01","#97ffff","",""]],["darkslategray02",["darkslategray02","#8deeee","",""]],["darkslategray03",["darkslategray03","#79cdcd","",""]],["darkslategray04",["darkslategray04","#528b8b","","#fff"]],["darkslategrey",["darkslategrey","#2f4f4f","*","#fff"]],["darkslategrey01",["darkslategrey01","#97ffff","",""]],["darkslategrey02",["darkslategrey02","#8deeee","",""]],["darkslategrey03",["darkslategrey03","#79cdcd","",""]],["darkslategrey04",["darkslategrey04","#528b8b","","#fff"]],["darkturquoise",["darkturquoise","#00ced1","*",""]],["darkviolet",["darkviolet","#9400d3","*","#fff"]],["deeppink",["deeppink","#ff1493","*",""]],["deeppink02",["deeppink02","#ee1289","",""]],["deeppink03",["deeppink03","#cd1076","","#fff"]],["deeppink04",["deeppink04","#8b0a50","","#fff"]],["deepskyblue",["deepskyblue","#00bfff","*",""]],["deepskyblue02",["deepskyblue02","#00b2ee","",""]],["deepskyblue03",["deepskyblue03","#009acd","",""]],["deepskyblue04",["deepskyblue04","#00688b","","#fff"]],["dimgray",["dimgray","#696969","*","#fff"]],["dimgrey",["dimgrey","#696969","*","#fff"]],["dodgerblue",["dodgerblue","#1e90ff","*","#fff"]],["dodgerblue02",["dodgerblue02","#1c86ee","","#fff"]],["dodgerblue03",["dodgerblue03","#1874cd","","#fff"]],["dodgerblue04",["dodgerblue04","#104e8b","","#fff"]],["firebrick",["firebrick","#b22222","*","#fff"]],["firebrick01",["firebrick01","#ff3030","",""]],["firebrick02",["firebrick02","#ee2c2c","",""]],["firebrick03",["firebrick03","#cd2626","","#fff"]],["firebrick04",["firebrick04","#8b1a1a","","#fff"]],["floralwhite",["floralwhite","#fffaf0","*",""]],["forestgreen",["forestgreen","#228b22","*","#fff"]],["fuchsia",["fuchsia","#ff00ff","*",""]],["gainsboro",["gainsboro","#dcdcdc","*",""]],["ghostwhite",["ghostwhite","#f8f8ff","*",""]],["gold",["gold","#ffd700","*",""]],["gold02",["gold02","#eec900","",""]],["gold03",["gold03","#cdad00","",""]],["gold04",["gold04","#8b7500","","#fff"]],["goldenrod",["goldenrod","#daa520","*",""]],["goldenrod01",["goldenrod01","#ffc125","",""]],["goldenrod02",["goldenrod02","#eeb422","",""]],["goldenrod03",["goldenrod03","#cd9b1d","",""]],["goldenrod04",["goldenrod04","#8b6914","","#fff"]],["gray",["gray","#808080","*","#fff"]],["green",["green","#008000","*","#fff"]],["green02",["green02","#00ee00","",""]],["green03",["green03","#00cd00","",""]],["green04",["green04","#008b00","","#fff"]],["greenyellow",["greenyellow","#adff2f","*",""]],["grey",["grey","#808080","*","#fff"]],["honeydew",["honeydew","#f0fff0","*",""]],["honeydew02",["honeydew02","#e0eee0","",""]],["honeydew03",["honeydew03","#c1cdc1","",""]],["honeydew04",["honeydew04","#838b83","","#fff"]],["hotpink",["hotpink","#ff69b4","*",""]],["hotpink01",["hotpink01","#ff6eb4","",""]],["hotpink02",["hotpink02","#ee6aa7","",""]],["hotpink03",["hotpink03","#cd6090","","#fff"]],["hotpink04",["hotpink04","#8b3a62","","#fff"]],["indianred",["indianred","#cd5c5c","*",""]],["indianred01",["indianred01","#ff6a6a","","#fff"]],["indianred02",["indianred02","#ee6363","",""]],["indianred03",["indianred03","#cd5555","","#fff"]],["indianred04",["indianred04","#8b3a3a","","#fff"]],["indigo",["indigo","#4b0082","*","#fff"]],["ivory",["ivory","#fffff0","*",""]],["ivory02",["ivory02","#eeeee0","",""]],["ivory03",["ivory03","#cdcdc1","",""]],["ivory04",["ivory04","#8b8b83","","#fff"]],["khaki",["khaki","#f0e68c","*",""]],["khaki01",["khaki01","#fff68f","",""]],["khaki02",["khaki02","#eee685","",""]],["khaki03",["khaki03","#cdc673","",""]],["khaki04",["khaki04","#8b864e","","#fff"]],["lavender",["lavender","#e6e6fa","*",""]],["lavenderblush",["lavenderblush","#fff0f5","*",""]],["lavenderblush02",["lavenderblush02","#eee0e5","",""]],["lavenderblush03",["lavenderblush03","#cdc1c5","",""]],["lavenderblush04",["lavenderblush04","#8b8386","","#fff"]],["lawngreen",["lawngreen","#7cfc00","*",""]],["lemonchiffon",["lemonchiffon","#fffacd","*",""]],["lemonchiffon02",["lemonchiffon02","#eee9bf","",""]],["lemonchiffon03",["lemonchiffon03","#cdc9a5","",""]],["lemonchiffon04",["lemonchiffon04","#8b8970","","#fff"]],["lightblue",["lightblue","#add8e6","*",""]],["lightblue01",["lightblue01","#bfefff","",""]],["lightblue02",["lightblue02","#b2dfee","",""]],["lightblue03",["lightblue03","#9ac0cd","",""]],["lightblue04",["lightblue04","#68838b","","#fff"]],["lightcoral",["lightcoral","#f08080","*",""]],["lightcyan",["lightcyan","#e0ffff","*",""]],["lightcyan02",["lightcyan02","#d1eeee","",""]],["lightcyan03",["lightcyan03","#b4cdcd","",""]],["lightcyan04",["lightcyan04","#7a8b8b","","#fff"]],["lightgoldenrod",["lightgoldenrod","#eedd82","",""]],["lightgoldenrod01",["lightgoldenrod01","#ffec8b","",""]],["lightgoldenrod02",["lightgoldenrod02","#eedc82","",""]],["lightgoldenrod03",["lightgoldenrod03","#cdbe70","",""]],["lightgoldenrod04",["lightgoldenrod04","#8b814c","","#fff"]],["lightgoldenrodyellow",["lightgoldenrodyellow","#fafad2","*",""]],["lightgray",["lightgray","#d3d3d3","*",""]],["lightgreen",["lightgreen","#90ee90","*",""]],["lightgrey",["lightgrey","#d3d3d3","*",""]],["lightpink",["lightpink","#ffb6c1","*",""]],["lightpink01",["lightpink01","#ffaeb9","",""]],["lightpink02",["lightpink02","#eea2ad","",""]],["lightpink03",["lightpink03","#cd8c95","",""]],["lightpink04",["lightpink04","#8b5f65","","#fff"]],["lightsalmon",["lightsalmon","#ffa07a","*",""]],["lightsalmon02",["lightsalmon02","#ee9572","",""]],["lightsalmon03",["lightsalmon03","#cd8162","",""]],["lightsalmon04",["lightsalmon04","#8b5742","","#fff"]],["lightseagreen",["lightseagreen","#20b2aa","*",""]],["lightskyblue",["lightskyblue","#87cefa","*",""]],["lightskyblue01",["lightskyblue01","#b0e2ff","",""]],["lightskyblue02",["lightskyblue02","#a4d3ee","",""]],["lightskyblue03",["lightskyblue03","#8db6cd","",""]],["lightskyblue04",["lightskyblue04","#607b8b","","#fff"]],["lightslateblue",["lightslateblue","#8470ff","","#fff"]],["lightslategray",["lightslategray","#778899","*","#fff"]],["lightslategrey",["lightslategrey","#778899","*","#fff"]],["lightsteelblue",["lightsteelblue","#b0c4de","*",""]],["lightsteelblue01",["lightsteelblue01","#cae1ff","",""]],["lightsteelblue02",["lightsteelblue02","#bcd2ee","",""]],["lightsteelblue03",["lightsteelblue03","#a2b5cd","",""]],["lightsteelblue04",["lightsteelblue04","#6e7b8b","","#fff"]],["lightyellow",["lightyellow","#ffffe0","*",""]],["lightyellow02",["lightyellow02","#eeeed1","",""]],["lightyellow03",["lightyellow03","#cdcdb4","",""]],["lightyellow04",["lightyellow04","#8b8b7a","","#fff"]],["lime",["lime","#00ff00","*",""]],["limegreen",["limegreen","#32cd32","*",""]],["linen",["linen","#faf0e6","*",""]],["magenta",["magenta","#ff00ff","*",""]],["magenta02",["magenta02","#ee00ee","",""]],["magenta03",["magenta03","#cd00cd","","#fff"]],["maroon",["maroon","#800000","*","#fff"]],["maroon01",["maroon01","#ff34b3","",""]],["maroon02",["maroon02","#ee30a7","",""]],["maroon03",["maroon03","#cd2990","","#fff"]],["maroon04",["maroon04","#8b1c62","","#fff"]],["mediumaquamarine",["mediumaquamarine","#66cdaa","*",""]],["mediumblue",["mediumblue","#0000cd","*","#fff"]],["mediumorchid",["mediumorchid","#ba55d3","*","#fff"]],["mediumorchid01",["mediumorchid01","#e066ff","",""]],["mediumorchid02",["mediumorchid02","#d15fee","",""]],["mediumorchid03",["mediumorchid03","#b452cd","","#fff"]],["mediumorchid04",["mediumorchid04","#7a378b","","#fff"]],["mediumpurple",["mediumpurple","#9370db","*","#fff"]],["mediumpurple01",["mediumpurple01","#ab82ff","","#fff"]],["mediumpurple02",["mediumpurple02","#9f79ee","","#fff"]],["mediumpurple03",["mediumpurple03","#8968cd","","#fff"]],["mediumpurple04",["mediumpurple04","#5d478b","","#fff"]],["mediumseagreen",["mediumseagreen","#3cb371","*",""]],["mediumslateblue",["mediumslateblue","#7b68ee","*","#fff"]],["mediumspringgreen",["mediumspringgreen","#00fa9a","*",""]],["mediumturquoise",["mediumturquoise","#48d1cc","*",""]],["mediumvioletred",["mediumvioletred","#c71585","*","#fff"]],["midnightblue",["midnightblue","#191970","*","#fff"]],["mintcream",["mintcream","#f5fffa","*",""]],["mistyrose",["mistyrose","#ffe4e1","*",""]],["mistyrose02",["mistyrose02","#eed5d2","",""]],["mistyrose03",["mistyrose03","#cdb7b5","",""]],["mistyrose04",["mistyrose04","#8b7d7b","","#fff"]],["moccasin",["moccasin","#ffe4b5","*",""]],["navajowhite",["navajowhite","#ffdead","*",""]],["navajowhite02",["navajowhite02","#eecfa1","",""]],["navajowhite03",["navajowhite03","#cdb38b","",""]],["navajowhite04",["navajowhite04","#8b795e","","#fff"]],["navy",["navy","#000080","*","#fff"]],["oldlace",["oldlace","#fdf5e6","*",""]],["olive",["olive","#808000","*","#fff"]],["olivedrab",["olivedrab","#6b8e23","*","#fff"]],["olivedrab01",["olivedrab01","#c0ff3e","",""]],["olivedrab02",["olivedrab02","#b3ee3a","",""]],["olivedrab04",["olivedrab04","#698b22","","#fff"]],["orange",["orange","#ffa500","*",""]],["orange02",["orange02","#ee9a00","",""]],["orange03",["orange03","#cd8500","",""]],["orange04",["orange04","#8b5a00","","#fff"]],["orangered",["orangered","#ff4500","*",""]],["orangered02",["orangered02","#ee4000","",""]],["orangered03",["orangered03","#cd3700","","#fff"]],["orangered04",["orangered04","#8b2500","","#fff"]],["orchid",["orchid","#da70d6","*",""]],["orchid01",["orchid01","#ff83fa","",""]],["orchid02",["orchid02","#ee7ae9","",""]],["orchid03",["orchid03","#cd69c9","",""]],["orchid04",["orchid04","#8b4789","","#fff"]],["palegoldenrod",["palegoldenrod","#eee8aa","*",""]],["palegreen",["palegreen","#98fb98","*",""]],["palegreen01",["palegreen01","#9aff9a","",""]],["palegreen03",["palegreen03","#7ccd7c","",""]],["palegreen04",["palegreen04","#548b54","","#fff"]],["paleturquoise",["paleturquoise","#afeeee","*",""]],["paleturquoise01",["paleturquoise01","#bbffff","",""]],["paleturquoise02",["paleturquoise02","#aeeeee","",""]],["paleturquoise03",["paleturquoise03","#96cdcd","",""]],["paleturquoise04",["paleturquoise04","#668b8b","","#fff"]],["palevioletred",["palevioletred","#db7093","*",""]],["palevioletred01",["palevioletred01","#ff82ab","",""]],["palevioletred02",["palevioletred02","#ee799f","",""]],["palevioletred03",["palevioletred03","#cd6889","","#fff"]],["palevioletred04",["palevioletred04","#8b475d","","#fff"]],["papayawhip",["papayawhip","#ffefd5","*",""]],["peachpuff",["peachpuff","#ffdab9","*",""]],["peachpuff02",["peachpuff02","#eecbad","",""]],["peachpuff03",["peachpuff03","#cdaf95","",""]],["peachpuff04",["peachpuff04","#8b7765","","#fff"]],["peru",["peru","#cd853f","*",""]],["pink",["pink","#ffc0cb","*",""]],["pink01",["pink01","#ffb5c5","",""]],["pink02",["pink02","#eea9b8","",""]],["pink03",["pink03","#cd919e","",""]],["pink04",["pink04","#8b636c","","#fff"]],["plum",["plum","#dda0dd","*",""]],["plum01",["plum01","#ffbbff","",""]],["plum02",["plum02","#eeaeee","",""]],["plum03",["plum03","#cd96cd","",""]],["plum04",["plum04","#8b668b","","#fff"]],["powderblue",["powderblue","#b0e0e6","*",""]],["purple",["purple","#800080","*","#fff"]],["purple01",["purple01","#9b30ff","","#fff"]],["purple02",["purple02","#912cee","","#fff"]],["purple03",["purple03","#7d26cd","","#fff"]],["purple04",["purple04","#551a8b","","#fff"]],["rebeccapurple",["rebeccapurple","#663399","","#fff"]],["red",["red","#ff0000","*",""]],["red02",["red02","#ee0000","",""]],["red03",["red03","#cd0000","","#fff"]],["rosybrown",["rosybrown","#bc8f8f","*",""]],["rosybrown01",["rosybrown01","#ffc1c1","",""]],["rosybrown02",["rosybrown02","#eeb4b4","",""]],["rosybrown03",["rosybrown03","#cd9b9b","",""]],["rosybrown04",["rosybrown04","#8b6969","","#fff"]],["royalblue",["royalblue","#4169e1","*","#fff"]],["royalblue01",["royalblue01","#4876ff","","#fff"]],["royalblue02",["royalblue02","#436eee","","#fff"]],["royalblue03",["royalblue03","#3a5fcd","","#fff"]],["royalblue04",["royalblue04","#27408b","","#fff"]],["saddlebrown",["saddlebrown","#8b4513","*","#fff"]],["salmon",["salmon","#fa8072","*",""]],["salmon01",["salmon01","#ff8c69","",""]],["salmon02",["salmon02","#ee8262","",""]],["salmon03",["salmon03","#cd7054","",""]],["salmon04",["salmon04","#8b4c39","","#fff"]],["sandybrown",["sandybrown","#f4a460","*",""]],["seagreen",["seagreen","#2e8b57","*","#fff"]],["seagreen01",["seagreen01","#54ff9f","",""]],["seagreen02",["seagreen02","#4eee94","",""]],["seagreen03",["seagreen03","#43cd80","",""]],["seashell",["seashell","#fff5ee","*",""]],["seashell02",["seashell02","#eee5de","",""]],["seashell03",["seashell03","#cdc5bf","",""]],["seashell04",["seashell04","#8b8682","","#fff"]],["sienna",["sienna","#a0522d","*","#fff"]],["sienna01",["sienna01","#ff8247","",""]],["sienna02",["sienna02","#ee7942","",""]],["sienna03",["sienna03","#cd6839","",""]],["sienna04",["sienna04","#8b4726","","#fff"]],["silver",["silver","#c0c0c0","*",""]],["skyblue",["skyblue","#87ceeb","*",""]],["skyblue01",["skyblue01","#87ceff","",""]],["skyblue02",["skyblue02","#7ec0ee","",""]],["skyblue03",["skyblue03","#6ca6cd","",""]],["skyblue04",["skyblue04","#4a708b","","#fff"]],["slateblue",["slateblue","#6a5acd","*","#fff"]],["slateblue01",["slateblue01","#836fff","","#fff"]],["slateblue02",["slateblue02","#7a67ee","","#fff"]],["slateblue03",["slateblue03","#6959cd","","#fff"]],["slateblue04",["slateblue04","#473c8b","","#fff"]],["slategray",["slategray","#708090","*","#fff"]],["slategray01",["slategray01","#c6e2ff","",""]],["slategray02",["slategray02","#b9d3ee","",""]],["slategray03",["slategray03","#9fb6cd","",""]],["slategray04",["slategray04","#6c7b8b","","#fff"]],["slategrey",["slategrey","#708090","*","#fff"]],["slategrey01",["slategrey01","#c6e2ff","",""]],["slategrey02",["slategrey02","#b9d3ee","",""]],["slategrey03",["slategrey03","#9fb6cd","",""]],["slategrey04",["slategrey04","#6c7b8b","","#fff"]],["snow",["snow","#fffafa","*",""]],["snow02",["snow02","#eee9e9","",""]],["snow03",["snow03","#cdc9c9","",""]],["snow04",["snow04","#8b8989","","#fff"]],["springgreen",["springgreen","#00ff7f","*",""]],["springgreen02",["springgreen02","#00ee76","",""]],["springgreen03",["springgreen03","#00cd66","",""]],["springgreen04",["springgreen04","#008b45","","#fff"]],["steelblue",["steelblue","#4682b4","*","#fff"]],["steelblue01",["steelblue01","#63b8ff","",""]],["steelblue02",["steelblue02","#5cacee","",""]],["steelblue03",["steelblue03","#4f94cd","","#fff"]],["steelblue04",["steelblue04","#36648b","","#fff"]],["tan",["tan","#d2b48c","*",""]],["tan01",["tan01","#ffa54f","",""]],["tan02",["tan02","#ee9a49","",""]],["tan04",["tan04","#8b5a2b","","#fff"]],["teal",["teal","#008080","*","#fff"]],["thistle",["thistle","#d8bfd8","*",""]],["thistle01",["thistle01","#ffe1ff","",""]],["thistle02",["thistle02","#eed2ee","",""]],["thistle03",["thistle03","#cdb5cd","",""]],["thistle04",["thistle04","#8b7b8b","","#fff"]],["tomato",["tomato","#ff6347","*",""]],["tomato02",["tomato02","#ee5c42","",""]],["tomato03",["tomato03","#cd4f39","","#fff"]],["tomato04",["tomato04","#8b3626","","#fff"]],["turquoise",["turquoise","#40e0d0","*",""]],["turquoise01",["turquoise01","#00f5ff","",""]],["turquoise02",["turquoise02","#00e5ee","",""]],["turquoise03",["turquoise03","#00c5cd","",""]],["turquoise04",["turquoise04","#00868b","","#fff"]],["violet",["violet","#ee82ee","*",""]],["violetred",["violetred","#d02090","","#fff"]],["violetred01",["violetred01","#ff3e96","",""]],["violetred02",["violetred02","#ee3a8c","",""]],["violetred03",["violetred03","#cd3278","","#fff"]],["violetred04",["violetred04","#8b2252","","#fff"]],["webgray",["webgray","#808080","","#fff"]],["webgreen",["webgreen","#008000","","#fff"]],["webgrey",["webgrey","#808080","","#fff"]],["webmaroon",["webmaroon","#800000","","#fff"]],["webpurple",["webpurple","#800080","","#fff"]],["wheat",["wheat","#f5deb3","*",""]],["wheat01",["wheat01","#ffe7ba","",""]],["wheat02",["wheat02","#eed8ae","",""]],["wheat03",["wheat03","#cdba96","",""]],["wheat04",["wheat04","#8b7e66","","#fff"]],["white",["white","#ffffff","*",""]],["whitesmoke",["whitesmoke","#f5f5f5","*",""]],["x11gray",["x11gray","#bebebe","",""]],["x11green",["x11green","#00ff00","",""]],["x11grey",["x11grey","#bebebe","",""]],["x11maroon",["x11maroon","#b03060","","#fff"]],["x11purple",["x11purple","#a020f0","","#fff"]],["yellow",["yellow","#ffff00","*",""]],["yellow02",["yellow02","#eeee00","",""]],["yellow03",["yellow03","#cdcd00","",""]],["yellow04",["yellow04","#8b8b00","","#fff"]],["yellowgreen",["yellowgreen","#9acd32","*",""]]]),X11ColorsByHex=function(){let t=new Map;return[...x11Colors].map(t=>{let e=t[1];return[e[1],e]}).forEach(e=>{t.has(e[0])||t.set(e[0],e[1])}),t}();class EventListenerBuilder{constructor(t){this.elm=t}add_(t,e,i){return this.elm.addEventListener(t,e,i),this}}class ClasslistBuilder{constructor(t){var e,i;this.classlist=null!==(i=null===(e=DomUt.asHTMLElement_(t))||void 0===e?void 0:e.classList)&&void 0!==i?i:t}array_(){return Array.from(this.classlist)}forEach_(t){const e=this;this.array_().forEach(i=>{t(i,e)})}contains_(t){return this.classlist.contains(t)}containsAll_(...t){for(let e of t)if(!this.classlist.contains(e))return!1;return!0}containsAny_(...t){for(let e of t)if(this.classlist.contains(e))return!0;return!1}add_(t){return this.classlist.add(t),this}remove_(t){return this.classlist.remove(t),this}toggle_(t){return this.classlist.toggle(t),this}addAll_(...t){for(let e of t)this.classlist.add(e);return this}removeAll_(...t){for(let e of t)this.classlist.remove(e);return this}toggleAll_(...t){for(let e of t)this.classlist.toggle(e);return this}}class HumanFilepath{constructor(t){this._filepath=t}static fromJSON_(t){return new HumanFilepath(t)}static getValue_(t){let e=t.value;if(e.startsWith("/"))return e;const i=t.getAttribute(ATTR.AnInfo);return null!=i?Basepath.changeNameWithSuffix_(i,e):e}static setValue_(t,e){new HumanFilepath(e).updateInput_(t)}get isEmpty$(){return 0==this._filepath.length}get isAbsolute$(){return this._filepath.startsWith("/")}get filepath$(){return this._filepath}get human$(){return Basepath.nameWithSuffix_(this._filepath)}updateInput_(t){t.setAttribute(ATTR.AnInfo,this.toJSON_()),t.value=this.human$}toJSON_(){return this._filepath}}HumanFilepath.Empty$=new HumanFilepath("");class HumanLink{constructor(t,e,i){this._filepath=t,this._search=e,this._hash=i}static fromJSON_(t){const e=An.parseJSONOrNull_(t);return null==e?this.Empty$:new HumanLink(e[0],e[1],e[2])}static fromInput_(t){let e=HumanLink.fromJSON_(t.getAttribute(ATTR.AnInfo));return t.value==e.human$?e:e.changeFromInput_(t)}static fromFilepath_(t,e="",i=""){return new HumanLink(t,e,i)}static fromUri_(t){return new HumanLink(t.pathSegments$.join("/"),this._humanSearchFromParams(t.queryParameters$),this._humanHash(t.hash$))}static fromHref_(t){if(An.isempty_(t))return HumanLink.Empty$;const[e,i,n]=UriUt.split_(t);return new HumanLink(this._decodedPath(e),this._humanSearchFromHref(i),this._humanHash(n))}static getValue_(t){let e=t.value;if(0==e.length)return"";if(e.startsWith("/"))return e;const i=HumanLink.fromJSON_(t.getAttribute(ATTR.AnInfo)),n=Basepath.dir_(i.filepath$);return Basepath.joinRpath_(null==n?null:this._humanPath(n),e)}static setValue_(t,e){HumanLink.fromHref_(e).updateInput_(t)}static setUri_(t,e){HumanLink.fromUri_(e).updateInput_(t)}static _humanSearchFromParams(t){const e=new StringBuffer;return t.forEach((t,i)=>this._humanSearchParam(e,i,t)),0==e.length$?"":"?"+e.toString()}static _humanSearchFromHref(t){if(0==t.length)return t;const e=new StringBuffer;return t.substring(1).split("&").forEach(t=>{const i=t.split("=",2);this._humanSearchParam(e,decodeURIComponent(i[0]),i.length>1?decodeURIComponent(i[1]):"")}),0==e.length$?"":"?"+e.toString()}static _humanSearchParam(t,e,i){let n=this._humanesc(e,An._QUERY_ILLEGALS),s=0==i.length?"":this._humanesc(i,An._QUERY_ILLEGALS);t.length$>0&&t.write_("&"),t.write_(n),s.length>0&&(t.write_("="),t.write_(s))}static _humanHash(t){return 0==t.length?"":"#"+this._humanesc(decodeURIComponent(t.substring(1)),An._FRAGMENT_ILLEGALS)}static _decodedPath(t){return t.split("/").map(decodeURIComponent).join("/")}static _humanPath(t){return this._humanesc(t,An._PATHPART_ILLEGALS)}static _humanesc(t,e){var i;let n=null,s=0,o=t.length;for(let l=0;l<o;++l){let o=null!==(i=t.codePointAt(l))&&void 0!==i?i:0;if(e.includes(o)||o<32||o>=127&&!An.isHuman_(o))if(null==n&&(n=new StringBuffer),s<l&&n.write_(t.substring(s,l)),s=l+1,o<=255)n.write_("%"),n.write_(An.to02X_(o));else for(let t of An.textEncoder$.encode(String.fromCodePoint(o)))n.write_("%"),n.write_(An.to02X_(t))}return null==n?t:(s<o&&n.write_(t.substring(s,o)),n.toString())}get isEmpty$(){return 0==this._filepath.length&&0==this._search.length&&0==this._hash.length}get isAbsolute$(){return this._filepath.startsWith("/")}get filepath$(){return this._filepath}get human$(){return HumanLink._humanPath(Basepath.nameWithSuffix_(this._filepath))+this._search+this._hash}get humanHref$(){return HumanLink._humanPath(this._filepath)+this._search+this._hash}changeFilepath_(t){return new HumanLink(t,this._search,this._hash)}changeFromInput_(t){const[e,i,n]=UriUt.split_(t.value),s=HumanLink._decodedPath(e),o=s.startsWith("/")?new HumanLink(s,i,n):new HumanLink(Basepath.changeNameWithSuffix_(this.filepath$,s),i,n);return o.updateInput_(t),o}updateInput_(t){t.setAttribute(ATTR.AnInfo,this.toJSON_()),t.value=this.human$}toJSON_(){return JSON.stringify([this._filepath,this._search,this._hash])}toString(){return this.humanHref$}}HumanLink.Empty$=new HumanLink("","","");class An{static error_(t){console.log(t)}static notXX_(t){return null!=t}static parseJSONObjectOrNull_(t){if(null==t)return null;try{return JSON.parse(t)}catch(t){return null}}static parseJSONArrayOrNull_(t){if(null==t)return null;try{const e=JSON.parse(t);return e instanceof Array?e:null}catch(t){return null}}static parseJSONOrNull_(t){if(null==t)return null;try{return JSON.parse(t)}catch(t){return null}}static setDatetime(t,e){t.classList.add(CSS.xDate),t.setAttribute(ATTR.xFormat,An.datetimeXFormatValue_(e.dateformat,e.timeformat,e.now)),t.textContent=e.datestring}static errorResult_(t,e){t(smapOf_(Key.errors,e))}static okResult_(t){t(smapOf_(Key.result,{}))}static to02d_(t){return t.toFixed(0).padStart(2,"0")}static to2d_(t){return t.toFixed(0).padStart(2,"")}static to04d_(t){return t.toFixed(0).padStart(4,"0")}static to02X_(t){if(t>=0){if(t<16)return _H02[t];if(t<256)return _HEX[t>>4]+_HEX[15&t]}return t.toString(16).toUpperCase()}static now_(){return DateTime.now_().millisecondsSinceEpoch$}static now00_(){return An.now01_(DateTime.now_())}static now01_(t){return DateTime.fromMillisecondsSinceEpoch_(t.millisecondsSinceEpoch$/6e4*6e4)}static today_(){let t=DateTime.now_();return An.to04d_(t.year$)+An.to02d_(t.month$)+An.to02d_(t.day$)}static datetimeXFormatValue_(t,e,i=null){return`${t};${e};${null==i?"":i.millisecondsSinceEpoch$}`}static splitDatetimeXFormat_(t){return null==t||0==t.length?[]:t.split(";")}static datetimeString_(t,e,i){let n=DateFormat.dateString(t,i),s=TimeFormat.timeString(e,i);return An.joinNotEmpty_(" ",[n,s])}static simpleDateString_(t){return null==t&&(t=DateTime.now_()),An.to04d_(t.year$)+An.to02d_(t.month$)+An.to02d_(t.day$)}static simpleDateTimeString_(t){return null==t&&(t=DateTime.now_()),An.to04d_(t.year$)+An.to02d_(t.month$)+An.to02d_(t.day$)+"-"+An.to02d_(t.hour$)+An.to02d_(t.minute$)+An.to02d_(t.second$)}static ms_(){return DateTime.now_().millisecondsSinceEpoch$}static msString_(t=null){return null==t&&(t=DateTime.now_()),t.millisecondsSinceEpoch$.toString()}static simpleTimeString_(t){return`${An.to02d_(t.hour$)}${An.to02d_(t.minute$)}${An.to02d_(t.second$)}`}static isSameDay_(t,e){return e.day$==t.day$&&e.month$==t.month$&&e.year$==t.year$}static tostring_(t,e){return null==t?e:t.toString()}static filesizeUnit4_(t){return An._valueunit(DEF.FILESIZE_UNITS,1e4,1024,1023,t)}static decUnit4_(t){return An._valueunit(DEF.DECIMAL_VALUE_UNITS,1e4,1e3,555,t)}static _valueunit(t,e,i,n,s){const o=t.length;let l=0;for(;l<o-1&&!(s<e);++l)s=(s+n)/i;return`${s.toFixed(0)} ${t[l]}`}static timeStringFromSeconds_(t){let e=Math.round(t);if(e<60)return`00:${An.to02d_(e)}`;let i=Math.floor(e/60);if(e-=60*i,i<60)return`${An.to02d_(i)}:${An.to02d_(e)}`;let n=Math.floor(i/60);return i-=60*n,`${n}:${An.to02d_(i)}:${An.to02d_(e)}`}static timeStringFromMs_(t){let e=Math.round(t/1e3),i=e%60,n=(e=Math.floor(e/60))%60,s=Math.floor(e/60);return s>0?`${An.to02d_(s)}:${An.to02d_(n)}:${An.to02d_(i)}`:`${An.to02d_(n)}:${An.to02d_(i)}`}static fromIntUnit_(t,e){if(null==t)return e;const i=t[0];switch(t[1]){case"":case"b":case"B":return i;case"K":case"KB":return i*K;case"M":case"MB":return i*K*K;case"G":case"GB":return i*K*K*K;case"k":case"kb":return 1e3*i;case"m":case"mb":return 1e3*i*1e3;case"g":case"gb":return 1e3*i*1e3*1e3}return e}static msFromStringTimeUnit_(t,e){return this.msFromDoubleTimeUnit_(this.doubleValueUnit_(t),e)}static msFromDoubleTimeUnit_(t,e){if(null==t)return e;const i=t[0];let n=t[1].toLowerCase();switch(n){case"":case"ms":return Math.floor(i);case"s":case"sec":case"sec.":case"second":return Math.floor(1e3*i);case"m":case"min":case"min.":case"minute":return Math.floor(1e3*i*60);case"h":case"hr":case"hr.":case"hour":return Math.floor(1e3*i*60*60);case"d":case"day":return Math.floor(1e3*i*60*60*24)}return MSG.string_(RS.ms)==n?Math.floor(i):MSG.string_(RS.sec)==n?Math.floor(1e3*i):MSG.string_(RS.min)==n?Math.floor(1e3*i*60):MSG.string_(RS.hour)==n?Math.floor(1e3*i*60*60):MSG.string_(RS.day)==n?Math.floor(1e3*i*60*60*24):e}static uriFrom_(t,e,i="",n=""){return Uri.from_(e,i,n,null==t?void 0:t)}static parseUri_(t,e){return Uri.parse_(t,e)}static uriFromSafe_(t,e,i="",n=""){if(null==e)return null;try{return An.uriFrom_(t,e,i,n)}catch(t){return null}}static parseUriSafe_(t,e){if(null==t)return null;try{return An.parseUri_(t,e)}catch(t){return null}}static parseUriAndWarn_(t,e,i){if(null==t)return null;try{return An.parseUri_(t,e)}catch(t){return i.warn_(`${t}`),null}}static cpathOfUri_(t){return t.toAbsolute_().path$}static cdirOfUri_(t){return null==t?null:Basepath.dir_(t.toAbsolute_().path$)}static cpathOfHref2_(t,e){const i=An.parseUriSafe_(e,t);return null==i?null:this.cpathOfUri_(i)}static cpathOfFilepath2_(t,e){let i=Basepath.cleanFilepath_(e);if(i.startsWith("/"))return i;const n="string"!=typeof t?null==t?null:Basepath.dir_(t.path$):t;return Basepath.cleanFilepath_(Basepath.joinPath_(n,i))}static uriOfFilepath2_(t,e,i="",n=""){return An.uriFromSafe_(t,e.split("/"),i,n)}static rpath2_(t,e){return Basepath.rpath_(this.ensureLeadingSlash_(Basepath.cleanFilepath_(t)),this.ensureLeadingSlash_(Basepath.cleanFilepath_(e)))}static uriFragment_(t){return An.isempty_(t.hash$)?null:t.hash$}static escFilepathForUri_(t){let e="",i=0,n=t.length;for(let s=0;s<n;++s){let n=t.codePointAt(s);n!=DEF.QUERY&&n!=DEF.FRAGMENT&&n!=DEF.PERCENT&&n!=DEF.LBRACKET&&n!=DEF.RBRACKET&&n!=DEF.SEMICOLON||(i<s&&(e+=t.substring(i,s)),i=s+1,e+="%",e+=An.to02X_(n))}return 0==i?t:(i<n&&(e+=t.substring(i,n)),e)}static famap_(t){return With.notnull_(t,t=>{var e;return null!==(e=An._famap.get(t))&&void 0!==e?e:null})}static isLinebreak_(t){return void 0!==t&&_LINEBREAKS.indexOf(t)>=0}static isWhitespace_(t){return void 0!==t&&_WHITESPACES.indexOf(t)>=0}static isSpace_(t){return void 0!==t&&_SPACES.indexOf(t)>=0}static skipSpaces_(t,e,i){for(;e<i&&An.isSpace_(t.codePointAt(e));)++e;return e}static rskipSpaces_(t,e,i){for(;i>e&&An.isSpace_(t.codePointAt(i-1));)--i;return i}static skipWhitespaces_(t,e,i){for(;e<i&&An.isWhitespace_(t.codePointAt(e));)++e;return e}static rskipWhitespaces_(t,e,i){for(;i>e&&An.isWhitespace_(t.codePointAt(i-1));)--i;return i}static skipNonWhitespaces_(t,e,i){for(;e<i&&!An.isWhitespace_(t.codePointAt(e));)++e;return e}static trimLeftSpaces_(t){let e=An.skipSpaces_(t,0,t.length);return 0==e?t:t.substring(e)}static isXmlNameStart_(t,e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz:_".includes(e)||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533}static isXmlName_(t,e){return An.isXmlNameStart_(t,e)||"0123456789-.".includes(e)||t>=768&&t<=879||t>=8255&&t<=8256}static pathQueryFragment_(t){return t}static _makequery(t){let e=new StringBuffer,i=!0;return[...t].forEach(t=>{i?i=!1:e.write_("&"),e.write_(t[0]);let n=t[1];null!=n&&n.length>0&&(e.write_("="),e.write_(n))}),e.toString()}static toDataUrl_(t,e){return"data:"+t+";base64,"+e}static toJpegDataUrl_(t){return"data:image/jpeg;base64,"+t}static jsonError_(t,...e){const i=MSG.string_(t)+e.join("");return smapOf_(Key.errors,i)}static getMessage_(t){var e;return null==t?null:"string"==typeof t?t:t instanceof Array?t.length>0?t:null:"object"==typeof t?An.getMessage_(null!==(e=t[Key.errors])&&void 0!==e?e:null):MSG.string_(RS.AssertExpectingStringListOrMap_)}static messagesList_(t){var e;return null===t?[]:"string"==typeof t?[t]:t instanceof Array?t:"object"==typeof t?An.messagesList_(null!==(e=t[Key.errors])&&void 0!==e?e:null):[]}static hasMessage_(t){return null!=this.getMessage_(t)}static getWarnsList_(t){var e;return null==t?[]:"string"==typeof t?[t]:t instanceof Array?t:"object"==typeof t?An.getWarnsList_(null!==(e=t[Key.warns])&&void 0!==e?e:null):[MSG.string_(RS.AssertExpectingStringListOrMap_)]}static getResult_(t){var e;return null==t?null:"string"==typeof t?t:t instanceof Array?t.length>0?t:null:"object"==typeof t?An.getResult_(null!==(e=t[Key.result])&&void 0!==e?e:null):MSG.string_(RS.AssertExpectingStringListOrMap_)}static getBool_(t,e){let i=t.get(e);return null!=i&&1==i}static getInt_(t,e,i){let n=t.get(e);return null!=n?n:i}static isTrue_(t){return null!=t&&1==t}static rangeStart_(t){if(null==t)return null;let e=t.startContainer;return e.nodeType==Node.ELEMENT_NODE?e.childNodes[t.startOffset]:e}static rangeEnd_(t){if(null==t)return null;let e=t.endContainer;return e.nodeType==Node.ELEMENT_NODE?e.childNodes[t.endOffset]:e}static identityIndex_(t){var e;let i=null===(e=t.parentNode)||void 0===e?void 0:e.childNodes;if(null!=i)for(let e=0,n=i.length;e<n;++e)if(i[e]===t)return e;throw Assert.notReach_(`${MSG.string_(RS.AssertIndexOfNodeNotFound_)}${t}`)}static identityIndexOf_(t,e){for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return i;return null}static identityContains_(t,e){for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return!0;return!1}static identityRemove_(t,e){for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return t.splice(i,1),!0;return!1}static identityAdd_(t,e){for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return!1;return t.push(e),!0}static getTextContent_(t,e){var i;for(let n=e.firstChild;null!=n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE?(t.write_(" "),An.getTextContent_(t,n),t.write_(" ")):t.write_(null!==(i=n.textContent)&&void 0!==i?i:"");return t}static normalizeTextContent_(t){return t.replace(RX.Spaces_g," ").trim()}static createRange_(t){let e=t.ownerDocument.createRange();return e.selectNode(t),e}static createStringList1_(t){return An.createStringList_([],t)}static createStringList_(t,e){for(let i of e){let e=i[1],n=i[2];for(let s=i[0];s<e;s+=n)t.push(s.toString())}return t}static createIntList_(t,e){for(let i of e){let e=i[1],n=i[2];for(let s=i[0];s<e;s+=n)t.push(s)}return t}static binarySearchInt1_(t,e){return An.binarySearchInt_(t,0,t.length,e)}static binarySearchInt_(t,e,i,n){for(--i;e<=i;){let s=e+i>>1;if(t[s]<n)e=s+1;else{if(!(t[s]>n))return s;i=s-1}}return-(e+1)}static binarySearchIntValue_(t,e,i,n){let s=An.binarySearchInt_(t,e,i,n);return s<0&&(s=-s-1),s<0&&(s=0),s>=t.length&&(s=t.length-1),t[s]}static binarySearcher_(t,e,i,n){for(--i;e<=i;){let s=e+i>>1,o=n(t[s]);if(o<0)e=s+1;else{if(!(o>0))return s;i=s-1}}return-(e+1)}static compareNullable_(t,e,i){return null==t?null==e?0:-1:null==e?1:i(t,e)}static fuzzyMatch_(t,e){const i=Ut.codepoints_(t);return this.fuzzyMatch1_(i,e)}static fuzzyMatch1_(t,e){const i=Ut.codepoints_(e);let n=0,s=i.length;for(let e of t){if(n>=s)return!1;let t=i.indexOf(e,n);if(t<0)return!1;n=t+1}return!0}static intArrayCopy_(t,e){for(let i=0,n=e.length;i<n;++i)t.push(e[i]);return t}static ifnull_(t,e){return null==t?e:t}static ifempty_(t,e,i){return An.isempty_(t)?e:i}static isempty_(t){return null==t||0==t.length}static isGradient_(t){return RX.Gradients.test(t)}static gradient_(t){return t>=0&&t<this._gradients.length?this._gradients[t]:null}static gradientKindOf(t,e){const i=this._gradients.indexOf(t);return i<0?e:i}static optionalStyle_(t,e,i){An.isempty_(i)||t.set(e,i)}static removeEmptyValues_(t){for(let[e,i]of t.entries())null!=i&&0!=i.length||t.delete(e)}static removeEmptyValues1_(t){for(let[e,i]of Object.entries(t))null!=i&&0!=i.length||delete t[e]}static parseTime_(t,e){if(null==t||0==t.length)return e;let i=-1;return t.endsWith("ms")?i=parseInt(t.substring(0,t.length-2).trim(),-1):t.endsWith("s")&&(i=1e3*parseInt(t.substring(0,t.length-1).trim(),-1)),i>=0?i:e}static parseIntPercent_(t,e){let i=An.parseDoublePercent_(t,null);return null==i?e:Math.floor(i)}static parseDoublePercent_(t,e){return null!=t&&t.endsWith("%")?An._parseDouble1_(t.substring(0,t.length-1),e):e}static parseIntPx_(t,e){let i=An.parseDoublePx_(t,null);return null==i?e:Math.floor(i)}static parseDoublePx_(t,e){return null!=t&&void 0!==t&&t.endsWith("px")?An.parseDouble_(t.substring(0,t.length-2),e):e}static splitSizeUnit_(t){if(null!=t&&t.length>0){let e=RX.SizeUnit.exec(t);if(null!=e&&3==e.length){return[e[1],e[2].trim()]}}return null}static parseIntUnit_(t){if(null!=t&&t.length>0){let e=RX.ValueUnit.exec(t);if(null!=e&&3==e.length){let t=e[1],i=e[2].trim(),n=parseInt(t);if(!isNaN(n))return[n,i]}}return null}static doubleSizeUnit_(t){return An.doubleUnitMatching_(RX.SizeUnit,t)}static doubleStringSizeUnit_(t){const e=this.doubleSizeUnit_(t);if(null==e)return null;const i=e[0];return[`${i==Math.round(i)?i.toFixed(0):i.toFixed(2)}`,e[1]]}static doubleValueUnit_(t){return An.doubleUnitMatching_(RX.ValueUnit,t)}static doubleUnitMatching_(t,e){if(null!=e&&e.length>0){let i=t.exec(e);if(null!=i&&3==i.length){let t=i[1],e=i[2].trim(),n=An.parseDouble_(t,null);if(null!=n)return[n,e]}}return null}static parseInt_(t,e){return null==t||0==t.length?e:An._parseInt1(t,e)}static _parseInt1(t,e){try{let i=Number.parseInt(t);return Number.isNaN(i)?e:i}catch(t){return e}}static parseRounded_(t,e){if(null==t||0==t.length)return e;try{let i=Number.parseFloat(t);return Number.isNaN(i)?e:Math.round(i)}catch(t){return e}}static parseDouble_(t,e){return null==t||0==t.length?e:An._parseDouble1_(t,e)}static _parseDouble1_(t,e){try{let i=Number.parseFloat(t);return Number.isNaN(i)?e:i}catch(t){return e}}static parseInt1_(t,e){let i=An._parseInt1(t,null);return null==i?e():i}static parseDouble1_(t,e){let i=An._parseDouble1_(t,null);return null==i?e():i}static onValidateRequiredIntPx_(t,e,i){let n=null;return 0==i.length||null==(n=An.parseIntPx_(i,null))?(t.push(MSG.format2_(RS.invalidNameValue,e,i)),null):n}static onValidateRequiredInt_(t,e,i){let n=null;return 0==i.length||null==(n=An.parseInt_(i,null))?(t.push(MSG.format2_(RS.invalidNameValue,e,i)),null):n}static onValidateOptionalIntPx_(t,e,i){let n=null;return i.length>0&&null==(n=An.parseIntPx_(i,null))?(t.push(MSG.format2_(RS.invalidNameValue,e,i)),null):n}static onValidateOptionalInt_(t,e,i){let n=null;return i.length>0&&null==(n=An.parseInt_(i,null))?(t.push(MSG.format2_(RS.invalidNameValue,e,i)),null):n}static onValidateOptionalPositiveInt_(t,e,i){if(0==i.length)return null;let n=An.parseInt_(i,null);return null==n||n<=0?(t.push(MSG.format2_(RS.invalidNameValue,e,i)),null):n}static dist4_(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))}static dist1_(t,e){return t.length>=4?An.dist4_(t[0],t[1],t[2],t[3]):e}static distance2_(t){if(t.length>=4){let e=t[2]-t[0],i=t[3]-t[1];return e*e+i*i}return 0}static delta_(t,e){let i=e-t;return i<0?-i:i}static abs_(t){return t>=0?t:-t}static absd_(t){return t>=0?t:-t}static clamp_(t,e,i){return i<t?t:i>e?e:i}static getBounds_(t,e,i){e<t[0]&&(t[0]=e),e>t[2]&&(t[2]=e),i<t[1]&&(t[1]=i),i>t[3]&&(t[3]=i)}static getRect_(t){let e=t[0],i=t[1],n=t[2],s=t[3],o=n-e,l=s-i;return o<0&&(e=n,o=-o),l<0&&(i=s,l=-l),new Rect(e,i,o,l)}static adjustZIndex_(t,e,i){return"string"==typeof t&&(t=parseInt(t)),isNaN(t)?i:t+e}static zindexOf_(t,e,i){var n,s;let o=null!==(s=null===(n=An.getComputedStyle_(t))||void 0===n?void 0:n.zIndex)&&void 0!==s?s:null;return null==o?i:An.adjustZIndex_(o,e,i)}static above_(t,e=DEF.zindexAbove10){return An.zindexOf_(t,e,DEF.zindexPrompt)}static below_(t,e=DEF.zindexUnder){return An.zindexOf_(t,e,DEF.zindexPrompt)}static getComputedStyle_(t){var e,i;return null!==(i=null===(e=t.ownerDocument.defaultView)||void 0===e?void 0:e.getComputedStyle(t))&&void 0!==i?i:null}static getComputedStyle1_(t,e){var i;const n=this.getComputedStyle_(t);return null==n?null:null!==(i=n.getPropertyValue(e))&&void 0!==i?i:null}static getComputedStyles_(t,...e){const i=this.getComputedStyle_(t);return null==i?null:new Map(e.map(t=>[t,i.getPropertyValue(t)]))}static getComputedStylesArray_(t,...e){const i=null==t?null:this.getComputedStyle_(t);return e.map(t=>{var e;return null!==(e=null==i?void 0:i.getPropertyValue(t))&&void 0!==e?e:""})}static setWidthHeight_(t,e,i){let n=t.style;return n.width=`${e}px`,n.height=`${i}px`,n}static setWidthLeft_(t,e,i){let n=t.style;return n.width=`${e}px`,n.left=`${i}px`,n}static setLeftTop_(t,e,i){let n=t.style;return n.top=`${i}px`,n.left=`${e}px`,n}static setRectangle_(t,e,i,n,s){let o=t.style;return o.left=`${e}px`,o.top=`${i}px`,o.width=`${n}px`,o.height=`${s}px`,o}static focus_(t){null!=t&&t.focus()}static focus0_(t){0!=t.length&&An.focus_(t[0])}static select_(t){null!=t&&(t.selectionStart=0,t.selectionEnd=t.value.length)}static iterateList_(t,e,i){null!=t&&0!=t.length?An._iterateList1(t,0,t.length,e,i):i()}static _iterateList1(t,e,i,n,s){n(t[e],e,o=>{o||(e+1<i?An._iterateList1(t,e+1,i,n,s):s())})}static busyWait_(t,e,i,n,s){let o=null;try{o=t()}catch(t){o=null}null==o?!n&&e<=0?s(null):Timer.sleep_(i,()=>{An.busyWait_(t,e-i,i,n,s)}):s(o)}static busyWait0_(t,e,i,n,s){An.busyWait_(()=>!!t()||null,e,i,n,t=>{s(null!=t)})}static ignoreException_(t){try{t()}catch(t){}}static show_(t,e=null){return t.style.display=null!=e?e:"",t}static hide_(t){return t.style.display="none",t}static setVisible_(t){return t.style.visibility="visible",t}static setHidden_(t){return t.style.visibility="hidden",t}static showHidden_(t,e=null){return t.style.visibility="hidden",An.show_(t,e),t}static showVisible_(t,e=null){return t.style.visibility="visible",An.show_(t,e),t}static hideVisible_(t,e=null){return An.setVisible_(An.hide_(t))}static setVisibleAt_(t,e,i){return t.style.left=`${e}px`,t.style.top=`${i}px`,An.setVisible_(t),t}static toggleDisplay_(t,e){t.style.display="none"==t.style.display?e:"none"}static setTransform_(t,e){t.style.transform=e}static cancelSubscriptions_(t){for(var e;t.length>0;)null===(e=t.pop())||void 0===e||e.cancel_()}static cancelSubscription_(t){return null!=t&&t.cancel_(),null}static fireOneshotCallbacks_(t){for(var e;t.length>0;)null===(e=t.pop())||void 0===e||e()}static attributesToStringForEdit_(t,e="=",i=null){let n=new StringBuffer;t:for(let[s,o]of[...t]){if(null!=i)for(let t of i)if(s==t)continue t;n.write_(s),n.write_(e),n.write_(An.escAttrValue_(o)),n.write_(DEF.LF)}return n.toString()}static attributesFromEditString_(t){var e;const i=smap_(),n=t.trim();if(0==n.length)return i;const s=n.split("\n");for(const t of s){const n=t.split(" ").filter(t=>t.length>0),s=null!==(e=n.shift())&&void 0!==e?e:null;null!=s&&(i[s]=n.join(" "))}return i}static escAttrValue_(t){let e=null,i=0,n=t.length;for(let s=0;s<n;++s){let n=t.codePointAt(s);void 0!==n&&((n==AMP||n<32||127==n||160==n||133==n||8232==n||8203==n)&&(null==e&&(e=new StringBuffer),i<s&&e.write_(t.substring(i,s)),n==AMP?e.write_("&amp;"):e.write_("&#x"+n.toString(16)+";"),i=s+1))}return null==e?t:(i<n&&e.write_(t.substring(i,n)),e.toString())}static unescAttrValue_(t){return t.replace(RX.HtmlEntity_G,(t,...e)=>{let i=e[1];if(null!=i){const t=parseInt(i,16);return isNaN(t)?i:String.fromCharCode(t)}let n=e[2];if(null!=n){const t=parseInt(n,10);return isNaN(t)?n:String.fromCharCode(t)}let s=e[0];switch(s){case"amp":return"&";case"lt":return"<";case"gt":return">";case"apos":return"'";case"quot":return'"';default:return s}})}static escText_(t){let e=null,i=0,n=t.length;for(let s=0;s<n;++s){let n=t.codePointAt(s);void 0!==n&&((n==AMP||n<32||n>=127&&!An.isHuman_(n))&&(null==e&&(e=new StringBuffer),i<s&&e.write_(t.substring(i,s)),n==AMP?e.write_("&amp;"):e.write_("&#x"+n.toString(16)+";"),i=s+1))}return null==e?t:(i<n&&e.write_(t.substring(i,n)),e.toString())}static unescText_(t){return An.unescAttrValue_(t)}static isHuman_(t){switch(Unicode$.unicodeCat_(t)){case Unicode$.Cat.Ll:case Unicode$.Cat.Lm:case Unicode$.Cat.Lo:case Unicode$.Cat.Lt:case Unicode$.Cat.Lu:case Unicode$.Cat.Nd:case Unicode$.Cat.Nl:case Unicode$.Cat.No:case Unicode$.Cat.Pc:case Unicode$.Cat.Pd:case Unicode$.Cat.Pe:case Unicode$.Cat.Pf:case Unicode$.Cat.Pi:case Unicode$.Cat.Po:case Unicode$.Cat.Ps:case Unicode$.Cat.Sc:return!0;default:return!1}}static isValidFilenameChar_(t){if(t<32||t>=127&&t<=159||this.InvalidFilenameChars$.includes(t))return!1;switch(Unicode$.unicodeCat_(t)){case Unicode$.Cat.Ll:case Unicode$.Cat.Lm:case Unicode$.Cat.Lo:case Unicode$.Cat.Lt:case Unicode$.Cat.Lu:case Unicode$.Cat.Mc:case Unicode$.Cat.Me:case Unicode$.Cat.Mn:case Unicode$.Cat.Nd:case Unicode$.Cat.Nl:case Unicode$.Cat.No:case Unicode$.Cat.Pc:case Unicode$.Cat.Pd:case Unicode$.Cat.Pe:case Unicode$.Cat.Pf:case Unicode$.Cat.Pi:case Unicode$.Cat.Po:case Unicode$.Cat.Ps:case Unicode$.Cat.Sc:case Unicode$.Cat.Sk:case Unicode$.Cat.Sm:case Unicode$.Cat.So:case Unicode$.Cat.Zs:return!0;default:return!1}}static append_(t,e){for(let i in e)t.push(i);return t}static removeNameValue_(t,e){if(null==t)return null;for(let i=t.length-1;i>=0;--i){let n=t[i];if(2==n.length&&n[0]==e)return t.splice(i,1),n[1]}return null}static replaceNameValue_(t,e,i){if(null!=t){for(let n=t.length-1;n>=0;--n){let s=t[n];if(2==s.length&&s[0]==e)return void(null==i||0==i.length?t.splice(n,1):s[1]=i)}null!=i&&0!=i.length&&t.push([e,i])}}static nameValueToStringMap_(t){let e=ssmap_();if(null!=t)for(let i of t)2==i.length&&(e[i[0]]=i[1]);return e}static nameValueToMap_(t){let e=new Map;if(null!=t)for(let i of t)2==i.length&&e.set(i[0],i[1]);return e}static nameValueToMapRemovingEmptyValues_(t){let e=new Map;if(null!=t)for(let i of t)if(2==i.length){let t=i[1];if(null==t||0==t.length)continue;e.set(i[0],t)}return e}static getValue_(t,e,i){let n=t.get(e);return null==n?i:n}static _stylevalue(t){return null==t?null:0==(t=t.trim()).length?null:t}static classlist_(t){return new ClasslistBuilder(t)}static listeners_(t){return new EventListenerBuilder(t)}static removeAddClasses_(t,e,i){var n;const s=t.class,o=null!==(n=null==s?void 0:s.split("\\s+"))&&void 0!==n?n:[];for(const t of e)for(;;){let e=o.indexOf(t);if(e<0)break;o.splice(e,1)}for(const t of i)o.includes(t)||o.push(t);const l=o.join(" ");l!=s&&(t.class=l)}static unquote_(t){if(null==t||t.length<2)return t;let e=t.length;if(e>2){let i=t[0],n=t[e-1];if(('"'==i||"'"==i)&&n==i)return t.substring(1,e-1)}return t}static truncate_(t,e){return null==t?"":(null==e&&(e=DEF.maxToastLen),t.length<e?t:e<4?"...":t.substring(0,e-4)+" ...")}static firstWord_(t){var e,i;return null==t?null:null!==(i=null===(e=RX.NonSpaces.exec(t))||void 0===e?void 0:e[1])&&void 0!==i?i:null}static removeLeadingSlashes_(t){let e=t.length,i=0;for(;i<e&&"/"==t[i];)++i;return 0==i?t:t.substring(i,e)}static removeTrailingSlashes_(t){let e=t.length,i=e;for(;i>0&&"/"==t[i-1];)--i;return i==e?t:t.substring(0,i)}static ensureLeadingSlash_(t){return t.startsWith("/")?t:"/"+t}static ensureTrailingSlash_(t){return t.endsWith("/")?t:t+"/"}static joinNotEmpty_(t,e){let i="";for(let n of e)0!=(n=n.trim()).length&&(i.length>0&&(i+=t),i+=n);return i}static filenameFromUri_(t){if(null==t)return"";let e=t.pathSegments$;return 0==e.length?"":e[e.length-1]}static lastSegment_(t){return null!=t&&t.length>0?t[t.length-1]:null}static fileExtFromUri_(t){return null==t?null:Basepath.ext_(t.path$)}static isDotOnly_(t){if(null==t)return!1;let e=t.length;if(0==e)return!1;for(let i=0;i<e;++i)if("."!=t[i])return!1;return!0}static apath_(t){return t.length>0&&"/"!=t[0]?"/"+t:t}static labelFromBasepath_(t){let e=t.nameWithoutSuffix$,i=t.nameWithSuffix$;if(0==e.length||"index.html"==i){const i=null==t.dir$?null:new Basepath(t.dir$).nameWithSuffix$;null!=i&&i.length>0&&"/"!=i&&"."!=i&&".."!=i&&(e=i)}return An.capitalize_(e)}static capitalize_(t){return An.isempty_(t)?t:t.substring(0,1).toUpperCase()+t.substring(1)}static hex_(t,e){let i=t.toString(16);for(let t=i.length;t<e;++t)i="0"+i;return i}static xhex_(t,e){return"0x"+An.hex_(t,e)}static isBodyElement_(t){return"BODY"==t||"HTML"==t||"HEAD"==t}static isHtmlElement_(t){return"HTML"==t||"HEAD"==t}static isWhitespaces_(t){return null==t||0==t.length||RX.IsWhitespaces.test(t)}static elementInfo_(t){let e=t.getAttribute("class"),i=t.getAttribute("href"),n=t.getAttribute("src"),s=t.getAttribute("style"),o="";return null!=t.id&&(o+=`id (${t.id})`),null!=e&&(o+=` class (${e})`),null!=i&&(o+=` href ('${i})`),null!=n&&(o+=` src (${n})`),null!=s&&(o+=` style (${s})`),o.toString()}static enableButtons_(t,e){for(let i of t)An.enableButton_(i,e)}static enableButton_(t,e){e?t.classList.remove(CSS.AnDisabled):t.classList.add(CSS.AnDisabled)}static isButtonDisabled_(t){return t.classList.contains(CSS.AnDisabled)}static isButtonOff_(t){return t.classList.contains(CSS.AnToggleOff)}static isButtonOn_(t){return!t.classList.contains(CSS.AnToggleOff)}static toggleOnOffButton_(t){return!t.classList.toggle(CSS.AnToggleOff)}static toggleButtonOn_(t){t.classList.remove(CSS.AnToggleOff)}static toggleButtonOff_(t){t.classList.add(CSS.AnToggleOff)}static toggleToggleButton_(t){return An.classlist_(t).toggleAll_(CSS.AnButtonFlat,CSS.AnButtonDown).contains_(CSS.AnButtonDown)}static setToggleButton_(t,e){return An.classlist_(t).remove_(e?CSS.AnButtonFlat:CSS.AnButtonDown).add_(e?CSS.AnButtonDown:CSS.AnButtonFlat),e}static isToggleButtonDown_(t){return t.classList.contains(CSS.AnButtonDown)}static round_(t,e){return null==t?e:Math.round(t)}static floor_(t,e){return null==t?e:Math.floor(t)}static multipleOf_(t,e){return e/t*t}static sinkhole_(t){An.stopevent_(t)}static stopevent_(t){try{null!=t&&(t.stopPropagation(),t.preventDefault())}catch(t){}return!1}static documentOffset_(t){return An.offsetOf_(t,document.documentElement)}static offsetOf_(t,e){return An.offsetOf1_(t,e)}static offsetOf1_(t,e){let i=t===e;if(null==t||i){if(i||"HTML"==e.tagName)return new Point(0,0);throw new Error("Specified element is not a transitive offset parent of this element.")}let n=t.offsetParent,s=An.offsetOf1_(n,e);return new Point(s.x+t.offsetLeft,s.y+t.offsetTop)}static noop_(){}static noop1_(t){}static predicate0_(){return!1}static noop1Callback0_(t,e){e()}static noop1Promise0_(t){return Promise.resolve()}static ignoreJSONResult_(t){}static cleanUri_(t,e=null,i){if(null==t)return null;let n=null!=e?e:t.path$,s=t.search$,o=t.hash$;return An.uriFromSafe_(i,n,s,o)}static addRemoveQueryParams_(t,e=null,i=null,n){let s=new Map;if(t.queryParameters$.forEach((t,e)=>{null!=i&&i.includes(e)||s.set(e,t)}),null!=e)for(let[t,i]of e)s.set(t,i);return An.uriFromSafe_(n,t.path$,s,t.hash$)}static addViewParam_(t,e){let i=MimeUtil.mediaMimeFromPath(t.path$);return null==i||i==MimeUtil.PDF||t.queryParameters$.has(Param.view)?t:An.addRemoveQueryParams_(t,mapOf_(Param.view,""),null,e)}static subscriptEvent_(t,e,i){const n=t=>i(t);return t.addEventListener(e,n),new StreamSubscription(t,e,n)}static addClickListenerMatching_(t,e,i){return this.addEventListenerMatching_(t,"click",e,i)}static addContextmenuListenerMatching_(t,e,i){return this.addEventListenerMatching_(t,"contextmenu",e,i)}static addEventListenerMatching_(t,e,i,n){t.addEventListener(e,t=>{let e=DomUt.matchingTarget_(t,i);null!=e&&n(e,t)})}static onTouchStart_(t,e){t.addEventListener(Conf.touchstart,e)}static onTouchEnd_(t,e){t.addEventListener(Conf.touchend,e)}static onToggleToggle_(t,e){An.onClick_(t,i=>{An.stopevent_(i),e(An.toggleToggleButton_(t))})}static onClick_(t,e){return t.addEventListener("click",t=>{e(t)}),t}static onContextmenu_(t,e){return t.addEventListener("contextmenu",t=>e(t)),t}static onFocus_(t,e){return t.addEventListener("focus",t=>e(t)),t}static onKeypress_(t,e){return t.addEventListener("keypress",t=>e(t)),t}static onChange_(t,e){return t.addEventListener("change",e),t}static onLoad_(t,e){return t.addEventListener("load",e),t}static onError_(t,e){return t.addEventListener("error",e),t}static onInput_(t,e){return t.addEventListener("input",e),t}static onInputChange_(t,e){return t.addEventListener("change",e),t}static onInputFocusSelect_(t){return t}static onInputFocusSelectIgnoreEnterKey_(t){return An.onInputFocusSelect_(An.onInputEnterKeyStop_(t))}static onInputEnterKey_(t,e){return t.addEventListener("keypress",t=>{"Enter"==t.key&&(An.stopevent_(t),e(t))}),t}static onInputEnterKeyStop_(t){return t.addEventListener("keypress",t=>{"Enter"==t.key&&An.stopevent_(t)}),t}static stopAllInputEnterKey_(t){let e=t.querySelectorAll(`textarea.${CSS.AnPromptInput}`);for(let t=0;t<e.length;++t)An.onInputEnterKeyStop_(e.item(t))}}An.textEncoder$=new TextEncoder,An._gradients=["linear-gradient","radial-gradient","radial-gradient","radial-gradient","repeating-linear-gradient","repeating-radial-gradient","repeating-radial-gradient","repeating-radial-gradient"],An._famap=new Map([["fa",CSS.Fa],["fa-bell-o",CSS.FaBellO],["fa-minus",CSS.FaMinus],["fa-eye-slash",CSS.FaEyeSlash],["fa-times-circle",CSS.FaTimesCircle],["fa-expand",CSS.FaExpand],["fa-cut-not-marked",CSS.FaCutNotMarked],["fa-cut-marked",CSS.FaCutMarked],["x-fa-cut-not-marked",CSS.FaCutNotMarked],["x-fa-cut-marked",CSS.FaCutMarked]]),An._PATHPART_ILLEGALS=Ut.charcodes_("[]?#%\\"),An._PATH_SEGMENT_ILLEGALS=Ut.charcodes_("[]?#%/\\"),An._QUERY_ILLEGALS=Ut.charcodes_("[]?#%=&\\"),An._FRAGMENT_ILLEGALS=Ut.charcodes_("[]?#%\\"),An.InvalidFilenameChars$=Ut.charcodesOrFail_("\\?#%;[]");class Conf{}Conf.publicHomePath=PATH._HomeIndexHtml,Conf.errorPath=PATH._assetsTemplates500Html,Conf.notfoundPath=PATH._assetsTemplates404Html,Conf.input="textarea",Conf.scheme=CF.SCHEME,Conf.hostport=`${CF.HOSTPORT}`,Conf.schemeHost=`${Conf.scheme}://${Conf.hostport}`,Conf.useSweep=!0,Conf.selectPlaceholderOnClick=!1,Conf.hasOverlayScrollbar=!0,Conf.click="click",Conf.useFlash=!0,Conf.isMobile=!1,Conf.touchstart="mousedown",Conf.touchend="mouseup",Conf.touchmove="mousemove";class DomBuilderEx extends DomBuilder{static offline1_(t,e,...i){return new DomBuilderEx(t.createElement(e)).addClasses_(i)}static offline_(t,e,i=null){return new DomBuilderEx(t.createElement(e),i)}flexInput_(t,e,i="1"){const n=this.flexInputWithoutFocus_(t,e,i);return An.onInputFocusSelect_(n),n}flexInputSlider_(t,e,i,n,s,o,l,a="1"){const r={type:"range",class:CSS.AnPromptInputSlider,style:`flex-basis:${t}%;height:${e};`,min:i,max:n,step:s,value:o,placeholder:l,tabindex:a};return this.input_(r).cursor_()}flexInputWithoutFocus_(t,e,i="1"){const n={rows:"1",class:CSS.AnPromptInput,style:`flex-basis:${t}%`,tabindex:i,autocapitalize:"none",autocomplete:"off",autocorrect:"off",spellcheck:"false"};return null!=e&&e.length>0&&(n.placeholder=e),this.child_(Conf.input,n).cursor_()}flexDivInput_(t){const e={class:CSS.AnPromptInput,style:`flex-basis:${t}%;`};return this.div_(e).cursor_()}flexTextarea_(t){return this.push_().div1_(CSS.AnFlex).textarea_(t).cursorPop_()}flexTextInput_(t,e,i,n="1"){this.push_().div1_(CSS.AnFlex);const s=this.flexTextInput1_(t,e,i,n);return this.pop_(),s}flexTextInput1_(t,e,i,n){this.push_(),t>0&&this.div_({class:CSS.AnRightAlignLabel,style:`flex-basis:${t}%`}).text_(e);const s={class:CSS.AnPromptInput,style:`flex-basis:${100-t}%`,rows:"1",tabindex:n,autocapitalize:"none",autocomplete:"off",autocorrect:"off",spellcheck:"false"};return null!=i&&i.length>0&&(s.placeholder=i),this.peek_().child_(Conf.input,s).cursorPop_()}flexTextTextarea_(t,e,i){this.push_().div1_(CSS.AnFlex);const n=this.flexTextTextarea1_(t,e,i);return this.pop_(),n}flexTextTextarea1_(t,e,i){return this.push_(),t>0&&this.div_({class:CSS.AnRightAlignLabel,style:`flex-basis:${t}%`}).text_(e),i.style=`flex-basis:${100-t}%`,this.peek_().textarea_(i),this.cursorPop_(1)}flexTextDiv_(t,e,i=""){return this.div1_(CSS.AnFlex,...i.split(RX.Spaces)),this.flexTextDiv1_(t,e),this}flexTextDiv1_(t,e){return this.push_(),t>0&&this.div_({class:CSS.AnRightAlignLabel,style:`flex-basis:${t}%`}).text_(e),this.pop_().div_({style:`flex-basis:${100-t}%`}),this}flexTextContainer_(t,e){return this.div1_(CSS.AnFlex),this.flexTextContainer1_(t,e),this}flexTextContainer1_(t,e){return this.push_(),t>0&&this.div_({class:CSS.AnRightAlignLabel,style:`flex-basis:${t}%`}).text_(e),this.pop_().div_({class:CSS.AnFlex,style:`flex-basis:${100-t}%;overflow:hidden`}),this}folderButton_(){return this.push_().button1_(CSS.AnButton,CSS.AnMarginLeft5,CSS.Fa,CSS.FaFolderOpen).cursorPop_()}textContainer_(t,e){return this.div1_(CSS.AnFlex,CSS.AnMarginV5).flexTextContainer1_(t,e)}}class JsUtil{static asHTMLDivElement_(t){return null!=t&&"DIV"==t.nodeName?t:null}static asHTMLImageElement_(t){return null!=t&&"IMG"==t.nodeName?t:null}static asHTMLTextAreaElement_(t){return null!=t&&"TEXTAREA"==t.nodeName?t:null}static asHTMLInputElement_(t){return null!=t&&"INPUT"==t.nodeName?t:null}static asHTMLIFrameElement_(t){return null!=t&&"IFRAME"==t.nodeName?t:null}static asValueElement_(t){if(null==t)return null;const e=t.nodeName;return"TEXTAREA"==e?t:"INPUT"==e?t:"BUTTON"==e?t:"SELECT"==e?t:"OPTION"==e?t:null}static nullableItemsArrayOf_(t){return[...new NullableItemsIterable(t)]}static itemsArrayOf_(t){return[...new ItemsIterable(t)]}static lastItemOf_(t){let e=t.length;return e>0?t.item(e-1):null}static isTextNode_(t){return null!=t&&t.nodeType==Node.TEXT_NODE}static childNodes_(t){return JsUtil.itemsArrayOf_(t.childNodes)}static nodeValue_(t){return null!=t&&t.nodeType==Node.TEXT_NODE?t.nodeValue:null}static textContent_(t){var e;return null!==(e=t.textContent)&&void 0!==e?e:""}static setTextContent_(t,e){null!=t&&(t.textContent=null!=e?e:"")}static transverse_(t,e){JsUtil._transverse1(t,e)}static _transverse1(t,e){if(null==t)return;let i=t.firstChild;for(;null!=i;){let t=i.nodeType==Node.ELEMENT_NODE,n=e(i);t&&JsUtil._transverse1(i,e),i=n}}static elementWalker_(t,e){let i=t.firstElementChild;for(;null!=i;){let t=i.nextElementSibling;e(i),this.elementWalker_(i,e),i=t}}static find_(t,e){return this.find1_(t,e)}static find1_(t,e){for(let i=t.firstChild;null!=i;i=i.nextSibling){let t=e(i);if(null!=t)return t;if(i.nodeType==Node.ELEMENT_NODE&&null!=(t=this.find1_(i,e)))return t}return null}static trimmedTextContent_(t){return An.normalizeTextContent_(JsUtil.textContent_(t))}static sortedAttributes_(t){return new Map(JsUtil.itemsArrayOf_(t.attributes).sort((t,e)=>t.name.localeCompare(e.name)).map(t=>[t.name,t.value]))}static sortedAttributes1_(t){return new Map(Array.from(Object.entries(t)).sort((t,e)=>t[0].localeCompare(e[0])).map(t=>[t[0],t[1]]))}static isWhitespaceNode_(t){var e;return t.nodeType==Node.TEXT_NODE&&An.isWhitespaces_(null!==(e=t.textContent)&&void 0!==e?e:"")}static remove_(t){var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t)}static childElements_(t){return JsUtil.itemsArrayOf_(t.children)}static lastElementChild_(t){return JsUtil.lastItemOf_(t.children)}static findChildElement_(t,e){for(let i of Array.from(t.childNodes))if(i.nodeType==Node.ELEMENT_NODE&&e==i.nodeName)return i;return null}static isAll1_(t,e){return JsUtil.isAll_(t,JsUtil.itemsArrayOf_(e.children))}static isAll_(t,e){for(let i of e)if(i.nodeName!=t)return!1;return!0}static hasClass_(t,e){return null!=t&&t.nodeType==Node.ELEMENT_NODE&&t.classList.contains(e)}static hasClasses_(t,e){var i,n;const s=null!==(n=null===(i=DomUt.asHTMLElement_(t))||void 0===i?void 0:i.classList)&&void 0!==n?n:null;if(null!=s)for(let t of e)if(s.contains(t))return!0;return!1}static childElementWithClass_(t,e){for(let i of Array.from(t.children))if(i.classList.contains(e))return i;return null}static parentWithClasses_(t,e){for(let i=t.parentElement;null!=i;i=i.parentElement){if(JsUtil.hasClasses_(i,e))return i;if(An.isBodyElement_(i.nodeName))return null}return null}static parentOrSelf_(t,e){var i,n;let s=null!==(n=null!==(i=DomUt.asHTMLElement_(t))&&void 0!==i?i:null==t?void 0:t.parentElement)&&void 0!==n?n:null;for(;null!=s;s=s.parentElement){if(e(s))return s;if(An.isBodyElement_(s.nodeName))return null}return null}static parentOrSelfWithClasses_(t,e){return JsUtil.parentOrSelf_(t,t=>JsUtil.hasClasses_(t,e))}static parentOrSelfWithClass_(t,e){return JsUtil.parentOrSelf_(t,t=>t.classList.contains(e))}static parentOrSelfWithId_(t,e){return JsUtil.parentOrSelf_(t,t=>t.id==e)}static parentOrSelfWithName_(t,e){return JsUtil.parentOrSelf_(t,t=>e==t.nodeName)}static parentOrSelfWithAttr_(t,e,i){return JsUtil.parentOrSelf_(t,t=>t.getAttribute(e)==i)}static isEmptyTextNode_(t){let e=t.nodeType;return e==Node.TEXT_NODE?An.isWhitespaces_(t.nodeValue):e!=Node.ELEMENT_NODE}static isEmptyNode_(t){for(let e=t.firstChild;null!=e;e=e.nextSibling){let t=e.nodeType;if(t==Node.ELEMENT_NODE)return!1;if(t==Node.TEXT_NODE&&!An.isWhitespaces_(e.nodeValue))return!1}return!0}static getCssPathSegments_(t){let e=t.pathSegments$,i=e.length;if(0==i)return null;let n=Array.from(e),s=n[i-1];return s.endsWith(".html")?(s=s.substring(0,s.length-5)+".css",n[i-1]=s,n):null}static isElementWIthName_(t,e=null){return null!=t&&t.nodeType==Node.ELEMENT_NODE&&(null==e||t.nodeName==e)}static isBody_(t){return null!=t&&t.nodeType==Node.ELEMENT_NODE&&An.isBodyElement_(t.nodeName)}static setAttribute_(t,e,i){null==i?t.removeAttribute(e):t.setAttribute(e,i)}static setAttribute0_(t,e,i){null==i||0==i.length||0==i.trim().length?t.removeAttribute(e):t.setAttribute(e,i)}static optAttribute_(t,e,i){var n;return null!==(n=t.getAttribute(e))&&void 0!==n?n:i}static getAttributeNames_(t){return this.itemsArrayOf_(t.attributes).map(t=>t.name)}static getAttributes_(t){return new Map(this.itemsArrayOf_(t.attributes).map(t=>[t.name,t.value]))}static removeAttributeMatch_(t,e){this.itemsArrayOf_(t.attributes).forEach(i=>{e.test(i.name)&&t.removeAttribute(i.name)})}static updateHrefOrSrc_(t,e,i){if(null!=t.getAttribute("href"))this.setAttribute_(t,"href",e+i);else if(null!=t.getAttribute("src"))this.setAttribute_(t,"src",e);else{const n=t.tagName;"A"==n?this.setAttribute_(t,"href",e+i):"AUDIO"!=n&&"VIDEO"!=n&&"SOURCE"!=n&&"TRACK"!=n||this.setAttribute_(t,"src",e)}}static wrapNode_(t,e,i=null){return new DomBuilderEx(t.parentElement).push_().childBefore_(t,e,i).swap_().removeChild_(t).pop_().appendNodes_(t).cursor_()}static outerHTML_(t){var e;if(t.nodeType==Node.ELEMENT_NODE)return t.outerHTML;let i=t.nodeName;switch(i){case"#document":return t.documentElement.outerHTML;case"#document-fragment":let n=new StringBuffer;for(let e=t.firstChild;null!=e;e=e.nextSibling)n.write_(JsUtil.outerHTML_(e));return n.toString();default:return i.startsWith("#")&&(null!==(e=t.nodeValue)&&void 0!==e)?e:""}}static getContextHtml_(t){let e=[],i=t;do{let t=i.nodeName;if(An.isBodyElement_(t))break;e.push(t),i=i.parentNode}while(null!=i);let n=new StringBuffer;for(let t=e.length-1;t>=0;--t)n.write_("<"),n.write_(e[t]),n.write_(">");for(let t=0;t<e.length;++t)n.write_("</"),n.write_(e[t]),n.write_(">");return n.toString()}static hide_(t){t.style.display="none"}static show_(t,e=""){t.style.display=e}static showHidden_(t,e){t.style.visibility="hidden",JsUtil.show_(t,e)}static showVisible_(t,e){t.style.visibility="visible",JsUtil.show_(t,e)}static hideVisible_(t){JsUtil.hide_(t),t.style.visibility="visible"}static stopevent_(t){try{null!=t&&(t.stopPropagation(),t.preventDefault(),t.cancelBubble)}catch(t){}}static stopEventImmediately_(t){try{null!=t&&(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),t.cancelBubble)}catch(t){}}static actionWrapOK_(t){if(null==t)return MSG.string_(RS.ActionRequireAValidSelection);let e=t.startContainer,i=t.endContainer;if(null==e||null==i)return MSG.string_(RS.ActionRequireAValidSelection);let n=e,s=i;if(e.nodeType==Node.TEXT_NODE&&(n=e.parentNode),i.nodeType==Node.TEXT_NODE&&(s=i.parentNode),n!=s||(null==n?void 0:n.nodeType)!=Node.ELEMENT_NODE)return MSG.string_(RS.ActionRequireASelectionThatStartsAndEndsUnderTheSameParent);let o=n.nodeName;return An.isHtmlElement_(o)?MSG.string_(RS.ActionNotPermittedOnBodyElement):null}static toggleClasses_(t,e){if(null==t)return;let i=t.classList;for(let t of e)i.toggle(t)}static getFirstWord_(t){for(let e=t.firstChild;null!=e;e=e.nextSibling){let t;if(t=e.nodeType==Node.ELEMENT_NODE?JsUtil.getFirstWord_(e):An.firstWord_(e.nodeValue),!An.isempty_(t))return t}return null}static isInput_(t){let e=t.nodeName;return t.nodeType==Node.ELEMENT_NODE&&("INPUT"==e||"TEXTAREA"==e||"BUTTON"==e||"SELECT"==e||"OPTION"==e)}static setValue_(t,e){const i=JsUtil.asValueElement_(t);null!=i?i.value=e:t.textContent=e}static getCalcValue_(t){let e=JsUtil.isInput_(t)?t.value:JsUtil.getFirstWord_(t);return JsUtil.getCalcValue1_(e)}static getCalcValue1_(t){return null==t||0==t.length?t:t.replace(RX.DoubleNumber,(t,...e)=>e[0]).replace(RX.CommaSpace_g,"")}static getFirstTextnode_(t){for(let e=t.firstChild;null!=e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){let t=JsUtil.getFirstTextnode_(e);if(null!=t)return t}else{let t=An.firstWord_(e.nodeValue);if(!An.isempty_(t))return e}return null}static getXInfoNumber_(t,e){var i,n;return null!==(n=null===(i=An.parseJSONObjectOrNull_(t.getAttribute(ATTR.xInfo)))||void 0===i?void 0:i[e])&&void 0!==n?n:null}static updateXInfoNumber_(t,e,i){var n;const s=null!==(n=An.parseJSONObjectOrNull_(t.getAttribute(ATTR.xInfo)))&&void 0!==n?n:json_();s[e]=i,t.setAttribute(ATTR.xInfo,JSON.stringify(s))}static getSplitParent_(t){let e=t;for(;null!=e;e=e.parentNode){let t=e.nodeName;if(Html5.canSplitTag(t))return e}return null}static getElementSelfOrParent_(t){let e=t;for(;null!=e;e=e.parentNode)if(e.nodeType==Node.ELEMENT_NODE)return e;return null}static normalize_(t){t.normalize()}static datetimeStringWithXFormat_(t,e,i,n){let s=An.splitDatetimeXFormat_(t.getAttribute(ATTR.xFormat));return s.length>=2&&(e=DateFormat.validate(s[0],e),i=TimeFormat.validate(s[1],i)),t.setAttribute(ATTR.xFormat,An.datetimeXFormatValue_(e,i,n)),An.datetimeString_(e,i,n)}static getBoundingClientRect_(t){let e=t.getBoundingClientRect(),i=Math.round(e.left),n=Math.round(e.top),s=Math.round(e.width),o=Math.round(e.height);return new Rect(i,n,s,o)}static querySelectorAll_(t,e){return Array.from(t.querySelectorAll(e))}}class RangeUtil{static rangeStart_(t){let e=t.startContainer;return e.nodeType==Node.ELEMENT_NODE?e.childNodes[t.startOffset]:e}static rangeEnd_(t){let e=t.endContainer;return e.nodeType==Node.ELEMENT_NODE?e.childNodes[t.endOffset]:e}static rangeStartElement_(t){if(null==t)return null;let e=t.startContainer;if(e.nodeType==Node.ELEMENT_NODE){let i=e.childNodes[t.startOffset];null!=i&&(e=i)}let i=e;for(;null!=i&&i.nodeType!=Node.ELEMENT_NODE;)i=i.parentNode;return i}static rangeOwnerDocument_(t){return t.startContainer.ownerDocument}static wrapRange_(t,e,i){let n=i.extractContents(),s=DomBuilderEx.offline_(n.ownerDocument,t,e).appendNodes_(n).cursor_();return i.insertNode(s),s}static replaceRange_(t,e){t.deleteContents(),t.insertNode(e)}static deleteContents_(t){t.deleteContents}static cloneContents_(t){return t.cloneContents()}static extractContents_(t){return t.extractContents()}static insertNode_(t,e){t.insertNode(e)}static insertText_(t,e){let i=DomBuilderEx.createText_(e);return t.insertNode(i),i}static isValidNonBodyRange_(t){if(null==t)return!1;let e=t.startContainer;return!(e.nodeType==Node.ELEMENT_NODE&&An.isHtmlElement_(e.nodeName))}static normalizeRange_(t){t.commonAncestorContainer.normalize()}static setEndAfter_(t,e){t.setEndAfter(e)}static isTextSelection_(t){let e=t.startContainer,i=t.endContainer;return!(!e||!i||e!==i)&&(e.nodeType===Node.ELEMENT_NODE&&(e=e.childNodes[t.startOffset]),e.nodeType===Node.TEXT_NODE)}}class ElementUtil{static getChildWithTagAndClass_(t,e,i){for(let n of new ItemsIterable(t.children))if((null==e||e==n.nodeName)&&(null==i||n.classList.contains(i)))return n;return null}}class FontUtil{static getFontNames_(t,e,i,n){let s=t.indexOf(n);for(let o of e){if("All"!=i){if(i!=o.category_())continue}let e=o.fontname_();e&&(s<0&&e==n&&(s=t.length),t.push(e))}return s<0&&null!=n&&(s=t.length,t.push(n)),s>=0?s:null}static getFontStyles_(t,e,i){let n=-1;if(null!=e){let s=e.styles_();if(null!=s){for(let e of s)e==i&&(n=t.length),t.push(e);n<0&&(s.includes("Regular")?n=s.indexOf("Regular"):s.length>0&&(n=0))}}return n}static fontFamilyOf_(t,e){return null==e||0==e.length?t:t+"-"+e}static getFontStackNameStyle_(t,e){if(null==e)return null;if(0==(e=An.unquote_(e).trim()).length)return null;if(e.indexOf(",")<0)return FontUtil.splitNameStyle_(e);let i=e.split(new RegExp(","));for(let e of i){let i=An.unquote_(e.trim()).trim(),n=FontUtil.splitNameStyle_(i);if(null!=t.fontInfo_(n[0]))return n}return null}static splitNameStyle_(t){let e=t.lastIndexOf("-");if(e<0)return[t,""];let i=t.substring(e+1);return function(t){return FontUtil._FONT_STYLES.has(t.toLowerCase())}(i)?[t.substring(0,e),i]:[t,""]}}FontUtil._FONT_STYLES=new Set(["b","bi","black","blackitalic","bold","bolditalic","boldoblique","boldslanted","book","bookbold","bookitalic","condbold","condlight","condlightitalic","cursive","demibold","demilight","eight","eightitalic","extrabold","extrabolditalic","extralight","extralightit","extralightitalic","four","fouritalic","hair","hairitalic","hairline","hairlineitalic","heavy","heavyitalic","i","it","italic","light","lightit","lightitalic","medium","mediumitalic","normal","oblique","r","regular","semibold","semiboldit","semibolditalic","semilight","slanted","thin","thinitalic","two","twoitalic","ultra","ultraitalic","ultralight","ultralightitalic"]);class SelectOptionUtil{static setOptions_(t,e,i=null,n=0){t.setAttribute(ATTR.AnOptions,JSON.stringify(smap_([SelectOptionUtil.LABELS,i],[SelectOptionUtil.VALUES,e])))}static getOptions_(t){let e=t.getAttribute(ATTR.AnOptions);return null==e||e.length<3?null:An.parseJSONObjectOrNull_(e)}static getLabels_(t){return SelectOptionUtil.labelsOf_(SelectOptionUtil.getOptions_(t))}static getValues_(t){let e=SelectOptionUtil.getOptions_(t);return SelectOptionUtil.valuesOf_(e)}static labelsOf_(t){if(null==t)return null;let e=t[SelectOptionUtil.LABELS];return null==e&&(e=t[SelectOptionUtil.VALUES]),e}static valuesOf_(t){return null==t?null:t[SelectOptionUtil.VALUES]}}SelectOptionUtil.LABELS="XXK",SelectOptionUtil.VALUES="XTH";const MAX_TEXT_LENGTH=128,XXX="XXX";let LinkInfoKey_BODY="B",LinkInfoKey_HEAD="H",LinkInfoKey_name="n",LinkInfoKey_rel="r",LinkInfoKey_tag="t",LinkInfoKey_targetpath="p",LinkInfoKey_value="v",myiframe=null;function truncate_(t,e){return t&&t.length>e?e<4?" ...":t.substring(0,e-4)+" ...":t}function isHtmlElement_(t){return"HTML"==t||"HEAD"==t}function elementinfo_(t){let e=t.getAttribute("class"),i=t.getAttribute("href"),n=t.getAttribute("src"),s=t.getAttribute("name"),o="";return t.id&&(o+=` id (${t.id})`),s&&(o+=` name (${s})`),e&&(o+=" class ("+truncate_(e,MAX_TEXT_LENGTH)+")"),i&&(o+=" href ("+truncate_(decodeURI(i),MAX_TEXT_LENGTH)+")"),n&&(o+=" src ("+truncate_(decodeURI(n),MAX_TEXT_LENGTH)+")"),o}function linkinfo_(t,e,i,n){let s=i.getAttribute("href"),o=i.getAttribute("src"),l=i.getAttribute("name"),a=i.getAttribute("rel");if(s){t[s]=null;let o={};o[LinkInfoKey_tag]=i.nodeName,o[LinkInfoKey_rel]=a,o[LinkInfoKey_name]="href",o[LinkInfoKey_value]=s,o[LinkInfoKey_targetpath]=n,e.push(o)}else if(o){t[o]=null;let s={};s[LinkInfoKey_tag]=i.nodeName,s[LinkInfoKey_rel]=a,s[LinkInfoKey_name]="src",s[LinkInfoKey_value]=o,s[LinkInfoKey_targetpath]=n,e.push(s)}else if(l){let t={};t[LinkInfoKey_tag]=i.nodeName,t[LinkInfoKey_rel]=a,t[LinkInfoKey_name]="name",t[LinkInfoKey_value]=l,t[LinkInfoKey_targetpath]=n,e.push(t)}}function gettarget_(t,e){let i=t;if(e)for(let t=0;null!=i&&t<e.length;++t){let n=e[t],s=i.childNodes;if(s.length<=n)return null;i=s.item(n)}return i}function isInvalidRange_(t){if(!t||!t.startContainer)return!0;let e=t.startContainer;return e.nodeType==Node.ELEMENT_NODE&&null==e.childNodes.item(t.startOffset)}function transverse_(t,e){if(t){for(let i=t.firstChild;null!=i;i=i.nextSibling)transverse_(i,e);e(t)}}function indexof_(t,e){let i=e.childNodes;for(let e=0;e<i.length;++e)if(i[e]===t)return e;return-1}function sanitizeClone_(t){transverse_(t,function(t){if(t.nodeType==Node.ELEMENT_NODE){let e=t;e.removeAttribute("xmlns"),e.removeAttribute("id")}})}function getiframe_(){return null==myiframe&&(myiframe=document.getElementById(ID.contentIFrame)),myiframe}function getiframewindow_(){return getiframe_().contentWindow}function getiframedocument_(){return getiframewindow_().document}function getiframebody_(){return getiframedocument_().body}function getiframeselection_(){let t=getiframewindow_();return t?t.getSelection():null}function iclearselection_(t){let e=getiframewindow_(),i=e?e.document:null,n=e?e.getSelection():null;return n&&n.removeAllRanges(),t(n,i)}function icreaterange_(t){return iclearselection_((e,i)=>{if(!e||!i)return null;let n=i.createRange();return t(e,n)})}function getelementforscroll_(t){if(!t||!t.startContainer)return null;let e=t.startContainer;if(e.nodeType==Node.ELEMENT_NODE){let i=e.childNodes.item(t.startOffset);null!=i&&(e=i)}for(;null!=e&&e.nodeType!=Node.ELEMENT_NODE;)e=e.parentElement;return e}function getElementForScrollIntoView_(t){return getelementforscroll_(t)}function myscroll_(t,e=null){for(;t&&t.nodeType!=Node.ELEMENT_NODE;)t=t.parentNode;if(!t)return;let i=t;null==e?i.scrollIntoViewIfNeeded(!0):i.scrollIntoView(e)}function setdisplay_(t,e){if(!t)return;let i=t.style;e?i.display=e:i.removeProperty("display")}function removeAllAttributes_(t,e){let i=t.attributes,n=[];for(let t=0;t<i.length;++t){let s=i[t].name;e.indexOf(s)>=0||n.push(s)}for(let e=0;e<n.length;++e)t.removeAttribute(n[e])}function getNearestSelectedElement1_(t){if(!t)return null;let e=t.startContainer;if(!e)return null;for(e.nodeType===Node.ELEMENT_NODE&&null==(e=e.childNodes.item(t.startOffset))&&(e=t.startContainer);null!=e&&e.nodeType!==Node.ELEMENT_NODE;)e=e.parentNode;return e}function fixscrolloffset_(t,e){let i=t.scrollX,n=t.scrollY,s=e.scrollTop,o=e.scrollLeft;0==i&&0==n&&0==s&&0==o||(e.scrollLeft=0,e.scrollTop=0)}class NativeObject{constructor(){this._callbacks={}}_addCallback(t,e){this._callbacks[t]=e}_removeCallback(t,e){this._callbacks[t]=void 0}X7t(t,e){let i=this._callbacks[t];return i?i(e):null}}class Native{constructor(){this._iframeObject=null,this._iframeEvents=[],this._fixFragmentEvents=[],this._ajaxCallbacks=new Map,this._cssProperties=new Map,this._range=null,this._iframeRange=null,this._nativeObject=new NativeObject,this.iframeUriCache=null,this.addCallback_(AjaxAction.ajax,t=>this._ajaxCallback(t))}cssProperties_(){if(0==this._cssProperties.size){let t=this._getStyleProperties();for(let e of t){let t=this._uncamel(e);this._cssProperties.set(t,t)}}return this._cssProperties}getNativeObject_(){return this._nativeObject}_uncamel(t){let e=t.replace(RX.UpperCaseLetter_g,(t,...e)=>`-${e[0].toLowerCase()}`);return e.startsWith("webkit")?`-${e}`:e}onBoot_(t){}onDocumentUnload_(){this._ajaxCallbacks.clear()}onIFrameLoad_(t){this._iframeEvents.length>0&&(this._iframeEvents.length=0),this._fixFragmentEvents.length>0&&(this._fixFragmentEvents.length=0),this._iframeObject=null,this._onIFrameLoad(()=>{let e=this.getIFrameUri_();null!=e&&e.hash$.length>0?this.scrollToFragment_(e.hash$.substring(1),e=>{t()}):t()})}fixIFrameHrefs_(){let t=this.iQueryAll_("a[href]");const e=this.getIFrameUri_();let i=t.length;for(let n=0;n<i;++n){let i=t[n],s=i.getAttribute("href");if(null==s)continue;if(s.startsWith("data:")){s.startsWith("data:image/")||i.removeAttribute("href");continue}let o=An.parseUriSafe_(s,e);if(null==o||!PathUtil.isValidFilepathSegments(o.pathSegments$)){i.removeAttribute("href");continue}let l=An.cleanUri_(An.addViewParam_(o,e),null,e);null==l||l.equals(o)||i.setAttribute("href",l.toString())}}fixIFrameSrcs_(){let t=this.iQueryAll_("[src]");const e=this.getIFrameUri_();if(null==e)return;let i=t.length;for(let n=0;n<i;++n){let i=t[n],s=i.getAttribute("src");if(null==s)continue;if(s.startsWith("data:")){s.startsWith("data:image/")||i.removeAttribute("src");continue}let o=An.parseUriSafe_(s,e);if(null==o||!PathUtil.isValidFilepathSegments(o.pathSegments$)){i.removeAttribute("src");continue}let l=An.cleanUri_(o,null,e);null==l||l.equals(o)||i.setAttribute("src",l.toString())}}fixIFrameMedia_(){Timer.sleep0_(()=>{if(null==this.getIFrameUri_())return;const t=this.iQueryAll_(`video.${CSS.xVideo}, audio.${CSS.xAudio}`);for(const e of t){const t=JsUtil.getXInfoNumber_(e,XInfoKey.seek);null!=t&&(e.currentTime=t)}Timer.sleep0_(()=>{for(const e of t)e.addEventListener("pause",()=>{JsUtil.updateXInfoNumber_(e,XInfoKey.seek,e.currentTime)}),e.addEventListener("seeked",()=>{JsUtil.updateXInfoNumber_(e,XInfoKey.seek,e.currentTime)})})})}fixIFrameStyles_(){let t=this.iQueryAll_("[style]");if(null==t)return;const e=this.getIFrameUri_();if(null==e)return;let i=t.length;for(let n=0;n<i;++n){let i=t[n],s=i.getAttribute("style");if(null==s)continue;let o=CSSUtil.cleanupCSSUrlHostPort_(s,e);o!=s&&JsUtil.setAttribute0_(i,"style",o)}}fixIFrameStylesheets_(){let t=this.getIFrameDocument_();if(null==t)return;let e=t.styleSheets;if(null==e)return;const i=this.getIFrameUri_();if(null!=i)for(let t=0,n=e.length;t<n;++t){let n=e[t],s=An.parseUriSafe_(n.href,this.getIFrameUri_());if(null==s)continue;if(s.path$.startsWith(PATH._assets_))continue;let o=n.rules;for(let t=0,e=o.length;t<e;++t){let e=o[t].cssText,s=CSSUtil.cleanupCSSUrlHostPort_(e,i);s!=e&&(n.deleteRule(t),n.insertRule(s,t))}}}findIFrameStylesheet_(t){const e=this.getIFrameDocument_();if(null==e)return null;const i=e.styleSheets;if(null==i)return null;const n=this.getIFrameUri_();t.startsWith("/")||(t="/"+t);for(let e=0,s=i.length;e<s;++e){let s=i[e],o=An.cpathOfHref2_(n,s.href);if(null!=o&&o==t)return s}return null}updateIFrameStylesheets_(t,e){let i=this.findIFrameStylesheet_(t);if(null==i)return void e();let n=i.ownerNode,s=null==n?void 0:n.parentNode;if(null==n||null==s)e();else{JsUtil.remove_(n);let t=n,i=n.nextSibling;Timer.sleep0_(()=>{null==s||s.insertBefore(t,i),e()})}}fixIFrameInputs_(){let t=this.iQueryAll_("input, textarea, select"),e=t.length;for(let i=0;i<e;++i){let e=t[i];switch(e.nodeName){case"TEXTAREA":{let t=e.value;JsUtil.setTextContent_(e,t);break}case"INPUT":{let t=e,i=t.type;if(null!=i&&("checkbox"==(i=i.toLowerCase())||"radio"==i)){let e=t.checked;JsUtil.setAttribute_(t,"checked",e?"true":null);break}let n=t.value;t.setAttribute("value",n);break}case"SELECT":{let t=e,i=t.selectedOptions,n=t.options;if(null!=n)for(let t of new ItemsIterable(n))t.removeAttribute("selected");if(null!=i)for(let t of new ItemsIterable(i))t.setAttribute("selected","true");break}}}}fixIFrameFragments_(t,e){}fixIFrameRightsidebar_(){}scrollToFragment_(t,e){Timer.sleep1_(()=>{e(this._scrollToFragment(t))})}onIFrameUnload_(){this.removeEventSubscriptions_(this._iframeEvents),this.removeEventSubscriptions_(this._fixFragmentEvents),this._iframeObject=null}removeEventSubscriptions_(t){for(;0!=t.length;)this.iRemoveEventListener_(t.pop())}reloadHome_(){window.location.replace(Conf.schemeHost+`/?t=${An.ms_()}`)}browseHome_(t){let e=Conf.publicHomePath,i=An.uriFromSafe_(null,e.split("/"));if(null==i)throw new Error;this.browse_(i)}getIFrameObject_(){return null==this._iframeObject&&(this._iframeObject=document.getElementById(ID.contentIFrame)),this._iframeObject}getIFrameWindow_(){var t,e;return null!==(e=null===(t=this.getIFrameObject_())||void 0===t?void 0:t.contentWindow)&&void 0!==e?e:null}iGetElementById_(t){return this._iGetElementById(t)}getIFrameScroll_(){let t=this.getIFrameWindow_();return null==t?null:new Point(t.scrollX,t.scrollY)}iQuery(t,e=null){return this._iQuerySelector(t,e)}iQueryAll_(t,e=null){return this._iQuerySelectorAll(t,e)}getIFrameSelectionRange_(){let t=this._getIFrameSelectionRange();return null==this._range?t:null!=t&&this._rangeEquals(this._iframeRange,t)?this._range:(this._range=null,this._iframeRange=null,t)}_rangeEquals(t,e){return null==t?null==e:null!=e&&(t.startOffset==e.startOffset&&t.endOffset==e.endOffset&&t.startContainer==e.startContainer&&e.endContainer==e.endContainer)}getValidIFrameSelectionRange_(){return this.getValidRange_(this.getIFrameSelectionRange_())}getValidRange_(t){return this._getValidRange(t)}getSelectedNodesOfRange_(t){return this._getSelectedNodesOfRange(t)}getSingleSelectedNodeOfRange_(t){return this._getSingleSelectedNodeOfRange(t)}getSingleSelectedNode_(){return this.getSingleSelectedNodeOfRange_(this.getIFrameSelectionRange_())}getSingleSelectedOrCollapsedElement_(){let t=this.getIFrameSelectionRange_();return this.getSingleSelectedOrCollapsedElementOfRange_(t)}getNearestSelectedElement_(){let t=this.getIFrameSelectionRange_();return this._getNearestSelectedElementOfRange(t)}getNearestSelectedElementOfRange_(t){return this._getNearestSelectedElementOfRange(t)}getSingleSelectedOrCollapsedElementOfRange_(t){if(null==t)return null;if(t.collapsed)return getNearestSelectedElement1_(t);let e=this._getSingleSelectedNodeOfRange(t);return null!=e&&e.nodeType==Node.ELEMENT_NODE?e:null}iframeCollapseRange_(t){return this._iCollapseRange(t)}focusIFrame_(){this.focusIFrameWindow_(),this.focusIFrameBody_()}focusIFrameWindow_(){let t=this.getIFrameWindow_();null!=t&&t.focus()}focusIFrameBody_(){let t=this.getIFrameBody_();null!=t&&t.focus()}blurIFrame_(){let t=this.getIFrameBody_();null!=t&&t.blur();let e=this.getIFrameWindow_();null!=e&&e.blur()}reload_(){const t=this.getIFrameObject_();let e=this.getIFrameWindow_();if(null==t||null==e)return;let i=e.location.href;try{let e=An.parseUriSafe_(i,null);if(null==e)return;let n=e.queryParameters$,s=new Map;for(let t of[Param.view,Param.mime])if(n.has(t)){let e=n.get(t);null!=e&&s.set(t,e)}let o=An.uriFrom_(null,e.path$,s);t.src=o.href$}catch(t){}}browse_(t){const e=this.getIFrameObject_();if(null==e)return;let i=t.href$;e.src=i}_ajaxCallback(t){let e=An.parseJSONObjectOrNull_(t);if(null==e)return null;let i=e[Key.serial];if(null==i)return null;let n=this._ajaxCallbacks.get(i);return null==n?null:(this._ajaxCallbacks.delete(i),n(e),null)}_setRange(t){let e=this._getIFrameSelectionRange();return null==t||null==e||t.collapsed?(this._range=null,this._iframeRange=null):(this._range=t,this._iframeRange=e),t}cssEditor_(t,e,i,n){return this._cssEditor(t,e,i,n)}iGetMetaVersion_(){let t=this._iGetMetaVersion();return An.parseInt_(t,0)}iGetMetainfo_(){return this._iGetMetainfo()}iSetMetainfo_(t){return this._iSetMetainfo(t)}iClearSelection_(){return this._range=null,this._iframeRange=null,this._iClearSelection()}iSelectMulti_(t){return this._range=null,this._iframeRange=null,this._iSelectMulti(t)}iRevealNode_(t,e=null){this._iRevealNode(t,e)}iRevealSelection_(t=null){this._iRevealSelection(this.getIFrameSelectionRange_(),t)}iSelectSelector_(t,e=null){return this.iSelectNode_(this._iQuerySelector(t,e))}iSelectNode_(t,e=null,i=!1,n=null){return this._setRange(this._iSelectNode(t,e,i,n))}iSelectNodeByPath_(t,e=!1,i=null){this._setRange(this._iSelectNodeByPath(t,e,i))}iSelectContents_(t,e=null){return this._setRange(this._iSelectContents(t,e))}iSelectNodes_(t,e,i=!1,n=null){return this._setRange(this._iSelectNodes(t,e,i,n))}iSelect_(t,e,i){return this._setRange(this._iSelect(t,e,i))}iSelectRange_(t,e=!1,i=null){this._iSelectRange(t,e,i),this._setRange(t)}iSetCaretAtStart_(t,e=!1,i=null){return this._setRange(this._iSetCaretAtStart(t,e,i))}iSetCaretAtEnd_(t,e=!1,i=null){return this._setRange(this._iSetCaretAtEnd(t,e,i))}iSelectParent_(){let t=this._setRange(this._iSelectParent(this.getIFrameSelectionRange_()));if(null==t)return null;let e=t.startContainer;return e.nodeType==Node.ELEMENT_NODE?e.childNodes[t.startOffset]:e}iGetAncestors_(){return this._iGetAncestors(this.getIFrameSelectionRange_())}iCreateDocumentFragment_(t){return this._iCreateDocumentFragment(t)}iDrawImage_(t,e){return this._iDrawImage(t,e)}getIFrameNodePath_(t){return this._getIFrameNodePath(t)}getIFrameSelectionPath_(){let t=this.getIFrameSelectionRange_();return this._getIFrameSelectionPathOfRange(t)}getIFrameNodeByPath_(t,e=!1){return this._getIFrameNodeByPath(t,e)}getIFrameLinks_(){let t=this.getIFrameContextPath_();return this._getIFrameLinks(t)}getInlineStyles_(t,e){return this._getInlineStyles(t,e)}getStyleOrComputedStyle_(t,e,i){return this._getStyleOrComputedStyle(t,e,i)}iGetStyleOrComputedStyle1_(t,e,i){return this._iGetStyleOrComputedStyle1(t,e,i)}getComputedStyle1_(t,e,i){return this._getComputedStyle1(t,e,i)}getComputedStyle_(t,e,i){return this._getComputedStyle(t,e,i)}getComputedStyles_(t,e=null){return this._getComputedStyles(t,e)}getBoundingClientRect_(t){return t.getBoundingClientRect()}removeAddClasses_(t,e,i){this._removeAddClasses(t,e,i)}toggleClasses_(t,e){this._toggleClasses(t,e)}hasClass_(t,e){return this._hasClass(t,e)}hasClasses_(t,e){return this._hasClasses(t,e)}hasAnyClass_(t,e){let i=t.classList;for(let t of e)if(i.contains(t))return!0;return!1}hasClassParent_(t,e,i){return this._hasClassParent(t,e,i)}setStyles_(t,e){this._setStyles(t,e)}replaceStyle_(t,e,i){return this._replaceStyle(t,e,i)}removeAttribute_(t,e){return this._removeAttribute(t,e)}removeAttributes_(t,e=null){this._removeAttributes(t,e)}iWrapRange_(t,e,i){return this._iWrapRange(t,e,i)}iRemovePlaceholder_(t){this._iRemovePlaceholder(t)}iRemoveSelections_(){this._iRemoveSelections()}setDisplayBySelectorAll_(t,e,i){this._setDisplayBySelectorAll(t,e,i)}setDisplayById_(t,e){this._setDisplayById(t,e)}setDisplay_(t,e){this._setDisplay(t,e)}iAddEventListener_(t,e,i,n,s=!1){let o=this._iAddEventListener(t,e,i,s),l=new Map([[Native._eventTarget,t],[Native._eventName,e],[Native._eventUseCapture,s],[Native._eventListener,o]]);return n&&this._iframeEvents.push(l),l}iRemoveEventListener_(t){this._iRemoveEventListener(t.get(Native._eventTarget),t.get(Native._eventName),t.get(Native._eventListener),t.get(Native._eventUseCapture))}addCallback_(t,e){this._nativeObject._addCallback(t,e)}removeCallback_(t,e){this._nativeObject._removeCallback(t,e)}onCallback_(t,e){this._nativeObject.X7t(t,e)}onFontLoaded_(t,e,i){this._onFontLoaded(t,e,i)}getNodeInfo_(t){return this._getNodeInfo(t)}cloneNode_(t){return this._cloneNode(t)}cloneRange_(t){return this._cloneRange(t)}cloneTemplate_(t){return this._cloneTemplate(t)}cloneClipboard_(t){var e,i,n;const s=this.getIFrameDocument_();if(null==s||null==t)return null;let o=null!==(e=t.get(MapClipboardKey.value))&&void 0!==e?e:null;if(null==o)return null;let l=null!==(i=t.get(MapClipboardKey.kind))&&void 0!==i?i:null;switch(l){case MapClipboardKind.dom:let e=null!==(n=t.get(MapClipboardKey.context))&&void 0!==n?n:null;return this._cloneClipboard(o,e);case MapClipboardKind.string:return s.createTextNode(o);default:throw Assert.notReach_(l)}}getClipboardText_(t){var e,i;let n=null!==(e=t.get(MapClipboardKey.value))&&void 0!==e?e:null;if(null==n)return n;let s=null!==(i=t.get(MapClipboardKey.kind))&&void 0!==i?i:null;switch(s){case MapClipboardKind.dom:return this._getClipboardText(n);case MapClipboardKind.string:return n;default:throw Assert.notReach_(s)}}serializeClone_(t){return this._serializeClone(t)}serializeCutAll_(t,e){return this._serializeCutAll(t,e)}createMutationObserver_(t){return new MutationObserver(t)}getTemplateMarker_(t,e,i){if(null==t)return null;return this._getTemplateMarker(t,e,i)}getIndexOf_(t){return this._getIndexOf(t)}stringify_(t){return this._stringify(t)}keys_(t){return this._keys(t)}serializeToString_(t){return(new XMLSerializer).serializeToString(t)}serializeIFrameDocument_(){return this._serializeIFrameDocument()}toggleFullscreen_(){this._toggleFullscreen()}isFullscreen_(){return this._isFullscreen()}isVisible_(t){return this._isVisible(t)}isVisible1_(t){return this._isVisible1(t)}getSettings_(){return An.parseJSONObjectOrNull_(this._getSettings())}audioPlayer_(t){this._audioPlayer(t)}getIFrameDocument_(){var t,e;return null!==(e=null===(t=this.getIFrameWindow_())||void 0===t?void 0:t.document)&&void 0!==e?e:null}getIFrameBody_(){var t,e;return null!==(e=null===(t=this.getIFrameDocument_())||void 0===t?void 0:t.body)&&void 0!==e?e:null}getIFrameHead_(){var t,e;return null!==(e=null===(t=this.getIFrameDocument_())||void 0===t?void 0:t.head)&&void 0!==e?e:null}getIFrameHref_(){var t,e;try{const i=null!==(e=null===(t=this.getIFrameDocument_())||void 0===t?void 0:t.location)&&void 0!==e?e:null;return null==i?null:i.href}catch(t){}return null}getIFrameUri_(){const t=this.getIFrameHref_();if(null==t)return null;if(null!=this.iframeUriCache&&this.iframeUriCache[0]===t)return this.iframeUriCache[1];const e=An.parseUriSafe_(t,null);return this.iframeUriCache=null==e?null:[t,e],e}getIFrameContextPath_(){const t=this.getIFrameUri_();return null==t?null:An.cpathOfUri_(t)}getIFrameDir_(){const t=this.getIFrameContextPath_();return null==t?null:Basepath.dir_(t)}asPathQuery_(t){return null==t?"?path=":"?path="+encodeURIComponent(t.toAbsolute_().path$)}filenameFromURL_(t,e){return An.filenameFromUri_(An.parseUriSafe_(t,e))}filenameFromCSSURL_(t,e){let i=new RegExp("^url\\((.*)\\)$").exec(t);return this.filenameFromURL_(null!=i?i[1].trim():t,e)}formatStylesForEditing_(t,e=null,i){let n=new StringBuffer;for(let s of t){if(2!=s.length)continue;null!=e&&n.write_(e);let t=s[0],o=CSSUtil.humanCSSUrls_(s[1],i),l=CSSUtil.escCSSValue_(t,o);n.write_(t),n.write_(" "),n.write_(l),n.write_(DEF.LF)}return n.toString()}getStylesheet_(t,e){let i=e.styleSheets;const n=native$.getIFrameUri_();if(null!=n)for(let e of new ItemsIterable(i))if(this.acceptStylesheet_(t,e,n))return e;return null}acceptStylesheet_(t,e,i){let n=e.href;return this.acceptStylesheet1_(t,n,i)}acceptStylesheet1_(t,e,i){if(null==e)return!1;let n=An.parseUriSafe_(e,i);if(null==n)return!1;let s=n.pathSegments$;if(t.length!=s.length)return!1;for(let e=0,i=t.length;e<i;++e)if(t[e]!=s[e])return!1;return!0}_cssEditor(t,e,i,n){const s=t.contentWindow;if(!s)return null;const o=s.XxUu;return o.XPz(e,i,n),o}_iGetMetaVersion(){let t=getiframedocument_(),e=t?t.head:null;if(!e)return null;let i=e.querySelector("meta[name=version]");return i?i.getAttribute("content"):null}_iGetMetainfo(){let t=getiframedocument_(),e=t?t.head:null;if(!e)return null;let i=e.querySelector("meta[name=metainfo]");return i?i.getAttribute("content"):null}_iSetMetainfo(t){let e=getiframedocument_(),i=e?e.head:null;if(!i||!e)return;let n=i.querySelector("meta[name=metainfo]");n||((n=e.createElement("meta")).setAttribute("name","metainfo"),e.head.appendChild(n)),n.setAttribute("content",t)}_scrollToFragment(t){let e=getiframedocument_();if(!e)return null;let i=decodeURIComponent(t),n=e.getElementById(i);if(null==n){let t=e.getElementsByName(i);t.length>0&&(n=t[0])}return null!=n&&n.nodeType==Node.ELEMENT_NODE&&myscroll_(n,!0),n}_onIFrameLoad(t){let e=getiframewindow_(),i=e?e.document:null,n=i?i.body:null;n&&i&&e?(i.execCommand("insertBrOnReturn",!0,"true"),fixscrolloffset_(e,n),t()):t()}_getIFrameSelectionRange(t){t=t||0;let e=getiframeselection_();return e&&e.rangeCount>t?e.getRangeAt(t):null}_getValidRange(t){return isInvalidRange_(t)?null:t}_getSelectedNodesOfRange(t){if(!t)return null;let e=t.startContainer,i=t.endContainer;if(!e||!i||e!==i)return null;if(e.nodeType!==Node.ELEMENT_NODE)return null;let n=e.childNodes,s=[];for(let e=t.startOffset,i=n.length;e<i&&e<t.endOffset;++e)s.push(n[e]);return s}_getNearestSelectedElementOfRange(t){return getNearestSelectedElement1_(t)}_getSingleSelectedNodeOfRange(t){if(!t)return null;let e=t.startContainer,i=t.endContainer;return e&&i&&e===i?e.nodeType===Node.ELEMENT_NODE&&t.endOffset-t.startOffset==1?e.childNodes.item(t.startOffset):e.nodeType===Node.TEXT_NODE&&0===t.startOffset&&e.textContent&&t.endOffset===e.textContent.length?e:null:null}_getIFrameSelectionPathOfRange(t){if(!t||!t.startContainer)return null;let e=t.startContainer;if(e.nodeType===Node.ELEMENT_NODE){let i=e.childNodes.item(t.startOffset);null!=i&&(e=i)}return this._getIFrameNodePath(e)}_getIFrameNodePath(t){let e=[];for(;null!=t&&"BODY"!=t.nodeName&&"HEAD"!=t.nodeName;){let i=t.parentNode;if(null==i)return null;let n=indexof_(t,i);if(n<0)return null;e.unshift(n),t=i}return e}_getIFrameNodeByPath(t,e){if(null==t)return null;let i=getiframedocument_();if(!i)return null;let n=e?i.head:i.body;if(!n)return null;for(let e=0;e<t.length;++e){let i=t[e],s=n.childNodes;if(!s||i>=s.length)return null;n=s[i]}return n}_iCreateDocumentFragment(t){let e=getiframedocument_();if(null==e)return null;let i=e.createDocumentFragment();for(let e=0;e<t.length;++e)i.appendChild(t[e].cloneNode(!0));return i}_iDrawImage(t,e){let i=t.getContext("2d");i&&i.drawImage(e,0,0)}_iGetElementById(t){let e=getiframedocument_();return e?e.getElementById(t):null}_iQuerySelector(t,e=null){return e||(e=getiframebody_()),e?e.querySelector(t):null}_iQuerySelectorAll(t,e=null){return e||(e=getiframebody_()),DomUt.queryAll_(e,t)}_getStyleProperties(){return Object.keys(document.body.style)}_getInlineStyles(t,e){let i=new Map,n=t.style;for(let t=0;t<e.length;++t){let s=e[t],o=n.getPropertyValue(s);null!=o&&("string"!=typeof o||0!=o.length&&"auto"!=o)&&i.set(s,o)}return i}_getStyleOrComputedStyle(t,e,i){let n=new Map,s=getiframewindow_();if(null==s)return n;let o=t.style,l=[];for(const t of i){let e=o.getPropertyValue(t);"string"==typeof e&&e.length>0&&"auto"!=e?n.set(t,e):l.push(t)}if(l.length>0){let i=s.getComputedStyle(t,e);for(const t of l)n.set(t,i.getPropertyValue(t))}return n}_iGetStyleOrComputedStyle1(t,e,i){let n=getiframewindow_(),s=t.style.getPropertyValue(i);if("string"==typeof s&&s.length>0&&"auto"!=s)return s;return n.getComputedStyle(t,e).getPropertyValue(i)}_getComputedStyles(t,e=null){return getiframewindow_().getComputedStyle(t,e)}_getComputedStyle1(t,e,i){var n;let s=getiframewindow_();return s&&null!==(n=s.getComputedStyle(t,e).getPropertyValue(i))&&void 0!==n?n:null}_getComputedStyle(t,e,i){let n=new Map,s=getiframewindow_();if(!s)return n;let o=s.getComputedStyle(t,e);for(let t=0;t<i.length;++t){let e=i[t];n.set(e,o.getPropertyValue(e))}return n}_replaceStyle(t,e,i){let n=t.style.getPropertyValue(e),s=null;if(t.style.removeProperty(e),null!=i&&i.length>0){i!=this._getComputedStyle1(t,null,e)&&(s=e+": "+i+";")}let o=t.getAttribute("style");return null!=s&&(o=s+(null==o?"":o)),null==o||0==o.length?t.removeAttribute("style"):t.setAttribute("style",o),n}_removeAddClasses(t,e,i){if(!t)return;let n=t.classList;if(e)for(const t of e)n.remove(t);if(i)for(const t of i)n.contains(t)||n.add(t)}_toggleClasses(t,e){if(!t||!e)return;let i=t.classList;for(let t=0,n=e.length;t<n;++t)i.toggle(e[t])}_setStyles(t,e){if(void 0===e||0==e.size)return;let i=t.style;for(const[t,n]of e.entries())null==n||0==n.length?i.removeProperty(t):i.setProperty(t,n);{let e=t.getAttribute("style");null==e||0==e.length?t.removeAttribute("style"):t.setAttribute("style",e)}}_hasClass(t,e){if(null==t||t.nodeType!=Node.ELEMENT_NODE)return!1;return t.classList.contains(e)}_hasClasses(t,e){const i=null!=t&&t.nodeType==Node.ELEMENT_NODE?t.classList:null;return e.map(t=>null!=i&&i.contains(t))}_hasClassParent(t,e,i){for(;t;){if(t.nodeType===Node.ELEMENT_NODE){let n=t.classList;if(n.contains(e))return t;if(i)for(let t=0,e=i.length;t<e;++t)if(n.contains(i[t]))return null}t=t.parentNode}return null}_removeAttribute(t,e){let i=null;return t&&(i=t.getAttribute(e),t.removeAttribute(e)),i}_removeAttributes(t,e){if(t){let i=t.attributes,n=[];for(let t=0;t<i.length;++t)if(null==e)n.push(i[t]);else{let s=i[t],o=s.name;e.indexOf(o)>=0&&n.push(s)}for(let e=0;e<n.length;++e)t.removeAttributeNode(n[e])}}_iClearSelection(){let t=getiframeselection_();return t&&t.removeAllRanges(),t}_iCollapseRange(t){let e=this._getIFrameSelectionRange();if(!e)return null;if(!e.collapsed){let i=getiframeselection_();if(!i)return null;e.collapse(t),i.removeAllRanges(),i.addRange(e)}return e}_iSelectMulti(t){return null==t?0:iclearselection_((e,i)=>{if(null==e||null==i)return 0;let n=t.length;for(let s=0;s<n;++s){let n=t[s],o=i.createRange();o.selectNode(n),e.addRange(o)}return n})}_iSelectRange(t,e,i=null){return t?iclearselection_((n,s)=>{if(null==n||null==s)return null;if(1==e){myscroll_(getelementforscroll_(t),i)}return n.addRange(t),t}):null}_iSelectNode(t,e,i,n){return t?icreaterange_((s,o)=>(1==i&&myscroll_(t,n),o.selectNode(t),null!=e&&o.collapse(e),s.addRange(o),o)):null}_iSelectContents(t,e=null){return t?icreaterange_((i,n)=>(n.selectNodeContents(t),null!=e&&n.collapse(e),i.addRange(n),n)):null}_iSelectNodes(t,e,i=!1,n=null){return icreaterange_((s,o)=>{if(1==i&&myscroll_(t,n),o.setStartBefore(t),e)o.setEndAfter(e);else{let e=t.parentNode,i=e?e.lastChild:null;i&&o.setEndAfter(i)}return s.addRange(o),o})}_iSelect(t,e,i){return t?icreaterange_((n,s)=>(s.setStart(t,e),s.setEnd(t,i),n.addRange(s),s)):null}_iSetCaretAtStart(t,e,i=null){return t?icreaterange_((n,s)=>(1==e&&myscroll_(t,i),s.selectNode(t),s.collapse(!0),n.addRange(s),s)):null}_iSetCaretAtEnd(t,e,i=null){return t?icreaterange_((n,s)=>(1==e&&myscroll_(t,i),s.setStartAfter(t),s.collapse(),n.addRange(s),s)):null}_iSelectNodeByPath(t,e=!1,i=null){let n=getiframebody_();if(!n)return null;let s=gettarget_(n,t);return this._iSelectNode(s,null,e,i)}_iRevealNode(t,e=null){myscroll_(t,e)}_iRevealSelection(t,e=null){myscroll_(getElementForScrollIntoView_(t),e)}_iSelectParent(t){let e=getiframewindow_(),i=e?e.document:null;if(!i)return null;let n=null;if(null==t)t=i.createRange(),n=i.body;else{let e=(n=t.collapsed?t.startContainer:t.commonAncestorContainer).nodeType;e==Node.TEXT_NODE||e==Node.COMMENT_NODE||e==Node.CDATA_SECTION_NODE?t.collapsed||(n=n.parentNode):(e!=Node.ELEMENT_NODE||isHtmlElement_(n.nodeName))&&(n=i.body)}return n?this._iSelectNode(n):null}_iGetAncestors(t){if(null==t)return[];let e=null,i=getiframebody_();if(null==i)return[];let n=t.startContainer,s=t.endContainer;if(!n||!s||n!==s)return[];if(n.nodeType===Node.ELEMENT_NODE?null==(e=n.childNodes.item(t.startOffset))&&(e=n):e=n,e.nodeType==Node.ELEMENT_NODE&&isHtmlElement_(e.nodeName))return[i];let o=[];do{o.push(e),e=e.parentNode}while(null!=e&&!isHtmlElement_(e.nodeName));return o}_iWrapRange(t,e,i){let n=i.startContainer.ownerDocument;if(!n)return null;let s=i.extractContents(),o=DomBuilderEx.offline_(n,t,e).cursor_();return o.append(s),i.insertNode(o),o}_iRemovePlaceholder(t){let e=t.classList;e.remove("x-placeholder"),0==e.length&&t.removeAttribute("class");for(let e=t.firstChild;null!=e;e=t.firstChild)e.remove();t.textContent=XXX,this._iSelectNode(t.firstChild)}_iRemoveSelections(){var t,e;null===(t=getiframebody_())||void 0===t||t.blur(),null===(e=getiframeselection_())||void 0===e||e.removeAllRanges()}_setDisplay(t,e){setdisplay_(t,e)}_setDisplayBySelectorAll(t,e,i){let n=(t=t||getiframebody_())?t.querySelectorAll(e):null;if(n)for(let t=0,e=n.length;t<e;++t)setdisplay_(n[t],i)}_setDisplayById(t,e){setdisplay_(this._iGetElementById(t),e)}_iAddEventListener(t,e,i,n){return null==t&&(t=getiframewindow_()),t.addEventListener(e,i,n),i}_iRemoveEventListener(t,e,i,n){var s;t?t.removeEventListener(e,i,n):null===(s=getiframewindow_())||void 0===s||s.removeEventListener(e,i,n)}_cloneNode(t){let e=t.cloneNode(!0);return e.normalize(),sanitizeClone_(e),e}_cloneRange(t){let e=t.cloneContents();return e.normalize(),e}_serializeCutAll(t,e){let i=getiframedocument_();if(!i)return"";let n=i.createElement("body");null!=t&&(n.innerHTML=t);let s,o=n;for(;null!=(s=o.firstChild)&&s.nodeType==Node.ELEMENT_NODE;)o=s;for(let t=0;t<e.length;++t){let i=e[t];i.parentNode&&i.parentNode.removeChild(i),o.appendChild(i)}return sanitizeClone_(o),this._serializeClone(o)}_cloneClipboard(t,e){let i=getiframedocument_();if(!i)return null;let n=i.createElement("body");null!=e&&(n.innerHTML=e);let s,o=n;for(;null!=(s=o.firstChild)&&s.nodeType==Node.ELEMENT_NODE;)o=s;return o.innerHTML=t,sanitizeClone_(o),o}_getClipboardText(t){let e=getiframedocument_().createElement("div");return e.innerHTML=t,e.textContent}_cloneTemplate(t){var e;let i=null===(e=getiframedocument_())||void 0===e?void 0:e.createDocumentFragment();if(!i)return null;let n=t.childNodes;for(let t=0,e=n.length;t<e;++t){let e=n[t].cloneNode(!0);e.normalize(),sanitizeClone_(e),i.appendChild(e)}return i}_getTemplateMarker(t,e,i){let n=getNearestSelectedElement1_(t),s=null;if(Array.isArray(i)||(i=[i]),!getiframewindow_())return null;for(;null!==n;n=n.parentElement){let t=n.classList,o=t?t.length:0;for(let l=0;l<o;++l){let o=t[l];if("x-rsb-content"==o)return null;if(null==s&&((i.indexOf(o)>=0||!An.isempty_(e)&&o==e)&&this._isVisible(n.parentNode)&&(s=n),"BODY"==n.nodeName))break}}return s}_getIndexOf(t){let e=t.parentElement;if(null!=e){let i=e.childNodes,n=i.length;for(let e=0;e<n;++e)if(i[e]===t)return e}return-1}_getNodeInfo(t){let e=t.nodeType;return e==Node.ELEMENT_NODE?elementinfo_(t):e==Node.TEXT_NODE?truncate_(t.textContent||"",MAX_TEXT_LENGTH):e==Node.CDATA_SECTION_NODE?t.nodeName+"#"+truncate_(t.textContent||"",MAX_TEXT_LENGTH):t.nodeName}_getIFrameLinks(t){let e=json_(),i=json_(),n=[],s=[];e[LinkInfoKey_HEAD]=n,e[LinkInfoKey_BODY]=s;let o=getiframedocument_();if(o){let l=DomUt.queryAll_(o.head,"[href], [src]");for(let t=0;t<l.length;++t){let e=l[t],s=this._getIFrameNodePath(e);s&&linkinfo_(i,n,e,s)}let a=DomUt.queryAll_(o.body,"[href], [src], a[name]");for(let t=0;t<a.length;++t){let e=a[t],n=this._getIFrameNodePath(e);n&&linkinfo_(i,s,e,n)}e[Key.baseurl]=t,e[Key.links]=i}return e}_stringify(t){return JSON.stringify(t)}_keys(t){return Object.keys(t)}_serializeIFrameDocument(){let t=getiframedocument_();return t?this.serializeDocument_(t):""}serializeDocument_(t){var e;let i=t.cloneNode(!0),n=i.querySelector("html");n&&n.removeAttribute("style");let s=i.querySelector("body");s&&removeAllAttributes_(s,["class"]);let o,l=i.createNodeIterator(i,NodeFilter.SHOW_ELEMENT);for(;null!=(o=l.nextNode());)null===(e=DomUt.asHTMLElement_(o))||void 0===e||e.removeAttribute("xmlns");return(new XMLSerializer).serializeToString(i)}_serializeClone(t){return sanitizeClone_(t),(new XMLSerializer).serializeToString(t)}_toggleFullscreen(){}_isFullscreen(){return!1}_isVisible(t){if(!t)return!1;let e=getiframewindow_();if(!e)return!1;for(;null!=t;t=t.parentNode){if(t.nodeType!=Node.ELEMENT_NODE)continue;let i=e.getComputedStyle(t,null);if("none"==i.display||"hidden"==i.visibility)return!1;let n=t.nodeName;if("BODY"==n||"HTML"==n)break}return!0}_isVisible1(t){if(!t||t.nodeType!=Node.ELEMENT_NODE)return!1;let e=getiframewindow_();if(!e)return!1;let i=e.getComputedStyle(t,null);return"none"!=i.display&&"hidden"!=i.visibility}_onFontLoaded(t,e,i){document.fonts.load(t,e).then(function(){i()})}_getSettings(){const t=window.AnSettings;delete window.AnSettings;const e=document.head.children;for(let t=0;t<e.length;++t){const i=e[t];if("SCRIPT"==i.nodeName&&"settings"==i.getAttribute("title")){i.remove();break}}return An.notXX_(t)?JSON.stringify(t):null}_audioPlayer(t){let e=new AudioContext;e.createMediaElementSource(t).connect(e.destination)}}Native._eventTarget="et",Native._eventName="en",Native._eventUseCapture="ec",Native._eventListener="el";const native$=new Native;window.Xxku=native$.getNativeObject_();class SearchMatch{constructor(){this.start=0,this.end=0}}class _SearchContext{constructor(t){this._offsets=[],this._nodes=[],this._matches=[],this._text="",this._lowercaseText=null,this._getsearchcontext(t)}_getsearchcontext(t){const e=t.nodeType;if(e==Node.TEXT_NODE){const e=t.textContent;null!=e&&e.length>0&&(this._offsets.push(this._text.length),this._nodes.push(t),this._text+=e)}else if(e==Node.ELEMENT_NODE)for(const e of new ItemsIterable(t.childNodes))this._getsearchcontext(e)}getLowerCaseText_(){return null==this._lowercaseText&&(this._lowercaseText=this._text.toLowerCase()),this._lowercaseText}}class SearchContext{constructor(t){this.context=null,this._node=t}_getcontext(){return null==this.context&&(this.context=new _SearchContext(this._node)),this.context}setMatches(t){this._getcontext()._matches=t}getText(){return this._getcontext()._text}getLowerCaseText(){return this._getcontext().getLowerCaseText_()}next(t){let e=0;if(null!=t){const i=this._getendoffset(t);if(null==i)return null;e=i}return this.nextAt(e)}nextAt(t){const e=this._getcontext()._matches;if(null==e)return null;const i=An.binarySearcher_(e,0,e.length,e=>e.start>t?1:e.start<t?-1:0);if(i>=0){const t=e[i];return this._rangeof(t.start,t.end)}if(-i-1<e.length){const t=e[-i-1];return this._rangeof(t.start,t.end)}return null}prev(t){let e=0;if(null!=t){const i=this._getstartoffset(t);if(null==i)return null;e=i}return this.prevAt(e)}prevAt(t){const e=this._getcontext()._matches;if(null==e)return null;const i=An.binarySearcher_(e,0,e.length,e=>e.start>t?1:e.start<t?-1:0);if(i>0){const t=e[i-1];return this._rangeof(t.start,t.end)}if(-i-2>=0){const t=e[-i-2];return this._rangeof(t.start,t.end)}return null}getStartOffset(t){return this._getstartoffset(t)}getEndOffset(t){return this._getendoffset(t)}getRangeOf(t,e){return this._rangeof(t,e)}_getfirsttextnode(t){var e,i;if(null==t)return null;const n=this._getchildtextnode(t);if(null!=n)return n;let s=t.nextSibling;for(;null==s&&null!=t;)s=null!==(i=null==(t=null!==(e=null==t?void 0:t.parentElement)&&void 0!==e?e:null)?void 0:t.nextSibling)&&void 0!==i?i:null;return this._getfirsttextnode(s)}_getchildtextnode(t){for(const e of new ItemsIterable(t.childNodes)){const t=e.nodeType;if(t==Node.TEXT_NODE){const t=e.nodeValue;if(null!=t&&t.length>0)return e}else if(t==Node.ELEMENT_NODE){const t=this._getchildtextnode(e);if(null!=t)return t}}return null}_getoffset1(t,e){const i=this._getcontext();if(null!=t)for(let n=0,s=i._nodes.length;n<s;++n){if(i._nodes[n]==t)return i._offsets[n]+e}return null}_getstartoffset(t){let e=t.startContainer;const i=t.startOffset;let n=e.nodeType;if(n==Node.TEXT_NODE)return this._getoffset1(e,i);if(e.nodeType==Node.ELEMENT_NODE){if(null==(e=e.childNodes[i]))return null;if((n=e.nodeType)==Node.TEXT_NODE)return this._getoffset1(e,0);if(n==Node.ELEMENT_NODE)return this._getoffset1(this._getfirsttextnode(e),0)}return null}_getendoffset(t){var e,i;let n=t.endContainer;const s=t.endOffset;let o=n.nodeType;if(o==Node.TEXT_NODE)return this._getoffset1(n,s);if(n.nodeType==Node.ELEMENT_NODE){if(null==(n=n.childNodes[s])){let n=t.endContainer,s=n.nextSibling;for(;null==s&&null!=n;)s=null!==(i=null==(n=null!==(e=null==n?void 0:n.parentNode)&&void 0!==e?e:null)?void 0:n.nextSibling)&&void 0!==i?i:null;return this._getoffset1(this._getfirsttextnode(s),0)}if((o=n.nodeType)==Node.TEXT_NODE)return this._getoffset1(n,0);if(o==Node.ELEMENT_NODE)return this._getoffset1(this._getfirsttextnode(n),0)}return null}_rangeof(t,e){var i,n;const s=this._getcontext(),o=s._offsets,l=s._nodes;let a=null,r=null,_=0,c=0;const h=An.binarySearchInt_(o,0,o.length,t),u=An.binarySearchInt_(o,0,o.length,e);h>=0?(a=l[h],_=0):(a=l[-h-2],_=t-o[-h-2]),u>=0?(r=l[u],c=0):(r=l[-u-2],c=e-o[-u-2]);const d=null!==(n=null===(i=a.ownerDocument)||void 0===i?void 0:i.createRange())&&void 0!==n?n:null;return null==d?null:(d.setStart(a,_),d.setEnd(r,c),d)}}class SearchMatcher{constructor(t,e){this._context=new SearchContext(t),this._anchorRange=e}getAnchor(){return this._anchorRange}setAnchor(t){this._anchorRange=t}getText(){return this._context.getText()}getLowerCaseText(){return this._context.getLowerCaseText()}getAnchorOffset(t){const e=this._anchorRange;return null==e?null:t?this._context.getStartOffset(e):this._context.getEndOffset(e)}getRangeOf(t,e){return this._context.getRangeOf(t,e)}}class OutlineSearchMatcher{constructor(t){this._index=0,this._tree=t,this._nodes=new Array,this._add(this._nodes,this._tree.root_()),this.resetAnchor_()}_add(t,e){for(let i=e.firstChild_();null!=i;i=i.nextSibling_())t.push(i),this._add(t,i)}resetAnchor_(){this._index=-1;const t=this._tree.getSelection_();if(null!=t&&t.length>0){const e=t[0];for(let t=0,i=this._nodes.length;t<i;++t)if(e===this._nodes[t])return void(this._index=t)}}_match(t,e,i){return null!=t&&(i?t.toLowerCase().includes(e):t.includes(e))}next_(t,e,i){var n,s;let o;for(let l=o=this._index<0?0:i?this._index:this._index+1,a=this._nodes.length;l<a;++l){const i=this._nodes[l];if(this._match(null!==(s=null===(n=i.content_())||void 0===n?void 0:n.textContent)&&void 0!==s?s:null,t,e))return this._index=l,i}return this._index=-1,null}prev_(t,e,i){var n,s;let o=i?this._index:this._index-1;o<0&&(o=this._nodes.length-1);for(let i=o;i>=0;--i){const o=this._nodes[i];if(this._match(null!==(s=null===(n=o.content_())||void 0===n?void 0:n.textContent)&&void 0!==s?s:null,t,e))return this._index=i,o}return this._index=-1,null}incrementalSearch_(t,e,i,n){if(0==t.length)return!0;e&&(t=t.toLowerCase());const s=n?this.prev_(t,e,i):this.next_(t,e,i);return null!=s?(s.revealSelect_(),s.scrollIntoView_(),!0):(this._tree.deselectAll_(),!1)}}class StepTimer{constructor(t=""){this._start=An.now_(),this._prev=this._start}elapsed_(){return An.now_()-this._start}delta_(){return An.now_()-this._prev}restart_(){return this._start=An.now_(),this._prev=this._start,this}debug_(t=""){return this}}class FireLimiter{constructor(t){this._delay=t,this._timer=null}destroy_(){null!=this._timer&&(this._timer.cancel_(),this._timer=null)}queue_(t){null!=this._timer&&this._timer.cancel_(),this._timer=new Timer(this._delay,()=>{this._timer=null,t()})}cancel_(){null!=this._timer&&this._timer.cancel_()}}class IRateLimiter{}class RateLimiter{constructor(t){this._ms=t,this._start=0,this._timer=null,this._callback=null}queue_(t,e=null){null!=e&&(this._start=e),this._callback=t;const i=An.now_(),n=i-this._start;if(n>=this._ms)return null!=this._timer&&(this._timer.cancel_(),this._timer=null),void this._run(i,!0);null==this._timer&&(this._timer=new Timer(this._ms-n,()=>this._fire()))}flush_(){null!=this._timer&&(this._timer.cancel_(),this._timer=null,this._run(An.now_(),!0))}cancel_(){null!=this._timer&&(this._timer.cancel_(),this._timer=null,this._callback=null)}_fire(){this._timer=null,this._run(An.now_(),!1)}_run(t,e){null!=this._callback&&(this._callback(t-this._start,e),this._callback=null),this._start=t}}class NoLimiter{constructor(){}queue_(t,e=null){t(0,!0)}flush_(){}cancel_(){}}NoLimiter.singleton=new NoLimiter;class FrameLimiter{constructor(t=1){this._divider=t,this._id=null,this._callback=null,this._n=0,this._start=0}static requestAnimationFrame(t,e){const i=new FrameLimiter(t);i.queue_(()=>{e(i)})}queue_(t,e=null){null!=e&&(this._start=e),this._callback=t,null==this._id&&(this._id=window.requestAnimationFrame(()=>this._handler()))}_handler(){++this._n>=this._divider?(this._n=0,this._id=null,this._run(!1)):this._id=window.requestAnimationFrame(()=>this._handler())}flush_(){null!=this._id&&(window.cancelAnimationFrame(this._id),this._id=null,this._run(!0))}cancel_(){null!=this._id&&(window.cancelAnimationFrame(this._id),this._callback=null,this._id=null)}_run(t){const e=An.now_();null!=this._callback&&(this._callback(e-this._start,t),this._callback=null),this._start=e}}class OutlineTreenode{constructor(t,e,i=null){_tree_1.set(this,void 0),_element.set(this,void 0),_indent.set(this,0),_populated_1.set(this,!1),_data_1.set(this,null),__classPrivateFieldSet(this,_tree_1,t),__classPrivateFieldSet(this,_indent,e),"string"==typeof i?__classPrivateFieldSet(this,_element,OutlineTreenode.create_(new Text(i))):i instanceof Function?__classPrivateFieldSet(this,_element,i()):__classPrivateFieldSet(this,_element,OutlineTreenode.create_(i)),__classPrivateFieldGet(this,_tree_1).setNode_(__classPrivateFieldGet(this,_element),this)}tree_(){return __classPrivateFieldGet(this,_tree_1)}root_(){return __classPrivateFieldGet(this,_tree_1).root_()}parent_(){return __classPrivateFieldGet(this,_tree_1).getTreenode_(__classPrivateFieldGet(this,_element).parentElement)}element_(){return __classPrivateFieldGet(this,_element)}isSelected_(){return __classPrivateFieldGet(this,_element).classList.contains(OutlineTreenode.SELECTED)}isTreenode_(){return!0}isRoot_(){return!1}control_(){const t=OutlineTreenode.getcontrol_(__classPrivateFieldGet(this,_element));return null==t?null:t}content_(t=null){var e,i;const n=null!==(i=null===(e=this.control_())||void 0===e?void 0:e.nextElementSibling)&&void 0!==i?i:null;return null==n?null:(null!==t&&(t instanceof Array?n.append(...t):n.append(t)),n)}isPopulated_(){return __classPrivateFieldGet(this,_populated_1)}setPopulated_(t){__classPrivateFieldSet(this,_populated_1,t)}setKind_(t){var e;const i=null===(e=this.control_())||void 0===e?void 0:e.classList;null==i||i.remove(OutlineTreenode.EXPANDED,OutlineTreenode.COLLAPSED,OutlineTreenode.LEAF),null==i||i.add(t)}nextSibling_(){for(let t=__classPrivateFieldGet(this,_element).nextElementSibling;null!=t;t=t.nextElementSibling)if(OutlineTreenode.istreenode_(t))return __classPrivateFieldGet(this,_tree_1).getTreenode_(t);return null}previousSibling_(){for(let t=__classPrivateFieldGet(this,_element).previousElementSibling;null!=t;t=t.previousElementSibling)if(OutlineTreenode.istreenode_(t))return __classPrivateFieldGet(this,_tree_1).getTreenode_(t);return null}firstChild_(){for(let t=__classPrivateFieldGet(this,_element).firstChild;null!=t;t=t.nextSibling)if(OutlineTreenode.istreenode_(t))return __classPrivateFieldGet(this,_tree_1).getTreenode_(t);return null}lastChild_(){for(let t=__classPrivateFieldGet(this,_element).lastChild;null!=t;t=t.previousSibling)if(OutlineTreenode.istreenode_(t))return __classPrivateFieldGet(this,_tree_1).getTreenode_(t);return null}get_(t){if(t<0)return null;for(let e=__classPrivateFieldGet(this,_element).firstChild;null!=e;e=e.nextSibling)if(OutlineTreenode.istreenode_(e)){if(0==t)return __classPrivateFieldGet(this,_tree_1).getTreenode_(e);--t}return null}indexOf_(t){let e=0;for(let i=this.firstChild_();null!=i;i=i.nextSibling_(),++e)if(i===t)return e;return-1}childCount_(){let t=0;for(let e=this.firstChild_();null!=e;e=e.nextSibling_())++t;return t}destroy_(){__classPrivateFieldGet(this,_tree_1).deselect1_(this),__classPrivateFieldGet(this,_tree_1).removeNode_(__classPrivateFieldGet(this,_element)),__classPrivateFieldGet(this,_element).remove()}append_(t=null){const e=OutlineTreenode.setupchild_(this,t);__classPrivateFieldGet(this,_element).childNodes.length;return __classPrivateFieldGet(this,_element).append(__classPrivateFieldGet(e,_element)),__classPrivateFieldGet(this,_element).childNodes.length,e}insertBefore_(t,e=null){const i=OutlineTreenode.setupchild_(this,e);__classPrivateFieldGet(this,_element).childNodes.length;return null==t?__classPrivateFieldGet(this,_element).append(__classPrivateFieldGet(i,_element)):__classPrivateFieldGet(this,_element).insertBefore(__classPrivateFieldGet(i,_element),__classPrivateFieldGet(t,_element)),__classPrivateFieldGet(this,_element).childNodes.length,i}removeChild_(t){t.destroy_(),OutlineTreenode.hastreenode_(this)||this.setKind_(OutlineTreenode.LEAF)}remove_(){var t;null===(t=this.parent_())||void 0===t||t.removeChild_(this)}removeDescendants_(){for(let t=this.firstChild_();null!=t;){const e=t.nextSibling_();t.removeDescendants_(),t.destroy_(),t=e}this.setKind_(OutlineTreenode.LEAF)}removeChildAt_(t){const e=this.get_(t);null!=e&&this.removeChild_(e)}moveChildrenBefore_(t,e,i,n){null==i&&(i=e.firstChild_()),null==n&&(n=null);for(let s=i;null!=s&&s!=n;){const i=s.nextSibling_();e.removeChild_(s),this.insertBefore_(t,s),s=i}}select_(t=!1){__classPrivateFieldGet(this,_tree_1).select_(this,t)}selectChildren_(){for(let t=this.firstChild_();null!=t;t=t.nextSibling_())__classPrivateFieldGet(this,_tree_1).select_(t,!0)}deselect_(t=!1){__classPrivateFieldGet(this,_tree_1).deselect_(this,t)}toggleSelection_(){return __classPrivateFieldGet(this,_tree_1).toggleSelection_(this)}expand_(){if(OutlineTreenode.expand1_(this))for(let t=this.firstChild_();null!=t;t=t.nextSibling_())OutlineTreenode.show_(t)}expandAll_(){OutlineTreenode.expand1_(this),OutlineTreenode.expandtree_(this)}collapse_(){OutlineTreenode.collapse1_(this)&&OutlineTreenode.hidetree_(this)}collapseAll_(){OutlineTreenode.hidetree_(this),OutlineTreenode.collapse1_(this)}reveal_(){for(let t=this.parent_();null!=t;t=t.parent_())t.expand_()}revealExpand_(){this.reveal_(),this.expand_()}revealSelect_(t=!1){this.reveal_(),this.select_(t)}revealExpandSelect_(t=!1){this.reveal_(),this.expand_(),this.select_(t)}scrollIntoView_(){__classPrivateFieldGet(this,_element).scrollIntoView({inline:"center"})}depthFirst_(t){for(let e=this.firstChild_();null!=e;){const i=e.nextSibling_();e.depthFirst_(t),e=i}t(this)}breadthFirst_(t){t(this);for(let e=this.firstChild_();null!=e;){const i=e.nextSibling_();e.breadthFirst_(t),e=i}}find_(t){return __classPrivateFieldGet(this,_element).querySelector(t)}findAll_(t){return __classPrivateFieldGet(this,_element).querySelectorAll(t)}getTargetPath_(){if(__classPrivateFieldGet(this,_data_1)instanceof Array)return Array.from(__classPrivateFieldGet(this,_data_1));const t=new Array;if(null==__classPrivateFieldGet(this,_data_1))return null;t.unshift(__classPrivateFieldGet(this,_data_1));for(let e=this.parent_();null!=e&&!e.isRoot_();e=e.parent_()){if(null==__classPrivateFieldGet(e,_data_1))return null;if(__classPrivateFieldGet(e,_data_1)instanceof Array)return t.unshift(...__classPrivateFieldGet(e,_data_1)),t;t.unshift(__classPrivateFieldGet(e,_data_1))}return t}setData_(t){__classPrivateFieldSet(this,_data_1,t)}getData_(){return __classPrivateFieldGet(this,_data_1)}static create1_(t,e=null){const i=DomBuilderEx.offline1_(t,"div",CSS.AnTreeNode).push_().div1_(CSS.AnTreeContent).span1_(CSS.AnTreeControl,CSS.AnTreeLeaf).siblingAfter_("span",{class:CSS.AnTreeContent});return null!=e&&(e instanceof Array?i.appendNodes_(...e):i.appendNodes_(e)),i.pop_().cursor_()}static istreenode_(t){return t.classList.contains(CSS.AnTreeNode)}static getcontrol_(t){var e,i;const n=null!==(i=null===(e=null==t?void 0:t.firstChild)||void 0===e?void 0:e.firstChild)&&void 0!==i?i:null;return null!=n&&n.nodeType==Node.ELEMENT_NODE?n:null}static adjustIndent_(t){const e=__classPrivateFieldGet(t,_indent)+__classPrivateFieldGet(t,_tree_1).tab_();for(let i=t.firstChild_();null!=i;i=i.nextSibling_())if(__classPrivateFieldGet(i,_indent)!=e){__classPrivateFieldSet(i,_indent,e);const t=OutlineTreenode.getcontrol_(__classPrivateFieldGet(i,_element));null!=t&&(t.style.marginLeft=`${e}px`),OutlineTreenode.adjustIndent_(i)}}static create_(t=null){return null===t?OutlineTreenode.create1_(document,null):t instanceof Array?0==t.length?OutlineTreenode.create1_(document,null):OutlineTreenode.create1_(t[0].ownerDocument,t):OutlineTreenode.create1_(t.ownerDocument,t)}static show_(t){const e=__classPrivateFieldGet(t,_element);OutlineTree.UseVisibilityCollapse?"visible"!=e.style.visibility&&(e.style.visibility="visible"):"block"!=e.style.display&&(e.style.display="block")}static hide_(t){const e=__classPrivateFieldGet(t,_element);OutlineTree.UseVisibilityCollapse?"collapse"!=e.style.visibility&&(e.style.visibility="collapse"):"none"!=e.style.display&&(e.style.display="none")}static hidetree_(t){for(let e=t.firstChild_();null!=e;e=e.nextSibling_())OutlineTreenode.hidetree_(e),OutlineTreenode.collapse1_(e),__classPrivateFieldGet(e,_element).classList.remove(OutlineTreenode.SELECTED),OutlineTreenode.hide_(e)}static collapse1_(t){const e=t.control_();if(null!=e){const t=e.classList;return t.contains(OutlineTreenode.EXPANDED)&&[OutlineTreenode.EXPANDED,OutlineTreenode.COLLAPSED].forEach(e=>t.toggle(e)),!0}return!1}static expandtree_(t){for(let e=t.firstChild_();null!=e;e=e.nextSibling_())OutlineTreenode.show_(e),OutlineTreenode.expand1_(e),OutlineTreenode.expandtree_(e)}static expand1_(t){const e=t.control_();if(null!=e){const i=e.classList;if(i.contains(OutlineTreenode.COLLAPSED)){for(const e of __classPrivateFieldGet(t,_tree_1).listeners_())e.onExpand_(t);return[OutlineTreenode.EXPANDED,OutlineTreenode.COLLAPSED].forEach(t=>i.toggle(t)),!0}}return!1}static hastreenode_(t){for(let e=__classPrivateFieldGet(t,_element).firstChild;null!=e;e=e.nextSibling)if(OutlineTreenode.istreenode_(e))return!0;return!1}static setupchild_(t,e=null){const i=e instanceof OutlineTreenode?e:new OutlineTreenode(__classPrivateFieldGet(t,_tree_1),0,e);__classPrivateFieldSet(i,_tree_1,__classPrivateFieldGet(t,_tree_1));const n=__classPrivateFieldGet(t,_indent)+__classPrivateFieldGet(t,_tree_1).tab_();if(__classPrivateFieldGet(i,_indent)!=n){__classPrivateFieldSet(i,_indent,n);const t=OutlineTreenode.getcontrol_(__classPrivateFieldGet(i,_element));null!=t&&(t.style.marginLeft=`${__classPrivateFieldGet(i,_indent)}px`),OutlineTreenode.adjustIndent_(i)}const s=t.control_();if(null!=s){const t=s.classList;t.contains(OutlineTreenode.LEAF)?(t.toggle(OutlineTreenode.LEAF),t.toggle(OutlineTreenode.COLLAPSED),OutlineTreenode.hide_(i)):t.contains(OutlineTreenode.COLLAPSED)?OutlineTreenode.hide_(i):t.contains(OutlineTreenode.EXPANDED)&&OutlineTreenode.show_(i)}return i}}_tree_1=new WeakMap,_element=new WeakMap,_indent=new WeakMap,_populated_1=new WeakMap,_data_1=new WeakMap,OutlineTreenode.SELECTED=CSS.AnTreeSelected,OutlineTreenode.EXPANDED=CSS.AnTreeExpanded,OutlineTreenode.COLLAPSED=CSS.AnTreeCollapsed,OutlineTreenode.LEAF=CSS.AnTreeLeaf;class _Treeroot extends OutlineTreenode{constructor(t,e,i=null){super(t,e,i)}isRoot_(){return!0}}class OutlineTree{constructor(t,e,i=null){this._container=t,_root.set(this,void 0),_tab_1.set(this,void 0),_listeners_1.set(this,[]),_selection_1.set(this,[]),_data_2.set(this,new Map),_nodes_1.set(this,new Map),_touchTimer.set(this,null);const n=new DomBuilderEx(this._container).table1_(CSS.AnTreeTable).tr_().td_().cursor_();__classPrivateFieldSet(this,_root,new _Treeroot(this,null==i?-(e>>1):i,()=>new DomBuilderEx(n).div1_(CSS.AnTreeRoot).push_().div_({class:CSS.AnTreeContent,style:"display:none;"}).span1_(CSS.AnTreeControl,CSS.AnTreeLeaf).siblingAfter_("span",{class:CSS.AnTreeContent}).pop_().cursor_())),__classPrivateFieldSet(this,_tab_1,e),__classPrivateFieldGet(this,_root).element_().classList.add(CSS.AnTreeContainer),__classPrivateFieldGet(this,_root).element_().addEventListener("click",t=>{var e;if(0!=t.button)return;const i=DomUt.asHTMLElement_(t.target);if(null==i)return;const n=i.classList;if(n.contains(CSS.AnTreeControl)){const t=null===(e=i.parentElement)||void 0===e?void 0:e.parentElement;if(null!=t){const e=this.getTreenode_(t);null!=e&&(n.contains(OutlineTreenode.EXPANDED)?e.collapse_():n.contains(OutlineTreenode.COLLAPSED)&&e.expand_())}}else{const e=DomUt.matchingTarget_(t,`div.${CSS.AnTreeNode}`),i=this.getTreenode_(e);if(null!=i){const t=i.toggleSelection_();i.tree_().fireOnSelectionChanged_(i,t)}}An.stopevent_(t)}),An.onTouchStart_(__classPrivateFieldGet(this,_root).element_(),t=>{const e=DomUt.matchingTarget_(t,`div.${CSS.AnTreeNode}`);null!=e&&(null!=__classPrivateFieldGet(this,_touchTimer)&&__classPrivateFieldGet(this,_touchTimer).cancel_(),__classPrivateFieldSet(this,_touchTimer,new Timer(OutlineTree.LONG_PRESS_TIMEOUT,()=>{An.stopevent_(t),null!=e&&this.fireOnDblClick_(e)})))}),An.onTouchEnd_(__classPrivateFieldGet(this,_root).element_(),t=>{null!=DomUt.matchingTarget_(t,`div.${CSS.AnTreeNode}`)&&null!=__classPrivateFieldGet(this,_touchTimer)&&(__classPrivateFieldGet(this,_touchTimer).isActive_()?__classPrivateFieldGet(this,_touchTimer).cancel_():An.stopevent_(t),__classPrivateFieldSet(this,_touchTimer,null))})}destroy_(){null!=__classPrivateFieldGet(this,_root)&&(__classPrivateFieldGet(this,_root).destroy_(),__classPrivateFieldGet(this,_data_2).clear(),__classPrivateFieldGet(this,_nodes_1).clear())}addListener_(t){__classPrivateFieldGet(this,_listeners_1).push(t)}removeListener_(t){const e=__classPrivateFieldGet(this,_listeners_1).indexOf(t);e>=0&&__classPrivateFieldGet(this,_listeners_1).splice(e,1)}root_(){return __classPrivateFieldGet(this,_root)}tab_(){return __classPrivateFieldGet(this,_tab_1)}listeners_(){return __classPrivateFieldGet(this,_listeners_1)}setWidth_(t){if(null!=this._container){const e=this._container.querySelector(`table.${CSS.AnTreeTable} td`);null!=e&&(e.style.minWidth=`${t}px`)}}getSelection_(){return __classPrivateFieldGet(this,_selection_1)}select_(t,e=!1){e||this.deselectAll_(),t.element_().classList.add(OutlineTreenode.SELECTED),__classPrivateFieldGet(this,_selection_1).push(t)}deselect_(t,e=!1){return e?this.deselect1_(t):(this.deselectAll_(),!0)}deselect1_(t){const e=t.element_().classList;return!!e.contains(OutlineTreenode.SELECTED)&&(e.remove(OutlineTreenode.SELECTED),An.identityRemove_(__classPrivateFieldGet(this,_selection_1),t),!0)}toggleSelection_(t){const e=t.element_().classList,i=e.contains(OutlineTreenode.SELECTED);return this.deselectAll_(),i?e.remove(OutlineTreenode.SELECTED):(e.add(OutlineTreenode.SELECTED),__classPrivateFieldGet(this,_selection_1).push(t)),!i}deselectAll_(){for(var t;0!=__classPrivateFieldGet(this,_selection_1).length;)null===(t=__classPrivateFieldGet(this,_selection_1).pop())||void 0===t||t.element_().classList.remove(OutlineTreenode.SELECTED)}removeNode_(t){__classPrivateFieldGet(this,_nodes_1).delete(t)}setNode_(t,e){__classPrivateFieldGet(this,_nodes_1).set(t,e)}getData_(t){return __classPrivateFieldGet(this,_data_2).get(t)}setData_(t,e){__classPrivateFieldGet(this,_data_2).set(t,e)}getTreenode_(t){var e;return null==t?null:null!==(e=__classPrivateFieldGet(this,_nodes_1).get(t))&&void 0!==e?e:null}fireOnDblClick_(t){for(const e of __classPrivateFieldGet(this,_listeners_1)){const i=this.getTreenode_(t);null!=i&&e.onDblClick_(i)}}fireOnSelectionChanged_(t,e){for(const i of __classPrivateFieldGet(this,_listeners_1))i.onSelectionChanged_(t,e)}static lastDescendant_(t){const e=t.lastChild_();return null!=e?OutlineTree.lastDescendant_(e):t}}_root=new WeakMap,_tab_1=new WeakMap,_listeners_1=new WeakMap,_selection_1=new WeakMap,_data_2=new WeakMap,_nodes_1=new WeakMap,_touchTimer=new WeakMap,OutlineTree.LONG_PRESS_TIMEOUT=1e3,OutlineTree.UseVisibilityCollapse=!1;class UIPanelBase{constructor(){this._shown=!1}show_(){this._shown||(this._shown=!0,An.showVisible_(this.element_()))}hide_(){this._shown&&(this._shown=!1,An.hide_(this.element_()))}showContextmenu_(t){An.stopevent_(t)}hideContextmenu_(){}resizeContent_(t){}onWindowSizeChanged_(){}}class _ToasterState{constructor(t=!1){this.showTimer$=null,this.hideTimer$=null,this.tips$=null,this.holding$=!1,this.attop$=!1,this.attop$=t}hide(){return!this.holding$&&this.hide1()}hide1(){return null!=this.showTimer$&&(this.showTimer$.cancel_(),this.showTimer$=null),null!=this.hideTimer$&&(this.hideTimer$.cancel_(),this.hideTimer$=null),null!=this.tips$&&(this.tips$.remove(),this.tips$=null),!0}tips(){return this.tips$}}class Toaster{constructor(t,e,i){_container_1.set(this,void 0),_showDelay.set(this,void 0),_hideDelay.set(this,void 0),_state_1.set(this,null),__classPrivateFieldSet(this,_container_1,t),__classPrivateFieldSet(this,_showDelay,e),__classPrivateFieldSet(this,_hideDelay,i)}infoKey_(t,e){var i,n;this.show1_(CSS.AnToasterInfo,MSG.string_(t),null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!1)}info_(t,e){var i,n;const s=An.getMessage_(t);return null!=s&&(this.show1_(CSS.AnToasterInfo,s,null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!1),!0)}okKey_(t,e){var i,n;this.show1_(CSS.AnToasterOK,MSG.string_(t),null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!1)}ok_(t,e){var i,n;const s=An.getResult_(t);return null!=s&&(this.show1_(CSS.AnToasterOK,s,null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!1),!0)}warnKey_(t,e){var i,n;this.show1_(CSS.AnToasterWarn,MSG.string_(t),null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!0)}warn_(t,e){var i,n;const s=An.getMessage_(t);return null!=s&&(this.show1_(CSS.AnToasterWarn,s,null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!0),!0)}warn0_(t){const e=An.getMessage_(t);return null!=e&&(Timer.sleep0_(()=>{this.show_(CSS.AnToasterWarn,!0,(t,i)=>{null!=e&&(this.text_(i,e),i.push_().div1_(CSS.AnHint).text_(MSG.string_(RS.ToasterHint)).pop_())})}),!0)}errorKey_(t,e){var i,n;this.show1_(CSS.AnToasterError,MSG.string_(t),null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!0)}error_(t,e){var i,n;const s=An.getMessage_(t);return null!=s&&(this.show1_(CSS.AnToasterError,s,null===(i=null==e?void 0:e.attop)||void 0===i||i,null!==(n=null==e?void 0:e.hold)&&void 0!==n&&n,!0),!0)}text_(t,e){if(e instanceof Array){t.push_().ul1_(CSS.AnNone).push_();for(let i=0;i<e.length;++i)t.peek_().li_().text_(e[i]);t.pop_(2)}else this.textText_(t,e.toString())}textText_(t,e){t.push_().div_().text_(e).pop_()}showInfo_(t,e=!0){this.show_(CSS.AnToasterInfo,e,t)}showWarn_(t,e=!0){this.show_(CSS.AnToasterWarn,e,t)}showError_(t,e=!0){this.show_(CSS.AnToasterError,e,t)}show1_(t,e,i,n,s){this.show_(t,i,(i,o)=>{if(this.text_(o,e),s){let e=t==CSS.AnToasterError?{class:CSS.AnHint,style:"color:#eee;"}:{class:CSS.AnHint};o.push_().div_(e).text_(MSG.string_(RS.ToasterHint)).pop_()}n&&this.onhold_()})}show_(t,e,i){let n=__classPrivateFieldGet(this,_state_1),s=new _ToasterState(e);s.showTimer$=new Timer(__classPrivateFieldGet(this,_showDelay),()=>{if(null!=n&&(n.hide(),n=null),null==s)return;const o=new DomBuilderEx(__classPrivateFieldGet(this,_container_1)),l=o.div1_(CSS.AnToaster,t,e?CSS.AnToasterTop:CSS.AnToasterBottom).cursor_();s.tips$=l,l.style.visibility="hidden",l.style.display="block",null!=i&&i(this,o);const a=l.getBoundingClientRect(),r=(window.innerWidth-Math.round(a.width))/2;if(l.style.left=`${r}px`,e)l.style.top="0px";else{const t=window.innerHeight-Math.round(a.height);l.style.top=`${t}px`}l.style.visibility="visible",l.addEventListener("click",t=>{An.stopevent_(t),null!=s&&(s.holding$?Toaster.unhold1_(s):Toaster.onhold1_(s))}),__classPrivateFieldGet(this,_hideDelay)>0&&(s.hideTimer$=new Timer(__classPrivateFieldGet(this,_hideDelay),()=>{null!=s&&s.hide()&&(s=null)}))}),__classPrivateFieldSet(this,_state_1,s)}unhold_(){null!=__classPrivateFieldGet(this,_state_1)&&Toaster.unhold1_(__classPrivateFieldGet(this,_state_1))}static unhold1_(t){t.holding$=!1,t.hide()}onhold_(){null!=__classPrivateFieldGet(this,_state_1)&&Toaster.onhold1_(__classPrivateFieldGet(this,_state_1))}static onhold1_(t){t.holding$=!0;const e=t.tips$;if(null!=e){let i=e.querySelector(`.${CSS.AnHint}`);null==i&&(i=new DomBuilderEx(e).div_({class:CSS.AnHint}).cursor_()),i.textContent=MSG.string_(RS.ToasterHolding),Toaster.resize_(t,e)}}static resize_(t,e){const i=e.getBoundingClientRect(),n=(window.innerWidth-Math.round(i.width))/2;if(e.style.left=`${n}px`,!t.attop$){const t=window.innerHeight-Math.round(i.height);e.style.top=`${t}px`}}hide_(){null!=__classPrivateFieldGet(this,_state_1)&&__classPrivateFieldGet(this,_state_1).hide()&&__classPrivateFieldSet(this,_state_1,null)}tips_(){return null!=__classPrivateFieldGet(this,_state_1)?__classPrivateFieldGet(this,_state_1).tips():null}onResize_(){if(null!=__classPrivateFieldGet(this,_state_1)){const t=__classPrivateFieldGet(this,_state_1).tips();if(null!=t){const e=t.getBoundingClientRect(),i=(window.innerWidth-Math.round(e.width))/2;if(t.style.left=`${i}px`,!__classPrivateFieldGet(this,_state_1).attop$){const i=window.innerHeight-Math.round(e.height);t.style.top=`${i}px`}}}}}_container_1=new WeakMap,_showDelay=new WeakMap,_hideDelay=new WeakMap,_state_1=new WeakMap;class Toasters{constructor(t){_infoToaster.set(this,void 0),_warnToaster.set(this,void 0),_errorToaster.set(this,void 0),_modalToaster.set(this,void 0),this.onTooltipsKey_=(t,e)=>{An.stopevent_(e);const i=t.getAttribute(ATTR.xTooltips);null!=i&&i.startsWith("X")&&this.infoKey_(i,{attop:!0})},__classPrivateFieldSet(this,_infoToaster,new Toaster(t,0,5e3)),__classPrivateFieldSet(this,_warnToaster,new Toaster(t,0,7500)),__classPrivateFieldSet(this,_errorToaster,new Toaster(t,0,3e4)),__classPrivateFieldSet(this,_modalToaster,new Toaster(t,0,0))}unholdAll_(){__classPrivateFieldGet(this,_infoToaster).unhold_(),__classPrivateFieldGet(this,_warnToaster).unhold_(),__classPrivateFieldGet(this,_errorToaster).unhold_(),__classPrivateFieldGet(this,_modalToaster).unhold_()}hideAll_(){__classPrivateFieldGet(this,_infoToaster).hide_(),__classPrivateFieldGet(this,_warnToaster).hide_(),__classPrivateFieldGet(this,_errorToaster).hide_(),__classPrivateFieldGet(this,_modalToaster).unhold_()}onResize_(){__classPrivateFieldGet(this,_infoToaster).onResize_(),__classPrivateFieldGet(this,_warnToaster).onResize_(),__classPrivateFieldGet(this,_errorToaster).onResize_(),__classPrivateFieldGet(this,_modalToaster).onResize_()}hideModal_(){__classPrivateFieldGet(this,_modalToaster).unhold_()}hideInfo_(){__classPrivateFieldGet(this,_infoToaster).hide_()}hideWarn_(){__classPrivateFieldGet(this,_warnToaster).hide_()}toastElement_(t,e){if(null!=t){const i=t.nodeName;An.isBodyElement_(i)?this.info_("<"+i+">"):(null==e&&(e=DEF.maxToastLen),this.info_(An.truncate_("<"+i+An.elementInfo_(t)+"...>",e)))}}toastNode_(t,e){if(null!=t){t.nodeType==Node.ELEMENT_NODE?this.toastElement_(t,e):(null==e&&(e=DEF.maxToastLen),this.info_(An.truncate_(t.textContent,e)))}}toastResult_(t){if(this.error_(t))return!1;const e=t[Key.result];return null!=e&&this.ok_(e),!0}toastErrors_(t){this.warn_(t[Key.errors])}modal_(t){__classPrivateFieldGet(this,_modalToaster).unhold_(),__classPrivateFieldGet(this,_modalToaster).show_(CSS.AnToasterModal,!0,(e,i)=>{const n=new Smokescreen(document.body,DEF.zindexToaster-1).on_("click",t=>{An.stopevent_(t),n.destroy_(),__classPrivateFieldGet(this,_modalToaster).unhold_()}).show_();t(e,i),e.onhold_()})}show_(t,e,i){return __classPrivateFieldGet(this,_infoToaster).show_(t,e,i),__classPrivateFieldGet(this,_infoToaster)}infoKey_(t,e){return __classPrivateFieldGet(this,_infoToaster).infoKey_(t,e),__classPrivateFieldGet(this,_infoToaster)}info_(t,e){return __classPrivateFieldGet(this,_infoToaster).info_(t,e)}okKey_(t,e){return __classPrivateFieldGet(this,_infoToaster).okKey_(t,e),__classPrivateFieldGet(this,_infoToaster)}ok_(t,e){return __classPrivateFieldGet(this,_infoToaster).ok_(t,e)}warnKey_(t,e){return __classPrivateFieldGet(this,_warnToaster).warnKey_(t,e),__classPrivateFieldGet(this,_warnToaster)}warn_(t,e){return __classPrivateFieldGet(this,_warnToaster).warn_(t,e)}warn0_(t,e){return null!=(t=An.getMessage_(t))&&(Timer.sleep0_(()=>{__classPrivateFieldGet(this,_warnToaster).warn_(t,e)}),!0)}warnAll_(t,e){if(null==t)return!1;let i=!1;for(const n of t)this.warn_(n,e)&&(i=!0);return i}errorKey_(t,e){__classPrivateFieldGet(this,_errorToaster).errorKey_(t,e)}error_(t,e){return __classPrivateFieldGet(this,_errorToaster).error_(t,e)}warnErrorsOrOKKey_(t,e){this.error_(t)||this.okKey_(e,{attop:!0})}warnErrorsOrResult_(t,e=null){this.error_(t)||this.ok_(t[Key.result],{attop:!0})||null!=e&&this.okKey_(e,{attop:!0})}}_infoToaster=new WeakMap,_warnToaster=new WeakMap,_errorToaster=new WeakMap,_modalToaster=new WeakMap;class ToasterInfoBuilder{constructor(t,e){this._toaster=t,this._b=e}build_(t){this._b.push_().div1_(CSS.AnViewport).table1_(CSS.AnToaster).push_(),t(this),this._b.pop_().up_().div1_(CSS.AnHint).pop_()}trKey_(t,e){null!=e&&this._b.peek_().tr_().push_().td_().text_(MSG.string_(t)).pop_().td_().text_(""+e)}tr_(t,e){null!=e&&this._b.peek_().tr_().push_().td_().text_(t).pop_().td_().text_(""+e)}tr1_(t,e){this._b.peek_().tr_().td_(e).text_(t)}}class ImageInfoBuilder extends ToasterInfoBuilder{constructor(t,e,i,n){super(t,e),_dateFormat_1.set(this,void 0),_info_1.set(this,void 0),__classPrivateFieldSet(this,_dateFormat_1,i),__classPrivateFieldSet(this,_info_1,n)}build_(){var t;const e=__classPrivateFieldGet(this,_info_1).width_(),i=__classPrivateFieldGet(this,_info_1).height_(),n=__classPrivateFieldGet(this,_info_1).rotation_(),s=__classPrivateFieldGet(this,_info_1).isVideo_(),o=__classPrivateFieldGet(this,_info_1).creationDate_(),l=__classPrivateFieldGet(this,_info_1).duration1_(0),a=Math.floor(1e3*l);let r;r=null!=o?DateTime.fromMillisecondsSinceEpoch_(o-a,!0):DateTime.fromMillisecondsSinceEpoch_((null!==(t=__classPrivateFieldGet(this,_info_1).fileDate_())&&void 0!==t?t:a)-a,!1),super.build_(()=>{var t,o,a,_;this.trKey_(RS.Title,null!==(t=__classPrivateFieldGet(this,_info_1).title_())&&void 0!==t?t:""),this.trKey_(RS.Description,__classPrivateFieldGet(this,_info_1).description_()),this.trKey_(RS.URL,null!==(o=__classPrivateFieldGet(this,_info_1).uri_())&&void 0!==o?o:""),this.trKey_(RS.Mime,null!==(a=__classPrivateFieldGet(this,_info_1).mime_())&&void 0!==a?a:""),this.trKey_(RS.Date,DateFormat.dateString(__classPrivateFieldGet(this,_dateFormat_1),r)),this.trKey_(RS.Size,`${An.filesizeUnit4_(null!==(_=__classPrivateFieldGet(this,_info_1).fileSize_())&&void 0!==_?_:0)}`),this.trKey_(RS.Dimension,`${e}x${i}`),s?this.trKey_(RS.Duration,`${l}s`):this.trKey_(RS.Orientation,null==n?"":`${n}`)})}}_dateFormat_1=new WeakMap,_info_1=new WeakMap;class Smokescreen{constructor(t,e=null,i=null){_container_2.set(this,null),_zindex_1.set(this,void 0),_opacity_1.set(this,void 0),_bgColor_1.set(this,null),_element_1.set(this,null),_handlers.set(this,new Map),_subscriptions_1.set(this,[]),_isShown_1.set(this,!1),__classPrivateFieldSet(this,_container_2,t),__classPrivateFieldSet(this,_zindex_1,null!=e?e:An.zindexOf_(t,DEF.zindexUnder,DEF.zindexPrompt+DEF.zindexUnder)),__classPrivateFieldSet(this,_opacity_1,null!=i?i:0)}static liveCount(){return Smokescreen._liveCount}container_(){return __classPrivateFieldGet(this,_container_2)}zindex_(t){return null!=t&&__classPrivateFieldSet(this,_zindex_1,t),__classPrivateFieldGet(this,_zindex_1)}above_(t,e=DEF.zindexAbove10){this.zindex_(An.zindexOf_(t,e,DEF.zindexPrompt+e))}opacity_(t){return null!=t&&__classPrivateFieldSet(this,_opacity_1,t),__classPrivateFieldGet(this,_opacity_1)}bgcolor_(t){__classPrivateFieldSet(this,_bgColor_1,t)}on_(t,e){return __classPrivateFieldGet(this,_handlers).set(t,e),this}trap_(t){var e;null===(e=__classPrivateFieldGet(this,_element_1))||void 0===e||e.addEventListener(t,t=>{An.stopevent_(t)})}element_(){return __classPrivateFieldGet(this,_element_1)}show_(t=null){return this._showitnow(),null!=t&&t(this),this}hide_(){return this._hide()}_hide(){var t;return!!__classPrivateFieldGet(this,_isShown_1)&&(__classPrivateFieldSet(this,_isShown_1,!1),--Smokescreen._liveCount,An.cancelSubscriptions_(__classPrivateFieldGet(this,_subscriptions_1)),null===(t=__classPrivateFieldGet(this,_element_1))||void 0===t||t.remove(),!0)}destroy_(){null!=__classPrivateFieldGet(this,_container_2)&&(this._hide(),__classPrivateFieldGet(this,_handlers).clear(),__classPrivateFieldSet(this,_container_2,null))}_showitnow(){var t;if(__classPrivateFieldGet(this,_isShown_1)||null==__classPrivateFieldGet(this,_container_2))return!1;__classPrivateFieldSet(this,_isShown_1,!0),__classPrivateFieldSet(this,_element_1,new DomBuilderEx(__classPrivateFieldGet(this,_container_2)).div1_(CSS.AnSmokescreen).cursor_()),++Smokescreen._liveCount;const e=__classPrivateFieldGet(this,_element_1).style;e.zIndex=`${__classPrivateFieldGet(this,_zindex_1)}`,e.opacity=`${__classPrivateFieldGet(this,_opacity_1)}`,null!=__classPrivateFieldGet(this,_bgColor_1)&&(e.backgroundColor=__classPrivateFieldGet(this,_bgColor_1).toCSSString_()),e.display="block",e.pointerEvents="auto";for(const e of __classPrivateFieldGet(this,_handlers).keys()){const i=null!==(t=__classPrivateFieldGet(this,_handlers).get(e))&&void 0!==t?t:null;null!=i&&__classPrivateFieldGet(this,_subscriptions_1).push(An.subscriptEvent_(__classPrivateFieldGet(this,_element_1),e,t=>i(t)))}return!0}}_container_2=new WeakMap,_zindex_1=new WeakMap,_opacity_1=new WeakMap,_bgColor_1=new WeakMap,_element_1=new WeakMap,_handlers=new WeakMap,_subscriptions_1=new WeakMap,_isShown_1=new WeakMap,Smokescreen._liveCount=0;class Spinner extends Smokescreen{constructor(t){super(t,DEF.zindexMax,DEF.opacitySmoke),_count_1.set(this,0),_showTimer.set(this,null)}show_(t=null){if(__classPrivateFieldSet(this,_count_1,+__classPrivateFieldGet(this,_count_1)+1),1==__classPrivateFieldGet(this,_count_1)){if(DateTime.now_().millisecondsSinceEpoch$,null!=__classPrivateFieldGet(this,_showTimer))return this;__classPrivateFieldSet(this,_showTimer,new Timer(DEFUtil.showSpinnerDelay$,()=>{__classPrivateFieldSet(this,_showTimer,null),super.show_(t=>{const e=null==t?void 0:t.element_();null!=e&&(e.style.display="flex",new DomBuilderEx(e).append_("div",{class:CSS.AnSpinner}))})}))}return null==t||t(this),this}hide_(){return __classPrivateFieldSet(this,_count_1,+__classPrivateFieldGet(this,_count_1)-1),0==__classPrivateFieldGet(this,_count_1)&&(this.destroy_(),!0)}destroy_(){null!=__classPrivateFieldGet(this,_showTimer)&&(__classPrivateFieldGet(this,_showTimer).cancel_(),__classPrivateFieldSet(this,_showTimer,null)),null!=this.container_()&&super.destroy_()}}_count_1=new WeakMap,_showTimer=new WeakMap;class Flash{constructor(t,e,i,n){_element_2.set(this,void 0),_selector.set(this,void 0),_style_1.set(this,void 0),_duration_1.set(this,void 0),_subscription_1.set(this,void 0),_onCallback.set(this,null),_offCallback.set(this,null),_timer_1.set(this,null),__classPrivateFieldSet(this,_element_2,t),__classPrivateFieldSet(this,_selector,e),__classPrivateFieldSet(this,_style_1,i),__classPrivateFieldSet(this,_duration_1,n),__classPrivateFieldSet(this,_subscription_1,An.subscriptEvent_(t,Conf.touchstart,t=>this.handler_(t)))}flashOn_(t){t.classList.add(__classPrivateFieldGet(this,_style_1)),null!=__classPrivateFieldGet(this,_onCallback)&&__classPrivateFieldGet(this,_onCallback).call(this,t),__classPrivateFieldSet(this,_element_2,t),__classPrivateFieldSet(this,_timer_1,new Timer(__classPrivateFieldGet(this,_duration_1),()=>{this.flashOff_()}))}flashOff_(){__classPrivateFieldGet(this,_element_2).classList.remove(__classPrivateFieldGet(this,_style_1)),null!=__classPrivateFieldGet(this,_offCallback)&&__classPrivateFieldGet(this,_offCallback).call(this,__classPrivateFieldGet(this,_element_2)),__classPrivateFieldSet(this,_timer_1,null)}onOn_(t){__classPrivateFieldSet(this,_onCallback,t)}onOff_(t){__classPrivateFieldSet(this,_offCallback,t)}handler_(t){const e=DomUt.asHTMLElement_(null!=__classPrivateFieldGet(this,_selector)?DomUt.matchingTarget_(t,__classPrivateFieldGet(this,_selector)):t.target);null==e||e.classList.contains(CSS.AnDisabled)||(null!=__classPrivateFieldGet(this,_timer_1)&&(__classPrivateFieldGet(this,_timer_1).cancel_(),this.flashOff_()),this.flashOn_(e))}destroy_(){null!=__classPrivateFieldGet(this,_timer_1)&&(__classPrivateFieldGet(this,_timer_1).cancel_(),this.flashOff_(),__classPrivateFieldSet(this,_timer_1,null)),null!=__classPrivateFieldGet(this,_subscription_1)&&(__classPrivateFieldGet(this,_subscription_1).cancel_(),__classPrivateFieldSet(this,_subscription_1,null),__classPrivateFieldSet(this,_onCallback,null),__classPrivateFieldSet(this,_offCallback,null))}}_element_2=new WeakMap,_selector=new WeakMap,_style_1=new WeakMap,_duration_1=new WeakMap,_subscription_1=new WeakMap,_onCallback=new WeakMap,_offCallback=new WeakMap,_timer_1=new WeakMap;class Spotlight{constructor(t,e=DEFUtil.spotlightDuration$,i=null){_container_3.set(this,void 0),_duration_2.set(this,DEFUtil.spotlightDuration$),_color_1.set(this,null),_spotlight_1.set(this,void 0),_timer_2.set(this,null),__classPrivateFieldSet(this,_container_3,t),__classPrivateFieldSet(this,_duration_2,e),__classPrivateFieldSet(this,_color_1,i),__classPrivateFieldSet(this,_spotlight_1,new DomBuilderEx(__classPrivateFieldGet(this,_container_3)).div1_(CSS.AnSpotlight).cursor_()),__classPrivateFieldGet(this,_spotlight_1).style.display="none"}show_(t,e,i,n,s=null){null!=__classPrivateFieldGet(this,_timer_2)&&(__classPrivateFieldGet(this,_timer_2).cancel_(),__classPrivateFieldSet(this,_timer_2,null));const o=__classPrivateFieldGet(this,_spotlight_1).style;o.left=`${t}px`,o.top=`${e}px`,o.width=`${i}px`,o.height=`${n}px`,null!=__classPrivateFieldGet(this,_color_1)&&(o.backgroundColor=__classPrivateFieldGet(this,_color_1)),o.display="block",__classPrivateFieldSet(this,_timer_2,new Timer(__classPrivateFieldGet(this,_duration_2),()=>{null!=s?s():this.destroy_()}))}hide_(){null!=__classPrivateFieldGet(this,_timer_2)&&(__classPrivateFieldGet(this,_timer_2).cancel_(),__classPrivateFieldSet(this,_timer_2,null)),__classPrivateFieldGet(this,_spotlight_1).style.display="none"}destroy_(){this.hide_(),__classPrivateFieldGet(this,_spotlight_1).remove()}}_container_3=new WeakMap,_duration_2=new WeakMap,_color_1=new WeakMap,_spotlight_1=new WeakMap,_timer_2=new WeakMap;class _TabInfo{constructor(t,e,i,n=!0){this.tab=t,this.panel=e,this.panelObject=i,this.enabled=n}}class TabPanel{constructor(t,e=!1){this._container=t,this._tabs=[],this._infos=new Map,this._tooltipsCallback=null,this._onTabChangedCallback=null,this._onTabClickedCallback=null,this._tooltipsTimer=null,this._tooltipsShown=!1,this._activeInfo=null;const i=new DomBuilderEx(this._container).push_();e?(this._tabContainer=i.peek_().div1_(CSS.AnTabPanelContainer).cursor_(),this._tabBar=i.peek_().div1_(CSS.AnTabbarAtBottom).cursor_()):(this._tabBar=i.peek_().div1_(CSS.AnTabbar).cursor_(),this._tabContainer=i.peek_().div1_(CSS.AnTabPanelContainer).cursor_()),An.addClickListenerMatching_(this._tabBar,`div.${CSS.AnTab}`,(t,e)=>{var i,n;const s=t;if(null!=this._onTabClickedCallback){const t=null!==(i=this._infos.get(s))&&void 0!==i?i:null;null!==(n=null==t?void 0:t.enabled)&&void 0!==n&&n&&this._onTabClickedCallback(s,this._tabs.indexOf(s))}this.selectTab(s),An.stopevent_(e)}),An.onTouchStart_(this._tabBar,t=>{const e=DomUt.matchingTarget_(t,`span[${ATTR.xTooltips}]`);null!=e&&(this._stopTooltipsTimer(),this._tooltipsShown=!1,this._tooltipsTimer=new Timer(DEFUtil.durationTooltips$,()=>{this._tooltipsTimer=null,this._tooltipsShown=!0,null!=this._tooltipsCallback&&this._tooltipsCallback(e,t)}))}),An.onTouchEnd_(this._tabBar,t=>{this._stopTooltipsTimer(),this._tooltipsShown&&(this._tooltipsShown=!1,An.stopevent_(t))}),Conf.useFlash&&new Flash(this._tabBar,`div.${CSS.AnTab}`,CSS.AnFlashLowlight,DEFUtil.flashDuration)}onWindowSizeChanged(){for(const t of this._infos.values())t.panelObject.onWindowSizeChanged_()}activeTab(t=null){var e;if(null==t)return null==this._activeInfo?null:this._activeInfo.tab;const i=null!==(e=this._infos.get(t))&&void 0!==e?e:null;return Assert.assertion_(null!=i,t.id),null!=this._activeInfo&&this._activeInfo.tab.classList.remove(CSS.AnSelected),t.classList.add(CSS.AnSelected),this._activeInfo=i,t}tabBar(){return this._tabBar}_stopTooltipsTimer(){null!=this._tooltipsTimer&&(this._tooltipsTimer.cancel_(),this._tooltipsTimer=null)}onTooltips(t){this._tooltipsCallback=t}onTabChanged(t){this._onTabChangedCallback=t}onTabClicked(t){this._onTabClickedCallback=t}activePanel(){return null==this._activeInfo?null:this._activeInfo.panelObject}_addtab(t,e){const i=new DomBuilderEx(this._tabBar).div_({class:CSS.AnTab}).cursor_(),n=new DomBuilderEx(this._tabContainer).div_({style:"display: none; overflow: hidden;"}).cursor_();t(i);const s=new _TabInfo(i,n,e(n));return this._infos.set(i,s),this._tabs.push(i),i}addTab(t,e,i){return this._addtab(i=>{new DomBuilderEx(i).append_("span",smap_(["class",e],[ATTR.xTooltips,t]))},i)}selectTabAt(t){return t>=0&&t<this._tabs.length?this.selectTab(this._tabs[t]):null}selectTab(t){var e,i;const n=null==t?null:this._infos.get(t);return null==n||this._selecttab(n),null!==(i=null===(e=this._activeInfo)||void 0===e?void 0:e.panelObject)&&void 0!==i?i:null}enableTab(t){const e=this._infos.get(t);return null!=e&&!e.enabled&&(e.enabled=!1,e.tab.classList.remove("disabled"),!0)}enableTabAt(t){const e=this.getTabAt(t);return null!=e&&this.enableTab(e)}disableTab(t){const e=this._infos.get(t);return!(null==e||!e.enabled)&&(e.enabled=!1,e.tab.classList.add("disabled"),!0)}disableTabAt(t){const e=this.getTabAt(t);return null!=e&&this.disableTab(e)}getTabs(){return this._infos.keys()}getPanel(t){var e;const i=this._infos.get(t);return null!==(e=null==i?void 0:i.panelObject)&&void 0!==e?e:null}getTabAt(t){return t<0||t>=this._infos.size?null:new Array(...this.getTabs())[t]}getPanelAt(t){const e=this.getTabAt(t);return null==e?null:this.getPanel(e)}resizeContent1(t,e){const i=t-e;for(const t of this._infos.values())t.panel.style.height=`${i}px`,t.panelObject.resizeContent_(i)}_selecttab(t){if(null==t||!t.enabled)return;const e=null==this._activeInfo||this._activeInfo.tab!==t.tab;null!=this._activeInfo&&this._activeInfo.tab!==t.tab&&(this._activeInfo.tab.classList.remove(CSS.AnSelected),this._activeInfo.panel.style.display="none",this._activeInfo.panelObject.hide_()),this._activeInfo=t,this._activeInfo.tab.classList.add(CSS.AnSelected),this._activeInfo.panelObject.show_(),this._activeInfo.panel.style.display="block",null!=this._onTabChangedCallback&&e&&this._onTabChangedCallback(t.tab,this._tabs.indexOf(t.tab))}}class DraggerState{constructor(){this.active=!1,this.moved=!1,this.serial=0,this.id=0,this.x=0,this.y=0,this.cx=0,this.cy=0,this.touches=0,this.pointers=[]}}class DumbDraggerHandler{onDragstart_(t,e,i,n){return t.element_()===e}onDragmove_(t){}onDragend_(t,e){}}DumbDraggerHandler.singleton=new DumbDraggerHandler;class DefaultDraggerHandler{constructor(t=null){this._left=0,this._top=0,this._dragstartCallback=null!=t?t:(t,e)=>t.element_()===e}onDragstart_(t,e,i,n){const s=this._dragstartCallback(t,e,i,n),o=DomUt.asHTMLElement_(e);if(null==o)return!1;if(s){const t=An.documentOffset_(o);this._left=t.x,this._top=t.y}return s}onDragmove_(t){const e=t.state_(),i=t.target_().style;i.left=`${this._left+e.cx}px`,i.top=`${this._top+e.cy}px`}onDragend_(t,e){}destroy(){this._dragstartCallback=An.predicate0_}}class VerticalDraggerHandler{constructor(t=null){this._top=0,this._dragstartCallback=null!=t?t:(t,e)=>t.element_()===e}onDragstart_(t,e,i,n){const s=this._dragstartCallback(t,e,i,n),o=DomUt.asHTMLElement_(e);if(null==o)return!1;if(s){const t=An.documentOffset_(o);this._top=t.y}return s}onDragmove_(t){t.target_().style.top=`${this._top+t.state_().cy}px`}onDragend_(t,e){}destroy(){this._dragstartCallback=An.predicate0_}}class Dragger{constructor(t,e,i=null){this._target=t,this._handler=e,this._state=new DraggerState,this._startHandler=null,this._dragStartCallback=null,this._dragmoveHandlers=[],this._dragcancelHandlers=[],this._threshold=Dragger.THRESHOLD,Assert.assertion_(null!=e),null==i&&(i=new FrameLimiter(2)),this._rateLimiter=i}onDragStart_(t){this._dragStartCallback=t}element_(){return this._target}state_(){return this._state}target_(){return this._target}rateLimit_(t){return this._rateLimiter=t,this}threshold_(t){return this._threshold=t,this}bind_(){return Conf.isMobile?this._installTouchHandlers():this._installMouseHandlers(),this}unbind_(){null!=this._startHandler&&(An.cancelSubscriptions_(this._dragcancelHandlers),An.cancelSubscriptions_(this._dragmoveHandlers),this._startHandler.cancel_(),this._startHandler=null)}destroy_(){this.unbind_(),this._dragStartCallback=null,this._handler=DumbDraggerHandler.singleton,this._rateLimiter=NoLimiter.singleton}_installTouchHandlers(){this._startHandler=An.subscriptEvent_(this._target,Events.touchstart,t=>{var e;const i=t,n=i.changedTouches;if(n.length>0){this._state.touches=i.touches.length,this._state.pointers=[];for(const t of new ItemsIterable(i.touches))this._state.pointers.push(t.pageX),this._state.pointers.push(t.pageY);const t=n[0];if(!this._dragstart(t.target,t.pageX,t.pageY))return;An.stopevent_(i),this._state.id=t.identifier,this._dragmoveHandlers.push(An.subscriptEvent_(document,Events.touchmove,t=>{this._touchmove(t)})),this._dragcancelHandlers.push(An.subscriptEvent_(this._target,Events.touchend,t=>{this._touchcancel(t)})),this._dragcancelHandlers.push(An.subscriptEvent_(this._target,Events.touchcancel,t=>{this._touchcancel(t)})),null===(e=this._dragStartCallback)||void 0===e||e.call(this)}})}_touchmove(t){if(2==t.touches.length){An.stopevent_(t),this._state.touches=t.touches.length,this._state.pointers=[];for(const e of new ItemsIterable(t.touches))this._state.pointers.push(e.pageX),this._state.pointers.push(e.pageY);for(const e of new ItemsIterable(t.changedTouches))if(null!=e&&e.identifier==this._state.id){An.stopevent_(t);const i=e.pageX,n=e.pageY,s=i-this._state.x,o=n-this._state.y;this._state.x=i,this._state.y=n,this._state.cx+=s,this._state.cy+=o;break}this._state.moved||(this._state.moved=!0,An.cancelSubscriptions_(this._dragcancelHandlers),this._dragmoveHandlers.push(An.subscriptEvent_(document,Events.touchend,t=>{this._touchend(t)})),this._dragmoveHandlers.push(An.subscriptEvent_(document,Events.touchcancel,t=>{this._touchend(t)}))),this._onmove()}else for(const e of new ItemsIterable(t.changedTouches))if(null!=e&&e.identifier==this._state.id){An.stopevent_(t);const i=e.pageX,n=e.pageY,s=i-this._state.x,o=n-this._state.y;(0!=n&&(o>this._threshold||o<-this._threshold)||0!=i&&(s>this._threshold||s<-this._threshold))&&(this._state.moved||(this._state.moved=!0,An.cancelSubscriptions_(this._dragcancelHandlers),this._dragmoveHandlers.push(An.subscriptEvent_(document,Events.touchend,t=>{this._touchend(t)})),this._dragmoveHandlers.push(An.subscriptEvent_(document,Events.touchcancel,t=>{this._touchend(t)}))),this._state.x=i,this._state.y=n,this._state.cx+=s,this._state.cy+=o,this._onmove());break}}_touchcancel(t){for(const e of new ItemsIterable(t.changedTouches))if(null!=e&&e.identifier==this._state.id){this._state.active&&!this._state.moved&&(this._state.x=e.pageX,this._state.y=e.pageY,this._cancel(t));break}}_touchend(t){for(const e of new ItemsIterable(t.changedTouches))if(null!=e&&e.identifier==this._state.id){An.stopevent_(t),An.cancelSubscriptions_(this._dragmoveHandlers),An.cancelSubscriptions_(this._dragcancelHandlers),this._state.x=e.pageX,this._state.y=e.pageY,this._state.active=!1,this._onend(t);break}}_installMouseHandlers(){this._startHandler=An.subscriptEvent_(this._target,Events.mousedown,t=>{const e=t,i=Math.round(e.pageX),n=Math.round(e.pageY);e.shiftKey?(this._state.touches=3,this._state.pointers=[i,n,i,n,i,n]):e.ctrlKey?(this._state.touches=2,this._state.pointers=[i,n,i,n]):(this._state.touches=1,this._state.pointers=[i,n]),null!=e.target&&this._dragstart(e.target,i,n)&&(this._dragmoveHandlers.push(An.subscriptEvent_(document,Events.mousemove,t=>{this._mousemove(t)})),this._dragcancelHandlers.push(An.subscriptEvent_(this._target,Events.mouseup,t=>{this._mousecancel(t)})))})}_mousemove(t){const e=Math.round(t.pageX),i=Math.round(t.pageY),n=e-this._state.x,s=i-this._state.y;(0!=i&&(s>this._threshold||s<-this._threshold)||0!=e&&(n>this._threshold||n<-this._threshold))&&(this._state.moved||(this._state.moved=!0,An.cancelSubscriptions_(this._dragcancelHandlers),this._dragmoveHandlers.push(An.subscriptEvent_(document,Events.mouseup,t=>{this._mouseup(t)}))),t.shiftKey?(this._state.touches=3,this._state.pointers=[e,i,e,i,e,i]):t.ctrlKey?(this._state.touches=2,this._state.pointers.length>=2?this._state.pointers=[this._state.pointers[0],this._state.pointers[1],e,i]:this._state.pointers=[e,i,e,i]):(this._state.touches=1,this._state.pointers=[e,i]),this._state.x=e,this._state.y=i,this._state.cx+=n,this._state.cy+=s,this._onmove()),An.stopevent_(t)}_mousecancel(t){this._state.active&&!this._state.moved&&(this._state.x=Math.round(t.pageX),this._state.y=Math.round(t.pageY),this._cancel(t))}_mouseup(t){An.cancelSubscriptions_(this._dragcancelHandlers),An.cancelSubscriptions_(this._dragmoveHandlers),this._state.x=Math.round(t.pageX),this._state.y=Math.round(t.pageY),this._state.active=!1,this._onend(t),An.stopevent_(t)}_onmove(){this._rateLimiter.queue_((t,e)=>{null!=this._handler&&this._handler.onDragmove_(this)})}_onend(t){this._rateLimiter.queue_((e,i)=>{null!=this._handler&&this._handler.onDragend_(this,t)})}_dragstart(t,e,i){return!!this._handler.onDragstart_(this,t,e,i)&&(this._state.serial=0,this._state.x=e,this._state.y=i,this._state.cx=0,this._state.cy=0,this._state.moved=!1,this._state.active=!0,!0)}_cancel(t){An.cancelSubscriptions_(this._dragcancelHandlers),An.cancelSubscriptions_(this._dragmoveHandlers),this._state.active=!1,this._onend(t)}}Dragger.THRESHOLD=3,Dragger.SCROLL_THRESHOLD=5;class SliderDragger{constructor(t,e,i,n,s,o){this._slider=t,this._handle=e,this._rangepx=i,this._step=n,this._handleOffset=s,this._vertical=o,this._dh=0,this._h=0,this._dragCallback=null,this._clickCallback=null,this._dragger=new Dragger(t,this).bind_()}onDragstart_(t,e,i,n){return this._slider===e||this._handle===e}onDragmove_(t){const e=t.state_(),i=this._vertical?e.cy:e.cx,n=i-this._h;(this._dh>0&&n<0||this._dh<0&&n>0)&&(this._dh=0),this._dh+=n;let s=0;this._dh>this._step?(s=1,this._dh=this._dh-this._step):this._dh<-this._step&&(s=-1,this._dh=this._dh+this._step),0!=s&&null!=this._dragCallback&&(this._h=i,this._dragCallback(s))}onDragend_(t,e){this._h=0;const i=t.state_();if(!i.moved&&null!=this._clickCallback){const t=An.documentOffset_(this._slider),n=Math.floor(this._vertical?i.y-t.y-this._handleOffset:i.x-t.x-this._handleOffset),s=Math.floor(Math.max(0,Math.min(this._rangepx,n)));null!=this._clickCallback&&(An.stopevent_(e),this._clickCallback(s))}}onDrag_(t){this._dragCallback=t}onClick_(t){this._clickCallback=t}destroy_(){this._dragger.destroy_()}}class Slider{constructor(t,e,i,n,s,o){this._container=t,this._major=e,this._halfMinor=i,this._step=n,this._handleOffset=s,this._vertical=o;const l=new DomBuilderEx(this._container).push_(),a=this._halfMinor,r=2*a;let _,c,h="left",u="top",d=0;this._vertical?(_=r,c=this._major):(_=this._major,c=r,h="top",u="left",d=0),this._top=l.peek_().div_({class:CSS.AnSlider,style:`flex:0 0 ${_}px;height:${c}px;border-radius:${a}px;`}).push_().cursor_(),this._slider=this._top,this._handle=l.pop_().div_({class:CSS.AnSliderHandle,style:`${h}:${d}px;${u}:${d}px;`+`width:${r}px;height:${r}px;border-radius:${a}px;`}).cursor_(),this._dragger=new SliderDragger(this._slider,this._handle,this.range_(),this._step,this._handleOffset,this._vertical)}onDrag_(t){this._dragger.onDrag_(t)}onClick_(t){this._dragger.onClick_(t)}element_(){return this._top}slider_(){return this._slider}handle_(){return this._handle}range_(){return this._major+1-2*this._halfMinor}setPosition_(t){const e=this.range_();t>e?t=e:t<0&&(t=0);const i=`${t}px`;this._vertical?this._handle.style.top=i:this._handle.style.left=i}destroy_(){this._dragger.destroy_()}}class ScribblerAction{static describe(t){const e=ScribblerAction._NAMES.get(t);return void 0===e?"":MSG.string_(e)}}ScribblerAction.BG="b",ScribblerAction.CURVE="c",ScribblerAction.ELLIPSE="o",ScribblerAction.EMBEDED_IMAGE="e",ScribblerAction.IMAGE="i",ScribblerAction.POLYCURVE="p",ScribblerAction.POLYGON="g",ScribblerAction.RECTANGLE="r",ScribblerAction.TEXT="t",ScribblerAction.history="E",ScribblerAction.export="X",ScribblerAction.more="M",ScribblerAction.move="V",ScribblerAction.shift="H",ScribblerAction._NAMES=new Map([[ScribblerAction.BG,RS.ScribblerBackground],[ScribblerAction.CURVE,RS.ScribblerCurve],[ScribblerAction.ELLIPSE,RS.ScribblerEllipse],[ScribblerAction.EMBEDED_IMAGE,RS.ScribblerEmbeddedImage],[ScribblerAction.IMAGE,RS.ScribblerImage],[ScribblerAction.POLYCURVE,RS.ScribblerPolycurve],[ScribblerAction.POLYGON,RS.ScribblerPolygon],[ScribblerAction.RECTANGLE,RS.ScribblerRectangle],[ScribblerAction.TEXT,RS.ScribblerText],[ScribblerAction.history,RS.ScribblerEdit],[ScribblerAction.export,RS.ScribblerExport],[ScribblerAction.more,RS.ScribblerMore],[ScribblerAction.move,RS.ScribblerMove],[ScribblerAction.shift,RS.ScribblerShift]]);class ScribblerLineStyle{static dash_(t){return t>10?[40,t+20]:[t*ScribblerLineStyle.SQUARE_DASH[0],t*ScribblerLineStyle.SQUARE_DASH[1]]}static dotted_(t){return t>10?[1,t+20]:[1,t*ScribblerLineStyle.SQUARE_DOTTED[1]+1]}}ScribblerLineStyle.SOLID="solid",ScribblerLineStyle.DASH="dash",ScribblerLineStyle.DOTTED="dotted",ScribblerLineStyle.MASQUEE=[1,3],ScribblerLineStyle.BUTT_DASH=[6,2],ScribblerLineStyle.BUTT_DOTTED=[1,1],ScribblerLineStyle.SQUARE_DASH=[5,2],ScribblerLineStyle.SQUARE_DOTTED=[1,2];class ScribblerDefault{}ScribblerDefault._SQUARE="square",ScribblerDefault._ROUND="round",ScribblerDefault._LEFT="Left",ScribblerDefault._CENTER="Center",ScribblerDefault._RIGHT="Right",ScribblerDefault.COLOR_WHITE=ColorValue.fromRGBA_(255,255,255,1),ScribblerDefault.ACTION=ScribblerAction.CURVE,ScribblerDefault.TEXTING=!0,ScribblerDefault.FILL=!0,ScribblerDefault.STROKE=!0,ScribblerDefault.GRID_S=1,ScribblerDefault.GRID_L=10,ScribblerDefault.GRID_X=16,ScribblerDefault.SHAPE=ScribblerAction.ELLIPSE,ScribblerDefault.LINE_CAP=ScribblerDefault._SQUARE,ScribblerDefault.LINE_JOIN=ScribblerDefault._ROUND,ScribblerDefault.TEXT_ALIGN=ScribblerDefault._CENTER,ScribblerDefault.LINE_WIDTH=1.05,ScribblerDefault.LINE_HEIGHT=1.15,ScribblerDefault.LINE_STYLE=ScribblerLineStyle.SOLID,ScribblerDefault.FONT_FAMILY="NotoSans-Regular",ScribblerDefault.FONT_SIZE=16,ScribblerDefault.CORNERING=.5,ScribblerDefault.CORNER_RADIUS=5,ScribblerDefault.ROTATION=0,ScribblerDefault.DATA=null,ScribblerDefault.STROKE_COLOR=ColorValue.fromRGBA_(0,0,0,1),ScribblerDefault.FILL_COLOR=ColorValue.fromRGBA_(30,144,255,.5),ScribblerDefault.TEXT_COLOR=ColorValue.fromRGBA_(0,0,0,1),ScribblerDefault.BG_COLOR=ColorValue.fromRGBA_(255,255,255,1),ScribblerDefault.HIGHLIGHT_COLOR=ColorValue.fromRGBA_(0,0,0,.5);class ScribblerOptions{}class ScribblerSetting{constructor(t){if(this.x_texting=ScribblerDefault.TEXTING,this.x_shape=ScribblerDefault.SHAPE,this.x_grid=ScribblerDefault.GRID_S,this.x_lineHeight=ScribblerDefault.LINE_HEIGHT,this.x_textAlign=ScribblerDefault.TEXT_ALIGN,this.x_stroke=ScribblerDefault.STROKE,this.x_fill=ScribblerDefault.FILL,this.x_strokeColor=ScribblerDefault.STROKE_COLOR,this.x_fillColor=ScribblerDefault.FILL_COLOR,this.x_textColor=ScribblerDefault.TEXT_COLOR,this.x_lineWidth=ScribblerDefault.LINE_WIDTH,this.x_lineStyle=ScribblerDefault.LINE_STYLE,this.x_fontFamily=ScribblerDefault.FONT_FAMILY,this.x_fontSize=ScribblerDefault.FONT_SIZE,this.x_cornering=ScribblerDefault.CORNERING,this.x_cornerRadius=ScribblerDefault.CORNER_RADIUS,this.x_rotation=ScribblerDefault.ROTATION,this.x_data=ScribblerDefault.DATA,t)for(const[e,i]of Object.entries(t))this[e]=i}clone(){return new ScribblerSetting({x_texting:this.x_texting,x_shape:this.x_shape,x_grid:this.x_grid,x_lineHeight:this.x_lineHeight,x_textAlign:this.x_textAlign,x_stroke:this.x_stroke,x_fill:this.x_fill,x_strokeColor:this.x_strokeColor,x_fillColor:this.x_fillColor,x_textColor:this.x_textColor,x_lineWidth:this.x_lineWidth,x_lineStyle:this.x_lineStyle,x_fontFamily:this.x_fontFamily,x_fontSize:this.x_fontSize,x_cornering:this.x_cornering,x_cornerRadius:this.x_cornerRadius,x_rotation:this.x_rotation,x_data:this.x_data})}apply(t,e,i){if(null!=this.x_strokeColor&&Scribbler.setStrokeColor_(t,this.x_strokeColor),null!=this.x_fillColor&&Scribbler.setFillColor_(t,this.x_fillColor),null!=this.x_lineWidth&&(t.lineWidth=this.x_lineWidth),null!=this.x_lineStyle&&null!=this.x_lineWidth&&Scribbler._setLineStyle_(t,this.x_lineStyle),null==this.x_fontFamily||null==this.x_fontSize)i();else{const n=`${this.x_fontSize}px ${this.x_fontFamily}`;Scribbler.setFont_(t,e,n,i)}}toJson(t){switch(t){case ScribblerAction.BG:return StringMap.from_([ScribblerSetting.FILL_COLOR,this.x_fillColor.toRgbaString_()]);case ScribblerAction.CURVE:return StringMap.from_([ScribblerSetting.STROKE_COLOR,this.x_strokeColor.toRgbaString_()],[ScribblerSetting.LINE_WIDTH,this.x_lineWidth],[ScribblerSetting.LINE_STYLE,this.x_lineStyle],[ScribblerSetting.CORNERING,this.x_cornering]);case ScribblerAction.POLYCURVE:return StringMap.from_([ScribblerSetting.STROKE,this.x_stroke],[ScribblerSetting.FILL,this.x_fill],[ScribblerSetting.FILL_COLOR,this.x_fillColor.toRgbaString_()],[ScribblerSetting.STROKE_COLOR,this.x_strokeColor.toRgbaString_()],[ScribblerSetting.LINE_WIDTH,this.x_lineWidth],[ScribblerSetting.LINE_STYLE,this.x_lineStyle],[ScribblerSetting.CORNERING,this.x_cornering]);case ScribblerAction.POLYGON:case ScribblerAction.ELLIPSE:return StringMap.from_([ScribblerSetting.STROKE,this.x_stroke],[ScribblerSetting.FILL,this.x_fill],[ScribblerSetting.FILL_COLOR,this.x_fillColor.toRgbaString_()],[ScribblerSetting.STROKE_COLOR,this.x_strokeColor.toRgbaString_()],[ScribblerSetting.LINE_WIDTH,this.x_lineWidth],[ScribblerSetting.LINE_STYLE,this.x_lineStyle]);case ScribblerAction.RECTANGLE:return StringMap.from_([ScribblerSetting.STROKE,this.x_stroke],[ScribblerSetting.FILL,this.x_fill],[ScribblerSetting.FILL_COLOR,this.x_fillColor.toRgbaString_()],[ScribblerSetting.STROKE_COLOR,this.x_strokeColor.toRgbaString_()],[ScribblerSetting.LINE_WIDTH,this.x_lineWidth],[ScribblerSetting.LINE_STYLE,this.x_lineStyle],[ScribblerSetting.CORNER_RADIUS,this.x_cornerRadius]);case ScribblerAction.TEXT:return StringMap.from_([ScribblerSetting.TEXT_COLOR,this.x_textColor.toRgbaString_()],[ScribblerSetting.FILL_COLOR,this.x_fillColor.toRgbaString_()],[ScribblerSetting.FONT_FAMILY,this.x_fontFamily],[ScribblerSetting.FONT_SIZE,this.x_fontSize],[ScribblerSetting.DATA,this.x_data]);case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:return StringMap.from_([ScribblerSetting.STROKE,this.x_stroke],[ScribblerSetting.FILL,this.x_fill],[ScribblerSetting.STROKE_COLOR,this.x_strokeColor.toRgbaString_()],[ScribblerSetting.FILL_COLOR,this.x_fillColor.toRgbaString_()],[ScribblerSetting.LINE_WIDTH,this.x_lineWidth],[ScribblerSetting.LINE_STYLE,this.x_lineStyle],[ScribblerSetting.ROTATION,this.x_rotation],[ScribblerSetting.DATA,this.x_data]);default:return StringMap.from_([ScribblerSetting.STROKE,this.x_stroke],[ScribblerSetting.FILL,this.x_fill],[ScribblerSetting.STROKE_COLOR,this.x_strokeColor.toRgbaString_()],[ScribblerSetting.FILL_COLOR,this.x_fillColor.toRgbaString_()],[ScribblerSetting.LINE_WIDTH,this.x_lineWidth],[ScribblerSetting.LINE_STYLE,this.x_lineStyle],[ScribblerSetting.FONT_FAMILY,this.x_fontFamily],[ScribblerSetting.FONT_SIZE,this.x_fontSize])}}static fromJson(t){var e,i,n;const s=t[ScribblerSetting.STROKE_COLOR],o=t[ScribblerSetting.FILL_COLOR],l=t[ScribblerSetting.TEXT_COLOR];return new ScribblerSetting({x_stroke:t[ScribblerSetting.STROKE],x_fill:t[ScribblerSetting.FILL],x_strokeColor:null!==(e=ColorValue.from_(s))&&void 0!==e?e:void 0,x_fillColor:null!==(i=ColorValue.from_(o))&&void 0!==i?i:void 0,x_textColor:null!==(n=ColorValue.from_(l))&&void 0!==n?n:void 0,x_lineWidth:t[ScribblerSetting.LINE_WIDTH],x_lineStyle:t[ScribblerSetting.LINE_STYLE],x_fontFamily:t[ScribblerSetting.FONT_FAMILY],x_fontSize:t[ScribblerSetting.FONT_SIZE],x_cornering:t[ScribblerSetting.CORNERING],x_cornerRadius:t[ScribblerSetting.CORNER_RADIUS],x_rotation:t[ScribblerSetting.ROTATION],x_data:t[ScribblerSetting.DATA]})}}ScribblerSetting.STROKE="s",ScribblerSetting.FILL="f",ScribblerSetting.STROKE_COLOR="sc",ScribblerSetting.FILL_COLOR="fc",ScribblerSetting.TEXT_COLOR="tc",ScribblerSetting.LINE_WIDTH="lw",ScribblerSetting.LINE_STYLE="ls",ScribblerSetting.FONT_FAMILY="ff",ScribblerSetting.FONT_SIZE="fs",ScribblerSetting.CORNERING="ci",ScribblerSetting.CORNER_RADIUS="cr",ScribblerSetting.ROTATION="ro",ScribblerSetting.DATA="d";class ScribblerCmd{constructor(t,e,i,n=null){this.action$=t,this.setting$=e,this.path$=i,this.imageData$=n}clone_(){return new ScribblerCmd(this.action$,this.setting$.clone(),Array.from(this.path$),this.imageData$)}exec_(t,e,i=null){t.save(),this.setting$.apply(t,e,()=>{switch(this.action$){case ScribblerAction.BG:const e=t.canvas;t.fillRect(0,0,e.width,e.height);break;case ScribblerAction.CURVE:Scribbler.drawCurve_(t,this.setting$.x_cornering,this.path$,!1),t.stroke();break;case ScribblerAction.POLYCURVE:0==this.setting$.x_cornering?Scribbler.drawPath1_(t,this.path$,this.setting$.x_fill)>0&&this.setting$.x_stroke&&t.stroke():(Scribbler.drawCurve_(t,this.setting$.x_cornering,this.path$,!1),this.setting$.x_fill&&(t.closePath(),t.fill()),this.setting$.x_stroke&&t.stroke());break;case ScribblerAction.POLYGON:Scribbler.drawPath1_(t,this.path$,this.setting$.x_fill),this.setting$.x_fill&&t.fill(),this.setting$.x_stroke&&t.stroke();break;case ScribblerAction.RECTANGLE:this._drawRect(t);break;case ScribblerAction.ELLIPSE:{const e=this.path$[0],i=this.path$[1],n=this.path$[2],s=this.path$[3];t.beginPath(),t.ellipse(e+n,i+s,n<0?-n:n,s<0?-s:s,0,0,360,!1),this.setting$.x_fill&&t.fill(),this.setting$.x_stroke&&t.stroke();break}case ScribblerAction.TEXT:{const e=this.setting$.x_data;null==e||e.split("\n").forEach((e,i)=>{const n=this.path$[4*i],s=this.path$[4*i+1];t.fillText(e,n,s)});break}case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:{if(null!=this.imageData$){Scribbler.putImage_(t,this.setting$.x_stroke,this.setting$.x_fill,this.path$,this.imageData$);break}const e=this.setting$.x_data;if(null!=e){const n=this.setting$.x_rotation;return void Scribbler._drawImageFromUri(t,this,this.setting$.x_stroke,this.setting$.x_fill,this.path$,e,n,i)}break}default:throw Assert.notReach_(this.action$)}t.restore(),null==i||i(null)})}static describeRect_(t){if(null==t||t.length<4)return"";const e=An.getRect_(t);return`@${e.left},${e.top} ${e.width}x${e.height}`}describe_(){let t=ScribblerAction.describe(this.action$);switch(this.action$){case ScribblerAction.IMAGE:case ScribblerAction.TEXT:{let e=ScribblerCmd.describeRect_(this.getBoundingRect_());An.isempty_(e)||(e=" "+e),t=An.truncate_(t+` "${this.setting$.x_data}"`+e,DEF.historyTextLength);break}case ScribblerAction.EMBEDED_IMAGE:case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:case ScribblerAction.RECTANGLE:case ScribblerAction.ELLIPSE:{let e=ScribblerCmd.describeRect_(this.getBoundingRect_());An.isempty_(e)||(e=" "+e),t=An.truncate_(t+e,DEF.historyTextLength);break}case ScribblerAction.history:case ScribblerAction.export:case ScribblerAction.BG:break;default:throw Assert.notReach_(this.action$)}return t}shift_(t,e){switch(this.action$){case ScribblerAction.BG:break;case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:case ScribblerAction.RECTANGLE:for(let i=0,n=this.path$.length;i<n;)this.path$[i++]+=t,this.path$[i++]+=e;break;case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:case ScribblerAction.ELLIPSE:this.path$[0]+=t,this.path$[1]+=e;break;case ScribblerAction.TEXT:for(let i=0,n=this.path$.length;i<n;)this.path$[i++]+=t,this.path$[i++]+=e,i+=2;break;default:throw Assert.notReach_(this.action$)}}_dec(t,e){return(t-=e)<=0?0:t}getBoundingRect_(){const t=this._getboundingrect1();return null!=t&&(t[2]==t[0]&&(t[2]=t[0]+1),t[3]==t[1]&&(t[3]=t[1]+1)),t}_getboundingrect1(){switch(this.action$){case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:{const t=this._getBoundingRect(this.path$);if(null!=this.setting$&&this.setting$.x_lineWidth>=2){const e=Math.round(this.setting$.x_lineWidth/2);t[0]=this._dec(t[0],e),t[1]=this._dec(t[1],e),t[2]=t[2]+e,t[3]=t[3]+e}return t}case ScribblerAction.RECTANGLE:{const t=this.path$;return[t[0],t[1],t[2],t[3]]}case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:{const t=this.path$;return[t[0],t[1],t[0]+t[2],t[1]+t[3]]}case ScribblerAction.ELLIPSE:{const t=this.path$;return[t[0],t[1],t[0]+2*t[2],t[1]+2*t[3]]}case ScribblerAction.TEXT:{const t=this.path$,e=[999999,999999,0,0];for(let i=0,n=t.length;i<n;){const n=t[i++],s=t[i++],o=t[i++],l=t[i++];An.getBounds_(e,n,s),An.getBounds_(e,n+o,s+l)}return e}}return null}_getBoundingRect(t){const e=[999999,999999,0,0];for(let i=0,n=this.path$.length;i<n;)An.getBounds_(e,t[i++],t[i++]);return e}_drawRect(t){const e=this.setting$.x_cornerRadius;Scribbler.drawRect_(t,e,this.path$),this.setting$.x_fill&&t.fill(),this.setting$.x_stroke&&t.stroke()}toJson_(){return StringMap.from_([ScribblerCmd._ACTION,this.action$],[ScribblerCmd._CONTEXT,this.setting$.toJson(this.action$)],[ScribblerCmd._PATH,this.path$])}static setBG_(t,e){const i=t.canvas,n=i.width,s=i.height;t.save(),t.resetTransform(),t.clearRect(0,0,n,s),Scribbler.setFillColor_(t,e),t.fillRect(0,0,n,s),t.restore()}static fromJson_(t){const e=t[ScribblerCmd._ACTION],i=ScribblerSetting.fromJson(t[ScribblerCmd._CONTEXT]),n=t[ScribblerCmd._PATH];return new ScribblerCmd(e,i,n)}}ScribblerCmd._ACTION="a",ScribblerCmd._CONTEXT="c",ScribblerCmd._PATH="p";class ScribblerHistory{constructor(){this._bgColor=ScribblerDefault.BG_COLOR,this._width=0,this._height=0,this._bgImageCallback=null,this._history=[],this._redoList=[],this._listeners=[]}static fromJson_(t){var e;const i=new ScribblerHistory,n=t[ScribblerHistory.BG],s=t[ScribblerHistory.HISTORY];if(i._width=t[ScribblerHistory.WIDTH],i._height=t[ScribblerHistory.HEIGHT],n&&(i._bgColor=null!==(e=ColorValue.parseSafe_(n))&&void 0!==e?e:ScribblerDefault.BG_COLOR),null!=s)for(const t of s)i._history.push(ScribblerCmd.fromJson_(t));return i}add_(t){return null!=t&&(this._history.push(t),this._redoList.length=0,this._fire(),!0)}insert_(t,e){return null!=e&&(this._history.splice(t,0,e),this._redoList.length=0,this._fire(),!0)}addAll_(t){if(null!=t&&t.length>0){for(const e of t)this._history.push(e);return this._redoList.length=0,this._fire(),!0}return!1}undo_(){const t=this._history.pop();return void 0!==t&&(this._redoList.push(t),this._fire(),!0)}redo_(){const t=this._redoList.pop();return void 0!==t?(this._history.push(t),this._fire(),t):null}undoOK_(){return this._history.length>0}redoOK_(){return this._redoList.length>0}history_(){return this._history}isEmpty_(){return 0==this._history.length}length_(){return this._history.length}get_(t){return t<this._history.length?this._history[t]:null}remove_(t){return t<this._history.length?this._history.splice(t,1)[0]:null}down_(t){const e=this._history.length;if(e<0||t>=e)return t;const i=this._history.splice(t,1),n=t>=e-1?0:t+1;return this._history.splice(n,0,i[0]),n}up_(t){const e=this._history.length;if(e<0||t>=e)return t;const i=this._history.splice(t,1),n=0==t?e-1:t-1;return this._history.splice(n,0,i[0]),n}getBoundingRect_(){const t=[999999,999999,0,0];for(const e of this._history){const i=e.getBoundingRect_();null!=i&&(An.getBounds_(t,i[0],i[1]),An.getBounds_(t,i[2],i[3]))}return An.getRect_(t)}shift_(t,e){this._redoList.length=0;for(const i of this._history)i.shift_(t,e)}addListener_(t){this._listeners.push(t)}clear_(){this._history.length=0,this._redoList.length=0,this._fire()}getBGColor_(){return this._bgColor}setBGColor_(t){null==t&&(t=ScribblerDefault.BG_COLOR),this._bgColor=t}setBGImage_(t){this._bgImageCallback=t}getWidth_(){return this._width}getHeight_(){return this._height}exec_(t,e,i){ScribblerCmd.setBG_(t,this._bgColor),null!=this._bgImageCallback&&this._bgImageCallback(t.canvas);let n=[];An.iterateList_(this._history,(i,s,o)=>{this._exec(t,e,i,n,o)},()=>{i(n)})}_exec(t,e,i,n,s){i.exec_(t,e,t=>{if(null!=t)for(const e of t)n.push(e);s(!1)})}populate_(t){for(let e=this._history.length-1;e>=0;--e){const i=this._history[e];t.div_([ATTR.AnInfo,`${e}`]).text_(i.describe_()).up_()}}destroy_(){null!=this._redoList&&(this._history.length=0,this._redoList.length=0,this._listeners.length=0)}_fire(){if(null!=this._listeners)for(const t of this._listeners)t(this)}toJson_(t,e){return StringMap.from_([ScribblerHistory.BG,this._bgColor.toRgbaString_()],[ScribblerHistory.HISTORY,this._history.map(t=>t.toJson_())],[ScribblerHistory.WIDTH,t],[ScribblerHistory.HEIGHT,e])}}ScribblerHistory.BG="B",ScribblerHistory.HISTORY="H",ScribblerHistory.WIDTH="w",ScribblerHistory.HEIGHT="h";class ScribblerGesture{constructor(t=[]){if(this._action=null,this._path=[],null!=t&&6==t.length){const e=ScribblerGesture._angle(t[0],t[1],t[2],t[3]),i=ScribblerGesture._angle(t[2],t[3],t[4],t[5]),n=ScribblerGesture._angle(t[4],t[5],t[0],t[1]),s=ScribblerGesture._abs(i-e),o=ScribblerGesture._abs(n-i),l=ScribblerGesture._abs(e-n),a=Math.PI,r=a/8,_=a/2;ScribblerGesture._abs(s-_)<r?(this._action=ScribblerAction.RECTANGLE,this._path=[t[0],t[1],t[4],t[5]]):ScribblerGesture._abs(o-_)<r?(this._action=ScribblerAction.RECTANGLE,this._path=[t[2],t[3],t[0],t[1]]):ScribblerGesture._abs(l-_)<r&&(this._action=ScribblerAction.RECTANGLE,this._path=[t[4],t[5],t[2],t[3]])}}get action$(){return this._action}get path$(){return this._path}static _abs(t){return t<0?-t:t}static _angle(t,e,i,n){return Math.atan2(i-t,n-e)}}ScribblerGesture.SCROLL="S",ScribblerGesture.ZOOM="Z";class ScribblerTextOverlayHandler{constructor(t,e,i){this._canvas=t,this._textOverlay=e,this._callback=i,this.scrollX=0,this.scrollY=0,this.left=0,this.top=0}onDragstart_(t,e,i,n){const s=DomUt.asHTMLElement_(e),o=null!=s&&"DIV"==s.nodeName&&s.classList.contains(CSS.AnSmokescreen);return o&&(this.scrollX=this._canvas.parentElement.scrollLeft,this.scrollY=this._canvas.parentElement.scrollTop),o}onDragmove_(t){const e=t.state_(),i=this._canvas.parentElement.scrollLeft,n=this._canvas.parentElement.scrollTop;this._canvas.parentElement.scrollLeft=this.scrollX-e.cx,this._canvas.parentElement.scrollTop=this.scrollY-e.cy;const s=this._canvas.parentElement.scrollLeft-i,o=this._canvas.parentElement.scrollTop-n;if(null!=this._textOverlay){const t=this._textOverlay.style,e=An.parseIntPx_(t.left,0),i=An.parseIntPx_(t.top,0);t.left=`${e-s}px`,t.top=`${i-o}px`}}onDragend_(t,e){if(!t.state_().moved&&(An.stopevent_(e),null!=this._textOverlay)){const t=this._textOverlay.value;this._callback(t)}}}class ScribblerState{}ScribblerState.IDLE=0,ScribblerState.MOVE=1,ScribblerState.TEXT=2;class _EditState{constructor(t,e,i,n=null){this._action=t,this._cmd=e,this._bounds=i,this._doneCallback=n}}class Scribbler{constructor(t,e,i){this._canvas=t,this._origin=e,this._handler=i,this._rect=new Rect(0,0,0,0),this._scrollX=0,this._scrollY=0,this._textOverlaySmokescreen=null,this._textOverlayDragger=null,this._stateChangeListener=null,this._onExportCallback=null,this._gesture2=ScribblerGesture.SCROLL,this._timer=null,this._overlayQueue=new FrameLimiter(1),this._path=[0,0,0,0],this._savedPath=[0,0,0,0],this._path0=[],this._history=new ScribblerHistory,this._overlayShown=!1,this._editState=null,this._gesture=null,this._positioning=!1,this._textOverlay=null,_destroyed.set(this,!1),this._settings=smap_([ScribblerAction.CURVE,new ScribblerSetting({x_texting:!0,x_fill:!0,x_stroke:!0,x_grid:ScribblerDefault.GRID_S})],[ScribblerAction.POLYCURVE,new ScribblerSetting({x_texting:!1,x_fill:!1,x_stroke:!0,x_grid:ScribblerDefault.GRID_S})],[ScribblerAction.POLYGON,new ScribblerSetting({x_texting:!1,x_fill:!1,x_stroke:!0,x_grid:ScribblerDefault.GRID_S})],[ScribblerAction.IMAGE,new ScribblerSetting({x_texting:!1,x_fill:!1,x_stroke:!0,x_grid:ScribblerDefault.GRID_L})],[ScribblerAction.EMBEDED_IMAGE,new ScribblerSetting({x_texting:!1,x_fill:!1,x_stroke:!0,x_grid:ScribblerDefault.GRID_L})],[ScribblerAction.RECTANGLE,new ScribblerSetting({x_texting:!0,x_fill:!0,x_stroke:!0,x_grid:ScribblerDefault.GRID_L})],[ScribblerAction.ELLIPSE,new ScribblerSetting({x_texting:!0,x_fill:!0,x_stroke:!0,x_grid:ScribblerDefault.GRID_L})],[ScribblerAction.TEXT,new ScribblerSetting({x_texting:!0,x_fill:!1,x_stroke:!1,x_grid:ScribblerDefault.GRID_L,x_textAlign:MSG.string_(RS.Left)})],[ScribblerAction.more,new ScribblerSetting({x_texting:!1,x_fill:!0,x_stroke:!1,x_grid:ScribblerDefault.GRID_S})],[ScribblerAction.export,new ScribblerSetting({x_texting:!1,x_fill:!0,x_stroke:!1,x_grid:ScribblerDefault.GRID_X})]),this._canvasOffset=An.documentOffset_(this._canvas),this._context=t.getContext("2d"),this._context.lineCap=ScribblerDefault.LINE_CAP,this._context.lineJoin=ScribblerDefault.LINE_JOIN;const n=i.getSettings_(),s=FontUtil.fontFamilyOf_(n.current_().uiFontName$,n.current_().uiFontStyle$),o=2*n.current_().uiFontSize$;this._settings[ScribblerAction.history]=this._settings[ScribblerAction.more],this._settings[ScribblerAction.shift]=this._settings[ScribblerAction.more],this._textSetting=this._settings[ScribblerAction.TEXT],this._textSetting.x_fontFamily=s,this._textSetting.x_fontSize=o;const l=t.width,a=t.height;this._overlay=t.ownerDocument.createElement("canvas"),this._overlay.width=l,this._overlay.height=a,this._overlay.classList.add(CSS.AnOverlayCanvas),t.parentElement.append(this._overlay),this._overlayContext=this._overlay.getContext("2d"),this._overlayContext.lineCap=ScribblerDefault.LINE_CAP,this._overlayContext.lineJoin=ScribblerDefault.LINE_JOIN,An.showHidden_(this._overlay),this._relocateOverlay(),An.hideVisible_(this._overlay),this._overlayShown=!1,this.setAction_(ScribblerDefault.ACTION),this._dragger=new Dragger(this._overlay,this,new NoLimiter).bind_()}_relocateOverlay(){const t=this._overlay.style;t.backgroundColor="rgba(255,255,255,0)",t.zIndex=`${DEF.zindexImageAnnotator+10}`,t.position="relative",t.float="left",t.clear="both",t.top=`${this._origin.y}px`,t.left=`${this._origin.x}px`}setStateChangeListener_(t){this._stateChangeListener=t}onExport_(t){this._onExportCallback=t}onDragstart_(t,e,i,n){if(t.element_()!==e)return!1;this._rect=new Rect(Math.round(this._canvasOffset.x),Math.round(this._canvasOffset.y),this._canvas.width,this._canvas.height),this._path=this._canvasloc1([],i,n),this._gesture=null;const s=t.state_();return 2==s.touches&&(this._path0=An.intArrayCopy_([],s.pointers)),!0}onDragmove_(t){const e=t.state_(),i=Math.max(0,Math.min(this._rect.width,this._snap(e.x-this._rect.left+this._scrollX))),n=Math.max(0,Math.min(this._rect.height,this._snap(e.y-this._rect.top+this._scrollY)));if(3==e.touches?this._gesture=ScribblerGesture.SCROLL:2==e.touches?this._gesture=this._gesture2:this._gesture=null,this._gesture!=ScribblerGesture.SCROLL)if(this._positioning)switch(this._action){case ScribblerAction.CURVE:{const t=this._edit(e,i,n);this._drawShapeOverlay(t);break}case ScribblerAction.RECTANGLE:case ScribblerAction.TEXT:case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:{const t=this._edit(e,i,n);this._drawRectOverlay(t);break}case ScribblerAction.ELLIPSE:{const t=this._edit(e,i,n);this._drawEllipseOverlay(t);break}case ScribblerAction.history:case ScribblerAction.export:{const t=this._edit(e,i,n);this._drawHighlightOverlay(t);break}case ScribblerAction.shift:{this._translate(i,n);const t=this._snapTopLeft(this._savedPath);this._drawHighlightOverlay(t);break}}else switch(this._action){case ScribblerAction.CURVE:if(this._gesture==ScribblerGesture.ZOOM){const t=this._canvaslocs([],e.pointers);this._drawShapeOverlay(t)}else 0==this._setting.x_cornering?(this._path.push(i),this._path.push(n),this._redrawOverlayPath()):(this._path.push(i),this._path.push(n),this._redrawOverlayCurve(!0));break;case ScribblerAction.POLYCURVE:this._redrawOverlayCurve(!1,i,n),null!=this._timer&&this._timer.cancel_(),this._timer=new Timer(Scribbler._DELAY,()=>{this._path.push(i),this._path.push(n),this._redrawOverlayCurve(!1)});break;case ScribblerAction.POLYGON:this._redrawOverlayPath(i,n),null!=this._timer&&this._timer.cancel_(),this._timer=new Timer(Scribbler._DELAY,()=>{this._path.push(i),this._path.push(n),this._redrawOverlayPath()});break;case ScribblerAction.RECTANGLE:case ScribblerAction.TEXT:case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:if(this._gesture==ScribblerGesture.ZOOM){const t=this._canvaslocs([],e.pointers);this._drawRectOverlay(t)}else this._drawRectOverlay([this._path[0],this._path[1],i,n]);break;case ScribblerAction.ELLIPSE:if(this._gesture==ScribblerGesture.ZOOM){const t=this._canvaslocs([],e.pointers);this._drawEllipseOverlay(t)}else this._drawEllipseOverlay([this._path[0],this._path[1],i,n]);break;case ScribblerAction.history:case ScribblerAction.more:case ScribblerAction.shift:this._scroll(i,n);break;case ScribblerAction.export:if(this._gesture==ScribblerGesture.ZOOM){const t=this._canvaslocs([],e.pointers);this._drawHighlightOverlay(t)}else this._drawHighlightOverlay([this._path[0],this._path[1],i,n])}else this._scroll(i,n)}highlight_(t){const e=this._history.get_(t);if(null==e)return;const i=this._history.history_().length;this._drawHighlightOverlay(e.getBoundingRect_(),`${t+1}/${i}`)}move_(t){const e=this._history.get_(t);if(null!=e){switch(e.action$){case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:case ScribblerAction.RECTANGLE:case ScribblerAction.ELLIPSE:case ScribblerAction.TEXT:case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:break;default:return}this._move(e)}}_move(t){const e=t.getBoundingRect_();if(null==e)return void this._handler.warn_(MSG.string_(RS.ContentNotMovable));const i=An.getRect_(e);this._editState=new _EditState(this._action,t,i,null),this._setaction1(ScribblerAction.history),this._path=e,this._startPositioning()}cloneObject_(t){const e=this._history.get_(t);if(null==e)return;switch(e.action$){case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:case ScribblerAction.RECTANGLE:case ScribblerAction.ELLIPSE:case ScribblerAction.TEXT:case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:break;default:return}const i=e.clone_();this._history.insert_(t+1,i)&&this._move(i)}down_(t){const e=this._history.down_(t);return this.refresh_(),e}up_(t){const e=this._history.up_(t);return this.refresh_(),e}shift_(t){const e=this._history.getBoundingRect_();if(null==e)return void this._handler.warn_(MSG.string_(RS.ContentNotMovable));this._editState=new _EditState(this._action,null,e,t),this._setaction1(ScribblerAction.shift),this._path=[e.left,e.top,e.left+e.width,e.top+e.height],this._startPositioning();const i=this._snapTopLeft(this._savedPath);this._drawHighlightOverlay(i)}resize_(){this._overlay.width=this._canvas.width,this._overlay.height=this._canvas.height}_edit(t,e,i){var n;let s=this._gesture==ScribblerGesture.ZOOM;if(s&&null!=this._editState)switch(null===(n=this._editState._cmd)||void 0===n?void 0:n.action$){case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:case ScribblerAction.RECTANGLE:case ScribblerAction.ELLIPSE:break;default:s=!1}return s?this._scale(t):this._translate(e,i),this._snapTopLeft(this._savedPath)}_scale(t){const e=this._path0[2]-this._path0[0],i=this._path0[3]-this._path0[1],n=An.intArrayCopy_([],t.pointers),s=n[2]-n[0],o=n[3]-n[1];if(s!=e||o!=i){const t=s-e,l=o-i;(l>Dragger.THRESHOLD||l<-Dragger.THRESHOLD||t>Dragger.THRESHOLD||t<-Dragger.THRESHOLD)&&(this._path0=n,this._savedPath[2]+=this._threshold(t,Dragger.THRESHOLD),this._savedPath[3]+=this._threshold(l,Dragger.THRESHOLD),this._floor(this._savedPath,2,0),this._floor(this._savedPath,3,1))}}_translate(t,e){let i=t-this._path[0],n=e-this._path[1];this._path[0]=t,this._path[1]=e,i=this._threshold(i,3),n=this._threshold(n,3),this._savedPath[0]+=i,this._savedPath[1]+=n,this._savedPath[2]+=i,this._savedPath[3]+=n}_floor(t,e,i){t[e]<t[i]&&(t[e]=t[i])}_scroll(t,e){const i=this._path[0]-t,n=this._path[1]-e;this._canvas.parentElement.scrollLeft+=i,this._canvas.parentElement.scrollTop+=n,this._path[0]=t,this._path[1]=e}_threshold(t,e){return t>0?Math.max(0,t-e):t<0?Math.min(0,t+e):0}onDragend_(t,e){null!=this._timer&&this._timer.cancel_();const i=t.state_();if(this._gesture==ScribblerGesture.SCROLL)return;const n=Math.max(0,Math.min(this._rect.width,this._snap(i.x-this._rect.left+this._scrollX))),s=Math.max(0,Math.min(this._rect.height,this._snap(i.y-this._rect.top+this._scrollY)));if(this._positioning){if(this._positioning&&i.moved)return;this._positioning&&(this._path=this._snapTopLeft(this._savedPath))}else switch(this._action){case ScribblerAction.CURVE:if(this._gesture==ScribblerGesture.ZOOM)return this._path=this._canvaslocs([],i.pointers),void this._startPositioning();break;case ScribblerAction.RECTANGLE:case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:this._updatepath(i,n,s);const t=An.getRect_(this._path);return void(0==t.width||0==t.height?this._endPositioning():this._startPositioning());case ScribblerAction.ELLIPSE:case ScribblerAction.TEXT:return this._updatepath(i,n,s),void this._startPositioning();case ScribblerAction.export:if(i.moved)return this._updatepath(i,n,s),void this._startPositioning();this._updatepath(i,n,s),this._savedPath=this._path,this._normalize(this._savedPath),this._path=[]}switch(this._action){case ScribblerAction.history:if(this._updatepath(i,n,s),null==this._editState||null==this._editState._cmd)break;const t=this._editState._cmd;switch(t.action$){case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:{const e=this._editState._bounds,i=An.getRect_(this._path),n=0==e.width?1:i.width/e.width,s=0==e.height?1:i.height/e.height,o=t.path$;for(let t=0,l=o.length;t<l;){const l=o[t]-e.left,a=o[t+1]-e.top;o[t++]=Math.round(i.left+l*n),o[t++]=Math.round(i.top+a*s)}break}case ScribblerAction.RECTANGLE:t.path$=this._path;break;case ScribblerAction.ELLIPSE:{const e=this._path[0],i=this._path[1],n=(this._path[2]-e)/2,s=(this._path[3]-i)/2;t.path$=[e,i,n,s];break}case ScribblerAction.TEXT:{const e=this._editState._bounds,i=An.getRect_(this._path),n=t.path$;for(let t=0,s=n.length;t<s;t+=2){const s=n[t]-e.left,o=n[t+1]-e.top;n[t++]=i.left+s,n[t++]=i.top+o}break}case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:{const e=An.getRect_(this._path);let i,n;i=t.path$[2],n=t.path$[3],t.path$=[e.left,e.top,i,n];break}}this._endEdit();break;case ScribblerAction.shift:if(this._updatepath(i,n,s),null!=this._editState){const t=this._editState._bounds,e=An.getRect_(this._path),i=e.left-t.left,n=e.top-t.top;this._history.shift_(i,n)}this._endEdit();break;case ScribblerAction.export:if(this._path=An.intArrayCopy_([],this._savedPath),null!=this._onExportCallback){let t=An.getRect_(this._path);0!=t.width&&0!=t.height||(this._handler.warn_(MSG.string_(RS.ExportingWholeCanvas)),t=new Rect(0,0,this._canvas.width,this._canvas.height)),this._onExportCallback(ScribblerAction.export,t)}this._endPositioning();break;case ScribblerAction.CURVE:this._positioning?this._actionShape(this._path):(this._path=Scribbler.drawCurve_(this._context,this._setting.x_cornering,this._path,!0),this._context.stroke(),this.clearOverlay_(),this._path.length>2&&this._history.add_(new ScribblerCmd(this._action,this._cloneSetting(),this._path)));break;case ScribblerAction.POLYCURVE:Scribbler.drawCurve_(this._context,this._setting.x_cornering,this._path,!1),this._setting.x_fill&&(this._context.closePath(),this._context.fill()),this._setting.x_stroke&&this._context.stroke(),this.clearOverlay_(),this._path.length>2&&this._history.add_(new ScribblerCmd(this._action,this._cloneSetting(),this._path));break;case ScribblerAction.POLYGON:Scribbler.drawPath1_(this._context,this._path,this._setting.x_fill)>0&&(this.clearOverlay_(),this._setting.x_fill&&this._context.fill(),this._setting.x_stroke&&this._context.stroke()),this._path.length>2&&this._history.add_(new ScribblerCmd(this._action,this._cloneSetting(),this._path));break;case ScribblerAction.RECTANGLE:this._updatepath(i,n,s),this._actionRect(this._path);break;case ScribblerAction.ELLIPSE:this._updatepath(i,n,s),this._actionEllipse(this._path);break;case ScribblerAction.TEXT:this._updatepath(i,n,s),this._actionText(this._path);break;case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:this._updatepath(i,n,s);const e=An.getRect_(this._path);if(this._endPositioning(),0==e.width||0==e.height)break;this._handler.promptImportImage_(e.width,e.height,DEF.zindexImageAnnotator+100,(t,i,n,s,o)=>{const l=this._canvas.ownerDocument.createElement("img");l.addEventListener("load",t=>{let a=l.naturalWidth,r=l.naturalHeight,_=An.parseInt_(n,-1),c=An.parseInt_(s,-1);if(0!=o&&180!=o){const t=a;a=r,r=t}if(_>=0&&c<0)c=Math.round(_*r/a);else if(_<0&&c>=0)_=Math.round(c*a/r);else if(_<0&&c<0){const t=MediaUtil.fit_(a,r,e.width,e.height);_=t.x,c=t.y}if(_>0&&c>0){const t=this._action,n=this._cloneSetting(),s=[e.left,e.top,_,c];Scribbler._drawImage(this._context,n.x_stroke,n.x_fill,s,o,l);const a=this._context.getImageData(e.left,e.top,_,c);if(t==ScribblerAction.IMAGE)n.x_data=i;else{const t=this._canvas.ownerDocument.createElement("canvas");t.width=_,t.height=c;const e=t.getContext("2d");null!=e&&e.putImageData(a,0,0),n.x_data=t.toDataURL("image/jpeg")}this._history.add_(new ScribblerCmd(t,n,s,a))}}),l.addEventListener("error",e=>{this._handler.warn_([MSG.string_(RS.ErrorLoading),t])}),l.src=i})}this._gesture2=ScribblerGesture.SCROLL,this._positioning=!1}_endEdit(){var t;if(null!=this._editState){let e=null!==(t=this._editState._doneCallback)&&void 0!==t?t:null;this.setAction_(this._editState._action),this._editState=null,this._gesture2=ScribblerGesture.SCROLL,this.refresh_(),this._changeState(ScribblerState.IDLE),null==e||e()}}_endPositioning(){this.clearOverlay_(),this._editState=null,this._gesture2=ScribblerGesture.SCROLL,this._changeState(ScribblerState.IDLE)}_startPositioning(){this._savedPath=this._path,this._normalize(this._savedPath),this._path=[],this._positioning=!0,this._changeState(ScribblerState.MOVE),this._handler.info_(MSG.string_(RS.DragPinchClick),{attop:!1}),this._gesture2=ScribblerGesture.ZOOM}_normalize(t){t[2]<t[0]&&this._swap(t,0,2),t[3]<t[1]&&this._swap(t,1,3)}_swap(t,e,i){const n=t[i];t[i]=t[e],t[e]=n}_updatepath(t,e,i){this._gesture==ScribblerGesture.ZOOM?this._path=this._canvaslocs([],t.pointers):(this._path.push(e),this._path.push(i))}_actionShape(t){switch(this._setting.x_shape){case ScribblerAction.ELLIPSE:this._actionEllipse(t);break;case ScribblerAction.RECTANGLE:this._actionRect(t);break;case ScribblerAction.TEXT:this._actionText(t);break;default:throw Assert.notReach_(this._setting.x_shape)}}_actionRect(t){Scribbler.drawRect_(this._context,this._setting.x_cornerRadius,t),this.clearOverlay_(),this._setting.x_fill&&this._context.fill(),this._setting.x_stroke&&this._context.stroke(),t[0]==t[2]&&t[1]==t[3]||(this._history.add_(new ScribblerCmd(this._action,this._cloneSetting(),t)),!this._setting.x_texting)?this._changeState(ScribblerState.IDLE):this._showCenterTextOverlay(t)}_changeState(t){switch(t){case ScribblerState.IDLE:this._overlay.style.cursor="default",null!=this._stateChangeListener&&this._stateChangeListener(ScribblerState.IDLE);break;case ScribblerState.MOVE:this._overlay.style.cursor="move",null!=this._stateChangeListener&&this._stateChangeListener(ScribblerState.MOVE);break;case ScribblerState.TEXT:null!=this._stateChangeListener&&this._stateChangeListener(ScribblerState.TEXT)}}_actionEllipse(t){const e=t[0],i=t[1],n=(t[2]-e)/2,s=(t[3]-i)/2;this._context.beginPath(),this._context.ellipse(e+n,i+s,n<0?-n:n,s<0?-s:s,0,0,360,!1),this.clearOverlay_(),this._setting.x_fill&&this._context.fill(),this._setting.x_stroke&&this._context.stroke(),0==n&&0==s||(this._history.add_(new ScribblerCmd(ScribblerAction.ELLIPSE,this._cloneSetting(),[e,i,n,s])),!this._setting.x_texting)?this._changeState(ScribblerState.IDLE):this._showCenterTextOverlay(t)}_actionText(t){const e=t[0],i=t[1],n=t[2],s=t[3];this.clearOverlay_(),this._hideOverlay(),this._showTextOverlay(e,i,n-e,s-i),this._changeState(ScribblerState.TEXT)}destroy_(){__classPrivateFieldGet(this,_destroyed)||(this._dragger.destroy_(),this._overlayQueue.cancel_(),this._overlay.remove(),this._hideTextOverlay(),this._timer=null,this._history.destroy_(),__classPrivateFieldSet(this,_destroyed,!0))}history_(){return this._history}addHistory_(t){return null!=t&&this._history.addAll_(t)}addHistoryListener_(t){this._history.addListener_(t)}setAction_(t){return t!=this._action&&this._setaction1(t)}_setaction1(t){return this._action=t,this._setting=this._settings[this._action],this.setStrokeColor_(this._setting.x_strokeColor),this.setFillColor_(this._setting.x_fillColor),this.setLineWidth_(this._setting.x_lineWidth),this.setLineStyle_(this._setting.x_lineStyle),this.setFont_(this._textSetting.x_fontFamily,this._textSetting.x_fontSize),this.setTextColor_(this._textSetting.x_textColor),this._path=[],this._action!=ScribblerAction.TEXT&&null!=this._textOverlay&&(this._hideOverlay(),this._hideTextOverlay()),this._showOverlay(),!0}undo_(){this._history.undo_()&&(this._path=[],this.refresh_())}redo_(){const t=this._history.redo_();null!=t&&t.exec_(this._context,this._handler,null)}getAction_(){return this._action}getScribblerSetting_(){return this._setting}getTextSetting_(){return this._textSetting}setLineStyle_(t){this._setting.x_lineStyle=t,Scribbler._setLineStyle_(this._context,t),Scribbler._setLineStyle_(this._overlayContext,t)}setCornering_(t){this._setting.x_cornering=t}setCornerRadius_(t){this._setting.x_cornerRadius=t}setFont_(t,e,i=null){this._textSetting.x_fontFamily=t,this._textSetting.x_fontSize=e;const n=`${e}px ${t}`;Scribbler.setFont_(this._context,this._handler,n,i)}setTextAlign_(t){this._setting.x_textAlign=t}setLineWidth_(t){this._setting.x_lineWidth=t,this._context.lineWidth=t,this.setLineStyle_(this._setting.x_lineStyle),null!=this._overlay&&(this._overlayContext.lineWidth=t,this.setLineStyle_(this._setting.x_lineStyle))}setStrokeColor_(t){null!=t&&(this._setting.x_strokeColor=t,Scribbler.setStrokeColor_(this._context,t),null!=this._overlay&&Scribbler.setStrokeColor_(this._overlayContext,t))}setFillColor_(t){null!=t&&(this._setting.x_fillColor=t,Scribbler.setFillColor_(this._context,t),null!=this._overlay&&Scribbler.setFillColor_(this._overlayContext,t))}setTextColor_(t){null!=t&&(this._textSetting.x_textColor=t)}enableStroke_(t){this._setting.x_stroke=t}enableFill_(t){this._setting.x_fill=t}enableText_(t){this._setting.x_texting=t}getGrid_(){return this._setting.x_grid}setGrid_(t){this._setting.x_grid=t}setLineHeight_(t){this._setting.x_lineHeight=t}getBGColor_(){return this._history.getBGColor_()}setBGColor_(t){this._history.setBGColor_(t)}setBGImage_(t){this._history.setBGImage_(t)}clear_(){this._history.clear_(),this.refresh_()}onresize_(t){this._origin=t,this._overlayShown?this._relocateOverlay():(An.showVisible_(this._overlay),this._relocateOverlay(),An.hideVisible_(this._overlay)),this.refresh_()}refresh_(){this.clearOverlay_(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height);const t=native$.getIFrameUri_();this._history.exec_(this._context,this._handler,e=>{if(null!=e&&e.length>0){const i=[MSG.string_(RS.ErrorLoading)];for(const n of e){if(n.startsWith("#")){i.push(n);continue}const e=An.cpathOfHref2_(t,n);null==e?i.push(MSG.string_(RS.Scribbler_MissingImageURI)):i.push("# "+MSG.string_(RS.ErrorLoading)+": "+e)}this._handler.warn_(i)}})}_canvasloc1(t,e,i){const n=this._canvas.parentElement;this._scrollX=n.scrollLeft,this._scrollY=n.scrollTop;const s=Math.max(0,Math.min(this._rect.width,this._snap(e-this._rect.left+this._scrollX))),o=Math.max(0,Math.min(this._rect.height,this._snap(i-this._rect.top+this._scrollY)));return t.push(s),t.push(o),t}_canvaslocs(t,e){const i=this._canvas.parentElement;this._scrollX=i.scrollLeft,this._scrollY=i.scrollTop;for(let i=0;i<e.length;i+=2){const n=Math.max(0,Math.min(this._rect.width,this._snap(e[i]-this._rect.left+this._scrollX))),s=Math.max(0,Math.min(this._rect.height,this._snap(e[i+1]-this._rect.top+this._scrollY)));t.push(n),t.push(s)}return t}_snap(t){const e=this._setting.x_grid;return e>1?Math.round(t/e)*e:t}_snapTopLeft(t){const e=this._snap(t[0]),i=this._snap(t[1]);return[e,i,e+t[2]-t[0],i+t[3]-t[1]]}clearOverlay_(){null!=this._overlayQueue&&this._overlayQueue.queue_((t,e)=>{this._overlayContext.clearRect(0,0,this._canvas.width,this._canvas.height)})}_showOverlay(){switch(this._action){case ScribblerAction.CURVE:case ScribblerAction.POLYCURVE:case ScribblerAction.POLYGON:case ScribblerAction.RECTANGLE:case ScribblerAction.ELLIPSE:case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:this._setting.x_stroke?this._showoverlay1(this._setting.x_lineWidth,this._setting.x_lineStyle,this._setting.x_strokeColor):this._setting.x_fill?this._showoverlay1(ScribblerDefault.LINE_WIDTH,ScribblerLineStyle.SOLID,this._setting.x_fillColor):this._showoverlay1(ScribblerDefault.LINE_WIDTH,ScribblerLineStyle.SOLID,ScribblerDefault.STROKE_COLOR);break;case ScribblerAction.TEXT:this._showoverlay1(ScribblerDefault.LINE_WIDTH,ScribblerLineStyle.SOLID,this._textSetting.x_textColor);break;case ScribblerAction.history:case ScribblerAction.export:case ScribblerAction.more:case ScribblerAction.shift:this._showoverlay1(ScribblerDefault.LINE_WIDTH,ScribblerLineStyle.SOLID,this._setting.x_fillColor);break;default:throw Assert.notReach_(this._action)}}_showoverlay1(t,e,i){const n=this._overlayContext;n.lineWidth=t,Scribbler._setLineStyle_(n,e),Scribbler.setStrokeColor_(n,i),this._overlayShown||(this._overlayShown=!0,this._handler.hideKeyboard_(()=>{An.showVisible_(this._overlay,"block")}))}_hideOverlay(){this._overlayShown&&(this._overlayShown=!1,this._overlayQueue.cancel_(),this._overlayContext.clearRect(0,0,this._overlay.width,this._overlay.height),An.hide_(this._overlay))}_showTextOverlay(t,e,i,n){this._hideOverlay(),this._changeState(ScribblerState.TEXT);const s=this._canvasOffset,o=this._canvas.parentElement,l=o.scrollLeft,a=o.scrollTop,r=Math.floor(s.x)-l,_=Math.floor(s.y)-a;i<0&&(t-=i=-i),n<0&&(e-=n=-n);const c=this._canvas.ownerDocument.createElement("textarea");this._textOverlay=c,c.style.cursor="text",this._canvas.parentElement.append(c),null==c||c.classList.add(CSS.AnTextOverlay);const h=c.style;h.backgroundColor="rgba(255,255,255,0.25)",h.color=this._textSetting.x_textColor.toCSSString_(),h.fontFamily=this._textSetting.x_fontFamily,h.fontSize=`${this._textSetting.x_fontSize}px`,h.left=`${r+t}px`,h.top=`${_+e}px`,h.width=`${i}px`,h.height=`${n}px`,h.lineHeight=`${this._textSetting.x_lineHeight}`,h.padding="0px",h.margin="0px",h.border="0px",h.resize="both",h.zIndex=`${DEF.zindexImageAnnotator+2}`,this._showTextOverlaySmokescreen(t=>{var e;const i=An.getComputedStyle_(c),n=An.parseDoublePx_(null!==(e=null==i?void 0:i.lineHeight)&&void 0!==e?e:null,this._textSetting.x_lineHeight);this._drawText(t,n),this._hideTextOverlay(),this._showOverlay()}),c.focus()}_showCenterTextOverlay(t){var e;this._hideOverlay(),this._changeState(ScribblerState.TEXT);let i=t[0],n=t[1],s=t[2]-i,o=t[3]-n;const l=this._canvasOffset,a=this._canvas.parentElement.scrollLeft,r=this._canvas.parentElement.scrollTop,_=Math.floor(l.x)-a,c=Math.floor(l.y)-r;s<0&&(i-=s=-s),o<0&&(n-=o=-o);const h=this._canvas.ownerDocument.createElement("textarea");this._textOverlay=h,h.style.cursor="text",this._canvas.parentElement.append(h),null==h||h.classList.add(CSS.AnTextOverlay);const u=h.style;u.backgroundColor="rgba(255,255,255,0.25)",u.color=this._textSetting.x_textColor.toCSSString_(),u.fontFamily=this._textSetting.x_fontFamily,u.fontSize=`${this._textSetting.x_fontSize}px`,u.lineHeight=`${this._textSetting.x_lineHeight}`,u.padding="4px 0px",u.margin="0px",u.border="0px",u.resize="both",u.verticalAlign="middle",u.textAlign="center",u.zIndex=`${DEF.zindexImageAnnotator+2}`;const d=An.getComputedStyle_(h),S=An.parseDoublePx_(null!==(e=null==d?void 0:d.lineHeight)&&void 0!==e?e:null,this._textSetting.x_lineHeight);u.left=`${_+i}px`,u.top=`${c+n+(o-S-8)/2}px`,u.width=`${s}px`,u.height=`${S}px`,this._showTextOverlaySmokescreen(t=>{this._drawCenterText(t,i,n,s,o,S),this._hideTextOverlay(),this._showOverlay()}),h.focus()}_hideTextOverlay(){null!=this._textOverlay&&(this._textOverlay.remove(),this._textOverlay=null,this._hideTextOverlaySmokescreen(),this._changeState(ScribblerState.IDLE))}_showTextOverlaySmokescreen(t){this._textOverlaySmokescreen=new Smokescreen(this._canvas.parentElement,DEF.zindexImageAnnotator+1,DEF.opacityTransparent),this._textOverlaySmokescreen.show_(e=>{const i=e.element_();null!=i&&null!=this._textOverlay&&(i.style.cursor="text",this._textOverlayDragger=new Dragger(i,new ScribblerTextOverlayHandler(this._canvas,this._textOverlay,t),new FrameLimiter(2)).threshold_(Dragger.SCROLL_THRESHOLD).bind_())})}_hideTextOverlaySmokescreen(){var t;null!=this._textOverlaySmokescreen&&(null===(t=this._textOverlayDragger)||void 0===t||t.destroy_(),this._textOverlayDragger=null,this._textOverlaySmokescreen.destroy_(),this._textOverlaySmokescreen=null)}_drawText(t,e){if(t.length>0){const i=t.split("\n"),n=this._path[0],s=this._path[1],o=this._path[2],l=this._path[3],a=Math.min(n,o),r=Math.max(n,o);let _=Math.min(s,l),c=this._textSetting.x_textColor;Scribbler.setFillColor_(this._context,c),this._path=[];const h=Math.round(e);for(const t of i){let e=a;const i=this._context.measureText(t).width;switch(this._setting.x_textAlign){case ScribblerDefault._LEFT:break;case ScribblerDefault._CENTER:e=Math.round((a+r-i)/2);break;case ScribblerDefault._RIGHT:e=Math.round(r-i);break;default:continue}this._path.push(e),this._path.push(_),this._path.push(Math.round(i)),this._path.push(h),this._context.fillText(t,e,_),_+=h}if(t.length>0){const e=this._cloneSetting();e.x_data=t,e.x_fillColor=e.x_textColor,this._history.add_(new ScribblerCmd(ScribblerAction.TEXT,e,this._path))}c=this._setting.x_fillColor,Scribbler.setFillColor_(this._context,c)}this._path=[]}_drawCenterText(t,e,i,n,s,o){if(t.length>0){const l=t.split("\n");let a=i+(s-o*l.length)/2,r=this._textSetting.x_textColor;Scribbler.setFillColor_(this._context,r),this._path=[];const _=Math.round(o);for(const t of l){const i=this._context.measureText(t).width,s=e+(n-i)/2;this._path.push(s),this._path.push(a),this._path.push(Math.round(i)),this._path.push(_),this._context.fillText(t,s,a),a+=_}if(t.length>0){const e=this._cloneSetting();e.x_data=t,e.x_fillColor=e.x_textColor,this._history.add_(new ScribblerCmd(ScribblerAction.TEXT,e,this._path))}r=this._setting.x_fillColor,Scribbler.setFillColor_(this._context,r)}this._path=[]}_redrawOverlayPath(t,e){this._overlayQueue.queue_((i,n)=>{const s=this._overlayContext;if(s.clearRect(0,0,this._rect.width,this._rect.height),Scribbler.drawPath1_(s,this._path,!1)>0&&(s.stroke(),void 0!==t&&null!=e)){s.save(),s.lineWidth=1,s.setLineDash(ScribblerLineStyle.MASQUEE),s.beginPath();const i=this._path.length,n=this._path[i-2],o=this._path[i-1];s.moveTo(n,o),s.lineTo(t,e),s.stroke(),s.restore()}})}_redrawOverlayCurve(t,e,i){this._overlayQueue.queue_((n,s)=>{const o=this._overlayContext;if(o.clearRect(0,0,this._rect.width,this._rect.height),void 0!==e&&null!=i){const n=this._path.length;this._path.push(e),this._path.push(i),o.save(),o.lineWidth=ScribblerDefault.LINE_WIDTH,o.setLineDash(ScribblerLineStyle.MASQUEE),this._path=Scribbler.drawCurve_(o,this._setting.x_cornering,this._path,t),o.stroke(),o.restore(),this._path.length=n}else this._path=Scribbler.drawCurve_(o,this._setting.x_cornering,this._path,t),o.stroke()})}_drawShapeOverlay(t){switch(this._setting.x_shape){case ScribblerAction.ELLIPSE:this._drawEllipseOverlay(t);break;case ScribblerAction.RECTANGLE:case ScribblerAction.TEXT:this._drawRectOverlay(t);break;default:throw Assert.notReach_(this._setting.x_shape)}}_drawRectOverlay(t){this._overlayQueue.queue_((e,i)=>{const n=this._overlayContext;n.clearRect(0,0,this._overlay.width,this._overlay.height),Scribbler.drawRect_(n,this._setting.x_cornerRadius,t),n.stroke(),this._showOverlayDimension(t)})}_drawEllipseOverlay(t){this._overlayQueue.queue_((e,i)=>{if(null==this._overlay)return;const n=this._overlayContext;n.clearRect(0,0,this._overlay.width,this._overlay.height),Scribbler._drawEllipse(n,t),n.stroke(),this._showOverlayDimension(t)})}_drawHighlightOverlay(t,e=""){this._overlayQueue.queue_((i,n)=>{const s=this._overlayContext;s.clearRect(0,0,this._overlay.width,this._overlay.height),null!=t&&4==t.length?(s.save(),Scribbler.setFillColor_(s,ScribblerDefault.HIGHLIGHT_COLOR),Scribbler.drawRect_(s,0,t),s.fill(),s.restore(),this._showOverlayDimension(t,e)):An.isempty_(e)||this._handler.info_(e)})}_showOverlayDimension(t,e=""){this._handler.info_(`${e}${ScribblerCmd.describeRect_(t)}`)}_cloneSetting(){const t=this._setting.clone();return t.x_fontFamily=this._textSetting.x_fontFamily,t.x_fontSize=this._textSetting.x_fontSize,t.x_textColor=this._textSetting.x_textColor,t}static _setLineStyle_(t,e){let i=null;const n=Math.round(t.lineWidth);if(ScribblerLineStyle.SOLID==e)i=[];else if(ScribblerLineStyle.DASH==e){const t=Math.max(2,n);i=ScribblerLineStyle.dash_(t)}else if(ScribblerLineStyle.DOTTED==e){const t=Math.max(2,n);i=ScribblerLineStyle.dotted_(t)}null!=i&&t.setLineDash(i)}static setStrokeColor_(t,e){t.strokeStyle=e.toCSSString_()}static setFillColor_(t,e){t.fillStyle=e.toCSSString_()}static setFont_(t,e,i,n=null){e.loadFont_(i,()=>{t.font=i,t.textBaseline="hanging",null==n||n()})}static drawPath1_(t,e,i){const n=e.length;if(n>0){const s=e[0],o=e[1];t.beginPath(),t.moveTo(s,o);for(let i=2;i<n;i+=2){const n=e[i],s=e[i+1];t.lineTo(n,s)}i&&t.closePath()}return n}static drawCurve_(t,e,i,n){const s=i.length/2;if(e>0){let n=[];if(s>=3)for(let t=0;t<s-2;++t){const s=2*t;Scribbler._controls(n,e,i[s],i[s+1],i[s+2],i[s+3],i[s+4],i[s+5])}Scribbler._drawCurve1(t,n,i)}else Scribbler.drawPath1_(t,i,!1);return i}static drawRect_(t,e,i){const n=i[0],s=i[1],o=i[2],l=i[3];0==e?(t.beginPath(),t.moveTo(n,s),t.lineTo(o,s),t.lineTo(o,l),t.lineTo(n,l),t.closePath()):Scribbler._drawRoundRect1(t,e,n,s,o,l)}static putImage_(t,e,i,n,s){const o=n[0],l=n[1];if(e||i){const e=n[2],i=n[3];Scribbler.drawRect_(t,0,[o,l,o+e,l+i])}i&&t.fill(),t.putImageData(s,o,l),e&&t.stroke()}static _controls(t,e,i,n,s,o,l,a){const r=An.dist4_(i,n,s,o),_=r/(r+An.dist4_(s,o,l,a)),c=1-_,h=(l-i)*e,u=(a-n)*e;t.push(s-h*_),t.push(o-u*_),t.push(s+h*c),t.push(o+u*c)}static _drawCurve1(t,e,i){const n=i.length/2;if(0==n);else if(1==n)t.beginPath(),t.moveTo(i[0],i[1]);else if(2==n)t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]);else{t.beginPath(),t.moveTo(i[0],i[1]),t.quadraticCurveTo(e[0],e[1],i[2],i[3]);let s=2;for(;s<n-1;s+=1)t.bezierCurveTo(e[2*(2*(s-1)-1)],e[2*(2*(s-1)-1)+1],e[2*(s-1)*2],e[2*(s-1)*2+1],i[2*s],i[2*s+1]);t.quadraticCurveTo(e[2*(2*(s-1)-1)],e[2*(2*(s-1)-1)+1],i[2*s],i[2*s+1])}return n}static _drawRoundRect1(t,e,i,n,s,o){const l=s-i,a=o-n,r=Math.min((l<0?-l:l)/2,e),_=Math.min((a<0?-a:a)/2,e),c=Math.min(r,_),h=(s+i)/2;t.beginPath(),t.moveTo(h,n),t.arcTo(s,n,s,o,c),t.arcTo(s,o,i,o,c),t.arcTo(i,o,i,n,c),t.arcTo(i,n,h,n,c),t.closePath()}static _drawImage(t,e,i,n,s,o){const l=n[0],a=n[1],r=n[2],_=n[3];switch(i&&(Scribbler.drawRect_(t,0,[l,a,l+r,a+_]),t.fill()),s){case 0:t.drawImage(o,l,a,r,_);break;case 90:t.save(),t.translate(l+r,a),t.rotate(Math.PI/2),t.drawImage(o,0,0,_,r),t.restore();break;case 180:t.save(),t.translate(l+r,a+_),t.rotate(Math.PI),t.drawImage(o,0,0,r,_),t.restore();break;case 270:t.save(),t.translate(l,a+_),t.rotate(3*Math.PI/2),t.drawImage(o,0,0,_,r),t.restore()}e&&(Scribbler.drawRect_(t,0,[l,a,l+r,a+_]),t.stroke())}static _drawImageFromUri(t,e,i,n,s,o,l,a){const r=t.canvas.ownerDocument.createElement("img");r.addEventListener("load",o=>{Scribbler._drawImage(t,i,n,s,l,r),e.imageData$=t.getImageData(s[0],s[1],s[2],s[3]),t.restore(),null!=a&&a(null)}),r.addEventListener("error",t=>{null!=a&&(null==o&&(e.action$,ScribblerAction.IMAGE,o=MSG.string_(RS.Scribbler_MissingURIForImageAction)),a([o]))}),r.src=o}static _drawEllipse(t,e){const i=e[0],n=e[1],s=(e[2]-i)/2,o=(e[3]-n)/2;t.beginPath(),t.ellipse(i+s,n+o,s<0?-s:s,o<0?-o:o,0,0,360,!1)}}_destroyed=new WeakMap,Scribbler._DELAY=500;class IContextmenu{}class PopupBase{constructor(){this._dragger=null,this._dragstartCallback=null,this._actionCallback=null,this._tooltipsCallback=null,this._showCallback=null,this._cancelCallback=null,this._tooltipsTimer=null,this._tooltipsShown=!1,this._disabled=!1,_shown_1.set(this,!1),_destroyed_1.set(this,!1)}init_(t,e){this._contextmenu=t,this._smokescreen=e}setupHandlers_(t,e,i){this._contextmenu.style.pointerEvents="auto",Conf.useFlash&&new Flash(t,e,CSS.AnFlashLowlight,DEFUtil.flashDuration),An.addClickListenerMatching_(t,e,(t,e)=>{var i;if(An.stopevent_(e),!this._disabled&&null!=t&&!t.classList.contains(CSS.AnDisabled)){const n=t.getAttribute(ATTR.AnAction);if(null!=n&&n.length>0)try{null===(i=this._actionCallback)||void 0===i||i.call(this,n,e,t)}catch(t){}}}),An.addEventListenerMatching_(t,Conf.touchstart,i,(t,e)=>{this._stopTooltipsTimer(),this._tooltipsShown=!1,this._tooltipsTimer=new Timer(DEFUtil.durationTooltips$,()=>{An.stopevent_(e),this._tooltipsTimer=null,this._tooltipsShown=!0,null!=this._tooltipsCallback&&this._tooltipsCallback(t,e)})}),An.onTouchEnd_(this._contextmenu,t=>{this._stopTooltipsTimer(),this._tooltipsShown&&(An.stopevent_(t),this._tooltipsShown=!1)})}_stopTooltipsTimer(){null!=this._tooltipsTimer&&(this._tooltipsTimer.cancel_(),this._tooltipsTimer=null)}createSmokescreen_(t,e=DEF.zindexContextmenu+DEF.zindexUnder){const i=new Smokescreen(t,e);return i.on_("click",t=>{An.stopevent_(t),null!=this._cancelCallback?this._cancelCallback():this.hide_()}),i}onTooltips_(t){return this._tooltipsCallback=t,this}onDrag_(t){return this._dragstartCallback=t,this}onAction_(t){return this._actionCallback=t,this}onCancel_(t){return this._cancelCallback=t,this}onShow_(t){return this._showCallback=t,this}element_(){return this._contextmenu}isShown_(){return __classPrivateFieldGet(this,_shown_1)}getSmokescreen_(){return this._smokescreen}show_(t){return this.showAt_(t.pageX,t.pageY),this}showAt_(t,e){var i;if(__classPrivateFieldGet(this,_shown_1)||null==this._contextmenu)return;__classPrivateFieldSet(this,_shown_1,!0),An.showHidden_(this._contextmenu),null!=this._showCallback&&this._showCallback();const n=this._contextmenu.children.item(0);if(null!=n){const t=Math.ceil(n.getBoundingClientRect().width);n.style.width=`${t}px`}const s=this._contextmenu.getBoundingClientRect();let o=e,l=t-s.width/2;const a=o+s.height-window.innerHeight;a>0&&(o-=a),o<0&&(o=0);const r=window.innerWidth-s.width;l>r&&(l=r),l<0&&(l=0),null===(i=this._smokescreen)||void 0===i||i.show_(),null==this._dragger&&null!=this._dragstartCallback&&(this._dragger=new Dragger(this._contextmenu,new DefaultDraggerHandler(this._dragstartCallback)).bind_()),An.setVisibleAt_(this._contextmenu,Math.round(l),Math.round(o))}hide_(){var t;__classPrivateFieldGet(this,_shown_1)&&(__classPrivateFieldSet(this,_shown_1,!1),this._stopTooltipsTimer(),null===(t=this._smokescreen)||void 0===t||t.hide_(),null!=this._contextmenu&&An.hide_(this._contextmenu))}destroy_(){__classPrivateFieldGet(this,_destroyed_1)||(__classPrivateFieldSet(this,_destroyed_1,!0),this.hide_(),null!=this._dragger&&(this._dragger.destroy_(),this._dragger=null),null!=this._smokescreen&&this._smokescreen.destroy_(),null!=this._contextmenu&&this._contextmenu.remove(),this._dragstartCallback=null,this._actionCallback=null,this._tooltipsCallback=null)}}_shown_1=new WeakMap,_destroyed_1=new WeakMap;class ContextmenuBase{constructor(t){this._contextmenu=t,this._smokescreen=null,this._cancelCallback=null,this._tooltipsKeyCallback=null,this._onShowCallback=null,this._dragger=null,this._tooltipsTimer=null,this._tooltipsShown=!1,this._shown=!1}get smokescreen$(){return this._smokescreen}set smokescreen$(t){this._smokescreen=t}get element$(){return this._contextmenu}setupHandlers_(t,e){this._contextmenu.style.pointerEvents="auto",An.addEventListenerMatching_(t,Conf.touchstart,`[${ATTR.xTooltips}]`,(t,e)=>{this._stopTooltipsTimer(),this._tooltipsShown=!1,this._tooltipsTimer=new Timer(DEFUtil.durationTooltips$,()=>{this._tooltipsTimer=null,this._tooltipsShown=!0,null!=this._tooltipsKeyCallback&&this._tooltipsKeyCallback(t,e)})}),An.onTouchEnd_(t,t=>{this._stopTooltipsTimer(),this._tooltipsShown&&(this._tooltipsShown=!1,An.stopevent_(t))}),Conf.useFlash&&null!=e&&new Flash(t,e,CSS.AnFlashLowlight,DEFUtil.flashDuration)}onTooltipsKey_(t){return this._tooltipsKeyCallback=t,this}onShow_(t){return this._onShowCallback=t,this}_stopTooltipsTimer(){null!=this._tooltipsTimer&&(this._tooltipsTimer.cancel_(),this._tooltipsTimer=null)}above_(t){return null==this._contextmenu?this:(this._contextmenu.style.zIndex=An.above_(t).toString(),this)}onCancel_(t){return this._cancelCallback=t,this}onAction_(t){return null==this._contextmenu?this:(An.addClickListenerMatching_(this._contextmenu,`[${ATTR.AnAction}]`,(e,i)=>{if(An.stopevent_(i),null==e||e.classList.contains(CSS.AnDisabled))return;const n=e.getAttribute(ATTR.AnAction);null!=n&&n.length>0&&t(n,e,i)}),this)}onContextmenu_(t){return An.addContextmenuListenerMatching_(this._contextmenu,`[${ATTR.xTooltips}]`,t),this}show_(t,e,i=!0){var n;if(this._shown||null==this._contextmenu)return this;this._shown=!0,An.showHidden_(this._contextmenu);let s=ElementUtil.getChildWithTagAndClass_(this._contextmenu,"TABLE",CSS.AnContextmenu);null!=s&&(s.style.width=`${s.getBoundingClientRect().width}px`);const o=cache$.ui$.buttonSize_(),l=this._contextmenu.getBoundingClientRect(),a=Math.round(l.width);let r=Math.round(l.height);const _=DEF.contextmenuMargin/2;let c=Math.round(e)-DEF.contextmenuMargin;i&&(c-=r/2,c=Math.round(Math.max(c,3*o/2)));let h=Math.round(t-a/2+_);const u=window.innerWidth-a;h>u&&(h=u),h<0&&(h=0);const d=window.innerHeight;return c+r>=d&&(c=d-r-_),c<_&&(c=_),null===(n=this._onShowCallback)||void 0===n||n.call(this),null!=this._smokescreen&&this._smokescreen.show_(),An.setVisibleAt_(this._contextmenu,h,c),null==this._dragger&&(this._dragger=new Dragger(this._contextmenu,new DefaultDraggerHandler(Contextmenu.contextmenuDragOK_)).bind_()),this}cancel_(){var t;null===(t=this._cancelCallback)||void 0===t||t.call(this),this.hide_()}hide_(){this._hide()}_hide(){this._shown&&(this._shown=!1,this._stopTooltipsTimer(),null!=this._smokescreen&&this._smokescreen.hide_(),null!=this._contextmenu&&An.hide_(this._contextmenu))}destroy_(){this._hide(),null!=this._dragger&&(this._dragger.destroy_(),this._dragger=null),this._contextmenu.remove(),null!=this._smokescreen&&(this._smokescreen.destroy_(),this._smokescreen=null)}isShown_(){return this._shown}static createnoop_(t){t.peek_().td_(["class",`${CSS.AnContextButton} ${CSS.AnDisabled}`],[ATTR.AnAction,DEF.NOOP])}}class Contextmenu extends PopupBase{constructor(t,e,i){super(),this.container=t,this.zindex=e,this.infos=i,this._buttons=new Map;const n=this.createContextmenu_(this.container,this.zindex,this.infos);this.init_(n,this.createSmokescreen_(t,e+DEF.zindexUnder)),this.setupHandlers_(n,`[${ATTR.AnAction}]`,`[${ATTR.xTooltips}]`)}createContextmenu_(t,e,i){const n=DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnContextmenu,style:`display:none;z-index:${e}`}).push_(),s=n.cursor_();return n.table1_(CSS.AnContextmenu),this._createContextmenuButtons(this._buttons,n,i),t.append(s),s}_createContextmenuButtons(t,e,i){var n;e.push_();for(const s of i){e.peek_().tr_().push_();for(const i of s){const s=i[ATTR.AnAction];null!=s&&(s==DEF.NOOP?e.peek_().td_(["class",`${CSS.AnContextButton} ${CSS.AnDisabled}`],[ATTR.AnAction,DEF.NOOP]):e.peek_().td_(["class",`${CSS.AnContextButton} ${i.class}`],[ATTR.AnAction,s],[ATTR.xTooltips,null!==(n=i[ATTR.xTooltips])&&void 0!==n?n:""]),t.set(s,e.cursor_()))}e.pop_()}e.pop_()}self_(){return this}button_(t){const e=this._buttons.get(t);if(void 0===e)throw new Error(t);return e}enableButton_(t,e){An.enableButton_(this.button_(t),e)}enableButtonIfExists_(t,e){const i=this._buttons.get(t);void 0!==i&&An.enableButton_(i,e)}enableButtons_(t,e){for(const i of t)An.enableButton_(this.button_(i),e)}}Contextmenu.contextmenuDragOK_=(t,e,i,n)=>{const s=DomUt.asHTMLElement_(e);return null!=s&&("TABLE"==s.nodeName||"DIV"==s.nodeName)&&(s.classList.contains(CSS.AnContextmenu)||s.classList.contains(CSS.AnVerticalMenu))};class Toolbar{constructor(t,e){this._buttons=new Map,this._title=null,this._actionCallback=null,this._tooltipsCallback=null,this._tooltipsTimer=null,this._tooltipsShown=!1,this._disabled=!1,this._isShown=!0,this._toolbar=Toolbar.createToolbar_(this._buttons,t,e),Conf.useFlash&&new Flash(this._toolbar,`div[${ATTR.AnAction}]`,CSS.AnFlashLowlight,DEFUtil.flashDuration),this._toolbar.style.pointerEvents="auto",An.addClickListenerMatching_(this._toolbar,`div[${ATTR.AnAction}]`,(t,e)=>{if(An.stopevent_(e),null!=this._actionCallback&&!this._disabled&&null!=t&&!t.classList.contains(CSS.AnDisabled)){const i=t.getAttribute(ATTR.AnAction);if(null!=i&&i.length>0)try{this._actionCallback(i,e,t)}catch(t){}}}),An.addEventListenerMatching_(this._toolbar,Conf.touchstart,`div[${ATTR.xTooltips}]`,(t,e)=>{this._stopTooltipsTimer(),this._tooltipsShown=!1,this._tooltipsTimer=new Timer(DEFUtil.durationTooltips$,()=>{this._tooltipsTimer=null,this._tooltipsShown=!0,null!=this._tooltipsCallback&&this._tooltipsCallback(t,e)})}),An.onTouchEnd_(this._toolbar,t=>{this._stopTooltipsTimer(),this._tooltipsShown&&(this._tooltipsShown=!1,An.stopevent_(t))})}_stopTooltipsTimer(){null!=this._tooltipsTimer&&(this._tooltipsTimer.cancel_(),this._tooltipsTimer=null)}element_(){return this._toolbar}isShown_(){return this._isShown}buttons_(){return this._buttons}getButtons_(t){for(let[e,i]of this._buttons)t.set(e,i)}button_(t){const e=this._buttons.get(t);if(void 0===e)throw new Error(t);return e}buttonIfExists_(t){const e=this._buttons.get(t);return void 0===e?null:e}hasButton_(t){return void 0!==this._buttons.get(t)}enableButton_(t,e){const i=this._buttons.get(t);if(void 0===i)throw new Error(t);return e?i.classList.remove(CSS.AnDisabled):i.classList.add(CSS.AnDisabled),this}enableButtons_(t,e){for(const i of t)this.enableButton_(i,e)}showButtonIfExists_(t,e){this.hasButton_(t)&&this.showButton_(t,e)}showButton_(t,e){const i=this.button_(t);e?An.show_(i):An.hide_(i)}showButtons_(t,e){for(const i of t)this.showButton_(i,e)}querySelector_(t){return this._toolbar.querySelector(t)}onAction_(t){return this._actionCallback=t,this}onTooltips_(t){return this._tooltipsCallback=t,this}destroy_(){null!=this._toolbar&&(this.hide_(),this._actionCallback=null,this._tooltipsCallback=null,this._buttons.clear(),this._toolbar.remove(),this._isShown=!1)}hide_(){this._stopTooltipsTimer(),An.hide_(this._toolbar),this._isShown=!1}show_(){An.showVisible_(this._toolbar),this._isShown=!0}showHidden_(){An.showHidden_(this._toolbar),this._isShown=!1}enable_(t){this._disabled=!t,this._toolbar.style.opacity=(t?DEF.opacityEnabled:DEF.opacityDisabled).toString()}isEnabled_(){return!this._disabled}get title$(){return this._title}titleKey_(t){return this.titleText_(MSG.string_(t))}titleText_(t){return null==this._title&&(this._title=new DomBuilderEx(this._toolbar).childBefore_(this._toolbar.firstChild,"div",{class:CSS.AnTitle}).cursor_()),this._title.textContent=t,this}static createToolbar_(t,e,i){const n=Toolbar.createToolbarOffline_(t,e.ownerDocument,i);return e.append(n),n}static createToolbarOffline_(t,e,i){const n=DomBuilderEx.offline1_(e,"div",CSS.AnToolbar).push_(),s=n.cursor_();for(const e of i){const i=void 0!==e[ATTR.placeholder],s=i?Conf.input:"div";if(n.peek_().child_(s,e),null!=t){const i=e[ATTR.AnAction];null!=i&&t.set(i,n.cursor_())}if(i){const t=n.cursor_();An.onInputFocusSelect_(t)}}return s}}class AnClipboard{constructor(){this._content=null}map_(t){this._content=new Map(t.entries()),this._content.set(MapClipboardKey.kind,MapClipboardKind.map)}dom_(t,e){this._content=new Map([[MapClipboardKey.kind,MapClipboardKind.dom],[MapClipboardKey.value,t],[MapClipboardKey.context,e]])}string_(t){this._content=new Map([[MapClipboardKey.kind,MapClipboardKind.string],[MapClipboardKey.value,t]])}get_(){return null==this._content?null:new Map(this._content)}isEmpty_(){return null==this._content}clear_(){this._content=null}}const clipboard$=new AnClipboard;class _HistoryItem{constructor(t,e,i){this._labelkey=t,this._detail=e,this._records=i}get labelkey$(){return this._labelkey}get detail$(){return this._detail}get records$(){return this._records[Symbol.iterator]()}get reversed$(){return this._records.reverse()[Symbol.iterator]()}}class ICommandHistory{}class CommandHistory{constructor(t,e=DEFUtil.undoHistorySize){this._native=t,this._size=e,this._body=null,this._group=[],this._groupStack=[],this._details=[],this._history=[],this._redo=[],this._prev=null,this._undoing=!1,this._redoing=!1,this._undoLevel=0,this._redoLevel=0,this._observer=null,this._limiter=new RateLimiter(200),this._onUndoEmptyListeners=[],this._onUndoneListeners=[],this._onRedoEmptyListeners=[],this._onRedoneListeners=[],this._bad=0}_fixup(t){this._limiter.queue_((t,e)=>{const i=this._native.getIFrameSelectionRange_();this._native.iClearSelection_(),Timer.sleep0_(()=>{this._native.iSelectRange_(i)})})}_observerCallback(t,e){var i;const n=t.length,s=[];let o=null;t:for(let e=0;e<n;this._prev=t[e],++e){const n=t[e],l=n.type,a=n.target;if("childList"!=l&&(this._bad=0),"attributes"==l){const t=n.attributeName,e=n.oldValue;if("BODY"==a.nodeName)switch(t){case ATTR.AnUndoing:this._process(s),this._undoing=An.isempty_(e);continue t;case ATTR.AnRedoing:this._process(s),this._redoing=An.isempty_(e);continue t;case ATTR.AnToggleGroup:const o=null!==(i=n.oldValue)&&void 0!==i?i:"";let l=""!=o&&this._details.length>0?this._details.shift():"";this._group.length>0&&o!=RS.HistoryIgnore&&s.push(new _HistoryItem(o,l,this._group)),this._group=[];continue t}}else if("characterData"==l){if(null!=this._prev&&"characterData"==this._prev.type&&this._prev.target==a)continue t}else if("childList"==l&&null!=o&&null!=this._prev&&"childList"==this._prev.type){if(this._prev.target==a&&this._prev.previousSibling==n.previousSibling){const t=n.addedNodes,e=n.removedNodes,i=this._prev.addedNodes,s=this._prev.removedNodes;if(null!=t&&null!=e&&null!=i&&null!=s){const n=t.length,l=e.length,a=i.length,r=s.length;if(0==n&&1==l&&1==a&&0==r&&e[0]==i[0]||1==n&&0==l&&0==a&&1==r&&t[0]==s[0]){o.pop(),o=null,this._prev=null,++this._bad;continue t}}}this._bad=0}this._group.push(n),o=this._group}this._bad>=CommandHistory.MAX_BAD&&(this._fixup(this._bad),this._bad=0),this._process(s)}_process(t){t.length>0&&(this._undoing?this._processUndoRecords(t):this._processNormalRecords(t),t.length=0)}_processUndoRecords(t){const e=t.length,i=0==this._redo.length;for(let i=0;i<e;++i)this._redo.push(t[i]);i!=(0==this._redo.length)&&this._fireOnRedoEmpty(0==this._redo.length)}_processNormalRecords(t){this._redoing||(this._redo.length=0,this._fireOnRedoEmpty(!0));const e=t.length,i=0==this._history.length;let n;if(e>=this._size)this._history.length=0,n=e-this._size;else{n=0;const t=this._history.length;t+e>this._size&&this._history.splice(0,e+t-this._size)}for(let i=n;i<e;++i)this._history.push(t[i]);i!=(0==this._history.length)&&this._fireOnUndoEmpty(0==this._history.length)}connect_(){if(null==this._observer){this._group=[],this._undoing=!1,this._redoing=!1,this._undoLevel=0,this._redoLevel=0;const t=this._native.getIFrameDocument_();if(null==t)return;const e=t.body;e.setAttribute(ATTR.AnToggleGroup,"");const i=this._native.createMutationObserver_((t,e)=>this._observerCallback(t,e));this._body=e,this._observer=i,i.observe(this._body,CommandHistory._EVERYTHING)}}disconnect_(){this.clear_(),this._onUndoEmptyListeners.length=0,this._onUndoneListeners.length=0,this._onRedoEmptyListeners.length=0,this._onRedoneListeners.length=0,this._body=null,null!=this._observer&&(this._observer.disconnect(),this._observer=null)}clear_(){this._group=[],this._prev=null,this._undoing=!1,this._groupStack.length=0;let t=0==this._history.length;this._history.length=0,t||this._fireOnUndoEmpty(!0),t=0==this._redo.length,this._redo.length=0,t||this._fireOnRedoEmpty(!0)}destroy_(){this.disconnect_(),this._observer=null,this._history.length=0,this._redo.length=0,this._groupStack.length=0,this._onUndoEmptyListeners.length=0,this._onUndoneListeners.length=0,this._onRedoEmptyListeners.length=0,this._onRedoneListeners.length=0}getDescription_(t){if(t<0||t>=this._history.length)return"";const e=this._history[t];if(e instanceof _HistoryItem){let t=MSG.string_(e.labelkey$);return""==t?"???":(An.isempty_(e.detail$)||(t+=": "+e.detail$),t)}const i=e;switch(i.type){case"attributes":const t=i.attributeName,e=i.oldValue;return An.truncate_(MSG.string_(RS.history_attributes)+`: ${t}=${e}`,DEF.historyTextLength);case"characterData":const n=i.oldValue;return An.truncate_(MSG.string_(RS.history_text)+`: ${n}`,DEF.historyTextLength);case"childList":const s=i.target.nodeName;return MSG.string_(RS.history_node)+`: ${s}`;default:return""}}undo_(t=1){if(0==this._history.length||0==t)return!1;for(;--t>=0&&0!=this._history.length;){const t=this._history.pop();if(t instanceof _HistoryItem){const e=t.labelkey$,i=MSG.string_(e);this._startUndo(),this.startGroup_(e,t.detail$);for(const e of t.reversed$)this._undo1(!0,e);this.endGroup_(),this._endUndo(),this._fireOnUndone(i)}else t instanceof MutationRecord&&(this._startUndo(),this._undo1(!0,t),this._endUndo(),this._fireOnUndone(null))}return 0==this._history.length&&this._fireOnUndoEmpty(!0),!0}_undo1(t,e){var i;const n=e.type,s=e.target;switch(n){case"attributes":{const t=e.attributeName;if(null!=t){const n=null!==(i=e.oldValue)&&void 0!==i?i:"";s.setAttribute(t,n)}break}case"characterData":{const t=e.oldValue;s.nodeValue=t;break}case"childList":{const t=e.addedNodes,i=e.removedNodes;for(let e=0,i=t.length;e<i;++e){const i=t[e],n=i.parentNode;null==n||n.removeChild(i)}const n=i.length;if(n>0){const t=e.nextSibling;let o;null!=t?null==(o=t.parentNode)&&(o=s):o=s;for(let e=0;e<n;++e){const n=i[e];o.insertBefore(n,t)}}break}default:Assert.notReach_(`${MSG.string_(RS.UnsupportedMutationRecordType_)}${n}`)}}redo_(){if(0==this._redo.length)return!1;const t=this._redo.pop();if(t instanceof _HistoryItem){const e=t.labelkey$,i=MSG.string_(e);this._startRedo(),this.startGroup_(e,t.detail$);for(const e of t.reversed$)this._undo1(!1,e);this.endGroup_(),this._endRedo(),this._fireOnRedone(i)}else t instanceof MutationRecord&&(this._startRedo(),this._undo1(!1,t),this._endRedo(),this._fireOnRedone(null));return 0==this._redo.length&&this._fireOnRedoEmpty(!0),!0}group_(t,e,i){this.startGroup_(t,e);try{return i()}finally{this.endGroup_()}}asyncGroup_(t,e,i){this.startGroup_(t,e),i(()=>{this.endGroup_()})}startGroup_(t,e){null!=this._body&&(this._groupStack.push(t),1==this._groupStack.length&&(this._details.push(e),this._body.setAttribute(ATTR.AnToggleGroup,t)))}endGroup_(){null!=this._body&&0!=this._groupStack.length&&(this._groupStack.pop(),0==this._groupStack.length&&this._body.setAttribute(ATTR.AnToggleGroup,""))}_startUndo(){null!=this._body&&(++this._undoLevel,1==this._undoLevel&&this._body.setAttribute(ATTR.AnUndoing,"true"))}_endUndo(){null!=this._body&&this._undoLevel>0&&(--this._undoLevel,0==this._undoLevel&&this._body.setAttribute(ATTR.AnUndoing,""))}_startRedo(){null!=this._body&&(++this._redoLevel,1==this._redoLevel&&this._body.setAttribute(ATTR.AnRedoing,"true"))}_endRedo(){null!=this._body&&this._redoLevel>0&&(--this._redoLevel,0==this._redoLevel&&this._body.setAttribute(ATTR.AnRedoing,""))}groups_(){return Array.from(this._groupStack)}isUndoEmpty_(){return 0==this._history.length}isRedoEmpty_(){return 0==this._redo.length}length_(){return this._history.length}records(){return this._history[Symbol.iterator]()}addOnUndoEmptyListener_(t){this._onUndoEmptyListeners.push(t)}addOnUndoneListener_(t){this._onUndoneListeners.push(t)}addOnRedoEmptyListener_(t){this._onRedoEmptyListeners.push(t)}addOnRedoneListener_(t){this._onRedoneListeners.push(t)}_fireOnUndone(t){for(const e of this._onUndoneListeners)e(t)}_fireOnUndoEmpty(t){for(const e of this._onUndoEmptyListeners)e(t)}_fireOnRedone(t){for(const e of this._onRedoneListeners)e(t)}_fireOnRedoEmpty(t){for(const e of this._onRedoEmptyListeners)e(t)}}CommandHistory.MAX_BAD=64,CommandHistory._EVERYTHING={childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0};const history$=new CommandHistory(native$);class INPUT{static info_(t){return INPUT._INFOS[t]}static searchbox(t,e){const i=StringMap.copyOf_(INPUT._INFOS[INPUT.SearchBox]);return i.placeholder=MSG.string_(t),i.tabindex=e,i}static optionalAttributes(t,e){return smap_(["class",`${CSS.AnPromptTextarea} ${t} ${CSS.AnPromptAttributes}`],["tabindex",e],["placeholder",MSG.string_(RS.Attributes)],["style","word-break:break-all;"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])}}INPUT.FilterBox="Xey",INPUT.TextareaEditText="X94",INPUT.PromptInputAutoFocus="Xe6",INPUT.SearchBox="Xwu",INPUT.TextareaOptionalAttributesFull="XiX",INPUT.Filename="X3U",INPUT.PromptInput="Xqw",INPUT.LineNumber="XAp",INPUT._INFOS=smap_([INPUT.Filename,smap_(["class",CSS.AnFilename],["rows","1"],[ATTR.autocapitalize,"none"],[ATTR.autocorrect,"off"],[ATTR.autocomplete,"off"],[ATTR.spellcheck,"false"])],[INPUT.FilterBox,smap_(["class",CSS.AnSearchbox],["placeholder",MSG.string_(RS.Tooltips_Filter)],["rows","1"],["tabindex","1"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])],[INPUT.LineNumber,smap_(["class",CSS.AnLineNumberInput],["placeholder",""],["rows","1"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])],[INPUT.PromptInput,smap_(["class",CSS.AnPromptInput],["rows","1"],["tabindex","1"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])],[INPUT.PromptInputAutoFocus,smap_(["class",CSS.AnPromptInput],["placeholder",""],["rows","1"],["tabindex","1"],["autofocus","true"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])],[INPUT.SearchBox,smap_(["class",CSS.AnSearchbox],["placeholder",MSG.string_(RS.Tooltips_Search)],["rows","1"],["tabindex","1"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])],[INPUT.TextareaEditText,smap_(["class",`${CSS.AnPromptTextarea} ${CSS.AnFull}`],["placeholder",MSG.string_(RS.Text)],["tabindex","1"],["autofocus","true"],["style","white-space:pre-wrap;min-height:20vh;max-height:40vh"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"on"],[ATTR.autocorrect,"on"],[ATTR.spellcheck,"true"])],[INPUT.TextareaOptionalAttributesFull,smap_(["class",`${CSS.AnPromptTextarea} ${CSS.AnFull} ${CSS.AnPromptAttributes}`],["tabindex","1"],["placeholder",MSG.string_(RS.Attributes)],["style","word-break:break-all;"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])]);class BUT{static infos_(...t){const e=[];for(let i of t)e.push(BUT._INFOS[i]);return e}static info_(t){return BUT._INFOS[t]}}BUT.PrevBlog="Xprb",BUT.NextBlog="Xnxb",BUT.CutFile="XMd",BUT.Font="X1s",BUT.Searchbar="Xdb",BUT.CollapseAll="X6o",BUT.Refresh="XGY",BUT.Indent="X7u",BUT.CloneFile="XfE",BUT.ImportExportCopy="XDd",BUT.Reset="XMy",BUT.Cancel="XX5",BUT.EditEvent="XqB",BUT.Apply="XR0",BUT.Backup="Xbac",BUT.RecordAudio="Xbi",BUT.RulesetEdit="XRl",BUT.RegexSearch="Xol",BUT.RegexSearch1="Xol1",BUT.Settings="Xtg",BUT.ImportExportMove="XFp",BUT.ScanDocument="XPQ",BUT.ExtendSelection="XAq",BUT.Gradient="Xbm",BUT.Gradient1="Xgd1",BUT.Today="XvI",BUT.ClearEvents="XMo",BUT.GenerateGallery="Xb6",BUT.Filterbar="Xgo",BUT.PasteFromLocalClipboard="Xbp",BUT.Stop="XmH",BUT.Discard="Xiv",BUT.CreateThumbnail="XYv",BUT.ImportImageFromPhotoLibrary="Xck",BUT.Down="Xfr",BUT.Child="XmG",BUT.Nbsp="X98",BUT.Contextmenu="XjD",BUT.Mkdir="Xx6",BUT.OpenDocument="XWK",BUT.TargetDocument="XWD",BUT.ShowBrokenOnly="Xwy",BUT.FixPerspective="Xih",BUT.DeleteEmptyDirs="XkG",BUT.Noop="XYJ",BUT.NextMatch="XTh",BUT.Crop="Xhd",BUT.TakePhoto="XoO",BUT.ClearHistory="X2n",BUT.PrevPage="XX8",BUT.RemoveStyles="Xym",BUT.Search="XCX",BUT.CreateLink="XRk",BUT.After="XJA",BUT.NextPage="XUn",BUT.CloneObject="XdV",BUT.Preview="XKn",BUT.CleanupTrash="Xft",BUT.RecognizeText="XJR",BUT.Restore="Xd9",BUT.RestoreData="Xd9d",BUT.ResetUISettings="Xe5",BUT.OpenStylesheet="XfG",BUT.ClearSearchText="XmJ",BUT.ClearSearchText1="XmJ1",BUT.Fit="Xyq",BUT.Help="XGP",BUT.ExportToPhotoLibrary="X7t",BUT.ExportToFile="Xetf",BUT.Folder1="XJh",BUT.RemoveBrokenEntries="XIm",BUT.EditLink="XdK",BUT.RulesetRemove="XHH",BUT.NewGame="XA4",BUT.PickImage="Xqx",BUT.PickImage1="Xpi1",BUT.RecordVideo="XSP",BUT.GenerateBarcode="Xxj",BUT.Keyboard="X6p",BUT.CreateEvent="X6a",BUT.Save="X0e",BUT.Dismiss="Xrr",BUT.EscapeText="XUP",BUT.InitialDir="XRZ",BUT.RenameFile="XHo",BUT.Folder="XdX",BUT.CopyToLocalClipboard="XRm",BUT.Date="XCn",BUT.CopyFile="XjP",BUT.ShowDoneEvents="Xfg",BUT.IgnoreCaseFilter="Xx4",BUT.Symbol="Xo3",BUT.Nobackup="XNt",BUT.Filter="Xsr",BUT.ImageFilter1="Xsr1",BUT.ShowBackground="Xhy",BUT.MoveDown="Xzl",BUT.RotateImage="XMQ",BUT.Remove="XwY",BUT.DeleteFile="Xbr",BUT.DeleteKey1="Xbrk",BUT.ImportKey="Xadd",BUT.Undo="XHT",BUT.PasteFile="XJY",BUT.CutToLocalClipboard="Xp1",BUT.RulesetAdd="XpO",BUT.PathKind="Xhw",BUT.Move="XnH",BUT.PrevMatch="XwZ",BUT.Color="Xic",BUT.Color1="Xic1",BUT.Glass="XbE",BUT.Info="XXg",BUT.MoveUp="XTD",BUT.Redo="X3N",BUT.Recover="Xrec",BUT.ExpandAll="Xzg",BUT.TargetDate="XrI",BUT.Toolbar1="XpG",BUT.Clear="XUQ",BUT.Clear1="Xcl1",BUT.Spacer="XDS",BUT.IgnoreCase="XAo",BUT.Image="XUW",BUT.Edit="XoK",BUT.Edit1="XoK1",BUT.RuleAdd="XmM",BUT.Toolbar2="XiT",BUT.CurrentDocument="Xoq",BUT.Up="XMM",BUT.Toolbar="XkR",BUT.BarcodeScan="XLi",BUT.OK="Xxl",BUT.Sync="Xsyn",BUT.RootFolder="Xroo",BUT.ImageConversion="Xcim",BUT.Sort="Xsrt",BUT._INFOS=smap_([BUT.After,smap_([ATTR.AnAction,BUT.After],[ATTR.xTooltips,RS.Tooltips_InsertAsNextSibling],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaHandODown}`])],[BUT.Apply,smap_([ATTR.AnAction,BUT.Apply],[ATTR.xTooltips,RS.Tooltips_Apply],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCheck}`])],[BUT.Backup,smap_([ATTR.AnAction,BUT.Backup],[ATTR.xTooltips,RS.BackupExportTooltips],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSave}`],["style","display:none;"])],[BUT.Cancel,smap_([ATTR.AnAction,BUT.Cancel],[ATTR.xTooltips,RS.Tooltips_Cancel],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaClose}`])],[BUT.Child,smap_([ATTR.AnAction,BUT.Child],[ATTR.xTooltips,RS.Tooltips_InsertAsFirstChild],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaHandORight}`])],[BUT.CleanupTrash,smap_([ATTR.AnAction,BUT.CleanupTrash],[ATTR.xTooltips,RS.Tooltips_Cleanup],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaShower}`])],[BUT.Clear,smap_([ATTR.AnAction,BUT.Clear],[ATTR.xTooltips,RS.Tooltips_Clear],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.Clear1,smap_([ATTR.AnAction,BUT.Clear1],[ATTR.xTooltips,RS.Tooltips_Clear],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.ClearEvents,smap_([ATTR.AnAction,BUT.ClearEvents],[ATTR.xTooltips,RS.Tooltips_ClearEvents],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.ClearHistory,smap_([ATTR.AnAction,BUT.ClearHistory],[ATTR.xTooltips,RS.Tooltips_ClearHistory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.ClearSearchText,smap_([ATTR.AnAction,BUT.ClearSearchText],[ATTR.xTooltips,RS.Tooltips_ClearSearchText],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.ClearSearchText1,smap_([ATTR.AnAction,BUT.ClearSearchText1],[ATTR.xTooltips,RS.Tooltips_ClearSearchText],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.CloneFile,smap_([ATTR.AnAction,BUT.CloneFile],[ATTR.xTooltips,RS.Tooltips_CloneFile],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaClone}`])],[BUT.CloneObject,smap_([ATTR.AnAction,BUT.CloneObject],[ATTR.xTooltips,RS.Tooltips_CloneObject],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaClone}`])],[BUT.CollapseAll,smap_([ATTR.AnAction,BUT.CollapseAll],[ATTR.xTooltips,RS.Tooltips_CollapseAll],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMinusSquareO}`])],[BUT.Color,smap_([ATTR.AnAction,BUT.Color],[ATTR.xTooltips,RS.Tooltips_PickColor],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSpinner}`])],[BUT.Color1,smap_([ATTR.AnAction,BUT.Color1],[ATTR.xTooltips,RS.Tooltips_PickColor],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaSpinner}`])],[BUT.Contextmenu,smap_([ATTR.AnAction,BUT.Contextmenu],[ATTR.xTooltips,RS.Tooltips_Contextmenu],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaToggleDown}`])],[BUT.ImageConversion,smap_([ATTR.AnAction,BUT.ImageConversion],[ATTR.xTooltips,RS.Tooltips_ImageConversion],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaExchange}`])],[BUT.CopyFile,smap_([ATTR.AnAction,BUT.CopyFile],[ATTR.xTooltips,RS.Tooltips_CopyFileOrDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCopy}`])],[BUT.CopyToLocalClipboard,smap_([ATTR.AnAction,BUT.CopyToLocalClipboard],[ATTR.xTooltips,RS.Tooltips_CopyToLocalClipboard],["class",`${CSS.Fa} ${CSS.FaCopy}`])],[BUT.CreateEvent,smap_([ATTR.AnAction,BUT.CreateEvent],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPlus}`],[ATTR.xTooltips,RS.Tooltips_CreateEvent])],[BUT.CreateLink,smap_([ATTR.AnAction,BUT.CreateLink],[ATTR.xTooltips,RS.Tooltips_CreateLink],["class",`${CSS.AnButton} ${CSS.AnButtonFlat} ${CSS.Fa} ${CSS.FaLink}`])],[BUT.CreateThumbnail,smap_([ATTR.AnAction,BUT.CreateThumbnail],[ATTR.xTooltips,RS.Tooltips_CreateThumbnail],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaThumbsOUp}`])],[BUT.Crop,smap_([ATTR.AnAction,BUT.Crop],[ATTR.xTooltips,RS.CropTooltips],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCrop}`])],[BUT.CutFile,smap_([ATTR.AnAction,BUT.CutFile],[ATTR.xTooltips,RS.Tooltips_CutFileOrDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCut}`])],[BUT.CutToLocalClipboard,smap_([ATTR.AnAction,BUT.CutToLocalClipboard],[ATTR.xTooltips,RS.Tooltips_CutToLocalClipboard],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCut}`])],[BUT.CurrentDocument,smap_([ATTR.AnAction,BUT.CurrentDocument],[ATTR.xTooltips,RS.Tooltips_GotoCurrentDocumentDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFlag}`])],[BUT.Date,smap_([ATTR.AnAction,BUT.Date],[ATTR.xTooltips,RS.Tooltips_InsertDateTimeString],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaClockO}`])],[BUT.DeleteEmptyDirs,smap_([ATTR.AnAction,BUT.DeleteEmptyDirs],[ATTR.xTooltips,RS.Tooltips_RemoveEmptyDirs],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFolderO}`])],[BUT.DeleteFile,smap_([ATTR.AnAction,BUT.DeleteFile],[ATTR.xTooltips,RS.Tooltips_DeleteFileOrDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMinus}`])],[BUT.DeleteKey1,smap_([ATTR.AnAction,BUT.DeleteKey1],[ATTR.xTooltips,RS.BackupKeyDeleteTooltips],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaMinus}`])],[BUT.Discard,smap_([ATTR.AnAction,BUT.Discard],[ATTR.xTooltips,RS.Tooltips_Discard],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTrash}`])],[BUT.Dismiss,smap_([ATTR.AnAction,BUT.Dismiss],[ATTR.xTooltips,RS.Tooltips_Dismiss],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaClose}`])],[BUT.Down,smap_([ATTR.AnAction,BUT.Down],[ATTR.xTooltips,RS.Tooltips_Down],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowDown}`])],[BUT.Edit,smap_([ATTR.AnAction,BUT.Edit],[ATTR.xTooltips,RS.Tooltips_Edit],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEdit}`])],[BUT.Edit1,smap_([ATTR.AnAction,BUT.Edit1],[ATTR.xTooltips,RS.Tooltips_Edit],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaEdit}`])],[BUT.EditEvent,smap_([ATTR.AnAction,BUT.EditEvent],[ATTR.xTooltips,RS.Tooltips_EditEvent],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEdit}`])],[BUT.EditLink,smap_([ATTR.AnAction,BUT.EditLink],[ATTR.xTooltips,RS.Tooltips_EditLink],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTerminal}`])],[BUT.EscapeText,smap_([ATTR.AnAction,BUT.EscapeText],[ATTR.xTooltips,RS.Tooltips_EscapeText],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaHashtag}`])],[BUT.ExpandAll,smap_([ATTR.AnAction,BUT.ExpandAll],[ATTR.xTooltips,RS.Tooltips_ExpandAll],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPlusSquareO}`])],[BUT.ExportToPhotoLibrary,smap_([ATTR.AnAction,BUT.ExportToPhotoLibrary],[ATTR.xTooltips,RS.Tooltips_ExportToPhotoLibrary],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSignOut}`])],[BUT.ExportToFile,smap_([ATTR.AnAction,BUT.ExportToFile],[ATTR.xTooltips,RS.Tooltips_ExportToFile],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSignOut}`])],[BUT.ExtendSelection,smap_([ATTR.AnAction,BUT.ExtendSelection],[ATTR.xTooltips,RS.Tooltips_ExtendSelection],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowCircleDown}`])],[BUT.Filter,smap_([ATTR.AnAction,BUT.Filter],[ATTR.xTooltips,RS.Tooltips_Filter],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSearchMinus}`])],[BUT.Filterbar,smap_([ATTR.AnAction,BUT.Filterbar],[ATTR.xTooltips,RS.Tooltips_Filterbar],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSearchMinus}`])],[BUT.Fit,smap_([ATTR.AnAction,BUT.Fit],[ATTR.xTooltips,RS.Tooltips_Fit],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaExpand}`])],[BUT.FixPerspective,smap_([ATTR.AnAction,BUT.FixPerspective],[ATTR.xTooltips,RS.FixPerspectiveTooltips],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCube}`])],[BUT.Folder,smap_([ATTR.AnAction,BUT.Folder],[ATTR.xTooltips,RS.Tooltips_PickFile],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFolderOpen}`])],[BUT.Folder1,smap_([ATTR.AnAction,BUT.Folder1],[ATTR.xTooltips,RS.Tooltips_PickFile],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaFolderOpen}`])],[BUT.Font,smap_([ATTR.AnAction,BUT.Font],[ATTR.xTooltips,RS.Tooltips_PickFont],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFont}`])],[BUT.GenerateGallery,smap_([ATTR.AnAction,BUT.GenerateGallery],[ATTR.xTooltips,RS.Tooltips_GenerateGallery],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSlideshare}`])],[BUT.Gradient,smap_([ATTR.AnAction,BUT.Gradient],[ATTR.xTooltips,RS.Tooltips_Gradient],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaBarcode}`])],[BUT.Gradient1,smap_([ATTR.AnAction,BUT.Gradient1],[ATTR.xTooltips,RS.Tooltips_Gradient],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaBarcode}`])],[BUT.Glass,smap_([ATTR.AnAction,BUT.Glass],[ATTR.xTooltips,RS.widgetGlassMessage],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaWindows}`])],[BUT.Keyboard,smap_([ATTR.AnAction,BUT.Keyboard],[ATTR.xTooltips,RS.Tooltips_ToggleKeyboard],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaKeyboardO}`])],[BUT.Help,smap_([ATTR.AnAction,BUT.Help],[ATTR.xTooltips,RS.Tooltips_Help],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaQuestionCircle}`],["style","display:none"])],[BUT.IgnoreCase,smap_([ATTR.AnAction,BUT.IgnoreCase],[ATTR.xTooltips,RS.Tooltips_IgnoreCase],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaInfo}`])],[BUT.IgnoreCaseFilter,smap_([ATTR.AnAction,BUT.IgnoreCaseFilter],[ATTR.xTooltips,RS.Tooltips_IgnoreCase],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaInfo}`])],[BUT.Image,smap_([ATTR.AnAction,BUT.Image],[ATTR.xTooltips,RS.Tooltips_PickImage],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaImage}`])],[BUT.ImportExportCopy,smap_([ATTR.AnAction,BUT.ImportExportCopy],[ATTR.xTooltips,RS.Tooltips_ImportExportCopy],["class",`${CSS.Fa} ${CSS.FaAmbulance}`])],[BUT.ImportExportMove,smap_([ATTR.AnAction,BUT.ImportExportMove],[ATTR.xTooltips,RS.Tooltips_ImportExportMove],["class",`${CSS.Fa} ${CSS.FaTruck}`])],[BUT.ImageFilter1,smap_([ATTR.AnAction,BUT.ImageFilter1],[ATTR.xTooltips,RS.ImageFilter],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaSearchMinus}`])],[BUT.ImportImageFromPhotoLibrary,smap_([ATTR.AnAction,BUT.ImportImageFromPhotoLibrary],[ATTR.xTooltips,RS.Tooltips_ImportFromPhotoLibrary],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSignIn}`])],[BUT.ImportKey,smap_([ATTR.AnAction,BUT.ImportKey],[ATTR.xTooltips,RS.BackupKeyImportTooltips],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPlus}`])],[BUT.Indent,smap_([ATTR.AnAction,BUT.Indent],[ATTR.xTooltips,RS.Tooltips_Indent],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaIndent}`])],[BUT.Info,smap_([ATTR.AnAction,BUT.Info],[ATTR.xTooltips,RS.Tooltips_Info],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaInfoCircle}`])],[BUT.InitialDir,smap_([ATTR.AnAction,BUT.InitialDir],[ATTR.xTooltips,RS.Tooltips_GotoInitialDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFlag}`])],[BUT.Mkdir,smap_([ATTR.AnAction,BUT.Mkdir],[ATTR.xTooltips,RS.Tooltips_CreateDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFolderOpenO}`])],[BUT.OpenDocument,smap_([ATTR.AnAction,BUT.OpenDocument],[ATTR.xTooltips,RS.Tooltips_OpenOrAddPage],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMagic}`])],[BUT.Nobackup,smap_([ATTR.AnAction,BUT.Nobackup],[ATTR.xTooltips,RS.Tooltips_ToggleNobackup],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaBan}`])],[BUT.Move,smap_([ATTR.AnAction,BUT.Move],[ATTR.xTooltips,RS.Tooltips_Move],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrows}`])],[BUT.MoveDown,smap_([ATTR.AnAction,BUT.MoveDown],[ATTR.xTooltips,RS.Tooltips_MoveDown],["class",`${CSS.Fa} ${CSS.FaAngleDoubleDown}`])],[BUT.MoveUp,smap_([ATTR.AnAction,BUT.MoveUp],[ATTR.xTooltips,RS.Tooltips_MoveUp],["class",`${CSS.Fa} ${CSS.FaAngleDoubleUp}`])],[BUT.Nbsp,smap_([ATTR.AnAction,BUT.Nbsp],[ATTR.xTooltips,RS.Tooltips_InsertNonBreakSpace],["class",`${CSS.AnButton} ${CSS.AnFaNbsp}`])],[BUT.NextBlog,smap_([ATTR.AnAction,BUT.NextBlog],[ATTR.xTooltips,RS.Tooltips_NextBlog],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaChevronRight}`])],[BUT.NextMatch,smap_([ATTR.AnAction,BUT.NextMatch],[ATTR.xTooltips,RS.Tooltips_NextMatch],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowCircleDown}`])],[BUT.NextPage,smap_([ATTR.AnAction,BUT.NextPage],[ATTR.xTooltips,RS.Tooltips_NextPage],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowRight}`])],[BUT.Noop,smap_([ATTR.AnAction,DEF.NOOP])],[BUT.OK,smap_([ATTR.AnAction,BUT.OK],[ATTR.xTooltips,RS.Tooltips_OK],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCheck}`])],[BUT.OpenStylesheet,smap_([ATTR.AnAction,BUT.OpenStylesheet],[ATTR.xTooltips,RS.Tooltips_EditStylesheet],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFolderOpenO}`])],[BUT.PasteFromLocalClipboard,smap_([ATTR.AnAction,BUT.PasteFromLocalClipboard],[ATTR.xTooltips,RS.Tooltips_PasteFromLocalClipboard],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPaste}`])],[BUT.PasteFile,smap_([ATTR.AnAction,BUT.PasteFile],[ATTR.xTooltips,RS.Tooltips_PasteFileOrDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPaste}`])],[BUT.PathKind,smap_([ATTR.AnAction,BUT.PathKind],[ATTR.xTooltips,RS.Tooltips_PathKind],["class",`${CSS.AnButton} ${CSS.AnButtonFlat} ${CSS.AnFaSlash}`])],[BUT.PickImage,smap_([ATTR.AnAction,BUT.PickImage],[ATTR.xTooltips,RS.Tooltips_ImagePicker],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaImage}`])],[BUT.PickImage1,smap_([ATTR.AnAction,BUT.PickImage1],[ATTR.xTooltips,RS.Tooltips_ImagePicker],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaFileImageO}`])],[BUT.PrevBlog,smap_([ATTR.AnAction,BUT.PrevBlog],[ATTR.xTooltips,RS.Tooltips_PreviousBlog],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaChevronLeft}`])],[BUT.PrevMatch,smap_([ATTR.AnAction,BUT.PrevMatch],[ATTR.xTooltips,RS.Tooltips_PreviousMatch],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowCircleUp}`])],[BUT.PrevPage,smap_([ATTR.AnAction,BUT.PrevPage],[ATTR.xTooltips,RS.Tooltips_PreviousPage],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowLeft}`])],[BUT.Recover,smap_([ATTR.AnAction,BUT.Recover],[ATTR.xTooltips,RS.Tooltips_Recover],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaRecycle}`])],[BUT.Redo,smap_([ATTR.AnAction,BUT.Redo],[ATTR.xTooltips,RS.Tooltips_Redo],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaShare}`])],[BUT.Refresh,smap_([ATTR.AnAction,BUT.Refresh],[ATTR.xTooltips,RS.Tooltips_Refresh],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaRefresh}`])],[BUT.RegexSearch,smap_([ATTR.AnAction,BUT.RegexSearch],[ATTR.xTooltips,RS.Tooltips_RegexSearch],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSearchPlus}`])],[BUT.RegexSearch1,smap_([ATTR.AnAction,BUT.RegexSearch1],[ATTR.xTooltips,RS.Tooltips_RegexSearch],["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaSearchPlus}`])],[BUT.Remove,smap_([ATTR.AnAction,BUT.Remove],[ATTR.xTooltips,RS.Tooltips_Remove],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMinus}`])],[BUT.RemoveBrokenEntries,smap_([ATTR.AnAction,BUT.RemoveBrokenEntries],[ATTR.xTooltips,RS.Tooltips_RemoveBrokenEntries],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaUnlink}`])],[BUT.RecordAudio,smap_([ATTR.AnAction,BUT.RecordAudio],[ATTR.xTooltips,RS.Tooltips_RecordAudio],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMicrophone}`])],[BUT.RecordVideo,smap_([ATTR.AnAction,BUT.RecordVideo],[ATTR.xTooltips,RS.Tooltips_RecordVideo],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaVideoCamera}`])],[BUT.RenameFile,smap_([ATTR.AnAction,BUT.RenameFile],[ATTR.xTooltips,RS.Tooltips_RenameFileOrDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTerminal}`])],[BUT.RemoveStyles,smap_([ATTR.AnAction,BUT.RemoveStyles],[ATTR.xTooltips,RS.Tooltips_RemoveStyles],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.Reset,smap_([ATTR.AnAction,BUT.Reset],[ATTR.xTooltips,RS.Tooltips_Reset],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.ResetUISettings,smap_([ATTR.AnAction,BUT.ResetUISettings],[ATTR.xTooltips,RS.Tooltips_ResetUserSettings],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTimesCircle}`])],[BUT.Restore,smap_([ATTR.AnAction,BUT.Restore],[ATTR.xTooltips,RS.Tooltips_RestoreData],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFolderOpenO}`],["style","display:none;"])],[BUT.RestoreData,smap_([ATTR.AnAction,BUT.RestoreData],[ATTR.xTooltips,RS.Tooltips_RestoreData],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCheck}`])],[BUT.RootFolder,smap_([ATTR.AnAction,BUT.RootFolder],[ATTR.xTooltips,RS.Tooltips_RootFolder],["class",`${CSS.AnButton} ${CSS.AnLink} ${CSS.Fa} ${CSS.FaBookmarkO}`])],[BUT.RotateImage,smap_([ATTR.AnAction,BUT.RotateImage],[ATTR.xTooltips,RS.Tooltips_RotateImage],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaRotateRight}`])],[BUT.RuleAdd,smap_([ATTR.AnAction,BUT.RuleAdd],[ATTR.xTooltips,RS.Tooltips_AddRule],["class",`${CSS.AnButton} ${CSS.Noto} ${CSS.NotoColon}`])],[BUT.RulesetAdd,smap_([ATTR.AnAction,BUT.RulesetAdd],[ATTR.xTooltips,RS.Tooltips_AddRuleset],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPlus}`])],[BUT.RulesetEdit,smap_([ATTR.AnAction,BUT.RulesetEdit],[ATTR.xTooltips,RS.Tooltips_EditRuleset],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEdit}`])],[BUT.RulesetRemove,smap_([ATTR.AnAction,BUT.RulesetRemove],[ATTR.xTooltips,RS.Tooltips_RemoveRuleset],["class",`${CSS.Fa} ${CSS.FaMinus}`])],[BUT.Save,smap_([ATTR.AnAction,BUT.Save],[ATTR.xTooltips,RS.Tooltips_Save],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSave}`])],[BUT.Search,smap_([ATTR.AnAction,BUT.Search],[ATTR.xTooltips,RS.Tooltips_Search],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSearch}`])],[BUT.Searchbar,smap_([ATTR.AnAction,BUT.Searchbar],[ATTR.xTooltips,RS.Tooltips_SearchBar],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSearch}`])],[BUT.Preview,smap_([ATTR.AnAction,BUT.Preview],[ATTR.xTooltips,RS.Tooltips_Preview],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEye}`])],[BUT.Settings,smap_([ATTR.AnAction,BUT.Settings],[ATTR.xTooltips,RS.Tooltips_Settings],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaGear}`])],[BUT.ShowBrokenOnly,smap_([ATTR.AnAction,BUT.ShowBrokenOnly],[ATTR.xTooltips,RS.Tooltips_ToggleShowBrokenLinksOnly],["class",`${CSS.AnButton} ${CSS.AnToggleOff} ${CSS.Fa} ${CSS.FaUnlink}`])],[BUT.ShowDoneEvents,smap_([ATTR.AnAction,BUT.ShowDoneEvents],[ATTR.xTooltips,RS.Tooltips_ShowOrHideDoneEvents],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCheckSquare}`])],[BUT.Sort,smap_([ATTR.AnAction,BUT.Sort],[ATTR.xTooltips,RS.Tooltips_SortAlphaAsc],["class",`${CSS.AnButton} ${CSS.AnToggleOff} ${CSS.Fa} ${CSS.FaSortAlphaAsc}`])],[BUT.Spacer,smap_(["class",CSS.AnFlex11Auto])],[BUT.Stop,smap_([ATTR.AnAction,BUT.Stop],[ATTR.xTooltips,RS.Tooltips_StopAudioPlayback],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaStop}`])],[BUT.Symbol,smap_([ATTR.AnAction,BUT.Symbol],[ATTR.xTooltips,RS.Tooltips_InsertSymbol],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSmileO}`])],[BUT.Sync,smap_([ATTR.AnAction,BUT.Sync],[ATTR.xTooltips,RS.BackupSyncFilesActionTooltips],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaRefresh}`])],[BUT.TakePhoto,smap_([ATTR.AnAction,BUT.TakePhoto],[ATTR.xTooltips,RS.Tooltips_TakePhoto],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaCamera}`])],[BUT.TargetDocument,smap_([ATTR.AnAction,BUT.TargetDocument],[ATTR.xTooltips,RS.Tooltips_GotoTargetDocumentDirectory],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaDotCircleO}`])],[BUT.TargetDate,smap_([ATTR.AnAction,BUT.TargetDate],[ATTR.xTooltips,RS.Tooltips_TargetDate],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaDotCircleO}`])],[BUT.Today,smap_([ATTR.AnAction,BUT.Today],[ATTR.xTooltips,RS.Tooltips_Today],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFlag}`])],[BUT.Toolbar,smap_([ATTR.AnAction,BUT.Toolbar],[ATTR.xTooltips,RS.Tooltips_Toolbar],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEllipsisH}`])],[BUT.Toolbar1,smap_([ATTR.AnAction,BUT.Toolbar1],[ATTR.xTooltips,RS.Tooltips_Toolbar],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEllipsisH}`])],[BUT.Toolbar2,smap_([ATTR.AnAction,BUT.Toolbar2],[ATTR.xTooltips,RS.Tooltips_Toolbar],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEllipsisH}`])],[BUT.Undo,smap_([ATTR.AnAction,BUT.Undo],[ATTR.xTooltips,RS.Tooltips_Undo],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaReply}`])],[BUT.Up,smap_([ATTR.AnAction,BUT.Up],[ATTR.xTooltips,RS.Tooltips_Up],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowUp}`])]),BUT.infosCancel=[BUT._INFOS[BUT.Cancel]],BUT.infosOKCancel=[BUT._INFOS[BUT.OK],BUT._INFOS[BUT.Cancel]],BUT.infosCopyPasteOKCancel=[BUT._INFOS[BUT.CopyToLocalClipboard],BUT._INFOS[BUT.PasteFromLocalClipboard],BUT._INFOS[BUT.OK],BUT._INFOS[BUT.Cancel]],BUT.infosHelpCopyPasteOKCancel=[BUT._INFOS[BUT.Help],BUT._INFOS[BUT.CopyToLocalClipboard],BUT._INFOS[BUT.PasteFromLocalClipboard],BUT._INFOS[BUT.OK],BUT._INFOS[BUT.Cancel]];const toasters$=new Toasters(document.body),searchSpotlight$=new Spotlight(document.body,DEFUtil.searchHighlightDuration$);class DialogVerticalDraggerHandler extends VerticalDraggerHandler{constructor(){super((t,e,i,n)=>{const s=DomUt.asHTMLElement_(e);return null!=s&&("TABLE"==s.nodeName||"DIV"==s.nodeName)&&(s.classList.contains(CSS.AnDialog)||s.classList.contains(CSS.AnTitle))})}}class DialogDraggerHandler extends DefaultDraggerHandler{constructor(){super((t,e,i,n)=>{const s=DomUt.asHTMLElement_(e);return null!=s&&("TABLE"==s.nodeName||"DIV"==s.nodeName)&&(s.classList.contains(CSS.AnDialog)||s.classList.contains(CSS.AnTitle))})}}class DialogBase{constructor(t,e=new DialogDraggerHandler){this._container=t,this._dragHandler=e,this._toolbar=null,this._message=null,this._status=null,this._smokescreen=null,this._dragger=null,this._cancelCallback=null,this._confirmCancelCallback=null,this._onShowDialogCallback=null,this._clipboardGetter=Callbacks.pasteFromClipboard_,this._clipboardSetter=Callbacks.copyToClipboard_,this._busy=!1,this._shown=!1,this._labelWidth=DEF.BASIS_34,this._tabIndex=0,this._zindex=DEF.zindexPrompt,this._maxWidthMultipler=DEF.dialogMaxWidthMedium,this._smokescreenOpacity=DEF.opacityTransparent,this._helpCallback=null,this._resizeRateLimiter=new RateLimiter(250),this._subscriptions=[],_destroyed0.set(this,!1)}_allowTouchmove(){return!0}init_(t){if(this._dialog=t,this._dialog.style.pointerEvents="auto",!this._allowTouchmove()){const t=An.subscriptEvent_(this._dialog,"touchmove",t=>{t.preventDefault()});this._subscriptions.push(t)}this._dialog.addEventListener("contextmenu",An.sinkhole_);for(let t of new ItemsIterable(this._dialog.querySelectorAll(`textarea.${CSS.AnPromptInput}`)))An.onKeypress_(t,t=>{"Enter"==t.key&&An.stopevent_(t)});this._table=this._dialog.firstChild}get labelWidth$(){return this._labelWidth}get clipboardSetter$(){return this._clipboardSetter}get clipboardGetter$(){return this._clipboardGetter}container_(){return this._container}element_(){return this._dialog}tabIndex_(){return`${++this._tabIndex}`}dialog_(){return this._dialog}titleKey_(t){var e;return null===(e=this._toolbar)||void 0===e||e.titleKey_(t),this}titleText_(t){var e;return null===(e=this._toolbar)||void 0===e||e.titleText_(t),this}maxWidthMultipler_(t){return this._maxWidthMultipler=t,this}largeWidth_(){return this._maxWidthMultipler=DEF.dialogMaxWidthLarge,this}smallWidth_(){return this._maxWidthMultipler=DEF.dialogMaxWidthSmall,this}message_(t){return this._setmsg(this._message,t,!1),this}messageKey_(t){return this._setmsgtext(this._message,MSG.string_(t)),this}zindex1_(t){return this._zindex=t,this._dialog.style.zIndex=`${t}`,this}zindex_(t,e=null){return this.zindex1_(null==t?DEF.zindexPrompt+(null==e?0:e):"number"==typeof t?t+(null==e?0:e):An.zindexOf_(t,null==e?DEF.zindexAbove10:e,DEF.zindexPrompt))}above_(t,e=null){return this.zindex_(t,e)}smokescreenOpacity_(t){return this._smokescreenOpacity=t,this}onDrag_(t){return this._dragHandler=t,this}onCancel_(t){return this._cancelCallback=t,this}onConfirmCancel_(t){return this._confirmCancelCallback=t,this}onHelp_(t){var e,i,n;return null==(null!==(i=null===(e=this._toolbar)||void 0===e?void 0:e.button_(BUT.Help))&&void 0!==i?i:null)?this:(this._helpCallback=t,null===(n=this._toolbar)||void 0===n||n.showButton_(BUT.Help,!0),this)}onHelpMessage_(t){return this.onHelp_((e,i)=>{this._helpMessage(i,t)})}_helpMessage(t,e){t.push_().div_({class:CSS.AnViewport,style:"white-space:normal;font-size:small"});for(let i of e)t.text_(i),t.append_("br");t.pop_()}_onWindowResize(t){this._subscriptions.push(An.subscriptEvent_(window,"resize",()=>{this._resizeRateLimiter.queue_(()=>{t()},An.now_())}))}getStatusText_(){return null!=this._status?this._status.textContent:null}onShowDialog_(t){this._onShowDialogCallback=t}onSmokescreenCreated_(t){}addSubscription_(t){this._subscriptions.push(t)}show_(){if(!this._dialog)throw new Error;return this._shown?this:(this._shown=!0,this.showDialog_(()=>this._onResize()),this)}showError_(){this._dialog.classList.add(CSS.AnError),this.show_()}showWarning_(){this._dialog.classList.add(CSS.AnWarning),this.show_()}showOK_(){this._dialog.classList.add(CSS.AnOK),this.show_()}showDialog_(t){An.showHidden_(this._dialog,"block");let e=this._smokescreen;if(null==e){e=new Smokescreen(this._container),this._smokescreen=e,this.onSmokescreenCreated_(this._smokescreen);for(let t of DomUt.queryAll_(this._dialog,"input, textarea, select"))null==t.getAttribute(ATTR.AnNoClick)&&t.addEventListener("click",()=>{this.clearStatus_()});null!=t&&(t(this),this._onWindowResize(()=>{t(this)})),null==this._dragger&&null!=this._dragHandler&&(this._dragger=new Dragger(this._dialog,this._dragHandler).bind_())}e.zindex_(An.zindexOf_(this._dialog,DEF.zindexUnder,DEF.zindexPrompt+DEF.zindexUnder)),e.opacity_(this._smokescreenOpacity),e.show_(t=>{null!=this._onShowDialogCallback?this._onShowDialogCallback(this._dialog,t):(An.setVisible_(this._dialog),Timer.sleep0_(()=>this.setInitialFocus_()))})}_onResize(){var t;const e=this.element_(),i=this._table;if(null==e||null==i)return;const n=window.innerWidth,s=window.innerHeight,o=this._getToolbarHeight(),l=Math.min(n-40,o*this._maxWidthMultipler),a=i.getBoundingClientRect(),r=this.constraintTableWidth_(o,l,l,Math.round(a.width));let _=2*o;_+Math.round(a.height)+20>=s&&(_=20),i.style.width=`${r}px`;const c=(n-r)/2,h=e.style;h.left=`${c}px`,h.top=`${_}px`;const u=this.getTableCellWidth_(i,r,o);null===(t=Conf.isMobile)||void 0===t||t||(h.minWidth="0",i.style.minWidth="0");const d=`${u}px`;for(let t of new ItemsIterable(i.children))for(let e of new ItemsIterable(t.children))e.style.maxWidth=d}showAt_(t,e,i=!1){return this.showDialog_(()=>{const n=window.innerWidth,s=window.innerHeight,o=this._dialog.getBoundingClientRect(),l=n/16,a=o.width;let r,_;if(null==t){const t=n-a;r=t<l?l:t/2}else if((r=i?t-a/2-l:t-a-l)<0){const e=t+l+a-n;r=e<=0?t+l:e<-r?n-a:0}if(null==e)_=s/16;else{const t=o.height;if(null==t)_=s/16;else{const i=Math.ceil(t);(_=e-i/2)<0?_=0:_+i>s&&(_=s-i)<0&&(_=0)}}const c=this._dialog.style;c.left=`${r}px`,c.top=`${_}px`,this._table.style.minWidth="0"}),this}hide_(){this._shown&&(this._shown=!1,toasters$.hideModal_(),null!=this._smokescreen&&this._smokescreen.hide_(),An.hide_(this._dialog))}close_(){__classPrivateFieldGet(this,_destroyed0)||(__classPrivateFieldSet(this,_destroyed0,!0),this._shown&&(An.hide_(this._dialog),this._shown=!1),An.cancelSubscriptions_(this._subscriptions),this._cancelCallback=null,this._confirmCancelCallback=null,this._onShowDialogCallback=null,toasters$.hideModal_(),null!=this._dragger&&(this._dragger.destroy_(),this._dragger=null),null!=this._smokescreen&&(this._smokescreen.destroy_(),this._smokescreen=null),null!=this._toolbar&&(this._toolbar.destroy_(),this._toolbar=null),this._dialog.remove())}constraintTableWidth_(t,e,i,n){return n<i&&(n=i),n>e&&(n=e),n}getTableCellWidth_(t,e,i){return e-DEFUtil.dialogChromeWidth_(i)}_getToolbarHeight(){const t=null!=this._toolbar?this._toolbar.element_():this._dialog.querySelector(`div.${CSS.AnToolbar}`);return null==t?32:Math.round(t.getBoundingClientRect().height)}setInitialFocus_(){var t,e;An.focus_(null!==(e=null===(t=this._toolbar)||void 0===t?void 0:t.buttonIfExists_(BUT.Cancel))&&void 0!==e?e:null)}actionInvalid_(t){throw Assert.notReach_(t)}actionCancel_(){null!=this._confirmCancelCallback?this._confirmCancelCallback(t=>{t&&this.actionCancelConfirmed_()}):this.actionCancelConfirmed_()}actionCancelConfirmed_(){const t=this._cancelCallback;this.close_(),null==t||t()}actionOKConfirmed_(t){t&&this.close_()}actionHelp_(){null!=this._helpCallback&&toasters$.modal_((t,e)=>{var i;return null===(i=this._helpCallback)||void 0===i?void 0:i.call(this,t,e)})}actionCopy_(t,e=!1){const i=JsUtil.asHTMLTextAreaElement_(t);null!=i&&null!=this._clipboardSetter&&Timer.sleep0_(()=>{var t;let n=i.selectionStart,s=i.selectionEnd;if(n==s)return;if(s<n){const t=n;n=s,s=t}let o=i.value.substring(n,s);e&&(o=An.unescText_(o)),null===(t=this._clipboardSetter)||void 0===t||t.call(this,o),toasters$.info_(o,{attop:!1}),Timer.sleep0_(()=>{i.focus()})})}actionCut_(t,e=!1){const i=JsUtil.asHTMLTextAreaElement_(t);null!=i&&null!=this._clipboardSetter&&Timer.sleep0_(()=>{var t;let n=i.selectionStart,s=i.selectionEnd;if(n==s)return;if(s<n){const t=n;n=s,s=t}const o=i.value;let l=o.substring(n,s);e&&(l=An.unescText_(l)),null===(t=this._clipboardSetter)||void 0===t||t.call(this,l),toasters$.info_(l,{attop:!1}),i.value=o.substring(0,n)+o.substring(s),Timer.sleep0_(()=>{i.selectionStart=n,i.selectionEnd=n,i.focus()})})}actionPaste_(t,e=!1,i=null){var n;let s=null!==(n=JsUtil.asHTMLTextAreaElement_(t))&&void 0!==n?n:JsUtil.asHTMLInputElement_(t);null!=s&&null!=this._clipboardGetter&&this._clipboardGetter(t=>{if(this.warn_(t[Key.errors]))return void(null==i||i());const n=t[Key.result];this._pasteValue(s,null,e?An.escText_(n):n),null==i||i()})}_defaultToolbarHandler1(t){switch(t){case BUT.Cancel:case BUT.Dismiss:this.actionCancel_();break;default:this.actionInvalid_(t)}}createDialog_(t,e,i,n){const s=DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnDialog,style:"display: none; visibility: hidden"}),o=s.cursor_();return s.table1_(CSS.AnDialog).push_().tr_().td_(),this._toolbar=i(s.cursor_()),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._toolbar.onAction_(n),this._message=s.peek_().tr_().td_().div1_(CSS.AnPromptViewport).div1_(CSS.AnPromptMsg).cursor_(),s.peek_().tr_().td_().div1_(CSS.AnPromptContent).cursor_(),null==e||e(s.cursor_()),this._status=s.peek_().tr_().td_().div1_(CSS.AnPromptViewport).div1_(CSS.AnPromptStatus).cursor_(),t.append(o),o}_createMessageDialog(t,e,i){const n=DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnDialog,style:"display: none; visibility: hidden"}),s=n.cursor_();return n.table1_(CSS.AnDialog).push_(),n.tr_().td_(),this._toolbar=new Toolbar(n.cursor_(),e),this._toolbar.onAction_(i),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._message=n.peek_().tr_().td_().div1_(CSS.AnPromptViewport).div1_(CSS.AnPromptMsg).cursor_(),t.append(s),s}_createDialogWithoutStatus(t,e,i,n){const s=DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnDialog,style:"display: none; visibility: hidden"}),o=s.cursor_();return s.table1_(CSS.AnDialog).push_().tr_().td_(),this._toolbar=new Toolbar(s.cursor_(),i),this._toolbar.onAction_(n),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._message=s.peek_().tr_().td_().div1_(CSS.AnPromptViewport).div1_(CSS.AnPromptMsg).cursor_(),s.peek_().tr_().td_().div1_(CSS.AnPromptContent),null!=e&&e(s.cursor_()),t.append(o),o}_createDialogWithoutMessageStatus(t,e,i,n){const s=DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnDialog,style:"display: none; visibility: hidden"}),o=s.cursor_();return s.table1_(CSS.AnDialog).push_().tr_().td_(),this._toolbar=new Toolbar(s.cursor_(),i),this._toolbar.onAction_(n),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),s.peek_().tr_().td_().div1_(CSS.AnPromptContent),null!=e&&e(s.cursor_()),t.append(o),o}_createDialogWithContentOnly(t,e){const i=DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnDialog,style:"display: none; visibility: hidden;"}),n=i.cursor_();return i.table_({class:CSS.AnDialog,style:`padding-top:${DEF.dialogPaddingWidth}px;`}).push_().tr_().td_(),i.div1_(CSS.AnPromptContent),e(i.cursor_()),t.append(n),n}_pasteName(t,e){var i,n;if(null==e||0==e.length)return;const s=t.nodeName;if("INPUT"==s){const s=t,o=s.value,l=null!==(i=s.selectionStart)&&void 0!==i?i:0,a=null!==(n=s.selectionEnd)&&void 0!==n?n:l;if(l==a){const t=DialogBase.pasteNameSmarter_(e,o,l);DialogBase._setInputValueRange(s,t[0],t[1],t[1])}else{const t=l<=a?l:a,i=l<=a?a:l,n=o.substring(0,t),r=o.substring(i),_=t+e.length;DialogBase._setInputValueRange(s,n+e+r,_,_)}}else if("TEXTAREA"==s){const i=t,n=i.value,s=i.selectionStart,o=i.selectionEnd;if(s==o){const t=DialogBase.pasteNameSmarter_(e,n,s);DialogBase._setTextAreaValueRange(i,t[0],t[1],t[1])}else{const t=s<=o?s:o,l=s<=o?o:s,a=n.substring(0,t),r=n.substring(l),_=t+e.length;DialogBase._setTextAreaValueRange(i,a+e+r,_,_)}}else this.warnKey_(RS.ActionRequireAValidSelection);Timer.sleep0_(()=>{t.focus()})}_pasteValue(t,e,i){var n,s;if(null==t||null==i||0==i.length)return;const o=t.nodeName;if("INPUT"==o){const o=t,l=o.value,a=null!==(n=o.selectionStart)&&void 0!==n?n:0,r=null!==(s=o.selectionEnd)&&void 0!==s?s:a;if(null!=e&&a==r){const t=DialogBase.pasteValueSmarter_(e,i,l,a);DialogBase._setInputValueRange(o,t[0],t[1],t[1])}else{const t=a<=r?a:r,e=a<=r?r:a,n=l.substring(0,t),s=l.substring(e),_=t+i.length;DialogBase._setInputValueRange(o,n+i+s,_,_)}}else if("TEXTAREA"==o){const n=t,s=n.value,o=n.selectionStart,l=n.selectionEnd;if(null!=e&&o==l){const t=DialogBase.pasteValueSmarter_(e,i,s,o);DialogBase._setTextAreaValueRange(n,t[0],t[1],t[1])}else{const t=o<=l?o:l,e=o<=l?l:o,a=s.substring(0,t),r=s.substring(e),_=t+i.length;DialogBase._setTextAreaValueRange(n,a+i+r,_,_)}}else this.warnKey_(RS.ActionRequireAValidSelection);Timer.sleep0_(()=>{t.focus()})}static _setInputValueRange(t,e,i,n){t.value=e,Timer.sleep0_(()=>{t.selectionStart=i,t.selectionEnd=n,t.focus()})}static _setTextAreaValueRange(t,e,i,n){t.value=e,Timer.sleep0_(()=>{t.selectionStart=i,t.selectionEnd=n,t.focus()})}static pasteNameSmarter_(t,e,i){const n=DialogBase._getLine(e,i);for(;n.start$<n.end$&&An.isWhitespace_(e.codePointAt(n.start$));)++n.start$;if(n.start$==n.end$)return[e.substring(0,n.start$)+t+" "+An.trimLeftSpaces_(e.substring(n.end$)),n.start$+t.length+1];let s=n.start$;for(;s<n.end$&&!An.isWhitespace_(e.charCodeAt(s));)++s;return[e.substring(0,n.start$)+t+" "+An.trimLeftSpaces_(e.substring(s)),n.start$+t.length+1]}static pasteValueSmarter_(t,e,i,n){const s=DialogBase._getLine(i,n);for(;s.start$<s.end$&&An.isWhitespace_(i.codePointAt(s.start$));)++s.start$;if(s.start$==s.end$)return[i.substring(0,s.start$)+t+" "+e+i.substring(s.end$),s.start$+t.length+1+e.length];for(;s.start$<s.end$&&!An.isWhitespace_(i.codePointAt(s.start$));)++s.start$;const o=t.toLowerCase();if("color"==o||"background-color"==o||"background-image"==o){const t=i.substring(s.start$,s.end$),n="color"==o||"background-color"==o?RX.CSSColorValue.exec(t):"background-image"==o?RX.CSSUrlValue.exec(t):null;if(null!=n){e=(n[1].trim()+" "+e+" "+n[3].trim()).trim()}}return[i.substring(0,s.start$)+" "+e+i.substring(s.end$),s.start$+1+e.length]}static _getLine(t,e){let i=e,n=e;const s=t.length;for(;n<s&&!An.isLinebreak_(t.codePointAt(n));)++n;for(;i>0;){const e=t.codePointAt(i-1);if(An.isLinebreak_(e))break;--i}return new AnRange(i,n)}_setmsg(t,e,i){if(null==t)return!1;if(null==e)return t.style.display="none",t.textContent="",t.style.color="inherit",!1;if(e instanceof Array){if(0==e.length)return!1;const n=new DomBuilderEx(t).empty_();t.style.color=i?"red":"inherit";for(let t=0;t<e.length;++t)t>0&&n.append_("BR"),n.text_(e[t]);return t.style.display="block",!0}return"object"==typeof e?this._setmsg(t,e[Key.errors],i):(t.textContent=e.toString(),t.style.color=i?"red":"inherit",t.style.display="block",!0)}_setmsgtext(t,e){null!=t&&(null==e||0==e.length?(t.style.display="none",t.textContent=""):(t.textContent=e,t.style.display="block"))}_showstatus1(t,e){return null==this._status?e?toasters$.warn_(t):toasters$.info_(t):this._setmsg(this._status,t,e)}info_(t){return this._showstatus1(t,!1)}warn_(t){return this._showstatus1(t,!0)}warnKey_(t){this.warn_(MSG.string_(t))}warn0_(t){return null!=(t=An.getMessage_(t))&&(Timer.sleep0_(()=>{this._showstatus1(t,!0)}),!0)}clearStatus_(){null!=this._status&&this._setmsg(this._status,null,!1)}parseUri_(t,e){if(null==t||0==t.length)return null;try{return An.parseUri_(t,e)}catch(t){return this.warn_(`${t}`),null}}static help_(t,e){const i=MSG.stringArray_(e);t.push_().div_({class:CSS.AnViewport,style:"white-space:normal;font-size:small"});const n=i.length;if(0!=n){t.text_(i[0]),t.append_("br");for(let e=1;e+1<n;)t.b_().text_(i[e++]).up_().text_("").text_(i[e++]).append_("br");t.pop_()}}}_destroyed0=new WeakMap;class FixedSizeDialogBase extends DialogBase{constructor(t,e){super(t,new DialogDraggerHandler),this._buttonSize=e}get buttonSize$(){return this._buttonSize}getDialogWidth_(){return this.getContentWidth_()+DEFUtil.dialogChromeWidth_(this._buttonSize)}show_(){return this._shown?this:(this._shown=!0,this.showAt_(null,null),this)}showAt_(t,e){return this.showDialog_(()=>{const i=window.innerWidth,n=window.innerHeight,s=i/16,o=this.getDialogWidth_();let l,a;if(null==t){const t=i-o;l=t<s?s:t/2}else if((l=t-o-s)<0){const e=t+s+o-i;l=e<=0?t+s:e<-l?i-o:0}if(null==e)a=n/16;else{const t=An.getComputedStyle_(this._dialog),i=An.parseDoublePx_(null==t?void 0:t.height,null);if(null==i)a=n/16;else{const t=Math.ceil(i);(a=e-t/2)<0?a=0:a+t>n&&(a=n-t)<0&&(a=0)}}null!=this._toolbar&&(this._toolbar.element_().style.width=`${this.getContentWidth_()}px`);const r=this._dialog.style;r.left=`${l}px`,r.top=`${a}px`,this._table.style.minWidth="0"}),this}close_(){super.close_()}_styleRowHeight(){return 4*this._buttonSize/5}}class FullscreenDialogBase extends DialogBase{constructor(t,e){super(t),this._gestureHandler=e}get toolbar$(){return this._toolbar}createFullscreenDialog_(t,e,i){const n=DomBuilderEx.offline_(t.ownerDocument,"table",{class:CSS.AnWindow,style:"display: none; visibility: hidden;"}).push_(),s=n.cursor_();return this._toolbar=e(n.tr_().td_()),i(n.pop_().tr_().td_()),t.append(s),s}show_(){return this._shown?this:(this._shown=!0,An.showHidden_(this._dialog,"block"),this._onWindowResize(()=>this.onResize_()),null!=this._gestureHandler&&this._gestureHandler.pause_(),this.showFullscreen_(),this)}close_(){null!=this._gestureHandler&&(this._gestureHandler.resume_(),this._gestureHandler=null),super.close_()}static fullscreenToolbarCreator_(t,e,i){const n=new Toolbar(t.cursor_(),i);return n.onTooltips_(toasters$.onTooltipsKey_),null!=e&&n.titleKey_(e),n.element_().style.width="100vw",t.peek_().tr_().td_({class:CSS.AnPanel}),n}}class DialogBaseWithFocusInput extends DialogBase{constructor(t){super(t),this._focusInput=null,this._onChangeCallback=null}get onChangeCallback$(){return this._onChangeCallback}onFocus_(t){this._focusInput=t}onChange_(t){return this._onChangeCallback=t,this}fireOnChange_(t,e){Timer.sleep0_(()=>{var i;this._shown&&(null===(i=this._onChangeCallback)||void 0===i||i.call(this,t,e))})}close_(){super.close_(),this._onChangeCallback=null}defaultToolbarActions_(t){switch(this.clearStatus_(),t){case BUT.PasteFromLocalClipboard:null!=this._focusInput&&this.actionPaste_(this._focusInput);break;case BUT.CopyToLocalClipboard:null!=this._focusInput&&this.actionCopy_(this._focusInput);break;default:this._defaultToolbarHandler1(t)}}}class DialogField{getButton_(t){return null}setButtonEnable_(t,e){var i,n;const s=this.getButton_(t);return null==s?null:(e?null===(i=s.classList)||void 0===i||i.remove(CSS.AnDisabled):null===(n=s.classList)||void 0===n||n.add(CSS.AnDisabled),s)}onResize_(){}setupInput_(t,e){An.onInputChange_(e,()=>t.fireOnChange_(this,e)),e.addEventListener("focus",()=>t.onFocus_(e))}setupInput1_(t,e,i){An.onInputChange_(e,()=>i()),e.addEventListener("focus",()=>t.onFocus_(e))}}class DialogFieldSpecBase{}class AttributesFIeld extends DialogFieldSpecBase{constructor(t,e,i,n,s){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.classes$=s}create_(t,e){return new AttributesFieldImpl(t,e,this)}}class AttributesFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._input=e.peek_().flexTextTextarea_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$),smap_(["class",`${i.classes$} ${CSS.AnPromptAttributes}`],["placeholder",_DialogUt.placeholder_(i.placeholder$)],["tabindex",t.tabIndex_()],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])),this._input.value=i.value$,this.setupInput_(t,this._input)}get spec$(){return this._spec}element_(){return this._input.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur()}getValue_(t){return this._input.value}setValue_(t,e){this._input.value=t}getButton_(t){return null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class BasenameFIeld extends DialogFieldSpecBase{constructor(t,e,i,n,s,o){super(),this.label$=t,this.key$=e,this.filename$=i,this.placeholder$=n,this.basedir$=s,this.foldercallback$=o}create_(t,e){return new BasenameFieldImpl(t,e,this)}}class BasenameFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._top,this._input,this._ext,this._buttons]=_DialogUt.createBasenameInput_(e,t,i,()=>t.basenameButtonPressed_(this,this._input,this.getValue_(),i.basedir$,i.foldercallback$)),this.setupInput_(t,this._input)}get spec$(){return this._spec}element_(){return this._top}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),this._buttons.forEach(t=>t.blur())}getValue_(t){return this._input.value.trim()+this._ext.getValue_(0)}setValue_(t,e){const i=new Basepath(t);this._input.value=i.nameWithoutSuffix$,this._ext.setValue_(i.suffix$,0)}getButton_(t){var e;return null!==(e=this._buttons.get(t))&&void 0!==e?e:null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class CheckboxField extends DialogFieldSpecBase{constructor(t,e,i,n=""){super(),this.label$=t,this.key$=e,this.value$=i,this.text$=n}create_(t,e){return new CheckboxFieldImpl(t,e,this)}}class CheckboxFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._input=e.peek_().flexTextDiv_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)).attrs_({class:CSS.AnPromptCheckbox}).input_({type:"checkbox",tabindex:t.tabIndex_()}).cursor_(),e.siblingAfter_("span",{style:"margin-left:0.5em;"}).text_(i.text$),this.setupInput_(t,this._input),this._input.checked="true"===i.value$}get spec$(){return this._spec}element_(){return this._input.parentElement.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur()}getValue_(t){return this._input.checked?"true":"false"}setValue_(t,e){this._input.checked="true"==t}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return this.getInput_(t)}}class ColorField extends DialogFieldSpecBase{constructor(t,e,i,n,s){super(),this.label$=t,this.key$=e,this.value$=i,this.buttonsize$=n,this.placeholder$=s}create_(t,e){return new ColorFieldImpl(t,e,this)}}class ColorFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,e.peek_().flexTextContainer_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)),[this._colorinput,this._colorcell]=DialogUt.promptColorInput_(e,_DialogUt.placeholder_(i.placeholder$),t.tabIndex_(),ColorUtil.validateColor_(i.value$),ColorUtil.validateCSSColor_(i.value$));const n=(e,i)=>{this._colorinput.value=null==e?"":ColorUtil.formatString_(i,e),this._colorcell.style.backgroundColor=null==e?"":ColorUtil.formatCSSString_(i,e),t.fireOnChange_(this,this._colorinput)},s=e=>{An.stopevent_(e),Callbacks.promptColor_(i.buttonsize$,An.above_(t.element_()),this._colorcell.style.backgroundColor,ColorValue.X_WHITE).onOK_(n).show_()};An.onClick_(this._colorinput,s),An.onClick_(this._colorcell,s),An.onChange_(this._colorinput,t=>{n(ColorUtil.getColorValue_(this._colorinput.value),ColorUtil.getFormat_(this._colorinput.value))}),this._colorinput.addEventListener("focus",()=>{t.onFocus_(this._colorinput)})}get spec$(){return this._spec}element_(){return this._colorinput.parentElement.parentElement}focus_(){return this._colorinput.focus(),this._colorinput}blur_(){this._colorinput.blur()}getValue_(t){return ColorUtil.validateCSSColor_(this._colorinput.value.trim())}setValue_(t,e){this._colorinput.value=t,this._colorinput.dispatchEvent(new Event("change"))}getInput_(t){return 0==t?this._colorinput:null}getValueElement_(t){return 0==t?this._colorinput:1==t?this._colorcell:null}}class ColorStop{constructor(t,e){this.color=t,this.position=e}toString(){return 0==this.position.length?this.color:`${this.color} ${this.position}`}}class Gradient{constructor(t,e,i){this.name=t,this.position=e,this.colorstops=i}toString(){let t=sarray_();t.push(this.position);for(const e of this.colorstops)null!=e&&t.push(e.toString());return this.name+"("+An.joinNotEmpty_(", ",t)+")"}static linear(t,e){return new Gradient("linear-gradient",t,e)}static def(){return this.linear("180deg",[new ColorStop(Gradient._COLOR0,""),new ColorStop(Gradient._COLOR1,""),null,null])}}Gradient._COLOR0="rgba(221, 221, 0, 0.50)",Gradient._COLOR1="rgba(136, 221, 170, 0.50)";class ColorStopsField extends DialogFieldSpecBase{constructor(t,e,i,n){super(),this.label$=t,this.key$=e,this.buttonsize$=i,this.colors$=n}create_(t,e){return new ColorsFieldImpl(t,e,this)}}class ColorsFieldImpl extends DialogField{constructor(t,e,i){var n;if(super(),this._spec=i,this._positions=Array(),e.peek_().flexTextContainer_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)).addClass_(CSS.AnColorStops),i.colors$.length<2)throw new Error(i.colors$.length.toString());this._colorCells=DialogUt.promptColorStopsInput_(e,i.colors$);for(let e=0;e<this._colorCells.length;++e){const n=this._colorCells[e];An.onClick_(n,s=>{An.stopevent_(s),Callbacks.promptColor_(i.buttonsize$,An.above_(t.element_()),n.style.backgroundColor,ColorValue.X_WHITE).onOK_((i,s)=>{var o;null!=i&&(n.style.backgroundColor=ColorUtil.formatCSSString_(s,i),t.fireOnChange_(this,n));let l=["","%"];const a=this._positions[e];a.length>0&&(l=null!==(o=An.doubleStringSizeUnit_(a))&&void 0!==o?o:["","%"]),new PromptCSSLength(accessories$,RS.Position,l,RS.Position).above_(t.element_()).onOK_(i=>{this._positions[e]=i,n.textContent=i.length>0?i:"",t.fireOnChange_(this,n)}).show_()}).show_()})}for(const t of this._spec.colors$)this._positions.push(null!==(n=null==t?void 0:t.position)&&void 0!==n?n:"")}get spec$(){return this._spec}element_(){return this._colorCells[0].parentElement.parentElement}focus_(){return null}blur_(){}getValue_(t){var e;const i=[];for(let t=0;t<this._colorCells.length;++t){const n=null!==(e=this._colorCells[t].style.backgroundColor)&&void 0!==e?e:"";if(null!=n&&n.length>0){const e=ColorValue.from_(n);if(null!=e){let n=e.toCSSString_();const s=this._positions[t];s.length>0&&(n+=" "+s),i.push(n)}}}return i.join(", ")}setValue_(t,e){for(const e of this._colorCells){const i=RX.CSSColorValue1.exec(t);if(null==i)return;const n=ColorValue.from_(i[1]);e.style.backgroundColor=null==n?"":n.toCSSString_();const s=RX.Comma1.exec(i[2]);if(null==s)return;t=s[1]}}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return this._colorCells}}class DataUrlField extends DialogFieldSpecBase{constructor(t,e,i,n,s){super(),this.label$=t,this.key$=e,this.src$=i,this.width$=n,this.height$=s}create_(t,e){return new DataUrlFieldImpl(t,e,this)}}class DataUrlFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i;const n=ssmap_();n.src=i.src$;let s="margin:20px 10px 10px 0;border:none;";i.width$.length>0&&(s+=`max-width:${i.width$};`),i.height$.length>0&&(s+=`max-height:${i.height$};`),n.style=s;const o=i.label$.length>0;e.peek_().flexTextContainer_(o?t.labelWidth$:0,i.label$),o||e.addStyle_("justify-content","center"),this._img=e.img_(n).cursor_(),An.onClick_(this._img,()=>{i.src$.length>0&&t.onPreviewCallback$(t.element_(),i.src$).show_()})}get spec$(){return this._spec}element_(){return this._img.parentElement.parentElement}focus_(){return null}blur_(){}getValue_(t){return this._spec.src$}setValue_(t,e){this._img.setAttribute("src",t)}getInput_(t){return null}getValueElement_(t){return this._img}}class DateTimeField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o,l,a){super(),this.label$=t,this.key$=e,this.ms$=i,this.buttonsize$=n,this.placeholder$=s,this.dateformat$=o,this.timeformat$=l,this.showpanel$=a}create_(t,e){return new DateTimeFieldImpl(t,e,this)}}class DateTimeFieldImpl extends DialogField{constructor(t,e,i){var n;super(),this._spec=i;const s=i.ms$<0?DateTime.now_():DateTime.fromMillisecondsSinceEpoch_(i.ms$),o=null!==(n=i.showpanel$)&&void 0!==n?n:PromptDate.TIME;e.peek_().flexTextContainer_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)),this._input=DialogUt.promptDateInput_(e,t,i,s,o)}get spec$(){return this._spec}element_(){return this._input.parentElement.parentElement}focus_(){return null}blur_(){}getValue_(t){var e;return null!==(e=this._input.getAttribute(ATTR.xTooltips))&&void 0!==e?e:""}setValue_(t,e){const i=An.parseInt_(t,-1);i<0?(this._input.setAttribute(ATTR.xTooltips,""),this._input.textContent=""):(this._input.setAttribute(ATTR.xTooltips,`${i}`),this._input.textContent=t)}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return 0==t?this._input:null}}class DirpathField extends DialogFieldSpecBase{constructor(t,e,i,n){super(),this.key$=t,this.value=e,this.rootdir$=i,this.onclick_=n,this.label$=""}create_(t,e){return new DirpathFieldImpl(t,e,this)}}class DirpathFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._top=e.peek_().div1_(CSS.AnMarginV5).cursor_(),e.div1_(CSS.AnFlex,CSS.AnDirpath).push_(),this._rootbutton=_DialogUt.createActionButton_(e.peek_(),BUT.RootFolder),this._rootbutton.style.marginLeft="5px",this._dirpath=e.pop_().div1_(CSS.AnDirpathDir).cursor_(),this._rootbutton.addEventListener("click",e=>{An.stopevent_(e),t.clearStatus_(),this._spec.onclick_(null)}),An.addClickListenerMatching_(this._dirpath,"a",(e,i)=>{An.stopevent_(i),t.clearStatus_(),this._spec.onclick_(e)})}get spec$(){return this._spec}element_(){return this._top}focus_(){return null}blur_(){}getValue_(t){return""}setValue_(t,e){}getButton_(t){return t==BUT.RootFolder?this._rootbutton:null}getInput_(t){return null}getValueElement_(t){return this._dirpath}}class DirtreeField extends DialogFieldSpecBase{constructor(t,e,i=null){super(),this.key$=t,this.onclick_=e,this.onresize_=i,this.label$=""}create_(t,e){return new DirtreeFieldImpl(t,e,this)}}class DirtreeFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._top=e.peek_().div1_(CSS.AnMarginV5).cursor_(),e.div_({class:CSS.AnFlex,style:"flex-basis:100%;flex-flow:nowrap;overflow:hidden"}),this._dirtree=e.div_(["class",`${CSS.AnFilepicker} ${CSS.AnDirtree}`]).cursor_(),An.addClickListenerMatching_(this._dirtree,`a, div.${CSS.AnRow}`,(e,i)=>{An.stopevent_(i),t.clearStatus_(),this._spec.onclick_(e)})}onResize_(){var t,e;null===(e=(t=this._spec).onresize_)||void 0===e||e.call(t,this._dirtree)}get spec$(){return this._spec}element_(){return this._top}focus_(){return null}blur_(){}getValue_(t){return""}setValue_(t,e){}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return this._dirtree}}class FilepathField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o,l){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.basedir$=s,this.buttons$=o,this.foldercallback$=l}create_(t,e){return new FilepathFieldImpl(t,e,this)}}class FilepathFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._top,this._input,this._pathkind,this._buttons]=_DialogUt.createFilepathInput_(e,t,i,()=>t.filepathFolderButtonPressed_(this,this._input,this._pathkind,i.basedir$,i.foldercallback$),()=>t.filepathKindButtonPressed_(this,this._input,this._pathkind,i.basedir$)),this.setupInput1_(t,this._input,()=>{t.filepathInputChanged_(this,this._input,this._pathkind,i.basedir$)}),this._input.setAttribute(ATTR.AnNoClick,"true"),An.onFocus_(this._input,()=>t.info_(this.getValue_()))}get spec$(){return this._spec}element_(){return this._top}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),this._buttons.forEach(t=>t.blur())}getValue_(t){return HumanFilepath.getValue_(this._input)}setValue_(t,e){HumanFilepath.setValue_(this._input,t)}getButton_(t){var e;return null!==(e=this._buttons.get(t))&&void 0!==e?e:null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class FilepathFolderField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.basedir$=s,this.foldercallback$=o,this.buttons$=[BUT.Folder]}create_(t,e){return new FilepathFolderFieldImpl(t,e,this)}}class FilepathFolderFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._top,this._input,this._button]=_DialogUt.createFilepathFolderInput_(e,t,i,()=>t.filepathFolderButtonPressed_(this,this._input,null,i.basedir$,i.foldercallback$)),this.setupInput1_(t,this._input,()=>{t.filepathInputChanged_(this,this._input,null,i.basedir$)}),this._input.setAttribute(ATTR.AnNoClick,"true"),An.onFocus_(this._input,()=>t.info_(this.getValue_()))}get spec$(){return this._spec}element_(){return this._top}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),this._button.blur()}getValue_(t){return HumanFilepath.getValue_(this._input)}setValue_(t,e){HumanFilepath.setValue_(this._input,t)}getButton_(t){return t==BUT.Folder?this._button:null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class FilterField extends DialogFieldSpecBase{constructor(t,e,i,n){super(),this.key$=t,this.value$=e,this.placeholder$=i,this.onsearch_=n}create_(t,e){return new FilterFieldImpl(t,e,this)}}class FilterFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._top=e.peek_().div1_(CSS.AnMarginV5).cursor_(),e.div_({class:CSS.AnFlex,style:"flex-basis:100%;flex-flow:nowrap;overflow:hidden"}).push_(),this._input=e.flexInput_(100,_DialogUt.placeholder_(i.placeholder$),t.tabIndex_()),this._input.style.marginRight="5px",this._clearbutton=_DialogUt.createActionButton_(e,BUT.ClearSearchText1),this._searchbutton=_DialogUt.createActionButton_(e,BUT.RegexSearch1),e.pop_(),this._input.value=i.value$;const n=()=>{t.clearStatus_(),this._spec.onsearch_(this._input.value.trim())};this._clearbutton.addEventListener("click",e=>{An.stopevent_(e),t.clearStatus_(),this._input.value="",this._spec.onsearch_("")}),this._searchbutton.addEventListener("click",t=>{An.stopevent_(t),n()}),this.setupInput1_(t,this._input,()=>{t.fireOnChange_(this,this._input),n()}),An.onInputEnterKey_(this._input,n)}get spec$(){return this._spec}element_(){return this._top}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),this._clearbutton.blur(),this._searchbutton.blur()}getValue_(t){return this._input.value.trim()}setValue_(t,e){this._input.value=t}getButton_(t){return t==BUT.ClearSearchText?this._clearbutton:t==BUT.RegexSearch?this._searchbutton:null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class GlassLayerFIeld extends DialogFieldSpecBase{constructor(t,e,i,n,s,o){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.buttonsize$=s,this.baseuri$=o}create_(t,e){return new GlassLayerFIeldImpl(t,e,this)}}class GlassLayerFIeldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,i.label$.length>0?e.peek_().flexTextContainer_(t.labelWidth$,MSG.string_(i.label$)):e.peek_().div1_(CSS.AnFlex).div1_(CSS.AnFlexRowNoWrap),this._sample=e.push_().div_(["class",CSS.AnFlex],[ATTR.placeholder,_DialogUt.placeholder_(this._spec.placeholder$)],["style","margin-right:5px;flex-basis:100%;align-self:stretch;justify-self:stretch;"]).cursor_(),this._buttonClear=_DialogUt.createActionButton_(e,BUT.Clear1),this._buttonEdit=_DialogUt.createActionButton_(e,BUT.Edit1),this._buttonGradient=_DialogUt.createActionButton_(e,BUT.Gradient1),this._buttonImage=_DialogUt.createActionButton_(e,BUT.PickImage1),e.pop_(),null!=this._spec.value$&&(this._sample.style.backgroundImage=this._spec.value$);const n=e=>{this._sample.style.backgroundImage=e,t.fireOnChange_(this,this._sample)};An.onClick_(this._sample,e=>{An.stopevent_(e),t.info_(this._getvalue())}),An.onClick_(this._buttonClear,t=>{An.stopevent_(t),n("")}),An.onClick_(this._buttonEdit,e=>{An.stopevent_(e);const i=this._getvalue(),s=native$.getIFrameContextPath_(),o=native$.getIFrameUri_();null!=s&&null!=o&&_Util.styleEditor_(accessories$,`background-image: ${i}`,s,o,An.above_(this.element_()),t,t=>{var e;const i=null!==(e=t["background-image"])&&void 0!==e?e:"";n(i)}).show_()}),An.onClick_(this._buttonGradient,e=>{An.stopevent_(e);const s=this._sample.style.backgroundImage;let o=0==s.length||s.startsWith("url(")?Gradient.def():cssParser$.parseGradient_(s);for(null==o&&(toasters$.warnKey_(RS.ErrorParsingStyle),o=Gradient.def());o.colorstops.length<4;)o.colorstops.push(null);new PromptGradient(t.container_(),i.buttonsize$,o).above_(t.element_()).onOK_(t=>{n(t)}).show_()}),An.onClick_(this._buttonImage,e=>{An.stopevent_(e);const n=this._sample.style.backgroundImage,s=0==n.length||"none"==n||An.isGradient_(n)?HumanLink.Empty$:CSSUtil.humanCSSUrl_(n);new PromptImageUrl(t.container_(),s,i.baseuri$,RS.ImageURL,Callbacks.onReadImageFolderButton_).titleKey_(RS.PickImage).above_(t.element_()).onOK_((e,i,n)=>{Sanitizers.checkOptionalImageUri_(i).onFail_(t=>{n(!1),e.warn_(t)}).onOK_(e=>{n(!0),this._sample.style.backgroundImage=null==e?"":CSSUtil.toCSSUrl_(e.encodedPath$+e.hash$),t.fireOnChange_(this,this._sample)})}).showFilepicker_().show_()})}get spec$(){return this._spec}element_(){return this._sample.parentElement.parentElement}focus_(){return this._sample.focus(),this._sample}blur_(){this._sample.blur()}getValue_(t){return this._sample.style.backgroundImage}setValue_(t,e){this._sample.style.backgroundImage=t}getButton_(t){return t==BUT.Clear1?this._buttonClear:t==BUT.Edit1?this._buttonEdit:t==BUT.Gradient1?this._buttonGradient:t==BUT.PickImage1?this._buttonImage:null}getInput_(t){return null}getValueElement_(t){return 0==t?this._sample:null}_getvalue(){return this._sample.style.backgroundImage}}class InputField extends DialogFieldSpecBase{constructor(t,e,i,n){super(),this.label$=t,this.key$=e,this.value=i,this.placeholder$=n}create_(t,e){return new InputFIeldImpl(t,e,this)}}class InputFIeldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._input=e.peek_().flexTextInput_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$),_DialogUt.placeholder_(i.placeholder$),t.tabIndex_()),An.onInputFocusSelect_(this._input),i.value.length>0&&(this._input.value=i.value),this.setupInput_(t,this._input)}get spec$(){return this._spec}element_(){return this._input.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur()}getValue_(t){return this._input.value.trim()}setValue_(t,e){this._input.value=t}getButton_(t){return null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class InputButtonField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o=null){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.button$=s,this.buttoncallback$=o}create_(t,e){return new InputButtonFieldImpl(t,e,this)}}class InputButtonFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,e.peek_().flexTextContainer_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)),[this._input,this._button]=_DialogUt.createInputButton_(e,_DialogUt.placeholder_(i.placeholder$),t.tabIndex_(),i.value$,i.button$),this.setupInput_(t,this._input),null!=i.buttoncallback$&&An.onClick_(this._button,t=>{var e,i;An.stopevent_(t),null===(i=(e=this._spec).buttoncallback$)||void 0===i||i.call(e,this,this._input,this._button)})}get spec$(){return this._spec}element_(){return this._input.parentElement.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),this._button.blur()}getValue_(t){return this._input.value.trim()}setValue_(t,e){this._input.value=t}getButton_(t){return this._button}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return 0==t?this._input:1==t?this._button:null}}class LabelButtonField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o=null){super(),this.label$=t,this.key$=e,this.placeholder$=i,this.button$=n,this.createlabel$=s,this.buttoncallback$=o}create_(t,e){return new LabelButtonFieldImpl(t,e,this)}}class LabelButtonFieldImpl extends DialogField{constructor(t,e,i){if(super(),this._spec=i,this._button=null,this._field=e.peek_().flexTextContainer_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)).cursor_().parentElement,i.createlabel$(e),null!=i.button$){const t=_DialogUt.createActionButton_(e,i.button$);t.style.marginLeft="5px",this._button=t,null!=i.buttoncallback$&&An.onClick_(t,e=>{var i,n;An.stopevent_(e),null===(n=(i=this._spec).buttoncallback$)||void 0===n||n.call(i,this,t)})}}get spec$(){return this._spec}element_(){return this._field}focus_(){return null}blur_(){}getValue_(t){return""}setValue_(t,e){}getButton_(t){return this._button}getInput_(t){return null}getValueElement_(t){return 0==t?this._button:null}}class InputButtonsField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.buttons$=s,this.callback$=o}create_(t,e){return new InputButtonsFieldImpl(t,e,this)}}class InputButtonsFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,e.peek_().flexTextContainer_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)),[this._input,this._buttons]=_DialogUt.createInputButtons_(e,_DialogUt.placeholder_(i.placeholder$),t.tabIndex_(),i.value$,i.buttons$,i.callback$),this.setupInput_(t,this._input)}get spec$(){return this._spec}element_(){return this._input.parentElement.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),Object.values(this._buttons).forEach(t=>t.blur())}getValue_(t){return this._input.value.trim()}setValue_(t,e){this._input.value=t}getButton_(t){return this._buttons[t]}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class InputSelectField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.selectvalue$=s,this.options$=o}create_(t,e){return new InputSelectFieldImpl(t,e,this)}}class InputSelectFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._input,this._select]=_DialogUt.flexTextInputSelect_(accessories$,e.peek_(),i.label$.length>0?t.labelWidth$:0,DEF.BASIS_60,MSG.string_(i.label$),i.value$,_DialogUt.placeholder_(i.placeholder$),t.tabIndex_(),i.selectvalue$,i.options$),this.setupInput_(t,this._input),this._select.onChange_(e=>{t.fireOnChange_(this,this._select)})}get spec$(){return this._spec}element_(){return this._input.parentElement.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur()}getValue_(t){let e=this._input.value.trim();if(0==t)return e;const i=this._select.getValue_("");return 1==t?i:(e.length>0&&(e+=i),e)}setValue_(t,e){if(0==t.length)return void(this._input.value="");const i=An.splitSizeUnit_(t);null!=i&&(this._input.value=i[0],this._select.setValue_(i[1]))}getButton_(t){return null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return 0==t?this._input:1==t?this._select:null}}class RadioButtonField extends DialogFieldSpecBase{constructor(t,e,i,n,s){super(),this.label$=t,this.key$=e,this.value$=i,this.text$=n,this.onclick$=s}create_(t,e){return new RadioButtonFieldImpl(t,e,this)}}class RadioButtonFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._input=e.peek_().flexTextDiv_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)).attrs_({class:CSS.AnPromptCheckbox}).input_({type:"checkbox",tabindex:t.tabIndex_()}).cursor_(),e.siblingAfter_("span",{style:"margin-left:0.5em;"}).text_(i.text$),this.setupInput_(t,this._input),this._input.checked="true"===i.value$,An.onClick_(this._input,t=>{An.stopevent_(t),i.onclick$()})}get spec$(){return this._spec}element_(){return this._input.parentElement.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur()}getValue_(t){return this._input.checked?"true":"false"}setValue_(t,e){this._input.checked="true"===t}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return 0==t?this._input:null}}class SelectInputField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o,l){super(),this.label$=t,this.key$=e,this.value$=i,this.sep$=n,this.placeholder$=s,this.selectvalue$=o,this.options$=l}create_(t,e){return new SelectInputFieldImpl(t,e,this)}}class SelectInputFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._select,this._input]=_DialogUt.flexTextSelectInput_(accessories$,e.peek_(),i.label$.length>0?t.labelWidth$:0,DEF.BASIS_60,MSG.string_(i.label$),i.value$,_DialogUt.placeholder_(i.placeholder$),t.tabIndex_(),i.selectvalue$,i.options$),this.setupInput_(t,this._input),this._select.onChange_(e=>{t.fireOnChange_(this,this._select)})}get spec$(){return this._spec}element_(){return this._input.parentElement.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur()}getValue_(t){let e=this._input.value.trim();if(0==t)return e;const i=this._select.getValue_("");return 1==t?i:(e.length>0&&(e+=this._spec.sep$+i),e)}setValue_(t,e){if(0==t.length)return void(this._input.value="");const i=t.split(this._spec.sep$);2==i.length&&(this._input.value=i[0],this._select.setValue_(i[1]))}getButton_(t){return null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return 0==t?this._input:1==t?this._select:null}}class InputSelect2Field extends DialogFieldSpecBase{constructor(t,e,i,n,s,o,l,a,r,_,c){super(),this.label$=t,this.key$=e,this.sep$=i,this.value1$=n,this.placeholder1$=s,this.selectvalue1$=o,this.options1$=l,this.value2$=a,this.placeholder2$=r,this.selectvalue2$=_,this.options2$=c}static splitValue(t,e){const i=t.split(e);if(1==i.length){const t=An.doubleStringSizeUnit_(i[0].trim());return null==t?null:[t[0],t[1],"",t[1]]}if(2==i.length){const t=An.doubleStringSizeUnit_(i[0].trim()),e=An.doubleStringSizeUnit_(i[1].trim());return null==t||null==e?null:[t[0],t[1],e[0],e[1]]}return null}create_(t,e){return new InputSelect2FieldImpl(t,e,this)}}class InputSelect2FieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._input1,this._select1,this._input2,this._select2]=_DialogUt.flexTextInputSelect2_(accessories$,e.peek_(),i.label$.length>0?t.labelWidth$:0,DEF.BASIS_60,t.tabIndex_(),t.tabIndex_(),i),this.setupInput_(t,this._input1),this._select1.onChange_(e=>{t.fireOnChange_(this,this._select1)}),this.setupInput_(t,this._input2),this._select2.onChange_(e=>{t.fireOnChange_(this,this._select2)})}get spec$(){return this._spec}element_(){return this._input1.parentElement.parentElement}focus_(){return this._input1.focus(),this._input1}blur_(){this._input1.blur(),this._input2.blur()}getValue_(t){let e=this._input1.value.trim();if(0==t)return e;const i=this._select1.getValue_("");if(1==t)return i;let n=this._input2.value.trim();if(2==t)return n;const s=this._select2.getValue_("");return 3==t?i:(e.length>0&&(e+=i),n.length>0&&(n+=s),e+this._spec.sep$+n)}setValue_(t,e){if(0==e)return void(this._input1.value=t);if(1==e)return void this._select1.setValue_(t);if(2==e)return void(this._input2.value=t);if(3==e)return void this._select2.setValue_(t);if(0==t.length)return this._input1.value="",void(this._input2.value="");const i=InputSelect2Field.splitValue(t,this._spec.sep$);null!=i&&(this._input1.value=i[0],this._select1.setValue_(i[1]),this._input2.value=i[2],this._select2.setValue_(i[3]))}getButton_(t){return null}getInput_(t){return 0==t?this._input1:2==t?this._input2:null}getValueElement_(t){return 0==t?this._input1:1==t?this._select1:2==t?this._input2:3==t?this._select2:null}}class Input2FIeld extends DialogFieldSpecBase{constructor(t,e,i,n,s,o,l,a,r,_,c,h){super(),this.label$=t,this.key$=e,this.sep$=i,this.buttonsize$=n,this.placeholder1$=s,this.key1$=o,this.value1$=l,this.unit1$=a,this.placeholder2$=r,this.key2$=_,this.value2$=c,this.unit2$=h}create_(t,e){return new Input2FieldImpl(t,e,this)}}class Input2FieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._input1,this._input2]=_DialogUt.flexTextInput2_(e.peek_(),i.buttonsize$,i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$),DEF.BASIS_60,t.tabIndex_(),_DialogUt.placeholder_(i.placeholder1$),i.value1$,i.unit1$,t.tabIndex_(),_DialogUt.placeholder_(i.placeholder2$),i.value2$,i.unit2$),this.setupInput_(t,this._input1),this.setupInput_(t,this._input2)}get spec$(){return this._spec}element_(){return this._input1.parentElement.parentElement}focus_(){return this._input1.focus(),this._input1}blur_(){this._input1.blur(),this._input2.blur()}getValue_(t){const e=this._input1.value.trim();if(0==t)return e;const i=this._input2.value.trim();return 1==t?i:e+this._spec.sep$+i}setValue_(t,e){if(0!=e)if(1!=e)if(0==t.length)this._input1.value="",this._input2.value="";else if(t.includes(this._spec.sep$)){const e=t.split(this._spec.sep$);e.length>=2&&(this._input1.value=e[0],this._input2.value=e[1])}else this._input1.value=t,this._input2.value="";else this._input2.value=t;else this._input1.value=t}getButton_(t){return null}getInput_(t){return 0==t?this._input1:1==t?this._input2:null}getValueElement_(t){return this.getInput_(t)}}class SampleField extends DialogFieldSpecBase{constructor(t,e=""){super(),this.key$=t,this.style$=e}create_(t,e){return new SampleFieldImpl(t,e,this)}}class SampleFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i;const n=smap_(["class",CSS.AnFlexCenter],["style","width:100%;overflow:hidden;"+i.style$]);this._div=e.peek_().div_(n).cursor_()}get spec$(){return this._spec}element_(){return this._div}focus_(){return null}blur_(){}getValue_(t){return""}setValue_(t,e){}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return 0==t?this._div:null}}class SelectFIeld extends DialogFieldSpecBase{constructor(t,e,i,n,s){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.options$=s}create_(t,e){return new SelectFIeldImpl(t,e,this)}}class SelectFIeldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,e.peek_(),this._select=_DialogUt.flexTextSelect_(accessories$,e,i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$),_DialogUt.placeholder_(i.placeholder$));const n=Math.max(0,i.options$.indexOf(i.value$));this._select.setOptions_(i.options$,null,n),this._select.onChange_(e=>{t.fireOnChange_(this,this._select)})}get spec$(){return this._spec}element_(){return this._select.element_().parentElement}focus_(){return null}blur_(){}getValue_(t){return this._select.getValue_("")}setValue_(t,e){this._select.setValue_(t)}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return 0==t?this._select:null}}class SeparatorField extends DialogFieldSpecBase{constructor(t="height:0;margin:5px 0;"){super(),this.style$=t}get key$(){return""}create_(t,e){return new SeparatorFieldImpl(t,e,this)}}SeparatorField.DEF=new SeparatorField;class SeparatorFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,this._div=e.peek_().div_({class:`${CSS.AnFlex}`,style:i.style$}).cursor_()}get spec$(){return this._spec}element_(){return this._div}focus_(){return null}blur_(){}getValue_(t){return""}setValue_(t,e){}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return 0==t?this._div:null}}class SliderField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o,l,a,r,_=null){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.min$=s,this.max$=o,this.step$=l,this.mark$=a,this.height$=r,this.oninput$=_}create_(t,e){return new SliderFIeldImpl(t,e,this)}}class SliderFIeldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,e.peek_().flexTextContainer_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$)),this._slider=DialogUt.createInputSlider_(e,i.min$,i.max$,i.step$,i.mark$,i.height$,i.value$,i.placeholder$,t.tabIndex_(),()=>{t.fireOnChange_(this,this._slider)})}get spec$(){return this._spec}element_(){return this._slider.parentElement.parentElement}focus_(){return this._slider.focus(),this._slider}blur_(){this._slider.blur()}getValue_(t){return this._slider.value}setValue_(t,e){this._slider.value=t}getButton_(t){return null}getInput_(t){return null}getValueElement_(t){return 0==t?this._slider:null}}class CompositeTabPanel extends UIPanelBase{constructor(t,e,i){super(),this._container=t,this._host=e,this._specs=i,this._fields=new Array;const n=new DomBuilderEx(this._container);n.div_({class:CSS.AnFlexColumnNoWrap,style:"align-items:stretch;margin:5px 0;"}).push_();const s=t=>{t.element_().classList.add(CSS.AnMarginTop5),this._fields.push(t)};for(let t of i){const i=t.create_(e,n.peek_());if(i instanceof Array)for(const t of i)s(t);else s(i)}}element_(){return this._container}}class TabField{constructor(t,e,i){this.tooltips$=t,this.classes$=e,this.createPanel_=i}}class TabbedPanelField extends DialogFieldSpecBase{constructor(t="",e){super(),this.key$=t,this.tabs$=e}create_(t,e){return new TabbedPanelFieldImpl(t,e,this).create_()}}class TabbedPanelFieldImpl extends DialogField{constructor(t,e,i){super(),this._host=t,this._spec=i,this._container=e.cursor_();const n=new TabPanel(this._container);this._tabPanel=n}create_(){const t=new Array;t.push(this);for(const e of this._spec.tabs$)this._tabPanel.addTab(e.tooltips$,e.classes$,i=>(i.style.overflow="auto",e.createPanel_(t,this._host,i)));return this._tabPanel.onTabClicked(()=>{this._host.clearStatus_()}),t}tabPanel_(){return this._tabPanel}get spec$(){return this._spec}element_(){return this._container}focus_(){const t=this._tabPanel.activeTab();return this._tabPanel.selectTab(t),t}blur_(){this._tabPanel.selectTab(null)}getValue_(t){var e,i;return null!==(i=null===(e=this._tabPanel.activeTab())||void 0===e?void 0:e.getAttribute(ATTR.xTooltips))&&void 0!==i?i:""}setValue_(t,e){}getInput_(t){return null}getValueElement_(t){return this._tabPanel.activeTab()}}class TextAreaField extends DialogFieldSpecBase{constructor(t,e,i,n,s){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.classes$=s}create_(t,e){return new TextAreaFieldImpl(t,e,this)}}class TextAreaFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i;const n=smap_(["class",i.classes$],["tabindex",t.tabIndex_()],[ATTR.placeholder,_DialogUt.placeholder_(i.placeholder$)],[ATTR.autocapitalize,"none"]);this._input=e.peek_().flexTextTextarea_(i.label$.length>0?t.labelWidth$:0,MSG.string_(i.label$),n),this._input.value=i.value$,this.setupInput_(t,this._input)}get spec$(){return this._spec}element_(){return this._input.parentElement}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur()}getValue_(t){return this._input.value}setValue_(t,e){this._input.value=t}getButton_(t){return null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class UriField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o=[],l){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.baseuri$=s,this.buttons$=o,this.foldercallback$=l}create_(t,e){return new UriFIeldImpl(t,e,this)}}class UriFIeldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._top,this._input,this._pathkind,this._buttons]=_DialogUt.createUrlInput_(e,t,i,()=>t.uriFolderButtonPressed_(this,this._input,this._pathkind,i.baseuri$,i.foldercallback$),()=>t.uriKindButtonPressed_(this,this._input,this._pathkind,i.baseuri$),()=>t.importFromPhotoLibraryButtonPressed_(this,this._input,this._pathkind,i.baseuri$,i.foldercallback$)),this.setupInput1_(t,this._input,()=>{t.uriInputChanged_(this,this._input,this._pathkind,i.baseuri$)}),this._input.setAttribute(ATTR.AnNoClick,"true"),An.onFocus_(this._input,()=>t.info_(this.getValue_()))}get spec$(){return this._spec}element_(){return this._top}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),this._buttons.forEach(t=>t.blur())}getValue_(t){return HumanLink.getValue_(this._input)}setValue_(t,e){HumanLink.setValue_(this._input,t)}getButton_(t){var e;return null!==(e=this._buttons.get(t))&&void 0!==e?e:null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class UriFolderField extends DialogFieldSpecBase{constructor(t,e,i,n,s,o){super(),this.label$=t,this.key$=e,this.value$=i,this.placeholder$=n,this.baseuri$=s,this.foldercallback$=o,this.buttons$=[BUT.Folder]}create_(t,e){return new UriFolderFieldImpl(t,e,this)}}class UriFolderFieldImpl extends DialogField{constructor(t,e,i){super(),this._spec=i,[this._top,this._input,this._button]=_DialogUt.createUrlFolderInput_(e,t,i,()=>t.uriFolderButtonPressed_(this,this._input,null,i.baseuri$,i.foldercallback$)),this.setupInput1_(t,this._input,()=>{t.uriInputChanged_(this,this._input,null,i.baseuri$)}),this._input.setAttribute(ATTR.AnNoClick,"true"),An.onFocus_(this._input,()=>t.info_(this.getValue_()))}get spec$(){return this._spec}element_(){return this._top}focus_(){return this._input.focus(),this._input}blur_(){this._input.blur(),this._button.blur()}getValue_(t){return HumanLink.getValue_(this._input)}setValue_(t,e){HumanLink.setValue_(this._input,t)}getButton_(t){return t==BUT.Folder?this._button:null}getInput_(t){return 0==t?this._input:null}getValueElement_(t){return this.getInput_(t)}}class CompositeDialogBase extends DialogBaseWithFocusInput{constructor(t,e,i=null){super(t),this._specs=e,this._fieldsArray=new Array,this._onImageContextmenuCallback=null,this._onPreviewCallback=null,null!=i&&(this._labelWidth=i),super.init_(this.create_(t))}get onImageContextmenuCallback$(){return this._onImageContextmenuCallback}get onPreviewCallback$(){return this._onPreviewCallback}create_(t){return this.createDialog_(t,t=>this.createContent(t),t=>new Toolbar(t,BUT.infosHelpCopyPasteOKCancel),t=>this._toolbarActions(t))}createContent(t){this._content=t;for(let t of this._specs)this._addField(t)}specs(){return this._specs}_removeField(t){const e=this._fieldsArray.findIndex(e=>e.spec$.key$==t.spec$.key$);e>=0&&(this._fieldsArray.splice(e,1),t.element_().remove())}_addField(t){const e=t=>{t.element_().classList.add(CSS.AnMarginTop5),this._fieldsArray.push(t)};let i=t.create_(this,new DomBuilderEx(this._content).push_());if(i instanceof Array)for(const t of i)e(t);else e(i);return i}_foreachField(t){this._fieldsArray.forEach(t)}close_(){super.close_(),this._fieldsArray.length=0,this._onImageContextmenuCallback=null,this._onPreviewCallback=null}onImageContextmenu_(t){return this._onImageContextmenuCallback=t,this}filepathKindButtonPressed_(t,e,i,n){const s=HumanFilepath.getValue_(e),[o]=DialogUt.onFilepathKindButton_(i,s,n);HumanFilepath.setValue_(e,o),this.info_(HumanFilepath.getValue_(e)),this.fireOnChange_(t,e)}filepathFolderButtonPressed_(t,e,i,n,s){s(HumanFilepath.getValue_(e),n,An.above_(this.element_()),s=>{const o=Callbacks.getFilepathOfKind_(DialogUt.getPathKind_(i),s,n);HumanFilepath.setValue_(e,o),this.info_(HumanFilepath.getValue_(e)),this.fireOnChange_(t,e)})}filepathInputChanged_(t,e,i,n){const s=HumanFilepath.getValue_(e),o=Callbacks.getFilepathOfKind_(DialogUt.getPathKind_(i),s,n);HumanFilepath.setValue_(e,o),this.info_(HumanFilepath.getValue_(e)),this.fireOnChange_(t,e)}basenameButtonPressed_(t,e,i,n,s){s(Basepath.joinPath_(n,i),n,An.above_(this.element_()),i=>{t.setValue_(Basepath.nameWithSuffix_(i)),this.info_(HumanFilepath.getValue_(e)),this.fireOnChange_(t,e)})}uriKindButtonPressed_(t,e,i,n){const s=HumanLink.getValue_(e);An.classlist_(i).toggleAll_(CSS.AnButtonDown,CSS.AnButtonFlat),this._updateUriInput(e,i,n,s),this.info_(HumanLink.getValue_(e)),this.fireOnChange_(t,e)}uriFolderButtonPressed_(t,e,i,n,s){const o=HumanLink.fromInput_(e);s(o.filepath$,An.cdirOfUri_(n),An.above_(this.element_()),s=>{const l=o.changeFilepath_(s).humanHref$;this._updateUriInput(e,i,n,l),this.info_(HumanLink.getValue_(e)),this.fireOnChange_(t,e)})}uriInputChanged_(t,e,i,n){const s=HumanLink.getValue_(e);0!=s.length&&"."!=s?(this._updateUriInput(e,i,n,s),this.info_(HumanLink.getValue_(e)),this.fireOnChange_(t,e)):this.warn_(MSG.string_(RS.URLInputMustNotBeEmpty))}importFromPhotoLibraryButtonPressed_(t,e,i,n){const s=HumanLink.fromInput_(e);Callbacks.onImportImageFromPhotoLibraryButton_(An.above_(this.element_()),o=>{const l=s.changeFilepath_(o).humanHref$;this._updateUriInput(e,i,n,l),this.info_(HumanLink.getValue_(e)),this.fireOnChange_(t,e)})}_updateUriInput(t,e,i,n){const s=this.parseUri_(n,i);if(null==s)return void this.warn_(MSG.string1_(RS.InvalidURL_,n));const o=DialogUt.getPathKind_(e),l=Callbacks.getUriOfKind_(o,s);HumanLink.setUri_(t,l),toasters$.infoKey_(o?RS.Absolute:RS.Relative,{attop:!1})}postUpdate(t){this._shown&&t()}onPreview(t){return this._onPreviewCallback=t,this}setInitialFocus_(){for(const t of this._fieldsArray){const e=t.focus_();if(null!=e){this._focusInput=e;break}}}blurAll(){for(const t of this._fieldsArray)t.blur_();this._focusInput=null}setVisible_(t,e){return this.getField_(t).element_().style.display=e?"":"none",this}setVisibleAt_(t,e){this.getFieldAt_(t).element_().style.display=e?"":"none"}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.Help:this.actionHelp_();break;case BUT.PasteFromLocalClipboard:null!=this._focusInput&&(this.actionPaste_(this._focusInput),this._focusInput.dispatchEvent(new Event("change")));break;case BUT.CopyToLocalClipboard:null!=this._focusInput&&this.actionCopy_(this._focusInput);break;case BUT.OK:this._onOK(t=>{t&&this.close_()});break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}getValue_(t,e){return this.getField_(t).getValue_(e)}getValueAt_(t,e){return this.getFieldAt_(t).getValue_(e)}getIntValue(t,e){return An.parseInt_(this.getField_(t).getValue_(e),null)}getIntValueAt(t,e){return An.parseInt_(this.getFieldAt_(t).getValue_(e),null)}setValue_(t,e,i){const n=this._fieldsArray.find(e=>e.spec$.key$==t);if(void 0===n)throw new Error(t);return n.setValue_(e,i),this}setLabel(t,e){const i=this._fieldsArray.find(e=>e.spec$.key$==t);if(void 0===i)throw new Error(t);const n=i.element_().querySelector(`div.${CSS.AnRightAlignLabel}`);null!=n&&(n.textContent=e)}setValueAt_(t,e,i){if(t<0||t>=this._fieldsArray.length)throw new Error(`${t}`);return this._fieldsArray[t].setValue_(e,i),this}getChanged_(t){const e=void 0!==t?t:new Map,i=new Map;return this._fieldsArray.forEach(t=>{const n=t.spec$,s=n.key$;if(0==s.length||s.startsWith("#"))return;const o=t.getValue_();if(o!==e.get(s)&&i.set(s,o),t instanceof Input2FieldImpl){const s=n,o=t.getValue_(0),l=t.getValue_(1);o!=e.get(s.key1$)&&i.set(s.key1$,o),l!=e.get(s.key2$)&&i.set(s.key2$,l)}}),i}getField_(t){const e=this._fieldsArray.find(e=>e.spec$.key$==t);if(void 0===e)throw new Error(t);return e}getFieldAt_(t){if(t<0||t>=this._fieldsArray.length)throw new Error(`${t}`);return this._fieldsArray[t]}_onResize(){super._onResize();for(let t of this._fieldsArray)t.onResize_()}}class PromptWarning extends DialogBase{constructor(t,e,i,n=null){super(t),super.init_(this.create_(t)),this.titleKey_(e),this.message_(i),this.above_(n)}create_(t){const e=this._createMessageDialog(t,BUT.infosCancel,t=>this._defaultToolbarHandler1(t));return e.classList.add(CSS.AnWarning),e}onDismiss_(t){this._cancelCallback=t}}class PromptOK extends DialogBase{constructor(t,e,i,n=null){super(t),this._okCallback=null,super.init_(this.create_(t)),this.titleKey_(e),this.message_(i),this.above_(n)}create_(t){return this._createMessageDialog(t,BUT.infosOKCancel,t=>this._toolbarActions(t))}onOK_(t){return this._okCallback=t,this}close_(){this._okCallback=null,super.close_()}_toolbarActions(t){switch(t){case BUT.OK:const e=this._okCallback;this.close_(),e();break;default:this._defaultToolbarHandler1(t)}}}class PromptSave extends DialogBase{constructor(t,e,i,n=DEF.zindexPromptSave){super(t),this._saveCallback=null,this._discardCallback=null,super.init_(this.create_(t)),this.titleKey_(e),this.message_(i),this.above_(n)}create_(t){const e=this._createMessageDialog(t,[BUT.info_(BUT.Save),BUT.info_(BUT.Discard),BUT.info_(BUT.Cancel)],t=>{switch(t){case BUT.Save:{const t=this._saveCallback;this.close_(),t();break}case BUT.Discard:{const t=this._discardCallback;this.close_(),t();break}default:this._defaultToolbarHandler1(t)}});return e.classList.add(CSS.AnWarning),e}close_(){super.close_(),this._saveCallback=null,this._discardCallback=null}onSave_(t){this._saveCallback=t}onDiscard_(t){this._discardCallback=t}}class PromptInput extends DialogBaseWithFocusInput{constructor(t,e,i,n=null){super(t),this._okCallback=null,super.init_(this.create_(t)),this.titleKey_(e),this.above_(n),null!=this._input&&(this._input.value=i)}create_(t){return this.createDialog_(t,t=>this._createContent(t),t=>new Toolbar(t,BUT.infosCopyPasteOKCancel),t=>this._toolbarActions(t))}_createContent(t){const e=new DomBuilderEx(t);this._input=e.child_(Conf.input,INPUT.info_(INPUT.PromptInputAutoFocus)).cursor_(),An.onInputEnterKey_(An.onInputFocusSelect_(this._input),()=>{this._ok()})}close_(){super.close_(),this._okCallback=null}onOK_(t){return this._okCallback=t,this}setInitialFocus_(){An.focus_(this._input)}_ok(){var t,e;this._okCallback(this,null!==(e=null===(t=this._input)||void 0===t?void 0:t.value)&&void 0!==e?e:"",t=>{t&&this.close_()})}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.OK:this._ok();break;default:super.defaultToolbarActions_(t)}}}class PromptEditTextBase extends DialogBaseWithFocusInput{constructor(t,e,i,n,s,o){super(t),this._buttonSize=e,this._fontFamily=i,this._dateFormat=n,this._timeFormat=s,this._promptSymbolHandler=o,this._contextmenu=null,this._textarea=null,this._escaped=!1,this.largeWidth_()}_createContent(t){this._textarea=new DomBuilderEx(t).textarea_(INPUT.info_(INPUT.TextareaEditText)).addStyle_("margin-top","5px").cursor_(),null!=this._fontFamily&&(this._textarea.style.fontFamily=this._fontFamily)}_createContextmenu(){const t=new Contextmenu(this._container,An.above_(this._dialog),[BUT.infos_(BUT.CopyToLocalClipboard,BUT.CutToLocalClipboard,BUT.PasteFromLocalClipboard),BUT.infos_(BUT.Nbsp,BUT.Symbol,BUT.Date)]);return t.onTooltips_(toasters$.onTooltipsKey_),t.onDrag_(Contextmenu.contextmenuDragOK_),t.onAction_(t=>this._contextActions(t)),t.onShow_(()=>{null==t||t.enableButton_(BUT.Symbol,null!=this._promptSymbolHandler)}),t}close_(){var t;null===(t=this._contextmenu)||void 0===t||t.destroy_(),this._contextmenu=null,super.close_()}setInitialFocus_(){An.focus_(this._textarea)}_contextActions(t){var e;if(this.clearStatus_(),null===(e=this._contextmenu)||void 0===e||e.hide_(),null!=this._textarea)switch(t){case BUT.Symbol:if(null!=this._promptSymbolHandler){const t=new PromptSymbol(this._container,this._promptSymbolHandler);t.titleKey_(RS.InsertSymbolTitle),t.above_(this.dialog_()),t.onOK_((t,e,i)=>{this._pasteValue(this._textarea,null,this._escaped?An.escText_(t):t)}),t.show_()}break;case BUT.Date:{const t=DateTime.now_(),e=new PromptDate(this._container,t,t,PromptDate.ALL,this._buttonSize);e.titleKey_(RS.PromptDateTimeTitle),e.above_(this.dialog_()),e.dateFormat_(this._dateFormat),e.timeFormat_(this._timeFormat),e.defaultFormat(PromptDate.DATE),e.onOK_((t,e,i,n,s)=>{n=replaceAll_(n," ",""),this._pasteValue(this._textarea,null,this._escaped?An.escText_(n):n)}),e.show_();break}case BUT.Nbsp:{const t=this._textarea.value,e=this._textarea.selectionStart,i=this._textarea.selectionEnd,n=e<=i?e:i,s=e<=i?i:e,o=t.substring(0,n),l=t.substring(s);let a=this._escaped?"&#xa0;":"";s>n&&(a=replaceAll_(t.substring(n,s)," ",a));const r=n+(a=o+a+l).length;DialogBase._setTextAreaValueRange(this._textarea,a,r,r);break}case BUT.PasteFromLocalClipboard:this.actionPaste_(this._textarea,this._escaped);break;case BUT.CutToLocalClipboard:this.actionCut_(this._textarea,this._escaped);break;case BUT.CopyToLocalClipboard:this.actionCopy_(this._textarea,this._escaped);break;default:this.actionInvalid_(t)}}actionEscapeText(){if(null==this._textarea||null==this._toolbar)return;this._escaped=!this._escaped;const t=this._toolbar.button_(BUT.EscapeText);this._escaped?(t.classList.add(CSS.AnButtonDown),this._textarea.style.fontFamily="",this._textarea.value=An.escText_(this._textarea.value),this._textarea.setSelectionRange(0,0)):(t.classList.remove(CSS.AnButtonDown),null!=this._fontFamily&&(this._textarea.style.fontFamily=this._fontFamily),this._textarea.value=An.unescText_(this._textarea.value),this._textarea.setSelectionRange(0,0))}getvalue_(){var t,e;const i=null!==(e=null===(t=this._textarea)||void 0===t?void 0:t.value)&&void 0!==e?e:"";return this._escaped?An.unescText_(i):i}}class PromptEditText extends PromptEditTextBase{constructor(t,e,i,n,s,o,l=null){super(t,e,i,n,s,o),this._okCallback=null,this._initialValue=null,super.init_(this.create_(t)),this.above_(l)}create_(t){return this.createDialog_(t,t=>this._createContent(t),t=>new Toolbar(t,BUT.infos_(BUT.Contextmenu,BUT.EscapeText,BUT.OK,BUT.Cancel)),(t,e)=>this._toolbarActions(t,e))}close_(){this._okCallback=null,super.close_()}_toolbarActions(t,e){var i,n;switch(this.clearStatus_(),t){case BUT.Contextmenu:Timer.sleep1_(()=>{null==this._contextmenu&&(this._contextmenu=this._createContextmenu()),this._contextmenu.show_(e)});break;case BUT.EscapeText:this.actionEscapeText();break;case BUT.OK:{const t=this.getvalue_(),e=null!==(n=null===(i=this._textarea)||void 0===i?void 0:i.selectionStart)&&void 0!==n?n:0;this._okCallback(this,t,e,t=>this.actionOKConfirmed_(t));break}case BUT.Cancel:{const t=null!=this._initialValue&&null!=this._textarea&&this._initialValue!=this.getvalue_();_DialogUt.confirmCancel_(this,t,()=>this.actionCancelConfirmed_());break}default:this.actionInvalid_(t)}}onOK_(t){return this._okCallback=t,this}value_(t,e=null,i=null){this._initialValue=t,null!=this._textarea&&(this._textarea.value=t,null!=e&&(null==i&&(i=e),this._textarea.selectionStart=e,this._textarea.selectionEnd=i))}}class PromptInsertText extends PromptEditTextBase{constructor(t,e,i,n,s,o){var l,a;super(t,e,i,n,s,o),this._afterCallback=null,this._childCallback=null,super.init_(this.create_(t)),null===(l=this._toolbar.button_(BUT.After))||void 0===l||l.classList.add(CSS.AnDisabled),null===(a=this._toolbar.button_(BUT.Child))||void 0===a||a.classList.add(CSS.AnDisabled),null!=this._textarea&&(this._textarea.value=MSG.XXX$,An.select_(this._textarea))}create_(t){return this.createDialog_(t,t=>this._createContent(t),t=>new Toolbar(t,BUT.infos_(BUT.Contextmenu,BUT.EscapeText,BUT.Child,BUT.After,BUT.Cancel)),(t,e)=>this._toolbarActions(t,e))}close_(){super.close_(),this._childCallback=null,this._afterCallback=null}onAfter_(t){var e;null===(e=this._toolbar.button_(BUT.After))||void 0===e||e.classList.remove(CSS.AnDisabled),this._afterCallback=t}onChild_(t){var e;null===(e=this._toolbar.button_(BUT.Child))||void 0===e||e.classList.remove(CSS.AnDisabled),this._childCallback=t}_toolbarActions(t,e){if(this.clearStatus_(),null!=this._textarea)switch(t){case BUT.Contextmenu:Timer.sleep1_(()=>{null==this._contextmenu&&(this._contextmenu=this._createContextmenu()),this._contextmenu.show_(e)});break;case BUT.EscapeText:this.actionEscapeText();break;case BUT.After:null!=this._afterCallback&&this._afterCallback(this,this._textarea.value,t=>this.actionOKConfirmed_(t));break;case BUT.Child:null!=this._childCallback&&this._childCallback(this,this._textarea.value,t=>this.actionOKConfirmed_(t));break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}}class PromptElementBase extends DialogBaseWithFocusInput{constructor(t){super(t),this._okCallback=null,this._initialAttributes=null,this._initialTag=null,super.init_(this.create_(t))}create_(t){return this.createDialog_(t,t=>this._createContent(t),t=>new Toolbar(t,BUT.infosCopyPasteOKCancel),t=>this._toolbarActions(t))}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}setInitialFocus_(){An.focus_(this._textarea)}attributes_(t){this._initialAttributes=t,this._textarea.value=t}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.PasteFromLocalClipboard:this.actionPaste_(this._textarea);break;case BUT.CopyToLocalClipboard:this.actionCopy_(this._textarea);break;case BUT.OK:this._okCallback(this,this._gettag(),this._textarea.value,t=>this.actionOKConfirmed_(t));break;case BUT.Cancel:_DialogUt.confirmCancel_(this,null!=this._initialTag&&this._initialTag!=this._gettag()||null!=this._initialAttributes&&this._initialAttributes!=this._textarea.value,()=>this.actionCancelConfirmed_());break;default:this.actionInvalid_(t)}}}class PromptInsertElement extends DialogBaseWithFocusInput{constructor(t){var e,i;super(t),this._afterCallback=null,this._childCallback=null,this._validator=null,this._tag=null,super.init_(this.create_(t)),null===(e=this._toolbar.button_(BUT.After))||void 0===e||e.classList.add(CSS.AnDisabled),null===(i=this._toolbar.button_(BUT.Child))||void 0===i||i.classList.add(CSS.AnDisabled),this._onShowDialogCallback=t=>{null!=this._tag&&(this._inputTag.value=this._tag),An.setVisible_(t),Timer.sleep0_(()=>this.setInitialFocus_())}}create_(t){return this.createDialog_(t,t=>this._createContent(t),t=>new Toolbar(t,BUT.infos_(BUT.CopyToLocalClipboard,BUT.PasteFromLocalClipboard,BUT.Child,BUT.After,BUT.Cancel)),t=>this._toolbarActions(t))}_createContent(t){const e=new DomBuilderEx(t).push_();this._inputTag=e.peek_().child_(Conf.input,INPUT.info_(INPUT.PromptInput)).attr_("style","margin:5px 0;").cursor_(),this._textarea=e.peek_().textarea_(INPUT.info_(INPUT.TextareaOptionalAttributesFull)).cursor_()}close_(){super.close_(),this._afterCallback=null,this._childCallback=null}onAfter_(t){var e;return null===(e=this._toolbar.button_(BUT.After))||void 0===e||e.classList.remove(CSS.AnDisabled),this._afterCallback=t,this}onChild_(t){var e;return null===(e=this._toolbar.button_(BUT.Child))||void 0===e||e.classList.remove(CSS.AnDisabled),this._childCallback=t,this}onValidate_(t){return this._validator=t,this}tag_(t){return this._tag=t,this}_gettag(){return this._inputTag.value.trim()}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.PasteFromLocalClipboard:this.actionPaste_(this._textarea);break;case BUT.CopyToLocalClipboard:this.actionCopy_(this._textarea);break;case BUT.After:null!=this._afterCallback&&this._ok(this._afterCallback);break;case BUT.Child:null!=this._childCallback&&this._ok(this._childCallback);break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}_ok(t){null!=this._validator?this._validator(this._gettag(),this._textarea.value,e=>{if(!this.warn_(e[Key.errors])&&(this.close_(),toasters$.warn_(e[Key.warns]),null!=t)){const i=e[Key.tag],n=e[Key.attrs];t(i,n)}}):this.warnKey_(RS.AnElementValidatorIsRequired)}}class PromptElement extends PromptElementBase{constructor(t){super(t),this._onShowDialogCallback=t=>{null!=this._initialTag&&(this._inputTag.value=this._initialTag),An.setVisible_(t),Timer.sleep0_(()=>this.setInitialFocus_())}}tag_(t){this._initialTag=t}_createContent(t){const e=new DomBuilderEx(t).push_();this._inputTag=e.peek_().child_(Conf.input,INPUT.info_(INPUT.PromptInput)).attr_("style","margin:5px 0;").cursor_(),this._textarea=e.peek_().textarea_(INPUT.info_(INPUT.TextareaOptionalAttributesFull)).cursor_()}_gettag(){return this._inputTag.value.trim()}}class PromptEditElement extends PromptElementBase{constructor(t){super(t),this._onShowDialogCallback=t=>{null!=this._initialTag&&(this._inputTag.value=this._initialTag),An.setVisible_(t),Timer.sleep0_(()=>this.setInitialFocus_())}}tag_(t){this._initialTag=t}_createContent(t){const e=new DomBuilderEx(t).push_();this._inputTag=e.peek_().child_(Conf.input,INPUT.info_(INPUT.PromptInput)).attr_("style","margin:5px 0;").cursor_(),this._textarea=e.peek_().textarea_(INPUT.optionalAttributes(CSS.AnFull,"2")).cursor_(),An.onInputFocusSelect_(this._inputTag)}_gettag(){return this._inputTag.value}}class CompositeDialog extends CompositeDialogBase{constructor(t,e,i=null){super(t,e,i),this._okCallback=null}close_(){this._okCallback=null,super.close_()}getValueAt_(t,e){return super.getValueAt_(t,e)}onOK_(t){return this._okCallback=t,this}_onOK(t){this._okCallback(this,e=>{t(e)})}}class PromptLink extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new UriField("","",e,n,i,[BUT.PathKind,BUT.Folder],s)]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0);this._okCallback(this,e,e=>{t(e)})}}class PromptLink2 extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new UriField("","",e,RS.URL,n,[BUT.PathKind,BUT.Folder],s),new AttributesFIeld("","",i,RS.Attributes,`${CSS.AnPromptTextarea} ${CSS.AnHalf}`)]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0),i=this.getValueAt_(1);this._okCallback(this,e,i,e=>{t(e)})}}class PromptLink3 extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new UriField("",RS.URL,e,RS.URL,s,[BUT.PathKind,BUT.Folder],Callbacks.onLinkFolderButton_),new InputField("",RS.Text,i,RS.Text),new AttributesFIeld("",RS.Attributes,n,RS.Attributes,`${CSS.AnPromptTextarea} ${CSS.AnHalf}`)]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0),i=this.getValueAt_(1),n=this.getValueAt_(2);this._okCallback(this,e,i,n,e=>{t(e)})}}class PromptInsertImg extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new UriField("","",HumanLink.Empty$,RS.PlaceholderRequiredUrl,n,[BUT.CreateThumbnail,BUT.ImportImageFromPhotoLibrary,BUT.Folder,BUT.CreateLink,BUT.PathKind],s),new InputField("","",e,RS.Caption),new AttributesFIeld("","",i,RS.Attributes,`${CSS.AnPromptTextarea} ${CSS.AnHalf}`),new UriField("","",HumanLink.Empty$,RS.LinkURL,n,[BUT.PathKind,BUT.Folder],Callbacks.onLinkFolderButton_)]),this._okCallback=null,this._onThumbnailButtonCallback=null,this._createLink=!1;let o=this.getFieldAt_(0);this._createLinkButton=o.getButton_(BUT.CreateLink),An.onClick_(this._createLinkButton,t=>{An.stopevent_(t),this.clearStatus_(),An.classlist_(this._createLinkButton).toggleAll_(CSS.AnButtonFlat,CSS.AnButtonDown),this._createLink=!this._createLink,this._showLinkField(this._createLink);let e=this.hrefPathPart_(o.getValue_());const i=RX.Tn.exec(e);null!=i&&(e=i[1]+i[3]),this.setValueAt_(3,e+`?${Param.view}`)}),this._createThumbnailButton=o.getButton_(BUT.CreateThumbnail),this._createThumbnailButton.classList.add(CSS.AnDisabled),An.onClick_(this._createThumbnailButton,t=>{if(An.stopevent_(t),this.clearStatus_(),null!=this._onThumbnailButtonCallback){const t=o.getInput_(0),e=HumanLink.fromInput_(t);this._onThumbnailButtonCallback(e.filepath$,n,this,i=>{const s=o.getButton_(BUT.PathKind),l=e.changeFilepath_(i).humanHref$;this._updateUriInput(t,s,n,l),this.fireOnChange_(o,t),toasters$.ok_([MSG.string_(RS.CreatedThumbnail),i])})}}),this._showLinkField(this._createLink)}close_(){this._okCallback=null,this._onThumbnailButtonCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}onThumbnailButton_(t){return this._onThumbnailButtonCallback=t,null==t?this._createThumbnailButton.classList.add(CSS.AnDisabled):this._createThumbnailButton.classList.remove(CSS.AnDisabled),this}_showLinkField(t){if(this.setVisibleAt_(3,t),t){const t=this.getFieldAt_(3).getButton_(BUT.PathKind);if(null!=t){const e=DialogUt.getPathKind_(this.getFieldAt_(0).getButton_(BUT.PathKind));DialogUt.setPathKind_(t,e)}}}isCreateLink_(){return this._createLink}getSrcPathKind_(){return DialogUt.getPathKind_(this.getFieldAt_(0).getButton_(BUT.PathKind))}getHrefPathKind_(){return DialogUt.getPathKind_(this.getFieldAt_(3).getButton_(BUT.PathKind))}_onOK(t){const e=this.getValueAt_(0),i=this.getValueAt_(1),n=this.getValueAt_(2),s=this._createLink?this.getValueAt_(3):"";this._okCallback(this,e,i,n,s,e=>{t(e)})}hrefPathPart_(t){if(An.isempty_(t))return t;let e=t.indexOf("?");return e>=0?t.substring(0,e):((e=t.indexOf("#"))>=0&&(t=t.substring(0,e)),t)}showCaption_(t){return this.setVisibleAt_(1,t),this}showAttributes_(t){return this.setVisibleAt_(2,t),this}}class PromptEditMedia extends CompositeDialogBase{constructor(t,e,i,n,s,o){super(t,[new UriField("","",e,RS.PlaceholderRequiredUrl,n,s,o),new AttributesFIeld("","",i,RS.Attributes,`${CSS.AnPromptTextarea} ${CSS.AnHalf}`)]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0),i=this.getValueAt_(1),n=An.parseUriSafe_(e,native$.getIFrameUri_());null!=n?this._okCallback(this,n,i,e=>{t(e)}):t(!1)}}class PromptInputImage extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new FilepathField("","",HumanFilepath.Empty$,RS.PlaceholderRequiredFilepath,e,[BUT.PathKind,BUT.Folder],Callbacks.onReadImageFolderButton_),new InputSelectField("","",i.toString(),RS.Width,CSSLength.PX,CSSLengths),new InputSelectField("","",n.toString(),RS.Height,CSSLength.PX,CSSLengths),new SelectFIeld("","",s,RS.Rotation,["0 deg","90 deg","180 deg","270 deg"])]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){var e,i;const n=this.getValueAt_(0);let s=this.getValueAt_(1,0),o=this.getValueAt_(2,0);An.isempty_(s)||(s+=this.getValueAt_(1,1)),An.isempty_(o)||(o+=this.getValueAt_(2,1));const l=null!==(i=null===(e=An.parseIntUnit_(this.getValueAt_(3)))||void 0===e?void 0:e[0])&&void 0!==i?i:0;this._okCallback(this,n,s,o,l,e=>{t(e)})}}class PromptImageUrl2 extends CompositeDialogBase{constructor(t,e,i,n,s,o){super(t,[new UriField("","#0",e,RS.ImageURL,s,[BUT.CreateThumbnail,BUT.ImportImageFromPhotoLibrary,BUT.Folder,BUT.CreateLink,BUT.PathKind],o),new AttributesFIeld("","",i,RS.Attributes,`${CSS.AnPromptTextarea} ${CSS.AnHalf}`),new UriField("","",n,RS.LinkURL,s,[BUT.PathKind,BUT.Folder],Callbacks.onLinkFolderButton_)]),this._onThumbnailButtonCallback=null,this._okCallback=null,this._createLink=!1;const l=this.getFieldAt_(0),a=l.getButton_(BUT.CreateLink);this.setRawUrls(a,n),An.onClick_(a,t=>{An.stopevent_(t),this.clearStatus_(),An.classlist_(a).toggleAll_(CSS.AnButtonFlat,CSS.AnButtonDown),this._createLink=!this._createLink,this.setVisibleAt_(2,this._createLink);let e=l.getValue_();const i=RX.Tn.exec(e);null!=i&&(e=i[1]+i[3]),this.setValueAt_(2,e+`?${Param.view}`)});const r=l.getButton_(BUT.CreateThumbnail);r.classList.add(CSS.AnDisabled),An.onClick_(r,t=>{if(An.stopevent_(t),this.clearStatus_(),null!=this._onThumbnailButtonCallback){const t=l.getInput_(0),e=HumanLink.fromInput_(t);this._onThumbnailButtonCallback(e.filepath$,s,this,i=>{const n=l.getButton_(BUT.PathKind),o=e.changeFilepath_(i).humanHref$;this._updateUriInput(t,n,s,o),this.fireOnChange_(l,t),toasters$.ok_([MSG.string_(RS.CreatedThumbnail),i])})}})}close_(){this._okCallback=null,this._onThumbnailButtonCallback=null,super.close_()}setRawUrls(t,e){e.isEmpty$?this._createLink=!1:this._createLink=!0,An.setToggleButton_(t,this._createLink),this.setVisibleAt_(2,this._createLink)}onThumbnailButton(t){this._onThumbnailButtonCallback=t;const e=this.getFieldAt_(0).getButton_(BUT.CreateThumbnail).classList;return null==t?e.add(CSS.AnDisabled):e.remove(CSS.AnDisabled),this}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0),i=this.getValueAt_(1),n=this.getValueAt_(2);this._okCallback(this,e,i,this._createLink,n,e=>{t(e)})}}class PromptImageUrl extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new UriField("","",e,n,i,[BUT.PathKind,BUT.ImportImageFromPhotoLibrary,BUT.Folder],s)]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}showFilepicker_(){return this.onShowDialog_(()=>{An.setVisible_(this._dialog),Timer.sleep0_(()=>{var t;this.setInitialFocus_(),null===(t=this.getFieldAt_(0).getButton_(BUT.Folder))||void 0===t||t.click()})}),this}_onOK(t){const e=this.getValueAt_(0).trim(),i=0==e.length?null:An.parseUriSafe_(e,native$.getIFrameUri_());return null==i?(this.warn_(MSG.string_(0==e.length||"."==e?RS.URLInputMustNotBeEmpty:RS.InvalidURL)),void t(!1)):MimeUtil.isImagePath(i.path$)?void this._okCallback(this,i,e=>{t(e)}):(this.warnKey_(RS.ExpectingImageExt),void t(!1))}}class PromptImageFilepath extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new FilepathField("","",e,n,i,[BUT.ImportImageFromPhotoLibrary,BUT.Folder],s)]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0).trim();this._okCallback(this,e,e=>{t(e)})}}class SelectOptions{constructor(t,e,i=!1){this._container=t,this._input=e,this.readonly=i,this._values=[],this._labels=[],this._onchangeListeners=[],this._selectedIndex=-1,this._onClickListener=t=>{if(An.stopevent_(t),!this.readonly&&null!=this._values&&0!=this._values.length){const t=new PromptSelect(this._container,e,this._labels,this._selectedIndex);t.onOK_(t=>{this._selectedIndex=t;const i=this._labels[t];e.textContent=0==i.length?"":i;for(let e of this._onchangeListeners)e(this._values[t])}),t.show_()}},An.onClick_(e,t=>this._onClickListener(t))}element_(){return this._input}destroy_(){this._onchangeListeners=[]}get isReadonly$(){return this.readonly}setOptions_(t,e=null,i=null){return this._values=t,this._labels=null!=e?e:Array.from(this._values),this._selectedIndex=null!=i?i:0==this._labels.length?-1:0,this._refresh(),SelectOptionUtil.setOptions_(this._input,this._values,e,this._selectedIndex),this}onChange_(t){this._onchangeListeners.push(t)}onClick_(t){this._onClickListener=t}getValues_(){return this._values}getLabels_(){return this._labels}getSelectedIndex_(){return this._selectedIndex}setSelectedIndex_(t){this._selectedIndex=t,this._refresh()}getValue_(t){return this._isValidIndex(this._selectedIndex,this._values)?this._values[this._selectedIndex]:"number"==typeof t?this._values[t]:t}setValue_(t,e){let i="number"==typeof t?t:this._values.indexOf(t);if(!this._isValidIndex(i,this._values)){if(!this._isValidIndex(e,this._values))return;i=e}this._selectedIndex=i,this._refresh()}getLabel_(t){return null!=this._selectedIndex&&this._selectedIndex>=0&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:t}_refresh(){let t=this.getLabel_(null);null==t?(t="",this._selectedIndex=-1):0==t.length&&(t=""),this._input.textContent=t}_isValidIndex(t,e){return null!=t&&t>=0&&t<e.length}}class PromptSelect extends DialogBase{constructor(t,e,i,n){super(t),this._select=e,this._labels=i,this._selectedIndex=n,this._okCallback=null,super.init_(this.create_(t)),this.zindex_(DEF.zindexAbove10),this.smokescreenOpacity_(DEF.opacityTransparent),Conf.useFlash&&new Flash(this._content,"div",CSS.AnFlashLowlight,DEFUtil.flashDuration),An.onClick_(this._content,t=>{An.stopevent_(t);const e=DomUt.asHTMLElement_(t.target);if(null==e)return;const n=e.offsetTop+e.offsetHeight/2,s=this._content.clientHeight;if(s<=0)return;const o=Math.floor(n*i.length/s);if(o>=0&&o<i.length){const t=this._okCallback;return this.close_(),void t(o)}})}create_(t){return this._createDialogWithContentOnly(t,t=>{this._viewport=t;const e=new DomBuilderEx(t);this._content=e.div1_(CSS.AnSelect).push_().cursor_()})}close_(){this._okCallback=null,super.close_()}onSmokescreenCreated_(t){super.onSmokescreenCreated_(t),t.on_(Conf.touchend,t=>{An.stopevent_(t),this.actionCancel_()})}_allowTouchmove(){return!0}showDialog_(t){var e;if(null==this._labels||this._labels.length<=0)return void this.actionCancel_();let i=null;const n=new DomBuilderEx(this._content).empty_().push_();for(let t=0;t<this._labels.length;++t){const e=this._labels[t];n.peek_().div_().text_(e),t==this._selectedIndex&&(n.addClass_(CSS.AnSelected),i=n.cursor_())}let s=this._select;for(;null!=s;s=s.parentElement){const t=An.getComputedStyle_(s);if(null==t)continue;const i=null!==(e=null==t?void 0:t.zIndex)&&void 0!==e?e:null;if(null!=i&&i.length>0&&"auto"!=i&&"0"!=i){const e=t.position;if("fixed"==e||"absolute"==e){const t=An.adjustZIndex_(i,DEF.zindexAbove10,DEF.zindexPrompt);this.element_().style.zIndex=`${t}`;break}}}super.showDialog_(t),null!=i&&i.scrollIntoView({block:"center"})}_onResize(){const t=window.innerWidth,e=window.innerHeight,i=t/16,n=e/16,s=cache$.ui$.buttonSize_();this._table.style.padding="1ex 0.5em",this._table.style.minWidth="0",this._table.style.minHeight="0";const o=this._table.getBoundingClientRect();let l=Math.max(Math.round(o.width),3*s);const a=e-2*n-2*DEF.dialogPaddingWidth-2,r=Math.min(this._content.offsetHeight,a),_=t-l,c=_<i?i:_/2,h=n,u=Math.min(this._maxWidthMultipler*s,t-2*c),d=this._dialog.style;d.left=`${c}px`,d.top=`${h}px`,l>u&&(l=u),this._content.style.width=`${l}px`,this._content.style.maxWidth=`${u}px`,this._viewport.style.height=`${r}px`}onOK_(t){return this._okCallback=t,this}}class ChecklistDialogBase extends DialogBase{constructor(t){super(t),this._viewport=null,this._onShowDialogCallback=t=>this._onshow(t)}_createChecklistDialog(t,e,i){const n=new DomBuilderEx(t),s=n.div_({class:CSS.AnDialog,style:"display: none; visibility: hidden"}).cursor_();return n.table1_(CSS.AnDialog).push_().tr_().td_(),this._toolbar=new Toolbar(n.cursor_(),e),this._toolbar.onAction_(i),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._viewport=n.peek_().tr_().td_().div1_(CSS.AnPromptContent).addStyle_("margin-top","-0.5ex").cursor_(),this._populate(n.cursor_(),s),this._status=n.peek_().tr_().td1_(CSS.AnPromptStatus).div1_(CSS.AnPromptViewport).div1_(CSS.AnPromptStatus).cursor_(),n.pop_(),s}_onshow(t){An.showHidden_(t,"block"),this._resizecontent(this._viewport),An.setVisible_(t),Timer.sleep0_(()=>this.setInitialFocus_())}_resizecontent(t){if(null==t)return;const e=t.getBoundingClientRect(),i=Math.round(e.top),n=`${window.innerHeight-i-DEFUtil.dialogBottom_()-DEF.dialogPaddingWidth}px`;t.style.maxHeight=n}_getSelected(){return this._foreachChecked((t,e)=>{var i,n;const s=null!==(n=null===(i=e.nextElementSibling)||void 0===i?void 0:i.textContent)&&void 0!==n?n:null;null!=s&&t.push(s)})}_foreachChecked(t){const e=sarray_(),i=this._dialog.querySelectorAll(`div.${CSS.AnPromptChecklist} input[type=checkbox]`);for(const n of new ItemsIterable(i))n.checked&&t(e,n);return e}}class PromptCopyBase extends ChecklistDialogBase{constructor(t,e){super(t),this._copyInfos=e,this._selectOnly=null,super.init_(this.create_(t)),this.largeWidth_()}_allowTouchmove(){return!0}create_(t){return super._createChecklistDialog(t,BUT.infosOKCancel,t=>this._toolbarActions(t))}_overwritingTitle(t){return MSG.string_(RS.Overwriting)+`: ${t}`}setInitialFocus_(){An.focus_(this._toolbar.button_(BUT.Cancel))}selectOnly(t){this._selectOnly=t}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.OK:{this._toolbar.enableButton_(BUT.OK,!1),this._toolbar.enableButton_(BUT.Cancel,!1);const t=this._getSelected();this._onOK(t);break}case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}_populateOverwriting(t,e){if(e.size>0){const i=this._overwritingTitle(e.size);t.peek_().div1_(CSS.AnHeading,CSS.AnFlex).text_(i),DialogUt.populateOverwritingCheckboxList_(t,e,t=>null!=this._selectOnly&&this._selectOnly.includes(t))}}_populateCopying(t,e,i,n){if(e.size>0||0==n&&0==i){const i=this._copyingTitle(e.size);t.peek_().div1_(CSS.AnHeading,CSS.AnFlex).text_(i),e.size>0&&DialogUt.populateOverwritingCheckboxList_(t,e,t=>null==this._selectOnly||this._selectOnly.includes(t))}}_populateNotcopying(t,e){if(e.size>0){let i=0;const n=t.peek_().div1_(CSS.AnHeading).cursor_();t.peek_().div1_(CSS.AnPromptList).push_();for(const[n,s]of e.entries()){const e=s.length;i+=e,t.peek_().div_().text_(`${n} : ${e}`),t.peek_().ul_().push_();for(let i=0;i<e;++i)t.peek_().li_().text_(s[i]);t.pop_()}t.pop_();const s=this._notCopyingTitle(i);new DomBuilderEx(n).text_(s)}}_populateCopyInfo1(t,e,i,n){this._populateNotcopying(t,n),this._populateOverwriting(t,i),this._populateCopying(t,e,i.size,n.size)}_populate(t){var e,i,n;const s=mapFromStringMap_(null!==(e=this._copyInfos[Key.copying])&&void 0!==e?e:{}),o=mapFromStringMap_(null!==(i=this._copyInfos[Key.overwriting])&&void 0!==i?i:{}),l=mapFromStringMap_(null!==(n=this._copyInfos[Key.notcopying])&&void 0!==n?n:{}),a=new DomBuilderEx(t).push_();this._populateCopyInfo1(a,s,o,l),a.pop_(),this._toolbar.enableButton_(BUT.OK,s.size>0||o.size>0)}}class PromptCopy extends PromptCopyBase{constructor(t,e,i,n,s,o,l){super(t,l),this._handler=e,this._cut=i,this._preserveTimestamp=n,this._dstdir=s,this._srcpath=o,this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this._okCallback;if(t.length>0){const i=new Spinner(this._container);i.show_(()=>{Timer.sleep0_(()=>{this._handler.copy_(this._cut,this._preserveTimestamp,this._dstdir,this._srcpath,t,t=>{this.close_(),i.destroy_(),null==e||e(t)})})})}else{this.close_();const t=json_();t[Key.errors]=MSG.format1_(this._cut?RS.Moved_files:RS.Copied_files,"0"),e(t)}}_copyingTitle(t){return MSG.string_(this._cut?RS.Moving:RS.Copying)+`: ${t}`}_notCopyingTitle(t){return MSG.string_(this._cut?RS.NotMoving:RS.NotCopying)+`: ${t}`}}class PromptFilelist extends PromptCopyBase{constructor(t,e){super(t,e),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this._okCallback;this.close_(),e(t)}_copyingTitle(t){return MSG.format1_(RS.Total_files,`${t}`)}_overwritingTitle(t){return MSG.format1_(RS.Total_files,`${t}`)}_notCopyingTitle(t){return""}}class PromptDelete extends ChecklistDialogBase{constructor(t,e,i,n,s){super(t),this._handler=e,this._srcpath=i,this._filename=n,this._infos=s,this._dirpath=null,this._okCallback=null,super.init_(this.create_(t)),this.largeWidth_()}create_(t){return super._createChecklistDialog(t,BUT.infosOKCancel,t=>this._toolbarActions(t))}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}setInitialFocus_(){An.focus_(this._toolbar.button_(BUT.Cancel))}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.OK:if(this._toolbar.enableButton_(BUT.OK,!1),null!=this._dirpath){const t=new Spinner(this._container),e=this._dirpath;t.show_(()=>{Timer.sleep0_(()=>{this._handler.deleteDirSubtree_(e,e=>{const i=this._okCallback;this.close_(),t.destroy_(),i(e)})})})}else{const t=this._getSelected();if(t.length>0){const e=new Spinner(this._container);e.show_(()=>{Timer.sleep0_(()=>{this._handler.deleteAll_(this._srcpath,t,t=>{const i=this._okCallback;this.close_(),e.destroy_(),i(t)})})})}else{const t=this._okCallback;this.close_(),t(jsonOf_(Key.errors,"Deleted 0 files"))}}break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}_populate(t,e){var i,n;const s=this._infos[Key.dirpath];if(null!=s){this._dirpath=s;const i=new DomBuilderEx(t).empty_().push_();return i.peek_().div1_(CSS.AnHeading).text_(MSG.string_(RS.ConfirmDeletingRecursively)),i.div_().text_(s),this._toolbar.enableButton_(BUT.OK,!0),void e.classList.add(CSS.AnWarning)}const o=null!==(i=this._infos[Key.deleting])&&void 0!==i?i:[],l=null!==(n=this._infos[Key.notdeleting])&&void 0!==n?n:{},a=new DomBuilderEx(t).empty_().push_();if(o.length>0){const t=An.isempty_(this._filename);a.peek_().div1_(CSS.AnHeading,CSS.AnFlex).text_(`${MSG.string_(RS.Deleting)}`),DialogUt.populateCheckboxList_(a,o,e=>t||e==this._filename)}l.size>0&&(a.peek_().div1_(CSS.AnHeading).text_(MSG.string_(RS.NotDeleting_)),a.peek_().div1_(CSS.AnPromptList).push_(),l.forEach((t,e)=>{a.peek_().div_().text_(`${e} : ${t.length}`),a.peek_().ul_().push_();for(let e=0;e<t.length;++e)a.peek_().li_().text_(t[e]);a.pop_()}),a.pop_()),0==o.length&&0==l.size&&this.warnKey_(RS.NothingToDelete),this._toolbar.enableButton_(BUT.OK,o.length>0)}}class PromptImageConversion extends ChecklistDialogBase{constructor(t,e,i){super(t),this._filename=e,this._fileinfos=i,this._okCallback=null,super.init_(this.create_(t)),this.titleKey_(RS.PickImage),this.largeWidth_()}create_(t){return this._createChecklistDialog(t,BUT.infosOKCancel,t=>this._toolbarActions(t))}_populate(t,e){const i=new DomBuilderEx(t).empty_().push_();if(this._fileinfos.length>0){const t=An.isempty_(this._filename),e=this._fileinfos.map(t=>t.name_());i.peek_().div_(["class",`${CSS.AnHeading} ${CSS.AnFlex}`],[ATTR.xTooltips,MSG.string_(RS.ToggleAll)]).text_(`${MSG.string_(RS.Converting)}`),DialogUt.populateCheckboxList_(i,e,e=>t||e==this._filename)}}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}setInitialFocus_(){An.focus_(this._toolbar.button_(BUT.Cancel))}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.OK:{const t=this._getSelected(),e=this._okCallback;this.close_(),e(t);break}case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}}class _OpacitySlider extends Slider{constructor(t,e,i,n,s,o){super(t,e,i,n,s,o),this._opacity=0,this._changeCallback=null,this.onClick_(t=>{const e=super.range_(),i=Math.round(Math.max(0,Math.min(100,t/e*100)));this._setvalue(i/100)}),this.onDrag_(t=>{const e=Math.max(0,Math.min(1,this._opacity+.01*t));this._setvalue(e)}),this.element_().style.margin=`${i}px 0`}destroy_(){super.destroy_(),this._changeCallback=null}onChange_(t){this._changeCallback=t}get value$(){return this._opacity}set value$(t){this._setvalue(t)}_setvalue(t){if(t!=this._opacity){this._opacity=t;const e=Math.round(super.range_()*this._opacity);super.setPosition_(e),null!=this._changeCallback&&this._changeCallback(this._opacity)}}}class PromptColor extends FixedSizeDialogBase{constructor(t,e){super(t,e),this._okCallback=null,this._initialColorValue=null,this._color=null,this._name="",this._hex=!1,_destroyed_2.set(this,!1),super.init_(this.create_(t)),this.titleKey_(RS.PickColor),this.setColor("255, 255, 255, 0.0",ColorValue.X_TRANSPARENT)}static getSingleton(t,e){return++PromptColor._count,(null==PromptColor._singleton||PromptColor._singleton._buttonSize!=e||null==PromptColor._singleton.dialog_()||PromptColor._count>100)&&(null!=PromptColor._singleton&&PromptColor._singleton.destroy(),PromptColor._singleton=new PromptColor(t,e),PromptColor._count=1),PromptColor._singleton}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),BUT.infosCopyPasteOKCancel,t=>this._toolbarActions(t))}_createContent(t){const e=new DomBuilderEx(t).push_();e.div_({class:CSS.AnFlex,style:"flex-flow: column nowrap; padding-top: 10px; "}).push_(),this._createColorInput(e),this._createOpacityInput(e),this._createTabpanel(e),An.onInputFocusSelect_(this._inputColor),An.onInputChange_(this._inputColor,()=>this._inputColorChanged()),An.onInputEnterKey_(this._inputColor,()=>{this._inputColorChanged()}),An.onClick_(this._currentOpacity,()=>{let t=this._inputOpacity.value$;t=t<.25?.25:t<.5?.5:t<.75?.75:t<1?1:0;const e=ColorUtil.getColorValue_(this._currentColor.style.backgroundColor,t);null!=e&&this._setcolor(e,null)}),this._inputOpacity.onChange_(t=>{const e=ColorUtil.getColorValue_(this._currentColor.style.backgroundColor,t);null!=e&&this._setcolor(e,this._inputOpacity.slider_())}),this._colorPalettePanel.onColorChanged(t=>{const e=ColorUtil.getColorValue_(t,1);null!=e&&this._setcolor(e,this._colorPalettePanel._container)}),this._colorListPanel.onColorChanged(t=>{const e=ColorUtil.getColorValue_(t[1],1);null!=e&&(this._setcolor(e,this._colorListPanel.container()),null!=e&&e.isOpaque$&&ColorUtil.isCSSColor_(t)&&(this._inputColor.value=t[0]))}),this._colorPickerPanel.onColorChanged((t,e,i,n)=>{const s=this._getopacity(),o=ColorValue.fromRGBA_(t.r$,t.g$,t.b$,s);this._setcolor(o,this._colorPickerPanel._container)})}_createColorInput(t){t.peek_().div1_(CSS.AnFlex).push_(),t.peek_().div_({class:CSS.AnFlex,style:`flex-basis:${DEF.BASIS_20}%;align-self:stretch;border:${DEF.themeBorder};background-color:#fff;`}).push_().cursor_().addEventListener("click",t=>{An.stopevent_(t),null!=this._initialColorValue&&this._setcolor(this._initialColorValue)}),this._initialColor=t.div_({style:`flex-basis:${DEF.BASIS_50}%;align-self:stretch;`}).cursor_(),this._currentColor=t.pop_().div_({style:`flex-basis:${DEF.BASIS_50}%;align-self:stretch;`}).cursor_(),t.peek_().div_({style:"width:5px;"});const e=Math.round(.8*(6*this._buttonSize-5));t.peek_().div_({class:CSS.AnFlex,style:`flex-basis:${DEF.BASIS_80}%;width:${e}px;box-sizing:border-box;`}).push_(),this._inputColor=t.div_({class:CSS.AnButtonInput,style:"flex-basis:100%;"}).child_(Conf.input,smap_(["rows","1"],["class",CSS.AnButtonInput],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])).cursor_(),this._hexButton=t.peek_().button_(["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaSlack} ${this._hex?CSS.AnButtonDown:CSS.AnButtonFlat}`],["style","margin-left:5px;"],[ATTR.xTooltips,RS.Tooltips_ToggleShowHex]).cursor_(),An.onClick_(this._hexButton,()=>this._toggleHex()),DialogUt.setTooltipsHandler_(this._hexButton),t.pop_(2)}_createOpacityInput(t){t.peek_().div_({class:CSS.AnFlex,style:"margin:0.75ex 0"}).push_(),this._currentOpacity=t.peek_().div_(["class",CSS.AnTextButton],[ATTR.xTooltips,RS.Tooltips_Opacity],["style",`flex-basis:${DEF.BASIS_20}%;`]).cursor_(),DialogUt.setTooltipsHandler_(this._currentOpacity),t.peek_().div_({style:"width: 5px;"});const e=Math.floor(.8*(6*this._buttonSize-5)-2-1),i=this._buttonSize/4,n=2*i;this._inputOpacity=new _OpacitySlider(t.peek_().cursor_(),e,i,Math.min(n,16),n,!1),t.pop_()}_createTabpanel(t){const e=t.peek_().div_({}).cursor_(),i=new TabPanel(e,!0);i.addTab(RS.Tooltips_ColorPalette,`${CSS.Fa} ${CSS.FaSpinner}`,t=>this._colorPalettePanel=new _ColorPalettePanel(t,this._buttonSize)),i.addTab(RS.Tooltips_ColorNames,`${CSS.Fa} ${CSS.FaTags}`,t=>this._colorListPanel=new _ColorListPanel(t,this._buttonSize,this._inputColor)),i.addTab(RS.Tooltips_ColorPicker,`${CSS.Fa} ${CSS.FaEyedropper}`,t=>this._colorPickerPanel=new _ColorPickerPanel(t,this._buttonSize)),i.onTooltips(toasters$.onTooltipsKey_),i.onTabClicked((t,e)=>{if(1==e&&i.activeTab()==t){const e=t.querySelector("span");if(null==e)return;const i=An.classlist_(e).toggleAll_(CSS.FaTag,CSS.FaTags).contains_(CSS.FaTag);this._colorListPanel.onCSSColorsOnlyChanged(i)}}),i.onTabChanged(()=>{this._updatecolorinput()}),this._tabPanel=i}close_(){this._okCallback=null,super.hide_()}destroy(){__classPrivateFieldGet(this,_destroyed_2)||(__classPrivateFieldSet(this,_destroyed_2,!0),super.close_(),this._inputOpacity.destroy_(),this._colorPalettePanel.destroy(),this._colorListPanel.destroy(),this._colorPickerPanel.destroy())}getContentWidth_(){return 6*this._buttonSize}onOK_(t){return this._okCallback=t,this}setInitialFocus_(){null!=this._inputColor&&this._inputColor.blur()}setColor(t,e){var i,n;let s=e;if(this._sethex(!1),this._name="",this._inputColor.style.color="",null!=t){t=t.trim();const o=ColorUtil.findByName_(t.toLowerCase());null!=o?(s=null!==(i=ColorValue.parseSafe_(o[1]))&&void 0!==i?i:e,this._sethex(!0),this._name=o[0],this._inputColor.value=this._name):(s=null!==(n=ColorValue.parseSafe_(t))&&void 0!==n?n:e,this._sethex(t.startsWith("#")),this._inputColor.value=ColorUtil.toHexOrRgbString_(s,this._hex))}else this._inputColor.value=ColorUtil.toHexOrRgbString_(s,this._hex);return this._initialColorValue=s,this._initialColor.style.backgroundColor=null==s?"":s.toCSSString_(),this._setcolor(s,this._inputColor),this}_inputColorChanged(){const t=this._inputColor.value.trim();if(this._colorListPanel._shown&&RX.Word1.test(t)){const e=t.toLowerCase();for(let[t,i]of x11Colors)if(t.startsWith(e)){const t=ColorUtil.getColorValue_(i[1],this._getopacity());if(null!=t)return this._setcolor(t,null),void(t.isOpaque$&&ColorUtil.isCSSColor_(i)&&(this._inputColor.value=i[0]))}}let e=ColorUtil.getColorValue_(t);null!=e?(null==e.a$&&(e=ColorValue.fromRGBA_(e.r$,e.g$,e.b$,this._getopacity())),this._setcolor(e,null)):An.isempty_(t)||(this._inputColor.style.color="red")}_getopacity(){return null==this._color?1:this._inputOpacity.value$}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.PasteFromLocalClipboard:{const t=this._inputColor.value;this._inputColor.setSelectionRange(0,t.length),this.actionPaste_(this._inputColor,!1,()=>{this._inputColorChanged()});break}case BUT.CopyToLocalClipboard:const e=this._inputColor.value;this._inputColor.setSelectionRange(0,e.length),this.actionCopy_(this._inputColor);break;case BUT.OK:Timer.sleep0_(()=>{const t=this._inputColor.value.trim(),e=0==t.length?null:this._color,i=this._getformat(t,e),n=this._okCallback;this.close_(),n(e,i)});break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}_getformat(t,e){if(null==e)return ColorUtil.NULL;const i=e.isOpaque$;if(this._colorListPanel._shown&&i){const e=ColorUtil.findByName_(t.toLowerCase());if(null!=e&&ColorUtil.isCSSColor_(e))return e[0]}return i&&this._hex?ColorUtil.HEX:ColorUtil.DEC}_setcolor(t,e=null){null==t&&null==this._color||null!=t&&null!=this._color&&t.equals_(this._color)||this._setcolor1(t,e)}_setcolor1(t,e){this._color=t,this._currentColor!=e&&(this._currentColor.style.backgroundColor=null==t?"":t.toCSSString_()),this._inputColor!=e&&this._updatecolorinput(),this._currentOpacity.textContent=null==t?"0.00":t.a$.toFixed(2),this._inputOpacity.slider_()!=e&&(this._inputOpacity.value$=null==t?0:t.a$),this._colorPickerPanel._container!=e&&this._colorPickerPanel.setColor(null==t?ColorValue.X_TRANSPARENT:t),this._colorListPanel.container()!=e&&this._colorListPanel.setColor(t)}_updatecolorinput(){if(this._inputColor.style.color="",null==this._color)return void(this._inputColor.value="");const t=this._findnamedcolor(this._color);if(null==t)this._inputColor.value=ColorUtil.toHexOrRgbString_(this._color,this._hex);else{const e=ColorUtil.findByName_(this._inputColor.value.trim().toLowerCase());if(null!=e&&e[1]==t[1])return;this._inputColor.value=t[0]}}_findnamedcolor(t){if(null!=t&&this._colorListPanel._shown&&t.isOpaque$){const e="#"+t.toHex3String_(),i=ColorUtil.findByHex_(e);if(null!=i&&ColorUtil.isCSSColor_(i))return i}return null}_sethex(t){this._hex=An.setToggleButton_(this._hexButton,t)}_toggleHex(){this._hex=An.toggleToggleButton_(this._hexButton),this._inputColor.value=ColorUtil.toHexOrRgbString_(this._color,this._hex),this._inputColor.style.color=""}show_(){return super.show_(),this._hex!=An.isToggleButtonDown_(this._hexButton)&&this._toggleHex(),0!=this._name.length&&(this._inputColor.value=this._name),this._tabPanel.selectTabAt(0!=this._name.length?1:0),this}}_destroyed_2=new WeakMap,PromptColor._singleton=null,PromptColor._count=0;class _ColorPalettePanel extends UIPanelBase{constructor(t,e){super(),this._listener=null,this._container=t,t.style.overflow="auto";const i=6*e,n=5*e,s=new DomBuilderEx(this._container);this._paletteContainer=s.div_({class:CSS.AnPalette,style:`width: ${i}px; height: ${n}px;margin-bottom:5px;`}).push_().cursor_();for(let t of _ColorPalettePanel._paletteColors)for(let e of t)s.peek_().div_({style:`background-color: ${e};`});An.addClickListenerMatching_(this._paletteContainer,"div",t=>{null!=this._listener&&this._listener(t.style.backgroundColor)})}destroy(){this._listener=null}onColorChanged(t){this._listener=t}element_(){return this._container}}_ColorPalettePanel._paletteColors=[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f3f3f3","#ffffff"],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#1e90ff","#4a86e8","#0000ff","#9900ff","#ff00ff"],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d9e3d9","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc"],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd"],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0"],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79"],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47"],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130"],["#f98","#f85","#fa4","#fc3","#bc6","#8c7","#8da","#8de","#9cd","#cbf"],["#fcc","#fda","#fe9","#ee8","#de8","#ceb","#bbeed4","#c8e8f8","#e0e0ff","#ecd8ec"],["#ccc","#ddd","#eee","#dd0","#ee0","#ffff90","#ffffa8","#ffffc0","#ffffd8","#fffff0"]];class _ColorListPanel extends UIPanelBase{constructor(t,e,i){super(),this._container=t,this._colorInput=i,this._listener=null,this._hex="",this._cssColorsOnly=!1,this._shown=!1,this._container.style.overflow="hidden";const n=6*e,s=5*e,o=new DomBuilderEx(t);this._paletteContainer=o.div_({class:`${CSS.AnMenu} ${CSS.AnColorList}`,style:`width:${n}px;height:${s}px;margin-bottom:5px`}).push_().cursor_();for(let[t,e]of x11Colors){const i=ColorUtil.isCSSColor_(e);let n=`background-color: ${e[1]};`;const s=ColorUtil.getForegroundColor_(e);null!=s&&(n+=`color:${s};`);const l=i?e[0]+" "+e[2]:e[0];o.peek_().div_([ATTR.AnInfo,t],["style",n]).span_().text_(l).up_().span_().text_(e[1])}An.addClickListenerMatching_(this._paletteContainer,`div[${ATTR.AnInfo}]`,t=>{const e=t.getAttribute(ATTR.AnInfo);if(null!=e){const t=ColorUtil.findByName_(e);null!=t&&(this._hex=t[1],null!=this._listener&&this._listener(t))}})}show_(){this._shown||(this._shown=!0,An.show_(this._container),this._find())}destroy(){this._listener=null}container(){return this._container}element_(){return this._container}onColorChanged(t){this._listener=t}onCSSColorsOnlyChanged(t){if(this._cssColorsOnly!=t){this._cssColorsOnly=t;for(let e of DomUt.queryAll_(this._paletteContainer,`div[${ATTR.AnInfo}]`)){const i=e.getAttribute(ATTR.AnInfo);if(null==i)continue;const n=x11Colors.get(i);void 0!==n&&(ColorUtil.isCSSColor_(n)||(t?An.hide_(e):An.show_(e)))}this._shown&&this._find()}}reveal(t){const e=this._paletteContainer.children;if(t>=0&&t<e.length){const i=e[t];this._shown&&i.scrollIntoView({block:"center"})}}setColor(t){null==t?this._hex="":(this._hex="#"+t.toHex3String_(),this._shown&&this._find())}_find(){const t=this._colorInput.value.trim();if(t.length>0){const e=ColorUtil.findIndexByName_(t.toLowerCase());if(e>=0)return void this.reveal(e)}const e=ColorUtil.findIndexByHex_(this._hex);e>=0&&this.reveal(e)}}class _ColorPickerPanel extends UIPanelBase{constructor(t,e){super(),this._listener=null,this._shown=!1,_destroyed_3.set(this,!1),this._container=t,t.style.overflow="hidden";const i=6*e,n=5*e;this._colorPicker=new ColorValue$.HsvGradientPicker(t,n,n,Conf.isMobile),this._hueSlider=new ColorValue$.HueSlider(t,e-8,n,Conf.isMobile);const s=new DomBuilderEx(this._container);s.div_({class:CSS.AnFlex,style:`flex-flow: row nowrap; width: ${i}px; height: ${n+5}px`}).push_(),s.peek_().div_({style:`flex: 0 0 ${n}px`}).cursor_().append(this._colorPicker.canvas),s.peek_().div_({style:`flex: 0 0 ${n}px; margin-left: 8px;`}).cursor_().append(this._hueSlider.canvas),this._colorPicker.colorChangeListener=(t,e,i,n)=>{null!=this._listener&&this._listener(t,e,i,n)},this._hueSlider.hueChangelistener=this._colorPicker}setColor(t){this._colorPicker.color$=t,this._hueSlider.hueAngle$=this._colorPicker.hue}onColorChanged(t){this._listener=t}element_(){return this._container}destroy(){__classPrivateFieldGet(this,_destroyed_3)||(__classPrivateFieldSet(this,_destroyed_3,!0),this._container.remove(),this._listener=null)}}_destroyed_3=new WeakMap;class _PromptFgStyleInputPanel extends CompositeTabPanel{constructor(t,e,i,n,s,o,l,a,r,_){var c,h;super(e,n,[new InputButtonField("","",l["text-shadow"],RS.Tooltips_TextShadow,BUT.Color1,()=>{this._textshadowCallback(s,a)}),new InputField("","",_PromptFgStyleInputPanel._transformValue(l),RS.Transform),new InputButtonsField("",PromptBgImage._FILTER,CSSUtil.ignoreInheritNone(null!==(c=l.filter)&&void 0!==c?c:""),RS.ImageFilter,[BUT.Clear1,BUT.Edit1,BUT.ImageFilter1],t=>{t==BUT.Clear1?this._setfilter1(""):t==BUT.Edit1?this._editfilter(n):t==BUT.ImageFilter1&&_()}),new SampleField("","")]),this._target=i,t.push(...this._fields);const u=2*s;this._sample=new DomBuilderEx(this._fields[3].element_()).div_({class:CSS.AnFlex,style:`width:75%;height:${u}px;margin:40px 0 20px 0;overflow:hidden;align-item:center;justify-content:center;`+`color:${o.color};background-color:${o.backgroundColor};background-image:${o.backgroundImage};`+`font-family:${o.fontFamily};font-size:${o.fontSize};font-weight:${o.fontWeight};`+`filter:${CSSUtil.ignoreInheritNone(null!==(h=l.filter)&&void 0!==h?h:"")}`}).text_(o.fontFamily).cursor_(),this._filter=this._fields[2],An.onClick_(this._sample,r),this.updateSample_(this.getValue_())}_textshadowCallback(t,e){const i=this._sample.style.textShadow;let n=cssParser$.findColor_(i),s=null==n?"":CSSNode.text_(i,n);Callbacks.promptColor_(t,e+DEF.zindexAbove10,s,ColorValue.X_TRANSPARENT_DARK).onOK_((t,e)=>{let s=null==t?"":t.toCSSString_();s=null!=n?i.substring(0,n.offset)+s+i.substring(n.offset+n.length):i+" "+s,this._fields[0].setValue_(s),this.updateSample_(this.getValue_())}).show_()}_setfilter1(t){if(0==t.length)return this._filter.setValue_(""),void this.updateSample_(this.getValue_());const e=CSSUtil.splitFilter_(this._sample.style.getPropertyValue("filter"));Object.entries(CSSUtil.splitFilter_(t)).forEach(([t,i])=>{e[t]=i});const i=Object.entries(e).map(([t,e])=>t+e).join(" ");this._filter.setValue_(i),this.updateSample_(this.getValue_())}_editfilter(t){const e=this._filter.getValue_(),i=native$.getIFrameContextPath_(),n=native$.getIFrameUri_();null!=i&&null!=n&&_Util.styleEditor_(accessories$,`filter: ${e}`,i,n,An.above_(this.element_()),t,t=>{var e;this._setfilter1(null!==(e=t.filter)&&void 0!==e?e:"")}).show_()}updateSample_(t){var e,i;const n=this._sample.style,s=null!==(i=null===(e=this._target)||void 0===e?void 0:e.style)&&void 0!==i?i:null;for(const[e,i]of Object.entries(t))n.setProperty(e,i),null!=s&&s.setProperty(e,i)}getValue_(){const t=smap_(["text-shadow",this._fields[0].getValue_().trim()],["transform",""],["transform-origin",""]),e=this._fields[1].getValue_().trim();CSSUtil.splitStyle(t,e);const i=this._filter.getValue_().trim();return t.filter=i,t}setValue_(t){var e;this._fields[0].setValue_(null!==(e=t["text-shadow"])&&void 0!==e?e:""),this._fields[1].setValue_(_PromptFgStyleInputPanel._transformValue(t)),this.updateSample_(t)}setFilter_(t,e,i){const n=this._sample.style.getPropertyValue("filter"),s=CSSUtil.updateFilter_(n,t,e,i);return this._filter.setValue_(s),this.updateSample_(this.getValue_()),this._host.info_(s),s}updateValue_(t){var e,i;const n=Object.keys(t);n.includes("text-shadow")&&this._fields[0].setValue_(null!==(e=t["text-shadow"])&&void 0!==e?e:""),n.includes("transform")&&this._fields[1].setValue_(_PromptFgStyleInputPanel._transformValue(t)),n.includes("filter")&&this._fields[2].setValue_(null!==(i=t.filter)&&void 0!==i?i:""),this.updateSample_(t)}destroy(){}element_(){return this._container}sampleStyle_(){return this._sample.style}static _transformValue(t){return An.joinNotEmpty_("; ",[this._nonemptystyle(t,"transform"),this._nonemptystyle(t,"transform-origin")])}static _nonemptystyle(t,e){if(t.hasOwnProperty(e)){const i=CSSUtil.ignoreInheritNone(t[e]);return i.length>0?`${e}: ${i}`:""}return""}}class _PromptFgStyleSamplesPanel extends UIPanelBase{constructor(t,e,i,n){super(),this._container=t,this._onClick=n;const s=e,o=2*e,l=8*e,a=new DomBuilderEx(this._container);a.div_({class:CSS.AnFlex,style:"flex-flow:column nowrap;margin:5px 0;"+`max-height:${l}px;overflow:auto;`}).push_();for(const t of Object.entries(i)){const e=t[0],i=t[1];a.peek_().div_(["style","margin-top:10px;"]).text_(e),a.peek_().div_({class:CSS.AnFlex,style:"flex-flow:wrap;justify-content:center;margin:5px 0;"}).push_();for(let t=0;t<i.length;++t){const[e,n]=i[t],l=CSSUtil.joinStyles1_(Object.entries(n));a.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnFlexCenter}`],["style",`width:calc(${o}px - 16px);height:calc(${o}px - 16px);`+("A"==e?`font-size:${s}px;font-weight:bold;${l};`:"")+"margin:8px;box-sizing:border-box;flex:0 0 auto;background-color:#eee;overflow:hidden;"],[ATTR.AnInfo,JSON.stringify(n)]).text_(e)}a.pop_()}An.addClickListenerMatching_(this._container,`div.${CSS.AnLink}`,t=>{const e=An.parseJSONObjectOrNull_(t.getAttribute(ATTR.AnInfo));null!=e&&this._onClick(e)})}destroy(){}element_(){return this._container}}class PromptFgStyle extends CompositeDialogBase{constructor(t,e,i,n,s,o,l){var a;super(t,[new TabbedPanelField("",[new TabField(RS.Tooltips_EnterAsText,`${CSS.Fa} ${CSS.FaFolder}`,(t,o,a)=>new _PromptFgStyleInputPanel(t,a,e,o,i,n,s,l,()=>{this.blurAll()},()=>{var t;null===(t=this._tabPanel)||void 0===t||t.selectTabAt(2)})),new TabField(RS.Tooltips_PickFromSamples,`${CSS.Fa} ${CSS.FaSpinner}`,(t,e,n)=>new _PromptFgStyleSamplesPanel(n,i,o,t=>{this._onSample(t)})),new TabField(RS.ImageFilterSamplesTooltips,`${CSS.Fa} ${CSS.FaSearchMinus}`,(t,e,n)=>new _PromptFilterSamplesPanel(t,e,n,i,(t,e,i)=>this._onFilterSample(t,e,i)))])]),this._okCallback=null,this.zindex_(l),this.largeWidth_(),this._tabPanel=this.getFieldAt_(0).tabPanel_(),this._inputTab=this._tabPanel.getPanelAt(0),null===(a=this._tabPanel)||void 0===a||a.onTabChanged((t,e)=>{var i;null===(i=this._toolbar)||void 0===i||i.showButton_(BUT.OK,0==e)}),this.onChange_((t,e)=>{this._inputTab.updateSample_(this._inputTab.getValue_())}),this._tabPanel.onTabChanged((t,e)=>{2==e&&this.info_(this._inputTab.sampleStyle_().getPropertyValue("filter"))}),this._tabPanel.selectTabAt(0)}_onSample(t){var e;null===(e=this._tabPanel)||void 0===e||e.selectTabAt(0),this._inputTab.updateValue_(t)}_onFilterSample(t,e,i){return this._inputTab.setFilter_(t,e,i)}onOK_(t){return this._okCallback=t,this}_onOK(t){var e;const i=this._inputTab.getValue_();null!=i?(t(!0),null===(e=this._okCallback)||void 0===e||e.call(this,i),this._okCallback=null):t(!1)}show_(){return super.show_(),this}}PromptFgStyle._SAMPLES=smap_([MSG.string_(RS.Tooltips_TextShadow),[["",smap_(["text-shadow",""])],["none",smap_(["text-shadow","none"])],["A",smap_(["text-shadow","2px 2px 5px rgba(0, 0, 0, 0.5)"])],["A",smap_(["text-shadow","2px 2px 5px rgba(255, 255, 255, 0.5)"])]]],[MSG.string_(RS.Transform),[["",smap_(["transform",""],["transform-origin",""])],["none",smap_(["transform","none"],["transform-origin",""])],["5",smap_(["transform","rotate(5deg)"],["transform-origin","50% 50%"])],["90",smap_(["transform","rotate(90deg) translateY(-100%)"],["transform-origin","0 0"])],["-5",smap_(["transform","rotate(-5deg)"],["transform-origin","50% 50%"])],["-90",smap_(["transform","translateX(-100%) rotate(-90deg)"],["transform-origin","100% 0"])],["0.5x",smap_(["transform","scale(0.5, 0.5)"])],["2x",smap_(["transform","scale(2.0, 2.0)"])]]]);class _PromptBgImgInputPanel extends UIPanelBase{constructor(t,e,i,n,s,o,l,a,r){super(),this._host=e,this._container=i,this._target=n,this._fields=new Array;const _=new DomBuilderEx(this._container);_.div_({class:CSS.AnFlexColumnNoWrap,style:"align-items:stretch;margin:5px 0;"}).push_();const c=l[0],h=l[1];let u=CSSUtil.splitBgImg_(c);const d=[new GlassLayerFIeld("",PromptBgImage._LAYER0,u[0],RS.Layer0,s,o),new GlassLayerFIeld("",PromptBgImage._LAYER1,u[1],RS.Layer1,s,o),new GlassLayerFIeld("",PromptBgImage._LAYER2,u[2],RS.Layer2,s,o),new InputButtonsField("",PromptBgImage._FILTER,h,RS.BackdropFilter,[BUT.Clear1,BUT.Edit1,BUT.ImageFilter1],t=>{t==BUT.Clear1?this._setfilter1(""):t==BUT.Edit1?this._editfilter(e):t==BUT.ImageFilter1&&r()}),new SampleField(PromptBgImage._SAMPLE,"")];for(let i of d){let n=i.create_(e,_.peek_());n.element_().classList.add(CSS.AnMarginTop5),this._fields.push(n),t.push(n)}const S=2*s;this._sample=new DomBuilderEx(this._fields[4].element_()).div_({class:CSS.AnFlex,style:`width:50%;height:${S}px;margin:40px 0 20px 0;background-image:${c};`+(0==h.length?"":`backdrop-filter:${h};`)}).cursor_(),this._filter=this._fields[3],An.onClick_(this._sample,t=>{An.stopevent_(t),a(),e.clearStatus_()})}_editfilter(t){const e=this._filter.getValue_(),i=native$.getIFrameContextPath_(),n=native$.getIFrameUri_();null!=i&&null!=n&&_Util.styleEditor_(accessories$,`backdrop-filter: ${e}`,i,n,An.above_(this.element_()),t,t=>{var e;this._setfilter1(null!==(e=t["backdrop-filter"])&&void 0!==e?e:"")}).show_()}updateSample_(t){var e;this._sample.style.backgroundImage=t[0],this._sample.style.setProperty("backdrop-filter",t[1]),With.optional_(null===(e=this._target)||void 0===e?void 0:e.style,e=>{e.backgroundImage=t[0],e.setProperty("backdrop-filter",t[1])})}getValue_(){return[An.joinNotEmpty_(", ",[this._fields[0].getValue_(),this._fields[1].getValue_(),this._fields[2].getValue_()]),this._fields[3].getValue_()]}setBgImg_(t){const e=CSSUtil.splitBgImg_(t);for(let t=0;t<3;++t)this._fields[t].setValue_(e[t]);this.updateSample_([t,this._sample.style.getPropertyValue("backdrop-filter")])}setFilter_(t,e,i){const n=this._sample.style.getPropertyValue("backdrop-filter"),s=CSSUtil.updateFilter_(n,t,e,i);return this._filter.setValue_(s),this.updateSample_([this._sample.style.backgroundImage,s]),this._host.info_(s),s}_setfilter1(t){if(0==t.length)return this._filter.setValue_(""),void this.updateSample_([this._sample.style.backgroundImage,""]);const e=CSSUtil.splitFilter_(this._sample.style.getPropertyValue("backdrop-filter"));Object.entries(CSSUtil.splitFilter_(t)).forEach(([t,i])=>{e[t]=i});const i=Object.entries(e).map(([t,e])=>t+e).join(" ");this._filter.setValue_(i),this.updateSample_([this._sample.style.backgroundImage,i])}destroy(){}element_(){return this._container}sampleStyle_(){return this._sample.style}}class _PromptFilterSamplesPanel extends UIPanelBase{constructor(t,e,i,n,s){super(),this._container=i,this._updateFilter=s;const o=2*n,l=8*n,a=new DomBuilderEx(this._container);a.push_().div_({class:CSS.AnFlexCenter,style:"flex-flow:column nowrap;margin:5px 0;"+`max-height:${l}px;overflow:auto;`}).push_().div_({style:"margin:10px 0 5px 0;"}).text_(MSG.string_(RS.ImageFilter)).peek_().div_({class:CSS.AnFlex,style:"flex-flow:wrap;justify-content:center;align-items:center;margin:5px 0;"}).push_();for(const[t,e]of _PromptFilterSamplesPanel._SAMPLES){const i=`(${e})`;a.peek_().div_(["class",CSS.AnFlexCenter],["style","background-image:url('/assets/templates/memo/memo-v2-09-button.jpg');background-size:cover;margin:5px;"]).div_(["class",`${CSS.AnLink}`],["style","display:flex;justify-content:center;align-items:flex-end;overflow:hidden;"+`width:${o}px;height:${o}px;color:${"invert"==t?"#fff":"#444"};`+`backdrop-filter:${t}${i};`],[ATTR.AnInfo,JSON.stringify([t,i])]).text_(t)}this._slider=DialogUt.createInputSlider_(a.pop_(3),0,1,.01,0,`${n}px`,0,RS.Adjust,"1",()=>{var t;const e=this._slider.getAttribute(ATTR.AnAction);if(null==e)return;const i=`(${this._slider.value}${null!==(t=this._slider.getAttribute(ATTR.AnInfo))&&void 0!==t?t:""})`;this._updateFilter(e,i,!1)}),this._slider.disabled=!0,this._slider.setAttribute(ATTR.AnNoClick,"true"),this._slider.style.width="100%",An.addClickListenerMatching_(this._container,`div.${CSS.AnLink}`,t=>{const e=An.parseJSONArrayOrNull_(t.getAttribute(ATTR.AnInfo));if(null!=e){const t=e[0],i=e[1],n=this._updateFilter(t,i,!0),s=CSSUtil.splitFilter_(n);if(Object.keys(s).includes(t))return void this._updateSlider(t,i);const o=ArrayUt.last_(Object.entries(s));if(null==o)return void(this._slider.disabled=!0);this._updateSlider(o[0],o[1])}})}_updateSlider(t,e){const i=BackdropFilter.FILTERS$.indexOf(t);if(i<=0)return;const n=BackdropFilter.RANGE$[i],s=An.doubleValueUnit_(e.substring(1,e.length-1));null!=s&&null!=n&&(this._slider.min=`${n[0]}`,this._slider.max=`${n[1]}`,this._slider.step=`${n[2]}`,this._slider.value=`${s[0]}`,this._slider.setAttribute(ATTR.AnAction,t),this._slider.setAttribute(ATTR.AnInfo,s[1]),this._slider.disabled=!1)}destroy(){}element_(){return this._container}}_PromptFilterSamplesPanel._SAMPLES=BackdropFilter.FILTERS$.map((t,e)=>[t,BackdropFilter.DEF$[e]]);class _PromptBgImgSamplesPanel extends UIPanelBase{constructor(t,e,i,n,s,o){super(),this._container=i,this._onClick=o;const l=new DomBuilderEx(this._container),a=2*n,r=3*n,_=8*n;l.div_({class:CSS.AnFlex,style:"flex-flow:wrap;justify-content:center;margin:5px 0;"+`max-height:${_}px;overflow:auto;`}).push_();for(let t=0;t<s.length;++t)l.peek_().div_(["class",CSS.AnLink],["style",`width:calc(${r}px - 2px);height: ${a}px;background-image:${s[t]};`+"margin:1px;box-sizing:border-box;flex:0 0 auto;background-color:#fff;"],[ATTR.AnInfo,`${t}`]);An.addClickListenerMatching_(this._container,`div.${CSS.AnLink}`,t=>{const e=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);e>=0&&this._onClick(e)})}destroy(){}element_(){return this._container}}class PromptBgImage extends CompositeDialogBase{constructor(t,e,i,n,s,o,l){super(t,[new TabbedPanelField(PromptBgImage._PANEL,[new TabField(RS.Tooltips_EnterAsText,`${CSS.Fa} ${CSS.FaFolder}`,(t,o,l)=>new _PromptBgImgInputPanel(t,o,l,e,i,n,s,()=>{this.blurAll()},()=>{this._tabPanel.selectTabAt(2)})),new TabField(RS.BackgroundImageSamplesTooltips,`${CSS.Fa} ${CSS.FaSpinner}`,(t,e,n)=>new _PromptBgImgSamplesPanel(t,e,n,i,o,t=>{this._onBackgroundSample(t)})),new TabField(RS.BackdropFilterSamplesTooltips,`${CSS.Fa} ${CSS.FaSearchMinus}`,(t,e,n)=>new _PromptFilterSamplesPanel(t,e,n,i,(t,e,i)=>this._onFilterSample(t,e,i)))])]),this.samples=o,this._okCallback=null,this.largeWidth_(),this.zindex_(l),this.titleKey_(RS.EditBGImageTitle),this._tabPanel=this.getFieldAt_(0).tabPanel_(),this._inputTab=this._tabPanel.getPanelAt(0),this._tabPanel.onTabChanged((t,e)=>{var i;null===(i=this._toolbar)||void 0===i||i.showButton_(BUT.OK,0==e)}),this.onChange_((t,e)=>{this._inputTab.updateSample_(this._inputTab.getValue_())}),this._tabPanel.onTabChanged((t,e)=>{2==e&&this.info_(this._inputTab.sampleStyle_().getPropertyValue("backdrop-filter"))}),this._tabPanel.selectTabAt(0)}_onBackgroundSample(t){t>=0&&t<this.samples.length&&this._inputTab.setBgImg_(this.samples[t]),this._tabPanel.selectTabAt(0)}_onFilterSample(t,e,i){return this._inputTab.setFilter_(t,e,i)}onOK_(t){return this._okCallback=t,this}_onOK(t){var e;const i=this._inputTab.getValue_();t(!0),null===(e=this._okCallback)||void 0===e||e.call(this,i[0],i[1]),this._okCallback=null}show_(){return super.show_(),this}}var ShapePicker$;PromptBgImage._LAYER1="#XAt",PromptBgImage._SAMPLE="#Xzk",PromptBgImage._FILTER="#XGQ",PromptBgImage._LAYER2="#Xx4",PromptBgImage._PANEL="#XGA",PromptBgImage._LAYER3="#XEi",PromptBgImage._LAYER0="#XoP",function(t){class e{constructor(t,e,i,n,s){this.scrollx=t,this.scrolly=e,this.x0=i,this.y0=n,this.buttons=s}}class i{constructor(t,e,n,s,o,l,a,r,_,c){this._buttonSize=e,this._viewportSize=n,this._imageSize=s,this._origin=o,this._image=l,this._zoom=a,this._margin=r,this._useTouch=_,this._moved=!1,this._center=null,this._limiter=new FrameLimiter(4),this._snapper=null!=c?c:new DumbSnapper,this._canvasSize=MediaUtil.fit_(s.x,s.y,n.x-2*r,n.y-2*r),this._zoomFit=MediaUtil.zoomOf_(this._canvasSize,s.x,s.y),a=An.clamp_(this._zoomFit,PinchZoomListener.MAX_ZOOM,a);const h=s.x*a,u=s.y*a;this._scaled=new Rect(o.x*h,o.y*u,h,u);const d=t.ownerDocument;this._background=d.createElement("canvas"),this._background.width=this._canvasSize.x,this._background.height=this._canvasSize.y,this._positionCanvas(this._background),this._background.style.backgroundColor="rgba(255,255,255,1.0)",this._background.style.outline="1px solid #aaa",this._overlay=d.createElement("canvas"),this._overlay.width=this._canvasSize.x,this._overlay.height=this._canvasSize.y,this._positionCanvas(this._overlay),this._overlay.classList.add(CSS.AnOverlayCanvas),this._overlay.style.backgroundColor="rgba(255,255,255,0)",t.append(this._background),t.append(this._overlay),this._backgroundContext=this._background.getContext("2d"),this._backgroundContext.imageSmoothingQuality="high",this._backgroundContext.imageSmoothingEnabled=!0,this._overlayContext=this._overlay.getContext("2d"),this._overlayContext.imageSmoothingQuality="high",this._overlayContext.imageSmoothingEnabled=!0,this._overlayContext.setLineDash([i._DASH,i._DASH])}_positionCanvas(t){const e=Math.max(this._margin,(this._viewportSize.x-this._canvasSize.x)/2),i=t.style;i.position="absolute",i.float="left",i.clear="both",i.top=`${this._margin}px`,i.left=`${e}px`}_setupPinchZoomListener(t){new PinchZoomListener(this._overlay,"touchstart"==Conf.touchstart,(e,n)=>{if(null!=e){const t=e.x-this._margin-this._scaled.left,i=e.y-this._margin-this._scaled.top;return this._center=new Point(t,i),n}if(null!=this._center){let e=this._zoom;for(;n<=-i._DELTA;)e*=1-i._SCALE,n+=i._DELTA;for(;n>=i._DELTA;)e*=1+i._SCALE,n-=i._DELTA;if((e=An.clamp_(this._zoomFit,PinchZoomListener.MAX_ZOOM,e))!=this._zoom){this._zoom=e;const i=this._center;this._limiter.queue_(()=>{this._center=t(i.x,i.y)})}}return n})}_rescale(t,e){const i=this._imageSize.x*this._zoom,n=this._imageSize.y*this._zoom,s=i*t/this._scaled.width,o=n*e/this._scaled.height,l=i-this._canvasSize.x,a=n-this._canvasSize.y;let r,_;return l<=0?(r=0,_=0):(r=An.clamp_(-l,0,t+this._scaled.left-s),_=An.clamp_(-a,0,e+this._scaled.top-o)),this._scaled=new Rect(r,_,i,n),new Point(s,o)}_reposition(t,e,i,n){let s=this._scaled.left+(i-t),o=this._scaled.top+(n-e);s=An.clamp_(-(this._scaled.width-this._canvasSize.x),0,s),o=An.clamp_(-(this._scaled.height-this._canvasSize.y),0,o),this._scaled.left=s,this._scaled.top=o}_distance2(t,e,i,n){const s=i-t,o=n-e;return s*s+o*o}}i._DASH=5,i._DELTA=5,i._SCALE=.05;class n{constructor(t,e,i){switch(this.index=t,this.state=i,this.w=e.width,this.h=e.height,t){case 0:this.x=e.left,this.y=e.top;break;case 1:this.x=e.left+e.width,this.y=e.top;break;case 2:this.x=e.left+e.width,this.y=e.top+e.height;break;case 3:this.x=e.left,this.y=e.top+e.height;break;case 4:this.x=e.left+e.width/2,this.y=e.top;break;case 5:this.x=e.left+e.width,this.y=e.top+e.height/2;break;case 6:this.x=e.left+e.width/2,this.y=e.top+e.height;break;case 7:this.x=e.left,this.y=e.top+e.height/2;break;default:this.x=e.left,this.y=e.top}}}t.RectPicker=class extends i{constructor(t,e,i,n,s,o,l,a,r,_,c,h){super(t,e,i,n,s,o,l,a,r,_),this._onChangeCallback=h,this._handle=null,this._original=c.clampSize_(0,1),this._current=Rect.fromRect_(this._original),this._redraw(!1,!1),this._fireOnChange(),this._mouseListener=this._useTouch?new ColorValue$.TouchListener(this._overlay,!0):new ColorValue$.MouseListener(this._overlay,!0),this._mouseListener.onPointerDown((t,e,i)=>this.onMouseDown_(t,e,i)),this._mouseListener.onPointerMoved((t,e,i)=>this.onMouseMove_(t,e,i)),this._mouseListener.onPointerUp((t,e,i)=>this.onMouseUp_(t,e,i)),this._setupPinchZoomListener((t,e)=>this._zoomAt(t,e))}reset_(){this._current=Rect.fromRect_(this._original),this._drawOverlay(!1,!1),this._fireOnChange()}onMouseDown_(t,i,s){const o=t-this._margin-this._scaled.left,l=i-this._margin-this._scaled.top;if(this._moved=!1,this._handle=null,3!=s&&1!=s)return!1;const a=new e(this._scaled.left,this._scaled.top,o,l,s);if(3==s)return this._handle=new n(8,this._current,a),this._drawOverlay(!0,!1),!0;const r=this._buttonSize*this._buttonSize,_=this._scaled.width,c=this._scaled.height;let h=_*_+c*c,u=null;for(const t of[new n(0,this._current,a),new n(1,this._current,a),new n(2,this._current,a),new n(3,this._current,a)]){const e=this._distance2(t.x*_,t.y*c,o,l);e<r&&e<h&&(u=t,h=e)}if(null==u){const t=this._current.left*_,e=this._current.top*c,i=this._current.width*_,s=this._current.height*c;for(const _ of[new n(4,this._current,a),new n(5,this._current,a),new n(6,this._current,a),new n(7,this._current,a)]){let n=h;switch(_.index){case 4:o>=t&&o<=t+i&&(n=(l-e)*(l-e));break;case 5:l>=e&&l<=e+s&&(n=(o-t-i)*(o-t-i));break;case 6:o>=t&&o<=t+i&&(n=(l-e-s)*(l-e-s));break;default:l>=e&&l<=e+s&&(n=(o-t)*(o-t))}n<r&&n<h&&(u=_,h=n)}}return null==u?(this._handle=new n(8,this._current,a),this._drawOverlay(!0,!1),!0):(this._handle=u,this._update(t,i,!0),!0)}onMouseMove_(t,e,i){1!=i&&3!=i||(this._moved=!0,this._update(t,e,!0))}onMouseUp_(t,e,i){if(!this._moved&&null!=this._handle&&this._handle.index>=8){const i=MediaUtil.zoomOf_(this._canvasSize,this._imageSize.x,this._imageSize.y);this._zoom<=i?this._zoom=1:this._zoom=i;const n=t-this._margin-this._scaled.left,s=e-this._margin-this._scaled.top;this._zoomAt(n,s)}else this._update(t,e,!1),this._handle=null,this._moved=!1}_redraw(t,e){this._drawBackground(),this._drawOverlay(t,e)}_drawBackground(){this._backgroundContext.drawImage(this._image,this._scaled.left,this._scaled.top,this._scaled.width,this._scaled.height)}_drawOverlay(t,e){const n=this._overlayContext;n.fillStyle="rgba(255, 255, 255, 0.0)",n.clearRect(0,0,this._canvasSize.x,this._canvasSize.y);const s=this._scaled.left,o=this._scaled.top,l=this._scaled.width,a=this._scaled.height,r=this._current.left*l+s,_=this._current.top*a+o,c=this._current.width*l,h=this._current.height*a;t&&(n.fillStyle=e?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.5)",n.fillRect(r,_,c,h)),n.strokeStyle="rgba(0, 0, 0, 1.0)",n.lineDashOffset=0,n.strokeRect(r,_,c,h),n.strokeStyle="rgba(255, 255, 255, 1.0)",n.lineDashOffset=i._DASH,n.strokeRect(r,_,c,h)}_zoomAt(t,e){const i=this._rescale(t,e);return this._redraw(!1,!1),this._fireOnChange(),i}_scrollTo(t,e,i,n){this._reposition(t.state.x0,t.state.y0,e,i),this._redraw(n,!1),this._fireOnChange()}_update(t,e,i){const n=t-this._margin-this._scaled.left,s=e-this._margin-this._scaled.top;if(null==this._handle)return void this._drawOverlay(i,!1);const o=this._scaled.width,l=this._scaled.height,a=n-this._handle.state.x0,r=s-this._handle.state.y0,_=this._handle.x*o,c=this._handle.y*l,h=this._handle;this._snapper.snap(_+a,c+r,(t,e)=>{const a=h.w*o,r=h.h*l;switch(h.index){case 0:this._current.left=An.clamp_(0,_+a-1,t)/o,this._current.top=An.clamp_(0,c+r-1,e)/l,this._current.width=An.clamp_(1,o,a+(_-t))/o,this._current.height=An.clamp_(1,l,r+(c-e))/l;break;case 1:this._current.top=An.clamp_(0,c+r-1,e)/l,this._current.width=An.clamp_(1,o,a+(t-_))/o,this._current.height=An.clamp_(1,l,r+(c-e))/l;break;case 2:this._current.width=An.clamp_(1,o,a+(t-_))/o,this._current.height=An.clamp_(1,l,r+(e-c))/l;break;case 3:this._current.left=An.clamp_(0,_+a-1,t)/o,this._current.width=An.clamp_(1,o,a+(_-t))/o,this._current.height=An.clamp_(1,l,r+(e-c))/l;break;case 4:this._current.top=An.clamp_(0,c+r-1,e)/l,this._current.height=An.clamp_(1,l,r+(c-e))/l;break;case 5:this._current.width=An.clamp_(1,o,a+(t-_))/o;break;case 6:this._current.height=An.clamp_(1,l,r+(e-c))/l;break;case 7:this._current.left=An.clamp_(0,_+a-1,t)/o,this._current.width=An.clamp_(1,o,a+(_-t))/o;break;default:return void this._scrollTo(h,n,s,i)}this._drawOverlay(i,!0),this._fireOnChange()})}_fireOnChange(){null!=this._onChangeCallback&&this._onChangeCallback(new Rect(this._current.left,this._current.top,this._current.width,this._current.height),new Point(this._scaled.left/this._scaled.width,this._scaled.top/this._scaled.height),this._zoom)}};class s{constructor(t,e,i,n,s,o,l,a){this.topLeftX=t,this.topLeftY=e,this.topRightX=i,this.topRightY=n,this.bottomRightX=s,this.bottomRightY=o,this.bottomLeftX=l,this.bottomLeftY=a}static from(t){return new s(t.topLeftX,t.topLeftY,t.topRightX,t.topRightY,t.bottomLeftX,t.bottomLeftY,t.bottomRightX,t.bottomRightY)}scaledBy(t,e){return new s(Math.round(this.topLeftX*t),Math.round(this.topLeftY*e),Math.round(this.topRightX*t),Math.round(this.topRightY*e),Math.round(this.bottomRightX*t),Math.round(this.bottomRightY*e),Math.round(this.bottomLeftX*t),Math.round(this.bottomLeftY*e))}toString(){return`(${this.topLeftX}, ${this.topLeftY}), `+`(${this.topRightX}, ${this.topRightY}), `+`(${this.bottomRightX}, ${this.bottomRightY}), `+`(${this.bottomLeftX}, ${this.bottomLeftY})`}}class o{constructor(t,e,i){switch(this.index=t,this.state=i,this.quad=s.from(e),t){case 0:this.x=e.topLeftX,this.y=e.topLeftY;break;case 1:this.x=e.topRightX,this.y=e.topRightY;break;case 2:this.x=e.bottomRightX,this.y=e.bottomRightY;break;case 3:this.x=e.bottomLeftX,this.y=e.bottomLeftY;break;default:this.x=e.topLeftX,this.y=e.topLeftY}}}class l extends i{constructor(t,e,i,n,o,l,a,r,_,c,h,u){super(t,e,i,n,o,l,a,r,_,c),this._original=h,this._onChangeCallback=u,this._handle=null,this._current=s.from(h),this._redraw(!1,!1),this._fireOnChange(),this._mouseListener=this._useTouch?new ColorValue$.TouchListener(this._overlay,!0):new ColorValue$.MouseListener(this._overlay,!0),this._mouseListener.onPointerDown((t,e,i)=>this.onMouseDown_(t,e,i)),this._mouseListener.onPointerMoved((t,e,i)=>this.onMouseMove_(t,e,i)),this._mouseListener.onPointerUp((t,e,i)=>this.onMouseUp_(t,e,i)),this._setupPinchZoomListener((t,e)=>this._zoomAt(t,e))}_redraw(t,e){this._drawBackground(),this._drawOverlay(t,e)}_drawBackground(){this._backgroundContext.drawImage(this._image,this._scaled.left,this._scaled.top,this._scaled.width,this._scaled.height)}_drawOverlay(t,e){const n=this._scaled.left,s=this._scaled.top,o=this._scaled.width,l=this._scaled.height,a=this._overlayContext;a.fillStyle="rgba(255, 255, 255, 0.0)",a.clearRect(0,0,this._canvasSize.x,this._canvasSize.y),a.beginPath(),a.moveTo(this._current.topLeftX*o+n,this._current.topLeftY*l+s),a.lineTo(this._current.topRightX*o+n,this._current.topRightY*l+s),a.lineTo(this._current.bottomRightX*o+n,this._current.bottomRightY*l+s),a.lineTo(this._current.bottomLeftX*o+n,this._current.bottomLeftY*l+s),a.closePath(),t&&(a.fillStyle=e?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.5)",a.fill()),a.strokeStyle="rgba(0, 0, 0, 1.0)",a.lineDashOffset=0,a.stroke(),a.strokeStyle="rgba(255, 255, 255, 1.0)",a.lineDashOffset=i._DASH,a.stroke()}reset_(){this._current.topLeftX=this._original.topLeftX,this._current.topLeftY=this._original.topLeftY,this._current.topRightX=this._original.topRightX,this._current.topRightY=this._original.topRightY,this._current.bottomRightX=this._original.bottomRightX,this._current.bottomRightY=this._original.bottomRightY,this._current.bottomLeftX=this._original.bottomLeftX,this._current.bottomLeftY=this._original.bottomLeftY,this._redraw(!1,!1),this._fireOnChange()}onMouseDown_(t,i,n){const s=t-this._margin-this._scaled.left,l=i-this._margin-this._scaled.top;if(this._moved=!1,this._handle=null,1!=n&&3!=n)return!1;const a=new e(this._scaled.left,this._scaled.top,s,l,n);if(3==n)return this._handle=new o(8,this._current,a),this._redraw(!0,!1),!0;const r=this._buttonSize*this._buttonSize,_=this._scaled.width,c=this._scaled.height;let h=_*_+c*c,u=null;for(const t of[new o(0,this._current,a),new o(1,this._current,a),new o(2,this._current,a),new o(3,this._current,a)]){const e=this._distance2(t.x*_,t.y*c,s,l);e<r&&e<h&&(u=t,h=e)}return null==u?(this._handle=new o(8,this._current,a),this._redraw(!0,!1),!0):(this._handle=u,this._update(t,i,!0),!0)}onMouseMove_(t,e,i){1!=i&&3!=i||(this._moved=!0,this._update(t,e,!0))}onMouseUp_(t,e,i){if(!this._moved&&null!=this._handle&&this._handle.index>=8){const i=MediaUtil.zoomOf_(this._canvasSize,this._imageSize.x,this._imageSize.y);this._zoom<=i?this._zoom=1:this._zoom=i;const n=t-this._margin-this._scaled.left,s=e-this._margin-this._scaled.top;this._zoomAt(n,s)}else this._update(t,e,!1),this._handle=null,this._moved=!1}_zoomAt(t,e){const i=this._rescale(t,e);return this._redraw(!1,!1),this._fireOnChange(),i}_scrollTo(t,e,i,n){this._reposition(t.state.x0,t.state.y0,e,i),this._redraw(n,!1),this._fireOnChange()}_update(t,e,i){const n=t-this._margin-this._scaled.left,s=e-this._margin-this._scaled.top;if(null==this._handle)return void this._drawOverlay(i,!1);const o=this._scaled.width,l=this._scaled.height,a=n-this._handle.state.x0,r=s-this._handle.state.y0,_=this._handle.x*o,c=this._handle.y*l,h=this._handle;this._snapper.snap(_+a,c+r,(t,e)=>{switch(t=An.clamp_(0,o,t),e=An.clamp_(0,l,e),h.index){case 0:this._current.topLeftX=t/o,this._current.topLeftY=e/l;break;case 1:this._current.topRightX=t/o,this._current.topRightY=e/l;break;case 2:this._current.bottomRightX=t/o,this._current.bottomRightY=e/l;break;case 3:this._current.bottomLeftX=t/o,this._current.bottomLeftY=e/l;break;default:return void this._scrollTo(h,n,s,i)}this._drawOverlay(i,!0),this._fireOnChange()})}_fireOnChange(){null!=this._onChangeCallback&&this._onChangeCallback(s.from(this._current),new Point(this._origin.x,this._origin.y),this._zoom)}}t.QuadPicker=l;t.PromptXY=class extends FixedSizeDialogBase{constructor(t,e,i,n,s,o,l,a){super(t,e),this._canvasSize=i,this._labelX=n,this._labelY=s,this._x=o,this._y=l,this._snapper=a,this.defaultTitleCallback=(t,e)=>`${Math.round(100*t)}, ${Math.round(100*e)}`,this._okCallback=null,this._resetCallback=null,this._titleCallback=this.defaultTitleCallback,super.init_(this.create_(t)),this._toolbar.showButton_(BUT.Reset,!1)}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),BUT.infos_(BUT.Reset,BUT.OK,BUT.Cancel),t=>this._toolbarActions(t))}_createContent(t){const e=3*this.buttonSize$/4,i=this._canvasSize;this._picker=new GradientPicker(this.container_(),i,i,this._x,this._y,Conf.isMobile,this._snapper,(t,e)=>{this._x=t,this._y=e,null!=this._titleCallback&&this._toolbar.titleText_(this._titleCallback(t,e))});const n=new DomBuilderEx(t).push_();n.div_({style:"display: flex;flex-flow: column nowrap;"}).push_(),n.div_({style:"width: 100%;height: 0px;border-bottom: 1px solid #aaa;margin: 0 0 10px 0;"}),n.peek_().div_({style:"display: flex;flex-flow: row nowrap;"}).push_(),n.div_({style:`width: ${e}px;height: ${i}px;position: relative;`}).div_({style:`position: absolute;top: 0;left: 0;width: ${i}px;height: ${e}px;`+"display: flex;align-items: center;justify-content: center;font-size: 90%;"+`transform: translateY(${i}px) rotate(-90deg);transform-origin: 0 0;`}).text_(this._labelY),n.pop_().div_({style:`width: ${i}px;height: ${i}px;outline:1px solid #aaa;`}).appendNodes_(this._picker.canvas$),n.pop_().div_({style:"display: flex;flex-flow: row nowrap;"}).push_(),n.div_({style:`width: ${e}px;height: ${e}px;`}),n.pop_().div_({style:`width: ${i}px;height: ${e}px;`+"display: flex;align-items: center;justify-content: center;font-size: 90%;"}).text_(this._labelX)}close_(){this._okCallback=null,this._resetCallback=null,this._titleCallback=this.defaultTitleCallback,super.close_()}getContentWidth_(){return this.buttonSize$+this._canvasSize}onOK_(t){return this._okCallback=t,this}onReset(t){this._resetCallback=t,this._toolbar.showButton_(BUT.Reset,null!=t)}onTitle(t){this._titleCallback=t,null!=this._titleCallback&&this._toolbar.titleText_(this._titleCallback(this._x,this._y))}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.Reset:if(null!=this._resetCallback){const t=this._resetCallback();this._picker.setValue(t[0],t[1])}break;case BUT.OK:const e=this._okCallback;this.close_(),e(this._x,this._y);break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}};class a extends FullscreenDialogBase{constructor(t,e,i,n,s,o,l,r){super(t,e),this._buttonSize=i,this._zoom=s,this._imageSize=o,this._dataurl=r,this._origin=new Point(0,0),this._picker=null,this._okCallback=null,this._original=a._rectFromList(l),this._current=a._rectFromList(l),this._viewportSize=new Point(window.innerWidth,window.innerHeight-i-i/2-1),super.init_(this.create_(t)),this.zindex_(n)}create_(t){return this.createFullscreenDialog_(t,t=>this._createFullscreenToolbar(t),t=>this._createFullscreenContent(t))}_createFullscreenToolbar(t){const e=FullscreenDialogBase.fullscreenToolbarCreator_(t,null,BUT.infos_(BUT.Reset,BUT.OK,BUT.Cancel));return e.onAction_(t=>this._toolbarActions(t)),e}_createFullscreenContent(t){this._viewport=t.div_({class:CSS.AnViewport,style:"position: relative; top: 0; left: 0;margin: 0; padding: 0; border: none;box-sizing: border-box;width: 100vw;"+`height: calc(100vh - ${this._buttonSize+1}px);`}).div_({class:CSS.AnViewport,style:"position: relative; top: 0; left: 0;margin: 0; padding: 0; border: none;box-sizing: border-box;width: 100vw;"+`height: calc(100vh - ${this._buttonSize+this._buttonSize/2+1}px);`}).cursor_(),t.img_({"background-color":"rgba(255, 255, 255, 1.0)"}),this._image=t.cursor_()}static _rectFromList(t){return new Rect(t[0],1-(t[1]+t[3]),t[2],t[3]).clampSize_(0,1)}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_toolbarActions(t){var e;switch(this.clearStatus_(),t){case BUT.Reset:null===(e=this._picker)||void 0===e||e.reset_();break;case BUT.OK:const i=this._okCallback;this.close_(),i(this._current.left,this._current.top,this._current.width,this._current.height);break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}showFullscreen_(){this._image.src=this._dataurl,An.onLoad_(this._image,()=>{this.onResize_(),An.setVisible_(this._dialog)}),An.onError_(this._image,()=>{toasters$.error_(MSG.string_(RS.ImageReadFailed)),this.actionCancelConfirmed_()})}onResize_(){this._viewportSize=new Point(window.innerWidth,window.innerHeight-this._buttonSize-this._buttonSize/2-1),new DomBuilderEx(this._viewport).empty_(),this._picker=new t.RectPicker(this._viewport,this._buttonSize,this._viewportSize,this._imageSize,this._origin,this._image,this._zoom,a._MARGIN,"touchstart"==Conf.touchstart,new DumbSnapper,this._original,this._onchange)}_onchange(t,e,i){this._current.setRect_(t).clampSize_(0,1),this._origin=e,this._zoom=i,this._toolbar.titleText_(`${this._current.scaledBy_(this._imageSize.x,this._imageSize.y)}`)}}a._MARGIN=5,t.PromptRect=a;class r extends FullscreenDialogBase{constructor(t,e,i,n,s,o,l,a){super(t,e),this._buttonSize=i,this._zoom=s,this._imageSize=o,this._dataurl=a,this._origin=new Point(0,0),this._picker=null,this._okCallback=null,this._original=r._fromList(l),this._current=r._fromList(l),this._viewportSize=new Point(window.innerWidth,window.innerHeight-i-i/2-1),super.init_(this.create_(t)),this.zindex_(n)}create_(t){return this.createFullscreenDialog_(t,t=>this._createFullscreenToolbar(t),t=>this._createFullscreenContent(t))}_createFullscreenToolbar(t){const e=FullscreenDialogBase.fullscreenToolbarCreator_(t,null,BUT.infos_(BUT.Reset,BUT.Crop,BUT.OK,BUT.Cancel));return e.onAction_(t=>this._toolbarActions(t)),e}_createFullscreenContent(t){this._viewport=t.div_({class:CSS.AnViewport,style:"position: relative; top: 0; left: 0;margin: 0; padding: 0; border: none;box-sizing: border-box;width: 100vw;"+`height: calc(100vh - ${this._buttonSize+1}px);`}).div_({class:CSS.AnViewport,style:"position: relative; top: 0; left: 0;margin: 0; padding: 0; border: none;box-sizing: border-box;width: 100vw;"+`height: calc(100vh - ${this._buttonSize+this._buttonSize/2+1}px);`}).cursor_()}close_(){this._okCallback=null,super.close_()}static _fromList(t){return new s(An.clamp_(0,1,t[0]),An.clamp_(0,1,1-t[1]),An.clamp_(0,1,t[2]),An.clamp_(0,1,1-t[3]),An.clamp_(0,1,t[4]),An.clamp_(0,1,1-t[5]),An.clamp_(0,1,t[6]),An.clamp_(0,1,1-t[7]))}onOK_(t){return this._okCallback=t,this}_toolbarActions(t){var e;switch(this.clearStatus_(),t){case BUT.Reset:null===(e=this._picker)||void 0===e||e.reset_();break;case BUT.Crop:{const t=this._okCallback;this.close_(),t(!0,this._current);break}case BUT.OK:{const t=this._okCallback;this.close_(),t(!1,this._current);break}case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}showFullscreen_(){this._image=new HTMLImageElement,this._image.style.backgroundColor="rgba(255, 255, 255, 1.0)",this._image.src=this._dataurl,An.onLoad_(this._image,()=>{this.onResize_(),An.setVisible_(this._dialog)}),An.onError_(this._image,()=>{toasters$.error_(MSG.string_(RS.ImageReadFailed)),this.actionCancelConfirmed_()})}onResize_(){null!=this._viewport&&(this._viewportSize=new Point(window.innerWidth,window.innerHeight-this._buttonSize-this._buttonSize/2-1),new DomBuilderEx(this._viewport).empty_(),this._picker=new l(this._viewport,this._buttonSize,this._viewportSize,this._imageSize,this._origin,this._image,this._zoom,r._MARGIN,"touchstart"==Conf.touchstart,new DumbSnapper,this._original,this._onchange))}_onchange(t,e,i){this._current=t,this._origin=e,this._zoom=i}}r._MARGIN=5,t.PromptQuad=r}(ShapePicker$||(ShapePicker$={}));const _slashAutoEscape="\\/"==new RegExp("/").source;class StringScanner{constructor(t,e=0){this.source=t,_position.set(this,0),_lastMatch.set(this,null),__classPrivateFieldSet(this,_position,e)}get position$(){return __classPrivateFieldGet(this,_position)}set position$(t){if(t<0||t>this.source.length)throw new Error(`Invalid position ${t}`);__classPrivateFieldSet(this,_position,t)}get lastMatch$(){return __classPrivateFieldGet(this,_lastMatch)}get rest$(){return this.source.substring(this.position$)}get isDone$(){return this.position$==this.source.length}readChar_(){var t;this.isDone$&&this.fail_("No more input");let e=this.source.codePointAt((__classPrivateFieldSet(this,_position,1+(t=+__classPrivateFieldGet(this,_position))),t));if(void 0===e)throw new Error("Invalid source");return e}peekChar_(t){var e;null==t&&(t=0);const i=this.position$+t;return i<0||i>=this.source.length?null:null!==(e=this.source.codePointAt(i))&&void 0!==e?e:null}scan_(t){const e=this.matches_(t);if(e){let t=__classPrivateFieldGet(this,_lastMatch);__classPrivateFieldSet(this,_position,__classPrivateFieldGet(this,_position)+(t.index+t[0].length))}return e}expect_(t,e){if(!this.scan_(t)){if(null==e){let i=t.source;_slashAutoEscape||(i=replaceAll_(i,"/","\\/")),e=`/${i}/`}this.fail_(e)}}expectDone_(){this.isDone$||this.fail_("no more input")}matches_(t){return __classPrivateFieldSet(this,_lastMatch,t.exec(this.source.slice(__classPrivateFieldGet(this,_position)))),null!=__classPrivateFieldGet(this,_lastMatch)}substring_(t,e){return null==e&&(e=this.position$),this.source.substring(t,e)}error_(t,e=null,i=null,n=null){throw null==e&&null==i&&null==n&&(e=this.lastMatch$),null==i&&(i=null==e?this.position$:e.index),null==n&&(n=null==e?1:e[0].length),new Error(`${t}: offset=${i}, length=${n}`)}fail_(t){this.error_(`expected ${t}.`,null,this.position$,0)}}_position=new WeakMap,_lastMatch=new WeakMap;class ISnapper{}class ImageViewer extends DialogBase{constructor(t,e,i,n=0,s=0,o=0,l=100,a=ColorValue.X_WHITE,r=!0){super(t),this._buttonSize=e,this._url=i,this.rotation=n,this.effect=s,this.adjust=o,this.quality=l,this._bgColor=a,this._fit=r,this._rotation=0,this._onImageInfo=null,this._okCallback=null,this._showing=!1,_destroyed_4.set(this,!1),super.init_(this.create_(t)),this._table.style.minWidth=`${6*e}px`,this._table.style.maxWidth="100vw",An.onClick_(this._content,t=>{An.stopevent_(t),this._actionToggleFit()})}create_(t){const e=this._createDialogWithoutStatus(t,t=>{const e=new DomBuilderEx(t);this._viewport=t,this._content=e.img1_(null,CSS.AnImageViewer).cursor_()},[BUT.info_(BUT.RotateImage),BUT.info_(BUT.Info),BUT.info_(BUT.OK),BUT.info_(BUT.Cancel)],t=>this._toolbarActions(t));return An.onLoad_(this._content,()=>{this._onresize()}),An.onError_(this._content,()=>{this.actionCancel_(),toasters$.warnKey_(RS.ImageNotFound)}),this._toolbar.showButton_(BUT.Info,!1),this._toolbar.showButton_(BUT.OK,!1),e}close_(){var t;__classPrivateFieldGet(this,_destroyed_4)||(__classPrivateFieldSet(this,_destroyed_4,!0),this._viewport.remove(),null===(t=this._dragger)||void 0===t||t.destroy_(),this._dragger=null,this._okCallback=null,this._onImageInfo=null,super.close_())}onOK_(t){return this._okCallback=t,this._toolbar.showButton_(BUT.OK,null!=t),this}onImageInfo_(t){return this._onImageInfo=t,this._toolbar.showButton_(BUT.Info,null!=t),this}_toolbarActions(t){var e;switch(this.clearStatus_(),t){case BUT.RotateImage:this._actionRotate();break;case BUT.Info:null===(e=this._onImageInfo)||void 0===e||e.call(this);break;case BUT.Cancel:this.actionCancel_();break;case BUT.OK:{const t=this._okCallback;this.close_(),t();break}default:this.actionInvalid_(t)}}_actionRotate(){this._rotation=(this._rotation+90)%360,toasters$.info_(`${MSG.string_(RS.Rotation)}: ${this._rotation}`,{attop:!1}),this._onresize()}_actionToggleFit(){this._fit=!this._fit,this._onresize()}show_(){return An.showHidden_(this._dialog,"block"),this._smokescreen=new Smokescreen(this._container,An.zindexOf_(this._dialog,DEF.zindexUnder,DEF.zindexPrompt+DEF.zindexUnder)),null==this._bgColor?this._smokescreen.opacity_(DEF.opacitySmoke):(this._smokescreen.opacity_(DEF.opacityOpaque),this._smokescreen.bgcolor_(this._bgColor)),this._smokescreen.on_("click",t=>{An.stopevent_(t),this._onresize()}),this._smokescreen.show_(),this._showing=!0,this._onWindowResize(()=>this._onresize()),null==this._dragger&&(this._dragger=new Dragger(this._dialog,new DialogVerticalDraggerHandler).bind_()),host$.previewImage_(this._url,this.rotation,this.effect,this.adjust,this.quality,t=>{toasters$.warn_(t)||(this._content.src=t[Key.result])}),this}_onresize(){const t=this._content.naturalWidth,e=this._content.naturalHeight;0==t&&0==e||(this._resize(t,e),this._showing&&(this._showing=!1,An.setVisible_(this._dialog)))}_resize(t,e){const i=window.innerWidth,n=window.innerHeight;this.onresize1(t,e,i,n,this._viewport,this._content)}onresize1(t,e,i,n,s,o){const l=this._dialog,a=this._rotation;if(null==l||null==s||null==o)return;let r=!1;switch(a){case 0:case 180:break;case 90:case 270:{const i=t;t=e,e=i,r=!0;break}default:throw Assert.notReach_(`${a}`)}let _=t,c=e;const h=o.style;let u=i-40-DEFUtil.dialogChromeWidth_(this._buttonSize);l.style.top="20px";let d=n-Math.round(An.documentOffset_(o).y)-DEFUtil.dialogBottom_();if(u>t&&(u=t),d>e&&(d=e),this._fit){const n=MediaUtil.fit_(t,e,u,d);_=n.x,c=n.y,s.style.width=`${_}px`,s.style.height="",Conf.isMobile?s.style.height=`${c+4}px`:Timer.sleep_(100,()=>{s.style.height=`${c+4}px`});const o=i-(_+20+9),a=Math.max(20,o/2);l.style.left=`${a}px`}else{const t=i-(u+20+9),e=Math.max(20,t/2);An.setLeftTop_(l,e,20),An.setWidthHeight_(s,u,d+4)}const S=r?c:_,p=r?_:c;switch(h.width=`${S}px`,h.height=`${p}px`,h.float="left",a){case 0:h.transform="",h.transformOrigin="";break;case 90:h.transform=`translateX(${_}px) rotate(${a}deg)`,h.transformOrigin="0 0";break;case 180:h.transform=`rotate(${a}deg)`,h.transformOrigin="50% 50%";break;case 270:h.transform=`translateY(${c}px) rotate(${a}deg)`,h.transformOrigin="0 0";break;default:throw Assert.notReach_(`${a}`)}}}_destroyed_4=new WeakMap;class ScribblerContextActions{}ScribblerContextActions.BG=ScribblerAction.BG,ScribblerContextActions.CURVE=ScribblerAction.CURVE,ScribblerContextActions.ELLIPSE=ScribblerAction.ELLIPSE,ScribblerContextActions.EMBEDED_IMAGE=ScribblerAction.EMBEDED_IMAGE,ScribblerContextActions.IMAGE=ScribblerAction.IMAGE,ScribblerContextActions.POLYCURVE=ScribblerAction.POLYCURVE,ScribblerContextActions.POLYGON=ScribblerAction.POLYGON,ScribblerContextActions.RECTANGLE=ScribblerAction.RECTANGLE,ScribblerContextActions.TEXT=ScribblerAction.TEXT,ScribblerContextActions.export=ScribblerAction.export,ScribblerContextActions.history=ScribblerAction.history,ScribblerContextActions.more=ScribblerAction.more,ScribblerContextActions.shift=ScribblerAction.shift,ScribblerContextActions.FONT_NAME="XpD",ScribblerContextActions.FILL_COLOR="Xs4",ScribblerContextActions.CORNERING="Xeg",ScribblerContextActions.LINE_HEIGHT="XZi",ScribblerContextActions.LINE_STYLE="XBB",ScribblerContextActions.STROKE_COLOR="XAo",ScribblerContextActions.TEXTING="X2z",ScribblerContextActions.clear="XoQ",ScribblerContextActions.FONT_SIZE="XNs",ScribblerContextActions.fit="XOF",ScribblerContextActions.resize="XPS",ScribblerContextActions.TEXT_COLOR="XuZ",ScribblerContextActions.FONT_CAT="Xtp",ScribblerContextActions.GRID="XEI",ScribblerContextActions.LINE_WIDTH="Xul",ScribblerContextActions.CORNER_RADIUS="XLd",ScribblerContextActions.STROKE="XQ0",ScribblerContextActions.FONT_SAMPLE="XIo",ScribblerContextActions.TEXT_ALIGN="XiE",ScribblerContextActions.FONT_STYLE="XAb",ScribblerContextActions.FILL="XhG";class ScribblerContextmenu extends PopupBase{constructor(t,e,i,n,s){super(),this._container=t,this._buttonSize=e,this._dpi=i,this._settings=n,this._scribbler=s,this._tooltipsCallback=null,this._promptColorCallback=null,this._buttons=new Map,this._submenus=new Map,_destroyed_5.set(this,!1);const o=this.createContextmenu_(t),l=this.createSmokescreen_(t,An.zindexOf_(o,DEF.zindexUnder,DEF.zindexPrompt+DEF.zindexUnder));this.init_(o,l),this.setupHandlers_(o,`td[${ATTR.AnAction}]`,`td[${ATTR.xTooltips}]`),this._getButtonForAction(s.getAction_()).classList.add(CSS.AnSelected),this._updateContextmenuState(),this.onDrag_((t,e,i,n)=>{const s=DomUt.asHTMLElement_(e);return null!=s&&("TABLE"==s.nodeName||"DIV"==s.nodeName)&&s.classList.contains(CSS.AnContextmenu)}),this.onShow_(()=>{"none"!=this._submenus.get(ScribblerContextActions.more).style.display&&this._updateContextmenuState()})}destroy_(){var t,e,i;__classPrivateFieldGet(this,_destroyed_5)||(__classPrivateFieldSet(this,_destroyed_5,!0),null===(t=this._scribbler)||void 0===t||t.destroy_(),null===(e=this._contextmenu)||void 0===e||e.remove(),null===(i=this._smokescreen)||void 0===i||i.destroy_(),this._tooltipsCallback=null,this._promptColorCallback=null,super.destroy_())}getButton_(t){var e;return null!==(e=this._buttons.get(t))&&void 0!==e?e:null}onTooltips_(t){return this._tooltipsCallback=t,this}onPromptColor_(t){this._promptColorCallback=t}_selectoptions(t){return new SelectOptions(accessories$,t)}createContextmenu_(t){const e=new DomBuilderEx(t).push_(),i=e.div_({class:CSS.AnContextmenu,style:"display: none;"}).cursor_();e.table1_(CSS.AnContextmenu).push_(),this._createbuttons(this._buttons,e,[[smap_([ATTR.AnAction,ScribblerContextActions.more],[ATTR.xTooltips,RS.Tooltips_CanvasActions],["class",`${CSS.Fa} ${CSS.FaGear}`]),smap_([ATTR.AnAction,ScribblerContextActions.export],[ATTR.xTooltips,RS.Tooltips_ExportAsImage],["class",`${CSS.Fa} ${CSS.FaExternalLink}`]),smap_([ATTR.AnAction,ScribblerContextActions.history],[ATTR.xTooltips,RS.Tooltips_EditDrawingHistory],["class",`${CSS.Fa} ${CSS.FaHistory}`]),smap_([ATTR.AnAction,ScribblerContextActions.BG],[ATTR.xTooltips,RS.Tooltips_SetBackgroundColor],["class",`${CSS.Fa} ${CSS.FaSpinner}`]),smap_([ATTR.AnAction,ScribblerContextActions.IMAGE],[ATTR.xTooltips,RS.Tooltips_ImportImageFile],["class",`${CSS.Fa} ${CSS.FaFileImageO}`]),smap_([ATTR.AnAction,ScribblerContextActions.EMBEDED_IMAGE],[ATTR.xTooltips,RS.Tooltips_EmbedImage],["class",`${CSS.Fa} ${CSS.FaImage}`])],[smap_([ATTR.AnAction,ScribblerContextActions.CURVE],[ATTR.xTooltips,RS.Tooltips_DrawFreehandCurves],["class",`${CSS.Fa} ${CSS.FaHandOUp}`]),smap_([ATTR.AnAction,ScribblerContextActions.POLYCURVE],[ATTR.xTooltips,RS.Tooltips_DrawCurves],["class",`${CSS.Fa} ${CSS.FaHeartO}`]),smap_([ATTR.AnAction,ScribblerContextActions.POLYGON],[ATTR.xTooltips,RS.Tooltips_DrawPolylineOrPolygons],["class",`${CSS.Fa} ${CSS.FaStarO}`]),smap_([ATTR.AnAction,ScribblerContextActions.TEXT],[ATTR.xTooltips,RS.Tooltips_DrawText],["class",`${CSS.Fa} ${CSS.FaTumblr}`]),smap_([ATTR.AnAction,ScribblerContextActions.RECTANGLE],[ATTR.xTooltips,RS.Tooltips_DrawRectangles],["class",`${CSS.Fa} ${CSS.FaSquareO}`]),smap_([ATTR.AnAction,ScribblerContextActions.ELLIPSE],[ATTR.xTooltips,RS.Tooltips_DrawEllipses],["class",`${CSS.Fa} ${CSS.FaCircleThin}`])]]),this._submenus.set(ScribblerContextActions.GRID,this._menurow(e)),e.push_().div1_(CSS.AnInput4).text_(MSG.string_(RS.Grid)),e.pop_().div1_(CSS.AnMenuSelect,CSS.AnWidth2),this._inputGrid=this._selectoptions(e.cursor_()),this._inputGrid.setOptions_(An.createStringList1_([[1,20,1],[20,50,5],[50,101,10]])),this._submenus.set(ScribblerContextActions.LINE_HEIGHT,this._menurow(e)),e.push_().div1_(CSS.AnInput4).text_(MSG.string_(RS.LineHeight)),e.pop_().div1_(CSS.AnMenuSelect,CSS.AnWidth2),this._inputLineheight=this._selectoptions(e.cursor_()),this._inputLineheight.setOptions_(["0.80","0.85","0.9","0.95","1.00","1.05","1.10","1.15","1.20","1.25","1.30","1.35","1.40","1.45","1.50","1.55"]),this._submenus.set(ScribblerContextActions.TEXT_ALIGN,this._menurow(e)),e.push_().div1_(CSS.AnInput4).text_(MSG.string_(RS.Alignment)),e.pop_().div1_(CSS.AnMenuSelect,CSS.AnWidth2),this._inputAlignment=this._selectoptions(e.cursor_()),this._inputAlignment.setOptions_([MSG.string_(RS.Left),MSG.string_(RS.Center),MSG.string_(RS.Right)]),this._submenus.set(ScribblerContextActions.TEXT_COLOR,this._menurow(e)),this._inputTexting=e.div1_(CSS.AnInputButton,CSS.Fa,CSS.FaCheck).cursor_();const n=e.up_().div1_(CSS.AnInput4).text_(MSG.string_(RS.TextColor)).cursor_();this._inputTextcolor=e.up_().div1_(CSS.AnColorCell).cursor_(),this._submenus.set(ScribblerContextActions.FILL_COLOR,this._menurow(e)),this._inputFill=e.div1_(CSS.AnInputButton,CSS.Fa,CSS.FaCheck).cursor_();const s=e.up_().div1_(CSS.AnInput4).text_(MSG.string_(RS.FillColor)).cursor_();this._inputFillcolor=e.up_().div1_(CSS.AnColorCell).cursor_(),this._submenus.set(ScribblerContextActions.STROKE_COLOR,this._menurow(e)),this._inputStroke=e.div1_(CSS.AnInputButton,CSS.Fa,CSS.FaCheck).cursor_();const o=e.up_().div1_(CSS.AnInput4).text_(MSG.string_(RS.StrokeColor)).cursor_();this._inputStrokecolor=e.up_().div1_(CSS.AnColorCell).cursor_(),this._submenus.set(ScribblerContextActions.LINE_STYLE,this._menurow(e)),e.push_().div1_(CSS.AnMenuSelect,CSS.AnWidth4),this._inputLinestyle=this._selectoptions(e.cursor_()),this._inputLinestyle.setOptions_([ScribblerLineStyle.SOLID,ScribblerLineStyle.DASH,ScribblerLineStyle.DOTTED]),e.pop_().div1_(CSS.AnMenuSelect,CSS.AnWidth2),this._inputLinewidth=this._selectoptions(e.cursor_()),this._inputLinewidth.setOptions_(An.createStringList_(["1"],[[2,10,1],[10,20,2],[20,50,5],[50,100,10],[100,200,25],[200,300,50],[300,501,100]])),this._submenus.set(ScribblerContextActions.CORNERING,this._menurow(e)),e.push_().div1_(CSS.AnInput4).text_(MSG.string_(RS.Cornering)),e.pop_().div1_(CSS.AnMenuSelect,CSS.AnWidth2),this._inputCornering=this._selectoptions(e.cursor_()),this._inputCornering.setOptions_(An.createStringList1_([[0,101,5]])),this._submenus.set(ScribblerContextActions.CORNER_RADIUS,this._menurow(e)),e.push_().div1_(CSS.AnInput4).text_(MSG.string_(RS.Corner)),e.pop_().div1_(CSS.AnMenuSelect,CSS.AnWidth2),this._inputCorner=this._selectoptions(e.cursor_()),this._inputCorner.setOptions_(An.createStringList1_([[0,10,1],[10,20,2],[20,50,5],[50,101,10]])),this._submenus.set(ScribblerContextActions.FONT_CAT,this._menurow(e)),e.div1_(CSS.AnMenuSelect,CSS.AnWidth6),this._inputFontcat=this._selectoptions(e.cursor_()),this._inputFontcat.setOptions_(this._settings.fontCategories_()),this._submenus.set(ScribblerContextActions.FONT_NAME,this._menurow(e)),e.div1_(CSS.AnMenuSelect,CSS.AnWidth6),this._inputFontname=this._selectoptions(e.cursor_()),DialogUt.populateFontName_(this._inputFontname,[],this._settings.fontFamilies_(),this._inputFontcat.getValue_(""),""),this._submenus.set(ScribblerContextActions.FONT_SIZE,this._menurow(e)),e.div1_(CSS.AnMenuSelect,CSS.AnWidth4),this._inputFontstyle=this._selectoptions(e.cursor_()),e.up_().div1_(CSS.AnMenuSelect,CSS.AnWidth2),this._fontSizes=An.createIntList_([],[[6,20,1],[20,36,2],[36,72,4],[72,144,8],[144,257,16]]),this._inputFontsize=this._selectoptions(e.cursor_()),this._inputFontsize.setOptions_(Array.from(this._fontSizes,(t,e)=>t.toString())),this._submenus.set(ScribblerContextActions.FONT_SAMPLE,this._menurow(e)),this._inputFontsample=e.div1_(CSS.AnMenurow6).cursor_(),this._submenus.set(ScribblerContextActions.more,e.peek_().tr_({style:`border-top:${DEF.themeBorder}`}).push_().cursor_()),this._createbuttonrow(this._buttons,e,[smap_([ATTR.AnAction,ScribblerContextActions.resize],[ATTR.xTooltips,RS.Tooltips_ResizeCanvas],["class",`${CSS.Fa} ${CSS.FaExpand}`]),smap_([ATTR.AnAction,ScribblerContextActions.fit],[ATTR.xTooltips,RS.Tooltips_CropCanvasToFitContent],["class",`${CSS.Fa} ${CSS.FaCompress}`]),smap_([ATTR.AnAction,ScribblerContextActions.shift],[ATTR.xTooltips,RS.Tooltips_ShiftCanvas],["class",`${CSS.Fa} ${CSS.FaArrows}`]),smap_([ATTR.AnAction,DEF.NOOP]),smap_([ATTR.AnAction,DEF.NOOP]),smap_([ATTR.AnAction,ScribblerContextActions.clear],[ATTR.xTooltips,RS.Tooltips_ClearCanvasAndDrawingHistory],["class",`${CSS.Fa} ${CSS.FaTimesCircle}`])]),e.pop_(),this._updateContextmenuState(),this._inputFontcat.onChange_(t=>{const e=this._inputFontname.getValue_("");DialogUt.populateFontName_(this._inputFontname,[],this._settings.fontFamilies_(),t,e)}),this._inputFontname.onChange_(t=>{const e=this._inputFontstyle.getValue_(""),i=this._inputFontsize.getValue_(""),n=DialogUt.populateFontStyle_(this._inputFontstyle,[],this._settings.fontInfo_(t),e),s=FontUtil.fontFamilyOf_(t,n);this._setfont0(this._inputFontsample,s,i)}),this._inputFontstyle.onChange_(t=>{const e=this._inputFontname.getValue_(""),i=this._inputFontsize.getValue_(""),n=FontUtil.fontFamilyOf_(e,t);this._setfont0(this._inputFontsample,n,i)}),this._inputFontsize.onChange_(t=>{const e=this._inputFontname.getValue_(""),i=this._inputFontstyle.getValue_(""),n=FontUtil.fontFamilyOf_(e,i);this._setfont(n,t)});const l=sarray_();for(let t of this._settings.fontFamilies_()){if(t.category_()==FontCategories.System)continue;const e=t.fontname_(),i=t.styles_();for(let t of i){const i=FontUtil.fontFamilyOf_(e,t);l.push(i)}}An.onClick_(this._inputFontsample,t=>{An.stopevent_(t);const e=new PromptFont(this._container,this._buttonSize,this._dpi,this._inputFontsample.style.fontFamily,l,PATH._assetsFontsPng);e.above_(this.element_()),e.onOK_(t=>{const e=FontUtil.splitNameStyle_(t),i=this._inputFontname.getValue_(""),n=this._inputFontstyle.getValue_(""),s=this._inputFontsize.getValue_("");e[0]==i&&e[1]==n||(this._inputFontname.setValue_(e[0]),DialogUt.populateFontStyle_(this._inputFontstyle,[],this._settings.fontInfo_(e[0]),e[1]),this._setfont0(this._inputFontsample,t,s))}),e.show_()}),this._inputAlignment.onChange_(t=>{this._scribbler.setTextAlign_(t)}),this._inputCornering.onChange_(t=>{const e=An.parseInt_(t,50);this._scribbler.setCornering_(e/100)}),this._inputCorner.onChange_(t=>{const e=An.parseInt_(t,0);this._scribbler.setCornerRadius_(e)});const a=t=>{if(An.stopevent_(t),null==this._promptColorCallback)return;const e=this._promptColorCallback(this._buttonSize,An.above_(this.element_()),this._inputStrokecolor.style.backgroundColor,ColorValue.X_BLACK);e.onOK_((t,e)=>{null!=t&&(this._inputStrokecolor.style.backgroundColor=t.toCSSString_(),this._scribbler.setStrokeColor_(t))}),e.show_()},r=t=>{if(An.stopevent_(t),null==this._promptColorCallback)return;const e=this._promptColorCallback(this._buttonSize,An.above_(this.element_()),this._inputFillcolor.style.backgroundColor,ColorValue.X_TRANSPARENT);e.onOK_((t,e)=>{null!=t&&(this._inputFillcolor.style.backgroundColor=t.toCSSString_(),this._scribbler.setFillColor_(t))}),e.show_()};this._inputGrid.onChange_(t=>{const e=this._scribbler.getScribblerSetting_(),i=An.parseInt_(t,e.x_grid);i!=e.x_grid&&this._scribbler.setGrid_(i)}),this._inputLineheight.onChange_(t=>{const e=this._scribbler.getScribblerSetting_(),i=An.parseDouble_(t,e.x_lineHeight);i!=e.x_lineHeight&&this._scribbler.setLineHeight_(i)}),An.onClick_(this._inputTexting,t=>{An.stopevent_(t);const e=An.classlist_(this._inputTexting);if(!e.contains_(CSS.AnDisabled)){e.toggleAll_(CSS.FaCheck,CSS.FaClose);const t=e.contains_(CSS.FaCheck);this._scribbler.enableText_(t)}}),An.onClick_(this._inputFill,t=>{An.stopevent_(t);const e=An.classlist_(this._inputFill).toggleAll_(CSS.FaCheck,CSS.FaClose).contains_(CSS.FaCheck);this._scribbler.enableFill_(e)}),An.onClick_(this._inputStroke,t=>{An.stopevent_(t);const e=An.classlist_(this._inputStroke);if(!e.contains_(CSS.AnDisabled)){e.toggleAll_(CSS.FaCheck,CSS.FaClose);const t=e.contains_(CSS.FaCheck);this._scribbler.enableStroke_(t)}});const _=t=>{if(An.stopevent_(t),null==this._promptColorCallback)return;const e=this._promptColorCallback(this._buttonSize,An.above_(this.element_()),this._inputTextcolor.style.backgroundColor,ColorValue.X_BLACK);e.onOK_((t,e)=>{null!=t&&(this._inputTextcolor.style.backgroundColor=t.toCSSString_(),this._scribbler.setTextColor_(t))}),e.show_()};return An.onClick_(o,a),An.onClick_(this._inputStrokecolor,a),An.onClick_(s,r),An.onClick_(this._inputFillcolor,r),An.onClick_(n,_),An.onClick_(this._inputTextcolor,_),this._inputLinestyle.onChange_(t=>{this._scribbler.setLineStyle_(t)}),this._inputLinewidth.onChange_(t=>{"1"==t&&(t="1.05");const e=An.parseDouble_(t,ScribblerDefault.LINE_WIDTH);this._scribbler.setLineWidth_(e)}),An.addContextmenuListenerMatching_(i,`td[${ATTR.xTooltips}]`,(t,e)=>{null!=this._tooltipsCallback&&this._tooltipsCallback(t,e)}),i}_menurow(t){const e=t.peek_().tr_({class:CSS.AnMenurow,style:`border-top:${DEF.themeBorder}`}).cursor_();return t.td_({colspan:"6"}),e}_updateContextmenuState(){const t=this._scribbler.getAction_(),e=this._scribbler.getScribblerSetting_(),i=this._scribbler.getTextSetting_(),n=e.x_lineWidth<1.9?"1":Math.round(e.x_lineWidth).toString(),s=An.binarySearchIntValue_(this._fontSizes,0,this._fontSizes.length,i.x_fontSize);s!=i.x_fontSize&&this._scribbler.setFont_(i.x_fontFamily,s),this._inputGrid.setValue_(e.x_grid.toString()),this._inputLineheight.setValue_(`${e.x_lineHeight}`),this._inputLinestyle.setValue_(e.x_lineStyle),this._inputLinewidth.setValue_(n),this._inputCorner.setValue_(e.x_cornerRadius.toString()),this._inputCornering.setValue_(Math.floor(100*e.x_cornering).toString()),this._inputFontcat.setValue_("All");const o=FontUtil.splitNameStyle_(i.x_fontFamily);switch(DialogUt.populateFontName_(this._inputFontname,[],this._settings.fontFamilies_(),FontCategories.All,o[0]),DialogUt.populateFontStyle_(this._inputFontstyle,[],this._settings.fontInfo_(o[0]),o[1]),this._inputFontsize.setValue_(s.toString()),this._inputAlignment.setValue_(e.x_textAlign),this._inputFontsample.style.fontFamily=i.x_fontFamily,this._inputFontsample.textContent=i.x_fontFamily,this._inputFillcolor.style.backgroundColor=e.x_fillColor.toCSSString_(),this._inputStrokecolor.style.backgroundColor=e.x_strokeColor.toCSSString_(),this._inputTextcolor.style.backgroundColor=e.x_textColor.toCSSString_(),t!=ScribblerAction.TEXT?this._inputTexting.classList.remove(CSS.AnDisabled):An.classlist_(this._inputTexting).add_(CSS.AnDisabled).remove_(CSS.FaClose).add_(CSS.FaCheck),t!=ScribblerAction.CURVE?this._inputStroke.classList.remove(CSS.AnDisabled):An.classlist_(this._inputStroke).remove_(CSS.FaClose).addAll_(CSS.AnDisabled,CSS.FaCheck),this._updatecheckbox(this._inputTexting,e.x_texting),this._updatecheckbox(this._inputFill,e.x_fill),this._updatecheckbox(this._inputStroke,e.x_stroke),t){case ScribblerAction.more:this._showmenu([ScribblerContextActions.GRID,ScribblerContextActions.more]);break;case ScribblerAction.export:this._showmenu([ScribblerContextActions.GRID]);break;case ScribblerAction.TEXT:this._showmenu([ScribblerContextActions.GRID,ScribblerContextActions.LINE_HEIGHT,ScribblerContextActions.TEXT_ALIGN,ScribblerContextActions.TEXT_COLOR,ScribblerContextActions.FONT_CAT,ScribblerContextActions.FONT_NAME,ScribblerContextActions.FONT_SIZE,ScribblerContextActions.FONT_SAMPLE]);break;case ScribblerAction.CURVE:this._showmenu([ScribblerContextActions.GRID,ScribblerContextActions.STROKE_COLOR,ScribblerContextActions.LINE_WIDTH,ScribblerContextActions.LINE_STYLE,ScribblerContextActions.CORNERING]);break;case ScribblerAction.POLYCURVE:this._showmenu([ScribblerContextActions.GRID,ScribblerContextActions.FILL_COLOR,ScribblerContextActions.STROKE_COLOR,ScribblerContextActions.LINE_WIDTH,ScribblerContextActions.LINE_STYLE,ScribblerContextActions.CORNERING]);break;case ScribblerAction.POLYGON:case ScribblerAction.IMAGE:case ScribblerAction.EMBEDED_IMAGE:case ScribblerAction.ELLIPSE:this._showmenu([ScribblerContextActions.GRID,ScribblerContextActions.FILL_COLOR,ScribblerContextActions.STROKE_COLOR,ScribblerContextActions.LINE_WIDTH,ScribblerContextActions.LINE_STYLE]);break;case ScribblerAction.RECTANGLE:this._showmenu([ScribblerContextActions.GRID,ScribblerContextActions.FILL_COLOR,ScribblerContextActions.STROKE_COLOR,ScribblerContextActions.LINE_WIDTH,ScribblerContextActions.LINE_STYLE,ScribblerContextActions.CORNER_RADIUS]);break;default:throw Assert.notReach_(t)}}_updatecheckbox(t,e){const i=t.classList;if(!i.contains(CSS.AnDisabled)){if(e!=i.contains(CSS.FaCheck))return An.classlist_(i).toggleAll_(CSS.FaClose,CSS.FaCheck),!0}return!1}_getButtonForAction(t){const e=this._buttons.get(t);return void 0!==e?e:this._buttons.get(ScribblerAction.CURVE)}setAction_(t,e){const i=this._scribbler.getAction_();return t!=i&&(null!=i&&this._getButtonForAction(i).classList.remove(CSS.AnSelected),e.classList.add(CSS.AnSelected),this._scribbler.setAction_(t),this._updateContextmenuState(),!0)}_setfont0(t,e,i){t.style.fontFamily=e,t.textContent=e+" "+i,this._setfont(e,i)}_setfont(t,e){this._scribbler.setFont_(t,An.parseInt_(e,ScribblerDefault.FONT_SIZE))}_showmenu(t){const e=new Set(t);for(let[t,i]of this._submenus)An.show_(i,e.has(t)?"block":"none")}_createbuttons(t,e,i){e.push_();for(let n of i)e.peek_().tr_().push_(),this._createbuttonrow(t,e,n),e.pop_();e.pop_()}_createbuttonrow(t,e,i){for(let n of i)this._createbutton(t,e,n)}_createbutton(t,e,i){var n;const s=i[ATTR.AnAction];if(s==DEF.NOOP)e.peek_().td_(["class",`${CSS.AnContextButton} ${CSS.AnDisabled}`],[ATTR.AnAction,DEF.NOOP]);else{const o=e.peek_().td_(["class",CSS.AnContextButton],[ATTR.xTooltips,i[ATTR.xTooltips]],[ATTR.AnAction,s]).cursor_();e.span1_(...(null!==(n=i.class)&&void 0!==n?n:"").split(RX.Spaces)),t.set(s,o)}}}_destroyed_5=new WeakMap;class PromptScribblerHistory extends FixedSizeDialogBase{constructor(t,e,i){super(t,e),this._scribbler=i,this._promptEditTextCallback=null,this._selected=null,this._contextmenu=null,this._selectedIndex=null,this._width=0,super.init_(this.create_(t)),An.addClickListenerMatching_(this._content,`div[${ATTR.AnInfo}]`,(t,e)=>{An.stopevent_(e);const i=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);this._select(t,i)}),this._onShowDialogCallback=(t,e)=>{this._refresh(),this._updateToolbarState(),An.setVisible_(t)}}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),[BUT.info_(BUT.Contextmenu),BUT.info_(BUT.Remove),BUT.info_(BUT.Up),BUT.info_(BUT.Down)],(t,e)=>this._toolbarActions(t,e))}_createContent(t){this._content=new DomBuilderEx(t).div1_(CSS.AnVerticalViewportWide).div1_(CSS.AnTextList,CSS.AnZebra).cursor_()}close_(){this._promptEditTextCallback=null,super.close_()}onEditText_(t){return this._promptEditTextCallback=t,this}getContentWidth_(){return this._width}_select(t,e){if(this._scribbler.highlight_(e),null!=this._selected&&(this._selected.classList.remove(CSS.AnSelected),this._selectedIndex==e))return this._selected=null,this._selectedIndex=null,void this._updateToolbarState();t.classList.add(CSS.AnSelected),this._selected=t,this._selectedIndex=e,t.scrollIntoView({block:"center"}),this._updateToolbarState()}_toolbarActions(t,e){switch(this.clearStatus_(),t){case BUT.Remove:if(null!=this._selected){let t=this._selectedIndex;const e=this._scribbler.history_().history_().length;if(null!=t&&t>=0&&t<e)if(this._scribbler.history_().remove_(t),this._scribbler.refresh_(),this._selected=null,this._selectedIndex=null,this._refresh(),e>1){const i=this._content.children;let n=e-t-1;t==e-1?--t:0==t&&--n,this._select(i[n],t)}else this._updateToolbarState()}break;case BUT.Up:{let t=this._selectedIndex;if(null!=t){const e=this._scribbler.history_().history_().length;t=this._scribbler.down_(t),this._selectedIndex=null,this._selected=null,this._refresh();const i=this._content.children[e-t-1];this._select(i,t)}break}case BUT.Down:{let t=this._selectedIndex;if(null!=t){const e=this._scribbler.history_().history_().length;t=this._scribbler.up_(t),this._selectedIndex=null,this._selected=null,this._refresh();const i=this._content.children[e-t-1];this._select(i,t)}break}case BUT.Contextmenu:Timer.sleep1_(()=>{null==this._contextmenu&&(this._contextmenu=this._createContextmenu()),this._contextmenu.show_(e)});break;default:return void this.actionInvalid_(t)}}_updateToolbarState(){const t=this._scribbler.history_().history_().length;this._toolbar.enableButton_(BUT.Remove,null!=this._selectedIndex),this._toolbar.enableButton_(BUT.Up,null!=this._selectedIndex&&t>1),this._toolbar.enableButton_(BUT.Down,null!=this._selectedIndex&&t>1)}_editable(){if(null==this._selectedIndex)return null;const t=this._scribbler.history_().get_(this._selectedIndex);return null!=t&&t.action$==ScribblerAction.TEXT?t:null}_createContextmenu(){const t=new Contextmenu(this._container,An.above_(this._dialog),[BUT.infos_(BUT.Edit,BUT.Move,BUT.CloneObject)]);return t.onTooltips_(toasters$.onTooltipsKey_),t.onDrag_(Contextmenu.contextmenuDragOK_),t.onAction_(t=>this._contextActions(t)),t.onShow_(()=>{t.enableButton_(BUT.Edit,null!=this._editable()),t.enableButton_(BUT.Move,null!=this._selectedIndex),t.enableButton_(BUT.CloneObject,null!=this._selectedIndex)}),t}_contextActions(t){var e;if(this.clearStatus_(),null===(e=this._contextmenu)||void 0===e||e.hide_(),null!=this._selectedIndex)switch(t){case BUT.Edit:this._edit();break;case BUT.Move:this.close_(),this._scribbler.move_(this._selectedIndex);break;case BUT.CloneObject:this.close_(),this._scribbler.cloneObject_(this._selectedIndex);break;default:this.actionInvalid_(t)}else toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection))}_edit(){var t,e;const i=this._editable();if(null==i)return;const n=i.setting$;null===(t=this._promptEditTextCallback)||void 0===t||t.call(this,null!==(e=n.x_data)&&void 0!==e?e:"",n.x_fontFamily,An.above_(this._dialog),t=>{t.onOK_((t,e,i,s)=>{s(!0),n.x_data=e,this._scribbler.refresh_(),this._refresh()}),t.show_()})}_refresh(){const t=new DomBuilderEx(this._content).empty_();this._scribbler.history_().populate_(t)}showDialog_(t){An.showHidden_(this._dialog,"block"),this._smokescreen=new Smokescreen(this._container,An.below_(this._dialog)),this._smokescreen.on_("click",t=>{var e;An.stopevent_(t),this._scribbler.clearOverlay_(),this.close_(),null===(e=this._cancelCallback)||void 0===e||e.call(this)});for(let t of DomUt.queryAll_(this._dialog,"input, textarea, select"))null==t.getAttribute(ATTR.AnNoClick)&&An.onClick_(t,()=>{this.clearStatus_()});null!=t&&(t(this),this._onWindowResize(()=>{t(this)})),this._smokescreen.show_(),null!=this._onShowDialogCallback?this._onShowDialogCallback(this._dialog,this._smokescreen):(An.setVisible_(this._dialog),Timer.sleep0_(()=>this.setInitialFocus_())),null==this._dragger&&null!=this._dragHandler&&(this._dragger=new Dragger(this._dialog,this._dragHandler).bind_())}}class ImageAnnotator extends FullscreenDialogBase{constructor(t,e,i,n,s,o,l){super(t,e),this._buttonSize=i,this._dpi=n,this._width=s,this._height=o,this._handler=l,this._bgColor=ScribblerDefault.BG_COLOR,this._bgImageCallback=null,this._promptColorCallback=null,this._promptEditTextCallback=null,this._okCallback=null,this._srcPath=null,this._history=null,this._scribbler=null,this._contextmenu=null,this._showing=!1,_destroyed_6.set(this,!1),super.init_(this.create_(t)),An.onLoad_(this._canvas,()=>{this.onResize_()})}create_(t){return this.createFullscreenDialog_(t,t=>this._createFullscreenToolbar(t),t=>this._createFullscreenContent(t))}_createFullscreenToolbar(t){const e=FullscreenDialogBase.fullscreenToolbarCreator_(t,null,[BUT.info_(BUT.Contextmenu),BUT.info_(BUT.Move),BUT.info_(BUT.Undo),BUT.info_(BUT.Redo),BUT.info_(BUT.OK),BUT.info_(BUT.Cancel)]);return e.onAction_((t,e)=>this._toolbarActions(t,e)),e.enableButton_(BUT.Undo,!1),e.enableButton_(BUT.Redo,!1),e}_createFullscreenContent(t){this._content=t.div_({class:CSS.AnViewport}).cursor_(),this._content.parentElement.style.padding=`${ImageAnnotator.PADDING}px`;const e={class:CSS.AnImageAnnotator,width:`${this._width}`,height:`${this._height}`};this._canvas=t.child_("canvas",e).cursor_()}close_(){var t,e;__classPrivateFieldGet(this,_destroyed_6)||(__classPrivateFieldSet(this,_destroyed_6,!0),this._content.remove(),this._canvas.remove(),null!=this._contextmenu&&(null===(t=this._contextmenu)||void 0===t||t.destroy_(),this._contextmenu=null),null!=this._scribbler&&(null===(e=this._scribbler)||void 0===e||e.destroy_(),this._scribbler=null),this._bgImageCallback=null,this._promptColorCallback=null,this._promptEditTextCallback=null,this._okCallback=null,super.close_())}bgColor_(t){return this._bgColor=t,this}bgImage_(t){return this._bgImageCallback=t,this}onPromptColor_(t){return this._promptColorCallback=t,this}onEditText_(t){return this._promptEditTextCallback=t,this}onOK_(t){return this._okCallback=t,this}path_(t){this._srcPath=t}history_(t){this._history=t}_toolbarActions(t,e){var i;if(null!=this._scribbler)switch(this.clearStatus_(),t){case BUT.Contextmenu:null===(i=this._contextmenu)||void 0===i||i.show_(e);break;case BUT.Move:{const t=this._scribbler.history_().length_()-1;t>=0&&(this._scribbler.highlight_(t),this._scribbler.move_(t));break}case BUT.Undo:this._scribbler.undo_();break;case BUT.Redo:this._scribbler.redo_();break;case BUT.OK:this._okCallback(this._canvas,this._scribbler.history_(),t=>{t&&this.close_()});break;case BUT.Cancel:DialogUt.confirmKeySmall_(this._container,RS.ConfirmDiscard,An.above_(this._dialog),t=>{t&&this.cancel_()})}}cancel_(){var t;null===(t=this._cancelCallback)||void 0===t||t.call(this),this.close_()}_updateToolbarState(t){An.enableButton_(this._toolbar.button_(BUT.Redo),t.redoOK_()),An.enableButton_(this._toolbar.button_(BUT.Undo),t.undoOK_()),An.enableButton_(this._toolbar.button_(BUT.Move),!t.isEmpty_())}showFullscreen_(){this._showing=!0;const t=this.onResize_();null==this._scribbler&&(this._scribbler=new Scribbler(this._canvas,t,this._handler),this._scribbler.addHistoryListener_(t=>this._updateToolbarState(t)),this._scribbler.onExport_((t,e)=>this._onScribblerExport(t,e)),this._scribbler.setBGColor_(this._bgColor),this._scribbler.setBGImage_(this._bgImageCallback),this._contextmenu=new ScribblerContextmenu(this._container,this._buttonSize,this._dpi,this._handler.getSettings_(),this._scribbler),this._contextmenu.onAction_(t=>this._contextActions(t)),this._contextmenu.onPromptColor_(this._promptColorCallback),this._contextmenu.onTooltips_(toasters$.onTooltipsKey_),this._scribbler.setStateChangeListener_(t=>this._onScribblerStateChange(t))),null!=this._history&&this._scribbler.addHistory_(this._history),this._scribbler.refresh_(),this._updateToolbarState(this._scribbler.history_())}_onScribblerStateChange(t){switch(t){case ScribblerState.IDLE:this._toolbar.enable_(!0);break;case ScribblerState.MOVE:case ScribblerState.TEXT:this._toolbar.enable_(!1);break;default:throw Assert.notReach_(`${t}`)}}_onScribblerExport(t,e){if(null==this._contextmenu||t!=ScribblerContextActions.export)return;let i;if(null!=this._srcPath){const t=new Basepath(this._srcPath),e=PathUtil.createOutputImageExt(t);i=t.sibling_(e).path$}else i=PathUtil.getHomeDir(!1)+An.simpleDateTimeString_()+".jpg";this._handler.promptExportImage_(i,e.width,e.height,DEF.jpegQualityHigh,An.above_(this._contextmenu.element_()),t=>{var i;let n;const s=MimeUtil.imageMimeFromPath(t.filepath);if(null!=s){if(e.width==this._canvas.width&&e.height==this._canvas.height&&t.width==this._canvas.width&&t.height==this._canvas.height&&0==t.rotation)n=this._canvas.toDataURL(s,t.quality/100);else{let i;const o=this._canvas.ownerDocument;switch(t.rotation){case 0:(i=o.createElement("canvas")).width=t.width,i.height=t.height,i.getContext("2d").drawImage(this._canvas,e.left,e.top,e.width,e.height,0,0,t.width,t.height);break;case 90:{(i=o.createElement("canvas")).width=t.height,i.height=t.width;const n=t.width/e.width,s=t.height/e.height,l=i.getContext("2d");l.translate(t.height,0),l.rotate(Math.PI/2),l.scale(n,s),l.drawImage(this._canvas,e.left,e.top,e.width,e.height,0,0,e.width,e.height);break}case 180:{(i=o.createElement("canvas")).width=t.width,i.height=t.height;const n=t.width/e.width,s=t.height/e.height,l=i.getContext("2d");l.translate(t.width,t.height),l.rotate(Math.PI),l.scale(n,s),l.drawImage(this._canvas,e.left,e.top,e.width,e.height,0,0,e.width,e.height);break}case 270:{(i=o.createElement("canvas")).width=t.height,i.height=t.width;const n=t.width/e.width,s=t.height/e.height,l=i.getContext("2d");l.translate(0,t.width),l.rotate(-Math.PI/2),l.scale(n,s),l.drawImage(this._canvas,e.left,e.top,e.width,e.height,0,0,e.width,e.height);break}default:throw Assert.notReach_(`${t.rotation}`)}n=i.toDataURL(s,t.quality/100)}this._handler.saveImage_(t.cpath,n,t=>{var e;const i=t[Key.errors];null!=i?this._handler.warn_(i):(null===(e=this._contextmenu)||void 0===e||e.hide_(),this._handler.ok_(MSG.string_(RS.Scribbler_ExportImageOK)))})}else toasters$.warn_(MSG.string_(RS.invalidImageExt_)+Basepath.suffix_(null!==(i=t.filepath)&&void 0!==i?i:""))})}onResize_(){const t=this._width,e=this._height,i=window.innerWidth,n=window.innerHeight,s=this._toolbar.element_().clientHeight,o=i-2*ImageAnnotator.PADDING,l=n-s-2*ImageAnnotator.PADDING;An.setRectangle_(this._content,ImageAnnotator.PADDING,s+ImageAnnotator.PADDING,o,l);const a=this._canvas.style,r=3*n/4;a.marginBottom=`${r}px`;let _=1;o>t+2&&(_=(o-t)/2),a.marginTop="1px",a.marginRight="1px",a.marginLeft=`${_}px`;const c=new Point(_,-(e+r));return null!=this._scribbler&&this._scribbler.onresize_(c),this._showing&&(this._showing=!1,An.setVisible_(this._dialog)),c}setInitialFocus_(){}_contextActions(t){if(null!=this._scribbler&&null!=this._contextmenu)switch(t){case DEF.NOOP:return;case ScribblerContextActions.fit:{this._contextmenu.hide_();const t=this._scribbler.history_().getBoundingRect_(),e=new CompositeDialog(this._container,[new InputSelectField(RS.Margin,ImageAnnotator.XMARGIN,"50",RS.PlaceholderRequired,CSSLength.PX,[CSSLength.PX])]);return e.titleKey_(RS.Fit),e.message_(MSG.string_(RS.Dimensions)+`: ${t.width}x${t.height}`),e.above_(this._contextmenu.element_()),e.onOK_((e,i)=>{var n,s;const o=e.getValueAt_(0),l=An.parseIntPx_(o,-1),a=sarray_();if(l<0&&a.push(MSG.format2_(RS.invalidNameValue,MSG.string_(RS.Margin),o)),a.length>0)return e.warn_(a),void i(!1);i(!0);const r=t.left-l,_=t.top-l,c=t.width+2*l,h=t.height+2*l;null===(n=this._scribbler)||void 0===n||n.history_().shift_(-r,-_),this._width=c,this._height=h,this._canvas.width=c,this._canvas.height=h,null===(s=this._scribbler)||void 0===s||s.resize_(),this.onResize_(),this._setaction(ScribblerAction.CURVE)}),void e.show_()}case ScribblerContextActions.shift:return this._contextmenu.hide_(),void Timer.sleep1_(()=>{var t;null===(t=this._scribbler)||void 0===t||t.shift_(()=>{this._setaction(ScribblerAction.CURVE)})});case ScribblerContextActions.resize:{this._contextmenu.hide_();const t="#XL8",e="#X9u",i="#Xo6",n=new CompositeDialog(this._container,[new Input2FIeld("",e,",",this._buttonSize,RS.PlaceholderRequired,t,`${this._width}`,"x",RS.PlaceholderRequired,i,`${this._height}`,CSSLength.PX)]);return n.titleKey_(RS.Resize),n.message_(MSG.string_(RS.OriginalSize)+`: ${this._width}x${this._height}`),n.above_(this._contextmenu.element_()),n.onOK_((t,e)=>{var i;const n=sarray_(),s=t.getValueAt_(0,0),o=t.getValueAt_(0,1);let l=An.parseInt_(s,-1),a=An.parseInt_(o,-1);if(l<0&&n.push(MSG.format2_(RS.invalidNameValue,MSG.string_(RS.Width),s)),a<0&&n.push(MSG.format2_(RS.invalidNameValue,MSG.string_(RS.Height),o)),n.length>0&&(t.warn_(n),e(!1)),e(!0),l*a>DEF.maxOutputImageArea){const t=MediaUtil.limitImageArea_(l,a);l=t.x,a=t.y,this._handler.warn_(MSG.string1_(RS.imageDimensionLimit_,`${l}x${a}`))}this._canvas.width==l&&this._canvas.height==a||(this._width=l,this._height=a,this._canvas.width=l,this._canvas.height=a,null===(i=this._scribbler)||void 0===i||i.resize_(),this.onResize_(),this._setaction(ScribblerAction.CURVE))}),void n.show_()}case ScribblerContextActions.export:return this._contextmenu.hide_(),this._handler.info_(MSG.string_(RS.Tooltips_SelectAnAreaToExport)),void this._setaction(t);case ScribblerContextActions.clear:return void DialogUt.confirmKeySmall_(this._container,RS.ImageAnnotator_ConfirmClearMessage,An.above_(this._contextmenu.element_()),t=>{var e,i;t&&(null===(e=this._scribbler)||void 0===e||e.clear_(),null===(i=this._contextmenu)||void 0===i||i.hide_(),this._setaction(ScribblerAction.CURVE))});case ScribblerContextActions.history:return this._contextmenu.hide_(),void new PromptScribblerHistory(this._container,this._buttonSize,this._scribbler).titleKey_(RS.PromptScribblerHistoryTitle).zindex_(DEF.zindexPrompt).onEditText_(this._promptEditTextCallback).show_();case ScribblerContextActions.BG:{if(null==this._promptColorCallback)return;const t=this._promptColorCallback(this._buttonSize,An.above_(this._contextmenu.element_()),this._scribbler.getBGColor_().toRgbaString_(),ColorValue.X_TRANSPARENT);return t.onOK_((t,e)=>{var i,n,s;null!=t&&(null===(i=this._contextmenu)||void 0===i||i.hide_(),null===(n=this._scribbler)||void 0===n||n.setBGColor_(t),null===(s=this._scribbler)||void 0===s||s.refresh_())}),void t.show_()}case ScribblerContextActions.EMBEDED_IMAGE:case ScribblerContextActions.IMAGE:return this._handler.info_(MSG.string_(RS.Tooltips_SelectAnAreaForImport)),void this._setaction(t);case ScribblerContextActions.CURVE:case ScribblerContextActions.ELLIPSE:case ScribblerContextActions.POLYCURVE:case ScribblerContextActions.POLYGON:case ScribblerContextActions.RECTANGLE:case ScribblerContextActions.TEXT:case ScribblerContextActions.more:return void this._setaction(t);default:throw Assert.notReach_(t)}}_setaction(t){var e,i,n;const s=null!==(i=null===(e=this._contextmenu)||void 0===e?void 0:e.getButton_(t))&&void 0!==i?i:null;if(null!=s){if(!(null===(n=this._contextmenu)||void 0===n?void 0:n.setAction_(t,s)))return;this._canvas.style.cursor="default"}}}_destroyed_6=new WeakMap,ImageAnnotator.PADDING=10,ImageAnnotator.XMARGIN="#XbL";class PromptOKFixedSize extends FixedSizeDialogBase{constructor(t,e,i){super(t,i),this._width=e,this._okCallback=null,super.init_(this.create_(t))}create_(t){return this._createDialogWithoutStatus(t,t=>this._createContent(t),BUT.infosOKCancel,t=>this._toolbarActions(t))}close_(){this._okCallback=null,super.close_()}_createContent(t){new DomBuilderEx(t).div_({style:`width:${this._width}px`})}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.OK:this._okCallback(t=>{t&&this.close_()});break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}}class PromptCalc extends FixedSizeDialogBase{constructor(t,e){super(t,e),this._x=null,this._y=null,this._okCallback=null,this._initialValue=!1,super.init_(this.create_(t))}_allowTouchmove(){return!0}create_(t){return this._createDialogWithContentOnly(t,t=>this._createContent(t))}_createContent(t){const e=new DomBuilderEx(t),i=7*this._buttonSize,n=5*this._buttonSize;this._width=n,e.push_().div_({class:CSS.AnFlex,style:`flex-flow:column nowrap; width:${this._width}px;`}).push_().cursor_(),this._input=e.textarea_({class:CSS.AnCalcDisplay,readonly:"true",style:"-webkit-user-select:none !important"}).cursor_();const s=e.peek_().div_({class:CSS.AnFlex,style:`flex-flow: row wrap; width: ${n}px; height: ${i}px; margin:5px 10px 0px 10px;`}).push_().cursor_(),o=[[PromptCalc._CLEAR," ",PromptCalc._NAGATE,PromptCalc._BACKSPACE],["7","8","9","/"],["4","5","6","*"],["1","2","3","-"],["e","0",".","+"],[PromptCalc._EQUAL,PromptCalc._INT,PromptCalc._DOLLAR,PromptCalc._OK]],l=`${CSS.AnCalcCell} ${CSS.AnCalcDigit}`,a=`${CSS.AnCalcCell} ${CSS.AnCalcOp}`;for(let t=0;t<6;++t)for(let i=0;i<4;++i){const n=o[t][i];if(0==n.length)continue;const s=n.length>1||"1234567890".indexOf(n)<0;e.peek_().div_({class:s?a:l}).text_(n)}this._input.value="",new Flash(s,`div.${CSS.AnCalcCell}`,CSS.AnFlashLowlight,DEFUtil.flashDuration),An.onClick_(this._input,t=>{An.stopevent_(t)}),An.addEventListenerMatching_(s,Conf.touchstart,`div.${CSS.AnCalcCell}`,(t,e)=>{var i;An.stopevent_(e);const n=null!==(i=t.textContent)&&void 0!==i?i:"";this._handle(n,e)}),An.onKeypress_(this._input,t=>{An.stopevent_(t);const e=this._getlabel(t);null!=e&&this._handle(e,t)})}close_(){this._okCallback=null,super.close_()}value_(t){const e=An.parseDouble_(t,0);this._input.value=0==this._rounding(e)?"0":t,this._initialValue=!0}at_(t,e){this._x=t,this._y=e}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}_actionOK(t,e){let i=null;if(null!=t&&t.length>0)try{const n=new _Calculator(t).run();if(null!=n)switch(e){case PromptCalc._INT:i=Math.round(n).toString();break;case PromptCalc._DOLLAR:i=n.toFixed(2);break;default:i=n.toString()}}catch(t){return void this._onerror(t)}const n=this._okCallback;this.close_(),n(null==i?"":i)}onSmokescreenCreated_(t){super.onSmokescreenCreated_(t),t.on_(Conf.touchstart,t=>{An.stopevent_(t),this._actionOK("","")})}show_(){return this.showAt_(this._x,this._y)}_getlabel(t){const e=t.charCode;if(e>=PromptCalc._zero&&e<=PromptCalc._nine||e==PromptCalc._ue||e==PromptCalc._le||e==PromptCalc._dot||e==PromptCalc._plus||e==PromptCalc._minus||e==PromptCalc._mult||e==PromptCalc._div||e==PromptCalc._clear||e==PromptCalc._clear+32||e==PromptCalc._negate||e==PromptCalc._equal||e==PromptCalc._int||e==PromptCalc._dollar)return String.fromCharCode(e);switch(t.code){case"Backspace":return PromptCalc._BACKSPACE;case"Enter":return PromptCalc._OK;default:return null}}_handle(t,e){this._busy?Timer.sleep0_(()=>{this._handle(t,e)}):(this._handle1(t,e),this._initialValue=!1)}_handle1(t,e){var i,n,s;this._busy=!0;try{this._input.classList.remove(CSS.xRed);let o=this._input.value,l=o.length,a=l;switch(t){case" ":break;case PromptCalc._BACKSPACE:if(l==a){if(0==l)break;--l}this._input.value=this._insert(o,l,a,""),a=l;break;case PromptCalc._INT:case PromptCalc._DOLLAR:case PromptCalc._OK:An.stopevent_(e),this._actionOK(this._input.value,t);break;case PromptCalc._CLEAR:case PromptCalc._CLEAR_LC:this._input.value="",l=0,a=0;break;case PromptCalc._EQUAL:try{const t=new _Calculator(o).run();null!=t&&(this._input.value=this._rounding(t).toString(),a=l=this._input.value.length);break}catch(e){this._onerror(e)}break;case PromptCalc._NAGATE:{let t=o.length-1;for(;t>=0;--t){const e=o.codePointAt(t);if(!(e==PromptCalc._dot||e==PromptCalc._le||e==PromptCalc._ue||void 0!==e&&e>=PromptCalc._zero&&e<=PromptCalc._nine)){if((e==PromptCalc._plus||e==PromptCalc._minus)&&t>0){const e=o.codePointAt(t-1);if(e==PromptCalc._le||e==PromptCalc._ue)continue}break}}const e=null!==(i=t>=0?o.codePointAt(t):null)&&void 0!==i?i:null,s=null!==(n=t>0?o.codePointAt(t-1):null)&&void 0!==n?n:null;t<0||45!=e&&this._isoperator(e)||t>0&&45==e&&!this._isoperator(s)?o=this._insert(o,t+1,t+1,"-"):(0==t||this._isoperator(s))&&(o=this._insert(o,t,t+1,"")),this._input.value=o,a=l=o.length;break}case"+":case"-":case"*":case"/":case"e":this._input.value=this._insert(o,l,a,t),a=++l;break;default:if(this._initialValue){const e=null!==(s=t.codePointAt(0))&&void 0!==s?s:null;(e==PromptCalc._dot||null!=e&&e>=PromptCalc._zero&&e<=PromptCalc._nine)&&(this._input.value=t,l=1,a=1),this._initialValue=!1}else this._input.value=this._insert(o,l,a,t),a=++l}}finally{this._busy=!1}}_rounding(t){return Math.round(1e6*t)/1e6}setInitialFocus_(){null!=this._input&&this._input.blur()}_isoperator(t){return 42==t||43==t||45==t||47==t}_insert(t,e,i,n){return t.substring(0,e)+n+t.substring(i)}_onerror(t){toasters$.warn_(t.message),this._input.classList.add(CSS.xRed)}}PromptCalc._plus=43,PromptCalc._minus=45,PromptCalc._mult=42,PromptCalc._div=47,PromptCalc._dot=46,PromptCalc._clear=67,PromptCalc._negate=126,PromptCalc._equal=61,PromptCalc._int=35,PromptCalc._dollar=36,PromptCalc._zero=48,PromptCalc._nine=57,PromptCalc._ue=69,PromptCalc._le=101,PromptCalc._CLEAR="C",PromptCalc._CLEAR_LC="c",PromptCalc._NAGATE="~",PromptCalc._EQUAL="=",PromptCalc._BACKSPACE="<=",PromptCalc._INT="#",PromptCalc._DOLLAR="$",PromptCalc._OK="OK";class _Calculator{constructor(t){this._value=t,this._operandStack=[],this._operatorStack=[],this._positionStack=[],this._scanner=new StringScanner(t)}run(){if(0==this._value.length)return null;const t=_Calculator.FASTPATH.exec(this._value);if(null!=t){let e=An.parseDouble_(t[2],null);if(null==e)throw new Error("Invalid value");return"-"==t[1]&&(e=-e),e}let e=!0;for(;!this._scanner.isDone$;e=!1){this._scanner.expect_(_Calculator.OPERATOR,MSG.string_(RS.Operator));const t=this._scanner.lastMatch$[1];let i=!1,n=null;if(t.length>0){n=t[0];for(let e=1,n=t.length;e<n;++e)"-"!=t[e]&&this._scanner.error_(MSG.string_(RS.InvalidOperator)),i=!i;e&&"-"==n&&(i=!i,n=null)}else e||this._scanner.error_(MSG.string_(RS.ExpectingAnOperator));this._scanner.expect_(_Calculator.OPERAND,MSG.string_(RS.Operand));const s=this._scanner.lastMatch$[1];let o=An.parseDouble_(s,null);if(null==o)throw new Error(MSG.string_(RS.InvalidOperand)+": "+s);if(o=i?-o:o,null!=n)switch(n){case"*":case"/":{const t=this._getoperand(n,this._scanner.position$);"/"==n&&0==o&&this._scanner.error_(MSG.string_(RS.DivideByZeroError)),this._operandStack.push("*"==n?t*o:t/o);break}case"+":case"-":this._flush(),this._operatorStack.push(n),this._positionStack.push(this._scanner.position$),this._operandStack.push(o)}else this._operandStack.push(o)}if(this._flush(),1==this._operandStack.length)return this._operandStack[0];throw new Error(MSG.string_(RS.InvalidExpression))}_flush(){for(;0!=this._operatorStack.length;){const t=this._operatorStack.pop(),e=this._positionStack.pop(),i=this._getoperand(t,e),n=this._getoperand(t,e);this._operandStack.push("+"==t?n+i:n-i)}}_getoperand(t,e){if(0==this._operandStack.length)throw new Error(MSG.string1_(RS.MissingOperandFor_,t)+`: position=${e}`);return this._operandStack.pop()}}_Calculator.SPACES=new RegExp("\\s*"),_Calculator.OPERATOR=new RegExp("([-+*/]*)"),_Calculator.OPERAND=new RegExp("([\\d.]+([eE][-+]?\\d+)?)"),_Calculator.FASTPATH=new RegExp("^(-+)?([\\d.]+([eE][-+]?\\d+)?)$");class PromptDate extends FixedSizeDialogBase{constructor(t,e,i,n,s){super(t,s),this._now=e,this._initialDate=i,this._tabs=n,this._dateFormat=DateFormat.DEF,this._timeFormat=TimeFormat.DEF,this._defaultFormat=null,this._okCallback=null,_destroyed_7.set(this,!1),super.init_(this.create_(t))}get hasDatePanel$(){return 0!=(this._tabs&PromptDate.DATE)}get hasTimePanel$(){return 0!=(this._tabs&PromptDate.TIME)}get datePanel$(){return this._datePanel}get timePanel$(){return this._timePanel}get dateFormat$(){return this._dateFormat}get timeFormat$(){return this._timeFormat}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),[BUT.info_(BUT.Today),BUT.info_(BUT.TargetDate),BUT.info_(BUT.OK),BUT.info_(BUT.Cancel)],t=>this._toolbarActions(t))}_createContent(t){const e=new DomBuilderEx(t);this._width=7*this._buttonSize,e.push_().div_({class:CSS.AnFlex,style:`flex-flow: column nowrap;  width: ${this._width}px;`+` padding-top: 5px; border-top:${DEF.themeBorder};`}).push_().cursor_(),this._createTabpanel(e)}close_(){__classPrivateFieldGet(this,_destroyed_7)||(__classPrivateFieldSet(this,_destroyed_7,!0),this._timePanel.destroy(),this._okCallback=null,super.close_())}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}dateFormat_(t){return this._dateFormat=DateFormat.validate(t,DateFormat.DEF),this}timeFormat_(t){return this._timeFormat=TimeFormat.validate(t,TimeFormat.DEF),this}defaultFormat(t){return this._defaultFormat=t,this}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.Today:this._datePanel.refresh(this._now),this._timePanel.refresh(this._now),this._formatPanel.refresh();break;case BUT.TargetDate:this._datePanel.refresh(this._initialDate),this._timePanel.refresh(this._initialDate),this._formatPanel.refresh();break;case BUT.OK:this._actionOK();break;case BUT.Cancel:this.actionCancel_(),this.close_();break;default:this.actionInvalid_(t)}}_actionOK(){const t=this.hasDatePanel$?this._datePanel._selectedDate:null,e=this.hasTimePanel$?this._timePanel._date:null,i=DateTime.local_(null==t?0:t.year$,null==t?1:t.month$,null==t?1:t.day$,null==e?0:e.hour$,null==e?0:e.minute$,0);let n="",s="",o="",l="";if(0!=(this._tabs&PromptDate.FORMAT)){this._formatPanel.refresh();const t=this._formatPanel._inputDateFormat.getLabel_(""),e=this._formatPanel._inputTimeFormat.getLabel_("");n=this._formatPanel._inputDateFormat.getValue_(""),s=this._formatPanel._inputTimeFormat.getValue_(""),l=this._formatPanel._inputTooltipsFormat.getValue_(""),o=0==t.length?e:0==e.length?t:t+" "+e}const a=this._okCallback;this.close_(),a(i,n,s,o,l)}_hourFormatter(t){const e=0==this._timeFormat.length?TimeFormat.DEF:this._timeFormat;return TimeFormat.hourString(e,t)}_createTabpanel(t){const e=t.peek_().div_({}).cursor_();this._tabPanel=new TabPanel(e,!0);let i=null;0!=(this._tabs&PromptDate.DATE)&&(this._dateTab=this._tabPanel.addTab(RS.Tooltips_DatePicker,`${CSS.Fa} ${CSS.FaCalendar}`,t=>this._datePanel=new _DatePanel(t,this._now,this._initialDate,this._buttonSize,()=>this._actionOK())),i=this._dateTab),0!=(this._tabs&PromptDate.TIME)&&(this._timeTab=this._tabPanel.addTab(RS.Tooltips_TimePicker,`${CSS.Fa} ${CSS.FaClockO}`,t=>this._timePanel=new _TimePanel(t,this._initialDate,t=>this._hourFormatter(t),this._buttonSize)),null==i&&(i=this._timeTab)),0!=(this._tabs&PromptDate.FORMAT)&&(this._formatTab=this._tabPanel.addTab(RS.Tooltips_DateFormat,`${CSS.Fa} ${CSS.FaQuoteLeft}`,t=>this._formatPanel=new _DateFormatPanel(t,this)),null==i&&(i=this._formatTab)),this._tabPanel.onTooltips(toasters$.onTooltipsKey_),this._tabPanel.activeTab(i)}showTab_(t){if(t==PromptDate.DATE?(this._tabPanel.selectTab(this._dateTab),null==this._defaultFormat&&(this._defaultFormat=PromptDate.DATE)):t==PromptDate.TIME?(this._tabPanel.selectTab(this._timeTab),null==this._defaultFormat&&(this._defaultFormat=PromptDate.TIME)):t==PromptDate.FORMAT&&this._tabPanel.selectTab(this._formatTab),null!=this._formatPanel)switch(this._formatPanel.refresh(),this._defaultFormat){case PromptDate.DATE:this._formatPanel._inputDateFormat.setValue_(this._dateFormat),this._formatPanel._inputTimeFormat.setValue_("");break;case PromptDate.TIME:this._formatPanel._inputDateFormat.setValue_(""),this._formatPanel._inputTimeFormat.setValue_(this._timeFormat);break;default:this._formatPanel._inputDateFormat.setValue_(this._dateFormat),this._formatPanel._inputTimeFormat.setValue_(this._timeFormat)}return super.show_()}show_(){var t;return null===(t=this._tabPanel.activePanel())||void 0===t||t.show_(),super.show_()}setInitialFocus_(){An.focus_(this._toolbar.button_(BUT.OK))}}_destroyed_7=new WeakMap,PromptDate.ALL=7,PromptDate.DATE=1,PromptDate.TIME=2,PromptDate.FORMAT=4;class _DatePanel extends UIPanelBase{constructor(t,e,i,n,s=null){super(),this._container=t,this._today=e,this._initialDate=i,this._selectedCell=null,this._listener=null,this._selectedDate=this._initialDate,this._startDate=this._getstartdate(this._selectedDate);const o=n,l=2*n,a=6*n,r=7*n,_=new DomBuilderEx(t).push_();_.div_({class:CSS.AnFlex,style:"padding-top: 5px; padding-bottom:5px; "}).push_(),this._buttonPrevYear=_.div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronLeft).cursor_(),this._inputYear=_.peek_().child_(Conf.input,{class:CSS.AnPromptInput,style:`width: ${l}px;text-align:center;`,rows:"1",tabindex:"1"}).cursor_(),this._buttonNextYear=_.peek_().div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronRight).cursor_(),this._buttonPrevMonth=_.peek_().div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronLeft).cursor_(),this._inputMonth=_.peek_().child_(Conf.input,{class:CSS.AnPromptInput,style:`width: ${o}px;text-align:center;`,rows:"1",tabindex:"2"}).cursor_(),this._buttonNextMonth=_.peek_().div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronRight).cursor_(),_.pop_(),this._dateContainer=_.peek_().div_({class:CSS.AnCalBody,style:`flex-flow: row wrap; width: ${r}px; height: ${a}px; padding-bottom: 4px;`}).push_().cursor_(),An.addClickListenerMatching_(this._dateContainer,"div",(t,e)=>{An.stopevent_(e);const i=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);if(i>=0){const e=t==this._selectedCell;if(null!=this._selectedCell&&this._selectedCell.classList.remove(CSS.AnDateSelected),this._selectedCell=t,this._selectedCell.classList.add(CSS.AnDateSelected),this._selectedDate=this._startDate.add_(i*DateTime.DAY),this._inputYear.value=`${this._selectedDate.year$}`,this._inputMonth.value=`${this._selectedDate.month$}`,e&&null!=s){const t=s;s=null,t()}}}),An.onInputChange_(An.onInputFocusSelect_(this._inputYear),t=>{An.stopevent_(t);const e=this._selectedDate.year$,i=An.parseInt_(this._inputYear.value,e);this._inputYear.value=`${e}`,i!=e&&this.refresh(DateTime.local_(i,this._selectedDate.month$,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onInputChange_(An.onInputFocusSelect_(this._inputMonth),t=>{An.stopevent_(t);const e=this._selectedDate.month$,i=An.parseInt_(this._inputMonth.value,e);this._inputMonth.value=`${e}`,i!=e&&this.refresh(DateTime.local_(this._selectedDate.year$,i,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonNextYear,t=>{An.stopevent_(t),this.refresh(DateTime.local_(this._selectedDate.year$+1,this._selectedDate.month$,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonPrevYear,t=>{An.stopevent_(t),this.refresh(DateTime.local_(this._selectedDate.year$-1,this._selectedDate.month$,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonNextMonth,t=>{An.stopevent_(t),this.refresh(DateTime.local_(this._selectedDate.year$,this._selectedDate.month$+1,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonPrevMonth,t=>{An.stopevent_(t),this.refresh(DateTime.local_(this._selectedDate.year$,this._selectedDate.month$-1,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))})}element_(){return this._container}show_(){this._shown||(this._shown=!0,this.refresh(this._selectedDate),An.show_(this._container))}refresh(t){this._selectedDate=t,this._inputYear.value=this._selectedDate.year$.toString(),this._inputMonth.value=An.to02d_(this._selectedDate.month$),this._startDate=this._getstartdate(this._selectedDate),this._selectedCell=_DatePanel.populate(this._dateContainer,this._today,this._selectedDate,this._startDate)}_getstartdate(t){let e=t.subtract_((t.day$-1)*DateTime.DAY);return 7==e.weekday$?e:e.subtract_(e.weekday$*DateTime.DAY)}static populate(t,e,i,n){const s=An.simpleDateString_(e),o=null==i?null:An.simpleDateString_(i),l=i.month$,a=DateTime.DAY,r=new DomBuilderEx(t).empty_().push_();let _=null;for(let t=0;t<6;++t)for(let e=0;e<7;++e){const i=7*t+e,c=sarray_(),h=n.weekday$;n.month$==l?6!=h&&7!=h||c.push(CSS.AnDateHoliday):c.push(CSS.AnGray);const u=An.simpleDateString_(n);u==s&&(ArrayUt.delete_(c,CSS.AnDateHoliday),c.push(CSS.AnBold)),u==o&&c.push(CSS.AnDateSelected);const d=r.peek_().div_(["class",c.join(" ")],[ATTR.AnInfo,i.toString()]).text_(n.day$.toString()).cursor_();u==o&&(_=d),n=n.add_(a)}return _}}class _TimePanel extends UIPanelBase{constructor(t,e,i,n){super(),this._shown=!1,_destroyed_8.set(this,!1),this._container=t,this._date=e,this._hourFormatter=i,this._buttonsize=n,this._x4=4*n;const s=new DomBuilderEx(t).push_();this._d2=n/2;const o=n,l=2*n,a=5*n,r=6*n,_=7*n;s.peek_().div_({class:CSS.AnFlexCenter,style:"padding-top: 5px; padding-bottom:5px; "}).push_(),s.peek_().div1_(CSS.AnFlex11Auto),this._hourInput=s.peek_().div_({style:`width:${l}px;text-align:center`}).cursor_(),s.peek_().div_({class:CSS.AnFlexCenter,style:`width:${this._d2}px;height:${o}px;`}).text_(":"),this._minuteInput=s.peek_().div_({style:`width:${l}px;text-align:center`}).cursor_(),s.peek_().div1_(CSS.AnFlex11Auto),s.pop_(),s.peek_().div_({class:CSS.AnFlex,style:`width:${_}px;height:${r}px;padding-top:${this._d2}px; padding-bottom:${o-this._d2+4}px;`}).push_(),s.peek_().div_({style:`flex:1 1 ${this._d2}px`}).peek_(),this._hourSlider=new Slider(s.cursor_(),a,this._d2,this._d2,this._d2,!0),this._marker(s),this._minuteSlider=new Slider(s.cursor_(),a,this._d2,this._d2,this._d2,!0),s.peek_().div_({style:`flex:1 1 ${this._d2}px`}),s.pop_(),this._hourSlider.onDrag_(t=>{this._sethour1(this._date.hour$+t)}),this._hourSlider.onClick_(t=>{const e=Math.round(23*t/this._x4);t=this._pxfrompx(23,t),this._sethour(e,t)}),this._minuteSlider.onDrag_(t=>{this._setminute1(this._date.minute$+t)}),this._minuteSlider.onClick_(t=>{t=this._pxfrompx(59,t);const e=Math.round(59*t/this._x4);this._setminute(e,t)})}_sethour1(t){if(null==t)return;t=t<0?0:t>23?23:t;const e=this._pxfromvalue(23,t);this._sethour(t,e)}_sethour(t,e){this._date=DateTime.local_(this._date.year$,this._date.month$,this._date.day$,t,this._date.minute$,this._date.second$),this._hourSlider.setPosition_(e),this._sethourvalue(t)}_sethourvalue(t){this._hourInput.textContent=this._hourFormatter(t)}_setminute1(t){t=Math.max(0,Math.min(59,t));const e=this._pxfromvalue(59,t);this._setminute(t,e)}_setminute(t,e){this._date=DateTime.local_(this._date.year$,this._date.month$,this._date.day$,this._date.hour$,t,this._date.second$),this._minuteInput.textContent=`${t}`,this._minuteSlider.setPosition_(e)}_pxfrompx(t,e){const i=this._x4/t;return Math.round(e/i)*i}_pxfromvalue(t,e){return Math.round(e*this._x4/t)}show_(){this._shown||(this._shown=!0,this.refresh(this._date),An.show_(this._container))}destroy(){__classPrivateFieldGet(this,_destroyed_8)||(__classPrivateFieldSet(this,_destroyed_8,!0),this._hourSlider.destroy_(),this._minuteSlider.destroy_())}element_(){return this._container}refresh(t){this._date=t,this._sethourvalue(this._date.hour$),this._minuteInput.textContent=An.to02d_(this._date.minute$);const e=Math.round(this._date.hour$*this._x4/23),i=Math.round(this._date.minute$*this._x4/59);this._hourSlider.setPosition_(e),this._minuteSlider.setPosition_(i)}_marker(t){const e=this._buttonsize/2,i=2*this._buttonsize,n=4*this._buttonsize;t.peek_().push_().div_({class:CSS.AnFlex,style:`flex-basis:${i-e}px;flex-flow:column nowrap;align-items:stretch;height:${n}px`}).push_();for(let e=0;e<3;++e)t.peek_().div_({style:`flex-basis:${DEF.BASIS_25}%;box-sizing: border-box;border-top:${DEF.themeBorder};`});t.peek_().div_({style:`flex-basis:${DEF.BASIS_25}%;box-sizing:border-box;border-top:${DEF.themeBorder};border-bottom:${DEF.themeBorder};`}),t.pop_(2)}}_destroyed_8=new WeakMap;class _DateFormatPanel extends UIPanelBase{constructor(t,e){super(),this._container=t,this._dialog=e,this._shown=!1;const i=e.buttonSize$,n=new DomBuilderEx(t).push_(),s=i,o=7*i;n.peek_().div_({class:CSS.AnFlex,style:`width:${o}px; height:${o+2*_DateFormatPanel._PADDING}px;`+`padding-bottom:${s+4}px;`+"flex-wrap:wrap;align-items:flex-start;align-content:flex-start;"}).push_(),n.peek_().div_({class:CSS.AnHeading,sytle:`width:${o}px;margin-top:1ex;overflow:hidden;`}).text_(MSG.string_(RS.DateFormat)),this._inputDateFormat=new SelectOptions(accessories$,n.peek_().div_({class:`${CSS.AnPromptSelect} ${CSS.AnMarginTop5}`,style:`width:${o}px;margin: 5px 1px;`}).cursor_()),this._inputTimeFormat=new SelectOptions(accessories$,n.peek_().div_({class:`${CSS.AnPromptSelect} ${CSS.AnMarginTop5}`,style:`width:${o}px;margin: 5px 1px;`}).cursor_()),n.peek_().div_({class:CSS.AnHeading,sytle:`width:${o}px;margin-top:1ex;overflow:hidden;`}).text_(MSG.string_(RS.Tooltips)),this._inputTooltipsFormat=new SelectOptions(accessories$,n.peek_().div_({class:CSS.AnPromptSelect,style:`width:${o}px;margin: 5px 1px;`}).cursor_())}element_(){return this._container}show_(){this._shown||(this._shown=!0,this.refresh(),An.show_(this._container))}refresh(){let t=null;if(this._dialog.hasDatePanel$?(t=this._dialog.datePanel$._selectedDate,_DateFormatPanel._populateDateFormat(this._inputDateFormat,t,this._dialog.dateFormat$)):this._inputDateFormat.setOptions_([]),this._dialog.hasTimePanel$?(t=this._dialog.timePanel$._date,_DateFormatPanel._populateTimeFormat(this._inputTimeFormat,t,this._dialog.timeFormat$)):this._inputTimeFormat.setOptions_([]),null!=t){let e=this._inputTooltipsFormat.getSelectedIndex_();e<0&&e>=2&&(e=0),this._inputTooltipsFormat.setOptions_(["",An.simpleDateTimeString_(t)],null,e)}}static _populateDateFormat(t,e,i){const n=t.getSelectedIndex_(),s=sarray_();let o=-1;for(let t of DateFormat.LIST){const n=DateFormat.dateString(t,e);t==i&&(o=s.length),s.push(n)}n>=0&&n<DateFormat.LIST.length&&(o=n),t.setOptions_(DateFormat.LIST,s,o)}static _populateTimeFormat(t,e,i){const n=sarray_();for(let t of TimeFormat.LIST)n.push(TimeFormat.timeString(t,e));let s=t.getSelectedIndex_();(s<0||s>=n.length)&&(s=TimeFormat.LIST.indexOf(i)),t.setOptions_(TimeFormat.LIST,n,s)}}_DateFormatPanel._PADDING=5;class PromptCalendar extends FixedSizeDialogBase{constructor(t,e){super(t,e),this._today=DateTime.now_(),this._okCallback=null,this._dateFormat=DateFormat.DEF,_destroyed_9.set(this,!1),super.init_(this.create_(t))}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),[BUT.info_(BUT.Today),BUT.info_(BUT.OK),BUT.info_(BUT.Cancel)],t=>this._toolbarActions(t))}_createContent(t){const e=new DomBuilderEx(t);this._width=7*this._buttonSize,e.push_().div_({class:CSS.AnFlex,style:"flex-flow:column nowrap;padding-top:5px;"+`width:${this._width}px;border-top:${DEF.themeBorder};`}).push_().cursor_(),this._createTabpanel(e)}_createTabpanel(t){const e=t.peek_().div_({}).cursor_();this._tabPanel=new TabPanel(e,!0);let i=null;this._dateTab=this._tabPanel.addTab(RS.Tooltips_DatePicker,`${CSS.Fa} ${CSS.FaCalendar}`,t=>this._datePanel=new _DatePanel(t,this._today,this._today,this._buttonSize,this._actionOK)),i=this._dateTab,this._formatTab=this._tabPanel.addTab(RS.Tooltips_DateFormat,`${CSS.Fa} ${CSS.FaQuoteLeft}`,t=>this._formatPanel=new _CalendarFormatPanel(t,this)),this._tabPanel.onTooltips(toasters$.onTooltipsKey_),this._tabPanel.activeTab(i)}show_(){var t;return null===(t=this._tabPanel.activePanel())||void 0===t||t.show_(),super.show_()}close_(){__classPrivateFieldGet(this,_destroyed_9)||(__classPrivateFieldSet(this,_destroyed_9,!0),this._okCallback=null,super.close_())}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}dateFormat_(t){return this._dateFormat=t,this}width(t,e){return DialogUt.setValueUnit_(this._formatPanel._widthValueUnit,t,e),this}height(t,e){return DialogUt.setValueUnit_(this._formatPanel._heightValueUnit,t,e),this}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.Today:this._datePanel.refresh(this._today),this._formatPanel.refresh();break;case BUT.OK:this._actionOK();break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}_actionOK(){const t=this._datePanel._selectedDate,e=DateTime.local_(null==t?0:t.year$,null==t?1:t.month$,null==t?1:t.day$,1,1,1);this._formatPanel.refresh();const i=this._formatPanel._inputDateFormat.getLabel_(""),n=DialogUt.getValueUnit_(this._formatPanel._widthValueUnit),s=DialogUt.getValueUnit_(this._formatPanel._heightValueUnit);let o=this._okCallback;this.close_(),o(e,n,s,i)}setInitialFocus_(){An.focus_(this._toolbar.button_(BUT.OK))}}_destroyed_9=new WeakMap;class _CalendarFormatPanel extends UIPanelBase{constructor(t,e){super(),this._shown=!1,this._container=t,this._dialog=e;const i=7*e.buttonSize$;t.style.width=`${i}px`,t.style.height=`${i+2*_DateFormatPanel._PADDING}px`;const n=new DomBuilderEx(t).push_();this._inputDateFormat=_DialogUt.flexTextSelect_(accessories$,n.peek_(),DEF.BASIS_34,MSG.string_(RS.Caption),_DialogUt.placeholder_(RS.Caption)),this._inputDateFormat.element_().parentElement.style.paddingTop=`${_DateFormatPanel._PADDING}px`;const s=MSG.string_(RS.Width),o=MSG.string_(RS.Height);this._widthValueUnit=_DialogUt.flexTextInputSelect_(accessories$,n.peek_(),DEF.BASIS_34,DEF.BASIS_60,s,_CalendarFormatPanel._WIDTH,s,"2",CSSLength.EM,CSSLengths),n.addClass_(CSS.AnMarginV5),this._heightValueUnit=_DialogUt.flexTextInputSelect_(accessories$,n.peek_(),DEF.BASIS_34,DEF.BASIS_60,o,_CalendarFormatPanel._HEIGHT,o,"3",CSSLength.EX,CSSLengths)}element_(){return this._container}show_(){this._shown||(this._shown=!0,this.refresh(),An.show_(this._container))}refresh(){const t=this._dialog._datePanel._selectedDate,e=this._dialog._dateFormat;_DateFormatPanel._populateDateFormat(this._inputDateFormat,t,e)}}_CalendarFormatPanel._WIDTH="18",_CalendarFormatPanel._HEIGHT="28";class PromptEvent extends CompositeDialogBase{constructor(t,e,i,n,s,o){super(t,[new DateTimeField("",PromptEvent._Date,o.ms$,e,RS.PlaceholderRequired,i,n,PromptDate.DATE),new SelectFIeld("",PromptEvent._Repeat,PromptEvent._validateRepeat(o.repeat$),RS.Repeat,MSG.stringArray_(RS.RepeatEvents)),new TextAreaField("",PromptEvent._Desc,o.desc$,RS.Description,`${CSS.AnPromptTextarea} ${CSS.AnHalf}`),new ColorField("",PromptEvent._Color,o.color$,e,RS.Color),new UriFolderField("",PromptEvent._Url,HumanLink.fromHref_(o.url$),RS.URL,s,Callbacks.onLinkFolderButton_)]),this._baseuri=s,this._event=o,this._okCallback=null,this.titleText_(this._event.id$)}static _validateRepeat(t){const e=MSG.stringArray_(RS.RepeatEvents);return null!=t&&e.indexOf(t)>=0?t:e[0]}close_(){this._okCallback=null,super.close_()}setInitialFocus_(){this.blurAll()}onOK_(t){return this._okCallback=t,this}_onOK(t){var e;const i=sarray_(),n=null!==(e=this.getIntValue(PromptEvent._Date))&&void 0!==e?e:-1;n<0&&i.push(MSG.string_(RS.inputMustNotBeEmpty_)+MSG.string_(RS.Date));let s=this.getValue_(PromptEvent._Url);if(s.length>0){const t=An.parseUriSafe_(s,this._baseuri);s=null==t?"":t.toAbsolute_().toString()}if(i.length>0)return this.warn_(i),void t(!1);const o=new EventInfo(this._event.copy_([EventKey.Ms,n],[EventKey.Lastms,-1],[EventKey.Repeat,this.getValue_(PromptEvent._Repeat)],[EventKey.Description,this.getValue_(PromptEvent._Desc)],[EventKey.Color,this.getValue_(PromptEvent._Color)],[EventKey.Url,s])).filterx_(),l=this._okCallback;t(!0),l(o)}}PromptEvent._Color="#Xgf",PromptEvent._Repeat="#XYT",PromptEvent._Url="#XIh",PromptEvent._Date="#Xmt",PromptEvent._Desc="#XCh";class PromptCSSLength extends CompositeDialogBase{constructor(t,e,i,n=e){super(t,[new InputSelectField("","",i[0],n,i[1],CSSLengths)]),this._okCallback=null,this.titleKey_(e)}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0),i=this._okCallback;t(!0),i(e)}}class PromptBorder1 extends CompositeDialogBase{constructor(t,e,i,n,s){super(t,[new InputSelectField("",PromptBorder1.WIDTH,i[0],RS.PlaceholderRequired,i[1],CSSLengths),new SelectFIeld("",PromptBorder1.STYLE,n,RS.Style,["dashed","dotted","double","groove","hidden","inset","none","outset","ridge","solid"]),new ColorField("",PromptBorder1.COLOR,s,e,RS.Color),new SampleField(PromptBorder1.SAMPLE,"height:6ex;")]),this._okCallback=null,this._sample=new DomBuilderEx(this.getFieldAt_(3).element_()).div_({style:`border-bottom:${i[0]}${i[1]} ${n} ${s};`+"width:50%;height:0;margin-top:20px;"}).cursor_(),this.onChange_((t,e)=>{const i=t.spec$.key$,n=t.getValue_();PromptBorder1.WIDTH==i?this._sample.style.borderBottomWidth=n:PromptBorder1.STYLE==i?this._sample.style.borderBottomStyle=n:PromptBorder1.COLOR==i&&(this._sample.style.borderBottomColor=n)})}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this._sample.style,i=DialogUt.hasBorder_(e.borderBottomWidth,e.borderBottomStyle)?e.borderBottom:"",n=this._okCallback;t(!0),n(i)}}PromptBorder1.WIDTH="#XJ4",PromptBorder1.STYLE="#XDB",PromptBorder1.COLOR="#XDC",PromptBorder1.SAMPLE="#XDS";class _PromptBordersPanel extends UIPanelBase{constructor(t,e,i,n,s){var o,l,a,r,_,c,h,u,d;super(),this._container=t,this._buttonSize=e;const S=2*this._buttonSize,p=4*this._buttonSize,m=6*this._buttonSize,g=new DomBuilderEx(this._container);this._container.style.width=`${m}px`;const f=g.div_({class:`${CSS.AnFlexCenter} ${CSS.AnLink}`,style:`width:${i}px;height:${i}px;`}).cursor_();this._center=g.div_({class:CSS.AnFlexCenter,style:`box-sizing:border-box;background-color:rgba(0, 0, 0, 0.1);width:${p}px;height:${p}px;`}).cursor_(),g.div_(smap_(["style",`width:${S}px;height:${S}px;background-color:rgba(0, 0, 0, 0.1);`],[ATTR.AnInfo,"5"]));const C=this._center.style;C.borderTop=null!==(o=n.get("border-top"))&&void 0!==o?o:"",C.borderRight=null!==(l=n.get("border-right"))&&void 0!==l?l:"",C.borderBottom=null!==(a=n.get("border-bottom"))&&void 0!==a?a:"",C.borderLeft=null!==(r=n.get("border-left"))&&void 0!==r?r:"",C.borderTopLeftRadius=null!==(_=n.get("border-top-left-radius"))&&void 0!==_?_:"",C.borderTopRightRadius=null!==(c=n.get("border-top-right-radius"))&&void 0!==c?c:"",C.borderBottomRightRadius=null!==(h=n.get("border-bottom-right-radius"))&&void 0!==h?h:"",C.borderBottomLeftRadius=null!==(u=n.get("border-bottom-left-radius"))&&void 0!==u?u:"",C.boxShadow=null!==(d=n.get("box-shadow"))&&void 0!==d?d:"",An.addClickListenerMatching_(f,`div.${CSS.AnLink}`,(t,e)=>{s(this._center,e)})}element_(){return this._container}center_(){return this._center}}class _PromptBordersSamplesPanel extends UIPanelBase{constructor(t,e,i,n){super(),this._container=t,this._onClick=n;const s=`${2*e}px`,o=`${6*e}px`,l=`${8*e}px`,a=new DomBuilderEx(this._container);this._container.style.width=o,a.div_({class:CSS.AnFlex,style:"flex-flow:column nowrap;"+`padding-top:8px;max-height:${l};overflow:auto;`}).push_();for(const t of Object.entries(i)){const e=t[0],i=t[1];a.peek_().div_({style:"margin:8px auto;"}).text_(e),a.peek_().div1_(CSS.AnFlexCenter).push_();for(let t=0;t<i.length;++t){const[e,n]=i[t];let o="";for(const t of Object.entries(n))o+=`${t[0]}:${t[1]};`;a.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnFlexCenter}`],["style",`margin:8px;width:calc(${s} - 16px);height:calc(${s} - 16px);${o};`+"box-sizing:border-box;flex:0 0 auto;background-color:rgba(0, 0, 0, 0.1);overflow:hidden;"],[ATTR.AnInfo,JSON.stringify(n)]).text_(e)}a.pop_()}An.addClickListenerMatching_(this._container,`div.${CSS.AnLink}`,t=>{const e=An.parseJSONObjectOrNull_(t.getAttribute(ATTR.AnInfo));null!=e&&this._onClick(e)})}destroy(){}element_(){return this._container}}class PromptBorders extends CompositeDialogBase{constructor(t,e,i,n=null){super(t,[new TabbedPanelField("",[new TabField(RS.Tooltips_AddBorder,`${CSS.Fa} ${CSS.FaSquareO}`,(t,n,s)=>new _PromptBordersPanel(s,e,6*e,i,(t,e)=>{this._onClick(t,e)})),new TabField(RS.Tooltips_PickFromSamples,`${CSS.Fa} ${CSS.FaSpinner}`,(t,i,n)=>new _PromptBordersSamplesPanel(n,e,PromptBorders.SAMPLES,t=>{this._onSample(t)}))])]),this._buttonSize=e,this._node=n,this._ostyle=null,this._okCallback=null,this._width=6*this._buttonSize,this._tabPanel=this.getFieldAt_(0).tabPanel_();const s=this._tabPanel.getPanelAt(0);this._center=s.center_(),null!=this._node&&(this._ostyle=this._node.getAttribute("style")),this.onShowDialog_(()=>{const t=DomUt.query_(this._dialog,`table.${CSS.AnDialog}`);null!=t&&(t.style.width=""),An.setVisible_(this._dialog),Timer.sleep0_(()=>this.setInitialFocus_())}),this._tabPanel.selectTabAt(0)}_onSample(t){const e=this._center.style,i=null==this._node?null:this._node.style;for(const n of Object.entries(t))e.setProperty(n[0],n[1]),null!=i&&i.setProperty(n[0],n[1]);this._tabPanel.selectTabAt(0)}_onClick(t,e){An.stopevent_(e);const i=e.clientX,n=e.clientY,s=t.getBoundingClientRect(),o=i-s.left,l=n-s.top,a=this._buttonSize,r=3*this._buttonSize,_=4*this._buttonSize;o<0||l<0||o>_||l>_?this._promptBoxShadow():l<a?o<a?this._promptRadius("1"):o<r?this._promptBorder("2"):this._promptRadius("3"):l<r?o<a?this._promptBorder("4"):o<r?this._promptBorder("5",()=>{this._promptRadius("5")}):this._promptBorder("6"):l>r&&(o<a?this._promptRadius("7"):o<r?this._promptBorder("8"):this._promptRadius("9"))}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}_promptBorder(t,e=null){const i=this._center.style;let n=DEF.themeBorderWidthPx,s="solid",o=DEF.themeBorderColor;switch(t){case"1":case"2":case"3":DialogUt.hasBorder_(i.borderTopWidth,i.borderTopStyle)&&(n=i.borderTopWidth,s=i.borderTopStyle,o=i.borderTopColor);break;case"4":DialogUt.hasBorder_(i.borderLeftWidth,i.borderLeftStyle)&&(n=i.borderLeftWidth,s=i.borderLeftStyle,o=i.borderLeftColor);break;case"6":DialogUt.hasBorder_(i.borderRightWidth,i.borderRightStyle)&&(n=i.borderRightWidth,s=i.borderRightStyle,o=i.borderRightColor);break;case"5":case"7":case"8":case"9":DialogUt.hasBorder_(i.borderBottomWidth,i.borderBottomStyle)&&(n=i.borderBottomWidth,s=i.borderBottomStyle,o=i.borderBottomColor)}let l=An.doubleStringSizeUnit_(n);null!=l&&CSSLengths.includes(l[1])||(l=["0.00",CSSLength.PX]);const a=new PromptBorder1(this._container,this._buttonSize,l,s,o);a.titleKey_(RS.Border),a.above_(this.dialog_()),a.onOK_(i=>{const n=this._center.style,s=null==this._node?null:this._node.style;switch(t){case"1":n.borderTop=i,n.borderLeft=i,null!=s&&(s.borderTop=i,s.borderLeft=i);break;case"2":n.borderTop=i,null!=s&&(s.borderTop=i);break;case"3":n.borderTop=i,n.borderRight=i,null!=s&&(s.borderTop=i,s.borderRight=i);break;case"4":n.borderLeft=i,null!=s&&(s.borderLeft=i);break;case"5":n.border=i,null!=s&&(s.border=i);break;case"6":n.borderRight=i,null!=s&&(s.borderRight=i);break;case"7":n.borderLeft=i,n.borderBottom=i,null!=s&&(s.borderBottom=i,s.borderLeft=i);break;case"8":n.borderBottom=i,null!=s&&(s.borderBottom=i);break;case"9":n.borderRight=i,n.borderBottom=i,null!=s&&(s.borderBottom=i,s.borderRight=i)}null==e||e()}),a.onCancel_(()=>{null==e||e()}),a.show_()}_promptRadius(t,e=null){const i=this._center.style;let n=DEF.themeBorderRadius;switch(t){case"1":case"2":case"5":n=DialogUt.getCorner_(i.borderTopLeftRadius,n);break;case"3":case"6":n=DialogUt.getCorner_(i.borderTopRightRadius,n);break;case"8":case"9":n=DialogUt.getCorner_(i.borderBottomRightRadius,n);break;case"4":case"7":n=DialogUt.getCorner_(i.borderBottomLeftRadius,n)}let s=InputSelect2Field.splitValue(n," ");null!=s&&CSSLengths.includes(s[1])&&CSSLengths.includes(s[3])||(s=["0.0",CSSLength.PX,"",CSSLength.PX]);const o=new PromptCorner1(this._container,this._buttonSize,s[0],s[1],s[2],s[3]);o.titleKey_(RS.Corner),o.above_(this.dialog_()),o.onOK_(i=>{const n=this._center.style,s=null==this._node?null:this._node.style;switch(t){case"1":n.borderTopLeftRadius=i,null!=s&&(s.borderTopLeftRadius=i);break;case"2":n.borderTopLeftRadius=i,n.borderTopRightRadius=i,null!=s&&(s.borderTopLeftRadius=i,s.borderTopRightRadius=i);break;case"3":n.borderTopRightRadius=i,null!=s&&(s.borderTopRightRadius=i);break;case"4":n.borderTopLeftRadius=i,n.borderBottomLeftRadius=i,null!=s&&(s.borderTopLeftRadius=i,s.borderBottomLeftRadius=i);break;case"5":n.borderRadius=i,null!=s&&(s.borderRadius=i);break;case"6":n.borderTopRightRadius=i,n.borderBottomRightRadius=i,null!=s&&(s.borderTopRightRadius=i,s.borderBottomRightRadius=i);break;case"7":n.borderBottomLeftRadius=i,null!=s&&(s.borderBottomLeftRadius=i);break;case"8":n.borderBottomLeftRadius=i,n.borderBottomRightRadius=i,null!=s&&(s.borderBottomLeftRadius=i,s.borderBottomRightRadius=i);break;case"9":n.borderBottomRightRadius=i,null!=s&&(s.borderBottomRightRadius=i)}null==e||e()}),o.onCancel_(()=>{null==e||e()}),o.show_()}_promptBoxShadow(t=null){let e=this._center.style.boxShadow;(An.isempty_(e)||"none"==e)&&(e=DEF.themeBoxShadow);const i=new PromptShadow(this._container,this._buttonSize,"box-shadow",e);i.titleKey_(RS.BoxShadow),i.above_(this.dialog_()),i.onOK_(e=>{const i=this._center.style,n=null==this._node?null:this._node.style;i.boxShadow=e,null!=n&&(n.boxShadow=e),null==t||t()}),i.onCancel_(()=>{null==t||t()}),i.show_()}_onOK(t){const e=new Map,i=this._center.style;DialogUt.normalizeBorder_(e,i.borderTop,i.borderRight,i.borderBottom,i.borderLeft,i.borderTopWidth,i.borderTopStyle,i.borderRightWidth,i.borderRightStyle,i.borderBottomWidth,i.borderBottomStyle,i.borderLeftWidth,i.borderLeftStyle),e.set("border-radius",DialogUt.normalizeBorderRadius_(i.borderTopLeftRadius,i.borderTopRightRadius,i.borderBottomRightRadius,i.borderBottomLeftRadius)),e.set("box-shadow",i.boxShadow),this._okCallback(this,e,t)}actionCancelConfirmed_(){null!=this._node&&JsUtil.setAttribute_(this._node,"style",this._ostyle),super.actionCancelConfirmed_()}}PromptBorders.SAMPLES=smap_([MSG.string_(RS.Border),[[MSG.string_(RS.None),smapOf_("border","none")],["",smapOf_("border-left","5px solid rgba(0, 0, 0, 0.5)")],["",smapOf_("border-right","5px solid rgba(0, 0, 0, 0.5)")],["",smapOf_("border-top","5px solid rgba(0, 0, 0, 0.5)")],["",smapOf_("border-bottom","5px solid rgba(0, 0, 0, 0.5)")],["",smapOf_("border-bottom","3px double rgba(0, 0, 0, 0.5)")],["",smapOf_("border","1px solid rgba(0, 0, 0, 0.5)")],["",smapOf_("border","1px dotted rgba(0, 0, 0, 0.5)")],["",smapOf_("border","1px dashed rgba(0, 0, 0, 0.5)")],["",smapOf_("border-bottom","1px solid rgba(0, 0, 0, 0.5)")],["",smapOf_("border-bottom","1px dotted rgba(0, 0, 0, 0.5)")],["",smapOf_("border-bottom","1px dashed rgba(0, 0, 0, 0.5)")]]],[MSG.string_(RS.BorderRadius),[[MSG.string_(RS.None),smapOf_("border-radius","0px")],["5px",smapOf_("border-radius","5px")],["10px",smapOf_("border-radius","10px")],["20px",smapOf_("border-radius","20px")],["10% 50%",smapOf_("border-radius","10%/50%")],["50%",smapOf_("border-radius","50%")]]],[MSG.string_(RS.BoxShadow),[[MSG.string_(RS.None),smapOf_("box-shadow","none")],["",smapOf_("box-shadow","2px 2px 5px rgba(0,0,0,0.5)")],["",smapOf_("box-shadow","2px 2px 5px rgba(0,0,0,0.5) inset")],["",smapOf_("box-shadow",DEF.themeBoxShadow)],["",smapOf_("box-shadow","2px 2px 5px rgba(255, 255, 255,0.5)")],["",smapOf_("box-shadow","2px 2px 5px rgba(255, 255, 255,0.5) inset")]]]);class PromptCorner1 extends CompositeDialogBase{constructor(t,e,i,n,s,o){super(t,[new InputSelectField("",PromptCorner1._HORZ,i,RS.Horizontal,n,CSSLengths),new InputSelectField("",PromptCorner1._VERT,s,RS.Vertical,o,CSSLengths),new SampleField(PromptCorner1._XSAMPLE,"")]),this._okCallback=null;const l=e;let a=`${i}${n}`;s.length>0&&(a+=` ${s}${o}`),this._sample=new DomBuilderEx(this.getFieldAt_(2).element_()).div_({style:`width:${2*l}px;height:${3*l/2}px;margin:30px 0 10px 0;background-color:rgba(0, 0, 0, 0.1);`+`border-right:${DEF.themeBorder};`+`border-bottom:${DEF.themeBorder};`+`border-bottom-right-radius: ${a}`}).cursor_(),this.onChange_((t,e)=>{const i=t.spec$.key$;if(PromptCorner1._HORZ==i||PromptCorner1._VERT==i){const e=t.getValue_();this._sample.style.borderBottomRightRadius=e}})}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValue_(PromptCorner1._HORZ),i=this.getValue_(PromptCorner1._VERT);this._sample.style.borderBottomRightRadius=An.joinNotEmpty_(" ",[e,i]);const n=this._sample.style.borderBottomRightRadius,s=this._okCallback;t(!0),s(n)}}PromptCorner1._HORZ="#XVs",PromptCorner1._XSAMPLE="#XQ3",PromptCorner1._VERT="#XIv";class PromptShadow extends CompositeDialogBase{constructor(t,e,i,n){super(t,[new InputButtonField("",PromptShadow._XSHADOW,n,RS.BoxShadow,BUT.Color1,()=>this._shadowCallback(e,i)),new SampleField(PromptShadow._XSAMPLE,"")]),this._okCallback=null,this._sample=new DomBuilderEx(this.getFieldAt_(1).element_()).div_({style:`width:${e}px;height:${e}px;border:${DEF.themeBorder};${i}:${n};`+"margin:30px 0 10px 0;background-color:rgba(0, 0, 0, 0.1);"}).cursor_(),this.setValue_(PromptShadow._XSHADOW,this._sample.style.getPropertyValue(i)),this.onChange_((t,e)=>{const n=t.spec$.key$;PromptShadow._XSHADOW==n&&this._sample.style.setProperty(i,this.getValue_(n))})}_shadowCallback(t,e){let i=this.getValue_(PromptShadow._XSHADOW);(An.isempty_(i)||"none"==i||"unset"==i||"inherit"==i)&&(i=DEF.themeBoxShadow);const n=RX.CSSColorValue.exec(i),s=null==n?"rgba(0,0,0,0.5)":n[2],o=Callbacks.promptColor_(t,An.above_(this.dialog_()),s,ColorValue.X_TRANSPARENT_DARK);o.onOK_((t,s)=>{if(null!=t){const o=ColorUtil.formatCSSString_(s,t);null==n?this._sample.style.setProperty(e,`${i} ${o}`.trim()):this._sample.style.setProperty(e,(n[1]+o+n[3]).trim()),this.setValue_(PromptShadow._XSHADOW,this._sample.style.getPropertyValue(e))}}),o.show_()}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){this._sample.style.boxShadow=this.getValue_(PromptShadow._XSHADOW);const e=this._sample.style.boxShadow,i=this._okCallback;t(!0),i(e)}}PromptShadow._XSHADOW="#Xiy",PromptShadow._XSAMPLE="#XoA";class PromptDoubleUnit extends CompositeDialogBase{constructor(t,e,i){super(t,[new InputSelectField(e,"",`${i[0]}`,RS.PlaceholderRequired,i[1],CSSLengths)]),this._okCallback=null}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_onOK(t){const e=this.getValueAt_(0);this._okCallback(this,e,e=>{t(e)})}}class PromptFont extends DialogBase{constructor(t,e,i,n,s,o){super(t),this._buttonSIze=e,this._okCallback=null,this._height=0,this._w=Math.round(PromptFont.W$*i/160),super.init_(this.create_(t)),this._onShowDialogCallback=()=>{An.onLoad_(this._image,()=>{An.showHidden_(this._dialog,"block"),this._height=this._image.naturalHeight*this._w/this._image.naturalWidth;const t=this._promptFontResizer();if(!An.isempty_(n)){const e=s.indexOf(n);if(e>0){const i=this._height/s.length,n=Math.round(e*i-i-t/2);this._viewport.scrollTop=n<=0?0:n}}An.onClick_(this._image,t=>{const e=An.documentOffset_(this._image),i=Math.round(t.pageY)-Math.round(e.y)+this._viewport.scrollTop,n=Math.floor(i*s.length/this._height);if(n<s.length){const t=s[n],e=this._okCallback;return this.close_(),void e(t)}}),An.setVisible_(this._dialog),Timer.sleep0_(()=>this.setInitialFocus_())}),this._image.src=o}}create_(t){return this._createDialogWithContentOnly(t,t=>{const e=new DomBuilderEx(t);this._viewport=t,this._image=e.img_({style:`width:${this._w}px`}).cursor_()})}close_(){this._okCallback=null,super.close_()}static rowHeight_(t,e,i){return t.naturalHeight*PromptFont.W$*e/(160*t.naturalWidth*i)}_allowTouchmove(){return!0}onSmokescreenCreated_(t){super.onSmokescreenCreated_(t),t.on_(Conf.touchend,t=>{An.stopevent_(t),this.actionCancel_()})}_onResize(){this._promptFontResizer()}_promptFontResizer(){if(this._height<.1)return this._viewport.style.height="0px",this._viewport.style.width="0px",this._dialog.style.left="0px",this._dialog.style.top="0px",0;const t=window.innerHeight,e=window.innerWidth,i=this._w,n=Math.round(Math.min(this._height,Math.min(t-40-DEFUtil.dialogChromeHeight_(this._buttonSIze),this._height+4))),s=Math.round(Math.min(i,.8*e)),o=Math.round((e-s-DEFUtil.dialogChromeWidth_(this._buttonSIze))/2),l=Math.round(Math.min(20,(t-n)/2)),a=DomUt.query_(this._dialog,`table.${CSS.AnDialog}`);return With.optional_(null==a?void 0:a.style,t=>{t.paddingRight="0",t.minWidth="0",t.width=""}),this._viewport.style.height=`${n}px`,this._viewport.style.width=`${s}px`,this._dialog.style.left=`${o}px`,this._dialog.style.top=`${l}px`,n}onOK_(t){return this._okCallback=t,this}}PromptFont.W$=240;class PromptSymbol extends FullscreenDialogBase{constructor(t,e){super(t,e.getGestureHandler()),this._handler=e,this._okCallback=null,this._family=null,this._ulStore=new Map,this._tooltipsTimer=null,this._tooltipsShown=!1,this._settings=e.settings(),this._buttonSize=this._settings.current_().buttonSize$,this._fontSize=5*this._buttonSize/8,super.init_(this.create_(t))}create_(t){return this.createFullscreenDialog_(t,t=>this._createFullscreenToolbar(t),t=>this._createFullscreenContent(t))}_createFullscreenToolbar(t){const e=FullscreenDialogBase.fullscreenToolbarCreator_(t,null,[smap_(["rows","1"],["class",CSS.AnSearchbox],["placeholder",MSG.string_(RS.Filter)],["tabindex","1"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"]),BUT.info_(BUT.Cancel)]);return e.onAction_(t=>this._toolbarActions(t)),this._searchbox=e.element_().querySelector(Conf.input),An.onInputFocusSelect_(this._searchbox).addEventListener("input",()=>{this._filter()}),this._container.addEventListener("contextmenu",t=>{An.stopevent_(t)}),e}_createFullscreenContent(t){t.div_().push_().div_({class:CSS.AnFlex,style:"padding: 5px;"}),this._selectFontname=new SelectOptions(accessories$,t.div_({class:CSS.AnPromptSelect,style:"flex-basis:100%"}).cursor_()),this._selectFontname.onChange_(t=>{Timer.sleep0_(()=>{this._show1(t,this._buttonSize)})});const e=[PromptSymbol.recents],i=[PromptSymbol.recents],n=this._handler.family$;let s=0;for(let t of this._settings.symbolFamilies_()){const o=t.fontname_();if(DEF.Emoji==o)continue;let l=o[0].toUpperCase()+o.substring(1);l.endsWith("-Regular")&&(l=l.substring(0,l.length-8)),o==n&&(s=e.length),e.push(o),i.push(l)}this._selectFontname.setOptions_(e,i,s),this._symbolList=t.peek_().div_({class:CSS.AnViewport,style:"padding: 5px;"}).cursor_(),t.pop_()}showFullscreen_(){this.onResize_();const t=this._selectFontname.getValue_("");this._show1(t,this._buttonSize),An.setVisible_(this._dialog)}close_(){this._stopTooltipsTimer();for(let t of this._ulStore.values())t.remove();this._ulStore.clear(),this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}onResize_(){const t=window.innerWidth,e=window.innerHeight,i=this._symbolList.getBoundingClientRect(),n=Math.round(i.top),s=t-10,o=e-n-5;An.setRectangle_(this._symbolList,0,n,s,o)}_show1(t,e){const i=this._family;if(this._family=t,t!=i){if(null!=i){const t=this._ulStore.get(i);An.hide_(t)}const e=this._ulStore.get(t);this._handler.updateSymbolFamily(t),void 0!==e?An.show_(e):t==PromptSymbol.recents?this._showrecents():this._showsymbols(this._symbolinfo(this._settings.symbolFamilies_(),t)),this._filter()}}_symbols(){const t=null==this._family?void 0:this._ulStore.get(this._family);return void 0===t?[]:Array.from(t.children)}_filter(){const t=this._searchbox.value.toLowerCase(),e=this._symbols();if(0==t.length)for(let t of e)An.show_(t);else for(let i of e){const e=i.getAttribute(ATTR.xTooltips);null!=e&&e.includes(t)?An.show_(i):An.hide_(i)}}_symbolinfo(t,e){for(const i of t)if(i.fontname_()==e)return i;return null}_showrecents(){const t=new Map;for(let e of this._handler.recents$)t.set(SymbolInfo.family_(e)+"/"+SymbolInfo.name_(e),e);const e=DomBuilderEx.offline_(this._symbolList.ownerDocument,"ul",{class:CSS.AnSymbolList,style:`font-size:${this._fontSize}px;`}).push_();for(let i of t.values()){const t=SymbolInfo.family_(i),n=SymbolInfo.name_(i),s=SymbolInfo.text_(i);e.peek_().li_([ATTR.xTooltips,n],["style",`font-family: "${t}"`]).text_(s)}const i=e.pop_().cursor_();new DomBuilderEx(this._symbolList).appendNodes_(i),this._ulStore.set(PromptSymbol.recents,i),this._setupHandlers(i)}_showsymbols(t){if(null==t)return;const e=t.glyphs_();if(null==e)return;const i=t.fontname_(),n=t.glyphnames_(),s=DomBuilderEx.offline_(this._symbolList.ownerDocument,"ul",{class:CSS.AnSymbolList,style:`font-family:${i}; font-size:${this._fontSize}px;`}).push_();for(let t=0;t<e.length;++t){const i=e[t];s.peek_().li_([ATTR.xTooltips,null!=n?n[t]:An.xhex_(i,4)]).text_(String.fromCharCode(i))}const o=s.pop_().cursor_();new DomBuilderEx(this._symbolList).appendNodes_(o),this._ulStore.set(i,o),this._setupHandlers(o)}_setupHandlers(t){An.addClickListenerMatching_(t,"li",(t,e)=>{An.stopevent_(e),this._ok(t)}),Conf.useFlash&&new Flash(t,"li",CSS.AnFlashLowlight,DEFUtil.flashDuration),An.addEventListenerMatching_(t,Conf.touchstart,"li",(t,e)=>{this._stopTooltipsTimer(),this._tooltipsShown=!1,this._tooltipsTimer=new Timer(DEFUtil.durationTooltips$,()=>{An.stopevent_(e),this._tooltipsTimer=null,this._tooltipsShown=!0,this._showTooltips(t)})}),t.addEventListener(Conf.touchend,t=>{this._stopTooltipsTimer(),this._tooltipsShown&&(An.stopevent_(t),toasters$.hideInfo_(),this._tooltipsShown=!1)})}_stopTooltipsTimer(){null!=this._tooltipsTimer&&(this._tooltipsTimer.cancel_(),this._tooltipsTimer=null)}_showTooltips(t,e=!0){if(null==t)return;const i=t.getAttribute(ATTR.xTooltips);null!=i&&toasters$.info_(i,{attop:e})}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.Cancel:toasters$.hideInfo_(),this.actionCancel_();break;default:this.actionInvalid_(t)}}_ok(t){var e,i,n;const s=null!==(e=t.textContent)&&void 0!==e?e:"",o=t.getAttribute(ATTR.xTooltips),l=null!==(n=null===(i=An.getComputedStyle_(t))||void 0===i?void 0:i.fontFamily)&&void 0!==n?n:null;null!=l&&null!=o&&this._handler.updateRecentsSymbol(l,o,s),toasters$.hideInfo_();const a=this._okCallback;this.close_(),a(s,o,smapOf_("font-family",l))}}PromptSymbol.recents=MSG.string_(RS.Recents);class PromptUndo extends DialogBase{constructor(t,e){super(t),this._history=e,this._okCallback=null,this._selected=null,this._selectedIndex=null,super.init_(this.create_(t)),An.addClickListenerMatching_(this._content,`div[${ATTR.AnInfo}]`,(t,e)=>{An.stopevent_(e);const i=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);this._select(t,i)})}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),[BUT.info_(BUT.Undo),BUT.info_(BUT.Cancel)],t=>this._toolbarActions(t))}_createContent(t){this._content=t;const e=t.style;e.minHeight="25vh",e.border=DEF.themeBorder,e.marginTop="5px"}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}_select(t,e){if(null!=this._selected&&(this._selected.classList.remove(CSS.AnSelected),this._selectedIndex==e))return this._selected=null,void(this._selectedIndex=null);t.classList.add(CSS.AnSelected),this._selected=t,this._selectedIndex=e}_refresh(){const t=new DomBuilderEx(this._content).div1_(CSS.AnTextList,CSS.AnZebra).push_(),e=this._history.length_();for(let i=e-1;i>=0;--i){const n=An.truncate_(this._history.getDescription_(i),DEF.historyTextLength);t.peek_().div_([ATTR.AnInfo,`${e-i}`]).text_(n),null==this._selected&&this._select(t.cursor_(),1)}}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.Cancel:const e=this._cancelCallback;this.close_(),null==e||e();break;case BUT.Undo:const i=this._selectedIndex,n=this._okCallback;this.close_(),n(i);break;default:this.actionInvalid_(t)}}showDialog_(t){An.showHidden_(this._dialog,"block"),this._smokescreen=new Smokescreen(this._container,An.zindexOf_(this._dialog,DEF.zindexUnder,DEF.zindexPrompt+DEF.zindexUnder)),this._smokescreen.on_("click",t=>{An.stopevent_(t);const e=this._cancelCallback;this.close_(),null==e||e()}),null!=t&&(t(this),this._onWindowResize(()=>{t(this)})),this._smokescreen.show_(),this._refresh(),An.setVisible_(this._dialog),null==this._dragger&&null!=this._dragHandler&&(this._dragger=new Dragger(this._dialog,this._dragHandler).bind_())}}class DialogUt{static flexSelect1_(t,e){return new SelectOptions(t,e.push_().div1_(CSS.AnPromptSelect).cursorPop_())}static textSelect_(t,e,i,n){return e.div1_(CSS.AnFlex,CSS.AnMarginV5),this.flexTextSelect1_(t,e,DEF.BASIS_40,i,n)}static flexTextSelect1_(t,e,i,n,s){e.push_(),i>0&&e.div_({class:CSS.AnRightAlignLabel,style:`flex-basis:${i}%`}).text_(n);const o=new SelectOptions(t,e.peek_().div_(["class",CSS.AnPromptSelect],["style",`flex-basis:${100-i}%`],[ATTR.placeholder,s]).cursor_());return e.pop_(),o}static populateCheckboxList_(t,e,i){this.populateCheckboxList1_(t,()=>DialogUt.createCheckboxList_(t,e,i))}static populateOverwritingCheckboxList_(t,e,i){this.populateCheckboxList1_(t,()=>DialogUt.createCheckboxList2_(t,e,i))}static populateCheckboxList1_(t,e){const i=t.span_({style:"flex:1 1 auto;text-align:right;margin:0 0 0 10px;cursor:pointer"}).cursor_(),n=t.child_("span",{class:`${CSS.Fa} ${CSS.AnButtonInline}`,style:"margin-left:10px;"}).cursor_(),s=t.peek_().div1_(CSS.AnPromptChecklist).push_().cursor_(),o=e();t.pop_(),n.classList.add(0==o?CSS.FaSquareO:CSS.FaCheckSquareO),An.onClick_(i,t=>{An.stopevent_(t);const e=An.classlist_(n).toggleAll_(CSS.FaSquareO,CSS.FaCheckSquareO).contains_(CSS.FaCheckSquareO);for(let t of DomUt.queryAll_(s,"input[type=checkbox]"))t.disabled||(t.checked=e)}),An.addClickListenerMatching_(s,"div",(t,e)=>{const i=DomUt.asHTMLElement_(e.target);if(null!=i&&"INPUT"==i.nodeName)return;An.stopevent_(e);const n=t.querySelector("input");null==n||n.disabled||(n.checked=!n.checked)})}static createCheckboxList_(t,e,i){let n=0;for(const s of e){const e=t.peek_().div_().input_({type:"checkbox"}).cursor_();i(s,e)&&(e.checked=!0,++n),t.siblingAfter_("span").text_(s)}return n}static createCheckboxList2_(t,e,i){let n=0;for(const[s,[o,l]]of e.entries()){const e=t.peek_().div_().input_({type:"checkbox"}).cursor_();i(s,e)&&(e.checked=!0,++n);const a=o?[CSS.xBold]:[];l!=o&&a.push(CSS.xBlue),t.siblingAfter_("span").addClasses_(a).text_(s)}return n}static populateFontName_(t,e,i,n,s){const o=FontUtil.getFontNames_(e,i,n,s);t.setOptions_(e,null,o)}static populateFontStyle_(t,e,i,n){const s=FontUtil.getFontStyles_(e,i,n);return t.setOptions_(e,null,s),s<0?null:e[s]}static setTooltipsHandler_(t){t.addEventListener("contextmenu",e=>{toasters$.onTooltipsKey_(t,e)})}static setButtonTooltipsHandler_(t){An.addContextmenuListenerMatching_(t,`button[${ATTR.xTooltips}]`,toasters$.onTooltipsKey_)}static promptOK_(t,e,i,n){const s=new PromptOK(t,e,i,DEF.zindexConfirm);return s.onOK_(()=>{n(!0)}),s.onCancel_(()=>{n(!1)}),s}static confirm_(t,e,i){return DialogUt.promptOK_(t,RS.Confirm,e,i)}static confirmKeySmall_(t,e,i,n){this.confirmSmall_(t,MSG.string_(e),i,n)}static confirmSmall_(t,e,i,n){this.confirm_(t,e,n).smallWidth_().zindex_(i).showWarning_()}static confirmOverwriting_(t,e){DialogUt.promptOK_(accessories$,RS.ConfirmOverwriting,t,e).smallWidth_().showWarning_()}static getValueUnit_(t){let e=t[0].value;if(!An.isempty_(e)){e+=t[1].getValue_("")}return e}static setValueUnit_(t,e,i){t[0].value=e,t[1].setValue_(i)}static setPathKind_(t,e){An.classlist_(t).add_(e?CSS.AnButtonDown:CSS.AnButtonFlat).remove_(e?CSS.AnButtonFlat:CSS.AnButtonDown)}static getPathKind_(t){return null==t||t.classList.contains(CSS.AnButtonDown)}static onFilepathKindButton_(t,e,i){const n=An.classlist_(t).toggleAll_(CSS.AnButtonDown,CSS.AnButtonFlat).contains_(CSS.AnButtonDown);return[Callbacks.getFilepathOfKind_(n,e,i),n]}static promptColorInput_(t,e,i,n,s){t.push_();const o=t.flexInput_(100,e,i),l=t.peek_().div1_(CSS.AnFlex0,CSS.AnColorCell).cursor_();return t.pop_(),o.value=n,l.style.backgroundColor=s,[o,l]}static promptColorStopsInput_(t,e){const i=[];t.push_();for(let n=0;n<e.length;++n){const s=e[n],o=t.peek_().div_({class:`${CSS.AnFlex11Auto} ${CSS.AnSmall} ${CSS.AnFlexCenter}`,style:"overflow:hidden;line-height:3ex;"}).text_("").cursor_();if(i.push(o),null!=s){const t=ColorValue.from_(s.color);null!=t&&(o.style.backgroundColor=t.toCSSString_());const e=s.position;e.length>0&&(o.textContent=e)}}return t.pop_(),i}static createInputSlider_(t,e,i,n,s,o,l,a,r,_){t.push_();const c=t.peek_().flexInputSlider_(100,o,`${e}`,`${i}`,`${n}`,`${l}`,_DialogUt.placeholder_(a),r);if(c.style.boxSizing="border-box",s>0){const n=`slider${r}`;c.setAttribute("list",n),t.child2_("datalist","id",n).push_();for(let n=e+s;n<i;n+=s)t.peek_().option2_("value",`${n}`);t.pop_()}t.pop_();const h=new FrameLimiter(10),u=()=>{h.queue_(()=>{_()})};return An.onInput_(c,u),An.onChange_(c,u),c}static promptDateInput_(t,e,i,n,s){const o=e.container_(),l=i.buttonsize$,a=i.dateformat$,r=i.timeformat$;t.push_();const _=t.flexDivInput_(100);t.pop_(),null!=n&&(_.setAttribute(ATTR.xTooltips,`${n.millisecondsSinceEpoch$}`),_.textContent=An.datetimeString_(a,r,n));return An.onClick_(_,t=>{An.stopevent_(t);const i=An.parseInt_(_.getAttribute(ATTR.xTooltips),-1),n=An.now00_(),c=i<0?n:new DateTime(i),h=new PromptDate(o,n,c,PromptDate.DATE|PromptDate.TIME,l);h.zindex_(null==e?DEF.zindexPrompt:An.zindexOf_(e.element_(),DEF.zindexAbove10,DEF.zindexPrompt+DEF.zindexAbove10)),h.dateFormat_(a),h.timeFormat_(r),h.onOK_((t,e,i,n,s)=>{_.setAttribute(ATTR.xTooltips,`${t.millisecondsSinceEpoch$}`),_.textContent=An.datetimeString_(a,r,t)}),h.showTab_(s)}),_}static toggleButtonStyle_(t){const e=t/8;return`min-width:${t-e}px;`+`min-height:${t-e}px;`+`margin-right:${e}px;`+`border:${DEF.lightBorder};`+"border-radius:50%;flex:0 0 auto;align-self:stretch;box-sizing:border-box;overflow:hidden;"}static toggleButtonFlexStyle_(t,e){return DialogUt.toggleButtonStyle_(t)+`align-items:${e};`+`justify-content:${e};`}static toggleButtonInnerSize_(t){return 2*(t-t/8)/3}static createBorderButton_(t,e,i){const n=DialogUt.toggleButtonInnerSize_(e);return t.push_().div_(["class",`${CSS.AnButton} ${i?CSS.AnButtonDown:CSS.AnButtonFlat}`],["style",DialogUt.toggleButtonFlexStyle_(e,"flex-start")],[ATTR.xTooltips,RS.Border]).push_().div_({style:`width:${n}px;height:${n}px;background-color:rgba(0, 0, 0, 0.1);`+`border-right:${DEF.themeBorder};border-bottom:${DEF.themeBorder};`}).pop_().cursorPop_()}static createRoundCornersButton_(t,e,i){const n=DialogUt.toggleButtonInnerSize_(e);return t.push_().div_(["class",`${CSS.AnButton} ${i?CSS.AnButtonDown:CSS.AnButtonFlat}`],["style",DialogUt.toggleButtonFlexStyle_(e,"flex-start")],[ATTR.xTooltips,RS.RoundCorners]).push_().div_({style:`width:${n}px;height:${n}px;background-color:rgba(0, 0, 0, 0.1);`+`border-right:${DEF.themeBorder};border-bottom:${DEF.themeBorder};`+`border-radius:0 0 ${DEF.themeBorderRadius} 0`}).pop_().cursorPop_()}static createBoxShadowButton_(t,e,i){const n=DialogUt.toggleButtonInnerSize_(e);return t.push_().div_(["class",`${CSS.AnButton} ${i?CSS.AnButtonDown:CSS.AnButtonFlat}`],["style",DialogUt.toggleButtonFlexStyle_(e,"flex-start")],[ATTR.xTooltips,RS.BoxShadow]).push_().div_({style:`width:${n}px;height:${n}px;background-color:rgba(0, 0, 0, 0.1);`+`border-right:${DEF.themeBorder};border-bottom:${DEF.themeBorder};`+`box-shadow:${DEF.themeBoxShadow}`}).pop_().cursorPop_()}static createHeaderButton_(t,e,i){const n=DialogUt.toggleButtonInnerSize_(e)/2;return t.push_().div_(["class",`${CSS.AnButton} ${i?CSS.AnButtonDown:CSS.AnButtonFlat}`],["style",DialogUt.toggleButtonFlexStyle_(e,"flex-start")+"flex-direction:column;"],[ATTR.xTooltips,RS.Subject]).push_().div_({style:`width:100%;height:${n}px;box-sizing:border-box;`+"background-color:rgba(0, 0, 0, 0.1);"+`border-bottom:${DEF.themeBorder};`}).peek_().div_({style:"width:100%;align-self:stretch;background-color:rgba(0, 0, 0, 0.0);"}).pop_().cursorPop_()}static createOrientationButton_(t,e,i){return t.push_().div_(["class",`${CSS.AnButton} ${CSS.AnButtonFlat}`],["style",DialogUt.toggleButtonFlexStyle_(e,"stretch")],[ATTR.xTooltips,RS.Orientation]),DialogUt.updateOrientationButton_(t,i),t.cursorPop_()}static updateOrientationButton_(t,e){t.push_().cursor_().style.flexDirection=e?"column":"row",t.div_({style:"flex:1 1 100%;background-color:rgba(0, 0, 0, 0.1);"+`${e?"border-bottom:${DEF.themeBorder};":"border-right:${DEF.themeBorder};"}`}).peek_().div_({style:"flex:1 1 100%;background-color:rgba(0, 0, 0, 0.0);"}).pop_()}static createGutterButton_(t,e,i){return t.push_().div_(["class",`${CSS.AnButton} ${CSS.AnButtonFlat}`],["style",DialogUt.toggleButtonFlexStyle_(e,"stretch")],[ATTR.xTooltips,RS.Orientation]),DialogUt.updateGutterButton_(t,i),t.cursorPop_()}static updateGutterButton_(t,e){t.push_().cursor_().style.flexDirection=e?"column":"row",t.div_({style:"flex:1 1 100%;background-color:rgba(0, 0, 0, 0.1);"}).peek_().div_({style:"flex:0 0 5px;background-color:#eee;"+`border:${DEF.themeBorder};`+`${e?"border-width:1px 0;":"border-width:0 1px"}`}).peek_().div_({style:"flex:1 1 100%;background-color:rgba(0, 0, 0, 0.1);"}).pop_()}static createColorButton_(t,e,i){return t.push_().div_(["class",`${CSS.AnButton} ${CSS.AnButtonFlat} ${CSS.Fa} ${CSS.FaSpinner}`],["style",DialogUt.toggleButtonStyle_(e)+`background-color:${i};`+"text-shadow:0 0 1px #fff;"],[ATTR.xTooltips,RS.Tooltips_SetBackgroundColor]).cursorPop_()}static createSymbolButton_(t,e,i,n){return t.push_().div_(["class",`${CSS.AnButton} ${CSS.AnButtonFlat} ${CSS.Fa} ${i}`],["style",DialogUt.toggleButtonStyle_(e)+"text-shadow:0 0 1px #fff;"],[ATTR.xTooltips,n]).cursorPop_()}static createClientActionButton_(t,e,i,n){return t.push_().div_(["class",`${CSS.AnButton} ${n?CSS.AnButtonDown:CSS.AnButtonFlat} ${CSS.Fa} ${i}`],["style",DialogUt.toggleButtonStyle_(e)],[ATTR.xTooltips,RS.Tooltips_Toolbar]).cursorPop_()}static hasBorder_(t,e){if("none"==e)return!1;const i=An.doubleSizeUnit_(t);return null!=i&&0!=i[0]}static getCorner_(t,e){const i=InputSelect2Field.splitValue(t," ");return null!=i&&(""!=i[0]&&"0.00"!=i[0]||""!=i[2]&&"0.00"!=i[2])?t:e}static normalizeBorder_(t,e,i,n,s,o,l,a,r,_,c,h,u){DialogUt.hasBorder_(o,l)||(e=""),DialogUt.hasBorder_(a,r)||(i=""),DialogUt.hasBorder_(_,c)||(n=""),DialogUt.hasBorder_(h,u)||(s=""),e==i&&e==n&&e==s?t.set("border",e):(t.set("border-top",e),t.set("border-right",i),t.set("border-bottom",n),t.set("border-left",s))}static normalizeBorderRadius_(t,e,i,n){t=DialogUt.getCorner_(t,"0px"),e=DialogUt.getCorner_(e,"0px"),i=DialogUt.getCorner_(i,"0px"),n=DialogUt.getCorner_(n,"0px");const s=t.split(" "),o=e.split(" "),l=n.split(" "),a=i.split(" ");if(1==s.length&&1==o.length&&1==l.length&&1==a.length)return t==e&&t==n&&t==i?t:`${t} ${e} ${i} ${n}`;const r=2==s.length?s[1]:s[0],_=2==o.length?o[1]:o[0],c=2==l.length?l[1]:l[0],h=2==a.length?a[1]:a[0];return`${s[0]} ${o[0]} ${a[0]} ${l[0]}/${r} ${_} ${h} ${c}`}static defaultCanvasDimension_(t){const e=window.innerWidth,i=2*ImageAnnotator.PADDING+2+4,n=An.multipleOf_(16,e-i),s=An.multipleOf_(16,window.innerHeight-t-i);return MediaUtil.limitImageArea_(n,s)}}class _DialogUt{static placeholder_(t){return MSG.string_(t)}static createFilepathInput_(t,e,i,n,s){var o,l;const a=i.label$.length>0?e.labelWidth$:0,r=e.tabIndex_(),_=MSG.string_(i.label$),c=i.value$,h=_DialogUt.placeholder_(i.placeholder$),u=i.buttons$,d=t.peek_().div1_(CSS.AnMarginV5).push_().cursor_(),S=_DialogUt.createButtonBar_(t,a),p=_DialogUt.flexTextInput_(t,a,_,h,r);t.setCursor_(S).push_();const m=_DialogUt.createButtonBarButtons_(t,u);t.pop_(2);const g=null!==(o=m.get(BUT.PathKind))&&void 0!==o?o:null,f=null!==(l=m.get(BUT.Folder))&&void 0!==l?l:null;return c.updateInput_(p),null!==g&&(DialogUt.setPathKind_(g,c.isAbsolute$),g.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),s()})),null!==f&&f.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),Timer.sleep0_(n)}),[d,p,g,m]}static createFilepathFolderInput_(t,e,i,n){const s=i.label$.length>0?e.labelWidth$:0,o=e.tabIndex_(),l=MSG.string_(i.label$),a=i.value$,r=_DialogUt.placeholder_(i.placeholder$),_=t.peek_().div1_(CSS.AnMarginV5).cursor_(),c=_DialogUt.flexTextInput_(t,s,l,r,o),h=_DialogUt.createActionButton_(t.push_(),BUT.Folder1);return t.pop_(2),c.style.marginRight="5px",h.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),Timer.sleep0_(n)}),a.updateInput_(c),[_,c,h]}static createBasenameInput_(t,e,i,n){const s=i.label$.length>0?e.labelWidth$:0,o=e.tabIndex_(),l=DEF.BASIS_60,a=MSG.string_(i.label$),r=i.filename$,_=_DialogUt.placeholder_(i.placeholder$),c=t.peek_().div1_(CSS.AnMarginV5).push_().cursor_();_DialogUt.flexTextContainer_(t,s,a);const h=t.flexInput_(100,_,o);t.up_().push_();const u=null==r?null:new Basepath(r),d=null==u?"":u.suffix$,S=sarray_();S.push(d),d.toLowerCase()!=d&&S.push(d.toLowerCase()),d.toUpperCase()!=d&&S.push(d.toUpperCase());const p=new SelectOptions(accessories$,t.peek_().div_({class:`${CSS.AnPromptSelect} ${CSS.AnMarginLeft5}`,style:`flex-basis:${100-l}%`}).cursor_());p.setOptions_(S,null,0);const m=_DialogUt.createActionButton_(t.peek_(),BUT.Folder1);return m.style.marginLeft="5px",m.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),Timer.sleep0_(n)}),t.pop_(2),null!=u&&(h.value=u.nameWithoutSuffix$,p.setValue_(u.suffix$,0)),[c,h,p,mapOf_(BUT.Folder1,m)]}static createUrlInput_(t,e,i,n,s,o){var l,a,r;const _=i.label$.length>0?e.labelWidth$:0,c=e.tabIndex_(),h=MSG.string_(i.label$),u=i.value$,d=_DialogUt.placeholder_(i.placeholder$),S=i.buttons$,p=t.peek_().div1_(CSS.AnMarginV5).push_().cursor_(),m=_DialogUt.createButtonBar_(t,_),g=_DialogUt.flexTextInput_(t,_,h,d,c);u.updateInput_(g),t.setCursor_(m).push_();const f=_DialogUt.createButtonBarButtons_(t,S);t.pop_(2);const C=null!==(l=f.get(BUT.PathKind))&&void 0!==l?l:null,T=null!==(a=f.get(BUT.Folder))&&void 0!==a?a:null,A=null!==(r=f.get(BUT.ImportImageFromPhotoLibrary))&&void 0!==r?r:null;return null!==C&&(null==s&&Assert.fail_(),DialogUt.setPathKind_(C,u.isAbsolute$),C.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),s()})),null!==T&&(null==n&&Assert.fail_(),T.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),Timer.sleep0_(n)})),null!==A&&(null==o&&Assert.fail_(),A.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),Timer.sleep0_(o)})),[p,g,C,f]}static createUrlFolderInput_(t,e,i,n){const s=i.label$.length>0?e.labelWidth$:0,o=e.tabIndex_(),l=MSG.string_(i.label$),a=i.value$,r=_DialogUt.placeholder_(i.placeholder$),_=t.peek_().div1_(CSS.AnMarginV5).cursor_(),c=_DialogUt.flexTextInput_(t,s,l,r,o),h=_DialogUt.createActionButton_(t.push_(),BUT.Folder1);return t.pop_(2),c.style.marginRight="5px",a.updateInput_(c),h.addEventListener("click",t=>{An.stopevent_(t),e.clearStatus_(),Timer.sleep0_(n)}),[_,c,h]}static createInputButton_(t,e,i,n,s){t.push_();const o=t.flexInput_(100,e,i);o.style.marginRight="5px";const l=this.createActionButton_(t.peek_(),s);return t.pop_(),null!=n&&(o.value=n),[o,l]}static createInputButtons_(t,e,i,n,s,o){t.push_();const l=t.flexInput_(100,e,i);l.style.marginRight="5px";const a=smap_();for(const e of s){const i=this.createActionButton_(t.peek_(),e);An.onClick_(i,t=>{An.stopevent_(t),o(e)}),a[e]=i}return t.pop_(),null!=n&&(l.value=n),[l,a]}static createLeftToggleButton_(t,e){return this._createLeftToggleButton1(t,e.class,e[ATTR.xTooltips])}static _createLeftToggleButton1(t,e,i){return t.peek_().childBeforeFirst_("button",smap_(["class",e],[ATTR.xTooltips,i],["style","margin-right: 5px;"])).cursor_()}static createActionButton_(t,e){const i=BUT._INFOS[e];return this._createActionButton1(t,i.class,i[ATTR.xTooltips])}static _createActionButton1(t,e,i){return t.peek_().button_(["class",e],[ATTR.xTooltips,i]).cursor_()}static createFolderButton_(t){return _DialogUt.createActionButton_(t,BUT.Folder)}static createButtonBar_(t,e){const i=t.peek_().flexTextContainer_(e,"").push_().div1_(CSS.AnButtonPadding).text_("").pop_().cursor_();return DialogUt.setButtonTooltipsHandler_(i),i}static createButtonBarButtons_(t,e){const i=new Map;for(let n of e)switch(n){case BUT.PathKind:case BUT.CreateLink:i.set(n,_DialogUt.createLeftToggleButton_(t,BUT._INFOS[n]));break;case BUT.CreateThumbnail:i.set(n,_DialogUt.createActionButton_(t,n));break;case BUT.ImportImageFromPhotoLibrary:const e=_DialogUt.createActionButton_(t,n);i.set(n,e);break;case BUT.Folder:i.set(n,_DialogUt.createFolderButton_(t));break;default:throw Assert.notReach_(n)}return i}static flexSelect_(t,e,i,n,s){return e.peek_().div1_(CSS.AnFlex,CSS.AnMarginV5),DialogUt.flexTextSelect1_(t,e,i,n,s)}static flexTextSelect_(t,e,i,n,s){return e.peek_().div1_(CSS.AnFlex,CSS.AnMarginV5),DialogUt.flexTextSelect1_(t,e,i,n,s)}static flexTextInput_(t,e,i,n,s="1"){return t.peek_().div1_(CSS.AnFlex,CSS.AnMarginV5),t.flexTextInput1_(e,i,n,s)}static flexTextTextarea_(t,e,i,n){return t.peek_().div1_(CSS.AnFlex,CSS.AnMarginV5),t.flexTextTextarea1_(e,i,n)}static flexTextDiv_(t,e,i){return t.peek_().div1_(CSS.AnFlex,CSS.AnMarginV5),t.flexTextDiv1_(e,i)}static flexTextContainer_(t,e,i){return t.peek_().div1_(CSS.AnFlex,CSS.AnMarginV5),t.flexTextContainer1_(e,i)}static flexTextInputSelect_(t,e,i,n,s,o,l,a,r,_){e.flexTextContainer_(i,s).push_();const c=e.flexInput_(n,l,a),h=null!=r?_.indexOf(r):null,u=new SelectOptions(t,e.peek_().div_(["class",`${CSS.AnPromptSelect} ${CSS.AnMarginLeft5}`],["style",`flex-basis:${100-n}%`],[ATTR.placeholder,null!=l?l:""]).cursor_());return u.setOptions_(_,null,h),null!=o&&(c.value=o),e.pop_(),e.up_(),[c,u]}static flexTextSelectInput_(t,e,i,n,s,o,l,a,r,_){e.flexTextContainer_(i,s).push_();const c=null!=r?_.indexOf(r):null,h=new SelectOptions(t,e.peek_().div_(["class",`${CSS.AnPromptSelect} ${CSS.AnMarginLeft5}`],["style",`flex-basis:${100-n}%`],[ATTR.placeholder,null!=l?l:""]).cursor_()),u=e.peek_().flexInput_(n,l,a);return e.pop_(),e.up_(),h.setOptions_(_,null,c),null!=o&&(u.value=o),[h,u]}static flexTextInputSelect2_(t,e,i,n,s,o,l){var a,r;e.flexTextContainer_(i,MSG.string_(l.label$)).addStyles_(smapOf_("flex-flow","row nowrap")).push_();const _=e.flexInput_(n,_DialogUt.placeholder_(l.placeholder1$),s),c=new SelectOptions(t,e.peek_().div_({class:`${CSS.AnPromptSelect} ${CSS.AnMarginH5}`,style:`flex-basis:${100-n}%`}).cursor_()),h=e.peek_().flexInput_(n,_DialogUt.placeholder_(l.placeholder2$),o),u=new SelectOptions(t,e.peek_().div_({class:`${CSS.AnPromptSelect} ${CSS.AnMarginLeft5}`,style:`flex-basis:${100-n}%`}).cursor_()),d=null!=l.selectvalue1$?l.options1$.indexOf(l.selectvalue1$):null;c.setOptions_(l.options1$,null,d),_.value=null!==(a=l.value1$)&&void 0!==a?a:"";const S=null!=l.selectvalue2$?l.options2$.indexOf(l.selectvalue2$):null;return u.setOptions_(l.options2$,null,S),h.value=null!==(r=l.value2$)&&void 0!==r?r:"",e.pop_(),e.up_(),[_,c,h,u]}static flexTextInput2_(t,e,i,n,s,o,l,a,r,_,c,h,u){t.flexTextContainer_(i,n).push_();let d=t.flexInput_(s,l,o);t.peek_().span_({class:CSS.AnFlex01Auto,style:"margin:0 5px"}).text_(r);let S=t.peek_().flexInput_(s,c,_);return t.peek_().span_({class:CSS.AnFlex01Auto,style:`min-width:${e+5}px`}).text_(u),d.value=a,S.value=h,t.pop_(),t.up_(),[d,S]}static onValidateFragment_(t,e){if(null!=e)for(let i=0,n=e.length;i<n;++i){const n=e[i];DEF.xmlNameChars.indexOf(n)<0&&t.push(MSG.string_(RS.InvalidCharacter_)+n)}}static confirmCancel_(t,e,i){e?DialogUt.confirmKeySmall_(t.container_(),RS.ConfirmDiscard,An.above_(t.element_()),t=>{t&&i()}):i()}}class PromptGradient extends CompositeDialogBase{constructor(t,e,i){super(t,[new SelectFIeld("",PromptGradient._KIND,PromptGradient.Kinds$[An.gradientKindOf(i.name,0)],RS.Gradient,PromptGradient.Kinds$),new InputField("",PromptGradient._ANGLE,i.position,RS.Orientation),new InputField("",PromptGradient._SIZE_POSITION,i.position,RS.SizePosition),new ColorStopsField("",PromptGradient._COLORS,e,i.colorstops),new SampleField(PromptGradient._SAMPLE,"")]),this._okCallback=null,this.titleKey_(RS.Gradient),this.setVisible_(PromptGradient._SIZE_POSITION,!1);const n=2*e;this._sample=new DomBuilderEx(this.getField_(PromptGradient._SAMPLE).element_()).div_(["class",CSS.AnFlex],["style",`width:50%;height:${n}px;margin:20px 0 10px 0;background-image:${this._gradient()};`]).cursor_(),An.onClick_(this._sample,()=>{this.blurAll()}),this.onChange_((t,e)=>{const i=t.spec$.key$;if(i==PromptGradient._KIND)this._setupKind(this._gradientKind());else if(i==PromptGradient._ANGLE){const t=e,i=t.value.trim();RX.Decimals.test(i)?t.value=`${i}deg`:RX.Sides2.test(i)&&(t.value=`to ${i}`)}this._sample.style.backgroundImage="",Timer.sleep0_(()=>{const t=this._gradient();this._sample.style.backgroundImage=t})})}onOK_(t){return this._okCallback=t,this}_setupKind(t){switch(t){case PromptGradient._KindLinear:case PromptGradient._KindRepeatingLinear:this.setVisible_(PromptGradient._ANGLE,!0),this.setVisible_(PromptGradient._SIZE_POSITION,!1);break;case PromptGradient._KindRadial:case PromptGradient._KindRadialEllipse:case PromptGradient._KindRadialCircle:case PromptGradient._KindRepeatingRadial:case PromptGradient._KindRepeatingRadialEllipse:case PromptGradient._KindRepeatingRadialCircle:this.setVisible_(PromptGradient._ANGLE,!1),this.setVisible_(PromptGradient._SIZE_POSITION,!0)}}_gradientKind(){const t=this.getField_(PromptGradient._KIND).getValueElement_(0);return null==t?-1:t.getSelectedIndex_()}_gradient(){switch(this._gradientKind()){case PromptGradient._KindLinear:return this._linearGradient("");case PromptGradient._KindRadial:return this._radialGradient("","");case PromptGradient._KindRadialEllipse:return this._radialGradient("","ellipse");case PromptGradient._KindRadialCircle:return this._radialGradient("","circle");case PromptGradient._KindRepeatingLinear:return this._linearGradient("repeating-");case PromptGradient._KindRepeatingRadial:return this._radialGradient("repeating-","");case PromptGradient._KindRepeatingRadialEllipse:return this._radialGradient("repeating-","ellipse");case PromptGradient._KindRepeatingRadialCircle:return this._radialGradient("repeating-","circle");default:return""}}_linearGradient(t){return`${t}linear-gradient(${An.joinNotEmpty_(", ",[this.getValue_(PromptGradient._ANGLE),this.getValue_(PromptGradient._COLORS)])})`}_radialGradient(t,e){const i=this.getValue_(PromptGradient._SIZE_POSITION),n=this.getValue_(PromptGradient._COLORS);let s=An.joinNotEmpty_(" ",[e,i]);return`${t}radial-gradient(${s=An.joinNotEmpty_(", ",[s,n])})`}_onOK(t){const e=this._gradient(),i=this._okCallback;t(!0),i(e)}}PromptGradient._KIND="#XdV",PromptGradient._CUSTOM="#Xi0",PromptGradient._SIZE_POSITION="#Xbf",PromptGradient._COLORS="#Xjt",PromptGradient._SAMPLE="#XgZ",PromptGradient._ANGLE="#XBd",PromptGradient._KindLinear=0,PromptGradient._KindRadial=1,PromptGradient._KindRadialEllipse=2,PromptGradient._KindRadialCircle=3,PromptGradient._KindRepeatingLinear=4,PromptGradient._KindRepeatingRadial=5,PromptGradient._KindRepeatingRadialEllipse=6,PromptGradient._KindRepeatingRadialCircle=7,PromptGradient.Kinds$=[MSG.string_(RS.GradientLinear),MSG.string_(RS.GradientRadial),MSG.string_(RS.GradientRadialEllipse),MSG.string_(RS.GradientRadialCircle),MSG.string_(RS.GradientRepeatingLinear),MSG.string_(RS.GradientRepeatingRadial),MSG.string_(RS.GradientRepeatingRadialEllipse),MSG.string_(RS.GradientRepeatingRadialCircle)];class FilepickerDelegate{}class FilepickerSuffixesDelegate extends FilepickerDelegate{getSuffixes_(){return null==this._suffixes&&(this._suffixes=this._getsuffixes()),this._suffixes}includes_(t,e){if(e.isdir$)return!1;const i=Basepath.lcSuffix_(t);return this.getSuffixes_().has(i)}validate_(t,e,i){if(this.includes_(t,e))return void i({});const n=Array.from(this.getSuffixes_().keys());ArrayUt.delete_(n,""),i(An.jsonError_(RS.ExpectingFileExt_,...n))}}class FilepickerExtsDelegate extends FilepickerSuffixesDelegate{_getsuffixes(){const t=new Map;return t.set("",null),FilepickerBase.addSuffixes(t,this._exts(),null),t}}class FilepickerKind{}FilepickerKind.ANY=new FilepickerKind,FilepickerKind.ANY_FILE=new FilepickerKind,FilepickerKind.ANY_DIR=new FilepickerKind,FilepickerKind.EXISTING_ANY=new FilepickerKind,FilepickerKind.EXISTING_FILE=new FilepickerKind,FilepickerKind.EXISTING_DIR=new FilepickerKind,FilepickerKind.NEW_FILE=new FilepickerKind,FilepickerKind.WRITE_FILE=new FilepickerKind;class FilepickerBase{constructor(t,e,i){this._container=t,this._handler=i,this._suffixSelect=null,this._contextmenu=null,this._currentDir="",this._suffices=new Map,this._dirpath=null,this._dirtree=null,this._localClipboard=new AnClipboard,this._clipboardGetter=null,this._clipboardSetter=null,this._fileSelectedCallback=null,this._filterRootsCallback=null,this._delegate=null,this._selected=null;let n=null==e?null:An.removeTrailingSlashes_(Basepath.cleanFilepath_(e));null==n||0==n.length||"/"==n?this._rootDir=[]:(n.startsWith("/")&&(n=n.substring(1)),this._rootDir=n.split("/")),this._canChangeDir=0==this._rootDir.length}clearLocalClipboard_(){this._localClipboard.clear_()}canChangeDir_(t){this._canChangeDir=t}useShortcut_(){return!0}populateFilepicker_(t,e,i,n,s){this._dirrootsButton=t,this._filenameInput=e,this._suffixSelect=i,this._dirpathPanel=n,this._dirtreePanel=s}get currentDir$(){return this._currentDir}get filenameInput$(){return this._filenameInput}get dirrootsButton$(){return this._dirrootsButton}get dirpathPanel$(){return this._dirpathPanel}get dirtreePanel$(){return this._dirtreePanel}get contextmenu$(){return this._contextmenu}get suffices$(){return this._suffices}currentPath_(t){return null==t||0==t.length?this._currentDir:t.startsWith("/")?t:Basepath.joinPath_(this._currentDir,t)}isRoot_(t){return null!=this._dirpath&&this._dirpath.length>0&&t.includes(this._dirpath[0].name_())}rootInfo_(){var t;return null!=this._dirpath&&this._dirpath.length>0&&null!==(t=this._dirpath[0])&&void 0!==t?t:null}currentDirInfo_(){var t;return null!=this._dirpath&&this._dirpath.length>0&&null!==(t=ArrayUt.last_(this._dirpath))&&void 0!==t?t:null}setSuffixes_(t){this._suffices=new Map(t.entries()),null!=this._suffixSelect&&(this._suffixSelect.setOptions_(Array.from(t.keys()).sort(suffixSorter)),this._suffixSelect.element_().style.display="block",this.updateToolbarState_(this._dirtree))}showContextmenu_(t){null==this._contextmenu&&(this._contextmenu=this.createContextmenu_()),this._contextmenu.show_(t)}hideContextmenu_(){null!=this._contextmenu&&this._contextmenu.hide_()}recreateContextmenu_(){null!=this._contextmenu&&(this._contextmenu.destroy_(),this._contextmenu=this.createContextmenu_())}onDirInfo_(t){const e=this.currentPath_(t);this._handler.dirInfo_(e,e=>{if(toasters$.warn_(e))return;const[i,n,s]=e[Key.result];toasters$.modal_((e,o)=>{new ToasterInfoBuilder(e,o).build_(e=>{e.tr1_(t,{colspan:"2",style:"font-weight:bold;"}),e.tr1_("",{colspan:"2",style:"height: 5px;"}),e.trKey_(RS.Files,`${i}`),e.trKey_(RS.Dirs,`${n}`),e.trKey_(RS.Size,An.filesizeUnit4_(s))})})})}promptSimpleName_(t,e,i,n){const s=new PromptInput(this._container,t,i);return s.message_(e),s.onOK_(n),s}promptRename_(t,e,i,n){const s=i.suffix$,o=s.toLowerCase(),l=s.toUpperCase(),a=[s];return o!=s&&a.push(o),l!=s&&a.push(l),new CompositeDialog(this._container,[new InputSelectField("","#X8g",i.nameWithoutSuffix$,RS.Filename,s,a)]).titleKey_(t).message_(e).onOK_((t,e)=>{n(t,t.getValueAt_(0),e)})}setupEventHandlers(){An.onKeypress_(this.filenameInput$,t=>{"Enter"==t.key&&(An.stopevent_(t),this._handler.listDir_(this.currentPath_(this.getFilename()),t=>{this.refresh_(t)}))}),An.listeners_(this.filenameInput$).add_("focus",()=>{this.clearStatus(),Timer.sleep0_(()=>{An.select_(this.filenameInput$)})}).add_("click",()=>{this.clearStatus()}),this.dirrootsButton$.addEventListener("click",t=>{An.stopevent_(t),this._rootDir.length>0||this._handler.listDir_("",t=>{var e;null===(e=this._filterRootsCallback)||void 0===e||e.call(this,t),t[Key.filename]=null,this.refresh_(t)})}),An.addClickListenerMatching_(this.dirpathPanel$,"a",(t,e)=>{An.stopevent_(e);const i=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1),n=Array.from(this._rootDir);if(null!=this._dirpath)for(let t=this._rootDir.length;t<=i&&t<this._dirpath.length;++t)n.push(this._dirpath[t].name_());this._currentDir="/"+n.join("/"),this._handler.listDir_(this._currentDir,t=>{t[Key.filename]=null,this.refresh_(t)})});const t=t=>{const e=t.classList;if(this.useShortcut_()&&e.contains(CSS.AnFileInfo)){const e=this._getname(t);null!=e&&this.onFileInfo_(e)}else if(this.useShortcut_()&&e.contains(CSS.AnDirInfo)){const e=this._getname(t);null!=e&&this.onDirInfo_(e)}else if(e.contains(CSS.AnDir)){const e=this._getname(t);null!=e&&this._handler.listDir_(this.currentPath_(e),t=>{t[Key.filename]=null,this.refresh_(t)})}else if(e.contains(CSS.AnFile)){const e=this.select_(t);null!=this._fileSelectedCallback&&this._fileSelectedCallback(e)}};An.addClickListenerMatching_(this.dirtreePanel$,`div.${CSS.AnPromptContent}>div`,(e,i)=>{An.stopevent_(i);const n=DomUt.asHTMLElement_(i.target);if(null!=n&&(n.classList.contains(CSS.AnFileInfo)||n.classList.contains(CSS.AnDirInfo)))t(n);else{const i=DomUt.query_(e,`.${CSS.AnFile}, a.${CSS.AnDir}`);null!=i&&t(i)}})}onFilterRoots_(t){return this._filterRootsCallback=e=>{const i=e[Key.dirtree];null!=i&&(e[Key.dirtree]=i.filter(e=>t(FileInfo.of_(e))))},this}select_(t){var e,i,n;let s=null!==(i=null===(e=this._getname(t))||void 0===e?void 0:e.trim())&&void 0!==i?i:"";const o=null===(n=t.parentElement)||void 0===n?void 0:n.parentElement;return null!=o&&(null!=this._selected&&this._selected.classList.remove(CSS.AnSelectedHighlight),o==this._selected?(this._selected=null,s=""):(o.classList.add(CSS.AnSelectedHighlight),this._selected=o)),this.setFilename(s),s}deselect_(){null!=this._selected&&(this._selected.classList.remove(CSS.AnSelectedHighlight),this._selected=null)}onFileSelected_(t){return this._fileSelectedCallback=t,this}onPaste(t){return this._clipboardGetter=t,this}onCopy(t){return this._clipboardSetter=t,this}_getname(t){const e=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);return null!=this._dirtree&&e>=0&&e<this._dirtree.length?this._dirtree[e].name_():null}updateContextmenuState_(){const t=()=>{let t=null;if(null!=this._dirpath){const e=this._dirpath.length;t=e>1?this._dirpath[e-2]:null}const e=this.getFilename();if(0==e.length){const e=this.currentDirInfo_();return void this.updateContextmenuStateWithoutFilename(t,e,this._currentDir)}const i=this.dirtreeFind(e),n=this.currentDirInfo_();this.updateContextmenuStateWithFilename(t,n,i,this._currentDir)},e=this.getFilename();e.includes("/")&&this._handler.listDir_(this.currentPath_(e),e=>{this.refresh_(e,()=>{t()})}),t()}updateContextmenuStateWithFilename(t,e,i,n){const s=this._contextmenu;if(null!=s)if(null==e||e.notexists$)s.enableButtons_([BUT.CopyFile,BUT.CutFile,BUT.PasteFile,BUT.Mkdir,BUT.RenameFile,BUT.DeleteFile,BUT.DeleteEmptyDirs],!1),s.enableButtonIfExists_(BUT.CloneFile,!1);else{const n=null!=i&&i.exists$,o=null!=i&&i.isdir$,l=e.writable$,a=n&&!o,r=n&&!o&&l,_=l&&!this._localClipboard.isEmpty_(),c=l,h=null==this._dirtree||0==this._dirtree.length,u=null!=t&&t.writable$,d=h&&u||!h&&l,S=n&&!o&&l;s.enableButton_(BUT.CopyFile,a),s.enableButton_(BUT.CutFile,r),s.enableButton_(BUT.PasteFile,_),s.enableButton_(BUT.Mkdir,c),s.enableButton_(BUT.RenameFile,S),s.enableButton_(BUT.DeleteFile,d),s.enableButton_(BUT.DeleteEmptyDirs,d),s.enableButtonIfExists_(BUT.CloneFile,_)}}updateContextmenuStateWithoutFilename(t,e,i){const n=this._contextmenu;if(null!=n)if(null==e||e.notexists$)n.enableButtons_([BUT.CopyFile,BUT.CutFile,BUT.PasteFile,BUT.Mkdir,BUT.RenameFile,BUT.DeleteFile,BUT.DeleteEmptyDirs],!1),n.enableButtonIfExists_(BUT.CloneFile,!1);else{const i=null==this._dirtree||0==this._dirtree.length,s=e.writable$,o=null!=t&&t.writable$,l=!i,a=!i&&s,r=!this._localClipboard.isEmpty_()&&s,_=s,c=i&&o||!i&&s,h=o;n.enableButton_(BUT.CopyFile,l),n.enableButton_(BUT.CutFile,a),n.enableButton_(BUT.PasteFile,r),n.enableButton_(BUT.DeleteFile,c),n.enableButton_(BUT.Mkdir,_),n.enableButton_(BUT.RenameFile,h),n.enableButton_(BUT.DeleteEmptyDirs,c),n.enableButtonIfExists_(BUT.CloneFile,r)}}dirtreeFind(t){if(null!=this._dirtree)for(const e of this._dirtree)if(t==e.name_())return e;return FileInfo.NOT_EXISTS}_sanitizeDirpath(t){const e=this._rootDir.length;if(0==e)return!0;if(null==t||t.length<e)return!1;for(let i=0,n=e;i<n;++i)if(this._rootDir[i]!=t[i].name_())return!1;return!0}refreshCurrentDir_(){Timer.sleep0_(()=>{this._handler.listDir_(this.currentDir$,t=>this.refresh_(t))})}refresh_(t,e=null){this._refresh1(t),this.updateToolbarState_(this._dirtree),null==e||e()}_refresh1(t){var e;if(null==this.element_())return;if(null==t)return;if(toasters$.warn_(t))return;toasters$.warn_(t[Key.warns]);const i=FileInfo.arrayOf_(t[Key.dirpath]);if(null==i||!this._sanitizeDirpath(i))return;const n=t[Key.path],s=FileInfo.arrayOf_(t[Key.dirtree]);if(null==n||null==s)return;this._currentDir=n,this._dirpath=i,this._dirtree=s;const o=null!==(e=t[Key.filename])&&void 0!==e?e:null;null!=this.filenameInput$&&null!=o&&void 0!==o&&this.setFilename(o.trim()),this._refreshdirtree(new DomBuilderEx(this.dirtreePanel$),this._dirtree),null!=this.dirpathPanel$&&this._refreshdirpath(new DomBuilderEx(this.dirpathPanel$),this._dirpath)}_refreshdirpath(t,e){if(t.empty_(),null==e)return;t.push_();const i=this._rootDir.length,n=e.length;for(let s=0;s<n;++s){const o=e[s],l=o.name_(),a=o.readable$;s>0&&t.text_(" / "),!a||s==n-1||!this._canChangeDir||this._canChangeDir&&s<i-1?t.text_(l):t.a_(["class",CSS.AnDirpathDir],[ATTR.AnInfo,s.toString()]).text_(l).up_()}t.pop_()}_refreshdirtree(t,e){if(this._selected=null,t.empty_(),null==e)return;const i=DomBuilderEx.offline1_(document,"div",CSS.AnViewportContent);i.push_().div_({class:`${CSS.AnPromptContent} ${CSS.AnZebra}`,style:`border-bottom:${DEF.themeBorder}`}).push_();const n=e.length,s=DateTime.now_(),o=DateTime.local_(s.year$-1,s.month$,s.day$,s.hour$,s.minute$,s.second$);for(let t=0;t<n;++t){const n=e[t],s=n.readable$,l=n.isdir$,a=n.name_(),r=l?FileInfo.SIZEUNIT_DIR:n.sizeunit$,_=this.fileDateString_(o,n.date$);i.peek_().div_().div_().push_();const c=t.toString();s?!l&&null!=this._delegate&&!this._delegate.includes_(a,n)||l&&!this._canChangeDir?i.code_().text_(r+_).pop_().span1_(CSS.AnDisabled).text_(a):l?(this.useShortcut_()?i.a_(["class",CSS.AnDirInfo],[ATTR.AnInfo,c]).text_(r).peek_().code_().text_(_):i.addClass_(CSS.AnLink).code_().text_(r+_),i.pop_().a_(["class",CSS.AnDir],[ATTR.AnInfo,c]).text_(a)):(this.useShortcut_()?i.a_(["class",CSS.AnFileInfo],[ATTR.AnInfo,c]).text_(r).peek_().code_().text_(_):i.code_().text_(r+_),i.pop_().span_(["class",CSS.AnFile],[ATTR.AnInfo,c]).text_(a)):(n.notexists$?i.addClass_(CSS.AnNot):i.addClass_(CSS.AnErr),i.code_().text_(r+_).pop_().text_(a))}t.appendNodes_(i.pop_(2).cursor_())}clearStatus(){toasters$.hideAll_()}setFilename(t){if(t=t.trim(),null==this._suffixSelect||this._suffixSelect.isReadonly$)this.filenameInput$.value=t;else{const e=Basepath.suffix_(t),i=e.toLowerCase();null!=this._suffices&&this._suffices.has(i)?(this._suffices.has(e)||(this._suffices.set(e,this._suffices.get(i)),this._suffixSelect.setOptions_(Array.from(this._suffices.keys()).sort(suffixSorter))),this._suffixSelect.setValue_(e),this.filenameInput$.value=t.substring(0,t.length-e.length)):(this._suffixSelect.setValue_(""),this.filenameInput$.value="")}this.updateToolbarState_(this._dirtree)}getFilename(){var t,e,i;if(null==this._filenameInput)return"";const n=this._filenameInput.value.trim();return 0==n.length?"":null==this._suffices||1==(null===(t=this._suffixSelect)||void 0===t?void 0:t.isReadonly$)?n:n+(null!==(i=null===(e=this._suffixSelect)||void 0===e?void 0:e.getValue_(""))&&void 0!==i?i:"")}actionMkdir(t){const e=this.getFilename(),i=new Basepath(e),n=this.promptSimpleName_(RS.MkdirTitle,null,i.nameWithoutSuffix$,(t,e,i)=>{if(0==(e=e.trim()).length||"."==e)return n.warn_(MSG.string_(RS.InputMustNotBeEmpty)),void i(!1);if(An.isDotOnly_(e)||e.indexOf("/")>=0)return n.warn_(MSG.string_(RS.InvalidDirectoryName_)+e),void i(!1);i(!0);const s=this.dirtreeFind(e);if(null!=s&&s.exists$)return void toasters$.warnKey_(RS.DestinationAlreadyExists);const o=this.currentPath_(e);this._handler.mkDirs_(o,t=>{toasters$.warn_(t)||this.refresh_(t)})});n.above_(t),n.show_()}actionDelete(){if(null==this._dirtree)return;const t=this.getFilename();0!=this._dirtree.length?this._handler.deleteInfo_(this._currentDir,e=>{if(toasters$.warn_(e[Key.errors]))return;const i=new PromptDelete(this._container,this._handler,this._currentDir,t,e);i.titleKey_(RS.Confirm),i.zindex_(Math.max(DEF.zindexPrompt,An.above_(this.element_()))),i.onOK_(t=>{if(toasters$.warn_(t))return;toasters$.warn_(t[Key.warns]);const e=t[Key.result];null==e?toasters$.ok_(MSG.format1_(RS.deletedEverything,this._currentDir),{attop:!0}):toasters$.ok_(MSG.format1_(RS.deletedFiles,`${e.length}`),{attop:!0}),this.refresh_(t)}),i.show_()}):this._delete1(this._currentDir,MSG.format1_(RS.deleteEmptyDirectory,this._currentDir))}_delete1(t,e){DialogUt.confirmSmall_(this._container,e,An.above_(this.element_()),e=>{e&&this._handler.delete_(t,t=>{toasters$.warn_(t)||(toasters$.warn_(t[Key.warns]),this.refresh_(t))})})}actionDeleteEmptyDirs(){DialogUt.confirmSmall_(this._container,MSG.string_(RS.ConfirmDeletingEmptyDirectories),An.above_(this.element_()),t=>{t&&this._handler.deleteEmptyDirs_(this.currentDir$,t=>{toasters$.warn_(t)||(toasters$.ok_(t[Key.result],{attop:!0}),this.refresh_(t))})})}actionRename(){const t=this.getFilename(),e=t.length>0;let i=null;if(e&&(null==(i=this.dirtreeFind(t))||!i.exists$))return void toasters$.warn_([MSG.string_(RS.SourceNotFound),t]);const n=e?this.currentPath_(t):this._currentDir;!e||null!=i&&i.isdir$?this.renameDir_(n):this.renameFile_(n)}rename1_(t,e){this._handler.rename_(t,e,t=>{toasters$.warn_(t)||this.refresh_(t)})}actionCopy(){const t=this._actionCopy1();toasters$.info_(MSG.string_(RS.Copy_)+t,{attop:!1})}_actionCopy1(){const t=this.getFilename(),e=this.currentPath_(t)+(0==t.length?"/":"");return this._localClipboard.map_(map_([ATTR.AnAction,BUT.CopyFile],["path",e])),this.toClipboard_(e),e}actionCutFile(){const t=this._actionCutFile1();toasters$.info_(MSG.string_(RS.Cut_)+t,{attop:!1})}_actionCutFile1(){const t=this.getFilename(),e=this.currentPath_(t)+(0==t.length?"/":"");return this._localClipboard.map_(map_([ATTR.AnAction,BUT.CutFile],["path",e])),this.toClipboard_(e),e}actionPaste(t){const e=this._localClipboard.get_();if(null==e||e.get(MapClipboardKey.kind)!=MapClipboardKind.map)return void toasters$.warnKey_(RS.ClipboardIsEmptyOrInvalid);const i=e.get(ATTR.AnAction),n=e.get("path");if(i!=BUT.CopyFile&&i!=BUT.CutFile||void 0===n)return void toasters$.warnKey_(RS.PromptCopyInvalidClipboardContent);const s=i==BUT.CutFile;this._handler.copyInfo_(s,this._currentDir,n,e=>{var i,o,l;if(toasters$.warn_(e))return;const a=Object.keys(null!==(i=e[Key.overwriting])&&void 0!==i?i:{}),r=Object.keys(null!==(o=e[Key.copying])&&void 0!==o?o:{}),_=null!==(l=e[Key.notcopying])&&void 0!==l?l:{},c=Object.keys(_).length,h=!n.endsWith("/")&&r.length+c+a.length==1,u=h&&0==r.length&&0==c&&1==a.length,d=_[MSG.string_(RS.DestinationNotWritable)],S=h&&0==r.length&&0==a.length&&1==c&&void 0!==d&&1==d.length;if(h){const e=u?a[0]:S&&void 0!==d?d[0]:r[0],i=S?MSG.string_(RS.PromptCopyNotWritable1):u?MSG.string_(RS.PromptCopyOverwrite1):MSG.string_(RS.PromptCopy1);return void this.pasteFile1_(s,t,i,this._currentDir,e,n,t=>{toasters$.warn_(t)||(toasters$.warn_(t[Key.warns]),toasters$.okKey_(s?RS.Moved1file:RS.Copied1file,{attop:!0}),s&&this._localClipboard.clear_(),this.refresh_(t))})}const p=new PromptCopy(this._container,this._handler,s,t,this._currentDir,n,e);p.titleKey_(RS.PromptPasteTitle),p.zindex_(Math.max(DEF.zindexPrompt,An.above_(this.element_()))),p.onCancel_(()=>{toasters$.infoKey_(RS.PromptCopyCancelled)}),p.onOK_(t=>{if(toasters$.warn_(t))return;toasters$.warn_(t[Key.warns]);const e=t[Key.result],i=null!=e?e.length:0,n=s?1==i?MSG.string_(RS.Moved1file):MSG.format1_(RS.Moved_files,`${i}`):1==i?MSG.string_(RS.Copied1file):MSG.format1_(RS.Copied_files,`${i}`);toasters$.ok_(n,{attop:!0}),s&&this._localClipboard.clear_(),this.refresh_(t)}),p.show_()})}renameFileValidator(t,e,i){if(t==e.nameWithSuffix$)return void i(MSG.string_(RS.CannotRenameToSelf),t);if(t.includes("/"))return void i(MSG.string_(RS.ExpectingSimpleFilename),t);if(Basepath.lcSuffix_(t)!=e.lcSuffix$)return void i(MSG.string_(RS.CannotChangeFileExt),t);const n=this.dirtreeFind(t);null!=n&&n.isdir$?i(MSG.string_(RS.DestinationMustBeAFile),t):null!=n&&n.exists$?DialogUt.confirmOverwriting_(t,e=>{const n=e?null:MSG.string_(RS.NotOverwritingDestination);i(n,t)}):i(null,t)}pasteFileValidator(t,e,i,n){const s=new Basepath(null==e?t:e+"/"+t);if(s.path$==i)return void n(MSG.string_(RS.CannotCopyToSelf),i);if(t.includes("/"))return void n(MSG.string_(RS.ExpectingSimpleFilename),t);if(s.lcSuffix$!=Basepath.lcSuffix_(i))return void n(MSG.string_(RS.CannotChangeFileExt),t);const o=this.dirtreeFind(t);null!=o&&o.isdir$?n(MSG.string_(RS.DestinationMustBeAFile),t):null!=o&&o.exists$?DialogUt.confirmOverwriting_(t,e=>{const i=e?null:MSG.string_(RS.NotOverwritingDestination);n(i,t)}):n(null,t)}static renameDirValidator(t,e){return t==e?MSG.string_(RS.CannotRenameToSelf):t.indexOf("/")>=0?MSG.string_(RS.ExpectingSimpleFilename):null}static addSuffixes(t,e,i){for(const n of e)t.set("."+n,i)}static cleanContextPath(t){return(t=Basepath.cleanFilepath_(t)).startsWith("/")||(t="/"+t),t}}class FilepickerDialogBase extends FilepickerBase{constructor(t,e,i,n,s,o,l,a){super(t,i,a),this._mode=e,this._startFilename=o,this._gestureHandler=l,this._dateFormat=DateFormat.DEF,this._docDir=null,this._smokescreen=null,this._maxWidth=DEF.filepickerMaxWidth,this._cancelCallback=null,this._helpCallback=null,this._viewCallback=null,this._resizer=null,this._dragger=null,this._dragstartCallback=null,this._resizeSubscription=null,this._zindex=DEF.zindexPrompt,_destroyed_10.set(this,!1),this._docDir=null==n?null:An.removeTrailingSlashes_(n),this._startDir=An.removeTrailingSlashes_(Basepath.cleanFilepath_(s)),this._currentDir=this._startDir}createDialog_(t){const e=new DomBuilderEx(this._container);this._dialog=e.div1_(CSS.AnDialog,CSS.AnFilepicker).cursor_(),e.table1_(CSS.AnFilepicker),this._toolbar=this.createToolbar_(e,t),this._createFilepicker(e),this._resizer=()=>this.defaultResizeFunction_(),this._dragstartCallback=(t,e)=>{const i=DomUt.asHTMLElement_(e);return null!=i&&"TABLE"==i.nodeName&&i.classList.contains(CSS.AnFilepicker)},this._todayButton.addEventListener("click",t=>{An.stopevent_(t),this.deselect_(),this._filenameInput.value=An.simpleDateString_()}),An.onClick_(this._clearButton,()=>{this._filenameInput.value="",null!=this._suffixSelect&&this._suffixSelect.setValue_(""),this.deselect_()}),this._mode==FilepickerKind.EXISTING_FILE&&(An.hide_(this._clearButton),this._clearButton.style.display="none",null!=this._suffixSelect&&(this._suffixSelect.element_().style.marginRight="0px")),this._mode!=FilepickerKind.EXISTING_FILE&&this._mode!=FilepickerKind.EXISTING_DIR&&this._mode!=FilepickerKind.EXISTING_ANY&&An.show_(this._todayButton,"block"),this.setupEventHandlers()}_createFilepicker(t){t.push_().tr_().td_();const e=t.div_({class:CSS.AnFlexStretch,style:"margin-top: 1ex;"}).child_(Conf.input,smap_(["class",`${CSS.AnFilename} ${CSS.AnFlex11Auto}`],["rows","1"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])).cursor_(),i=this._mode==FilepickerKind.EXISTING_FILE||this._mode==FilepickerKind.EXISTING_DIR||this._mode==FilepickerKind.EXISTING_ANY,n=new SelectOptions(this._container,t.up_().div_({class:CSS.AnPromptSelectExt,style:"display:none;margin-left:5px;margin-right:5px"}).cursor_(),i);i&&(e.readOnly=!0,e.classList.add(CSS.AnDisabled),n.element_().classList.add(CSS.AnDisabled)),n.onChange_(t=>{var e;const i=null!==(e=this._suffices.get(t))&&void 0!==e?e:null;null!=i&&toasters$.infoKey_(i,{attop:!1})}),this._todayButton=t.up_().button_(["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaFlag}`],["style","min-height:unset;display:none"],[ATTR.xTooltips,RS.Tooltips_Today]).cursor_(),this._clearButton=t.up_().button_(["class",`${CSS.AnButton1} ${CSS.Fa} ${CSS.FaTimesCircle}`],["style","min-height:unset"],[ATTR.xTooltips,RS.Tooltips_Clear]).cursor_(),t.pop_(),t.push_().tr_().td_().push_(),t.peek_().div_({class:CSS.AnDirpath,style:"padding-left:0;margin:0.5ex 0;"}).push_();const s=t.div_(["class",`${CSS.AnFlexButton} ${CSS.AnLink} ${CSS.Fa} ${CSS.FaBookmarkO}`+(0==this._rootDir.length?"":" "+CSS.AnDisabled)],[ATTR.xTooltips,RS.Tooltips_RootFolder]).cursor_(),o=t.pop_().div1_(CSS.AnDirpathDir).cursor_();t.pop_().pop_();const l=t.push_().tr_().td_().div_(["class",CSS.AnDirtree]).cursor_();t.pop_(),this.populateFilepicker_(s,e,n,o,l)}createContextmenu_(){const t=new Contextmenu(this._container,An.above_(this._dialog),[[BUT.info_(BUT.CopyFile),BUT.info_(BUT.CutFile),BUT.info_(BUT.PasteFile)],[BUT.info_(BUT.DeleteFile),BUT.info_(BUT.Mkdir),BUT.info_(BUT.RenameFile)],[BUT.info_(BUT.DeleteEmptyDirs),BUT.info_(BUT.CurrentDocument),BUT.info_(BUT.TargetDocument)]]);return t.onTooltips_(toasters$.onTooltipsKey_),t.onDrag_(Contextmenu.contextmenuDragOK_),t.onShow_(()=>this.updateContextmenuState_()),t.onAction_(t=>this.contextActions_(t)),t}fileDateString_(t,e){return""+DateFormat.dateStringFromMs(this._dateFormat,e)+""}toClipboard_(t){}renameDir_(t){const e=Basepath.nameWithoutSuffix_(t),i=this.promptSimpleName_(RS.RenameTitle,MSG.string_(RS.RenameMessage),e,(i,n,s)=>{n=n.trim(),i.warn_(FilepickerBase.renameDirValidator(n,e))?s(!1):(s(!0),this.rename1_(t,n))});i.above_(this._dialog),i.show_()}renameFile_(t){const e=new Basepath(t),i=this.promptRename_(RS.RenameTitle,MSG.string_(RS.RenameMessage),e,(i,n,s)=>{n=n.trim(),this.renameFileValidator(n,e,(n,o)=>{if(i.warn_(n))return void s(!1);s(!0);const l=this.dirtreeFind(o);if(null!=l&&l.exists$&&!l.isdir$){const i=e.changeNameWithSuffix_(o).path$;this._handler.delete_(i,e=>{toasters$.warn_(e)||this.rename1_(t,o)})}else this.rename1_(t,o)})});i.above_(this._dialog),i.show_()}pasteFile1_(t,e,i,n,s,o,l){const a=this.promptRename_(RS.PromptPasteTitle,i,new Basepath(s),(i,s,a)=>{s=s.trim(),this.pasteFileValidator(s,n,o,(n,s)=>{if(i.warn_(n))return void a(!1);a(!0);const r=this.currentPath_(s);this._handler.copy_(t,e,r,o,null,l)})});a.above_(this._dialog),a.show_()}updateContextmenuState_(){With.optional_(this.contextmenu$,t=>{t.enableButton_(BUT.CurrentDocument,null!=this._docDir),t.enableButton_(BUT.TargetDocument,null!=this._startDir)}),super.updateContextmenuState_()}updateToolbarState_(t){if(null!=t&&null!=this._viewCallback){let e=!1;for(const i of t)if(MimeUtil.isImagePath(i.name_())&&i.readable$){e=!0;break}this._toolbar.enableButton_(BUT.PickImage,e)}}element_(){return this._dialog}disableContextmenu_(){return this._toolbar.enableButton_(BUT.Contextmenu,!1),this}onHelp_(t){return this._helpCallback=t,this._toolbar.showButton_(BUT.Help,!0),this}zindex_(t){return this._zindex=t,this._dialog.style.zIndex=`${t}`,this}above_(t,e=DEF.zindexAbove10){return this.zindex_(An.zindexOf_(t,e,DEF.zindexUnder+e))}dateFormat_(t){return this._dateFormat=t,this}setDelegate_(t){return this._delegate=t,this.setSuffixes_(t.getSuffixes_()),this}onCancel_(t){return this._cancelCallback=t,this}onView_(t){return this._viewCallback=t,this._toolbar.enableButton_(BUT.PickImage,null!=t),this}onResize_(t){return this._resizer=()=>{t(this)},this}onDragstart_(t){return this._dragstartCallback=t,this}maxWidth_(t){return this._maxWidth=t,this}show_(){Assert.assertionKey_(null!=this._zindex,RS.ZIndex),Assert.assertionKey_(null!=this._delegate,RS.ADelegateIsRequired);const t=this.dirtreePanel$.style;t.height="0px",t.maxHeight="0px",An.showHidden_(this._dialog,"block"),this.updateToolbarState_(this._dirtree);const e=this._resizer;return null==e&&Assert.fail_(),this._resizeSubscription=An.subscriptEvent_(window,"resize",()=>e()),this._smokescreen=new Smokescreen(this._container,An.zindexOf_(this._dialog,DEF.zindexUnder,DEF.zindexPrompt+DEF.zindexUnder)),this._smokescreen.on_("click",t=>{e(),An.stopevent_(t)}),this._smokescreen.show_(),this._handler.listDir_(this._currentDir,t=>{An.hasMessage_(t[Key.errors])?this._handler.listDir_("",t=>{t[Key.filename]=null,this.show1_(t,e)}):this.show1_(t,e)}),this}show1_(t,e){null!=this._dialog&&(t[Key.filename]=this._startFilename,this.refresh_(t),An.setVisible_(this.element_()),e(),null==this._dragger&&null!=this._dragstartCallback&&(this._dragger=new Dragger(this._dialog,new VerticalDraggerHandler(this._dragstartCallback)).bind_()))}defaultResizeFunction_(){const t=this.element_();if(null==t)return;const e=window.innerWidth,i=window.innerHeight,n=e/16,s=Math.round(this._toolbar.element_().getBoundingClientRect().height),o=s/DEF.dragBorderDivider,l=2*DEF.dialogPaddingWidth+o;let a=e-2*n-l;null!=this._maxWidth&&(a=Math.min(this._maxWidth+l,a));const r=e-(a+l);let _=n;r>2*n&&(_=r/2),An.setLeftTop_(t,_,2*s);const c=DomUt.query_(t,`div.${CSS.AnDirtree}`);if(null==c)return;const h=i-An.documentOffset_(c).y-s-10-o/2-8-2,u=`${a}px`;for(const e of Array.from(DomUt.queryAll_(t,`table.${CSS.AnFilepicker} > tr > td`))){const t=e.style;t.width=u,t.maxWidth=u}const d=`${h}px`,S=c.style;S.height=d,S.maxHeight=d}defaultResizeViewFunction_(t,e){const i=this.element_();if(null==i)return;const n=window.innerWidth,s=window.innerHeight;An.setLeftTop_(i,0,0);const o=n,l=DomUt.query_(i,`div.${CSS.AnDirtree}`);if(null==l)return;const a=s-An.documentOffset_(l).y-10-1-8-2,r=`${o}px`;for(const t of Array.from(DomUt.queryAll_(i,`table.${CSS.AnFilepicker} > tr > td`))){const e=t.style;e.width=r,e.maxWidth=r}const _=`${a}px`,c=l.style;c.height=_,c.maxHeight=_}getButton_(t){return this._toolbar.button_(t)}close_(){__classPrivateFieldGet(this,_destroyed_10)||(__classPrivateFieldSet(this,_destroyed_10,!0),An.hide_(this._dialog),null!=this._smokescreen&&(this._smokescreen.destroy_(),this._smokescreen=null),null!=this._dragger&&(this._dragger.destroy_(),this._dragger=null),null!=this._resizeSubscription&&(this._resizeSubscription.cancel_(),this._resizeSubscription=null),null!=this._contextmenu&&(this._contextmenu.destroy_(),this._contextmenu=null),this._dialog.remove(),this._cancelCallback=null,this._helpCallback=null,this._viewCallback=null,this._dragstartCallback=null,this._fileSelectedCallback=null)}pickImage_(){const t=new Imagepicker(document.body,RS.PickImage,this._gestureHandler,new LocalMediaInfoHandler(this._currentDir,this._handler));t.above_(this._dialog),t.setFilename_(this.getFilename()),t.onOK_(t=>{var e;const i=t.title_();this.setFilename(null!==(e=null==i?void 0:i.trim())&&void 0!==e?e:"")}),t.onView_(this._viewCallback),t.show_()}contextActions_(t){switch(With.optional_(this.contextmenu$,t=>{t.hide_(),t.enableButtons_([BUT.DeleteFile,BUT.Mkdir,BUT.RenameFile],!1)}),t){case BUT.CopyFile:this.actionCopy();break;case BUT.CutFile:this.actionCutFile();break;case BUT.PasteFile:this.actionPaste(!1);break;case BUT.DeleteFile:this.actionDelete();break;case BUT.Mkdir:this.actionMkdir(this._dialog);break;case BUT.RenameFile:this.actionRename();break;case BUT.DeleteEmptyDirs:this.actionDeleteEmptyDirs();break;case BUT.CurrentDocument:null!=this._docDir&&this._handler.listDir_(this._docDir+"/"+this.getFilename(),t=>{toasters$.warn_(t)||this.refresh_(t)});break;case BUT.TargetDocument:this._handler.listDir_(this._startDir+"/"+this.getFilename(),t=>{toasters$.warn_(t)||this.refresh_(t)});break;default:Assert.invalidAction_(t)}}actionPaste_(){null!=this._clipboardGetter&&this._clipboardGetter(t=>{if(!toasters$.warn_(t[Key.errors])){const e=this.getFilename(),i=this.filenameInput$.selectionStart,n=this.filenameInput$.selectionEnd,s=i<=n?i:n,o=e.substring(0,s),l=e.substring(s),a=t[Key.result];this.setFilename((o+a+l).trim())}})}actionHelp_(){null!=this._helpCallback&&toasters$.modal_(this._helpCallback)}}_destroyed_10=new WeakMap;class Filepicker extends FilepickerDialogBase{constructor(t,e,i,n,s,o,l,a,r){super(t,i,n,s,o,l,a,r),this._okCallback=null,this._toolbarActions=(t,e)=>{switch(t){case BUT.OK:this._actionOK(this.getFilename());break;case BUT.Cancel:const i=this._cancelCallback;this.close_(),Timer.optional0_(i,t=>t());break;case BUT.PickImage:this.pickImage_();break;case BUT.Contextmenu:this.showContextmenu_(e);break;case BUT.PasteFromLocalClipboard:this.actionPaste_();break;case BUT.Help:this.actionHelp_();break;default:Assert.invalidAction_(t)}},super.createDialog_(e)}static withTitleKey_(t,e,i,n,s,o,l,a,r){return new Filepicker(t,MSG.string_(e),i,n,s,o,l,a,r)}onOK_(t){return this._okCallback=t,this}onFileInfo_(t){this._actionOK(t.trim())}createToolbar_(t,e){t.push_().tr_().td_();const i=new Toolbar(t.cursor_(),[BUT.info_(BUT.Help),BUT.info_(BUT.Contextmenu),BUT.info_(BUT.PickImage),BUT.info_(BUT.Backup),BUT.info_(BUT.Restore),BUT.info_(BUT.OK),BUT.info_(BUT.Cancel)]);return i.onAction_(this._toolbarActions),i.onTooltips_(toasters$.onTooltipsKey_),i.titleText_(e),t.pop_(),i.enableButton_(BUT.PickImage,!1),i}_actionOK(t){const e=this.currentPath_(t);this._handler.fileInfo_(e,i=>{if(toasters$.warn_(i))return;const n=FileInfo.of_(i[Key.fileinfo]);if(null==n)return void toasters$.warnKey_(RS.InvalidFilepath);if((this._mode==FilepickerKind.EXISTING_FILE||this._mode==FilepickerKind.EXISTING_DIR||this._mode==FilepickerKind.EXISTING_ANY)&&n.notexists$)return void toasters$.warnKey_(RS.SpecifiedFileDoesNotExistsPleaseTryAgain);switch(this._mode){case FilepickerKind.ANY_FILE:case FilepickerKind.EXISTING_FILE:case FilepickerKind.NEW_FILE:case FilepickerKind.WRITE_FILE:if(n.exists$&&!n.isfile$)return void toasters$.warnKey_(RS.DestinationMustBeAFile);break;case FilepickerKind.ANY_DIR:case FilepickerKind.EXISTING_DIR:if(n.exists$&&!n.isdir$)return void toasters$.warnKey_(RS.DestinationMustBeADir)}if(this._mode!=FilepickerKind.NEW_FILE&&this._mode!=FilepickerKind.WRITE_FILE)return void this._ok0(e,n);const s=Basepath.dir_(e);null!=s?this._handler.fileInfo_(s,i=>{if(toasters$.warn_(i))return;const s=FileInfo.of_(i[Key.fileinfo]);if(null!=s)if(this._mode==FilepickerKind.WRITE_FILE&&(!s.writable$||n.exists$&&!n.writable$)||this._mode==FilepickerKind.NEW_FILE&&!s.writable$)toasters$.warnKey_(RS.DestinationNotWritable);else if(this._mode==FilepickerKind.NEW_FILE&&n.exists$)toasters$.warnKey_(RS.SpecifiedFileAlreadyExistsPleaseTryAgain);else if(this._mode==FilepickerKind.WRITE_FILE&&n.exists$){const i=DialogUt.promptOK_(this._container,RS.ConfirmOverwriting,t,t=>{t&&this._ok0(e,n)});i.above_(this._dialog),i.showWarning_()}else this._ok0(e,n);else toasters$.warnKey_(RS.InvalidFilepath)}):toasters$.warnKey_(RS.InvalidFilepath)})}_ok0(t,e){var i;null===(i=this._delegate)||void 0===i||i.validate_(t,e,i=>{toasters$.warn_(i)||this._ok1(t,e)})}_ok1(t,e){var i;null===(i=this._okCallback)||void 0===i||i.call(this,t=>{t&&(this.close_(),this._okCallback=null)},FilepickerBase.cleanContextPath(t),e)}}class HistoryFilepicker extends CompositeDialogBase{constructor(t,e,i,n,s,o,l){super(t,[new FilterField("","",RS.PlacholderRegexSearch,t=>{this.search_(t)}),new DirpathField("","","",t=>{var e;if(null==t)this.deselect_(),this.refresh("",!0);else{const i=null!==(e=null==t?void 0:t.getAttribute(ATTR.AnInfo))&&void 0!==e?e:"";i.length>0&&(this.deselect_(),this.refresh(i,!0))}}),new DirtreeField("",t=>{const e=t.classList,i=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);if(!(i<0||i>=this.dirtree$.length))return e.contains(CSS.AnDir)||e.contains(CSS.AnFile)?(this.deselect_(),void this.refresh0(this.dirtree$[i])):void(e.contains(CSS.AnFileInfo)?this.actionRecover_(Array.of(this.dirtree$[i])):this.select_(i))},t=>{const e=An.documentOffset_(t).y,i=window.innerHeight,n=cache$.ui$.toolbarHeight_(),s=`${i-e-n-10-n/DEF.dragBorderDivider/2-8-2}px`,o=t.style;o.height=s,o.maxHeight=s,o.border=DEF.themeBorder})]),this.gesturehandler$=i,this.fileinfoutil$=n,this.historyutil$=s,this.dateFormat$=o,this.timeFormat$=l,this.okCallback$=null,this.dirpath$="",this.dirtree$=Array(),this.rows$=Array(),this.selected$=new Set,this.largeWidth_(),this.refresh(e)}create_(t){return this.createDialog_(t,t=>this.createContent(t),t=>new Toolbar(t,[BUT.info_(BUT.PickImage),BUT.info_(BUT.CleanupTrash),BUT.info_(BUT.DeleteFile),BUT.info_(BUT.Recover),BUT.info_(BUT.Cancel)]).enableButton_(BUT.PickImage,!1).titleKey_(RS.Recover),t=>this._toolbarActions(t))}deselect_(){this.selected$.forEach(t=>{var e,i;null===(i=null===(e=this.rows$[t])||void 0===e?void 0:e.classList)||void 0===i||i.remove(CSS.AnSelectedHighlight)}),this.selected$.clear()}select_(t){var e,i,n,s;if(t<0||t>=this.rows$.length)return;if(this.selected$.delete(t))return void(null===(i=null===(e=this.rows$[t])||void 0===e?void 0:e.classList)||void 0===i||i.remove(CSS.AnSelectedHighlight));const o=this.dirtree$[t];null!=o&&o.isfile$&&(null===(s=null===(n=this.rows$[t])||void 0===n?void 0:n.classList)||void 0===s||s.add(CSS.AnSelectedHighlight),this.selected$.add(t))}getSelection_(){return null==this.dirtree$||0==this.selected$.size?null:[...this.selected$].map(t=>this.dirtree$[t])}refresh0(t){let e=Basepath.trim_(Basepath.joinRpath_(t.dir_(),t.name_()));this.refresh(t.isdir$?e+"/":e)}refresh(t,e=!1){this.refresh1(this.getValueAt_(0).trim(),t,e)}refresh1(t,e,i=!1){let n=Basepath.trimLeading_(Basepath.cleanFilepath_(e));t.length>0?this.historyutil$.listRecursive_(JSON.stringify(smap_([Key.path,n],[Key.text,t])),t=>this.refresh2(!0,!0,t)):0==this.dirpath$.length||i?this.historyutil$.listDir_(n,t=>this.refresh2(!1,!0,t)):this.historyutil$.fileInfo_(n,t=>this.refresh2(!1,!1,t))}refresh2(t,e,i){var n,s,o;if(toasters$.warn_(i))t&&(null===(o=null===(s=null===(n=this.getFieldAt_(0))||void 0===n?void 0:n.getInput_(0))||void 0===s?void 0:s.classList)||void 0===o||o.add(CSS.AnErr));else{if(this.refreshDirpath(!t&&e,i),this.refreshDirtree(t,i),0==this.dirtree$.length)this.deselect_();else if(this.selected$.size>0){const t=this.dirtree$.length;[...this.selected$].forEach(e=>{e<t?this.select_(e):(this.selected$.delete(e),this.selected$.has(t-1)||(this.selected$.add(t-1),this.select_(t-1)))})}this.updateToolbarState()}}updateToolbarState(){}refreshDirpath(t,e){var i;const n=(t,e,i)=>{t.a_(["class",CSS.AnDirpathDir],[ATTR.AnInfo,i]).text_(e).up_()},s=(e,i,s)=>{if(PathUtil.isDocumentsDir(i))if(t)e.text_(Basepath.trimTrailing_(i)+" / ");else{const t=Basepath.trimTrailing_(i);n(e,t+" / ",t+"/")}else{const t=i.indexOf("/"),o=i.substring(0,t),l=i.substring(t+1);n(e,o+" / ",o+"/"),s(l)}},o=this.getFieldAt_(1).getValueElement_(0),l=new DomBuilderEx(o).empty_();if(this.dirpath$=null!==(i=e[Key.path])&&void 0!==i?i:"",0!=this.dirpath$.length)if(this.dirpath$.endsWith("/"))s(l,this.dirpath$,t=>{l.text_(t.substring(0,t.length-1)+" / ")});else{let[t,e]=Basepath.splitPath_(this.dirpath$);s(l,t,e=>{n(l,e+" / ",t+"/")}),l.text_(e)}}refreshDirtree(t,e){var i;let n=this.getFieldAt_(2).getValueElement_(0),s=new DomBuilderEx(n).empty_();if(this.rows$=Array(),this.dirtree$=null!==(i=DeletedFileStat.arrayOf_(e[Key.dirtree]))&&void 0!==i?i:Array(),0==this.dirtree$.length)return;const o=DomBuilderEx.offline1_(document,"div",CSS.AnViewportContent);o.push_().div_({class:`${CSS.AnPromptContent} ${CSS.AnZebra}`,style:`border-bottom:${DEF.themeBorder}`}).push_();const l=this.dirtree$.length;for(let e=0;e<l;++e){const i=this.dirtree$[e],n=i.isdir$,s=Basepath.joinRpath_(i.dir_(),i.name_()),l=n?FileInfo.SIZEUNIT_EMPTY:i.sizeunit$,a=this.fileDateString(i.lastDeleted_()),r=e.toString(),_=o.peek_().div_(["class",CSS.AnRow],[ATTR.AnInfo,r]).push_().cursor_();this.rows$.push(_);const c=(t,e,i,n)=>o.peek_().child_(t,smap_(["class",e],[ATTR.AnInfo,i])).text_(n),h=t=>o.peek_().code_().text_(t);if(t)c("a",CSS.AnFileInfo,r,l),h(a),s!=this.dirpath$?c("a",CSS.AnFile,r,s.substring(this.dirpath$.length)):c("a",CSS.AnFile,r,Basepath.nameWithSuffix_(s));else if(n){const t=0==this.dirpath$.length?s:s.indexOf("/")>=0?Basepath.splitFirst_(s)[1]:".";o.code_().text_(l+a),c("a",CSS.AnDir,r,t)}else c("a",CSS.AnFileInfo,r,l),h(a),s!=this.dirpath$?c("a",CSS.AnFile,r,i.name_()):c("span",CSS.AnFile,r,i.name_());o.pop_()}s.appendNodes_(o.pop_(2).cursor_())}fileDateString(t){let e=DateTime.fromMillisecondsSinceEpoch_(t);return""+DateFormat.dateString(this.dateFormat$,e)+""+TimeFormat.longString(this.timeFormat$,e)+""}onOK_(t){return this.okCallback$=t,this}_toolbarActions(t){switch(t){case BUT.PickImage:this._pickImage();break;case BUT.CleanupTrash:this.actionCleanupTrash_();break;case BUT.DeleteFile:this.actionDeleteFile_(this.getSelection_());break;case BUT.Recover:this.actionRecover_(this.getSelection_());break;case BUT.Cancel:const e=this._cancelCallback;super.close_(),Timer.optional0_(e,t=>t());break;default:Assert.invalidAction_(t)}}search_(t){var e;const i=null===(e=this.getFieldAt_(0).getInput_(0))||void 0===e?void 0:e.classList;if(null==i||i.remove(CSS.AnErr),null==RX.regexOrNull(t))return toasters$.warn_(MSG.string1_(RS.InvalidRegex_,t)),void(null==i||i.add(CSS.AnErr));this.refresh1(t,this.dirpath$,0==t.length)}_pickImage(){throw new Error("TODO")}actionCleanupTrash_(){host$.cleanupTrash_("",t=>{toasters$.info_(t[Key.result],{attop:!0}),host$.updateSessionPreferences_(smapOf_(SessionPreferencesKey.trashAutoCleanupTimestamp,DateTime.now_().millisecondsSinceEpoch$),()=>{this.refresh(this.dirpath$)})})}actionDeleteFile_(t){if(null==t)return void toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection));const e=t.map(t=>t.toJSON_()),i=json_([Key.path,this.dirpath$],[Key.infos,e]);this.dirpath$.endsWith("/")?this.historyutil$.deleteDirSubtree_(JSON.stringify(i),t=>this.deleteResult_(t)):this.historyutil$.delete_(JSON.stringify(i),t=>this.deleteResult_(t))}deleteResult_(t){toasters$.warn_(t)||toasters$.ok_(t[Key.result],{attop:!0}),this.refresh(this.dirpath$)}actionRecover_(t){if(null==t||0==t.length)return this.dirpath$.endsWith("/")&&this.dirtree$.length>0&&this.dirtree$[0].isfile$?void DialogUt.confirmKeySmall_(this.container_(),RS.RecoverEveryDeletedFileInThisDirectory_Confirmation,An.above_(this.element_()),t=>{t&&this.recover(this.dirtree$)}):void toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection));t.length>1?this.recover(t):this.recover1(t[0])}recover(t){var e;const i=t[0];this.prepareToWrite(null!==(e=i.dir_())&&void 0!==e?e:"",()=>{var e;const n=Filepicker.withTitleKey_(this.container_(),RS.DestinationDir,FilepickerKind.EXISTING_DIR,"",null,null!==(e=i.dir_())&&void 0!==e?e:"","",this.gesturehandler$,this.fileinfoutil$).above_(this.element_()).setDelegate_(FilepickerExistingDirDelegate.singleton$).onOK_((e,i,s)=>{if(s.exists$&&!s.isdir$)return toasters$.warn_(MSG.string_(RS.DestinationIsNotADirectory)),void e(!1);this.checkOverwriting(i,t,s=>{s.length>0?DialogUt.promptOK_(this.container_(),RS.ConfirmOverwriting,s,n=>{n?(e(!0),this.recover2(i,t)):e(!1)}).above_(n.element_()).showWarning_():(e(!0),this.recover2(i,t))})}).show_()})}recover2(t,e){this.historyutil$.rename_(JSON.stringify(json_([Key.src,this.dirpath$],[Key.infos,e.map(t=>t.toJSON_())])),t,e=>this.recoverResult(e,t))}checkOverwriting(t,e,i){const n=Array();An.iterateList_(e,(e,i,s)=>{this.fileinfoutil$.fileInfo_(Basepath.joinPath_(t,e.name_()),t=>{const i=FileInfo.of_(t[Key.fileinfo]);null!=i&&i.exists$&&n.push(e.name_()),s(!1)})},()=>i(n))}prepareToWrite(t,e){this.fileinfoutil$.fileInfo1_(toasters$,t,i=>{i.exists$?e():DialogUt.confirmKeySmall_(this.container_(),RS.ConfirmCreateDestinationDirectory,An.above_(this.element_()),i=>{i?this.fileinfoutil$.mkDirs_(t,t=>{toasters$.warn_(t),e()}):e()})})}recover1(t){var e;const i=null!==(e=t.dir_())&&void 0!==e?e:"";this.prepareToWrite(i,()=>{Filepicker.withTitleKey_(this.container_(),RS.DestinationFile,FilepickerKind.WRITE_FILE,"",null,i,t.name_(),this.gesturehandler$,this.fileinfoutil$).above_(this.element_()).setDelegate_(new FilepickerSameSuffixDelegate(Basepath.suffix_(t.name_()))).onOK_((e,i)=>{e(!0),this.historyutil$.rename_(JSON.stringify(json_([Key.src,this.dirpath$],[Key.infos,[t.toJSON_()]])),i,t=>this.recoverResult(t,i))}).show_()})}recoverResult(t,e){var i;toasters$.warn_(t)?this.refresh(this.dirpath$):(this.close_(),null===(i=this.okCallback$)||void 0===i||i.call(this,e),this.okCallback$=null)}_onOK(t){throw new Error}}class LocalMediaInfoHandler{constructor(t,e){this._path=t,this._handler=e}infos_(t){this._handler.localImageInfos_(this._path,t)}thumbnails_(t,e,i){this._handler.localImageThumbnails_(t,e.map(t=>null==t?null:t.json_()),i)}}class PromptKey extends CompositeDialogBase{constructor(t,e,i){super(t,[new InputField("",RS.KeyAlias,"",RS.KeyAlias),new FilepathFolderField("",RS.PlaceholderRequiredFilepath,new HumanFilepath(PATH._Internal_),RS.PlaceholderRequiredFilepath,i,t=>{const i=An.above_(this.element_());_SystemActionsHelper.promptInputKeyFile(t,e,i).onOK_((t,e)=>{t(!0),this.setValueAt_(1,e)}).show_()})]),this._okCallback=null,this.titleKey_(RS.Key),this.onChange_(t=>{t.spec$.key$==RS.KeyAlias&&t.getValue_().startsWith(DEF.backupKeyPrefix)&&toasters$.warnKey_(RS.InvalidKeyAlias)})}create_(t){return this.createDialog_(t,t=>this.createContent(t),t=>new Toolbar(t,BUT.infosOKCancel),t=>this._toolbarActions(t))}onOK_(t){return this._okCallback=t,this}_onOK(t){t(!0)}_toolbarActions(t){var e;switch(this.clearStatus_(),t){case BUT.OK:null===(e=this._okCallback)||void 0===e||e.call(this,this.getValueAt_(0),this.getValueAt_(1),t=>{t&&(this.close_(),this._okCallback=null)});break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}}class PromptBackupKeyManager extends CompositeDialogBase{constructor(t,e,i){super(t,[]),this._dateformat=e,this._aliases=i;for(const[t,e]of Object.entries(this._aliases))t==DEF.backupKeyAlias?this._addField(new LabelButtonField("",t,RS.Key,null,t=>this._createlabel(t,e))):this._add(t,e)}_createlabel(t,e){const i=e[0],n=e[1],s=e[2],o=e[3];t.push_().div_().img_(o),t.peek_().div_(["style","margin-left:10px;overflow:auto;"]).indent_(t.push_().span_().b_().text_(`${i} [${n}]`),t.peek_().br_(),t.pop_().span_().text_(s))}_add(t,e){this._addField(new LabelButtonField("",t,RS.Key,BUT.DeleteKey1,t=>this._createlabel(t,e),t=>{this._deleteKey(t)}))}create_(t){return this.createDialog_(t,t=>this.createContent(t),t=>new Toolbar(t,BUT.infos_(BUT.ImportKey,BUT.OK)),t=>this._toolbarActions(t))}_deleteKey(t){const e=An.above_(this.element_());DialogUt.confirmKeySmall_(this.container_(),RS.BackupKeyDeleteConfirmMesesage,e,e=>{if(!e)return;const i=t.spec$.key$;host$.deleteBackupKey_(i,e=>{toasters$.warn_(e)||(this._removeField(t),delete this._aliases[i])})})}_importKey(){const t=new PromptKey(this.container_(),this._dateformat,native$.getIFrameDir_()).above_(this.element_()).onOK_((e,i,n)=>{host$.importBackupKey_(e,i,i=>{if(t.warn_(i))return n(!1);n(!0);const s=i[Key.result];this._aliases[e]=s,this._add(e,s)})}).show_()}_onOK(t){t(!0)}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.ImportKey:this._importKey();break;case BUT.OK:this.close_();break;default:this.actionInvalid_(t)}}}class PromptAliases extends ChecklistDialogBase{constructor(t,e,i,n){super(t),this._aliases=e,this._selected=i,this._okCallback=null,super.init_(this.create_(t)),this.titleKey_(RS.Recipients),this.zindex_(n)}create_(t){return this._createChecklistDialog(t,BUT.infosOKCancel,t=>this._toolbarActions(t))}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.OK:{this._toolbar.enableButton_(BUT.OK,!1);const t=this._foreachChecked((t,e)=>{const i=e.getAttribute(ATTR.AnInfo);null!=i&&t.push(i)}),e=this._okCallback;this.close_(),e(t);break}case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}_populate(t,e){const i=Object.entries(this._aliases),n=new DomBuilderEx(t).empty_().push_();n.peek_().div_(["class",`${CSS.AnHeading} ${CSS.AnFlex}`],[ATTR.xTooltips,MSG.string_(RS.ToggleAll)]).text_(`${MSG.string_(RS.Recipients)} (${i.length})`),DialogUt.populateCheckboxList1_(n,()=>{let t=0;for(const[e,s]of i){const i=n.peek_().div_().input_(["type","checkbox"],[ATTR.AnInfo,e]).cursor_();e==DEF.backupKeyAlias&&(i.disabled=!0);const o=this._selected.includes(e);i.checked=o,o&&++t,n.siblingAfter_("span").text_(s)}return t})}close_(){this._okCallback=null,super.close_()}onOK_(t){return this._okCallback=t,this}}class PromptBackup extends CompositeDialogBase{constructor(t,e,i){super(t,[new InputButtonField(RS.BackupFile,"","",RS.PlaceholderRequiredFilepath,BUT.Folder1,()=>this._promptBackupFile(e)),new SelectFIeld(RS.Recipients,"","",RS.Recipients,[]),new InputButtonField(RS.SourceDirectory,"","",RS.SourceDirectory,BUT.Folder1,()=>this._promptSourceDir(e))]),this._selected=[],this.titleKey_(RS.Backup),this.zindex_(DEF.zindexPrompt),this.largeWidth_(),this._recipients=this.getFieldAt_(1).getValueElement_(0),this._recipients.onClick_(t=>{An.stopevent_(t),new PromptAliases(this.container_(),i,this._selected,An.above_(this.element_())).onOK_(t=>{this._setRecipients(i,t)}).show_()}),this._setRecipients(i,[...Object.keys(i)])}_promptBackupFile(t){_SystemActionsHelper.promptOutputBackupFile(this.getValueAt_(0),t,An.above_(this.element_())).onOK_((t,e)=>{if(!PathUtil.isBackupsSubtree(e))return toasters$.warnKey_(RS.BackupFileMustUnderInternalOrExternal),void t(!1);t(!0),this.setValueAt_(0,e),this.setVisibleAt_(1,!e.endsWith(DEF.zipSuffix))}).show_()}_setRecipients(t,e){this._selected=e;const i=e.length,n=1==i?PromptBackup._recipientsSelf:(i==Object.keys(t).length?PromptBackup._recipientsAll:PromptBackup._recipientsSelected)+`(${i})`;this._recipients.setOptions_([n],[n],0)}_promptSourceDir(t){_SystemActionsHelper.promptDir_(RS.SourceDirectory,this.getValueAt_(2),t,An.above_(this.element_())).onOK_((t,e)=>{if(!PathUtil.isDocumentsTree(e))return toasters$.warnKey_(RS.DirectoryMustUnderHome),void t(!1);t(!0),this.setValueAt_(2,e)}).onFilterRoots_(t=>(null==t?void 0:t.name_())==PATH.Home).show_()}_onOK(t){const e=this.getValueAt_(0),i=this.getValueAt_(2);_Util.checkFileWritableAndConfirmOverwrite_(e,An.above_(this.element_()),n=>{this.warn_(n)?t(!1):(t(!0),host$.backupRestore_(_JOF.actionBackupData,[e,this._selected,i],t=>{_SystemActionsHelper.backupRestoreResult(t)}))})}actionCancelConfirmed_(){toasters$.infoKey_(RS.BackupCancelled),super.actionCancelConfirmed_()}}PromptBackup._recipientsAll=MSG.string_(RS.RecipientsAll),PromptBackup._recipientsSelected=MSG.string_(RS.RecipientsSelected),PromptBackup._recipientsSelf=MSG.string_(RS.RecipientsSelf);class PromptRestore extends CompositeDialogBase{constructor(t,e){super(t,[new InputButtonField(RS.BackupFile,"","",RS.PlaceholderRequiredFilepath,BUT.Folder1,()=>this._promptBackupFile(e)),new InputButtonField(RS.SourcePath,"","",RS.PlaceholderOptionalFilepath,BUT.Folder1,()=>{const t=this.getFieldAt_(0).getValue_(0);this._readfiletree(1,t)}),new InputButtonField(RS.DestinationDir,"","",RS.PlaceholderRequiredFilepath,BUT.Folder1,()=>this._promptDestDir(e))]),this._sync=!1,this.titleKey_(RS.Restore),this.zindex_(DEF.zindexPrompt),this.largeWidth_(),this.setVisibleAt_(1,!1)}create_(t){return this.createDialog_(t,t=>this.createContent(t),t=>new Toolbar(t,BUT.infos_(BUT.Sync,BUT.RestoreData,BUT.Cancel)),t=>this._toolbarActions(t))}_promptBackupFile(t){_SystemActionsHelper.promptInputBackupFile(this.getValueAt_(0),t,An.above_(this.element_())).onOK_((t,e)=>{t(!0),this.setValueAt_(0,e),this.setVisibleAt_(1,e.length>0)}).show_()}_promptDestDir(t){_SystemActionsHelper.promptDir_(RS.DestinationDir,this.getValueAt_(2),t,An.above_(this.element_())).onOK_((t,e)=>{t(!0),this.setValueAt_(2,e)}).show_()}_toolbarActions(t){switch(this.clearStatus_(),t){case BUT.Sync:this._sync=!0,this._onOK(t=>{t&&this.close_()});break;case BUT.RestoreData:this._sync=!1,this._onOK(t=>{t&&this.close_()});break;case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}_readfiletree(t,e){host$.readBackupFiletree_(e,e=>{toasters$.warn_(e)||Filepicker.withTitleKey_(accessories$,RS.Restore,FilepickerKind.EXISTING_ANY,null,PATH.Home,PATH.Home,"",gestureHandler$,new FileInfoUtil(new RestoreDataFilepickerHandler(e[Key.result]))).zindex_(An.above_(this.dialog_())).setDelegate_(FilepickerRestoreDataDelegate.singleton$).onOK_((e,i)=>{e(!0),this.setValueAt_(t,i)}).show_()})}_onOK(t){const e=this.getValueAt_(0),i=this.getValueAt_(1),n=this.getValueAt_(2);if(0==e.length||0==n.length)return this.warnKey_(0==e.length?RS.BackupPleaseSpecifyABackupFile:RS.PleaseSpecifyADestinationDirectory),void t(!1);t(!0),host$.backupRestore_(_JOF.actionRestoreData,[e,this._sync,i,n],t=>{_SystemActionsHelper.backupRestoreResult(t)})}actionCancel_(){toasters$.infoKey_(RS.RestoreCancelled);const t=this._cancelCallback;this.close_(),null==t||t()}}class FilepickerImageDelegate extends FilepickerExtsDelegate{_exts(){return MimeUtil.imageExts()}}FilepickerImageDelegate.singleton$=new FilepickerImageDelegate;class FilepickerPngImageDelegate extends FilepickerExtsDelegate{_exts(){return["png"]}}FilepickerPngImageDelegate.singleton$=new FilepickerPngImageDelegate;class FilepickerAudioPlaybackDelegate extends FilepickerExtsDelegate{_exts(){return MimeUtil.audioPlaybackExts()}}FilepickerAudioPlaybackDelegate.singleton$=new FilepickerAudioPlaybackDelegate;class FilepickerAudioRecordDelegate extends FilepickerExtsDelegate{_exts(){return MimeUtil.audioRecordExts()}}FilepickerAudioRecordDelegate.singleton$=new FilepickerAudioRecordDelegate;class FilepickerVideoPlaybackDelegate extends FilepickerExtsDelegate{_exts(){return MimeUtil.videoPlaybackExts()}}FilepickerVideoPlaybackDelegate.singleton$=new FilepickerVideoPlaybackDelegate;class FilepickerVideoRecordingDelegate extends FilepickerExtsDelegate{_exts(){return MimeUtil.videoRecordExts()}}FilepickerVideoRecordingDelegate.singleton$=new FilepickerVideoRecordingDelegate;class FilepickerVideoTrackDelegate extends FilepickerExtsDelegate{_exts(){return MimeUtil.videoTrackExts()}}FilepickerVideoTrackDelegate.singleton$=new FilepickerVideoTrackDelegate;class FilepickerHtmlDelegate extends FilepickerExtsDelegate{_exts(){return[DEF.html]}}FilepickerHtmlDelegate.singleton$=new FilepickerHtmlDelegate;class FilepickerCssDelegate extends FilepickerExtsDelegate{_exts(){return[DEF.css]}}FilepickerCssDelegate.singleton$=new FilepickerCssDelegate;class FilepickerSuffixDelegate extends FilepickerSuffixesDelegate{constructor(t){super(),this._suffices=mapOf_("",null);for(const e of t)this._suffices.set(e,null)}_getsuffixes(){return this._suffices}}class FilepickerLinkDelegate extends FilepickerExtsDelegate{_exts(){const t=[DEF.html,DEF.css,DEF.pdf];return t.push(...MimeUtil.imageExts()),t.push(...MimeUtil.audioPlaybackExts()),t.push(...MimeUtil.videoPlaybackExts()),t}}FilepickerLinkDelegate.singleton$=new FilepickerLinkDelegate;class FilepickerExistingDirDelegate extends FilepickerDelegate{getSuffixes_(){return mapOf_("",null)}includes_(t,e){return e.isdir$}validate_(t,e,i){null!=e&&e.isdir$?i({}):i(An.jsonError_(RS.DestinationIsNotADirectory))}}FilepickerExistingDirDelegate.singleton$=new FilepickerExistingDirDelegate;class FilepickerRestoreDataDelegate extends FilepickerDelegate{getSuffixes_(){return mapOf_("",null)}includes_(t,e){return e.isdir$||e.isfile$}validate_(t,e,i){null!=e&&e.exists$?i({}):i(An.jsonError_(RS.DestinationNotExists))}}FilepickerRestoreDataDelegate.singleton$=new FilepickerRestoreDataDelegate;class FilepickerSameSuffixDelegate extends FilepickerDelegate{constructor(t){super(),this.suffix$=t}getSuffixes_(){return map_(["",null],[this.suffix$,null])}includes_(t,e){return e.isfile$&&Basepath.suffix_(t)==this.suffix$}validate_(t,e,i){null==e||e.exists$&&!e.isfile$?i(An.jsonError_(RS.DestinationMustBeAFile)):Basepath.suffix_(t)==this.suffix$?i({}):i(An.jsonError_(RS.CannotChangeFileExt))}}class OutputBackupFileDelegate extends FilepickerSuffixesDelegate{_getsuffixes(){return map_(["",null],[".ibackup",RS.Tooltips_CreateIncrementalDataBackup],[".backup",RS.Tooltips_CreateFullDataBackup],[".zip",RS.Tooltips_ExportDirectoryAsZip])}}OutputBackupFileDelegate.singleton$=new OutputBackupFileDelegate;class KeyFileDelegate extends FilepickerSuffixesDelegate{_getsuffixes(){return map_(["",null],[".der",RS.ExportPublicKeyForSelf])}}KeyFileDelegate.singleton$=new KeyFileDelegate;class LayoutData{constructor(){this.CELL_WIDTH=DEF.thumbnailSizeMicro,this.CELL_HEIGHT=DEF.thumbnailSizeMicro,this.CELL_PADDINGx2=8,this.CONTENT_PADDINGx2=16,this.STATUS_YPADDINGx2=8}}class _Layout{constructor(t,e,i,n){this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.dialogWidth=this.winWidth,this.dialogHeight=this.winHeight,this.contentWidth=this.winWidth-t.CONTENT_PADDINGx2,this.contentHeight=this.winHeight-e-t.CONTENT_PADDINGx2,this.cellWidth=t.CELL_WIDTH,this.cellHeight=t.CELL_HEIGHT,this.rows=Math.floor(this.contentHeight/(t.CELL_HEIGHT+t.CELL_PADDINGx2)),this.cols=Math.floor(this.contentWidth/(t.CELL_WIDTH+t.CELL_PADDINGx2)),null!=i&&this.rows>i&&(this.rows=i),null!=n&&this.cols>n&&(this.cols=n),this.statusMaxWidth=this.contentWidth-t.STATUS_YPADDINGx2}}class Sort{}Sort.ByName=0,Sort.ByDate=1,Sort.Asc=0,Sort.Desc=1;class MediapickerConfig{constructor(){this._layoutdata=new LayoutData,this._zindex=null,this._maxrows=null,this._maxcols=null}layoutdata(t){this._layoutdata=t}zindex(t){this._zindex=t}maxrows(t){this._maxrows=t}maxcols(t){this._maxcols=t}}class _MediapickerBase{constructor(t,e,i,n){this._container=t,this._gestureHandler=i,this._handler=n,this._viewCallback=null,this._sortby=Sort.ByName,this._sortdir=Sort.Asc,this._filtered=[],this._sorted=[],this._infos=[],this._resizeCallback=null,this._okCallback=null,this._cancelCallback=null,this._dateFormat=DateFormat.DEF,this._resizeSubscription=null,this._layout=null,this._selected=null,this._offset=0,this._count=0,this._config=new MediapickerConfig,this._okCallback=null,this._cancelCallback=null;const s=new DomBuilderEx(t);this._propertyToaster=new Toaster(t,0,1e4),this._dialog=s.push_().table_({class:CSS.AnWindow,style:"display: none; visibility: hidden"}).push_().cursor_(),s.peek_().tr_().td_().push_(),this._toolbar=this.createtoolbar_(s.peek_().cursor_(),MSG.string_(e)),this._searchbar=this.createsearchbar_(s.peek_().cursor_()),this._searchbox=this._searchbar.querySelector_(Conf.input),this._content=this.createcontent_(s.pop_(2).cursor_()),this._toolbar.onAction_(t=>this._toolbaractions(t)),this._searchbar.onAction_(t=>this._toolbaractions(t)),An.onInputFocusSelect_(this._searchbox),this._resizeSubscription=An.subscriptEvent_(window,"resize",()=>{null==this._resizeCallback?(this._relayout(),this.refreshnow_()):this._resizeCallback()}),An.addClickListenerMatching_(this._content,`td.${CSS.AnGalleryCell}`,t=>{if(this._hideToaster(),null==this._sorted)return;const e=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);if(e<0||e>=this._sorted.length){const t=this._content.querySelector(`td.${CSS.AnGalleryCell}.${CSS.AnSelected}`);null!=t&&t.classList.remove(CSS.AnSelected),this._selected=null,this._onSelectionChange(this._selected)}else if(e!=this._selected){const i=this._content.querySelector(`td.${CSS.AnGalleryCell}.${CSS.AnSelected}`);null!=i&&i.classList.remove(CSS.AnSelected);const n=this._sorted[e];if(null!=t.getAttribute(ATTR.xTooltips)){const t=n.error_();null!=t&&toasters$.warn_(t,{attop:!1}),this._selected=null}else this._selected=e,t.classList.add(CSS.AnSelected),this._briefInfo(n);this._onSelectionChange(this._selected)}null!=this._selected&&this.viewMedia_(this._sorted[this._selected])}),An.addContextmenuListenerMatching_(this._content,`td.${CSS.AnGalleryCell}`,t=>{if(this._hideToaster(),null==this._sorted)return;const e=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);e<0||e>=this._sorted.length||null==t.getAttribute(ATTR.xTooltips)&&this.viewMedia_(this._sorted[e])})}_briefInfo(t){this._propertyToaster.showInfo_((e,i)=>{i.div_().text_(MediaInfo.briefMessage_(this._dateFormat,t))},!1)}dateFormat_(t){this._dateFormat=t}onResize_(t){this._resizeCallback=t}_relayout(){if(this._layout=new _Layout(this._config._layoutdata,Math.round(this._toolbar.element_().getBoundingClientRect().height),this._config._maxrows,this._config._maxcols),An.setWidthHeight_(this._dialog,this._layout.dialogWidth,this._layout.dialogHeight),null==this._config._zindex)throw Error();this._dialog.style.zIndex=this._config._zindex.toString(),An.setWidthHeight_(this._content,this._layout.contentWidth,this._layout.contentHeight)}_onSelectionChange(t){}dialog_(){return this._dialog}onOK_(t){return this._okCallback=t,this}onCancel_(t){return this._cancelCallback=t,this}onView_(t){return this._viewCallback=t,this}cells_(){const t=new _Layout(new LayoutData,0,null,null);return t.rows*t.cols}config_(){return this._config}show_(){const t=new Spinner(this._container);return t.show_(()=>{Timer.sleep0_(()=>{this._handler.infos_(e=>{var i;toasters$.warn_(e[Key.errors])?this._infos=[]:this._infos=null!==(i=MediaInfo.arrayOf_(e[Key.result]))&&void 0!==i?i:[],0==this._infos.length&&toasters$.okKey_(RS.NoImageFound,{attop:!0}),null!=this._gestureHandler&&(this._gestureHandler.push_(GestureEvent.leftInward,this._handleGesture),this._gestureHandler.push_(GestureEvent.leftOutward,this._handleGesture),this._gestureHandler.push_(GestureEvent.rightInward,this._handleGesture),this._gestureHandler.push_(GestureEvent.rightOutward,this._handleGesture)),this.shownow_(t)})})}),this}_toolbaractions(t){this._hideToaster(),this._toolbarAction(t)}ok_(){var t,e;if(null==this._selected)return void toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction);const i=null!==(e=null===(t=this._sorted)||void 0===t?void 0:t[this._selected])&&void 0!==e?e:null;null!=i?(this.close_(),null!=this._okCallback&&this._okCallback(i),this._close2()):toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction)}cancel_(){this.close_(),null!=this._cancelCallback&&this._cancelCallback(),this._close2()}close_(){null!=this._dialog&&(null!=this._gestureHandler&&(this._gestureHandler.pop_(GestureEvent.leftInward),this._gestureHandler.pop_(GestureEvent.leftOutward),this._gestureHandler.pop_(GestureEvent.rightInward),this._gestureHandler.pop_(GestureEvent.rightOutward)),null!=this._resizeSubscription&&this._resizeSubscription.cancel_(),toasters$.hideModal_(),An.hide_(this._dialog),this._viewCallback=null,this._infos=[],this._filtered=[],this._sorted=[],this._dialog.remove())}_close2(){this._okCallback=null,this._cancelCallback=null}_search(){this.filter_(),this.sort_(),this.refreshWithSpinner_()}_hideToaster(){this._propertyToaster.hide_(),toasters$.hideAll_()}}class Imagepicker extends _MediapickerBase{constructor(t,e,i,n){super(t,e,i,n),this._filename=null,An.onInputEnterKey_(this._searchbox,()=>{this._toolbarAction(BUT.Filter)})}static _sortByNameAsc(t,e){const i=t.title_(),n=e.title_();return null==i?null!=n?1:0:null==n?-1:i>n?1:i<n?-1:0}static _sortByDateAsc(t,e){const i=t.fileDate_(),n=e.fileDate_();return null==i?null!=n?-1:0:null==n?1:i>n?1:n>i?-1:0}static _sortByNameDesc(t,e){return Imagepicker._sortByNameAsc(e,t)}static _sortByDateDesc(t,e){return Imagepicker._sortByDateAsc(e,t)}createtoolbar_(t,e){const i=new Toolbar(t,[BUT.info_(BUT.PrevPage),BUT.info_(BUT.NextPage),BUT.info_(BUT.Cancel),BUT.info_(BUT.Filterbar)]);return i.onTooltips_(toasters$.onTooltipsKey_),i.titleText_(e),i}createsearchbar_(t){const e=new Toolbar(t,[INPUT.info_(INPUT.FilterBox),BUT.info_(BUT.ClearSearchText),BUT.info_(BUT.Filter),BUT.info_(BUT.Toolbar)]);return e.onTooltips_(toasters$.onTooltipsKey_),e.hide_(),e}createcontent_(t){return new DomBuilderEx(t).tr_().td1_(CSS.AnGalleryContent).cursor_()}setFilename_(t){return this._filename=t,this}onView_(t){return this._viewCallback=t,this}_onSelectionChange(t){}above_(t,e=DEF.zindexAbove10){return this.config_().zindex(An.zindexOf_(t,e,DEF.zindexPrompt+e)),this}zindex_(t){return this.config_().zindex(t),this}sort_(){if(null==this._filtered||null==this._layout)return;const t=Array.from(this._filtered);t.sort(Imagepicker.sortFunctions[this._sortby][this._sortdir]),this._sorted=t,this._selected=null,this._offset=0,this._count=Math.min(this._sorted.length,this._layout.rows*this._layout.cols),null!=this._selected&&this._onSelectionChange(this._selected)}refreshWithSpinner_(){const t=new Spinner(this._container);t.show_(()=>{Timer.sleep0_(()=>{this.refresh_(t)})})}refresh_(t){let e=0;const i=new Array;if(null!=this._sorted)for(let t=0;t<this._count;++t){const n=this._sorted[this._offset+t];null==n.tnInfo_()?(++e,i.push(n)):i.push(null)}e>0?this._refresh1(t,i):(this.refreshnow_(),null!=t&&t.hide_())}_refresh1(t,e){this._handler.thumbnails_(DEF.thumbnailSizeMicro,e,e=>{if(toasters$.warn_(e[Key.errors]))return;const i=e[Key.result];for(let t=0;t<this._count;++t){const e=i[t];this._sorted[this._offset+t].setTnInfo_(e)}this.refreshnow_(),null!=t&&t.hide_()})}shownow_(t){An.showHidden_(this._dialog),this._relayout(),this.filter_(),this.sort_();let e=null;if(!An.isempty_(this._filename))for(let t=0,i=this._sorted.length;t<i;++t){const i=this._sorted[t],n=i.title_();this._filename==n&&(this._selected=t,e=i)}this.refresh_(t),An.setVisible_(this._dialog),null!=e&&(this._briefInfo(e),this.viewMedia_(e))}_toolbarAction(t){switch(t){case BUT.Filterbar:this._toolbar.hide_(),this._searchbar.show_(),this._searchbox.focus();break;case BUT.Toolbar:this._searchbar.hide_(),this._toolbar.show_();break;case BUT.Filter:this._search();break;case BUT.ClearSearchText:this._searchbox.value="",this._search();break;case BUT.Cancel:this.cancel_();break;case BUT.NextPage:this._actionNextPage();break;case BUT.PrevPage:this._actionPrevPage()}}_actionPrevPage(){if(0==this._offset)return void toasters$.warnKey_(RS.NoMoreItems);if(null==this._layout)return;const t=this._layout,e=t.rows*t.cols;let i=this._offset-e;i<0&&(i=0);const n=this._sorted.length;this._offset=i,this._count=Math.min(n-i,e),this.refreshWithSpinner_()}_actionNextPage(){const t=this._sorted.length,e=this._offset+this._count;if(e>=t)return void toasters$.warnKey_(RS.NoMoreItems);const i=this._layout;null!=i&&(this._offset=e,this._count=Math.min(t-e,i.rows*i.cols),this.refreshWithSpinner_())}filter_(){let t=this._searchbox.value;const e=[MediaInfo.Id,MediaInfo.Title,MediaInfo.Description];let i=new Array;if(null!=t&&t.length>0){t=t.toLowerCase();for(const n of this._infos)for(const s of e){const e=n.tostring_(s,null);if(null!=e&&e.toLowerCase().indexOf(t)>=0){i.push(n);break}}toasters$.info_(MSG.format1_(RS.found_items,`${i.length}`),{attop:!1})}else i=Array.from(this._infos);this._filtered=i}refreshnow_(){const t=this._layout;if(null==t)return;const e=this._offset,i=this._count,n=this._sorted,s=new DomBuilderEx(this._content).empty_();s.table_({style:"margin:auto"}).push_();for(let o=0;o<t.rows;++o){s.peek_().tr_().push_();for(let l=0;l<t.cols;++l){const a=e+o*t.cols+l,r=s.peek_().td1_(CSS.AnGalleryCell).cursor_();if(a>=e+i)continue;const _=n[a];null!=this._selected&&this._selected==a&&r.classList.add(CSS.AnSelected),r.setAttribute(ATTR.AnInfo,a.toString());let c=null,h=null;const u=MediaInfo.of_(_.tnInfo_());null!=u&&(c=u.dataUrl_(),h=u.error_()),null==c||null!=h?(r.setAttribute(ATTR.xTooltips,MSG.string_(RS.ERROR)),s.span_().text_(MSG.string_(RS.ERROR))):s.img_(c,{style:`max-width:${t.cellWidth}px; max-height:${t.cellHeight}px`})}s.pop_()}An.enableButton_(this._toolbar.button_(BUT.PrevPage),e>0),An.enableButton_(this._toolbar.button_(BUT.NextPage),e+i<n.length)}viewMedia_(t){var e;null!=t?(null!=this._gestureHandler&&this._gestureHandler.pause_(),null===(e=this._viewCallback)||void 0===e||e.call(this,this._dialog,t,t=>{null!=this._gestureHandler&&this._gestureHandler.resume_(),t&&super.ok_()})):toasters$.okKey_(RS.NoImageFound,{attop:!0})}_handleGesture(t,e){return Timer.sleep1_(()=>{t==GestureEvent.leftInward||t==GestureEvent.rightOutward?this._actionPrevPage():t!=GestureEvent.leftOutward&&t!=GestureEvent.rightInward||this._actionNextPage()}),!0}}Imagepicker.sortFunctions=[[Imagepicker._sortByNameAsc,Imagepicker._sortByNameDesc],[Imagepicker._sortByDateAsc,Imagepicker._sortByDateDesc]];const suffixSorter=(t,e)=>{const i=t.length,n=e.length,s=t.toLowerCase(),o=e.toLowerCase(),l=Math.min(i,n);for(let i=0;i<l;++i){const n=s.charCodeAt(i),l=o.charCodeAt(i);if(n>l)return 1;if(n<l)return-1;const a=t.charCodeAt(i),r=e.charCodeAt(i);if(a>r)return 1;if(a<r)return-1}return i>n?1:i<n?-1:0};class InputBackupFileDelegate extends FilepickerSuffixesDelegate{_getsuffixes(){return map_(["",null],[DEF.ibackupSuffix,RS.Tooltips_RestoreDataFromIncrementalBackup],[DEF.backupSuffix,RS.Tooltips_RestoreDataFromFullBackup])}}InputBackupFileDelegate.singleton$=new InputBackupFileDelegate;class RestoreDataFilepickerHandler{constructor(t){this.fileinfos=t}fileInfo_(t,e){var i,n;const s=t.split("/");let o=this.fileinfos;for(const t of s)if(0!=t.length&&null==(o=null===(i=o[FileInfoKey._files])||void 0===i?void 0:i[t]))break;e(smapOf_(Key.fileinfo,null!==(n=FileInfo.of_(o))&&void 0!==n?n:FileInfo.NOT_EXISTS))}listDir_(t,e){var i,n;const s=Array(),o=t.split("/");let l=this.fileinfos;for(const n of o)if(0!=n.length){if(null==(l=null===(i=l[FileInfoKey._files])||void 0===i?void 0:i[n]))return void e(smapOf_(Key.errors,MSG.string1_(RS.DirectoryNotExists_,t)));s.push(l)}e(smap_([Key.dirpath,s],[Key.dirtree,Object.values(null!==(n=l[FileInfoKey._files])&&void 0!==n?n:{})],[Key.path,t],[Key.filename,""]))}fileInfos_(t,e,i){throw new Error("Method not implemented.")}mkDirs_(t,e){throw new Error("Method not implemented.")}delete_(t,e){throw new Error("Method not implemented.")}deleteAll_(t,e,i){throw new Error("Method not implemented.")}deleteInfo_(t,e){throw new Error("Method not implemented.")}rename_(t,e,i){throw new Error("Method not implemented.")}copy_(t,e,i,n,s,o){throw new Error("Method not implemented.")}copyInfo_(t,e,i,n){throw new Error("Method not implemented.")}deleteDirSubtree_(t,e){throw new Error("Method not implemented.")}localImageInfos_(t,e){throw new Error("Method not implemented.")}localImageThumbnails_(t,e,i){throw new Error("Method not implemented.")}deleteEmptyDirs_(t,e){throw new Error("Method not implemented.")}listRecursive_(t,e){throw new Error("Method not implemented.")}dirInfo_(t,e){throw new Error("Method not implemented.")}}class _SystemActionsHelper{static backupRestoreResult(t){var e;if(toasters$.warn_(t))return;0==(null!==(e=t[Key.warns])&&void 0!==e?e:[]).length?toasters$.info_(t[Key.result],{attop:!0}):toasters$.warn_(t[Key.result])}static showExtensionTooltips_(t,e){var i;const n=Basepath.nameAndSuffix_(e),s=null!==(i=t.get(n[1]))&&void 0!==i?i:null;null!==s&&toasters$.infoKey_(s)}static actionManageBackupKeys_(t){host$.getBackupKeyAliases_(e=>{toasters$.warn_(e)||new PromptBackupKeyManager(accessories$,t,e[Key.result]).titleKey_(RS.BackupKeyManagerTitle).zindex_(DEF.zindexPrompt).show_()})}static promptInputKeyFile(t,e,i){var n;const s=new Basepath(t);return Filepicker.withTitleKey_(document.body,RS.KeyFile,FilepickerKind.EXISTING_FILE,null,PATH._Internal_,null!==(n=s.dir$)&&void 0!==n?n:PATH._Internal_,s.nameWithSuffix$,gestureHandler$,fileinfoUt$).zindex_(i).dateFormat_(e).onHelp_(()=>{}).setDelegate_(KeyFileDelegate.singleton$).onFileSelected_(t=>{_SystemActionsHelper.showExtensionTooltips_(KeyFileDelegate.singleton$.getSuffixes_(),t)})}static promptInputBackupFile(t,e,i){var n;const s=new Basepath(t);return Filepicker.withTitleKey_(accessories$,RS.Restore,FilepickerKind.EXISTING_FILE,null,PATH._Internal_,null!==(n=s.dir$)&&void 0!==n?n:PATH._Internal_,s.nameWithSuffix$,gestureHandler$,fileinfoUt$).zindex_(i).dateFormat_(e).onHelp_((t,e)=>{_SystemActionsHelper._help(e,RS.Help_BackupFilepicker)}).setDelegate_(InputBackupFileDelegate.singleton$).onFileSelected_(t=>{_SystemActionsHelper.showExtensionTooltips_(InputBackupFileDelegate.singleton$.getSuffixes_(),t)})}static promptOutputKeyFile(t,e,i){var n;const s=new Basepath(t);return Filepicker.withTitleKey_(document.body,RS.KeyFile,FilepickerKind.WRITE_FILE,null,PATH._Internal_,null!==(n=s.dir$)&&void 0!==n?n:PATH._Internal_,s.nameWithSuffix$,gestureHandler$,fileinfoUt$).zindex_(i).dateFormat_(e).onHelp_(()=>{}).setDelegate_(KeyFileDelegate.singleton$).onFileSelected_(t=>{_SystemActionsHelper.showExtensionTooltips_(KeyFileDelegate.singleton$.getSuffixes_(),t)})}static promptOutputBackupFile(t,e,i){var n;const s=new Basepath(t);return Filepicker.withTitleKey_(accessories$,RS.Backup,FilepickerKind.ANY_FILE,null,PATH._Internal_,null!==(n=s.dir$)&&void 0!==n?n:PATH._Internal_,s.nameWithSuffix$,gestureHandler$,fileinfoUt$).zindex_(i).dateFormat_(e).onHelp_((t,e)=>{_SystemActionsHelper._help(e,RS.Help_BackupFilepicker)}).setDelegate_(OutputBackupFileDelegate.singleton$).onFileSelected_(t=>{_SystemActionsHelper.showExtensionTooltips_(OutputBackupFileDelegate.singleton$.getSuffixes_(),t)}).onFilterRoots_(t=>{const e=null==t?void 0:t.name_();return e==PATH.Internal||e==PATH.External})}static promptDir_(t,e,i,n){var s;const o=new Basepath(e);return Filepicker.withTitleKey_(accessories$,t,FilepickerKind.EXISTING_DIR,"",PATH._Home_,null!==(s=o.dir$)&&void 0!==s?s:PATH._Home_,o.nameWithSuffix$,null,fileinfoUt$).zindex_(n).dateFormat_(i).setDelegate_(FilepickerExistingDirDelegate.singleton$)}static _help(t,e){const i=MSG.stringArray_(e);t.push_().div_({class:CSS.AnViewport,style:"white-space:normal;font-size:small"});const n=i.length;if(0!=n){t.text_(i[0]),t.append_("br");for(let e=1;e+1<n;)t.b_().text_(i[e++]).up_().text_("").text_(i[e++]).append_("br");t.pop_()}}}class IPC{}IPC.hello="XOy",IPC.quit="XqN",IPC.CMD="Xde",IPC.FROM_RENDERER_INVOKE="XVr",IPC.result="XEJ",IPC.SERIAL="XmQ",IPC.FROM_RENDERER="X7W",IPC.progress="XOr",IPC.HOST="XrM",IPC.test="X0t",IPC.FROM_MAIN="Xyt",IPC.hi="XL6",IPC.ARGS="XwH",IPC.showDeveloperTools="XXO";class _JOF{}_JOF.actionBackupData="/a/actionBackupData",_JOF.actionBackupKey="/a/actionBackupKey",_JOF.actionRestoreData="/a/actionRestoreData",_JOF.readBackupFiletree="/a/readBackupFiletree",_JOF.getBackupKeyAliases="/a/getBackupKeyAliases",_JOF.deleteBackupKey="/a/deleteBackupKey",_JOF.importBackupKey="/a/importBackupKey",_JOF.backupFilepicker="/a/backupFilepicker",_JOF.actionFactoryReset="/a/actionFactoryReset",_JOF.actionPreview="/a/actionPreview",_JOF.actionPrint="/a/actionPrint",_JOF.actionResetUserSettings="/a/actionResetUserSettings",_JOF.actionShare="/a/actionShare",_JOF.audioInfos="/a/audioInfos",_JOF.audioPause="/a/audioPause",_JOF.audioPlay="/a/audioPlay",_JOF.audioSeek="/a/audioSeek",_JOF.historyFilepicker="/a/historyFilepicker",_JOF.cleanupTrash="/a/cleanupTrash",_JOF.clearEvents="/a/clearEvents",_JOF.clearFocus="/a/clearFocus",_JOF.copyToClipboard="/a/copyToClipboard",_JOF.createAudioPlayer="/a/createAudioPlayer",_JOF.createFromTemplate="/a/createFromTemplate",_JOF.destroyAudioPlayer="/a/destroyAudioPlayer",_JOF.exportEvents="/a/exportEvents",_JOF.exportToPhotoLibrary="/a/exportToPhotoLibrary",_JOF.exportToPhotoLibraryInfos="/a/exportToPhotoLibraryInfos",_JOF.filepicker="/a/filepicker",_JOF.findBlog="/a/findBlog",_JOF.findFiles="/a/findFiles",_JOF.focus="/a/focus",_JOF.formatCSS="/a/formatCSS",_JOF.generateBarcode="/a/generateBarcode",_JOF.generateGallery="/a/generateGallery",_JOF.gestureEnable="/a/gestureEnable",_JOF.getAudioStatus="/a/getAudioStatus",_JOF.getDeviceSize="/a/getDeviceSize",_JOF.getEvents="/a/getEvents",_JOF.getPendingAlarmCount="/a/getPendingAlarmCount",_JOF.getSessionPreferences="/a/getSessionPreferences",_JOF.getSettings="/a/getSettings",_JOF.getTemplatesInfo="/a/getTemplatesInfo",_JOF.getUISettings="/a/getUISettings",_JOF.globalSearch="/a/globalSearch",_JOF.globalSearchResult="/a/globalSearchResult",_JOF.hasLogin="/a/hasLogin",_JOF.heartbeat="/a/heartbeat",_JOF.hideCaret="/a/hideCaret",_JOF.hideKeyboard="/a/hideKeyboard",_JOF.imageConversion="/a/imageConversion",_JOF.importImageFromPhotoLibrary="/a/importImageFromPhotoLibrary",_JOF.importVideoFromPhotoLibrary="/a/importVideoFromPhotoLibrary",_JOF.isKeyboardShown="/a/isKeyboardShown",_JOF.isLoggedIn="/a/isLoggedIn",_JOF.linkVerifier="/a/linkVerifier",_JOF.localImageInfo="/a/localImageInfo",_JOF.localImageThumbnail="/a/localImageThumbnail",_JOF.onBoot="/a/onBoot",_JOF.onDocumentLoaded="/a/onDocumentLoaded",_JOF.onDocumentUnload="/a/onDocumentUnload",_JOF.onIFrameLoaded="/a/onIFrameLoaded",_JOF.onIFrameUnload="/a/onIFrameUnload",_JOF.onWindowSizeChanged="/a/onWindowSizeChanged",_JOF.pasteFromClipboard="/a/pasteFromClipboard",_JOF.photoLibraryInfos="/a/photoLibraryInfos",_JOF.photoLibraryThumbnails="/a/photoLibraryThumbnails",_JOF.playVideo="/a/playVideo",_JOF.pollAudioPlayer="/a/pollAudioPlayer",_JOF.postEvent="/a/postEvent",_JOF.previewImage="/a/previewImage",_JOF.readCSS="/a/readCSS",_JOF.recents="/a/recents",_JOF.recentsPut="/a/recentsPut",_JOF.recentsStatus="/a/recentsStatus",_JOF.recordVideo="/a/recordVideo",_JOF.releaseAudioPlayer="/a/releaseAudioPlayer",_JOF.removeEvents="/a/removeEvents",_JOF.requestAudioRecordingPermission="/a/requestAudioRecordingPermission",_JOF.requestVideoRecordingPermission="/a/requestVideoRecordingPermission",_JOF.sanitize="/a/sanitize",_JOF.saveBase64Image="/a/saveBase64Image",_JOF.saveCSS="/a/saveCSS",_JOF.saveHtml="/a/saveHtml",_JOF.saveRecovery="/a/saveRecovery",_JOF.scanBarcode="/a/scanBarcode",_JOF.showKeyboard="/a/showKeyboard",_JOF.sidepanelChanged="/a/sidepanelChanged",_JOF.startAudioRecording="/a/startAudioRecording",_JOF.stopAudioRecording="/a/stopAudioRecording",_JOF.takePhoto="/a/takePhoto",_JOF.takePhotoCancelled="/a/takePhotoCancelled",_JOF.toggleKeyboard="/a/toggleKeyboard",_JOF.toggleNobackup="/a/toggleNobackup",_JOF.undead="/a/undead",_JOF.updateSessionPreferences="/a/updateSessionPreferences",_JOF.updateUISettings="/a/updateUISettings",_JOF.videoInfos="/a/videoInfos",_JOF.viewPhotoLibraryThumbnail="/a/viewPhotoLibraryThumbnail",_JOF.writeImage="/a/writeImage",_JOF.saveStylesheet="/a/saveStylesheet",_JOF.testIsEncrypted="/a/testIsEncrypted",_JOF.desktopChangeLogin="/a/desktopChangeLogin";class _DumbAudioPlayer{constructor(t){this.path=t,this._total=1e5,this._played=0,this._start=null}play(){return null==this._start&&(this._played>=this._total&&(this._played=0),this._start=An.now_(),!0)}pause(){if(null!=this._start){const t=An.now_();return this._played+=t-this._start,this._played>=this._total&&(this._played=this._total),this._start=null,!0}return!1}seek(t){return(t=t<0?0:t>this._total?this._total:t)>=0&&t<this._total&&(this._played=t,this._start=An.now_(),!0)}poll(){if(null!=this._start){const t=An.now_(),e=this._played+t-this._start;e>=this._total&&(this._played=this._total,this._start=null);const i=null==this._start;return[e,this._total,i?0:1,i?1:0]}return[this._played,this._total,0,this._played>=this._total?1:0]}isPlaying(){return null!=this._start}destroy(){}}class Host{constructor(){this._clipboardText=null,this._dumbPlayer=null,this._audioRecordingInProgress=!1,this._spinner=null,this.filepicker_=(t,e,i,n)=>{this.ajax_(t,e,JSON.stringify(i),n)},this.imageInfo_=(t,e,i)=>{this.ajax_(t,0,JSON.stringify(e),i)},this.recents_=(t,e)=>{this.ajax_(_JOF.recents,t,null,e)},this.showDeveloperTools_=()=>{const t=window[IPC.HOST];null!=t&&t.ipcSend(IPC.FROM_RENDERER,IPC.showDeveloperTools)},this.backupRestore_=(t,e,i)=>{this.ajaxWithSpinner_(t,0,JSON.stringify(e),t=>{i(t)})},this.readBackupFiletree_=(t,e)=>{this.ajax_(_JOF.readBackupFiletree,0,JSON.stringify([t]),e)}}static ajaxquery_(t,e,i,n){const s=`${Conf.schemeHost}${t}?kind=${e}`;fetch(s,{method:"POST",body:i}).then(t=>{t.text().then(t=>{const e=function(t){if(0==t.length)return smapOf_(Key.errors,"Empty json result");try{return JSON.parse(t)}catch(t){return smapOf_(Key.errors,`${t}`)}}(t);Timer.sleep0_(()=>{try{null==n||n(e)}catch(t){}})}).catch(t=>void 0)}).catch(t=>void 0)}ajax_(t,e,i,n){Host.ajaxquery_(t,e,i,n)}ajaxWithSpinner_(t,e,i,n){this._spinner=new Spinner(accessories$),this._spinner.show_(()=>{this.ajax_(t,e,i,t=>{var e;null===(e=this._spinner)||void 0===e||e.hide_(),this._spinner=null,n(t)})})}getDeviceSize_(){return new Point(window.innerWidth,window.innerHeight)}getDPI_(){return Host.DPI}recentsBack_(t){Host.ajaxquery_(_JOF.recents,RecentsCmd.BACK,"",t)}recentsPeek_(t){Host.ajaxquery_(_JOF.recents,RecentsCmd.PEEK,"",t)}recentsForward_(t){Host.ajaxquery_(_JOF.recents,RecentsCmd.FORWARD,"",t)}recentsPut_(t,e,i,n){Host.ajaxquery_(_JOF.recentsPut,0,JSON.stringify([t,e,i]),n)}recentsStatus_(t,e,i){Host.ajaxquery_(_JOF.recentsStatus,0,JSON.stringify([t,e]),i)}login_(t,e){Timer.sleep0_(()=>{e({})})}logout_(t=!1,e=null){native$.reloadHome_()}isLoggedIn_(t){Host.ajaxquery_(_JOF.isLoggedIn,0,"",t)}hasLogin_(t){Host.ajaxquery_(_JOF.hasLogin,0,"",t)}addPage_(t,e,i){if(null==t)return void i(smapOf_(Key.errors,[MSG.string_(RS.InvalidPath),t]));t.length>0&&"/"!=t[0]&&(t="/"+t);const n=_JOF.createFromTemplate,s=JSON.stringify(smap_([Key.template,e],[Key.path,t]));Host.ajaxquery_(n,0,s,i)}copyToClipboard_(t,e=null){this._clipboardText=t,null==e||e({})}pasteFromClipboard_(t){null!=this._clipboardText?t(smapOf_(Key.result,this._clipboardText)):t(An.jsonError_(RS.ClipboardIsEmptyOrInvalid))}sanitizeTagAttrs_(t,e){Host.ajaxquery_(_JOF.sanitize,0,JSON.stringify(t),e)}getDocInfo_(t){const e=native$.getIFrameContextPath_();Host.ajaxquery_(_JOF.filepicker,FilepickerCmd.FILEINFO,JSON.stringify(smapOf_(Key.path,e)),t)}getSettings_(t,e){Host.ajaxquery_(_JOF.getSettings,0,t,e)}getTemplatesInfo_(t){Host.ajaxquery_(_JOF.getTemplatesInfo,0,null,t)}updateUISettings_(t,e){Host.ajaxquery_(_JOF.updateUISettings,0,t.toJSONString_(),t=>{e(t)})}updateSessionPreferences_(t,e){Host.ajaxquery_(_JOF.updateSessionPreferences,0,JSON.stringify(t),e)}getSessionPreferences_(t){Host.ajaxquery_(_JOF.getSessionPreferences,0,null,t)}localImageInfo_(t,e){Host.ajaxquery_(_JOF.localImageInfo,0,t,e)}viewPhotoLibraryThumbnail_(t,e,i){Host.ajaxquery_(_JOF.viewPhotoLibraryThumbnail,t,JSON.stringify(e.json_()),i)}previewImage_(t,e,i,n,s,o){Host.ajaxquery_(_JOF.previewImage,0,JSON.stringify([t,e,i,n,s]),o)}localImageThumbnail_(t,e,i,n){Host.ajaxquery_(_JOF.localImageThumbnail,0,JSON.stringify([t,e,i]),n)}importImageFromPhotoLibrary_(t,e,i,n){null!=t.cpath?Host.ajaxquery_(_JOF.importImageFromPhotoLibrary,0,JSON.stringify([t.cpath,t.width,t.height,t.rotation,t.effect,t.adjust,t.quality,t.tnwidth,t.tnheight,e.json_()]),n):n(An.jsonError_(RS.DestinationPathIsRequired))}exportToPhotoLibrary_(t,e){Host.ajaxquery_(_JOF.exportToPhotoLibrary,0,JSON.stringify([t,e]),t=>{toasters$.warnErrorsOrOKKey_(t,RS.ExportToPhotoLibraryOK)})}actionShare_(t){Host.ajaxquery_(_JOF.actionShare,0,t,t=>{toasters$.warn_(t)})}saveHtml_(t,e,i){if(null==t)return;t.length>0&&"/"!=t[0]&&(t="/"+t);const n=native$.getIFrameUri_();this._getXrefs(native$.getIFrameDocument_(),n,n=>{Host.ajaxquery_(_JOF.saveHtml,0,JSON.stringify([t,e,n]),i)})}_getXrefs(t,e,i){const n=json_();if(null==t||null==e)return void i(n);const s=new StringMap,o=(t,i)=>{var n;if(null==t||0==t.length)return;const o=An.cpathOfHref2_(e,t);if(null!=o){let e=s[o];null==e&&(e=json_(),s[o]=e),e[t]=(null!==(n=e[t])&&void 0!==n?n:0)|i}};JsUtil.elementWalker_(t.documentElement,t=>{var e,i,n,s,l;const a=t.getAttribute("href"),r=t.getAttribute("src"),_=t.getAttribute("srcset");if(null==a&&null==r&&null==_)return;const c=t.nodeName;let h=XrefKind.OTHER;switch(c){case"A":h=XrefKind.ANCHOR;break;case"IMG":h=XrefKind.IMAGE;break;case"AUDIO":h=XrefKind.AUDIO;break;case"VIDEO":h=XrefKind.VIDEO;break;case"LINK":h="stylesheet"==(null===(e=t.getAttribute("rel"))||void 0===e?void 0:e.toLowerCase())?XrefKind.STYLESHEET:XrefKind.OTHER;break;case"SOURCE":if(null!=_)h=XrefKind.IMAGE;else{const e=null!==(n=null===(i=t.parentElement)||void 0===i?void 0:i.nodeName)&&void 0!==n?n:null;null!=e&&(h="PICTURE"==e?XrefKind.IMAGE:"AUDIO"==e?XrefKind.AUDIO:"VIDEO"==e?XrefKind.VIDEO:XrefKind.OTHER)}break;case"TRACK":{const e=null!==(l=null===(s=t.parentElement)||void 0===s?void 0:s.nodeName)&&void 0!==l?l:null;null!=e&&(h="AUDIO"==e?XrefKind.AUDIO:"VIDEO"==e?XrefKind.VIDEO:XrefKind.OTHER);break}}o(a,h|XrefKind.HREF),o(r,h|XrefKind.SRC),o(_,h|XrefKind.SRCSET)}),n[XrefKey.LINKS]=s,i(n)}saveBase64Image_(t,e,i){const n=JSON.stringify(smap_([Key.path,t],[Key.data,e]));Host.ajaxquery_(_JOF.saveBase64Image,0,n,i)}writeImage_(t,e,i){Host.ajaxquery_(_JOF.writeImage,0,JSON.stringify([t,e.cpath,e.width,e.height,e.rotation,e.effect,e.adjust,e.quality]),i)}hideCaret_(t,e){e({})}linkInfos_(t,e){Host.ajaxquery_(_JOF.linkVerifier,LinkVerifierCmd.LINKINFOS,JSON.stringify(t),e)}linkInfo_(t,e,i){Host.ajaxquery_(_JOF.linkVerifier,LinkVerifierCmd.LINKINFO,JSON.stringify(smap_([Key.baseurl,t],[Key.path,e])),i)}findFiles_(t,e,i){Host.ajaxquery_(_JOF.findFiles,0,JSON.stringify(smap_([Key.path,t],[Key.text,e])),i)}globalSearch_(t,e,i,n,s,o){Host.ajaxquery_(_JOF.globalSearch,0,JSON.stringify(json_([Key.filterIgnorecase,t],[Key.filter,e],[Key.searchIgnorecase,i],[Key.text,n],[Key.isregex,s])),o)}globalSearchResult_(t,e,i){Host.ajaxquery_(_JOF.globalSearchResult,0,JSON.stringify(json_([Key.id,t],[Key.isregex,e])),i)}createAudioPlayer_(t,e){this.audioInfos_([json_([Key.path,t])],i=>{var n;if(An.hasMessage_(i))return void e(i);const s=null!==(n=i[Key.result])&&void 0!==n?n:null,o=null==s?null:MediaInfo.of_(s[t]);null!=o&&o.fileExists_()?(null==this._dumbPlayer&&(this._dumbPlayer=new _DumbAudioPlayer(t)),e(json_([Key.result,t],[Key.mediainfo,o]))):e(An.jsonError_(RS.AudioNotFound))})}audioPlay_(t,e){if(null!=this._dumbPlayer)return this._dumbPlayer.play(),void e({});e(smapOf_(Key.errors,"Audio playback is already in progress"))}audioPause_(t,e){if(null!=this._dumbPlayer)return this._dumbPlayer.pause(),void e({});e(smapOf_(Key.errors,"Audio playback is not in progress"))}audioSeek_(t,e,i){if(null!=this._dumbPlayer)return this._dumbPlayer.seek(e),void i({});i(smapOf_(Key.errors,"Audio playback not in progress"))}pollAudioPlayer_(t,e){null==this._dumbPlayer?e(smapOf_(Key.errors,"Audio playback not in progress")):e(smapOf_(Key.result,this._dumbPlayer.poll()))}destroyAudioPlayer_(t,e){if(null!=this._dumbPlayer)return this._dumbPlayer.destroy(),this._dumbPlayer=null,void e({});e(smapOf_(Key.errors,"Audio playback not in progress"))}requestAudioRecordingPermission_(t){t({})}startAudioRecording_(t,e,i,n,s){this._audioRecordingInProgress=!0,s({})}stopAudioRecording_(t){this._audioRecordingInProgress=!1,t({})}audioInfos_(t,e){0!=t.length?Host.ajaxquery_(_JOF.audioInfos,0,JSON.stringify(t),e):e({})}videoInfos_(t,e){0!=t.length?Host.ajaxquery_(_JOF.videoInfos,0,JSON.stringify(t),e):e({})}takePhoto_(t,e){Host.ajaxquery_(_JOF.takePhoto,0,JSON.stringify([t,e]),t=>{native$.onCallback_(AjaxAction.takePhotoResult,JSON.stringify(t))})}takePhotoCancelled_(t,e){Host.ajaxquery_(_JOF.takePhotoCancelled,0,JSON.stringify(t.json_()),e)}takeScreenshot_(t,e){e({})}toggleNobackup_(t,e){Host.ajaxquery_(_JOF.toggleNobackup,0,t,e)}getEvents_(t,e,i){Host.ajaxquery_(_JOF.getEvents,0,JSON.stringify(smap_([Key.filterIgnorecase,t],[Key.filter,e])),i)}postEvent_(t,e){Host.ajaxquery_(_JOF.postEvent,0,JSON.stringify(t),e)}removeEvents_(t,e){Host.ajaxquery_(_JOF.removeEvents,0,JSON.stringify(t),e)}clearEvents_(t){Host.ajaxquery_(_JOF.clearEvents,0,null,t)}getPendingAlarmCount_(t){Host.ajaxquery_(_JOF.getPendingAlarmCount,0,null,t)}exportEvents_(t,e){Host.ajaxquery_(_JOF.exportEvents,0,JSON.stringify([t]),e)}isKeyboardShown_(t){t(!0)}hideKeyboard0_(){}hideKeyboard_(t=null){null==t||t()}showKeyboard_(t=null,e=null){null==e||e()}toggleKeyboard_(t=null){null==t||t()}sidepanelChanged_(t){}gestureEnable_(t,e){}onDocumentLoaded_(){this.autoCleanupTrash_(()=>{})}autoCleanupTrash_(t){Timer.sleep0_(()=>{Host.ajaxquery_(_JOF.onDocumentLoaded,0,JSON.stringify(Array.from(native$.cssProperties_().keys())),()=>{this.getSessionPreferences_(e=>{const i=e[Key.result];if(null==i)return;const n=i[SessionPreferencesKey.trashAutoCleanupTimestamp],s=An.ms_();null!=n?s-n<=DEF.trashAutoCleanupInterval?t(!1):this.cleanupTrash_("",e=>{toasters$.info_(e[Key.result],{attop:!0}),this.updateSessionPreferences_(smapOf_(SessionPreferencesKey.trashAutoCleanupTimestamp,s),()=>t(!0))}):this.updateSessionPreferences_(smapOf_(SessionPreferencesKey.trashAutoCleanupTimestamp,s),()=>t(!1))})})})}onDocumentUnload_(){}onBoot_(){}onIFrameLoad_(t){}onIFrameUnload_(t){}clearFocus_(){}actionPrint_(t,e,i){Host.ajaxquery_(_JOF.actionPrint,0,t,i)}getBackupKeyAliases_(t){this.ajaxWithSpinner_(_JOF.getBackupKeyAliases,0,"",t)}deleteBackupKey_(t,e){this.ajax_(_JOF.deleteBackupKey,0,t,e)}importBackupKey_(t,e,i){this.ajax_(_JOF.importBackupKey,0,JSON.stringify([t,e]),i)}actionBackup_(t){host$.getBackupKeyAliases_(e=>{toasters$.warn_(e)||new PromptBackup(accessories$,t,e[Key.result]).show_()})}actionRestore_(t,e=!1){new PromptRestore(accessories$,t).show_()}actionResetUserSettings_(t=!1){DialogUt.confirmSmall_(document.body,MSG.string_(RS.ResetSettingsPrompt),DEF.zindexPrompt,e=>{e?Host.ajaxquery_(_JOF.actionResetUserSettings,0,"",e=>{toasters$.warnErrorsOrOKKey_(e,RS.ResetSettingsOK),t||native$.reloadHome_()}):toasters$.warnKey_(RS.ResetSettingsCancelled)})}factoryReset_(t){DialogUt.promptOK_(document.body,RS.FactoryResetTitle,MSG.string_(RS.FactoryResetMessage),e=>{e?DialogUt.promptOK_(document.body,RS.Confirm,MSG.string_(RS.FactoryResetMessage),e=>{e?host$.ajaxWithSpinner_(_JOF.actionFactoryReset,0,"",t=>{toasters$.warnErrorsOrOKKey_(t,RS.ResetToFactoryDefaultOK),native$.reloadHome_()}):t(An.jsonError_(RS.FactoryResetCancelled))}).zindex_(DEF.zindexPrompt).showError_():t(An.jsonError_(RS.FactoryResetCancelled))}).zindex_(DEF.zindexPrompt).smallWidth_().showWarning_()}actionFactoryReset_(t=!1){this.factoryReset_(e=>{toasters$.warn_(e)||(toasters$.okKey_(RS.FactoryResetOK,{attop:!0}),this._reload(t))})}heartbeat_(){}releaseAudioPlayer_(t,e){e({})}getAudioStatus_(t){t(smap_([Key.recorder,smap_([Key.status,this._audioRecordingInProgress])],[Key.player,json_([Key.status,null!=this._dumbPlayer],[Key.path,null==this._dumbPlayer?null:this._dumbPlayer.path],[Key.isplaying,null!=this._dumbPlayer&&this._dumbPlayer.isPlaying()])]))}saveRecovery_(t,e,i){if(Assert.assertion_(null!=t),t.length>0&&"/"!=t[0]&&(t="/"+t),!PathUtil.isDocumentsSubtree(t))return void i({});const n=native$.serializeIFrameDocument_();Host.ajaxquery_(_JOF.saveRecovery,0,JSON.stringify([t,n]),t=>{i(t)})}scanQRCode_(t,e,i){i({})}playVideo_(t,e,i,n,s){s({})}importVideoFromPhotoLibrary_(t,e,i){i({})}requestVideoRecordingPermission_(t){t({})}recordVideo_(t,e,i,n,s){}exportToPhotoLibraryInfos_(t,e){Host.ajaxquery_(_JOF.exportToPhotoLibraryInfos,0,JSON.stringify([t]),e)}focus_(){}iosPickFromPhotoLibrary_(t,e,i){i(smapOf_(Key.errors,MSG.string_(RS.AssertUnsupportedOperation)))}iosPickFromPhotoLibraryCancelled_(t){}iosSavePhoto_(){}onWindowSizeChanged_(t,e){Host.ajaxquery_(_JOF.onWindowSizeChanged,0,JSON.stringify([t,e]),null)}scanBarcode_(t,e,i){i(smapOf_(Key.errors,MSG.string_(RS.AssertUnsupportedOperation)))}undead_(){Host.ajaxquery_(_JOF.undead,0,null,null)}actionPreview_(t){Host.ajaxquery_(_JOF.actionPreview,0,JSON.stringify([t]),t=>{toasters$.warn_(t)})}generateBarcode_(t,e,i,n){n(An.jsonError_(RS.AssertUnsupportedOperation))}generateGallery_(t,e,i,n,s,o,l){const a=this._checkDestinationPath(t,l);null!=a&&Host.ajaxquery_(_JOF.generateGallery,0,JSON.stringify([a,e,i,n,s,o]),l)}readCSS_(t,e){Host.ajaxquery_(_JOF.readCSS,0,JSON.stringify([t]),e)}saveCSS_(t,e,i,n){Host.ajaxquery_(_JOF.saveCSS,0,JSON.stringify([t,e,i]),n)}formatCSS_(t,e){Host.ajaxquery_(_JOF.formatCSS,0,JSON.stringify([t]),e)}cleanupTrash_(t,e){Host.ajaxquery_(_JOF.cleanupTrash,0,JSON.stringify([t]),e)}_checkDestinationPath(t,e){return null==t?(e(this._errors(MSG.string_(RS.InvalidDestination))),null):(t.length>0&&"/"!=t[0]&&(t="/"+t),t)}findBlog_(t,e,i,n,s){Host.ajaxquery_(_JOF.findBlog,0,JSON.stringify([t,e,i,n]),s)}listBlogs_(t,e,i){Host.ajaxquery_(_JOF.findBlog,0,JSON.stringify([t,e]),i)}imageConversion_(t,e,i,n){Host.ajaxquery_(_JOF.imageConversion,0,JSON.stringify([t,JSON.stringify(e),i.cpath,i.width,i.rotation,i.effect,i.adjust,i.quality]),n)}_reload(t){native$.reloadHome_()}_errors(t){return smapOf_(Key.errors,t)}}Host.DPI=160;class FilepickerHandlerBase{constructor(t){this.cmd$=t}_call(t,e,i){Host.ajaxquery_(this.cmd$,t,JSON.stringify(smapOf_(Key.path,e)),i)}fileInfo_(t,e){this._call(FilepickerCmd.FILEINFO,t,e)}listDir_(t,e){this._call(FilepickerCmd.LISTDIR,t,e)}mkDirs_(t,e){this._call(FilepickerCmd.MKDIRS,t,e)}delete_(t,e){this._call(FilepickerCmd.DELETE,t,e)}rename_(t,e,i){Host.ajaxquery_(this.cmd$,FilepickerCmd.RENAME,JSON.stringify(smap_([Key.path,t],[Key.filename,e])),i)}copy_(t,e,i,n,s,o){const l=json_([Key.cut,t],[Key.timestamp,e],[Key.dst,i],[Key.src,n]);null!=s&&(l[Key.rpaths]=s),Host.ajaxquery_(this.cmd$,FilepickerCmd.COPY,JSON.stringify(l),o)}copyInfo_(t,e,i,n){const s=json_([Key.cut,t],[Key.dst,e],[Key.src,i]);Host.ajaxquery_(this.cmd$,FilepickerCmd.COPY_INFO,JSON.stringify(s),n)}deleteDirSubtree_(t,e){this._call(FilepickerCmd.DELETE_DIRSUBTREE,t,e)}deleteAll_(t,e,i){const n=json_([Key.src,t],[Key.rpaths,e]);Host.ajaxquery_(this.cmd$,FilepickerCmd.DELETE_ALL,JSON.stringify(n),i)}deleteInfo_(t,e){this._call(FilepickerCmd.DELETE_INFO,t,e)}deleteEmptyDirs_(t,e){this._call(FilepickerCmd.DELETE_EMPTY_DIRS,t,e)}localImageInfos_(t,e){this._call(FilepickerCmd.LOCAL_IMAGE_INFOS,t,e)}localImageThumbnails_(t,e,i){const n=json_([Key.size,t],[Key.infos,e]);Host.ajaxquery_(this.cmd$,FilepickerCmd.LOCAL_IMAGE_THUMBNAILS,JSON.stringify(n),i)}listRecursive_(t,e){const i=smapOf_(Key.path,t);Host.ajaxquery_(this.cmd$,FilepickerCmd.LIST_RECURSIVE,JSON.stringify(i),e)}fileInfos_(t,e,i){const n=json_([Key.src,t],[Key.rpaths,e]);Host.ajaxquery_(this.cmd$,FilepickerCmd.FILEINFOS,JSON.stringify(n),i)}dirInfo_(t,e){const i=json_([Key.path,t]);Host.ajaxquery_(this.cmd$,FilepickerCmd.DIRINFO,JSON.stringify(i),e)}}class FilepickerHandler extends FilepickerHandlerBase{constructor(){super(_JOF.filepicker)}}class HistoryFilepickerHandler extends FilepickerHandlerBase{constructor(){super(_JOF.historyFilepicker)}}class RecentsHandler{constructor(){}info_(t){Host.ajaxquery_(_JOF.recents,RecentsCmd.INFO,"",t)}clean_(t){Host.ajaxquery_(_JOF.recents,RecentsCmd.CLEAN,"",t)}clear_(t){Host.ajaxquery_(_JOF.recents,RecentsCmd.CLEAR,"",t)}}class PhotoLibraryImageInfoHandler{constructor(){}infos_(t){Host.ajaxquery_(_JOF.photoLibraryInfos,0,"",t)}thumbnails_(t,e,i){const n=json_([Key.size,t],[Key.infos,e.map(t=>null==t?null:t.json_())]);Host.ajaxquery_(_JOF.photoLibraryThumbnails,0,JSON.stringify(n),i)}}const host$=new Host,fileinfoUt$=new FileInfoUtil(new FilepickerHandler),historyFileinfoUt$=new FileInfoUtil(new HistoryFilepickerHandler);class _DEF{}_DEF.HistorySize=8,_DEF.OutlineTextLen=128,_DEF.SidebarTop=5,_DEF.SidebarActive=5,_DEF.SidepanelPaddingRight=5,_DEF.AudioplayerWidth=320,_DEF.AudioplayerHeight=240,_DEF.SlideshowBGColor="#ccc";class _UICache{constructor(){this._iframe=null,this._buttonSize=null,this._rem=null,this._toolbarHeight=null,this._sidebarHeight=null,this._dpi=null,this._tabStyles=null,this._tabBottoms=null,this._hasClientCss=null}getIFrame_(){return null==this._iframe&&(this._iframe=document.getElementById(ID.contentIFrame)),this._iframe}dpi_(){return null==this._dpi&&(this._dpi=host$.getDPI_()),this._dpi}buttonSize_(){return null==this._buttonSize&&(this._buttonSize=settings$.current_().buttonSize$),this._buttonSize}symbolFontSize_(){return Math.floor(this.buttonSize_()*DEF.symbolFontSizeRatio)}toolbarFontSize_(){return Math.floor(this.buttonSize_()*DEF.toolbarFontSizeRatio)}rem_(){if(null==this._rem){const t=new DomBuilderEx(accessories$).div_({style:"width:1rem"}).cursor_();this._rem=t.offsetWidth,t.remove()}return this._rem}toolbarHeight_(){return null==this._toolbarHeight&&(this._toolbarHeight=settings$.current_().buttonSize$+1),this._toolbarHeight}sidebarHeight_(){return null==this._sidebarHeight&&(this._sidebarHeight=Math.round(document.getElementById(ID.sidebar).getBoundingClientRect().width)),this._sidebarHeight}iwinWidth_(){return window.innerWidth}iwinHeight_(){return window.innerHeight-this.toolbarHeight_()}iwinMax_(){const t=this.iwinWidth_(),e=this.iwinHeight_();return e>t?e:t}iwinPadding_(){return 3*this.iwinMax_()/4}getSidebarTabStyle_(t,e){var i;const n=this._gettabstyles(t);return null==n?null:null!==(i=n.get(e))&&void 0!==i?i:null}exploreBottom_(){return this._gettabbottoms().get(ID.sidebarExplore)}templatesBottom_(){return this._gettabbottoms().get(ID.sidebarTemplates)}documentBottom_(){return this._gettabbottoms().get(ID.sidebarDocument)}resizeBottom_(){var t;return null!==(t=this._gettabbottoms().get(ID.sidebarResize))&&void 0!==t?t:null}hasClientCss_(){return null==this._hasClientCss&&(this._hasClientCss=this._hascss(PATH._assetsClientCss)),this._hasClientCss}addClientCss_(){this._addcss(PATH._assetsClientCss),this._hasClientCss=!0}onIFrameLoad_(){this._reset()}onIFrameUnload_(){this._reset()}onResize_(){this._reset()}_reset(){this._iframe=null,this._buttonSize=null,this._toolbarHeight=null,this._sidebarHeight=null,this._tabStyles=null,this._tabBottoms=null,this._hasClientCss=null}_hascss(t){const e=native$.getIFrameDocument_(),i=native$.getIFrameUri_();if(null==e||null==i)return!1;const n=e.styleSheets,s=n.length;for(let e=0;e<s;++e){const s=n[e],o=s.href,l=s.type;if(null!=l&&null!=o&&"text/css"==l){if(An.cpathOfHref2_(i,o)==t)return!0}}return!1}_addcss(t){const e=native$.getIFrameDocument_();if(null==e)return;const i=e.head,n=i.firstChild;new DomBuilderEx(i).insertBefore_(n,"link",{rel:"stylesheet",type:"text/css",href:"/"+t})}_inittabstyles(){const t=new Map;for(const[e,i]of sidePanel$.sidebarTabs$){const n=An.getComputedStyle_(i),s=new Map;null!=n&&s.set("background-color",n.backgroundColor),t.set(e,s)}this._tabStyles=t}_inittabbottoms(){const t=new Map;for(const[e,i]of sidePanel$.sidebarTabs$)t.set(e,Math.round(i.getBoundingClientRect().bottom));const e=document.getElementById(ID.sidebarResize);null!=e&&t.set(ID.sidebarResize,Math.round(e.getBoundingClientRect().bottom)),this._tabBottoms=t}_gettabstyles(t){var e,i;return null==this._tabStyles&&this._inittabstyles(),null!==(i=null===(e=this._tabStyles)||void 0===e?void 0:e.get(t))&&void 0!==i?i:null}_gettabbottoms(){return null==this._tabBottoms&&this._inittabbottoms(),this._tabBottoms}}class _DocInfo{constructor(t,e){var i;this._href=null,this._uri=null,this._isHtml=!1,this._hasNext=!1,this._hasPrev=!1,this._next=null,this._prev=null,this._version=null,this._recalc=!1,this._fileinfo=null!==(i=FileInfo.of_(t))&&void 0!==i?i:FileInfo.NOT_EXISTS,null==e?(this._href=native$.getIFrameHref_(),null!=this._href&&(this._uri=An.parseUriSafe_(this._href,null))):(this._uri=e,this._href=e.href$),this._isHtml=MimeUtil.isHtmlPath(this._fileinfo.name_())}get href$(){return this._href}get uri$(){return this._uri}get isHtml$(){return this._isHtml}get hasInfo$(){return null!=this._fileinfo}get fileInfo$(){return this._fileinfo}next_(){if(this._isHtml&&null==this._hasNext){const t=native$.getIFrameHead_();if(null!=t){const e=native$.iQuery("link[rel='next']",t);this._hasNext=null!=e,this._next=null!=e?e.getAttribute("href"):null}else this._hasNext=!1,this._next=null}return this._next}prev_(){if(this._isHtml&&null==this._hasPrev){const t=native$.getIFrameHead_();if(null!=t){const e=native$.iQuery("link[rel='prev']",t);this._hasPrev=null!=e,this._prev=null!=e?e.getAttribute("href"):null}else this._hasPrev=!1,this._prev=null}return this._prev}resetPrev_(){this._hasPrev=!1,this._prev=null}resetNext_(){this._hasNext=!1,this._next=null}get version$(){return null==this._version&&(this._version=native$.iGetMetaVersion_()),this._version}getRecalc_(){return this._recalc}setRecalc_(t){this._recalc=t}toString(){return null==this._fileinfo?"null":this._fileinfo.toString()}}class _Cache{constructor(){this._ui=new _UICache,this._lastHomeAction=DateTime.now_().millisecondsSinceEpoch$,this._homeCount=0}get audioContext$(){return null==_Cache._audioContext&&(_Cache._audioContext=new AudioContext),_Cache._audioContext}onIFrameUnload_(){this.ui$.onIFrameUnload_()}onIFrameLoad_(t){this.ui$.onIFrameLoad_()}onResize_(){this.ui$.onResize_()}get ui$(){return this._ui}onHomeAction_(){const t=DateTime.now_().millisecondsSinceEpoch$,e=t-this._lastHomeAction;return++this._homeCount,!!(e>_Cache.TIMEOUT||this._homeCount>_Cache.HOMECOUNT)&&(this._lastHomeAction=t,this._homeCount=0,!0)}}_Cache.TIMEOUT=18e5,_Cache.HOMECOUNT=25,_Cache._audioContext=null;class _WindowResizer{constructor(t){this._isResizing=!1,this._resizeTimer=null,this._width=null,this._height=null,this._subscription=An.subscriptEvent_(t,"resize",()=>this.onresize_())}destroy_(){var t,e;null===(t=this._resizeTimer)||void 0===t||t.cancel_(),this._resizeTimer=null,null===(e=this._subscription)||void 0===e||e.cancel_(),this._subscription=null}onresize_(){var t;null===(t=this._resizeTimer)||void 0===t||t.cancel_(),this._resizeTimer=new Timer(250,()=>this.resizenow_())}resizenow_(){var t;if(this._isResizing)return null===(t=this._resizeTimer)||void 0===t||t.cancel_(),void(this._resizeTimer=new Timer(250,()=>this.resizenow_()));const e=window.innerWidth,i=window.innerHeight;(e!=this._width||i!=this._height)&&(this._isResizing=!0,this._width=e,this._height=i,null!=history$&&history$.startGroup_(RS.HistoryIgnore,""),searchSpotlight$.hide_(),_Util.hideContextmenus_(),cache$.onResize_(),_WindowResizer._resizeIFrame(),sidePanel$.onWindowSizeChanged_(),mainPanel$.onWindowSizeChanged(),host$.onWindowSizeChanged_(e,i),native$.iRevealSelection_(null),sidePanel$.sidepanelWidthInit_(),toasters$.onResize_(),null!=history$&&history$.endGroup_(),this._isResizing=!1,null!=this._resizeTimer&&this._resizeTimer.cancel_(),this._resizeTimer=new Timer(500,()=>this.resizenow_()))}static _resizeIFrame(){_Hacks.fixBody()}}class LifecycleManager{static fireOnBoot(){host$.onBoot_()}static fireOnDocumentLoaded(){host$.onDocumentLoaded_()}static fireOnDocumentUnload(){host$.onDocumentUnload_()}static fireOnDocumentError(t){}static fireOnIFrameLoad(t){cache$.onIFrameLoad_(t),mainPanel$.onIFrameLoad(t),host$.onIFrameLoad_(t);const e=document.getElementById(ID.splash);null!=e&&e.remove()}static fireOnIFrameUnload(t){host$.onIFrameUnload_(t),mainPanel$.onIFrameUnload(t),native$.onIFrameUnload_()}static fireOnIFrameError(t){const e=null!=docInfo$&&docInfo$.fileInfo$.notexists$,i=null!=docInfo$?docInfo$.href$:"";native$.onIFrameUnload_(),toasters$.error_([e?MSG.string_(RS.DocumentNotFound):MSG.string_(RS.ErrorLoadingDocument),i])}}class _GestureHandler{constructor(){this._listeners=new Map}static NOOP(t,e){}pause_(){this.push_(GestureEvent.leftInward,null),this.push_(GestureEvent.leftOutward,null),this.push_(GestureEvent.rightInward,null),this.push_(GestureEvent.rightOutward,null),this.push_(GestureEvent.pinchZoom,null)}resume_(){this.pop_(GestureEvent.leftInward),this.pop_(GestureEvent.leftOutward),this.pop_(GestureEvent.rightInward),this.pop_(GestureEvent.rightOutward),this.pop_(GestureEvent.pinchZoom)}push_(t,e){let i=this._listeners.get(t);void 0===i&&(i=[],this._listeners.set(t,i)),i.push(e),null!=e&&host$.gestureEnable_(t,!0)}pop_(t){const e=this._listeners.get(t);void 0!==e&&0!=e.length&&(e.pop(),0!=e.length&&null!=ArrayUt.last_(e)||host$.gestureEnable_(t,!1))}handle_(t){const e=t[GestureKey.event];if(null==e)return;const i=this._listeners.get(e);if(null==i||0==i.length)return;const n=Array.from(i);for(let i=n.length-1;i>=0;--i){const s=n[i];if(null==s||s(e,t))break}}}class _BootInfo{constructor(){this.reloadCounter=_BootInfo.RELOAD_COUNT,this.bootTimer=new StepTimer("# boot: "),this.isLoggedIn=!1,this.docInfo=null}}_BootInfo.RELOAD_COUNT=10;class CSSTokenType{}CSSTokenType.Ident=0,CSSTokenType.AtKeyword=1,CSSTokenType.String=2,CSSTokenType.BadString=3,CSSTokenType.UnquotedString=4,CSSTokenType.Hash=5,CSSTokenType.Num=6,CSSTokenType.Percentage=7,CSSTokenType.Dimension=8,CSSTokenType.UnicodeRange=9,CSSTokenType.CDO=10,CSSTokenType.CDC=11,CSSTokenType.Colon=12,CSSTokenType.SemiColon=13,CSSTokenType.CurlyL=14,CSSTokenType.CurlyR=15,CSSTokenType.ParenthesisL=16,CSSTokenType.ParenthesisR=17,CSSTokenType.BracketL=18,CSSTokenType.BracketR=19,CSSTokenType.Whitespace=20,CSSTokenType.Includes=21,CSSTokenType.Dashmatch=22,CSSTokenType.SubstringOperator=23,CSSTokenType.PrefixOperator=24,CSSTokenType.SuffixOperator=25,CSSTokenType.Delim=26,CSSTokenType.EMS=27,CSSTokenType.EXS=28,CSSTokenType.Length=29,CSSTokenType.Angle=30,CSSTokenType.Time=31,CSSTokenType.Freq=32,CSSTokenType.Exclamation=33,CSSTokenType.Resolution=34,CSSTokenType.Comma=35,CSSTokenType.Charset=36,CSSTokenType.EscapedJavaScript=37,CSSTokenType.BadEscapedJavaScript=38,CSSTokenType.Comment=39,CSSTokenType.SingleLineComment=40,CSSTokenType.EOF=41,CSSTokenType.CustomToken=42,CSSTokenType.names$=["Ident","AtKeyword","String","BadString","UnquotedString","Hash","Num","Percentage","Dimension","UnicodeRange","CDO","CDC","Colon","SemiColon","CurlyL","CurlyR","ParenthesisL","ParenthesisR","BracketL","BracketR","Whitespace","Includes","Dashmatch","SubstringOperator","PrefixOperator","SuffixOperator","Delim","EMS","EXS","Length","Angle","Time","Freq","Exclamation","Resolution","Comma","Charset","EscapedJavaScript","BadEscapedJavaScript","Comment","SingleLineComment","EOF","CustomToken"];class CSSToken{static end_(t){return t.offset+t.len}static text_(t,e){return t.substr(e.offset,e.len)}}class CSSType{}CSSType.Undefined=0,CSSType.Identifier=1,CSSType.Stylesheet=2,CSSType.Ruleset=3,CSSType.Selector=4,CSSType.SimpleSelector=5,CSSType.SelectorInterpolation=6,CSSType.SelectorCombinator=7,CSSType.SelectorCombinatorParent=8,CSSType.SelectorCombinatorSibling=9,CSSType.SelectorCombinatorAllSiblings=10,CSSType.SelectorCombinatorShadowPiercingDescendant=11,CSSType.Page=12,CSSType.PageBoxMarginBox=13,CSSType.ClassSelector=14,CSSType.IdentifierSelector=15,CSSType.ElementNameSelector=16,CSSType.PseudoSelector=17,CSSType.AttributeSelector=18,CSSType.Declaration=19,CSSType.Declarations=20,CSSType.Property=21,CSSType.Expression=22,CSSType.BinaryExpression=23,CSSType.Term=24,CSSType.Operator=25,CSSType.Value=26,CSSType.StringLiteral=27,CSSType.URILiteral=28,CSSType.EscapedValue=29,CSSType.Function=30,CSSType.NumericValue=31,CSSType.HexColorValue=32,CSSType.MixinDeclaration=33,CSSType.MixinReference=34,CSSType.VariableName=35,CSSType.VariableDeclaration=36,CSSType.Prio=37,CSSType.Interpolation=38,CSSType.NestedProperties=39,CSSType.ExtendsReference=40,CSSType.SelectorPlaceholder=41,CSSType.Debug=42,CSSType.If=43,CSSType.Else=44,CSSType.For=45,CSSType.Each=46,CSSType.While=47,CSSType.MixinContent=48,CSSType.Media=49,CSSType.Keyframe=50,CSSType.FontFace=51,CSSType.Import=52,CSSType.Namespace=53,CSSType.Invocation=54,CSSType.FunctionDeclaration=55,CSSType.ReturnStatement=56,CSSType.MediaQuery=57,CSSType.FunctionParameter=58,CSSType.FunctionArgument=59,CSSType.KeyframeSelector=60,CSSType.ViewPort=61,CSSType.Document=62,CSSType.AtApplyRule=63,CSSType.CustomPropertyDeclaration=64,CSSType.CustomPropertySet=65,CSSType.ListEntry=66,CSSType.Supports=67,CSSType.SupportsCondition=68,CSSType.NamespacePrefix=69,CSSType.GridLine=70,CSSType.Plugin=71,CSSType.UnknownAtRule=72,CSSType.names$=["Undefined","Identifier","Stylesheet","Ruleset","Selector","SimpleSelector","SelectorInterpolation","SelectorCombinator","SelectorCombinatorParent","SelectorCombinatorSibling","SelectorCombinatorAllSiblings","SelectorCombinatorShadowPiercingDescendant","Page","PageBoxMarginBox","ClassSelector","IdentifierSelector","ElementNameSelector","PseudoSelector","AttributeSelector","Declaration","Declarations","Property","Expression","BinaryExpression","Term","Operator","Value","StringLiteral","URILiteral","EscapedValue","Function","NumericValue","HexColorValue","MixinDeclaration","MixinReference","VariableName","VariableDeclaration","Prio","Interpolation","NestedProperties","ExtendsReference","SelectorPlaceholder","Debug","If","Else","For","Each","While","MixinContent","Media","Keyframe","FontFace","Import","Namespace","Invocation","FunctionDeclaration","ReturnStatement","MediaQuery","FunctionParameter","FunctionArgument","KeyframeSelector","ViewPort","Document","AtApplyRule","CustomPropertyDeclaration","CustomPropertySet","ListEntry","Supports","SupportsCondition","NamespacePrefix","GridLine","Plugin","UnknownAtRule"];class CSSNode{static text_(t,e){return t.substr(e.offset,e.length)}}class CSSError{}class LineMap{constructor(t){this._input=t,this._offsets=[0];let e=0;for(;;){const t=this._input.indexOf("\n",e);if(t<0)return;e=t+1,this._offsets.push(e)}}lineCol(t){let e=this._search(t);return e<0&&(e=-e-2),`${e+1}:${t-this._offsets[e]+1}`}_search(t){let e=0,i=this._offsets.length-1;for(;e<=i;){const n=e+i>>>1,s=this._offsets[n];if(s<t)e=n+1;else{if(!(s>t))return n;i=n-1}}return-(e+1)}}class CSSParser{constructor(){this.cssparser$=window.XxA7}scanStylesheet_(t){const e=new Array,i=this.cssparser$[CSSParser._SCAN](t,!1);for(;;){const t=i.scan();if(e.push(t),t.type==CSSTokenType.EOF)break}return e}parseStylesheet_(t){return this.cssparser$[CSSParser._PARSER](t)}parseRuleset_(t){return this.cssparser$[CSSParser._RULESET](t)}parseDecls_(t){return this.cssparser$[CSSParser._DECLS](t)}parseDecl_(t){return this.cssparser$[CSSParser._DECL](t)}parseExpr_(t){return this.cssparser$[CSSParser._EXPR](t)}hasError_(t){return this.cssparser$[CSSParser._HASISSUE](t)}errors_(t){return this.cssparser$[CSSParser._ISSUES](t)}parseGradient_(t){if(0==t.length)return null;const e=this.parseExpr_(t);if(this.hasError_(e))return null;const i=CSSParser.decodeFunc_(e);if(null==i)return null;const n=CSSNode.text_(t,i[0]);if(!An.isGradient_(n+"("))return null;const s=i[1];let o="";if(s.length>0){const e=CSSParser.firstDescendant_(s[0],CSSType.Term);if(null==e)return null;const i=CSSNode.text_(t,e);i.startsWith("#")||i.startsWith("rgb(")||i.startsWith("rgba(")||(o=i,s.shift())}const l=CSSParser.decodeColorStops_(t,s);return null==l?null:new Gradient(n,o,l)}findColor_(t){if(0==t.length)return null;const e=this.parseExpr_(t);return this.hasError_(e)?null:CSSParser.findTerm_(e,e=>{const i=CSSNode.text_(t,e);return i.startsWith("rgb(")||i.startsWith("rgba(")||i.startsWith("#")})}_sanitizeValue(t,e,i,n,s){const o=n.children;if(!o||o.length<2)return!1;const l=o[0],a=o[1];if(l.type!=CSSType.Property)return!1;const r=o.length>2?" "+CSSNode.text_(e,o[2]):"";return t[CSSNode.text_(e,l)]=CSSSanitizer.sanitizeValue_(e,i,a,s)+r,!0}sanitizeStyle_(t,e,i){if(0==t.length)return void i(smap_());const n="{"+t+"}",s=this.parseDecls_(n),o=sarray_(),l=this.errors_(s),a=new LineMap(t);if(l&&l.length>0)for(const t of l)o.push(`@${a.lineCol(t.offset-1)}: ${t.message}`);const r=smap_();if(null!=s&&s.children)for(const t of s.children)if(t.type==CSSType.Declaration&&!this._sanitizeValue(r,n,e,t,(t,e)=>{o.push(`@${a.lineCol(e-1)}: ${t} `)}))return void i(smapOf_(Key.errors,`@${a.lineCol(t.offset-1)}: `+MSG.string_(RS.ErrorParsingStyle)));o.length>0?i(json_([Key.errors,o],[Key.style,r])):i(jsonOf_(Key.style,r))}sanitizeRuleset_(t,e,i){const n=this.parseRuleset_(t),s=sarray_(),o=this.errors_(n),l=new LineMap(t);if(o&&o.length>0)for(const t of o)s.push(`@${l.lineCol(t.offset)}: ${t.message}`);const a=CSSParser.findChild_(n,CSSType.Declarations),r=smap_();if(null!=a&&a.children)for(const n of a.children)if(n.type==CSSType.Declaration&&!this._sanitizeValue(r,t,e,n,(t,e)=>{s.push(`@${l.lineCol(e)}: ${t}`)}))return void i(smapOf_(Key.errors,` @${l.lineCol(n.offset)}`+MSG.string_(RS.ErrorParsingStyle)));const _=CSSSanitizer.sanitizeRuleset_(t,e,n,(t,e)=>{s.push(`@${l.lineCol(e)}: ${t}`)});s.length>0?i(json_([Key.errors,s],[Key.cssrule,_],[Key.style,r])):i(json_([Key.cssrule,_],[Key.style,r]))}static findTerm_(t,e){if(t.type==CSSType.Term&&e(t))return t;if(t.children)for(const i of t.children){const t=this.findTerm_(i,e);if(null!=t)return t}return null}static count_(t,e){let i=0;for(const n of t)n.type==e&&++i;return i}static childAt_(t,e=0){return null!=t&&t.children&&t.children.length>e?t.children[e]:null}static textAt_(t,e,i=0,n=""){const s=this.childAt_(e,i);return null==s?n:CSSNode.text_(t,s)}static find_(t,e){return null==t?null:t.type==e?t:this.findChild_(t,e)}static findChild_(t,e){if(null==t||!t.children)return null;for(const i of t.children)if(i.type==e)return i;return null}static firstDescendant_(t,e){return null==t?null:t.type==e?t:this.firstDescendant_(this.childAt_(t),e)}static decodeFunc_(t){const e=this.firstDescendant_(t,CSSType.Function),i=this.childAt_(e,0);if(null==i)return null;const n=new Array,s=this.childAt_(e,1);if(null!=s&&s.children)for(const t of s.children){if(t.type!=CSSType.FunctionArgument)return null;n.push(t)}return[i,n]}static decodeColorStops_(t,e){const i=new Array;for(const n of e){const e=this.childAt_(n);if(null==e||e.type!=CSSType.Expression||!e.children||e.children.length<1)return null;const s=CSSNode.text_(t,e.children[0]),o=this.textAt_(t,e,1,"");i.push(new ColorStop(s,o))}return i}static hasSingleRuleset_(t){const e=this.firstDescendant_(t,CSSType.Ruleset);return!(null==e||!e.parent||!e.parent.children)&&1==this.count_(e.parent.children,CSSType.Ruleset)}}CSSParser._NODETYPE="Xxq",CSSParser._HASISSUE="XhA",CSSParser._ISSUES="X4n",CSSParser._EXPR="XZi",CSSParser._DECL="X2b",CSSParser._FORMAT="Xlf",CSSParser._RULESET="X4W",CSSParser._PARSER="X5e",CSSParser._SCAN="X2U",CSSParser._DECLS="XFY";class CSSSanitizer{constructor(t,e,i){this.input$=t,this.baseuri$=e,this.onError$=i,this.buf$=sarray_(),this.indent$="",this.tab$="  "}_onUri(t,e){const i=CSSUtil.firstCSSUrl_(t);if(null==i)return;const n=An.parseUriSafe_(i[1],this.baseuri$);null!=n?Sanitizers.sanitizeFilepath_(n.pathSegments$,t=>this.onError$(t,e)):this.onError$(MSG.string1_(RS.InvalidURL_,i[1]),e)}node_(t){return this.buf$.push(CSSNode.text_(this.input$,t)),this}text_(t){return this.buf$.push(t),this}substring_(t,e){const i=this.input$.substring(t,e).trim();return i.length>0&&this.buf$.push(i),this}lb_(t=""){return this.buf$.push(`\n${this.indent$}${t}`),this}indent_(){return this.indent$+=this.tab$,this}undent_(){return this.indent$=this.indent$.substring(0,this.indent$.length-this.tab$.length),this}chd_(t,e=null){if(t.children){const i=t.children.length-1;t.children.forEach((t,n)=>{this._fmt(t),n!=i&&(null==e||e(t))})}return this}func_(t){if(t.children&&t.children.length>0){if(this.node_(t.children[0]),this.text_("("),t.children.length>1){const e=t.children[1];this.args_(e,e.offset)}this.text_(")")}return t.end}args_(t,e){if(t.children){const i=t.children.length-1;t.children.forEach((t,n)=>{(e=this.expr1_(t,t.offset))<t.end&&this.substring_(e,t.end),n!=i&&this.text_(", ")})}}expr_(t,e){if(t.children){const i=t.children.length-1;for(let n=0;n<=i;++n){const s=t.children[n];e=this.expr1_(s,e),n<i&&(e<s.end&&this.substring_(e,s.end),e=t.children[n+1].offset,this.substring_(s.end,e),this.text_(" "))}}return e}expr1_(t,e){if(t.type==CSSType.Function)return this.substring_(e,t.offset),this.func_(t);if(t.type==CSSType.URILiteral){this.substring_(e,t.offset);let i=CSSNode.text_(this.input$,t);const n=CSSSanitizer.regexUri.exec(i);return null!=n&&(i="url("+n[1]+")"),this._onUri(i,t.offset),this.text_(i),t.end}if(t.type==CSSType.Expression)return this.expr_(t,e);if(t.children)for(const i of t.children)e=this.expr1_(i,e);return e}_fmt(t){switch(t.type){case CSSType.AtApplyRule:this.text_("@apply ");break;case CSSType.Declaration:this.chd_(t).text_(";");break;case CSSType.Declarations:this.text_("{").indent_().lb_().chd_(t,()=>this.lb_()).undent_().lb_("}").lb_();break;case CSSType.Identifier:this.node_(t);break;case CSSType.Prio:this.text_(" !important");break;case CSSType.Property:this.node_(t).text_(": ");break;case CSSType.Selector:this.chd_(t,()=>this.text_(",").lb_()).text_(" ");break;case CSSType.SimpleSelector:this.node_(t);break;case CSSType.SelectorCombinatorParent:this.text_(" > ");break;case CSSType.SelectorCombinatorSibling:this.text_(" + ");break;case CSSType.SelectorCombinatorAllSiblings:this.text_(" ~ ");break;case CSSType.SelectorCombinatorShadowPiercingDescendant:this.text_(" >>> ");break;case CSSType.SimpleSelector:this.node_(t);break;case CSSType.Undefined:case CSSType.Stylesheet:case CSSType.Ruleset:this.chd_(t);break;case CSSType.Expression:{const e=this.expr_(t,t.offset);e<t.end&&this.substring_(e,t.end);break}case CSSType.Page:case CSSType.PageBoxMarginBox:case CSSType.ClassSelector:case CSSType.IdentifierSelector:case CSSType.ElementNameSelector:case CSSType.SelectorCombinator:case CSSType.SelectorInterpolation:case CSSType.PseudoSelector:case CSSType.AttributeSelector:case CSSType.BinaryExpression:case CSSType.Term:case CSSType.Operator:case CSSType.Value:case CSSType.StringLiteral:case CSSType.URILiteral:case CSSType.EscapedValue:case CSSType.Function:case CSSType.NumericValue:case CSSType.HexColorValue:case CSSType.MixinDeclaration:case CSSType.MixinReference:case CSSType.VariableName:case CSSType.VariableDeclaration:case CSSType.Interpolation:case CSSType.NestedProperties:case CSSType.ExtendsReference:case CSSType.SelectorPlaceholder:case CSSType.Debug:case CSSType.If:case CSSType.Else:case CSSType.For:case CSSType.Each:case CSSType.While:case CSSType.MixinContent:case CSSType.Media:case CSSType.Keyframe:case CSSType.FontFace:case CSSType.Import:case CSSType.Namespace:case CSSType.Invocation:case CSSType.FunctionDeclaration:case CSSType.ReturnStatement:case CSSType.MediaQuery:case CSSType.FunctionParameter:case CSSType.FunctionArgument:case CSSType.KeyframeSelector:case CSSType.ViewPort:case CSSType.Document:case CSSType.CustomPropertyDeclaration:case CSSType.CustomPropertySet:case CSSType.ListEntry:case CSSType.Supports:case CSSType.SupportsCondition:case CSSType.NamespacePrefix:case CSSType.GridLine:case CSSType.Plugin:case CSSType.UnknownAtRule:default:this.onError$(MSG.string_(RS.InvalidCSSStyle_)+CSSNode.text_(this.input$,t),t.offset)}}_sanitize(t){return this._fmt(t),this.buf$.join("")}static sanitizeValue_(t,e,i,n){return new CSSSanitizer(t,e,n)._sanitize(i)}static sanitizeRuleset_(t,e,i,n){return new CSSSanitizer(t,e,n)._sanitize(i)}}CSSSanitizer.regexUri=RegExp("^url\\(\\s*(.*?)\\s*\\)$");class FormatOptions{constructor(t="  "){this.tab$=t}static getPreference(t){host$.getSessionPreferences_(e=>{let i=FormatOptions.DEFAULT$;const n=e[Key.result];if(n){const t=n[SessionPreferencesKey.indentTab];null!=t&&(i=new FormatOptions(t))}t(i)})}}FormatOptions.DEFAULT$=new FormatOptions;class FormatBuf{constructor(t,e,i=FormatOptions.DEFAULT$){this.input$=t,this.tokens$=e,this.options$=i,this.buf$=sarray_(),this.indent$="",this.tab$=this.options$.tab$,this.lb=TextUt.lineSep$,this.length$=this.input$.length}emit_(t){return t.type==CSSTokenType.Whitespace?this._ws(t):t.type==CSSTokenType.Comment?this.space_()._emit(t):this._emit(t),this}emit0_(t){return t.type==CSSTokenType.Whitespace?this:(t.type==CSSTokenType.Comment?this.space_()._emit(t):this._emit(t),this)}emitx_(t){return null!=t&&this.emit_(t),this}emita_(t){for(const e of t)this.emit_(e);return this}emit1_(){return this.emitx_(this.tokens$.shift())}emitss_(){return this.emita_(this._getssOf(this.tokens$))}emitssBeforeLinebreak_(){return this.emita_(this.get_(t=>t.type==CSSTokenType.Whitespace&&!CSSToken.text_(this.input$,t).includes(this.lb)||t.type==CSSTokenType.Comment))}emitWhile_(t){return this.emita_(this._get(this.tokens$,t))}emitUntilOffset_(t){return this.emitWhile_(e=>e.offset<t)}emitUntilType_(t){return this.emita_(this._get(this.tokens$,e=>e.type!=t))}emitSpace0_(t){const e=this._get(this.tokens$,e=>e.offset<t);for(;this.emitss0Of_(e),e.length>0&&this.emit1Of_(e),0!=e.length;);return this}emitss0Of_(t){const e=this._getssOf(t);return void 0===e.find(t=>t.type!=CSSTokenType.Whitespace)?this:this.emita_(e)}emitssOf_(t){return this.emita_(this._getssOf(t))}emit1Of_(t){return this.emitx_(t.shift())}emitwOf_(t,e){return this.emita_(this._get(t,e))}emitUntilTypeOf_(t,e){return this.emita_(this._get(t,t=>t.type!=e))}emitSpace0Space1Of_(t){return this.emitssOf_(t).space0_().emita_(t).space1_()}node_(t){return this.emitUntilOffset_(t.end)}space_(){return this._wasWs()||this._push(" "),this}space0_(){return this._trimRight()}space1_(){return this._trimRight(),this._push(" "),this}lb_(){for(;this._wasEmptyLine();)this.buf$.pop();return this._push(`${this.lb}${this.indent$}`),this}indent_(){return this.indent$+=this.tab$,this}undent_(){return this.indent$=this.indent$.substring(0,this.indent$.length-this.tab$.length),this}join_(t){return this.buf$.join(t)}get_(t){return this._get(this.tokens$,t)}getTillOffset_(t){return this._get(this.tokens$,e=>e.offset<t)}_get(t,e){const i=t.findIndex(t=>!e(t));return t.splice(0,i>=0?i:t.length)}_getssOf(t){return this._get(t,t=>t.type==CSSTokenType.Whitespace||t.type==CSSTokenType.Comment)}_emit(t){return this._push(CSSToken.text_(this.input$,t)),this}_push(t){this.buf$.push(t)}_ws(t){CSSToken.text_(this.input$,t).includes(this.lb)?this.lb_():this.space_()}_trimRight(){for(;;){const t=ArrayUt.last_(this.buf$);if(void 0!==t){const e=t.trimRight();if(0==e.length){this.buf$.pop();continue}e.length!=t.length&&(this.buf$[this.buf$.length-1]=e);break}}return this}_wasWs(){const t=ArrayUt.last_(this.buf$);return void 0===t||RX.EndsWithWhitespaces.test(t)}_wasEmptyLine(){const t=ArrayUt.last_(this.buf$);return void 0!==t&&RX.IsWhitespaces.test(t)}}class CSSFormatter extends FormatBuf{constructor(t,e,i=FormatOptions.DEFAULT$){super(t,e,i)}static formatStylesheet_(t,e){const i=cssParser$.scanStylesheet_(t),n=cssParser$.parseStylesheet_(t);return new CSSFormatter(t,i,e)._format(n)}_format(t){return this.fmt_(t),this.join_("")}fmt_(t){switch(this.emitss_(),t.type){case CSSType.Stylesheet:this.chd_(t).emita_(this.getTillOffset_(this.length$));break;case CSSType.CustomPropertyDeclaration:case CSSType.Declaration:this.chd_(t,t=>this.emitSpace0Space1Of_(t));break;case CSSType.Declarations:this.emitUntilType_(CSSTokenType.CurlyL).emit1_().emitssBeforeLinebreak_().indent_().lb_().chd_(t,t=>this.emitssOf_(t).space0_().emita_(t).emitssBeforeLinebreak_().lb_(),t=>{this.emitssOf_(t).space0_().emitUntilTypeOf_(t,CSSTokenType.CurlyR).undent_().lb_().emita_(t).emitssBeforeLinebreak_().lb_()});break;case CSSType.Ruleset:if(t.children&&2==t.children.length){this.chd_(t.children[0],t=>this.space0_().emita_(t).emitssBeforeLinebreak_().lb_(),t=>this.emitSpace0Space1Of_(t)),this.fmt_(t.children[1]);break}this.node_(t);break;case CSSType.Selector:this.chd_(t,t=>this.emitssOf_(t).space1_().emita_(t));break;case CSSType.SelectorCombinatorParent:case CSSType.SelectorCombinatorSibling:case CSSType.SelectorCombinatorAllSiblings:case CSSType.SelectorCombinatorShadowPiercingDescendant:this.space_().node_(t).space_();break;case CSSType.Expression:this.expr_(t,t.offset)<t.end&&this.emitWhile_(e=>e.offset<t.end);break;case CSSType.Media:{const e=t.children&&t.children.length>0?t.children[0].offset:t.end;if(this.emitWhile_(t=>t.offset<e).space_(),t.children){const e=t.children,i=e.length;i>1&&this.chd_(e[0],t=>this.emitSpace0Space1Of_(t),t=>this.emitSpace0Space1Of_(t));for(let t=1;t<i;++t)this.fmt_(e[t]);break}this.chd_(t);break}case CSSType.Keyframe:case CSSType.Page:case CSSType.PageBoxMarginBox:case CSSType.FontFace:case CSSType.Import:case CSSType.Namespace:case CSSType.KeyframeSelector:case CSSType.UnknownAtRule:{const e=this.while_(t,t=>t.type!=CSSType.Declarations);null!=e&&this.space_().fmt_(e);break}case CSSType.SimpleSelector:case CSSType.Undefined:this.chd_(t);break;case CSSType.AtApplyRule:case CSSType.Identifier:case CSSType.Prio:case CSSType.Property:case CSSType.MediaQuery:case CSSType.SimpleSelector:case CSSType.ClassSelector:case CSSType.IdentifierSelector:case CSSType.ElementNameSelector:case CSSType.SelectorCombinator:case CSSType.SelectorInterpolation:case CSSType.PseudoSelector:case CSSType.AttributeSelector:case CSSType.VariableName:case CSSType.MixinDeclaration:case CSSType.MixinReference:case CSSType.VariableDeclaration:case CSSType.Interpolation:case CSSType.NestedProperties:case CSSType.ExtendsReference:case CSSType.SelectorPlaceholder:case CSSType.Debug:case CSSType.If:case CSSType.Else:case CSSType.For:case CSSType.Each:case CSSType.While:case CSSType.MixinContent:case CSSType.Invocation:case CSSType.FunctionDeclaration:case CSSType.ReturnStatement:case CSSType.ViewPort:case CSSType.Document:case CSSType.CustomPropertySet:case CSSType.ListEntry:case CSSType.Supports:case CSSType.SupportsCondition:case CSSType.NamespacePrefix:case CSSType.GridLine:case CSSType.Plugin:default:this.node_(t)}}chd_(t,e=null,i=null){if(t.children){const i=t.children,n=i.length-1;i.forEach((t,s)=>{if(this.fmt_(t),s<n){const t=i[s+1].offset,n=this.getTillOffset_(t);null!=e?e(n):this.emita_(n)}})}const n=this.getTillOffset_(t.end);return null!=i?i(n):this.emita_(n),this}while_(t,e){const i=t.children;if(!i)return null;for(const t of i)if(!e(t))return this.emitWhile_(e=>e.offset<t.offset),t;return this.emitWhile_(e=>e.offset<t.end),null}func_(t){if(t.children&&t.children.length>0){if(this.node_(t.children[0]),t.children.length>1){const e=t.children[1];this.emitSpace0_(e.offset),this.args_(e,e.offset)}this.emitSpace0_(t.end)}return t.end}args_(t,e){if(t.children){const e=t.children,i=e.length-1;e.forEach((t,n)=>{if(this.expr1_(t,t.offset)<t.end&&this.emitWhile_(e=>e.offset<t.end),n!=i){const t=e[n+1];this.emitSpace0Space1Of_(this.get_(e=>e.offset<t.offset))}})}}expr_(t,e){if(t.children){const i=t.children.length-1;for(let n=0;n<=i;++n){const s=t.children[n];e=this.expr1_(s,e),n<i&&(e<s.end&&this.emitWhile_(t=>t.offset<s.end),this.emitss_().space1_())}}return e}expr1_(t,e){if(t.type==CSSType.Function)return this.func_(t);if(t.type==CSSType.URILiteral)return this.node_(t),t.end;if(t.type==CSSType.Expression)return this.expr_(t,e);if(t.children)for(const i of t.children)e=this.expr1_(i,e);return e}}const gestureHandler$=new _GestureHandler;let bootInfo$,settings$,cache$,accessories$,iframe$,bootPreferences$=json_(),docInfo$=null,cssParser$=new CSSParser;class _Main{run_(){var t,e,i,n,s;(bootInfo$=new _BootInfo).bootTimer.debug_("start"),bootInfo$.bootTimer.debug_("init"),accessories$=document.getElementById(ID.accessories),cache$=new _Cache,bootInfo$.bootTimer.debug_("created accessories");const o=Assert.notNull_(native$.getSettings_());settings$=new Settings(null!==(t=null==o?void 0:o[Key.result])&&void 0!==t?t:json_()),bootPreferences$=null!==(e=null==o?void 0:o[Key.status])&&void 0!==e?e:json_(),bootInfo$.isLoggedIn=null!==(i=null==o?void 0:o[Key.isloggedin])&&void 0!==i&&i,bootInfo$.docInfo=null==o?void 0:o[Key.fileinfo],bootInfo$.bootTimer.debug_("settings"),native$.onBoot_(settings$),window.addEventListener("unload",()=>{LifecycleManager.fireOnDocumentUnload()}),window.addEventListener("error",t=>{LifecycleManager.fireOnDocumentError(t)});const l=t=>{t.stopImmediatePropagation(),An.stopevent_(t)};window.addEventListener("doubleclick",l),window.addEventListener("contextmenu",l),window.addEventListener("dragstart",l),window.addEventListener("drag",l),window.addEventListener("drop",l),An.onKeypress_(window,t=>{var e;if(t.ctrlKey)switch(t.key){case"f":case"F":null===(e=null==mainPanel$?void 0:mainPanel$._mainToolbar)||void 0===e||e.toggleSearchbar_(t);break;case"i":case"I":t.shiftKey&&(An.stopevent_(t),host$.showDeveloperTools_());break;case"w":case"W":case"r":case"R":t.stopImmediatePropagation(),An.stopevent_(t)}}),An.onTouchEnd_(window,t=>{if(null!=host$){const e=DomUt.asHTMLElement_(t.target);if(null!=e){if("HTML"==e.nodeName)return host$.hideKeyboard0_(),void host$.undead_()}host$.heartbeat_()}}),LifecycleManager.fireOnBoot();let a=settings$.getUrl_(Conf.publicHomePath);const r=An.parseUriSafe_(window.location.href,null);Assert.assertion_(null!=r);const _=r.queryParameters$;let c=_.get(Param.path);if(null!=c){const t=_.get(Param.fragment);c.startsWith("/")||(c="/"+c);const e=c.split("/"),i=new Map;null!=t&&t.length>0&&i.set(Param.fragment,t);for(const t of[Param.session,Param.t,Param.poster]){const e=_.get(t);null!=e&&i.set(t,e)}const o=null!==(s=null===(n=ArrayUt.last_(e))||void 0===n?void 0:n.toLowerCase().endsWith(".html"))&&void 0!==s&&s,l=_.get(Param.view);o||null==l||i.set(Param.view,l);const r=An.uriFromSafe_(null,e,i);null!=r&&(a=r.toString()),null!=bootInfo$&&(bootInfo$.docInfo=null)}(iframe$=document.getElementById(ID.contentIFrame)).addEventListener("error",t=>{const e=t;LifecycleManager.fireOnIFrameError(`${e}: ${null==e?"null":e.filename}: ${null==e?"null":e.error}`)}),iframe$.addEventListener("doubleclick",l),iframe$.addEventListener("contextmenu",l),iframe$.addEventListener("load",()=>{_Main._onIFrameLoad()}),iframe$.src=a}static _hack(t,e){if(t<=cache$.ui$.buttonSize_()){const t=DomUt.asHTMLElement_(e);if(null!=t&&"HTML"==t.nodeName)return!0}return!1}static _onIFrameLoad(){const t=null!=bootInfo$?bootInfo$.bootTimer:new StepTimer("# iframe.load: ");t.debug_("_onIFrameLoad: start");const e=_Main._validateIFrame(t);null!=e&&native$.onIFrameLoad_(()=>{native$.iAddEventListener_(null,"error",t=>{LifecycleManager.fireOnIFrameError(`${t}`)},!0),native$.iAddEventListener_(null,"unload",()=>{LifecycleManager.fireOnIFrameUnload(null==docInfo$?null:docInfo$.uri$),_Main.resetIFrame_()},!0),null!=bootInfo$&&null!=bootInfo$.docInfo?_Main._onIFrameBoot(bootInfo$.docInfo,e):null!=bootInfo$?(t.debug_("# getDocInfo"),host$.getDocInfo_(t=>{_Main._onIFrameBoot(t[Key.fileinfo],e)})):(_Main.resetIFrame_(),host$.getDocInfo_(i=>{var n;docInfo$=new _DocInfo(i[Key.fileinfo],e),t.debug_(`getDocInfo(): ${docInfo$}`),LifecycleManager.fireOnIFrameLoad(null!==(n=null==docInfo$?void 0:docInfo$.uri$)&&void 0!==n?n:null),t.debug_("done")}))})}static _onIFrameBoot(t,e){Timer.sleep0_(()=>{const i=bootInfo$.bootTimer;i.debug_(`# _onIFrameBoot: docInfo: ${JSON.stringify(t)}`),_WindowResizer._resizeIFrame(),i.debug_("resize"),docInfo$=new _DocInfo(t,e),mainPanel$._isLoggedIn=bootInfo$.isLoggedIn,Conf.useSweep&&gestureHandler$.push_(GestureEvent.leftInward,_SidePanel._handleGesture),LifecycleManager.fireOnIFrameLoad(docInfo$.uri$),LifecycleManager.fireOnDocumentLoaded(),i.debug_("done"),bootInfo$=null})}static _validateIFrame(t){try{return _Main._validateIFrame1(t)}catch(t){}return _Main._error500(null,RS.ErrorLoadingDocument),null}static _validateIFrame1(t){const e=native$.getIFrameHref_();if(null==e)throw"";if(t.debug_(`href=${e}`),!e.startsWith(`${Conf.scheme}:`)){if(null!=bootInfo$&&e.startsWith("about:"))return null;throw""}const i=An.parseUriSafe_(e,null);if(null==i)return _Main._error500(i,RS.InvalidURL),null;const n=i.pathSegments$;if(_Main._isrootpage(n))return _Main._error500(i,RS.InvalidURL),null;const s=i.queryParameters$,o=s.has(Param.view),l=Basepath.lcExt_(ArrayUt.last_(n)),a=MimeUtil.mediaMimeFromLcExt(l);if(o){if("html"==l){const t=Uri.asMap_(s);t.delete(Param.view);const e=An.uriFromSafe_(null,n,t,i.hash$);return _Main._redirect(e),null}return null==a?(_Main._error500(i,RS.UnsupportedFileType),null):i}if(a==MimeUtil.PDF)return i;if(null!=a){const t=Uri.asMap_(s);return t.set(Param.view,""),_Main._redirect(An.uriFromSafe_(null,n,t,i.hash$)),null}if("html"==l){const t=native$.getIFrameDocument_();return native$.iQueryAll_(INVALID_TAGS.join(", "),t).length>0?(_Main._error500(i,RS.UnsupportedTag),null):i}return _Main._error500(i,RS.ExpectingHtml),null}static _error500(t,e){var i;const n=MSG.string_(e);(null!==(i=null==t?void 0:t.pathSegments$.join("/"))&&void 0!==i?i:null)!=Conf.errorPath&&(null!=bootInfo$&&(bootInfo$.docInfo=null),_Main._error(settings$.getUrl_(Conf.errorPath+native$.asPathQuery_(t)+"&msg="+encodeURIComponent(n))))}static _error(t){null!=mainPanel$&&mainPanel$.onIFrameError(),native$.onIFrameUnload_(),iframe$.src=t}static _redirect(t){null!=t?(native$.onIFrameUnload_(),iframe$.src=t.href$):this._error500(t,RS.InvalidURL)}static resetIFrame_(){cache$.onIFrameUnload_(),docInfo$=null}static _isrootpage(t){const e=sarray_();for(const i of t)i.length>0&&e.push(i);switch(e.length){case 0:return!0;default:return _Main._isrootpath(e[0])}}static _isrootpath(t){return 0==t.length||"index.html"==t.toLowerCase()}static _onResizeWindow(){return null!=_Main._windowResizer&&_Main._windowResizer.onresize_(),null}static _onGestureEvent(t){const e=An.parseJSONObjectOrNull_(t);return null!=e&&gestureHandler$.handle_(e),null}}_Main._windowResizer=null,(new _Main).run_();class _SymbolPreferences{constructor(t){this._family=DEF.FontAwesome,this._recents=[];const e=t[Key.result];if(null!=e){const t=e[SessionPreferencesKey.symbolFamily];null!=t&&(this._family=t);const i=e[SessionPreferencesKey.symbolRecents];null!=i&&(this._recents=i)}}static get_(t){null==_SymbolPreferences._singleton?host$.getSessionPreferences_(e=>{const i=new _SymbolPreferences(e);_SymbolPreferences._singleton=i,t(i)}):t(_SymbolPreferences._singleton)}get family$(){return this._family}get recents$(){return this._recents}settings(){return settings$}getGestureHandler(){return gestureHandler$}updateSymbolFamily(t){t!=this._family&&(this._family=t,host$.updateSessionPreferences_(smapOf_(SessionPreferencesKey.symbolFamily,t),t=>{toasters$.warn_(t)}))}updateRecentsSymbol(t,e,i){const n=e=>{const n=this._recents[e];return SymbolInfo.family_(n)==t&&SymbolInfo.text_(n)==i};let s=this._recents.length-1;if(s>=0&&n(s))return;for(this._recents.push(SymbolInfo.create_(t,e,i));--s>=0;)if(n(s)){this._recents.splice(s,1);break}const o=this._recents.length-DEF.recentSymbolCount;o>0&&this._recents.splice(0,o),host$.updateSessionPreferences_(smapOf_(SessionPreferencesKey.symbolRecents,this._recents),t=>{toasters$.warn_(t)})}showSpinner(t){}}_SymbolPreferences._singleton=null;class _JsUtil{static toastElement_(t,e=!1,i=DEF.maxToastLen){null!=t&&toasters$.info_(this.elementInfo_(t,i),{attop:e})}static toastNode_(t,e=!1,i=DEF.maxToastLen){null!=t&&toasters$.info_(this.nodeInfo_(t,i),{attop:e})}static elementInfo_(t,e=DEF.maxToastLen){const i=t.nodeName;return An.isBodyElement_(i)?"<"+i+">":(null==e&&(e=DEF.maxToastLen),An.truncate_("<"+i+native$.getNodeInfo_(t)+"...>",e))}static nodeInfo_(t,e=DEF.maxToastLen){return t.nodeType==Node.ELEMENT_NODE?this.elementInfo_(t,e):An.truncate_(t.nodeName,e)}static wrapSelection_(t,e,i,n,s,o){if(null==i)return toasters$.warnKey_(RS.InvalidSelection),null;if(null==s)return toasters$.warnKey_(RS.InvalidSelection),null;let l=i,a=s;if(s.nodeType==Node.TEXT_NODE)a=s.parentElement,o=_JsUtil._adjustTextOffset(s,o),s=s.splitText(o);else{if(s.nodeType!=Node.ELEMENT_NODE)return toasters$.warnKey_(RS.InvalidSelection),null;s=a.childNodes[o]}if(i.nodeType==Node.TEXT_NODE)l=i.parentNode,n=_JsUtil._adjustTextOffset(i,n),i=i.splitText(n);else{if(i.nodeType!=Node.ELEMENT_NODE)return toasters$.warnKey_(RS.InvalidSelection),null;i=l.childNodes[n]}if(l!=a)return toasters$.warnKey_(RS.ActionRequireASelectionThatStartsAndEndsUnderTheSameParent),null;if(null==l||l.nodeType!=Node.ELEMENT_NODE)return toasters$.warnKey_(RS.InvalidSelection),null;if(null!=i&&i.nodeType==Node.ELEMENT_NODE&&An.isBodyElement_(i.nodeName)||null!=s&&s.nodeType==Node.ELEMENT_NODE&&An.isBodyElement_(s.nodeName))return toasters$.warnKey_(RS.InvalidSelection),null;const r=new DomBuilderEx(l).childBefore_(i,t,e).cursor_();for(;null!=i&&i!=s;){const t=i.nextSibling;l.removeChild(i),r.appendChild(i),i=t}return r}static _adjustTextOffset(t,e){return e}static getBgImgFromStyleAttribute_(t,e,i){const n=t.getAttribute("style");null!==n&&0!=n.length?cssParser$.sanitizeStyle_(n,e,t=>{var e;if(toasters$.warn_(t))i(null);else{const n=t[Key.style];i(null!==(e=n["background-image"])&&void 0!==e?e:null)}}):i(null)}static setStyleUrlValue_(t,e,i,n=null){native$.replaceStyle_(t,e,i),null==n||n()}static nodeStyles_(t,e){const i=new Map,n=t.style;for(const t of e)i.set(t,n.getPropertyValue(t));return i}}class Role{static addRole(t,e){var i;t.setAttribute(ATTR.xRole,Array.from(new Set((null!==(i=t.getAttribute(ATTR.xRole))&&void 0!==i?i:"").split(RX.Spaces)).add(e)).join(" "))}static hasRole(t,e){var i;return new Set((null!==(i=t.getAttribute(ATTR.xRole))&&void 0!==i?i:"").split(RX.Spaces)).has(e)}}class CSSUtil{static hasValue_(t){const e=t.toLowerCase();return e.length>0&&"none"!=e&&"auto"!=e&&"inherit"!=e}static alphanum(t){const e=Unicode$.unicodeCat_(t);return e>=Unicode$.Cat.Ll&&e<=Unicode$.Cat.Lu||e==Unicode$.Cat.Nd}static nonascii(t){return t>=160&&t<=1114111&&this.alphanum(t)}static nmstart(t){return t>=97&&t<=122||t>=65&&t<=90||95==t||this.nonascii(t)}static nmchar(t){return this.nmstart(t)||t>=48&&t<=57||45==t}static validateClassesOf(t){if(null==t)return null;const e=t.split(RX.Spaces).filter(t=>t.length>0);for(let t of e)if(!this.validateClass(t))return null;return e}static validateClasses(t){for(let e of t)if(!this.validateClass(e))return!1;return!0}static validateClass(t){return Ut.codepoints_(t).every((t,e)=>void 0!==t&&(0==e?this.nmstart(t):this.nmchar(t)))}static ignoreInherit(t){return null==t||"inherit"==t?"":t}static ignoreInheritNone(t){return null==t||"inherit"==t||"none"==t||"unset"==t||"auto"==t?"":t}static editingToCSSStyle_(t,e,i){var n;if(null==e)return null;let s=new StringBuffer;if(e.length>0)try{let o=e.split(RX.Linebreaks);for(let e of o){if(0==(e=e.trim()).length)continue;let o=e.indexOf(" "),l=e,a="";o>=0&&(l=e.substring(0,o).trim(),a=null!==(n=CSSUtil.unhumanCSSValue_(t,e.substring(o+1).trim(),i))&&void 0!==n?n:""),s.write_(l),s.write_(":"),s.write_(a),s.write_("; ")}}catch(i){return t.push(MSG.string1_(RS.InvalidValue_,e)),null}return t.length>0?null:s.toString()}static editingToCSSRule_(t,e,i){let n=CSSUtil.splitCSSRule_(e);if(null==n)return t.push(MSG.string1_(RS.InvalidCSSRule_,e)),null;let s=CSSUtil.editingToCSSStyle_(t,n[1],i);return null==s||t.length>0?null:`${n[0]} { ${s} }`}static joinStyles_(t){return this.joinStyles1_(Array.from(t.entries()))}static joinStyles1_(t){let e=new StringBuffer;for(let[i,n]of t){let t=An._stylevalue(n);null!=t&&(e.write_(i),e.write_(": "),e.write_(t),e.write_("; "))}return e.toString()}static joinStylesPreservingEmptyValues_(t){let e=new StringBuffer;for(let[i,n]of[...t]){let t=An._stylevalue(n);null==t&&(t=""),e.write_(i),e.write_(": "),e.write_(t),e.write_("; ")}return e.toString()}static joinStylesRemovingEmptyValues_(t){let e=new StringBuffer;for(let[i,n]of[...t]){let t=An._stylevalue(n);null!=t&&0!=t.trim().length&&(e.write_(i),e.write_(": "),e.write_(t),e.write_("; "))}return e.toString()}static joinStyleList_(t){let e=new StringBuffer;for(let i of t){let t=An._stylevalue(i[1]);if(null==t)continue;let n=i[0];e.write_(n),e.write_(": "),e.write_(t),e.write_("; ")}return e.toString()}static joinlnStyleList_(t,e="  "){let i=new StringBuffer;for(let[n,s]of t){let t=An._stylevalue(s);null!=t&&0!=t.length&&(i.write_(e),i.write_(n),i.write_(": "),i.write_(t),i.write_(";\n"))}return i.toString()}static validateOptionalCSSLength_(t){if(0==t.length)return!0;for(let e of CSSLengths){if(!t.endsWith(e))continue;let i=t.substring(0,t.length-e.length);return null!=An.parseDouble_(i,null)}return!1}static cssLengthUnit_(t){if(0==t.length||"auto"==t)return null;for(let e of CSSLengths){if(!t.endsWith(e))continue;let i=t.substring(0,t.length-e.length),n=An.parseDouble_(i,null);return null==n?null:[n,e]}return null}static splitCSSRule_(t){if(null==t)return null;let e=t.indexOf("{"),i=t.lastIndexOf("}");return e<0||i<0?null:[t.substring(0,e).trim(),t.substring(e+1,i).trim()]}static splitStyle(t,e){const i=e.split(RX.SemicolonSpace);for(const e of i){const i=RX.CSSValue.exec(e);null!=i&&(t[i[1]]=i[2])}return t}static escCSSValue_(t,e){if("content"!=t)return e;let i=e.length,n=!1;if(i>2){let t=e.codePointAt(0);n=(34==t||39==t)&&t==e.codePointAt(i-1)}let s=null,o=0;for(let t=0;t<i;++t){let i=e.codePointAt(t);void 0!==i&&((i<32||i>=127&&!An.isHuman_(i)||!n&&34==i)&&(null==s&&(s=new StringBuffer,n||s.write_('"')),o<t&&s.write_(e.substring(o,t)),s.write_("\\"+i.toString(16).padStart(6,"0")),o=t+1))}return null==s?e:(o<i&&s.write_(e.substring(o,i)),n||s.write_('"'),s.toString())}static firstCSSUrlHostPort_(t){if(!CSSUtil.hasCSSUrl_(t))return null;let e=RX._CSSUrlHostPortQQ.exec(t);return null==e&&null==(e=RX._CSSUrlHostPortQ.exec(t))&&(e=RX._CSSUrlHostPort.exec(t)),e}static firstCSSUrl_(t){if(!CSSUtil.hasCSSUrl_(t))return null;let e=RX._CSSUrlQQ.exec(t);return null==e&&null==(e=RX._CSSUrlQ.exec(t))&&(e=RX._CSSUrl.exec(t)),e}static normalizeCSSValue_(t){return An.isempty_(t)?t:t.replace(RX._QQ_G,'"').replace(RX._Q_G,"'")}static hasCSSUrl_(t){return!An.isempty_(t)&&t.includes("url(")}static cleanupCSSUrlHostPort_(t,e){return CSSUtil.hasCSSUrl_(t)?(t=this._cleanupCSSUrlHostPort(t,RX._CSSUrlHostPortQQ,e),t=this._cleanupCSSUrlHostPort(t,RX._CSSUrlHostPortQ,e),this._cleanupCSSUrlHostPort(t,RX._CSSUrlHostPort,e)):t}static _cleanupCSSUrlHostPort(t,e,i){if(!CSSUtil.hasCSSUrl_(t))return t;let n=e.exec(t);if(null!=n){let s=n[1],o=n.index,l=o+n[0].length;if(null!=An.parseUriSafe_(s,i)){let s=t.substring(0,o),a=this._cleanupCSSUrlHostPort(t.substring(l),e,i);return`${s}${n[1]}${n[3]}${a}`}}return t}static humanCSSUrls_(t,e){return CSSUtil.hasCSSUrl_(t)?(t=this._humanCSSUrls(t,RX._CSSUrlQQ,e),t=this._humanCSSUrls(t,RX._CSSUrlQ,e),this._humanCSSUrls(t,RX._CSSUrl,e)):t}static _humanCSSUrls(t,e,i){if(!CSSUtil.hasCSSUrl_(t))return t;let n=e.exec(t);if(null!=n){let s=n[1],o=n.length>=3?n[2]:"",l=n.index,a=l+n[0].length,r=An.parseUriSafe_(s,i);if(null!=r){let n=t.substring(0,l),s=this._humanCSSUrls(t.substring(a),e,i);return`${n}url(${o}${HumanLink.fromUri_(r).humanHref$}${o})${s}`}}return t}static toCSSUrl_(t){return An.isempty_(t)?t:"url("+replaceAll_(replaceAll_(t,")","%29"),"(","%28")+")"}static humanCSSUrl_(t){if(An.isempty_(t))return HumanLink.Empty$;let e=CSSUtil.firstCSSUrl_(t);return null!=e&&(t=e[1]),HumanLink.fromHref_(t)}static unhumanCSSValue_(t,e,i){return null==e?null:CSSUtil._unhumanCSSUrls(t,CSSUtil.normalizeCSSValue_(e),i)}static _unhumanCSSUrls(t,e,i){var n,s,o;if(!CSSUtil.hasCSSUrl_(e))return e;let l=null!==(n=this._unhumanCSSUrls1(t,e,RX._CSSUrlQQ,i))&&void 0!==n?n:e;return l=null!==(s=this._unhumanCSSUrls1(t,l,RX._CSSUrlQ,i))&&void 0!==s?s:e,null!==(o=this._unhumanCSSUrls1(t,l,RX._CSSUrl,i))&&void 0!==o?o:e}static _unhumanCSSUrls1(t,e,i,n){if(!CSSUtil.hasCSSUrl_(e))return e;let s=i.exec(e);if(null!=s){let o=s[1],l=s.length>=3?s[2]:"",a=s.index,r=a+s[0].length,_=An.parseUriSafe_(o,n);if(null==_)return t.push(MSG.string1_(RS.InvalidURL_,o)),null;let c=sarray_();if(Sanitizers.sanitizeFilepath_(_.pathSegments$,t=>c.push(t)),c.length>0)return c.forEach(e=>{t.push(e)}),null;let h=e.substring(0,a),u=this._unhumanCSSUrls1(t,e.substring(r),i,n);return null==u?null:`${h}url(${l}${_.toString()}${l})${u}`}return e}static splitBgImg_(t){const e=t.trim();if(0==e.length)return["","",""];const i=cssParser$.parseExpr_(e).children;if(!i)return["","",""];let n=[];for(let t=0;t<3;++t){if(t>=i.length){n.push("");continue}const s=i[t];n.push(e.substring(s.offset,2==t?e.length:s.offset+s.length))}return n}static _splitfilter1(t,e){const i=RX.Funcall.exec(e),[n,s]=null!=i?[i[1],i[2]]:[e,"()"];t[n]=BackdropFilter.FILTERS$.includes(n)?s:""}static splitFilter_(t){const e=t.trim();let i=ssmap_();if(e.length>0){const t=cssParser$.parseExpr_(e).children;if(t)for(const n of t){const t=e.substr(n.offset,n.length);this._splitfilter1(i,t)}else this._splitfilter1(i,e)}return i}static updateFilter_(t,e,i,n){if(e==MSG.string_(RS.None))return"";const s=CSSUtil.splitFilter_(t);return 0==i.length||n&&Object.keys(s).includes(e)?delete s[e]:s[e]=i,Object.entries(s).map(([t,e])=>t+e).join(" ")}static lastFilter_(t){return ArrayUt.last_(Object.entries(CSSUtil.splitFilter_(t)))}}class Callbacks{static onViewImageUrl_(t,e,i,n){const s=new ImageViewer(accessories$,cache$.ui$.buttonSize_(),e);return s.above_(t,10),s.titleKey_(RS.ImageViewerTitle),s.message_(An.ifnull_(i,"")),s.onCancel_(()=>{n(!1)}),s.onOK_(()=>{n(!0)}),s}}Callbacks.filepickerDragstartHandler_=(t,e)=>{const i=DomUt.asHTMLElement_(e);return null!=i&&"TABLE"==i.nodeName&&i.classList.contains(CSS.AnFilepicker)},Callbacks.copyToClipboard_=t=>{clipboard$.string_(t)},Callbacks.pasteFromClipboard_=t=>{const e=clipboard$.get_();if(null==e)t(An.jsonError_(RS.ClipboardIsEmptyOrInvalid));else{const i=native$.getClipboardText_(e);t(smapOf_(Key.result,i))}},Callbacks.copyToSystemClipboard_=(t,e,i)=>{host$.copyToClipboard_(e,n=>{toasters$.warn_(n)||(null!=t&&toasters$.info_([MSG.string_(t),An.truncate_(e,DEF.maxLongToastLen)],{attop:!1}),i())})},Callbacks.onLinkFolderButton_=(t,e,i,n)=>{Callbacks.onFolderButton_(RS.Link,FilepickerLinkDelegate.singleton$,FilepickerKind.ANY_FILE,t,e,i,n)},Callbacks.onReadImageFolderButton_=(t,e,i,n)=>{Callbacks.onImageFolderButton_(FilepickerKind.EXISTING_FILE,t,e,i,n)},Callbacks.onAnyImageFolderButton_=(t,e,i,n)=>{Callbacks.onImageFolderButton_(FilepickerKind.ANY_FILE,t,e,i,n)},Callbacks.onWriteImageFolderButton_=(t,e,i,n)=>{Callbacks.onImageFolderButton_(FilepickerKind.WRITE_FILE,t,e,i,n)},Callbacks.onImageFolderButton_=(t,e,i,n,s)=>{Callbacks.onFolderButton_(RS.Image,FilepickerImageDelegate.singleton$,t,e,i,n,s)},Callbacks.onReadFilepathFolderButton_=(t,e,i,n)=>{Callbacks.onFilepathFolderButton_(FilepickerKind.EXISTING_FILE,t,e,i,n)},Callbacks.onWriteFilepathFolderButton_=(t,e,i,n)=>{Callbacks.onFilepathFolderButton_(FilepickerKind.WRITE_FILE,t,e,i,n)},Callbacks.onFilepathFolderButton_=(t,e,i,n,s)=>{Callbacks.onFolderButton_(RS.Filepath,FilepickerLinkDelegate.singleton$,t,e,i,n,s)},Callbacks.onAudioRecordFolderButton_=(t,e,i,n)=>{Callbacks.onFolderButton_(RS.Audio,FilepickerAudioRecordDelegate.singleton$,FilepickerKind.WRITE_FILE,t,e,i,n)},Callbacks.onVideoRecordingFolderButton_=(t,e,i,n)=>{Callbacks.onFolderButton_(RS.VideoRecordingTitle,FilepickerVideoRecordingDelegate.singleton$,FilepickerKind.WRITE_FILE,t,e,i,n)},Callbacks.onFolderButton_=(t,e,i,n,s,o,l)=>{const a=An.cpathOfFilepath2_(s,n);_Util.promptFilepath_(MSG.string_(t),i,"",s,a).zindex_(o).setDelegate_(e).onOK_((t,e)=>{t(!0),l(e)}).show_()},Callbacks.onBasenameFolderButton_=(t,e,i,n)=>{const s=Basepath.suffix_(t),o=s.toLowerCase(),l=s.toUpperCase(),a=[s];o!=s&&a.push(o),l!=s&&a.push(l),_Util.promptFilepath_(MSG.string_(RS.Filename),FilepickerKind.ANY,e,null,t).zindex_(i).setDelegate_(new FilepickerSuffixDelegate(a)).disableContextmenu_().onOK_((t,e)=>{t(!0),n(e)}).show_()},Callbacks.onFilenameButton_=(t,e,i,n)=>{const s=e+"/"+t;_Util.promptFilepath_(MSG.string_(RS.Filename),FilepickerKind.ANY,e,null,s).zindex_(i).setDelegate_(FilepickerLinkDelegate.singleton$).onOK_((t,e)=>{t(!0),n(e)}).show_()},Callbacks.onHtmlFolderButton_=(t,e,i,n,s)=>{Callbacks.onFolderButton_(RS.Filepath,FilepickerHtmlDelegate.singleton$,t,e,i,n,s)},Callbacks.onPngImageFolderButton_=(t,e,i,n,s)=>{Callbacks.onFolderButton_(RS.Image,FilepickerPngImageDelegate.singleton$,t,e,i,n,s)},Callbacks.onAudioPlaybackFolderButton_=(t,e,i,n)=>{Callbacks.onFolderButton_(RS.Audio,FilepickerAudioPlaybackDelegate.singleton$,FilepickerKind.EXISTING_FILE,t,e,i,n)},Callbacks.onVideoPlaybackFolderButton_=(t,e,i,n)=>{Callbacks.onFolderButton_(RS.Video,FilepickerVideoPlaybackDelegate.singleton$,FilepickerKind.EXISTING_FILE,t,e,i,n)},Callbacks.onVideoTrackFolderButton_=(t,e,i,n)=>{Callbacks.onFolderButton_(RS.Video,FilepickerVideoTrackDelegate.singleton$,FilepickerKind.EXISTING_FILE,t,e,i,n)},Callbacks.getUriOfKind_=(t,e)=>t?e.toAbsolute_():e.toRelative_(),Callbacks.getFilepathOfKind_=(t,e,i)=>{var n;const s=null!==(n=An.cpathOfFilepath2_(i,e))&&void 0!==n?n:e;return t?s:e.startsWith("/")?null==i?e:An.rpath2_(i,s):e},Callbacks.onImportImageFromPhotoLibraryButton_=(t,e)=>{new Imagepicker(accessories$,RS.ImportImageTitle,gestureHandler$,new PhotoLibraryImageInfoHandler).zindex_(t).onView_((t,e,i)=>{e.isVideo_()?toasters$.warnKey_(RS.PleaseSpecifyASourceImage):host$.viewPhotoLibraryThumbnail_(DEF.previewPhotoSize,e,n=>{if(toasters$.warn_(n))return;const s=n[Key.result];new ImageViewer(accessories$,cache$.ui$.buttonSize_(),s).above_(t,10).titleKey_(RS.ImageViewerTitle).onImageInfo_(()=>{toasters$.modal_((t,i)=>new ImageInfoBuilder(t,i,settings$.dateFormat_(),e).build_())}).onCancel_(()=>{i(!1)}).onOK_(()=>{i(!0)}).show_()})}).onOK_(i=>{const n=_Util.getCurrentDir_();_Util.importImageFromPhotoLibrary_(n,"",i,t,()=>{},(t,i)=>{toasters$.warn_(i)||(toasters$.okKey_(RS.ImportImageOK,{attop:!0}),e(t))})}).show_()},Callbacks.showImageInfo_=t=>{host$.localImageInfo_(t,t=>{if(toasters$.warn_(t))return;const e=MediaInfo.of_(t[Key.result]);toasters$.modal_((t,i)=>new ImageInfoBuilder(t,i,settings$.dateFormat_(),e).build_())})},Callbacks.onThumbnailButton_=(t,e,i,n)=>{if(An.isempty_(t))return void i.warn_(MSG.string_(RS.PleaseSpecifyASourceImage));const s=An.cpathOfFilepath2_(e,t);null!=s?host$.localImageInfo_(s,t=>{if(i.warn_(t))return;const o=MediaInfo.of_(t[Key.result]),l=o.width_(),a=o.height_(),r=MediaUtil.fit_(l,a,DEF.thumbnailSize,DEF.thumbnailSize),_=new Basepath(s),c=_.sibling_(`${_.nameWithoutSuffix$}-tn${r.x}x${r.y}.jpg`),h=An.above_(i.element_());host$.localImageThumbnail_(s,DEF.previewPhotoSize,DEF.jpegQuality,t=>{if(toasters$.warn_(t))return;const o=t[Key.result];_Util.promptOutputImage_(c.path$,An.cdirOfUri_(e),r.x,r.y,DEF.jpegQualityThumbnail,h,DEF.thumbnailSize,o,t=>{host$.writeImage_(s,t,e=>{i.warn_(e)||n(t.cpath)})}).show_()})}):i.warn_(MSG.string_(RS.invalidFilepath_)+t)},Callbacks.onViewLocalImage_=(t,e,i)=>{const n=e.uri_(),s=e.description_(),o=null==n?null:An.uriOfFilepath2_(null,An.ensureLeadingSlash_(n));null!=o&&null!=n?Callbacks.onViewImageUrl_(t,o.toString(),s,i).onImageInfo_(()=>Callbacks.showImageInfo_(n)).show_():toasters$.warn_([MSG.string_(RS.InvalidFilepath),n])},Callbacks.onPreviewImage_=(t,e,i,n,s,o,l=ColorValue.X_WHITE)=>{const a=new ImageViewer(accessories$,cache$.ui$.buttonSize_(),e,i,n,s,o,l);return a.titleKey_(RS.ImageViewerTitle),null!=t?a.above_(t,10):a.zindex_(DEF.zindexPrompt),a},Callbacks.promptColor_=(t,e,i,n)=>PromptColor.getSingleton(accessories$,t).setColor(i,n).zindex_(e),Callbacks.promptEditText_=(t,e,i,n)=>{_SymbolPreferences.get_(s=>{const o=new PromptEditText(accessories$,cache$.ui$.buttonSize_(),e,settings$.dateFormat_(),settings$.timeFormat_(),s,i);o.titleKey_(RS.EditText),o.value_(t),n(o)})};class _Util{static createContentScroller_(t,e){return An.onTouchStart_(t,t=>{An.stopevent_(t),e()}),An.onTouchEnd_(t,An.sinkhole_),An.onClick_(t,An.sinkhole_),null}static hideContextmenus_(){mainPanel$.hideMainContextmenu()}static findActionButtons_(t,e){for(const i of JsUtil.querySelectorAll_(e,`[${ATTR.AnAction}]`)){const e=i.getAttribute(ATTR.AnAction);null!=e&&e.length>0&&t.set(e,i)}}static toggleIgnorecase_(t){An.toggleOnOffButton_(t),_Util.toastOnOffButton_(MSG.string_(RS.Tooltips_IgnoreCase),An.isButtonOn_(t))}static toastOnOffButton_(t,e){toasters$.info_(t+": "+(1==e?MSG.string_(RS.On):MSG.string_(RS.Off)),{attop:!1})}static browse1_(t){var e;const i=null==t||t.isRelative$?null:An.addViewParam_(t,null);_Util.browse_(i,null!==(e=null==t?void 0:t.toString())&&void 0!==e?e:"null")}static browse_(t,e){null!=t?native$.browse_(t):toasters$.warn_(MSG.string1_(RS.InvalidURL_,e))}static browseFile_(t,e=null,i=!1,n=!1,s=null,o=!1){if(0==(t=Basepath.cleanFilepath_(t)).length||0==t.lastIndexOf("/"))return void toasters$.warn_(`${MSG.string_(RS.invalidFilepath_)}: ${t}`);const l=(t=t.startsWith("/")?t:"/"+t).split("/"),a=Basepath.lcExt_(t);let r;if(DEF.html==a){const t=new Map;i&&t.set(Param.edit,""),null!=s&&(t.set(Param.ignorecase,`${n}`),t.set(Param.searchtext,s),t.set(Param.isregex,`${o}`)),null!=e&&t.set(Param.session,JSON.stringify(e)),r=An.uriFromSafe_(null,l,t)}else if(a==DEF.pdf)r=An.parseUriSafe_(t,null);else{if(!MimeUtil.isMediaLcExt(a))return void toasters$.warn_(`${MSG.string_(RS.UnsupportedFileType_)}: ${a}`);{const t=mapOf_(Param.view,"");null!=e&&t.set(Param.session,JSON.stringify(e)),r=An.uriFromSafe_(null,l,t)}}_Util.browse_(r,t)}static confirmSmall_(t,e,i){DialogUt.confirmSmall_(accessories$,t,e,i)}static confirmKeySmall_(t,e,i){DialogUt.confirmKeySmall_(accessories$,t,e,i)}static onSaveOrDiscard_(t){_state.isEditing()?_Util.promptSave_(t).show_():t()}static promptSave_(t){const e=new PromptSave(accessories$,RS.Confirm,MSG.string_(RS.ConfirmSaveOrDiscard));return e.onSave_(()=>{mainPanel$.saveEdit(()=>{toasters$.infoKey_(RS.DocumentSaved,{attop:!0}),t()})}),e.onDiscard_(()=>{mainPanel$.stopEdit(!0,()=>{toasters$.infoKey_(RS.DocumentChangesDiscarded,{attop:!0}),t()})}),e}static promptWarning_(t,e){return new PromptWarning(accessories$,t,e)}static getRotation_(t,e){var i,n;return null!==(n=null===(i=An.parseIntUnit_(t))||void 0===i?void 0:i[0])&&void 0!==n?n:e}static promptInputImage_(t,e,i,n,s,o){return new PromptInputImage(accessories$,e,i,n,"0 deg").titleKey_(t).zindex_(s).onOK_((t,i,n,s,l,a)=>{Sanitizers.checkRequiredInputImage_(i,e,e=>{e.ifOK_(t=>{const e=An.uriFromSafe_(null,i);return null==e?BotResult.failArrayKey_(RS.InvalidFilepath):(a(!0),o(t,e.toString(),n,s,l),BotResult.ok_(!0))}).onFail_(e=>{a(!1),t.warn_(e)})})})}static setQualityVisibility_(t,e){const i=Basepath.lcExt_(e);t.setVisible_(_Util._XQUALITY,MimeUtil.isLossyImageLcExt(i))}static onEffectChanged_(t,e,i){const n=EffectUtil.get_(t.getValue_(_Util._XEFFECT));if(n!=e){switch(n){case Effect.GRAY2:case Effect.GRAY4:case Effect.GRAY8:case Effect.GRAY16:case Effect.GRAY256:t.setVisible_(_Util._XADJUST,!0),t.setValue_(_Util._XADJUST,`${EffectUtil.getDefaultAdjust_(n)}`);let e=t.getValue_(_Util._XFILEPATH);if("png"!=Basepath.lcExt_(e)){e=new Basepath(e).changeSuffix_(".png").path$,t.setValue_(_Util._XFILEPATH,e),t.setVisible_(_Util._XQUALITY,!1)}break;default:t.setVisible_(_Util._XADJUST,!1)}_Util.updateThumbnail_(t,i)}return n}static updateThumbnail_(t,e){if(null==e||0==e.length)return;const i=EffectUtil.get_(t.getValue_(_Util._XEFFECT)),n=_Util.getRotation_(t.getValue_(_Util._XROTATION),0),s=An.parseInt_(t.getValue_(_Util._XQUALITY),DEF.jpegQuality),o=sarray_(),l=EffectUtil.getAdjust(i,t.getValue_(_Util._XADJUST));t.warn_(o)||host$.previewImage_(e,n,i,l,s,e=>{toasters$.warn_(e)||t.postUpdate(()=>{t.setValue_(_Util._XPREVIEW,e[Key.result])})})}static styleEditor_(t,e,i,n,s,o,l){return new StyleEditor(t,i,e).zindex_(s).onOK_((t,e)=>{if(0==t.trim().length)return e(!0),void l(ssmap_());cssParser$.sanitizeStyle_(t,n,t=>{o.warn_(t)?e(!1):(e(!0),l(t[Key.style]))})})}static promptCanvasDimension_(t,e,i,n){const s=cache$.ui$.buttonSize_(),o=native$.getIFrameUri_();return new CompositeDialog(accessories$,[new Input2FIeld("","#XwN",",",s,RS.Width,"#XRU",`${e}`,"x",RS.Height,"#XHa",`${i}`,CSSLength.PX),new Input2FIeld("","#XhH",",",s,RS.TnWidth,"#Xju","","x",RS.TnHeight,"#XRh","",CSSLength.PX),new ColorField("","#Xff","",s,RS.BGColor)]).titleKey_(RS.PromptCanvasTitle).message_(t).zindex_(DEF.zindexPrompt).onOK_((t,s)=>{const l=sarray_(),a=An.onValidateOptionalPositiveInt_(l,MSG.string_(RS.Width),t.getValue_("#XwN",0)),r=An.onValidateOptionalPositiveInt_(l,MSG.string_(RS.Height),t.getValue_("#XwN",1)),_=An.onValidateOptionalPositiveInt_(l,MSG.string_(RS.TnWidth),t.getValue_("#XhH",0)),c=An.onValidateOptionalPositiveInt_(l,MSG.string_(RS.TnHeight),t.getValue_("#XhH",1)),h=MediaUtil.optionalDimension1_(a,r,e,i);h.x*h.y>DEF.maxOutputImageArea&&l.push(MSG.string1_(RS.OriginalSize,`: ${h.x}x${h.y}`)),null!=_&&null!=c&&_*c>DEF.maxOutputImageArea&&l.push(MSG.string1_(RS.OriginalSize,`: ${_}x${c}`));const u=t=>{let e=null;t.length>0&&(e=ColorUtil.getColorValue_(t)),n(h.x,h.y,_,c,null!=e?e:ColorValue.X_WHITE)},d=t.getValue_("#Xff").trim();if(0==d.length)return s(!0),void u("");cssParser$.sanitizeStyle_(`background-color: ${d}`,o,t=>{var e;if(ArrayUt.addAll_(l,...An.messagesList_(t[Key.errors])),l.length>0)return toasters$.warn_(l),void s(!1);s(!0);const i=null!==(e=t[Key.style]["background-color"])&&void 0!==e?e:"";u(i)})})}static promptOutputImageBase_(t,e,i,n,s,o,l,a){const r=i>0&&n>0;let _=["","'"];if(r){const t=MediaUtil.limitImageDimensionAndArea_(i,n,l);_=[`${t.x}`,`${t.y}`]}const c=cache$.ui$.buttonSize_(),h=new Array(new FilepathFolderField("",_Util._XFILEPATH,new HumanFilepath(t),RS.PlaceholderRequiredFilepath,e,r?Callbacks.onWriteImageFolderButton_:(t,e,i,n)=>{Callbacks.onImageFolderButton_(FilepickerKind.ANY_FILE,t,e,i,n)}),new CheckboxField("",_Util._XCROP,"false",MSG.string_(RS.Crop)),new Input2FIeld("",_Util._XWXH,",",c,RS.Width,"",_[0],"x",RS.Height,"",_[1],CSSLength.PX),new InputField("",_Util._XDIM,`${l}`,RS.Dimension),new SelectFIeld("",_Util._XROTATION,"0 deg",RS.Rotation,["0 deg","90 deg","180 deg","270 deg"]),new SelectFIeld("",_Util._XEFFECT,EffectUtil.Names[Effect.NONE],RS.Effects,EffectUtil.Names),new SliderField("",_Util._XADJUST,EffectUtil.getDefaultAdjust_(Effect.NONE),RS.Adjust,0,100,.5,10,`${cache$.ui$.buttonSize_()}px`),new InputField("",_Util._XQUALITY,`${s}`,RS.QualityPercent));null!=a&&h.push(new DataUrlField("",_Util._XPREVIEW,a,"160px","160px"));const u=new CompositeDialog(accessories$,h).titleKey_(RS.PromptDimensionTitle).onPreview((t,e)=>{const i=_Util.getRotation_(u.getValue_(_Util._XROTATION),0),n=EffectUtil.get_(u.getValue_(_Util._XEFFECT)),s=EffectUtil.getAdjust(n,u.getValue_(_Util._XADJUST)),o=An.parseInt_(u.getValue_(_Util._XQUALITY),DEF.jpegQualityHigh);return Callbacks.onPreviewImage_(t,e,i,n,s,o)}).zindex_(o).setVisible_(_Util._XDIM,!r).setVisible_(_Util._XWXH,r).setVisible_(_Util._XCROP,!1).setVisible_(_Util._XADJUST,!1).setVisible_(_Util._XFILEPATH,null!=t);return _Util.setQualityVisibility_(u,t),u}static promptOutputImage1_(t,e,i,n,s,o,l,a,r){_Util.getImageDefaultOutputSize_(_=>{const c=_Util.promptOutputImage_(t,e,i,n,s,o,_,l,t=>{_Util.updateImageDefaultOutputSize_(_,i,n,t,()=>{a(t)})});r(c)})}static promptOutputImage_(t,e,i,n,s,o,l,a,r){let _=Effect.NONE;const c=i>0&&n>0,h=_Util.promptOutputImageBase_(t,e,i,n,s,o,l,a);return c&&h.message_(`${MSG.string_(RS.OriginalSize)}: ${i}x${n}`),h.onChange_(t=>{const e=t.spec$.key$;_Util._XFILEPATH==e?_Util.setQualityVisibility_(h,h.getValue_(_Util._XFILEPATH)):_Util._XEFFECT==e?_=_Util.onEffectChanged_(h,_,a):_Util._XROTATION!=e&&_Util._XADJUST!=e||_Util.updateThumbnail_(h,a)}),h.onOK_((t,s)=>{const l=sarray_(),a=t.getValue_(_Util._XFILEPATH),_=An.cpathOfFilepath2_(e,a);if(null==_)return t.warn_([MSG.string_(RS.InvalidFilepath),a]),void s(!1);const h=EffectUtil.get_(t.getValue_(_Util._XEFFECT)),u=EffectUtil.getAdjust(h,t.getValue_(_Util._XADJUST)),d=_Util._onValidatePercent(l,MSG.string_(RS.QualityPercent),t.getValue_(_Util._XQUALITY),DEF.jpegQualityHigh),S=_Util.getRotation_(t.getValue_(_Util._XROTATION),0);let p=null;if(c){const e=t.getValue_(_Util._XWXH,0),s=t.getValue_(_Util._XWXH,1);An.onValidateOptionalInt_(l,MSG.string_(RS.Width),e),An.onValidateOptionalInt_(l,MSG.string_(RS.Height),s),p=MediaUtil.optionalDimension_(e,s,i,n)}else{const e=An.onValidateOptionalInt_(l,MSG.string_(RS.Dimension),t.getValue_(_Util._XDIM,0));p=null==e?null:new Point(e,e)}if(null==p)return t.warnKey_(RS.InvalidDimensionAbort),void s(!1);const m=p;c?_Util._onValidateOutputImage(l,a,e,o,e=>{t.warn_(e)?s(!1):(s(!0),_Util._promptOutputImageOK(m,a,_,S,d,h,u,r))}):_Util._onValidateOutputImageWithoutCheckingOverwriting(l,a,e).onFail_(()=>{t.warn_(smapOf_(Key.errors,l)),s(!1)}).onOK_(t=>(s(!0),_Util._promptOutputImageOK(m,a,t,S,d,h,u,r),null))}),h}static _promptOutputImageOK(t,e,i,n,s,o,l,a){t=MediaUtil.limitImageArea_(t.x,t.y),a(new ImageOutputInfo(e,i,t.x,t.y,n,o,l,s))}static promptRect_(t,e,i,n){host$.localImageThumbnail_(t,DEF.previewPhotoSize,DEF.jpegQuality,t=>{if(toasters$.warn_(t))return;const e=MediaInfo.of_(t[Key.imageinfo]),s=e.width_(),o=e.height_(),l=t[Key.result];_Util._promptRect1(i,s,o,l,n)})}static _promptRect1(t,e,i,n,s){new ShapePicker$.PromptRect(accessories$,gestureHandler$,cache$.ui$.buttonSize_(),t,0,new Point(e,i),[0,0,1,1],n).onOK_((t,n,o,l)=>{s(Math.round(t*e),Math.round(n*i),Math.round(o*e),Math.round(l*i))}).onConfirmCancel_(null).show_()}static prompQuad_(){new ShapePicker$.PromptQuad(accessories$,gestureHandler$,cache$.ui$.buttonSize_(),DEF.zindexPrompt,1,new Point(320,240),[],"data:fixme")}static promptOutputPerspective_(t,e,i,n,s,o,l){const a=new CompositeDialog(accessories$,[new FilepathFolderField("",_Util._XFILEPATH,new HumanFilepath(t),RS.PlaceholderRequiredFilepath,e,Callbacks.onWriteImageFolderButton_),new InputField("",_Util._XQUALITY,`${s}`,RS.QualityPercent)]);return a.titleKey_(RS.PromptDimensionTitle),a.message_([`${MSG.string_(RS.FixPerspectiveUncroppedSize)}: ${i}x${n}`]),a.zindex_(o),a.setVisible_(_Util._XQUALITY,MimeUtil.isLossyImageLcExt(Basepath.lcExt_(t))),a.setVisible_(_Util._XFILEPATH,null!=t),a.onChange_(t=>{const e=t.spec$.key$;_Util._XFILEPATH==e&&_Util.setQualityVisibility_(a,a.getValue_(_Util._XFILEPATH))}),a.onOK_((i,n)=>{const s=i.getValueAt_(0),a=An.cpathOfFilepath2_(e,s);if(null==a)return i.warn_([MSG.string_(RS.InvalidFilepath),s]),void n(!1);const r=sarray_(),_=_Util._onValidatePercent(r,MSG.string_(RS.QualityPercent),i.getValueAt_(1),DEF.jpegQualityHigh);if(null!=t)_Util._onValidateOutputImage(r,s,e,o,t=>{i.warn_(t)?n(!1):(n(!0),l(s,a,_))});else{if(r.length>0)return i.warn_(smapOf_(Key.errors,r)),void n(!1);n(!0),l(s,a,_)}}),a}static _onValidateOutputImageWithoutCheckingOverwriting(t,e,i){if(An.isempty_(e))t.push(MSG.string_(RS.InvalidPath));else{const n=An.cpathOfFilepath2_(i,e),s=Basepath.lcExt_(n);if(MimeUtil.canWriteImageLcExt(s))return BotResult.ok_(n);t.push(MSG.string1_(RS.UnsupportedFileType_,null!=s?s:""))}return BotResult.fail_(t)}static _onValidateOutputImage(t,e,i,n,s){_Util._onValidateOutputImageWithoutCheckingOverwriting(t,e,i).onFail_(()=>{s(smapOf_(Key.errors,t))}).onOK_(t=>(_Util.checkFileWritableAndConfirmOverwrite_(t,n+10,s),null))}static checkFileWritableAndConfirmOverwrite_(t,e,i){fileinfoUt$.checkFileWritable_(t,e=>{if(An.hasMessage_(e))return void i(e);const n=FileInfo.of_(e[Key.fileinfo]);null!=n?n.exists$?DialogUt.confirmOverwriting_(Basepath.nameWithSuffix_(t),t=>{i(t?smapOf_(Key.result,{}):An.jsonError_(RS.NotOverwritingDestination))}):i(smapOf_(Key.result,{})):toasters$.warnKey_(RS.InvalidFilepath)})}static getImageDefaultOutputSize_(t){host$.getSessionPreferences_(e=>{let i=settings$.current_().imageDimension$;if(!toasters$.warn_(e)){const t=e[Key.result][SessionPreferencesKey.imageDefaultOutputSize];null!=t&&(i=An.clamp_(256,5120,t))}t(i)})}static updateImageDefaultOutputSize_(t,e,i,n,s){if(n.width!=e||n.height!=i){const e=An.clamp_(256,5120,Math.max(n.width,n.height));if(e!=t)return void host$.updateSessionPreferences_(smapOf_(SessionPreferencesKey.imageDefaultOutputSize,e),t=>{toasters$.warn_(t),s()})}s()}static _onValidatePercent(t,e,i,n){const s=An.parseInt_(i,-1);return s<0||s>100?(t.push(MSG.format3_(RS.nameValueOutOfRange,e,i,"[0, 100]")),n):s}static promptInsertImg_(t,e,i,n,s){const o=new PromptInsertImg(accessories$,"",e,i,n);return o.titleKey_(t).zindex_(DEF.zindexPrompt).onThumbnailButton_(Callbacks.onThumbnailButton_).onCancel_(()=>{s(null)}).onOK_((t,e,n,l,a,r)=>{Sanitizers.checkRequiredImageOptionalLink_(e,a,i).onFail_(t=>{o.warn_(t),r(!1)}).onOK_(([e,o])=>{Sanitizers.checkAttrs_(l,i,i=>{if(t.warn_(i))return void r(!1);r(!0),toasters$.warn_(i[Key.warns]);const l=i[Key.attrs];s({src:e,caption:n,attrs:l,link:o})})})})}static promptImageUrl2_(t,e,i,n,s,o,l){return new PromptImageUrl2(accessories$,i,n,s,o,l).titleKey_(t).zindex_(e).onThumbnailButton(Callbacks.onThumbnailButton_)}static promptBasename_(t,e,i,n,s){const o=new Basepath(n);return new CompositeDialog(accessories$,[new BasenameFIeld("","",o.nameWithSuffix$,RS.Filename,i,Callbacks.onBasenameFolderButton_)],DEF.BASIS_25).titleKey_(t).message_(e).zindex_(DEF.zindexPrompt).onOK_((t,e)=>{const i=t.getValueAt_(0).trim();s(t,i,e)})}static promptCssOutputUrl_(t,e,i,n,s,o){const l=new PromptLink(accessories$,i,s,o,(t,e,i,s)=>{Callbacks.onFolderButton_(RS.CSS,FilepickerCssDelegate.singleton$,n,t,e,i,s)}).titleKey_(t).zindex_(DEF.zindexPrompt);return null!=e&&l.message_(e),l}static promptLink_(t,e,i,n,s){const o=new PromptLink(accessories$,i,n,s,(e,i,n,s)=>{Callbacks.onFolderButton_(t,FilepickerLinkDelegate.singleton$,FilepickerKind.EXISTING_FILE,e,i,n,s)}).titleKey_(t).zindex_(DEF.zindexPrompt);return null!=e&&o.message_(e),o}static promptLink2_(t,e,i,n,s){return _Util.promptLink21_(t,e,i,n,Callbacks.onLinkFolderButton_,s)}static promptLink21_(t,e,i,n,s,o){return new PromptLink2(accessories$,e,i,n,s).titleKey_(t).zindex_(DEF.zindexPrompt).onOK_((t,e,i,s)=>{Sanitizers.checkOptionalHref_(e,n).onFail_(e=>{s(!1),t.warn_(e)}).onOK_(e=>{Sanitizers.checkAttrs_(i,n,i=>{if(t.warn_(i))return void s(!1);s(!0),toasters$.warn_(i[Key.warns]);const n=i[Key.attrs];o(e,n)})})})}static promptLink3_(t,e,i,n,s,o,l){const a=new PromptLink3(accessories$,i,n,s,o);return a.titleKey_(t).zindex_(DEF.zindexPrompt).onChange_((t,i)=>{if(t.spec$.key$==RS.URL){const t=a.getFieldAt_(1),n=t.getValue_();if(e||0==n.length){let e=HumanLink.fromInput_(i).filepath$;if(null!=e){const i=e.startsWith("/")?new Basepath(e):new Basepath(o.path$).changeNameWithSuffix_(e);t.setValue_(An.labelFromBasepath_(i))}}}}).onOK_((t,e,i,n,s)=>{Sanitizers.checkOptionalHref_(e,o).onFail_(e=>{s(!1),t.warn_(e)}).onOK_(e=>{Sanitizers.checkAttrs_(n,o,n=>{if(t.warn_(n))return void s(!1);s(!0),toasters$.warn_(n[Key.warns]);const o=n[Key.attrs];l(e,i,o)})})})}static promptValues_(t,e){return new CompositeDialog(accessories$,e).titleKey_(t)}static promptInsertElement_(){return new PromptInsertElement(accessories$).titleKey_(RS.InsertElementTitle).zindex_(DEF.zindexPrompt).tag_("DIV").onValidate_((t,e,i)=>{Sanitizers.checkTagAttrs_(t,e,native$.getIFrameUri_(),i)})}static promptInsertText_(t,e){return new PromptInsertText(accessories$,cache$.ui$.buttonSize_(),t,settings$.dateFormat_(),settings$.timeFormat_(),e).titleKey_(RS.InsertTextTitle).zindex_(DEF.zindexPrompt)}static promptFont_(t,e=DEF.zindexContextmenu+100){const i=_Util.getNonSystemFontFamilies_(settings$.fontFamilies_());return new PromptFont(accessories$,cache$.ui$.buttonSize_(),cache$.ui$.dpi_(),t,i,PATH._assetsFontsPng).zindex_(e)}static getNonSystemFontFamilies_(t){const e=sarray_();for(const i of t){if(i.category_()==FontCategories.System)continue;const t=i.fontname_(),n=i.styles_();for(const i of n){const n=FontUtil.fontFamilyOf_(t,i);e.push(n)}}return e}static promptFilepath_(t,e,i,n,s){let[o,l]=Basepath.splitPath_(s);return new Filepicker(accessories$,t,e,i,n,o,l,gestureHandler$,fileinfoUt$).onPaste(Callbacks.pasteFromClipboard_).onCopy(Callbacks.copyToClipboard_).onView_(Callbacks.onViewLocalImage_).onDragstart_(Callbacks.filepickerDragstartHandler_).dateFormat_(settings$.dateFormat_()).maxWidth_(640)}static promptName_(t,e,i,n,s){return new CompositeDialog(accessories$,[new InputField("",i,n,RS.Name)]).titleKey_(t).message_(e).zindex_(DEF.zindexPrompt).onOK_((t,e)=>{const i=t.getValueAt_(0);if(An.isempty_(i)||"."==i)return t.warnKey_(RS.InputMustNotBeEmpty),void e(!1);for(let n=0,s=i.length;n<s;++n){const s=i.codePointAt(n),o=i.substring(n,n+1);if(void 0===s||0==n&&!An.isXmlNameStart_(s,o)||0!=n&&!An.isXmlName_(s,o))return t.warn_(`${MSG.string_(RS.InvalidCharacter_)}${o}, offset=${n}`),void e(!1)}e(!0),s(i)})}static getCurrentDir_(t=null){const e=native$.getIFrameContextPath_();return null!=e?Basepath.dir_(e)+"/":null!=t?t:PathUtil.getHomeDir(mainPanel$.isLoggedIn())}static getAudioOutputDir_(t){_Util._getCurrentDirInfo((e,i)=>{if(null!=e&&null!=i&&i.writable$)return void t(e);const n=PathUtil.getAudiosDir(mainPanel$.isLoggedIn());fileinfoUt$.mkDirs_(n,e=>{toasters$.warn_(e)||t(n)})})}static getVideoOutputDir_(t){_Util._getCurrentDirInfo((e,i)=>{if(null!=e&&null!=i&&i.writable$)return void t(e);const n=PathUtil.getVideosDir(mainPanel$.isLoggedIn());fileinfoUt$.mkDirs_(n,e=>{toasters$.warn_(e)||t(n)})})}static getNewPageDir_(t){_Util._getCurrentDirInfo((e,i)=>{null!=e&&null!=i&&i.writable$?t(e):t(PathUtil.getDraftsDir(mainPanel$.isLoggedIn()))})}static _getCurrentDirInfo(t){const e=native$.getIFrameContextPath_(),i=null==e?null:Basepath.dir_(e);null!=e&&null!=i?fileinfoUt$.fileInfo_(i,e=>{An.hasMessage_(e)?t(null,null):t(i+"/",FileInfo.of_(e[Key.fileinfo]))}):t(null,null)}static getUriOfKind1_(t,e){const i=DialogUt.getPathKind_(t);return Callbacks.getUriOfKind_(i,e)}static importImageFromPhotoLibrary_(t,e,i,n,s,o){const l=i.width_(),a=i.height_();if(MediaUtil.isInvalidDimension_(l,a))return toasters$.warnKey_(RS.InvalidDimensionAbort),void s();const r=Basepath.joinPath_(t,PathUtil.createOutputFilenameFromImageInfo(DEFUtil.prefixPhoto$,i)),_=i.tnDataUrl_();if(null==_)return toasters$.warnKey_(RS.ImportFailed),void s();_Util.promptOutputImage1_(r,t,l,a,DEF.jpegQualityHigh,n,_,t=>{host$.importImageFromPhotoLibrary_(ImageTnOutputInfo.from_(t,0,0),i,!1,e=>{o(t.cpath,e)})},t=>{t.onCancel_(()=>{s(),toasters$.warnKey_(RS.ImportCancelled)}),t.show_()})}static newPageFromTemplateName_(t){const e=settings$.htmlTemplatesByName_().get(t);void 0!==e?_Util.onSaveOrDiscard_(()=>{const i=_Util.defaultNewPageFilepath_(e);_Util.newPageFromTemplate1_(i,t)}):toasters$.warnKey_(RS.InvalidTemplate)}static newPageFromTemplate1_(t,e){fileinfoUt$.mkparent_(t,()=>{const i=_Util.promptFilepath_(e,FilepickerKind.WRITE_FILE,"",_Util.getCurrentDir_(),t);i.setDelegate_(FilepickerHtmlDelegate.singleton$),i.zindex_(DEF.zindexPrompt),i.onOK_((t,i)=>{t(!0),_Util.newPageFromTemplate3_(i,e)}),i.show_()})}static newPageFromTemplate3_(t,e){host$.addPage_(t,e,e=>{toasters$.error_(e)||(mainPanel$.addIFrameReadyOneshotCallback(t=>mainPanel$.startEditCallback(t)),_Util.browseFile_(t))})}static defaultNewPageFilename_(t){const e=DateTime.now_(),i=t.cat_();return i==TemplateCat.Blog?An.to02d_(e.day$)+".html":i.toLowerCase()+"-"+An.simpleDateTimeString_(e)+".html"}static defaultNewPageFilepath_(t){return _Util.getCurrentDir_()+_Util.defaultNewPageFilename_(t)}static getBlogMonthPath_(t){const e=An.to04d_(t.year$),i=An.to02d_(t.month$);return`${PathUtil.getHomeDir(mainPanel$.isLoggedIn())}blog/${e}/${i}`}static getBlogDayHtmlPath_(t){const e=An.to02d_(t.day$);return`${this.getBlogMonthPath_(t)}/${e}/${e}.html`}static _getTemplateFilename(t){const e=t.template_();return null==e?(toasters$.error_(MSG.string_(RS.InvalidTemplate)),null):e}static getTemplateHtmlFromInfo_(t){if(null==t)return null;const e=_Util._getTemplateFilename(t);return null==e?null:`/assets/templates/${t.lcCat_()}/${e}`}static getTemplateHtml_(t){const e=settings$.htmlTemplatesByName_().get(t);return void 0===e?null:_Util.getTemplateHtmlFromInfo_(e)}static openExisting_(t){mainPanel$.addIFrameReadyOneshotCallback(t=>mainPanel$.startEditCallback(t)),_Util.browseFile_(t)}static getImageOrientation_(t){const e=t.width_(),i=t.height_();return null!=e&&null!=i?e>i?CSS.xLandscape:CSS.xPortrait:null}static setImageOrientation_(t,e){if(null!=e){const i=_Util.getImageOrientation_(e);null!=i&&An.removeAddClasses_(t,[CSS.xLandscape,CSS.xPortrait],[i])}}static setImageOrientationOfElement_(t,e){if(null!=e){const i=_Util.getImageOrientation_(e);null!=i&&native$.removeAddClasses_(t,[CSS.xLandscape,CSS.xPortrait],[i])}}static setImageOrientationOfPath_(t,e,i){host$.localImageInfo_(e,e=>{if(!An.hasMessage_(e)){const i=MediaInfo.of_(e[Key.result]);_Util.setImageOrientation_(t,i)}i()})}}_Util._XWXH="#XYV",_Util._XDIM="#X83",_Util._XTNWXH="#XrB",_Util._XADJUST="#X7r",_Util._XQUALITY="#X9x",_Util._XEFFECT="#X0K",_Util._XTNSIZE="#XQl",_Util._XCROP="#XpW",_Util._XROTATION="#XpE",_Util._XFILEPATH="#XfO",_Util._XPREVIEW="#XG1",_Util._XCORRECTION="#Xbn";class Sanitizers{static checkIsImageLcExt_(t){return MimeUtil.isImageLcExt(t)?BotResult.ok_(!0):BotResult.fail_([MSG.string1_(RS.InvalidImageFileExt_,null!=t?t:"")])}static checkIsImageUri_(t){return this.checkIsImageLcExt_(new Basepath(t.path$).lcExt$).mapOK_(t)}static checkIsImageFilepath_(t){return this.checkIsImageLcExt_(new Basepath(t).lcExt$).mapOK_(t)}static checkIsSameExt_(t,e){return MimeUtil.extFromUri(t)!=e?BotResult.fail_([MSG.string1_(RS.ExpectingFileExt_,e)]):BotResult.ok_(t)}static checkUri_(t){const e=this.checkUri1_(sarray_(),t);return 0==e.length?BotResult.ok_(t):BotResult.fail_(e)}static checkRequiredUri_(t){return null==t?BotResult.failArrayKey_(RS.URLInputMustNotBeEmpty):this.checkUri_(t)}static checkImageUri_(t){return this.checkUri_(t).ifOK_(t=>this.checkIsImageUri_(t))}static checkOptionalImageUri_(t){return null==t?BotResult.ok_(null):this.checkUri_(t).ifOK_(t=>this.checkIsImageUri_(t))}static checkHref_(t,e){const i=An.parseUriSafe_(t,e);return null==i?BotResult.failArrayKey_(RS.InvalidURL):this.checkUri_(i)}static checkImageHref_(t,e){return this.checkHref_(t,e).ifOK_(t=>this.checkIsImageUri_(t))}static checkOptionalHref_(t,e){return 0==t.length||"."==t?BotResult.ok_(null):this.checkHref_(t,e)}static checkRequiredHref_(t,e){return 0==t.length||"."==t?BotResult.failArrayKey_(RS.URLInputMustNotBeEmpty):this.checkHref_(t,e)}static checkRequiredImageHref_(t,e){return 0==t.length||"."==t?BotResult.failArrayKey_(RS.URLInputMustNotBeEmpty):this.checkImageHref_(t,e)}static checkFilepath_(t){const e=sarray_();return this.sanitizeFilepath_(t.split("/"),t=>e.push(t)),0==e.length?BotResult.ok_(t):BotResult.fail_(e)}static checkImageFilepath_(t){return this.checkIsImageFilepath_(t).ifOK_(t=>this.checkFilepath_(t))}static checkRequiredImageFilepath_(t){return 0==t.length||"."==t?BotResult.failArrayKey_(RS.FilepathInputMustNotBeEmpty):this.checkImageFilepath_(t)}static checkRequiredInputImage_(t,e,i){this.checkRequiredImageFilepath_(t).onFail_((t,e)=>{i(e)}).onOK_(t=>{const n=An.cpathOfFilepath2_(e,t);if(null==n)return i(BotResult.failArrayKey_(RS.InvalidFilepath));fileinfoUt$.fileInfo_(n,t=>{const e=FileInfo.of_(t[Key.fileinfo]);null!=e&&e.exists$?i(BotResult.ok_(n)):i(BotResult.failArrayKey_(RS.ImageNotFound))})})}static checkRequiredImageOptionalLink_(t,e,i){return 0==t.length?BotResult.failArrayKey_(RS.URLInputMustNotBeEmpty):Sanitizers.checkImageHref_(t,i).ifOK_(t=>0==e.length?BotResult.ok_([t,null]):Sanitizers.checkHref_(e,i).ifOK_(e=>{const n=An.addViewParam_(e,i);return null==n?BotResult.fail_([MSG.string_(RS.InvalidURL)]):BotResult.ok_([t,n])}))}static _checkUriPart(t,e){const i=new Array;for(const t of Ut.charcodes_(e))(void 0===t||t<32||this._URI_PART_ILLEGAL.includes(t)||!Unicode$.isValidUnicode_(t))&&i.push(null!=t?t:-1);i.length>0&&t.push(MSG.string_(RS.InvalidUriChar_)+this.escIllegals_(i))}static checkUri1_(t,e){return this.sanitizeFilepath_(e.pathSegments$,e=>t.push(e)),e.search$.length>1&&this._checkUriPart(t,e.search$.substring(1)),e.hash$.length>1&&this._checkUriPart(t,e.hash$.substring(1)),t}static checkTagAttrs2_(t,e,i){host$.sanitizeTagAttrs_(t,t=>{const n=An.messagesList_(t),s=t[Key.attrs],o=s?s.style:null;o?cssParser$.sanitizeStyle_(o,e,e=>{n.push(...An.messagesList_(e));const o=e[Key.style];o&&(t[Key.style]=o,s.style=CSSUtil.joinStyles1_(Object.entries(o))),i(n,t)}):i(n,t)})}static checkTagAttrs_(t,e,i,n){if(0==t.length)return n(smapOf_(Key.errors,MSG.string_(RS.TagIsRequired)));this.checkTagAttrs2_(smap_([Key.tag,t],[Key.attrs,e]),i,(t,e)=>{if(t.length>0)return n(smapOf_(Key.errors,t));n(e)})}static checkAttrs_(t,e,i){this.checkTagAttrs2_(smapOf_(Key.attrs,t),e,(t,e)=>{if(t.length>0)return i(smapOf_(Key.errors,t));i(e)})}static sanitizeFilepath_(t,e){const i=new Array;for(let n of t)this._sanitizeFilenameStrict0(i,n,e);i.length>0&&e(MSG.string_(RS.InvalidFilenameCharacter_)+this.escIllegals_(i))}static _sanitizeFilenameStrict0(t,e,i){if(null==e)return void i(MSG.string_(RS.FilenameMustNotBeNull));const n=e.length;0!=n&&(e.startsWith(".")&&1!=n&&".."!=e&&i(MSG.string_(RS.FilenameMustNotStartsWithDot)),An.isWhitespace_(e.codePointAt(0))&&i(MSG.string_(RS.FilenameMustNotStartsWithSpaces)),An.isWhitespace_(e.codePointAt(n-1))&&i(MSG.string_(RS.FilenameMustNotEndsWithSpaces)),this._sanitizeFilename1(t,e,n))}static _sanitizeFilename1(t,e,i){var n;for(let s=0;s<i;++s){let i=null!==(n=e.codePointAt(s))&&void 0!==n?n:-1;this._INVALID_FILENAME_CHARS.includes(i)?t.push(i):32!=i&&An.isWhitespace_(i)&&t.push(i)}}static escIllegals_(t){let e="";for(let i of t)if(i>=32&&i<127&&92!=i)e+=String.fromCharCode(i);else{e+=`{0x${i.toString(16).padStart(4,"0")}}`}return e.toString()}static onValidateStyles_(t,e,i){t.size>0?cssParser$.sanitizeStyle_(CSSUtil.joinStylesRemovingEmptyValues_(t),e,e=>{const n=e[Key.style];if(n){for(const[e,i]of t.entries())0==i.trim().length&&(n[e]="");e[Key.result]=n}i(e)}):i(smapOf_(Key.result,{}))}static onValidateNonEmptyValues_(t,e,i,n){for(const s of n)if(An.isempty_(i.getValue_(s))){const i=e.get(s);void 0!==i&&t.push(MSG.string1_(RS.inputMustNotBeEmpty_,i))}}}Sanitizers._URI_PART_ILLEGAL=Ut.charcodes_("?#[]\\"),Sanitizers._INVALID_FILENAME_CHARS=Ut.charcodes_("\\?#%;[]");class _ContextmenuBase extends ContextmenuBase{constructor(t){super(t),this.onTooltipsKey_(toasters$.onTooltipsKey_),this.onShow_(()=>{null==this.smokescreen$&&(this.smokescreen$=new Smokescreen(accessories$,An.zindexOf_(this._contextmenu,DEF.zindexUnder,DEF.zindexPrompt+DEF.zindexUnder))),this.smokescreen$.show_(t=>{const e=t.element_();_Util.createContentScroller_(e,()=>this.cancel_())})})}}class PageContextmenu extends _ContextmenuBase{constructor(t){super(PageContextmenu.createContextmenu(t));const e=new DomBuilderEx(this._contextmenu).div1_(CSS.AnVerticalMenu).div1_(CSS.AnVerticalViewport).div1_(CSS.AnTextList,CSS.AnBulletList).push_();this._populate(e),Conf.useFlash&&new Flash(e.pop_().cursor_(),`div[${ATTR.AnAction}]`,CSS.AnFlashLowlight,DEFUtil.flashDuration),this.onContextmenu_((t,e)=>{An.stopevent_(e)})}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuPage}).cursor_()}_populate(t){t.push_();const e=smap_();for(const[t,i]of Object.entries(settings$.htmlTemplates_()))for(const t of i){const i=TemplatesInfo.of_(t);null!=i&&(e[i.name_()]=i)}for(const[i,n]of Object.entries(e))t.peek_().div2_(ATTR.AnAction,i).append1_("span",n.classes_()).text_(n.label_());t.pop_()}hide_(){this.destroy_()}}class GalleryContextmenu extends _ContextmenuBase{constructor(t){super(GalleryContextmenu.createContextmenu(t));const e=new DomBuilderEx(this._contextmenu).div1_(CSS.AnVerticalMenu).div1_(CSS.AnVerticalViewport).table1_().push_();this._descendingCheckbox=this._createCheckbox(e,RS.Descending,!1),this._singleCheckbox=this._createCheckbox(e,RS.SingleSection,!1),this._recursiveCheckbox=this._createCheckbox(e,RS.Recursive,!0),e.peek_().tr_().td_().hr2_("style",`height:0;width:100%;border-top:${DEF.themeBorder};`);for(const t of[TemplateName.homeSimpler,TemplateName.mediaSticker,TemplateName.mediaWall]){const i=settings$.htmlTemplatesByName_().get(t);void 0!==i&&(e.peek_().tr1_().td_(["class",CSS.AnBulletRow],[ATTR.AnAction,t]),e.append1_("span",i.classes_()),e.text_(i.label_()))}Conf.useFlash&&new Flash(e.pop_().cursor_(),`td[${ATTR.AnAction}]`,CSS.AnFlashLowlight,DEFUtil.flashDuration),this.onContextmenu_((t,e)=>{An.stopevent_(e)})}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuGallery}).cursor_()}_createCheckbox(t,e,i){const n=t.push_().tr_().td1_(CSS.AnBulletRow).cursor_(),s=t.input2_("type","checkbox").cursor_();return t.up_().text_(MSG.string_(e)).pop_(),An.onClick_(n,t=>{const e=DomUt.asHTMLElement_(t.target);null!=e&&"INPUT"==e.nodeName||(An.stopevent_(t),s.checked=!s.checked)}),s}isDescending(){var t,e;return null!==(e=null===(t=this._descendingCheckbox)||void 0===t?void 0:t.checked)&&void 0!==e&&e}isSingleSection(){var t,e;return null!==(e=null===(t=this._singleCheckbox)||void 0===t?void 0:t.checked)&&void 0!==e&&e}isRecursive(){var t,e;return null!==(e=null===(t=this._recursiveCheckbox)||void 0===t?void 0:t.checked)&&void 0!==e&&e}hide_(){super.destroy_()}}class CSSClassesContextmenu extends _ContextmenuBase{constructor(t,e,i,n){super(CSSClassesContextmenu._create(t)),this._classes=e,this._existing=i;const s=new DomBuilderEx(this._contextmenu).table1_(CSS.AnContextmenu).push_();this._input=this._createInput(s,t=>{const e=t.trim();CSSUtil.validateClass(e)?(this.destroy_(),n(e)):toasters$.warnKey_(RS.InvalidCSSClassName)}),s.peek_().tr_().td_().div_({class:CSS.AnVerticalViewport,style:"padding-top:5px;max-height:calc(75vh - 8ex);"}).div1_(CSS.AnTextList).push_();for(const t of this._classes)s.peek_().div2_(ATTR.AnAction,t),this._existing.includes(t)&&s.b_(),s.text_(t);Conf.useFlash&&new Flash(s.pop_().cursor_(),`div[${ATTR.AnAction}]`,CSS.AnFlashLowlight,DEFUtil.flashDuration),this.onContextmenu_((t,e)=>{An.stopevent_(e)}),this.onAction_(t=>{this.destroy_(),n(t)}),An.addContextmenuListenerMatching_(this._contextmenu,`div[${ATTR.AnAction}]`,(e,i)=>{var n;An.stopevent_(i);const s=null!==(n=e.getAttribute(ATTR.AnAction))&&void 0!==n?n:"";DialogUt.confirm_(t,MSG.format1_(RS.ClientActionClassesConfirmDelete,s),t=>{t&&(ArrayUt.delete_(this._classes,s),e.remove())}).showWarning_()})}hide_(){this.destroy_()}static _create(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display:none;visibility:hidden;",name:NAME.contextmenuClasses}).cursor_()}_createInput(t,e){const i=StringMap.copyOf_(INPUT.info_(INPUT.PromptInput));i.placeholder=_DialogUt.placeholder_(RS.ClientActionClassesPlaceholder);const n=t.push_().tr1_().td_({class:CSS.AnFlexCenter,style:"padding:10px;"}).child_(Conf.input,i).cursor_();return t.pop_(),An.onInputFocusSelect_(this._input),An.onInputChange_(n,()=>e(n.value)),An.onInputEnterKey_(n,()=>e(n.value)),n}}class ScribblerHandler{showKeyboard_(){host$.showKeyboard_()}hideKeyboard_(t){host$.hideKeyboard_(t)}toggleKeyboard_(){host$.toggleKeyboard_(null)}loadFont_(t,e){native$.onFontLoaded_(t,null,e)}promptImportImage_(t,e,i,n){const s=native$.getIFrameDir_();null!=s&&_Util.promptInputImage_(RS.PickImage,s,t,e,i,n).show_()}promptExportImage_(t,e,i,n,s,o){const l=native$.getIFrameDir_();null!=l&&_Util.promptOutputImage1_(t,l,e,i,n,s,null,o,t=>{t.setVisible_(_Util._XROTATION,!1),t.setVisible_(_Util._XEFFECT,!1),t.setVisible_(_Util._XADJUST,!1),t.show_()})}info_(t,e){toasters$.info_(t,e)}warn_(t,e){return toasters$.warn_(t,e)}ok_(t,e){toasters$.ok_(t,e)}warn0_(t){return toasters$.warn0_(t)}getFileinfoUtil(){return fileinfoUt$}getSettings_(){return settings$}saveImage_(t,e,i){host$.saveBase64Image_(t,e,i)}getContextPath(t){return An.cpathOfHref2_(native$.getIFrameUri_(),t)}}class ElementResizerInfo{constructor(t,e,i,n,s,o,l,a,r){this.target=t,this.canReposition=e,this.canResize=i,this.canRotate=n,this.position=s,this.left=o,this.top=l,this.width=a,this.height=r}}class ElementResizer{constructor(t,e){this._smokescreen=t,this._info=e,this._doneCallback=null,this._rect0=null,this._path0=null,this._style=null,this._transform0=null,this._angle0=null,this._rotation0=0,this._rotation=0,this._hasPrefix=!1,this._match0=null,_destroyed_11.set(this,!1);let i=0,n=0,s=0,o=0;e.canReposition&&(i=null==e.left?0:Math.round(e.left),n=null==e.top?0:Math.round(e.top)),e.canRotate&&(this._style=e.target.style,this._transform0=null==this._style?null:this._style.transform,null!=this._transform0&&this._transform0.length>0&&(this._match0=ElementResizer._rotateRegex.exec(this._transform0),null!=this._match0&&(this._hasPrefix=this._match0[1].trim().length>0,this._rotation0=this._parseRotation1(this._match0[2]),this._rotation=this._rotation0))),e.canResize&&(s=null==e.width?0:Math.round(e.width),o=null==e.height?0:Math.round(e.height)),this._rect0=new Rect(i,n,s,o),this._savedPath=[i,n,i+s,n+o],this._normalize(this._savedPath),this._path=[],this._showValues(this._rect0,this._rotation0),this._dragger=new Dragger(t.element_(),this,new FrameLimiter(2))}onDone(t){this._doneCallback=t}bind(){if(this._info.canRotate&&null==this._style)return toasters$.warn_(MSG.string_(RS.InvalidSelection),{attop:!0}),void this.close();this._dragger.bind_()}close(){this.destroy(),null!=this._doneCallback&&this._doneCallback()}destroy(){__classPrivateFieldGet(this,_destroyed_11)||(__classPrivateFieldSet(this,_destroyed_11,!0),this._dragger.destroy_(),this._smokescreen.destroy_())}onDragstart_(t,e,i,n){if(!this._info.canReposition&&!this._info.canRotate&&!this._info.canResize)return!1;if(t.element_()!==e)return!1;this._path=this._canvasloc1([],i,n);const s=t.state_();return 2==s.touches&&(this._info.canRotate&&(this._rotation0=this._rotation,this._angle0=this._angle(s.pointers)),this._info.canResize&&(this._path0=An.intArrayCopy_([],s.pointers))),!0}onDragmove_(t){const e=t.state_(),i=this._csnapx(e.x),n=this._csnapy(e.y),s=this._info.target.style;if(2==e.touches){this._info.canRotate&&this._rotate(e),this._info.canResize&&this._scale(e);const t=this._snaplist(this._savedPath),i=An.getRect_(t);this._info.canResize&&(s.width=`${i.width}px`,s.height=`${i.height}px`),this._showValues(i,this._rotation)}else{this._translate(i,n);const t=this._snaplist(this._savedPath),e=An.getRect_(t);s.left=`${e.left}px`,s.top=`${e.top}px`,this._showValues(e,this._rotation)}}onDragend_(t,e){An.stopevent_(e),t.state_().moved||this.close()}_rotate(t){const e=this._angle(t.pointers);if(null==this._angle0&&(this._angle0=e),null==this._angle0||null==e||e==this._angle0)return;const i=this._degree(e-this._angle0);let n=Math.round(2*(this._rotation0+i))/2;for(;n>180;)n-=360;for(;n<-180;)n+=360;this._setTransform(n)}_scale(t){if(null==this._path0)return;const e=this._path0[2]-this._path0[0],i=this._path0[3]-this._path0[1],n=An.intArrayCopy_([],t.pointers),s=n[2]-n[0]-e,o=n[3]-n[1]-i;0==s&&0==o||(o>Dragger.THRESHOLD||o<-Dragger.THRESHOLD||s>Dragger.THRESHOLD||s<-Dragger.THRESHOLD)&&(this._path0=n,this._savedPath[2]+=this._threshold(s,Dragger.THRESHOLD),this._savedPath[3]+=this._threshold(o,Dragger.THRESHOLD),this._floor(this._savedPath,2,0),this._floor(this._savedPath,3,1))}_translate(t,e){let i=t-this._path[0],n=e-this._path[1];this._path[0]=t,this._path[1]=e,i=this._threshold(i,3),n=this._threshold(n,3),this._savedPath[0]+=i,this._savedPath[1]+=n,this._savedPath[2]+=i,this._savedPath[3]+=n}_floor(t,e,i){t[e]<t[i]&&(t[e]=t[i])}_showValues(t,e){const i=sarray_();this._info.canReposition&&i.push(`${MSG.string_(RS.Position)}: ${t.left},${t.top}`),this._info.canResize&&i.push(`${MSG.string_(RS.Size)}: ${t.width}x${t.height}`),this._info.canRotate&&i.push(`${MSG.string_(RS.Rotation)}: ${e.toFixed(1)}`),toasters$.info_(i,{attop:!0})}_normalize(t){const e=t[2]<t[0],i=t[3]<t[1];return e?i?[t[2],t[3],t[0],t[1]]:[t[2],t[1],t[0],t[3]]:i?[t[0],t[3],t[2],t[1]]:[t[0],t[1],t[2],t[3]]}_threshold(t,e){return t>0?Math.max(0,t-e):t<0?Math.min(0,t+e):0}_canvasloc1(t,e,i){const n=this._csnapx(e),s=this._csnapy(i);return t.push(n),t.push(s),t}_snap(t,e=5){return e>1?Math.round(t/e)*e:t}_csnapx(t,e=5){return Math.max(0,this._snap(t,e))}_csnapy(t,e=5){return Math.max(0,this._snap(t,e))}_snaplist(t){const e=new Array;for(let i=0,n=t.length;i<n;++i)e.push(this._snap(t[i]));return e}_degree(t){return 180*t/Math.PI}_angle(t){if(null!=t&&t.length>=4){const e=t[0],i=t[1],n=t[2],s=t[3];let o;return o=s==i?n>e?-Math.PI/2:Math.PI/2:s>i?-Math.atan(.2*(n-e)/(s-i)):n>=e?-Math.atan(.2*(n-e)/(s-i))-Math.PI:-Math.atan(.2*(n-e)/(s-i))+Math.PI}return null}_parseRotation1(t){const e=An.doubleValueUnit_(t);if(null==e)return 0;switch(e[1].toLowerCase()){case"rad":return this._degree(e[0]);case"grad":return 360*e[0]/400;case"turn":return 360*e[0];default:return e[0]}}_setTransform(t){if(t==this._rotation)return;this._rotation=t;const e=t.toFixed(1),i="0.0"==e||"-0.0"==e?"rotate(0deg)":`rotate(${e}deg)`;let n;n=An.isempty_(this._transform0)?i:null==this._match0?`${i} ${this._transform0}`.trim():`${this._match0[1]}${i}${this._match0[3]}`.trim(),null!=this._style&&(this._style.transform=n)}}_destroyed_11=new WeakMap,ElementResizer._rotateRegex=new RegExp("^(.*?)rotate\\((.*?)\\)(.*)$","i");class IFramePinchZoomListener{constructor(t,e,i){this._target=t,this._useTouch=e,this._callback=i,this._pointers=[],this._dist1=0,this._center=null,this._delta=0,this._subscriptions=new Array,native$.iAddEventListener_(this._target,Conf.touchstart,t=>this.onTouchStart(t),!1)}onTouchStart(t){if(this._pointers=this._useTouch?this._touchPointers(t):this._mousePointers(t,this._pointers),0==this._pointers.length)return void this._reset();if(JsUtil.stopevent_(t),this._pointers.length<4)return;this._subscriptions.push(native$.iAddEventListener_(this._target,Conf.touchmove,t=>this.onTouchMove(t),!1)),this._subscriptions.push(native$.iAddEventListener_(this._target,Conf.touchend,t=>this.onTouchEnd(t),!1)),this._dist1=An.dist1_(this._pointers,0),this._delta=0;const e=this._useTouch?this._midx(this._pointers):this._pointers[0],i=this._useTouch?this._midy(this._pointers):this._pointers[1];this._center=new Point(e,i),this._callback(this._center,0)}onTouchMove(t){const e=this._useTouch?this._touchPointers(t):this._mousePointers(t,this._pointers);if(JsUtil.stopevent_(t),0==e.length)return this._reset();if(e.length<4)return;const i=An.dist1_(e,null);null!=i&&(this._delta=this._callback(null,this._delta+i-this._dist1),this._dist1=i)}onTouchEnd(t){const e=this._useTouch?this._touchPointers(t):this._mousePointers(t,this._pointers);if(JsUtil.stopevent_(t),e.length>=4){const t=An.dist1_(e,null);null!=t&&this._callback(null,this._delta+t-this._dist1)}this._reset()}_touchPointers(t){const e=Array.from(t.touches),i=[];if(2==e.length)for(const t of e)i.push(Math.floor(t.screenX)),i.push(Math.floor(t.screenY));return i}_mousePointers(t,e){const i=[];return t.ctrlKey&&t.buttons>0&&(e.length>=2&&(i.push(e[0]),i.push(e[1])),i.push(Math.floor(t.screenX)),i.push(Math.floor(t.screenY))),i}_reset(){this._pointers=[],this._dist1=0,this._center=null,this._delta=0,native$.removeEventSubscriptions_(this._subscriptions),this._subscriptions=[]}_midx(t){return(t[0]+t[2])/2}_midy(t){return(t[1]+t[3])/2}}IFramePinchZoomListener.MAX_ZOOM=4,IFramePinchZoomListener.MAX_AREA=33161216;class _AlarmUtil{static createId_(t=null){return null==t&&(t=DateTime.ms_()),`${CSS.xAlarm}${t}`}}class _Hacks{static fixBody(){const t=native$.getIFrameDocument_();if(null!=t){const e=t.body;null!=e&&_Hacks.fixBodyXroot(t,e)}}static fixBodyXroot(t,e){const i=t.documentElement;null!=i&&(i.style.height="100%");const n=window.innerWidth,s=window.innerHeight-cache$.ui$.toolbarHeight_(),o=e.style;o.width=`${n}px`,o.maxWidth=`${n}px`,o.padding="0",o.margin="0",o.height=`${s}px`,o.maxHeight=`${s}px`}}class _COF{}_COF.focus="X93",_COF.edit="X5g",_COF.getsel="XGZ",_COF.save="Xb4",_COF.revert="X3R",_COF.browse="Xtx",_COF.onscroll="XPd",_COF.onkeypress="X7z",_COF.setsel="XJV",_COF.text="XGS",_COF.size="Xs1",_COF.find="XLh",_COF.redo="XVK",_COF.init="XPz",_COF.down="XS7",_COF.goto="X2q",_COF.undo="XpE",_COF.parse="XC1";class CSSEditorBase extends DialogBase{constructor(t,e,i,n,s,o){super(t,o),this._cpath=e,this._editable=i,this._startEdit=n,this._initialContent=s,this._searchbar=null,this._searchbox=null,this._searchSpotlight=null,this._searchLineInput=null,this._contextmenu=null,this._editing=!1,this._modified=!1,this._selection=[1,1],super.init_(this.create_(t)),this.largeWidth_()}_getContextmenu(){return null==this._contextmenu&&(this._contextmenu=new Contextmenu(this.container_(),An.above_(this.element_()),[[BUT.info_(BUT.Redo),BUT.info_(BUT.Undo)],[BUT.info_(BUT.Folder),BUT.info_(BUT.Font),BUT.info_(BUT.Color)]]).onTooltips_(toasters$.onTooltipsKey_).onDrag_(Contextmenu.contextmenuDragOK_).onShow_(()=>{this._updateToolbarState(),this._updateContextmenuState()}).onAction_(t=>this._contextActions(t))),this._contextmenu}_notmodified(t){return t==this._initialContent||0==this._initialContent.length&&t==DEF.templateCSSRuleset}_setuplinenumber(t){t.value="1:1",An.onInputEnterKey_(t,()=>{this._gotoline(t)}),An.onChange_(t,()=>{this._gotoline(t)})}_gotoline(t){var e;const i=t.value.trim(),n=CSSEditor._LINECOL.exec(i);if(null==n)return void toasters$.warnKey_(RS.InvalidLineNumber);const s=n[1],o=n[2],l=An.parseInt_(s,null),a=An.parseInt_(o,1);null==l||l<=0||a<=0?toasters$.warnKey_(RS.InvalidLineNumber):(null===(e=this._searchSpotlight)||void 0===e||e.hide_(),toasters$.hideAll_(),host$.hideKeyboard_(()=>{this._gotoline1(l,a)}))}_gotoline1(t,e){this._editor[_COF.goto](t,e,t=>this._gotolineCallback(t))}_gotolineCallback(t){null!=t&&this._spotlight(t)}_onselectionchanged(t,e){this._selection=[t,e];const i=null==t?"":`${t}:${e}`;this._mainLineInput.value=i,null!=this._searchLineInput&&(this._searchLineInput.value=i)}onResize_(){}actionNextMatch(){null!=this._searchbar&&(An.toggleButtonOn_(this._searchbar.button_(BUT.NextMatch)),An.toggleButtonOff_(this._searchbar.button_(BUT.PrevMatch)),this._search(!1))}_toolbarActions(t,e){if(toasters$.hideAll_(),null!=this._editor)switch(t){case BUT.Toolbar1:this._showSearchbar();break;case BUT.Toolbar2:this._showMainbar();break;case BUT.NextMatch:this.actionNextMatch();break;case BUT.PrevMatch:null!=this._searchbar&&(An.toggleButtonOff_(this._searchbar.button_(BUT.NextMatch)),An.toggleButtonOn_(this._searchbar.button_(BUT.PrevMatch)),this._search(!0));break;case BUT.RulesetAdd:this._editor[_COF.text](DEF.templateCSSRuleset),this._updateToolbarState();break;case BUT.RuleAdd:this._editor[_COF.text](DEF.templateCSSRule),this._updateToolbarState();break;case BUT.Discard:this._actionDiscard();break;case BUT.Cancel:this._onCancel();break;case BUT.OK:this._actionOK();break;case BUT.Save:this._actionSave();break;case BUT.Edit:this._editable&&this._onedit();break;case BUT.Contextmenu:this._getContextmenu().show_(e);break;default:this.actionInvalid_(t)}}_showSearchbar(){null!=this._searchbar&&(this._mainbar.hide_(),this._searchbar.show_(),Timer.sleep00_(()=>{if(null==this._searchbox)return;this._searchbox.focus();const t=this._editor[_COF.getsel]();null!=t&&(this._searchbox.value=t)}))}_showMainbar(){var t;null===(t=this._searchbar)||void 0===t||t.hide_(),this._mainbar.show_()}_actionDiscard(){this._editable&&this._editing?host$.hideKeyboard_(()=>{const t=this._editor[_COF.save]();this._notmodified(t)?this._startEdit?this._onCancel():this._onsaved():DialogUt.confirmKeySmall_(accessories$,RS.ConfirmDiscard,An.above_(this.element_()),t=>{t&&(this._startEdit?this._onCancel():this._onrevert())})}):this._onCancel()}_actionOK(){host$.hideKeyboard_(()=>{const t=this._editor[_COF.save](),[e,i]=this._editor[_COF.parse](t);CSSEditor._onerror(i,t)||this._onOK(t,e,t=>{this.actionOKConfirmed_(t)})})}_actionSave(){this._editable&&host$.hideKeyboard_(()=>{const t=this._editor[_COF.save](),[e,i]=this._editor[_COF.parse](t);CSSEditor._onerror(i,t)||this._onOK(t,e,t=>{t&&(this._startEdit?this._onCancel():this._onsaved())})})}static _onerror(t,e){if(0==t.length)return!1;const i=[MSG.string_(RS.CSSSyntaxError_)],n=new LineMap(e);for(const[e,s]of t){if(i.length>10){i.push("...");break}i.push(`@${n.lineCol(e)}: ${s}`)}return toasters$.warn_(i,{attop:!0}),!0}_onrevert(){this._editor[_COF.revert](this._initialContentOrTemplate()),this._onsaved()}_onsaved(){this._editing=!1,this._updateToolbarState(),this._editor[_COF.browse]()}_onedit(){this._editor[_COF.edit](),this._editing=!0,this._updateToolbarState()}_updateToolbarState(){this._mainbar.showButton_(BUT.Cancel,!this._editing),this._mainbar.showButton_(BUT.Edit,this._editable&&!this._editing),this._mainbar.showButtons_([BUT.Contextmenu,BUT.RulesetAdd,BUT.Discard,BUT.Save],this._editable&&this._editing)}_contextActions(t){if(toasters$.hideAll_(),null==this._editor)return;if(!this._editing)return;const e=this._getContextmenu();switch(t){case BUT.Redo:this._editor[_COF.redo](),this._updateContextmenuState();break;case BUT.Undo:this._editor[_COF.undo](),this._updateContextmenuState();break;case BUT.Font:e.hide_(),host$.hideKeyboard_(()=>{const t=_Util.promptFont_("",An.above_(this.element_()));t.onOK_(t=>{this._editor[_COF.text](t)}),t.show_()});break;case BUT.Color:e.hide_(),host$.hideKeyboard_(()=>{const t=this._editor[_COF.getsel](),e=Callbacks.promptColor_(cache$.ui$.buttonSize_(),An.above_(this.element_()),t,ColorValue.X_WHITE);e.onOK_((t,e)=>{null!=t&&this._editor[_COF.text](ColorUtil.formatCSSString_(e,t))}),e.show_()});break;case BUT.Folder:e.hide_(),host$.hideKeyboard_(()=>{this._actionFilepath()});break;case BUT.Indent:e.hide_(),this._actionIndent();break;default:this.actionInvalid_(t)}}_actionIndent(){const t=Basepath.dir_(this._cpath),e=null==t?null:An.ensureTrailingSlash_(t);null!=(null==e?null:An.uriOfFilepath2_(null,e))?FormatOptions.getPreference(t=>{const e=this._editor[_COF.save](),i=sarray_(),n=CSSFormatter.formatStylesheet_(e,t);toasters$.warn_(i)||(n.replace(RX.Spaces_g,"")==e.replace(RX.Spaces_g,"")?this._editor[_COF.revert](n):toasters$.warnKey_(RS.FormatActionError))}):toasters$.warn_(MSG.string_(RS.MissingBaseurlParameter))}_updateContextmenuState(){const t=this._getContextmenu();if(null==this._editor||!this._editable)return t.enableButton_(BUT.Redo,!1),void t.enableButton_(BUT.Undo,!1);const e=this._editor[_COF.size](),i=e.redo,n=e.undo;t.enableButton_(BUT.Redo,i>0),t.enableButton_(BUT.Undo,n>0)}_search(t){var e;null===(e=this._searchSpotlight)||void 0===e||e.hide_(),toasters$.hideAll_(),host$.hideKeyboard_(()=>{if(null==this._searchbox)return;const e=this._searchbox.value;this._editor[_COF.find](e,t,!0,t=>{null!=t?this._spotlight(t):toasters$.warn_(MSG.string_(RS.NoMatchFound))})})}_spotlight(t){null!=t&&Timer.sleep0_(()=>{var e;const i=t.getBoundingClientRect();if(0==i.top&&0==i.left&&0==i.width&&0==i.height)return;const n=i.top+cache$.ui$.toolbarHeight_();null===(e=this._searchSpotlight)||void 0===e||e.show_(i.left+CSSEditor._LEFT_MARGIN,n+CSSEditor._TOP_MARGIN,i.width,i.height,()=>{var t;return null===(t=this._searchSpotlight)||void 0===t?void 0:t.hide_()}),this._editor[_COF.onscroll](()=>this._spotlightOff())})}_spotlightOff(){var t;null===(t=this._searchSpotlight)||void 0===t||t.hide_()}_searchOff(){var t;null===(t=this._searchbar)||void 0===t||t.hide_(),this._mainbar.show_()}close_(){var t;this._editor=null,null===(t=this._contextmenu)||void 0===t||t.destroy_(),this._contextmenu=null,super.close_()}_actionFilepath(){const t=Basepath.dir_(this._cpath),e=null==t?null:An.ensureTrailingSlash_(t),i=null==e?null:An.uriOfFilepath2_(null,e);if(null==i||null==t||null==e)return void toasters$.warn_(MSG.string_(RS.MissingBaseurlParameter));let n=this._editor[_COF.getsel]();if(An.isempty_(n))return void this._actionFilepath1(t,e,i);const s=An.cpathOfHref2_(i,n);null!=s?fileinfoUt$.fileInfo_(s,n=>{const o=FileInfo.of_(n[Key.fileinfo]);An.hasMessage_(n[Key.errors])||null==o?this._actionFilepath1(t,e,i):Callbacks.copyToSystemClipboard_(RS.CopiedToSystemClipboard_,s,()=>{o.exists$?this._actionFilepath1(t,s,i):this._actionFilepath1(t,e,i)})}):this._actionFilepath1(t,e,i)}_actionFilepath1(t,e,i){const n=_Util.promptFilepath_(MSG.string_(RS.Filepath),FilepickerKind.ANY,"",t,e);n.above_(this.element_()),n.setDelegate_(FilepickerLinkDelegate.singleton$),n.onOK_((t,e)=>{var n,s;t(!0);const o=null!==(s=null===(n=An.uriOfFilepath2_(i,e))||void 0===n?void 0:n.toString())&&void 0!==s?s:null;null!=o?Callbacks.copyToSystemClipboard_(RS.CopiedToSystemClipboard_,o,()=>{this._editor[_COF.text](o)}):toasters$.warn_(MSG.string_(RS.InvalidURL))}),n.show_()}}CSSEditorBase._LINECOL=new RegExp("^(\\d+)(?:[:, ](\\d+))?$"),CSSEditorBase._TOP_MARGIN=10,CSSEditorBase._LEFT_MARGIN=20;class StyleEditor extends CSSEditorBase{constructor(t,e,i){super(t,e,!0,!0,i,new DialogDraggerHandler),this._okCallback=null}create_(t){return this.createDialog_(t,t=>this._createContent(t),t=>this._createToolbar(t),(t,e)=>this._toolbarActions(t,e))}_createToolbar(t){return this._mainbar=new Toolbar(t,[INPUT.info_(INPUT.LineNumber),BUT.info_(BUT.Spacer),BUT.info_(BUT.Contextmenu),BUT.info_(BUT.OK),BUT.info_(BUT.Cancel)]),this._mainbar.onAction_((t,e)=>this._toolbarActions(t,e)),this._mainLineInput=this._mainbar.querySelector_(`${Conf.input}.${CSS.AnLineNumberInput}`),this._setuplinenumber(this._mainLineInput),this._mainbar}_createContent(t){const e=new DomBuilderEx(t).addStyles_(smap_(["display","flex"],["margin-top","5px"],["border","1px solid rgba(0, 0, 0, 0.5)"],["border-radius","5px"]));this._content=e.iframe_({seamless:"true",border:"0",sandbox:"allow-same-origin allow-scripts",style:"width:100%;height:32ex;max-height:40vh;border:none;",src:PATH._assetsCSSEditorHtml}).cursor_(),An.onLoad_(this._content,()=>{const t=this._initialContentOrTemplate();this._editor=native$.cssEditor_(this._content,t,settings$.fontFaces_(),(t,e)=>{this._onselectionchanged(t,e)}),this._editor[_COF.focus](()=>this._searchOff()),this._editor[_COF.down](()=>this._spotlightOff()),this._editable&&this._startEdit&&this._onedit()})}_updateToolbarState(){}_onCancel(){host$.hideKeyboard_(()=>{this._modified?DialogUt.confirmKeySmall_(accessories$,RS.ConfirmDiscard,An.above_(this.element_()),t=>{t&&this.actionCancelConfirmed_()}):this.actionCancelConfirmed_()})}_initialContentOrTemplate(){return MSG.string_(RS.StyleEditorHint)+" {\n  "+this._initialContent+"\n}"}_onOK(t,e,i){var n;if((t=t.trim()).length>=0){if(!CSSParser.hasSingleRuleset_(e))return this.warn_(MSG.string_(RS.StyleEditorExpectingSingleRulesetOnly)),void i(!1);const n=StyleEditor._REGEX.exec(t);if(null==n)return this.warn_(MSG.string_(RS.ErrorParsingStyle)),void i(!1);t=n[1].trim()}null===(n=this._okCallback)||void 0===n||n.call(this,t,i)}onOK_(t){return this._okCallback=t,this}}StyleEditor._REGEX=new RegExp("^.*?\\{(.*)\\}.*?$","s");class CSSEditor extends CSSEditorBase{constructor(t,e,i,n,s,o,l){super(t,i,n,s,o,null),this._gestureHandler=e,this._initialPosition=l}create_(t){const e=this.createFullscreenDialog_(t,t=>this._createFullscreenToolbar(t),t=>this._createFullscreenContent(t));return this._searchSpotlight=new Spotlight(e,DEFUtil.searchHighlightDuration$),e}createFullscreenDialog_(t,e,i){const n=DomBuilderEx.offline_(t.ownerDocument,"table",{class:CSS.AnWindow,style:"display: none; visibility: hidden;"}).push_(),s=n.cursor_();return this._toolbar=e(n.tr_().td_()),i(n.pop_().tr_().td_()),t.append(s),s}show_(){return this._shown?this:(this._shown=!0,An.showHidden_(this._dialog,"block"),this._onWindowResize(()=>this.onResize_()),null!=this._gestureHandler&&this._gestureHandler.pause_(),this._show())}close_(){null!=this._gestureHandler&&(this._gestureHandler.resume_(),this._gestureHandler=null),super.close_()}_createFullscreenToolbar(t){this._mainbar=FullscreenDialogBase.fullscreenToolbarCreator_(t,null,[INPUT.info_(INPUT.LineNumber),BUT.info_(BUT.Spacer),BUT.info_(BUT.Contextmenu),BUT.info_(BUT.RulesetAdd),BUT.info_(BUT.Edit),BUT.info_(BUT.Discard),BUT.info_(BUT.Cancel),BUT.info_(BUT.Save),BUT.info_(BUT.Toolbar1)]),this._mainbar.showButton_(BUT.Edit,this._editable),this._mainbar.showButtons_([BUT.Contextmenu,BUT.RulesetAdd,BUT.Discard,BUT.Save],!1),this._mainbar.onAction_((t,e)=>this._toolbarActions(t,e)),this._mainLineInput=this._mainbar.querySelector_(`${Conf.input}.${CSS.AnLineNumberInput}`),this._searchbar=new Toolbar(t.cursor_(),[INPUT.info_(INPUT.LineNumber),BUT.info_(BUT.Spacer),INPUT.info_(INPUT.SearchBox),BUT.info_(BUT.NextMatch),BUT.info_(BUT.PrevMatch),BUT.info_(BUT.Toolbar2)]),this._searchbar.onAction_((t,e)=>this._toolbarActions(t,e)),this._searchbar.onTooltips_(toasters$.onTooltipsKey_),this._searchbar.hide_(),this._searchbar.element_().style.width="100vw",this._searchLineInput=this._searchbar.querySelector_(`${Conf.input}.${CSS.AnLineNumberInput}`);const e=this._searchbar.querySelector_(`${Conf.input}.${CSS.AnSearchbox}`);return this._searchbox=e,An.onFocus_(e,()=>{toasters$.hideAll_(),An.select_(e)}),An.onKeypress_(e,t=>{"Enter"==t.key&&(An.stopevent_(t),this.actionNextMatch())}),this._setuplinenumber(this._mainLineInput),this._setuplinenumber(this._searchLineInput),this._mainbar}_createFullscreenContent(t){this._content=t.iframe_({seamless:"true",border:"0",sandbox:"allow-same-origin allow-scripts",style:`height: calc(100vh - ${cache$.ui$.toolbarHeight_()}px);`+" width: 100vw; box-sizing: border-box;"+` padding: ${CSSEditor._TOP_MARGIN}px 10px 10px ${CSSEditor._LEFT_MARGIN}px;`,src:PATH._assetsCSSEditorHtml}).cursor_(),An.onLoad_(this._content,()=>{const t=this._initialContentOrTemplate();this._editor=native$.cssEditor_(this._content,t,settings$.fontFaces_(),(t,e)=>{this._onselectionchanged(t,e)}),this._editor[_COF.focus](()=>this._searchOff()),this._editor[_COF.down](()=>this._spotlightOff()),this._editor[_COF.onkeypress](t=>{!t.ctrlKey||"f"!=t.key&&"F"!=t.key||(An.stopevent_(t),t.shiftKey?this._showMainbar():this._showSearchbar())}),null!=this._initialPosition&&this._gotoline1(this._initialPosition[0],this._initialPosition[1]),this._editable&&this._startEdit&&this._onedit()})}_show(){return this.onResize_(),An.setVisible_(this.element_()),this}_initialContentOrTemplate(){return this._initialContent.length>0?this._initialContent:DEF.templateCSSRuleset}_onCancel(){host$.updateSessionPreferences_(jsonOf_(SessionPreferencesKey.filePositions,[this._cpath,this._selection]),t=>{toasters$.warn_(t),this._modified?mainPanel$.onSaveCSS(this._cpath,()=>{this.actionCancelConfirmed_()}):this.actionCancelConfirmed_()})}_onOK(t,e,i){const n=json_();return n[XrefKey.POSITION]=this._selection,host$.saveCSS_(this._cpath,t,n,e=>{toasters$.warn_(e)?i(!1):(this._modified||t==this._initialContent||(this._modified=!0),this._initialContent=t,i(!0))}),this}}class ClientActionInfo{constructor(t){this.json$=t}static of_(t){return null==t?null:new ClientActionInfo(t)}action1_(){const t=JSONUt.string(this.json$,TemplateMenuKey.action,null);if(null==t||0==t.length)return null;const e=t.match(ClientActionInfo._regex);return null==e?t:e[1]}static actionOf_(t){const e=t.split("/");return e.length<1?"":e[0]}action_(){var t,e;const i=null!==(e=null===(t=JSONUt.string(this.json$,TemplateMenuKey.action,null))||void 0===t?void 0:t.split("/"))&&void 0!==e?e:null;if(null==i||i.length<1)return null;let n=i.splice(0,1)[0].split(RX.CommaSeparated);if(i.length<1||n.length<1)return null;const[s,o,l,a]=this._markers(i);return null==s?null:[n,s,o,l,a]}_markers(t){return[CSSUtil.validateClassesOf(t[0]),t.length>1?t[1]:"",t.length>2?t[2]:"",t.length>3?t[3]:""]}classes_(){var t,e;return null!==(e=null===(t=JSONUt.string(this.json$,TemplateMenuKey.classes,null))||void 0===t?void 0:t.split(RX.Spaces).filter(t=>t.length>0))&&void 0!==e?e:null}}ClientActionInfo._regex=RegExp("^(.*?)[/,].*");class _ClientActionAnnotation{constructor(){}static parse_(t){return t?new _ClientActionAnnotation:null}static from_(t){return this.parse_(t)}run_(t,e,i){toasters$.warn_(JsUtil.actionWrapOK_(e))||null==e?null==i||i(e):_WidgetTemplates._annotation(e,native$.getIFrameUri_(),()=>{null==i||i(e)})}}class _ClientActionDelete{constructor(t){this._markers=t}static parse_(t,e,i){return t?e.length<2||0==e[1].length?null:new _ClientActionDelete(i):null}static from_(t,e){return t?With.notnull_(e.action_(),([t,e])=>new _ClientActionDelete(e)):null}run_(t,e,i){const n=native$.getTemplateMarker_(e,null,this._markers),s=_MainPanel._getmarker(n,this._markers);if(null!=s){if(null==n)return toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction),void(null==i||i(null));_Util.confirmSmall_(MSG.format1_(RS.confirmDeletingTemplateInstance,s),DEF.zindexConfirm,t=>{t&&(JsUtil.remove_(n),null==i||i(null))})}}}class _ClientActionDrag{constructor(t){this._markers=t}static parse_(t,e,i){return e.length<2||0==e[1].length?null:new _ClientActionDrag(i)}static from_(t,e){return With.notnull_(e.action_(),([t,e])=>e.length<1?null:new _ClientActionDrag(e))}run_(t,e,i){const n=native$.getTemplateMarker_(e,null,this._markers);if(null!=_MainPanel._getmarker(n,this._markers)){if(null==n)return toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction),void(null==i||i(e));mainPanel$.actionEditSize0_(n,()=>{null==i||i(e)})}}}class _ClientActionMove{constructor(t){this._marker=t}static parse_(t,e,i){return new _ClientActionMove(i.length>0?i[0]:CSS.xDraggable)}static from_(t,e){return With.notnull_(e.action_(),([t,e])=>new _ClientActionMove(e.length>0?e[0]:CSS.xDraggable))}run_(t,e,i){host$.hideKeyboard_(()=>{this._clientActionMove(t),null==i||i(e)})}_clientActionMove(t){let e=this._marker;const i=JsUtil.parentOrSelfWithClasses_(t,[CSS.xDraggable,e]);if(null!=i&&!An.isBodyElement_(i.nodeName)){const t=_MainPanel._resizeInfo(i,!1,!0);if(null!=t&&t.canReposition)return void Timer.sleep1_(()=>{mainPanel$.actionEditSize1_(t)})}toasters$.warnKey_(RS.InvalidSelection)}}class _ClientActionTemplate{constructor(t,e,i){this._markers=t,this._context=e,this._parent=i}static parse_(t,e,i){if(!t)return null;if(e.length<2||0==e[1].length)return null;const n=e.length>2?e[2]:"",s=e.length>3?e[3]:"";return new _ClientActionTemplate(i,n,s)}static from_(t,e){return With.notnull_(t?e.action_():null,([t,e,i,n])=>new _ClientActionTemplate(e,i,n))}run_(t,e,i){const n=native$.iQuery(`[${ATTR.xTemplate}]`,t);if(null==n)return toasters$.warnKey_(RS.InvalidTemplate),void(null==i||i(null));history$.startGroup_(RS.history_templateButtonAction,this._markers.join(" ")),this._insertTemplate(n,e,t=>{history$.endGroup_(),null==i||i(t)})}_insertTemplate(t,e,i){let n=null,s=null,o=null;const l=this._context,a=this._parent;if(null!=e){let t;a.length>0&&!this._markers.includes(a)?(t=Array.from(this._markers)).push(a):t=this._markers,null!=(n=native$.getTemplateMarker_(e,l,this._markers))&&a.length>0&&n.classList.contains(a)?(o=n,n=null):null!=n&&l.length>0&&n.classList.contains(l)?(s=n,n=null):null==n&&a.length>0&&(o=native$.getTemplateMarker_(e,null,[a]))}if(null==n&&null==o&&null==s&&(a.length>0?o=_MainPanel._findMarker(a):l.length>0&&(s=_MainPanel._findMarker(l))),null==n&&null==o&&null!=s&&(a.length>0&&(o=native$.iQuery(`.${a}`,s)),null==o)){const t=this._markers.map(t=>"."+t).join(",");n=native$.iQuery(t,s)}null!=n&&null==o&&a.length>0&&n.classList.contains(a)&&(o=n,n=null);let r=null;if(null!=n?(r=n.parentNode,n=n.nextSibling):null!=o&&(r=o,n=o.firstChild),null==r)return toasters$.warnKey_(RS.TemplateMarkerNotFound),void i(null);const _=native$.cloneTemplate_(t);if(null==_)return void i(null);const c=native$.iQueryAll_(`[${ATTR.xTemplatePlaceholder}]`,_);for(let t=0,e=c.length;t<e;++t){const e=c[t],i=native$.removeAttribute_(e,ATTR.xTemplatePlaceholder);JsUtil.setAttribute_(e,ATTR.xPlaceholder,i)}let h=native$.iQuery(`.${CSS.xPlaceholder}`,_);r.insertBefore(_,n),mainPanel$.processPlaceholders_(c,t=>{null!=t?native$.iRevealNode_(RangeUtil.rangeStart_(t)):null!=h&&null!=h.parentElement&&null!=h.ownerDocument&&(t=native$.iSetCaretAtStart_(h,!0)),i(t)})}}class _ClientActionForm{static from_(t,e){throw new Error("Method not implemented.")}run_(t,e,i){throw new Error("Method not implemented.")}}class WidgetUt{static _createAudio(t,e,i){t.push_().div1_(XX.xxAudio,CSS.xMediaPhoto).push_().ahref_(PATH._assetsImagesSamplesAngels+"?view").img1_(PATH._assetsImagesSamplesAngels,CSS.xImageholder,CSS.xLandscape).peek_().child_("audio",smap_(["src",null!=e?e:PATH._assetsAudioSample],["controls","true"],["preload","metadata"],["class",CSS.xAudio])).attrs_(i).pop_(2)}static _createVideo(t,e,i){t.push_().div1_(XX.xxVideo).child_("video",smap_(["src",null!=e?e:PATH._assetsVideoSample],["class",CSS.xVideo],["controls","true"],["preload","medadata"],[ATTR.xAction,XAction.view])).attrs_(i).pop_()}static _captionWithVideoInfo(t){return t.div1_(CSS.xMediaCaption).indent_(t.push_().div_().indent_(t.peek_().span1_(CSS.xVideoFilename).text_("???"),t.peek_().text_("  "),t.peek_().span1_(CSS.xVideoDuration).text_("??:??"),t.peek_().text_("  "),t.peek_().span1_(CSS.xVideoResolution).text_("?? x ??")),t.pop_().div1_(CSS.xMediaContent).div_().indent_(t.push_().span1_(CSS.xBullet,CSS.xMediaStatus).text_(""),t.peek_().text_(" "),t.pop_().span1_(CSS.xPlaceholder).text_(XXX)))}static _captionWithAudioInfo(t){return t.div1_(CSS.xMediaCaption).indent_(t.push_().div_().indent_(t.peek_().span1_(CSS.xAudioFilename).text_("???"),t.peek_().text_("  "),t.peek_().span1_(CSS.xAudioDuration).text_("??:??"),t.peek_().text_("  "),t.peek_().span1_(CSS.xAudioRate).text_("??"),t.peek_().text_(" "),t.peek_().span1_(CSS.xAudioChannels),t.peek_().text_(" ch")),t.pop_().div1_(CSS.xMediaContent).div_().indent_(t.push_().span1_(CSS.xBullet,CSS.xMediaStatus).text_(""),t.peek_().text_(" "),t.pop_().span1_(CSS.xPlaceholder).text_(XXX)))}}class _ClientActionWidget{constructor(t,e,i,n){this._action=t,this._markers=e,this._context=i,this._parent=n}static from_(t,e){return t?With.notnull_(e.action_(),([t,e,i,n])=>new _ClientActionWidget(t,e,i,n)):null}run_(t,e,i){this._insertWidget(e,t=>{null==i||i(t)})}_insertWidget(t,e){let i=null,n=null,s=null;const o=this._context,l=this._parent;if(null!=t){let e;l.length>0&&!this._markers.includes(l)?(e=Array.from(this._markers)).push(l):e=this._markers,null!=(i=native$.getTemplateMarker_(t,o,this._markers))&&l.length>0&&i.classList.contains(l)?(s=i,i=null):null!=i&&o.length>0&&i.classList.contains(o)?(n=i,i=null):null==i&&l.length>0&&(s=native$.getTemplateMarker_(t,null,[l]))}if(null==i&&null==s&&null==n&&(l.length>0?s=_MainPanel._findMarker(l):o.length>0&&(n=_MainPanel._findMarker(o))),null==i&&null==s&&null!=n&&(l.length>0&&(s=native$.iQuery(`.${l}`,n)),null==s)){const t=this._markers.map(t=>"."+t).join(",");i=native$.iQuery(t,n)}null!=i&&null==s&&l.length>0&&i.classList.contains(l)&&(s=i,i=null);let a=null;if(null!=i?(a=i.parentNode,i=i.nextSibling):null!=s&&(a=s,i=s.firstChild),null==a)return toasters$.warnKey_(RS.TemplateMarkerNotFound),void e(null);const r=this._createWidget(a.ownerDocument);null!=r?(history$.startGroup_(RS.history_templateButtonAction,this._action.join(",")),this._insertWidget1(a,i,r,t=>{history$.endGroup_(),e(t)})):e(null)}_insertWidget1(t,e,i,n){const s=native$.iQueryAll_(`[${ATTR.xPlaceholder}]`,i),o=native$.iQuery(`.${CSS.xPlaceholder}`,i);t.insertBefore(i,e),mainPanel$.processPlaceholders_(s,t=>{null!=t?native$.iRevealNode_(RangeUtil.rangeStart_(t)):null!=o&&null!=o.parentElement&&null!=o.ownerDocument&&(t=native$.iSetCaretAtStart_(o,!0)),n(t)})}_createWidget(t){switch(this._action[1]){case"form":return _ClientActionWidget._createFormWidget(t,this._action[2]);case"media-wall":return _ClientActionWidget._createMediaWallWidget(t,this._action[2]);case"media-sticker":return _ClientActionWidget._createMediaStickerWidget(t,this._action[2]);default:return null}}static _createFormWidget(t,e){return null}static _createMediaStickerWidget(t,e,i=null){const n=(t,e,i)=>{t.div1_(CSS.xSticker,CSS.xStickOnDocument,CSS.xDraggable,CSS.xZTop,XX.xxStyle00,e),i()},s=(t,e,i,s)=>{n(t,e,()=>{t.indent_(t.push_().div1_(CSS.xSubject).indent_(this._clientMoveButton(t.push_()),this._clientZindexStickerButton(t.peek_()),t.pop_(),i()),t.peek_(),s(),t.pop_())})},o=DomBuilderEx.offline_(t,"div");switch(e){case"section":n(o,XX.xxSection,()=>{o.push_().div1_(CSS.xPlaceholder).text_(XXX).pop_()});break;case"text":n(o,XX.xxComment,()=>{o.push_().div1_(CSS.xPlaceholder).text_(XXX).pop_()});break;case"photo":s(o,XX.xxMedia,()=>{o.span_().text_(this._SUBJECT)},()=>{const t=smapOf_("class",`${CSS.xPhoto} ${XX.xxPhoto}`);null==i&&(t[ATTR.xPlaceholder]=Placeholder.xpPhoto),o.div_().indent_(o.push_().div_(t).ahref1_((null!=i?i:PATH._assetsImagesPortraitSample)+"?view").img1_(null!=i?i:PATH._assetsImagesPortraitSample,CSS.xImageholder,CSS.xPortrait),o.pop_().div1_(CSS.xMediaCaption).span1_(CSS.xPlaceholder).text_(XXX))});break;case"image":s(o,XX.xxMedia,()=>{o.span_().text_(this._SUBJECT)},()=>{const t=smapOf_("class",`${CSS.xPhoto} ${XX.xxPhoto}`);null==i&&(t[ATTR.xPlaceholder]=Placeholder.xpImage),o.div_().indent_(o.push_().div_(t).ahref1_((null!=i?i:PATH._assetsImagesPortraitSample)+"?view").img1_(null!=i?i:PATH._assetsImagesPortraitSample,CSS.xImageholder,CSS.xPortrait),o.pop_().div1_(CSS.xMediaCaption).span1_(CSS.xPlaceholder).text_(XXX))});break;case"video-recording":s(o,XX.xxMedia,()=>{o.span_().text_(this._SUBJECT)},()=>{const t=null==i?smapOf_(ATTR.xPlaceholder,Placeholder.xpVideo):smap_();o.div_([ATTR.xPlaceholder,Placeholder.xpVideoinfo]),WidgetUt._createVideo(o,i,t),WidgetUt._captionWithVideoInfo(o)});break;case"video-file":s(o,XX.xxMedia,()=>{o.span_().text_(this._SUBJECT)},()=>{o.div_([ATTR.xPlaceholder,Placeholder.xpVideoinfo]),WidgetUt._createVideo(o,i,{}),WidgetUt._captionWithVideoInfo(o)});break;case"audio-recording":s(o,XX.xxMedia,()=>{o.span_().text_(this._SUBJECT)},()=>{const t=null==i?smapOf_(ATTR.xPlaceholder,Placeholder.xpAudio2):smap_();o.div_([ATTR.xPlaceholder,Placeholder.xpAudioinfo]),WidgetUt._createAudio(o,i,t),WidgetUt._captionWithAudioInfo(o)});break;case"audio-file":s(o,XX.xxMedia,()=>{o.span_().text_(this._SUBJECT)},()=>{o.div_([ATTR.xPlaceholder,Placeholder.xpAudioinfo]),WidgetUt._createAudio(o,i,{}),WidgetUt._captionWithAudioInfo(o)})}const l=new DocumentFragment;return l.appendChild(o.cursor_()),l}static _clientMoveButton(t){t.span_(["class",`${CSS.xFloatRightClearNone} ${CSS.xShowInEdit} fa fa-arrows`],[ATTR.xButton,ClientAction.move])}static _clientZindexStickerButton(t){t.span_(["class",`${CSS.xFloatRightClearNone} ${CSS.xShowInEdit} fa fa-retweet`],[ATTR.xButton,"c/${CSS.xZTop} ${CSS.xZUpper} ${CSS.xZMiddle} ${CSS.xZLower} ${CSS.xZBottom}/${CSS.xSticker}"])}static _createMediaWallWidget(t,e,i=null){function n(t,e,i){const n=t.li1_(XX.xxMedia).cursor_();e(),t.setCursor_(n),i(),t.setCursor_(n)}function s(t){t.div1_(CSS.xMediaCaption).div1_(CSS.xPlaceholder).text_(XXX)}const o=DomBuilderEx.offline_(t,"div");switch(e){case"section":{const t=MSG.string_(RS.Subject);o.div1_(XX.xxSection).push_().indent_(o.push_().div1_(XX.xxHeader).text_(t),o.peek_().div1_(XX.xxSubheader),o.pop_().ul1_(XX.xxMedias)).pop_();break}case"text":o.li1_(XX.xxMedia).push_().div1_(XX.xxComment).div1_(CSS.xPlaceholder).text_(XXX).pop_();break;case"photo":n(o,()=>{o.div_(["class",`${CSS.xPhoto} ${XX.xxPhoto}`],[ATTR.xPlaceholder,Placeholder.xpPhoto]).push_().ahref_(PATH._assetsImagesPortraitSample+"?view").img_(PATH._assetsImagesPortraitSample)},()=>s(o));break;case"image":{const t=smapOf_("class",`${CSS.xPhoto} ${XX.xxPhoto}`);null==i&&(t[ATTR.xPlaceholder]=Placeholder.xpImageNoCaption),n(o,()=>{o.div_(t).push_().ahref_((null!=i?i:PATH._assetsImagesPortraitSample)+"?view").img1_(null!=i?i:PATH._assetsImagesPortraitSample,CSS.xImageholder,CSS.xPortrait)},()=>s(o));break}case"video-recording":n(o,()=>{const t=smapOf_("class",`${CSS.xVideo}`);null==i&&(t[ATTR.xPlaceholder]=Placeholder.xpVideo),o.attr_(ATTR.xPlaceholder,Placeholder.xpVideoinfo),WidgetUt._createVideo(o,i,t)},()=>WidgetUt._captionWithVideoInfo(o));break;case"video-file":n(o,()=>{o.attr_(ATTR.xPlaceholder,Placeholder.xpVideoinfo),WidgetUt._createVideo(o,i,{})},()=>WidgetUt._captionWithVideoInfo(o));break;case"audio-recording":n(o,()=>{o.attr_(ATTR.xPlaceholder,Placeholder.xpAudioinfo).div_(["class",XX.xxAudio]);const t=null==i?smapOf_(ATTR.xPlaceholder,Placeholder.xpAudio2):smap_();WidgetUt._createAudio(o,i,t)},()=>WidgetUt._captionWithAudioInfo(o));break;case"audio-file":n(o,()=>{o.attr_(ATTR.xPlaceholder,Placeholder.xpAudioinfo).div1_(XX.xxAudio),WidgetUt._createAudio(o,i,{})},()=>WidgetUt._captionWithAudioInfo(o))}const l=new DocumentFragment;return l.appendChild(o.cursor_()),l}}_ClientActionWidget._SUBJECT=MSG.string_(RS.Subject);class _ClientActionStyle{constructor(t,e,i,n){this._markers=t,this._singleton=e,this._prefix=i,this._style=n}static parse_(t,e,i){if(e.length<4||0==e[3].length)return null;let n=e[2];const s=e[3];let o="";return n.length>0&&!CSSUtil.validateClass(n)?null:e.length>4&&(o=e[4]).length>0&&!CSSUtil.validateClass(o)?null:new _ClientActionStyle(i,n,s,o)}static from_(t,e){return With.notnull_(e.action_(),([t,e,i,n,s])=>0==n.length?null:s.length>0&&!CSSUtil.validateClass(s)?null:new _ClientActionStyle(e,i,n,s))}run_(t,e,i){Timer.sleep1_(()=>{let t=0==this._markers.length?RangeUtil.rangeStartElement_(e):native$.getTemplateMarker_(e,null,this._markers);if(null==t&&this._singleton.length>0&&(t=_MainPanel._findMarker(this._singleton)),null==t||!JsUtil.isElementWIthName_(t))return toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction),void(null==i||i(e));mainPanel$.isEditing()?(history$.startGroup_(RS.history_templateStyleAction,this._markers.join(" ")),this._styleTemplate(t,this._prefix,this._style,()=>{history$.endGroup_(),null==i||i(e)})):this._styleTemplate(t,this._prefix,this._style,()=>{null==i||i(e)})})}_styleTemplate(t,e,i,n){const s=t,o=s.classList,l=sarray_(),a=0==i.length?[]:[i];e.length>0&&o.forEach(t=>{t.startsWith(e)&&l.push(t)}),native$.removeAddClasses_(s,l,a),n()}}class _ClientActionCycle{constructor(t,e,i,n){this._action=t,this._markers=e,this._contexts=i,this._parent=n}static parse_(t,e,i){if(e.length<3||0==e[1].length||0==e[2].length&&(e.length<4||0==e[3].length||!CSSUtil.validateClass(e[3])))return null;const n=e.length>3?e[3]:"";return new _ClientActionCycle(e[0],i,e[2].trim().split(RX.Spaces).filter(t=>t.length>0),n)}static from_(t,e){return With.notnull_(e.action_(),([t,e,i,n])=>{if(0==i.length&&0==n.length)return null;const s=CSSUtil.validateClassesOf(i);return null==s?null:new _ClientActionCycle(t[0],e,s,n)})}run_(t,e,i){Timer.sleep1_(()=>{mainPanel$.isEditing()?(history$.startGroup_(RS.history_templateCycleAction,this._markers.join(" ")),this._cycleTemplate(e,!0,()=>{history$.endGroup_(),null==i||i(e)})):this._cycleTemplate(e,!0,()=>{null==i||i(e)})})}_cycleTemplate(t,e,i){try{if(0==this._markers.length)return void toasters$.warnKey_(RS.InvalidTemplate);let n=null;if(this._parent.length>0?n=_MainPanel._findMarker(this._parent):this._contexts.length>0&&(n=native$.getTemplateMarker_(t,null,this._contexts)),null==n)return void toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction);const s=n.classList;let o=null,l=this._markers[0];s.forEach(t=>{let e=this._markers.indexOf(t);e<0||(o=t,l=++e==this._markers.length?this._action==TemplateAction.cycle?null:this._markers[0]:this._markers[e])}),native$.removeAddClasses_(n,null==o?null:[o],null==l?null:[l]),e&&toasters$.info_(null==l?MSG.string_(RS.None):l,{attop:!1})}finally{i()}}}class _ClientActionCut{constructor(t,e,i,n){this._action=t,this._markers=e,this._item=i,this._context=n}static parse_(t,e,i){return t?e.length<4||!CSSUtil.validateClass(e[2])||!CSSUtil.validateClass(e[3])?null:new _ClientActionCut(e[0],i,e[2],e[3]):null}static from_(t,e){return t?With.notnull_(e.action_(),([t,e,i,n])=>0==t.length||0==i.length||0==n.length?null:new _ClientActionCut(t[0],e,i,n)):null}run_(t,e,i){try{switch(this._action){case TemplateAction.cutMarked:this._actionCutMarked(this._markers,this._item);break;case TemplateAction.cutNotMarked:this._actionCutNotMarked(this._markers,this._item,this._context);break;default:toasters$.warnKey_(RS.InvalidTemplate)}}finally{null==i||i(null)}}_actionCutNotMarked(t,e,i){if(native$.iGetMetaVersion_()<2)return void toasters$.warn_(MSG.format1_(RS.ActionRequireDocumentVersion_0_OrAbove,"2"));const n=native$.iQueryAll_(`.${i}`),s=[];for(const i of n){let n=null,o=i;for(;null!=o;o=o.parentElement){const i=An.classlist_(o);if(i.contains_(e)){if(i.containsAll_(...t)){n=null;break}n=o}else if(i.contains_(CSS.xRightSidebarContent)){n=null;break}if("BODY"==o.nodeName)break}null!=n&&s.push(n)}const o=s.length;if(0==o)return void toasters$.warnKey_(RS.NoItemFound);native$.iClearSelection_(),native$.iSelectMulti_(s);const l=MSG.format1_(RS.cut0ItemsToClipboard,`${o}`);DialogUt.confirm_(accessories$,l,t=>{if(!t)return;const e=s[0].parentNode;null!=e&&(history$.group_(RS.Tooltips_CutNotDone,"",()=>{const t=JsUtil.getContextHtml_(e);clipboard$.dom_(native$.serializeCutAll_(t,s),t),_MainPanel._recalculateTotals()}),native$.iClearSelection_(),toasters$.ok_(l+" "+MSG.string_(RS.OK)))}).show_()}_actionCutMarked(t,e){const i=native$.iQueryAll_(`.${e}.${t.join(".")}`),n=new Array;for(const t of i){let e=!0;for(let i=t.parentElement;null!=i;i=i.parentElement){if(i.classList.contains(CSS.xRightSidebarContent)){e=!1;break}if("BODY"==i.nodeName)break}e&&n.push(t)}const s=n.length;if(0==s)return void toasters$.warnKey_(RS.NoItemFound);native$.iClearSelection_(),native$.iSelectMulti_(n);const o=MSG.format1_(RS.cut0ItemsToClipboard,`${s}`);DialogUt.confirm_(accessories$,o,t=>{if(!t)return;const e=n[0].parentNode;null!=e&&(history$.group_(RS.Tooltips_CutDone,"",()=>{const t=JsUtil.getContextHtml_(e);clipboard$.dom_(native$.serializeCutAll_(t,n),t),_MainPanel._recalculateTotals()}),native$.iClearSelection_(),toasters$.ok_(o+" "+MSG.string_(RS.OK)))}).show_()}}class _ClientActionRadio{constructor(t,e,i){this._markers=t,this._on=e,this._off=i}static parse_(t,e,i){return e.length<2||2!=i.length?null:new _ClientActionRadio(i,i[0],i[1])}static from_(t,e){return With.notnull_(e.action_(),([t,e])=>2!=e.length?null:new _ClientActionRadio(e,e[0],e[1]))}run_(t,e,i){Timer.sleep1_(()=>{mainPanel$.isEditing()?(history$.startGroup_(RS.history_templateRadioAction,this._markers.join(" ")),this._radioTemplate(t,!1,t=>{history$.endGroup_(),null==i||i(t)})):this._radioTemplate(t,!1,t=>{null==i||i(t)})})}_radioTemplate(t,e,i){try{const n=this._on,s=this._off;let o=null,l=null,a=null;t:for(let e=t;null!=e;e=e.parentElement){const t=e.classList;for(const i of this._markers)if(t.contains(i)){l=e,a=i;break t}}if(null==l||An.isHtmlElement_(l.nodeName))return void toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction);if(null==(o=l.parentNode))return void toasters$.warnKey_(RS.PleaseSelectAnItemForTheAction);if(JsUtil.toggleClasses_(l,this._markers),a==n)return void(e&&toasters$.info_(s,{attop:!1}));for(let t=o.firstElementChild;null!=t;t=t.nextElementSibling)t!=l&&t.classList.contains(n)&&An.classlist_(t).remove_(n).add_(s);e&&toasters$.info_(n,{attop:!1})}finally{i(native$.iSelectNode_(t,null,!0))}}}class _ClientActionBlog{constructor(t){this._next=t}static parse_(t,e){return t?null:2!=e.length||"next"!=e[1]&&"prev"!=e[1]?null:new _ClientActionBlog("next"==e[1])}static from_(t,e){return t?null:With.notnull_(e.action_(),([t,e])=>{if(0==e.length)return null;const i=e[0];return"next"!=i&&"prev"!=i?null:new _ClientActionBlog("next"==i)})}run_(t,e,i){const n=()=>{toasters$.warnKey_(RS.ActionOnlyWorksWhenCurrentDocumentIsABlogPage)},s=native$.getIFrameContextPath_(),o=null==s?void 0:s.match(_ClientActionBlog._regex);if(null==o)return n();const l=An.parseInt_(o[2],null),a=An.parseInt_(o[3],null),r=An.parseInt_(o[5],null);if(null==l||null==a||null==r)return n();host$.findBlog_(l,a,r,this._next,t=>{if(toasters$.warn_(t))return;const e=t[Key.result];null!=e&&_Util.onSaveOrDiscard_(()=>{_Util.browseFile_(e,null,!1)})})}}_ClientActionBlog._regex=RegExp("^(.*?/blog/)(\\d+)/(\\d+)/(\\d+/)?(\\d+)\\.html$");class _ClientActionClasses{constructor(t){this._classes=sarray_();for(const e of t)this._classes.includes(e)||this._classes.push(e)}static parse_(t,e){return t?new _ClientActionClasses(e):null}static from_(t,e){return t?With.notnull_(e.action_(),([t,e])=>new _ClientActionClasses(e)):null}run_(t,e,i){if(null==e)return toasters$.warnKey_(RS.ActionRequireAValidSelection),void(null==i||i(null));let n=native$.getSingleSelectedOrCollapsedElementOfRange_(e),s=null,o=!0;if(null!=n&&n.nodeType==Node.ELEMENT_NODE?(s=n,e.collapsed&&(e=native$.iSelectNode_(s))):o=RangeUtil.isTextSelection_(e),!o)return toasters$.warnKey_(RS.InvalidSelection),void(null==i||i(e));let l=t.getBoundingClientRect();toasters$.info_((null==s?"":_JsUtil.elementInfo_(s)+"\n")+MSG.string_(RS.ClientActionClassesDeleteTooltips),{attop:!1});const a=null==s?[]:Array.from(s.classList);new CSSClassesContextmenu(accessories$,ArrayUt.unique_([...this._classes,...a]).sort(),a,n=>{if(toasters$.hideInfo_(),0!=n.length){if(!CSSUtil.validateClass(n))return toasters$.warnKey_(RS.InvalidCSSClassName),void(null==i||i(e));history$.group_(RS.ClientActionClassesTitle,n,()=>{if(null==s){if(null!=e){const t=RangeUtil.wrapRange_("span",{class:n},e);e=native$.iSelectNode_(t)}}else{const t=s.classList;t.contains(n)?t.remove(n):t.add(n)}}),ArrayUt.delete_(this._classes,n),this._classes.length>=DEF.maxClientActionClassesLength&&this._classes.shift(),this._classes.push(n),t.setAttribute(ATTR.xTemplate,`${TemplateAction.classes}/${this._classes.join(" ")}`),null==i||i(e)}}).onCancel_(()=>toasters$.hideInfo_()).show_(l.x,l.y,!0)}}class _ClientActionPostAlarm{constructor(){}static parse_(t,e){return t?new _ClientActionPostAlarm:null}static from_(t,e){return t?new _ClientActionPostAlarm:null}run_(t,e,i){if(null==e)return toasters$.warnKey_(RS.ActionRequireAValidSelection),void(null==i||i(null));_ClientActionPostAlarm.post_(e,t=>{if(!t)return toasters$.warnKey_(RS.TodoItemNotFound),void(null==i||i(null));null==i||i(e)})}static post_(t,e){const i=native$.getSingleSelectedOrCollapsedElementOfRange_(t);let n=null;if(null!=i){const t=DomUt.queryAll_(i,`li.${XX.xxTodo}, li.${CSS.xWidgetTodo}, tr.${XX.xxTodo}`);if(t.length>0)return void this._post(t,e);n=JsUtil.parentOrSelf_(i,t=>{const e=t.nodeName,i=t.classList;return"LI"==e&&(i.contains(XX.xxTodo)||i.contains(CSS.xWidgetTodo))||"TR"==e&&i.contains(XX.xxTodo)})}null!=i&&null!=n?this._post([n],e):e(!1)}static _post(t,e){sidePanel$.showEventsPanel_(i=>{null!=i?An.iterateList_(t,(t,e,n)=>{_ClientActionPostAlarm._post1(i,t,()=>n(!1))},()=>{e(!0)}):toasters$.warnKey_(RS.ActionNotPermitted)})}static _post1(t,e,i){var n,s,o,l;let a=null;if(null==(a="TR"==e.nodeName?this._fromShopping(e):e.classList.contains(CSS.xWidgetTodo)?this._fromTodoWidget(e):this._fromTodoItem(e)))return void i();const r=An.parseJSONObjectOrNull_(e.getAttribute(ATTR.AnInfo));if(null!=r){const t=r[EventKey.Color];if(An.isempty_(t)||(a[EventKey.Color]=t),!0===a[EventKey.Done]){const t=null!==(n=r[EventKey.DoneMs])&&void 0!==n?n:null;null!=t&&(a[EventKey.DoneMs]=t)}}const _=null===(s=this._getrole(e,EventKey.Url))||void 0===s?void 0:s.textContent;if(null!=_&&_.length>0)a[EventKey.Url]=_;else{const t=a[EventKey.Id],i=native$.getIFrameUri_();if(null!=i){let n=null!==(l=null!==(o=e.id)&&void 0!==o?o:e.getAttribute("name"))&&void 0!==l?l:"";0==n.length&&(e.setAttribute("name",t),n=t),a[EventKey.Url]=`${i.encodedPath$}#${n}`}}const c=new EventInfo(a);null==t||t.promptAlarm_(c,i)}static _fromShopping(t){const e=this._getDone(t),i=DomUt.query_(t,`td.${XX.xxDesc}`),n=this._getDate(i,`.${XX.xxDate}[${ATTR.xFormat}]`),s=this._getDesc(i),o=this._getRepeat(i);return json_([EventKey.Done,e],[EventKey.Id,_AlarmUtil.createId_()],[EventKey.Ms,n],[EventKey.Repeat,o],[EventKey.Description,s])}static _fromTodoItem(t){var e,i;const n=this._getDate(t,`.${XX.xxHighlight}[${ATTR.xFormat}]`),s=this._getRepeat(t),o=null!==(i=null===(e=DomUt.query_(t,`span.${XX.xxHighlight}`))||void 0===e?void 0:e.textContent)&&void 0!==i?i:"";return json_([EventKey.Done,this._getDone(t)],[EventKey.Id,_AlarmUtil.createId_()],[EventKey.Ms,n],[EventKey.Repeat,s],[EventKey.Description,o])}static _fromTodoWidget(t){var e,i,n;const s=this._getDate(t,`.${XX.xxDate}[${ATTR.xFormat}]`),o=null!==(n=null===(i=null!==(e=DomUt.query_(t,`[${ATTR.xRole}~='${EventKey.Description}']`))&&void 0!==e?e:DomUt.query_(t,`span.${CSS.xWidgetTodoSubject}`))||void 0===i?void 0:i.textContent)&&void 0!==n?n:"",l=this._getRepeat(t);return json_([EventKey.Done,this._getDone(t)],[EventKey.Id,_AlarmUtil.createId_()],[EventKey.Ms,s],[EventKey.Description,o],[EventKey.Repeat,l])}static _getDone(t){var e;const i=t.classList;if(i.contains(XX.xxDone)||i.contains(CSS.xTodoDone)){return(null!==(e=t.getAttribute(ATTR.xRole))&&void 0!==e?e:"").split(RX.Spaces).includes(EventKey.Done)}return!1}static _getDate(t,e){var i;if(null!=t){if(null!=(null!==(i=this._getrole(t,EventKey.Ms))&&void 0!==i?i:DomUt.query_(t,e))){const e=t.getAttribute(ATTR.xFormat);if(null!=e){const t=e.split(";");if(t.length>=3){const e=An.parseInt_(t[2],null);if(null!=e)return e}}}}return DateTime.ms_()}static _getDesc(t){var e;if(null!=t){let i=null===(e=this._getrole(t,EventKey.Description))||void 0===e?void 0:e.textContent;if(null!=i)return i;i="";for(const e of Array.from(t.childNodes))e.nodeType==Node.TEXT_NODE&&(i+=e.nodeValue);return i}return""}static _getRepeat(t){var e,i,n;if(null!=t){let s=null!==(e=this._getrole(t,EventKey.Repeat))&&void 0!==e?e:DomUt.query_(t,`.${CSS.xBulletFa}.fa-bell-o`);if(null==s){const e=DomUt.queryAll_(t,`li.${CSS.xList} span.${CSS.xBullet}`);for(const t of e)if(""==(null===(i=t.textContent)||void 0===i?void 0:i.trim())){const e=t.nextElementSibling;if("SPAN"==(null==e?void 0:e.nodeName)){s=e;break}}}if(null!=s){const t=null!==(n=s.textContent)&&void 0!==n?n:"";for(const e of EventRepeat.values)if(t.toLowerCase().startsWith(e.toLowerCase()))return e}}return EventRepeat.Once}static _getrole(t,e){return DomUt.query_(t,`[${ATTR.xRole}~='${e}']`)}}class _TemplateAction{static parse_(t){let e=null==t?void 0:t.trim();if(null==e||0==e.length)return null;if(e.startsWith("{"))return this.clientActionFrom_(ClientActionInfo.of_(An.parseJSONObjectOrNull_(e)));const i=e.split("/").map(t=>t.trim());if(i.length<1)return null;let n=sarray_();if(i.length>1&&i[1].length>0&&(n=i[1].split(RX.Spaces).filter(t=>t.length>0),!CSSUtil.validateClasses(n)))return null;const s=mainPanel$.isEditing();switch(i[0]){case TemplateAction.annotation:return _ClientActionAnnotation.parse_(s);case TemplateAction.delete:return _ClientActionDelete.parse_(s,i,n);case TemplateAction.drag:return _ClientActionDrag.parse_(s,i,n);case TemplateAction.template:return _ClientActionTemplate.parse_(s,i,n);case TemplateAction.style:return _ClientActionStyle.parse_(s,i,n);case TemplateAction.cycle:case TemplateAction.cycle1:return _ClientActionCycle.parse_(s,i,n);case TemplateAction.cutMarked:case TemplateAction.cutNotMarked:return _ClientActionCut.parse_(s,i,n);case TemplateAction.radio:return _ClientActionRadio.parse_(s,i,n);case TemplateAction.move:return _ClientActionMove.parse_(s,i,n);case TemplateAction.blog:return _ClientActionBlog.parse_(s,i);case TemplateAction.classes:return _ClientActionClasses.parse_(s,n);case TemplateAction.postAlarm:return _ClientActionPostAlarm.parse_(s,n);default:return null}}static clientActionFrom_(t){return null==t?null:With.notnull_(null==t?void 0:t.action1_(),e=>{const i=mainPanel$.isEditing();switch(e){case TemplateAction.annotation:return _ClientActionAnnotation.from_(i);case TemplateAction.delete:return _ClientActionDelete.from_(i,t);case TemplateAction.drag:return _ClientActionDrag.from_(i,t);case TemplateAction.template:return _ClientActionTemplate.from_(i,t);case TemplateAction.style:return _ClientActionStyle.from_(i,t);case TemplateAction.cycle:case TemplateAction.cycle1:return _ClientActionCycle.from_(i,t);case TemplateAction.cutMarked:case TemplateAction.cutNotMarked:return _ClientActionCut.from_(i,t);case TemplateAction.radio:return _ClientActionRadio.from_(i,t);case TemplateAction.move:return _ClientActionMove.from_(i,t);case TemplateAction.blog:return _ClientActionBlog.from_(i,t);case TemplateAction.classes:return _ClientActionClasses.from_(i,t);case TemplateAction.postAlarm:return _ClientActionPostAlarm.from_(i,t);case TemplateAction.form:return _ClientActionForm.from_(i,t);case TemplateAction.widget:return _ClientActionWidget.from_(i,t);default:return null}})}}class _State{constructor(t){this._name=t}isEditing(){return this==_State.EDITING}toString(){return this._name}}_State.INVALID=new _State("INVALID"),_State.BROWSING=new _State("BROWSING"),_State.IMAGE=new _State("IMAGE"),_State.AUDIO=new _State("AUDIO"),_State.EDITING=new _State("EDITING"),_State.PDF=new _State("PDF"),_State.VIDEO=new _State("VIDEO");let _state=_State.BROWSING;class MainToolbarActions{}MainToolbarActions._BACK="Xr4",MainToolbarActions._GAME_SUDOKU="XWP",MainToolbarActions._SEARCHBAR="XIP",MainToolbarActions._SYSTEMBAR_TOOLBAR="XIg",MainToolbarActions._TOOLBAR_RECORDING="XYo",MainToolbarActions._SEARCH_PREV="XAS",MainToolbarActions._SELECT="XLx",MainToolbarActions._SPACER="XuJ",MainToolbarActions._SEARCHBAR_PLAYBACK="XzJ",MainToolbarActions._SYSTEM_RESTORE="XeC",MainToolbarActions._EDITINGMENU="XLg",MainToolbarActions._GAME_MINES="X6v",MainToolbarActions._EDIT_NODE="X0G",MainToolbarActions._SYSTEM_PRINT="XRQ",MainToolbarActions._SYSTEMBAR_PLAYBACK="XgN",MainToolbarActions._LOGIN="X88",MainToolbarActions._SYSTEM_GAMES="Xx8",MainToolbarActions._SEARCH_NEXT="XZf",MainToolbarActions._SEARCH_REPLACE="XWh",MainToolbarActions._IMAGE_MENU="XBL",MainToolbarActions._CANCEL="Xwr",MainToolbarActions._LOGOUT="XD0",MainToolbarActions._FORWARD="XlW",MainToolbarActions._TOOLBAR_PLAYBACK="X0q",MainToolbarActions._TOOLBAR_TOOLBAR="X48",MainToolbarActions._SYSTEM_CHANGE_PASSWORD="X6V",MainToolbarActions._FULLSCREEN="XQm",MainToolbarActions._SEARCH_IGNORECASE="X3v",MainToolbarActions._IMAGE_ROTATE="X6R",MainToolbarActions._SYSTEMBAR_RECORDING="Xqh",MainToolbarActions._HOME="XVe",MainToolbarActions._SYSTEM_FACTORY_RESET="XRE",MainToolbarActions._SYSTEM_MANAGE_BACKUP_KEYS="XGBK",MainToolbarActions._SEARCHBAR_RECORDING="XhF",MainToolbarActions._TOGGLE_LEFTSIDEPANEL="XYb",MainToolbarActions._SAVE="X1R",MainToolbarActions._SEARCHBAR_TOOLBAR="XF8",MainToolbarActions._EDIT="Xfh",MainToolbarActions._SYSTEM_BACKUP="XEz",MainToolbarActions._SYSTEMBAR="XkK",MainToolbarActions._SYSTEM_CONTEXTMENU="XJ0",MainToolbarActions._SYSTEM_RESET_USER_SETTINGS="Xnv",MainToolbarActions._GAME_MINDS="Xt5";class _MainToolbar{constructor(t){this._matcher=null,this._buttons=new Map,this._toolbarButtons=new Map,this._tooltipsShown=!1,this._enabled=!1,this._clickTime=0,this._tooltipsTimer=null,this._clickTimer=null,this._enableTimer=null;const e=DomBuilderEx.offline_(document,"div").push_();this._mainbar=e.peek_().div_({class:CSS.AnToolbar,style:"padding-left: 12px;"}).push_().cursor_(),this._toolbar=this._mainbar,_MainToolbar._createtoolbarbuttons(e,this._buttons,this._toolbarButtons,!1,[MainToolbarActions._TOGGLE_LEFTSIDEPANEL,MainToolbarActions._TOOLBAR_RECORDING,MainToolbarActions._TOOLBAR_PLAYBACK,MainToolbarActions._SPACER,MainToolbarActions._EDITINGMENU,MainToolbarActions._EDIT_NODE,MainToolbarActions._BACK,MainToolbarActions._FORWARD,MainToolbarActions._SELECT,MainToolbarActions._IMAGE_ROTATE,MainToolbarActions._CANCEL,MainToolbarActions._SAVE,MainToolbarActions._EDIT,MainToolbarActions._HOME,MainToolbarActions._IMAGE_MENU,MainToolbarActions._TOOLBAR_TOOLBAR]),this._searchbar=e.peek_().div_({class:CSS.AnToolbar,style:"padding-left: 12px;display:none"}).push_().cursor_(),_MainToolbar._createtoolbarbuttons(e.peek_(),this._buttons,null,!0,[MainToolbarActions._TOGGLE_LEFTSIDEPANEL,MainToolbarActions._SEARCHBAR_RECORDING,MainToolbarActions._SEARCHBAR_PLAYBACK,MainToolbarActions._SPACER]),this._searchbox=e.peek_().child_(Conf.input,json_(["class",CSS.AnSearchbox],["rows","1"],["placeholder",MSG.string_(RS.Tooltips_Search)],["tabindex","1"],[ATTR.autocapitalize,"none"],[ATTR.autocomplete,"off"],[ATTR.autocorrect,"off"],[ATTR.spellcheck,"false"])).cursor_(),_MainToolbar._createtoolbarbuttons(e.peek_(),this._buttons,null,!0,[MainToolbarActions._SEARCH_IGNORECASE,MainToolbarActions._SEARCH_NEXT,MainToolbarActions._SEARCH_PREV,MainToolbarActions._SEARCHBAR_TOOLBAR]),this._systembar=e.peek_().div_({class:CSS.AnToolbar,style:"padding-left: 12px;display:none"}).push_().cursor_(),_MainToolbar._createtoolbarbuttons(e.peek_(),this._buttons,null,!0,[MainToolbarActions._TOGGLE_LEFTSIDEPANEL,MainToolbarActions._SYSTEMBAR_RECORDING,MainToolbarActions._SYSTEMBAR_PLAYBACK,MainToolbarActions._SPACER]),_MainToolbar._createtoolbarbuttons(e,this._buttons,null,!0,[MainToolbarActions._SYSTEM_CONTEXTMENU,MainToolbarActions._SYSTEM_RESTORE,MainToolbarActions._SYSTEM_BACKUP,MainToolbarActions._SYSTEM_PRINT,MainToolbarActions._SYSTEMBAR_TOOLBAR]),this._setup(t)}_setup(t){new DomBuilderEx(t).empty_().appendNodes_(this._mainbar).appendNodes_(this._searchbar).appendNodes_(this._systembar),An.onFocus_(this._searchbox,()=>{this._matcher=_MainToolbar._createSearchMatcher(),toasters$.hideAll_(),An.select_(this._searchbox)}),An.onClick_(this._searchbox,t=>{An.stopevent_(t),this._searchbox.blur(),this._searchbox.focus()}),An.onKeypress_(this._searchbox,t=>{"Enter"==t.key&&(An.stopevent_(t),this._searchNext())}),An.onInput_(this._searchbox,()=>{this._actionIncrementalSearch(null)}),this._matcher=null,An.onClick_(t,t=>{An.stopevent_(t);const e=DomUt.matchingTarget_(t,`div[${ATTR.AnAction}]`);if(null==e||!this._enabled||e.classList.contains(CSS.AnDisabled))return native$.iClearSelection_(),host$.hideKeyboard_(),void(null==e&&this._tryDoubleClick());const i=e.getAttribute(ATTR.AnAction);null!=i&&i.length>0&&this._toolbarActions(i,e,t)}),An.addEventListenerMatching_(t,Conf.touchstart,`div[${ATTR.xTooltips}]`,(t,e)=>{this._stopTooltipsTimer(),this._tooltipsShown=!1,this._tooltipsTimer=new Timer(DEFUtil.durationTooltips$,()=>{this._tooltipsTimer=null,this._tooltipsShown=!0,toasters$.onTooltipsKey_(t,e)})}),An.onTouchEnd_(t,t=>{this._stopTooltipsTimer(),this._tooltipsShown&&(this._tooltipsShown=!1,An.stopevent_(t))}),this.updateAudioStatus_(),Conf.useFlash&&new Flash(t,`div.${CSS.AnButton}`,CSS.AnFlashLowlight,DEFUtil.flashDuration)}button(t){var e;return null!==(e=this._buttons.get(t))&&void 0!==e?e:null}_tryDoubleClick(){var t;0==this._clickTime?(this._clickTime=An.ms_(),this._clickTimer=new Timer(DEFUtil.doubleClickDuration$,()=>{this._clickTimer=null,this._clickTime=0})):(null===(t=this._clickTimer)||void 0===t||t.cancel_(),this._clickTimer=null,this._clickTime=0,this._doubleClick())}_doubleClick(){if(mainPanel$.isBrowsing()||mainPanel$.isEditing()){const t=native$.iQuery(`.${CSS.xRoot}`);if(null!=t)if(0!=t.scrollTop)t.scrollTop=0;else{const e=t.scrollHeight-window.innerHeight+cache$.ui$.toolbarHeight_();e>0&&(t.scrollTop=e)}}}_stopTooltipsTimer(){var t;null===(t=this._tooltipsTimer)||void 0===t||t.cancel_(),this._tooltipsTimer=null}updateAudioStatus_(){host$.getAudioStatus_(t=>{this.updateAudioStatus1_(t)})}updateAudioStatus1_(t){var e,i;const n=t[Key.text];null!=n&&toasters$.ok_(n,{attop:!0});const s=t[Key.recorder];if(null!=s){const t=null!==(e=s[Key.status])&&void 0!==e&&e;for(const e of[MainToolbarActions._TOOLBAR_RECORDING,MainToolbarActions._SEARCHBAR_RECORDING,MainToolbarActions._SYSTEMBAR_RECORDING])this._show(e,t)}const o=t[Key.player];if(null!=o){const t=null!==(i=o[Key.status])&&void 0!==i&&i;for(const e of[MainToolbarActions._TOOLBAR_PLAYBACK,MainToolbarActions._SEARCHBAR_PLAYBACK,MainToolbarActions._SYSTEMBAR_PLAYBACK])this._show(e,t)}}static _createtoolbarbuttons(t,e,i,n,s){for(const o of s)if(o==MainToolbarActions._SPACER)t.peek_().div_({style:"flex:1 1 auto;"});else{const s=_MainToolbar._BUTTONS[o],l=smap_([ATTR.AnAction,o],["class",s.class],[ATTR.xTooltips,s[ATTR.xTooltips]]);n||(l.style="display:none"),t.peek_().div_(l),e.set(o,t.cursor_()),null!=i&&i.set(o,t.cursor_())}}setEnabled(t){null!=this._enableTimer&&(this._enableTimer.cancel_(),this._enableTimer=null),this._enabled=t,t||(this._enableTimer=new Timer(5e3,()=>{this._enabled=!0,this._enableTimer=null}))}_show(t,e){const i=this._buttons.get(t);if(void 0===i)throw new Error(MSG.string1_(RS.NotFound_,t));e?An.show_(i):An.hide_(i)}_setButtonEnable(t,e){const i=this._buttons.get(t);if(void 0===i)throw new Error(MSG.string1_(RS.NotFound_,t));e?i.classList.remove(CSS.AnDisabled):i.classList.add(CSS.AnDisabled)}onresize(){}onStateChange(){for(const[t,e]of this._toolbarButtons.entries()){const i=_MainToolbar._BUTTONS[t].enable;null!=i&&(i.indexOf(_state)>=0?An.show_(e):An.hide_(e))}this.showMainbar_(),_state==_State.BROWSING&&(null!=docInfo$&&docInfo$.hasInfo$&&docInfo$.fileInfo$.writable$?this._setButtonEnable(MainToolbarActions._EDIT,!0):this._setButtonEnable(MainToolbarActions._EDIT,!1),this._updateToolbarStatus(mainPanel$.isLoggedIn())),this._updateToolbarPrintStatus(mainPanel$.canPrint())}_searchPrev(){An.toggleButtonOff_(this._buttons.get(MainToolbarActions._SEARCH_NEXT)),An.toggleButtonOn_(this._buttons.get(MainToolbarActions._SEARCH_PREV)),this._resetAnchor(),host$.hideKeyboard_(()=>{this._actionIncrementalSearch(null)})}_searchNext(){An.toggleButtonOn_(this._buttons.get(MainToolbarActions._SEARCH_NEXT)),An.toggleButtonOff_(this._buttons.get(MainToolbarActions._SEARCH_PREV)),this._resetAnchor(),host$.hideKeyboard_(()=>{this._actionIncrementalSearch(null)})}_toolbarActions(t,e,i){switch(toasters$.hideAll_(),t){case MainToolbarActions._SEARCH_IGNORECASE:An.toggleOnOffButton_(this._buttons.get(MainToolbarActions._SEARCH_IGNORECASE));break;case MainToolbarActions._SEARCH_PREV:this._searchPrev();break;case MainToolbarActions._SEARCH_NEXT:this._searchNext();break;case MainToolbarActions._TOOLBAR_TOOLBAR:this.showSearchbar_();break;case MainToolbarActions._SEARCHBAR_TOOLBAR:mainPanel$.isEditing()?this.showMainbar_():this._showSystembar();break;case MainToolbarActions._SYSTEMBAR_TOOLBAR:this.showMainbar_();break;default:mainPanel$.toolbarActions_(i,e,t)}}showMainbar_(){this._toolbar!=this._mainbar&&(An.hide_(this._searchbar),An.hide_(this._systembar),An.show_(this._mainbar),this._toolbar=this._mainbar,this.updateAudioStatus_())}toggleSearchbar_(t){var e,i;sidePanel$.isShown_()||(An.stopevent_(t),t.shiftKey?null===(e=null==mainPanel$?void 0:mainPanel$._mainToolbar)||void 0===e||e.showMainbar_():null===(i=null==mainPanel$?void 0:mainPanel$._mainToolbar)||void 0===i||i.showSearchbar_())}showSearchbar_(){this._toolbar!=this._searchbar&&(An.hide_(this._mainbar),An.hide_(this._systembar),An.show_(this._searchbar),this._toolbar=this._searchbar);const t=native$.getIFrameSelectionRange_();if(null!=t&&!t.collapsed){const e=t.toString();null!=e&&e.length>0&&(this._searchbox.value=e.trim())}this._searchbox.focus()}_showSystembar(){this._toolbar!=this._systembar&&(An.hide_(this._mainbar),An.hide_(this._searchbar),An.show_(this._systembar),this._toolbar=this._systembar,this._updateToolbarPrintStatus(mainPanel$.canPrint()))}_updateToolbarStatus(t){this._show(MainToolbarActions._SYSTEM_CONTEXTMENU,!0),this._show(MainToolbarActions._SYSTEM_BACKUP,!0),this._show(MainToolbarActions._SYSTEM_RESTORE,!0)}_updateToolbarPrintStatus(t){this._show(MainToolbarActions._SYSTEM_PRINT,t)}_resetAnchor(){null==this._matcher?this._matcher=_MainToolbar._createSearchMatcher():this._matcher.setAnchor(native$.getIFrameSelectionRange_())}static _createSearchMatcher(){const t=native$.getIFrameBody_();if(null==t)return null;let e=native$.getValidIFrameSelectionRange_();return null==e&&(e=native$.iSelectNode_(t,!0)),new SearchMatcher(t,e)}_actionIncrementalSearch(t){try{if(searchSpotlight$.hide_(),toasters$.hideAll_(),null==this._matcher&&(this._matcher=_MainToolbar._createSearchMatcher()),null==this._matcher)return;const e=this._matcher;let i=this._searchbox.value;const n=i.length;if(0==n){const t=e.getAnchor();return void native$.iSelectRange_(t,!0)}const s=!An.isButtonOff_(this._buttons.get(MainToolbarActions._SEARCH_IGNORECASE)),o=An.isButtonOff_(this._buttons.get(MainToolbarActions._SEARCH_NEXT));let l;s?(l=e.getLowerCaseText(),i=i.toLowerCase()):l=e.getText();const a=l.length;let r=e.getAnchorOffset(o);const _=[];null==r&&(o?(_.push(MSG.string_(RS.SearchFromEnd)),r=a):(_.push(MSG.string_(RS.SearchFromStart)),r=0)),o&&--r;const c=i[0],h=o?-1:1;t:for(let s=r;s<a&&s>=0;s+=h)if(l[s]==c){for(let t=1;t<n&&s+t<a;++t)if(l[s+t]!=i[t])continue t;const o=e.getRangeOf(s,s+n);if(null==o)continue;const r=o.commonAncestorContainer;return _MainPanel._revealHierarchy(r),native$.iSelectRange_(o,!0,t),null==r||native$.isVisible_(r)?null!=o&&(this._showSelection(o),_.length>0&&_.push(MSG.string_(RS.MatchFound))):_.push(MSG.string_(RS.MatchFoundButNotVisible)),void(_.length>0&&toasters$.info_(_,{attop:!1}))}native$.iClearSelection_(),_.push(MSG.string_(o?RS.ReachedStartOfDocument:RS.ReachedEndOfDocument)),_.push(MSG.string_(RS.NoMatchFound)),toasters$.warn_(_,{attop:!1})}catch(t){}}_showSelection(t){}onIFrameLoad(t){this._matcher=null,null!=t&&t.path$==PathUtil.getHomeDir(mainPanel$.isLoggedIn())+"index.html"?++_MainToolbar._homeCount:_MainToolbar._homeCount=0,this.onStateChange(),native$.iAddEventListener_(native$.getIFrameWindow_(),"keypress",t=>{var e;const i=t;if(i.ctrlKey)switch(i.key){case"f":case"F":null===(e=null==mainPanel$?void 0:mainPanel$._mainToolbar)||void 0===e||e.toggleSearchbar_(i);break;case"i":case"I":i.shiftKey&&(An.stopevent_(i),host$.showDeveloperTools_());break;case"w":case"W":case"r":case"R":i.stopImmediatePropagation(),An.stopevent_(i)}},!0,!0),this.setEnabled(!0)}onIFrameUnload(){searchSpotlight$.hide_(),this._matcher=null,this.setEnabled(!1)}}_MainToolbar._BUTTONS=json_([MainToolbarActions._TOOLBAR_TOOLBAR,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEllipsisH}`],[ATTR.xTooltips,RS.Tooltips_Toolbar],["enable",[_State.BROWSING,_State.EDITING]])],[MainToolbarActions._SEARCHBAR_TOOLBAR,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEllipsisH}`],[ATTR.xTooltips,RS.Tooltips_Toolbar],["enable",[_State.BROWSING,_State.EDITING]])],[MainToolbarActions._SYSTEMBAR_TOOLBAR,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEllipsisH}`],[ATTR.xTooltips,RS.Tooltips_Toolbar],["enable",[_State.BROWSING,_State.EDITING]])],[MainToolbarActions._EDITINGMENU,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaToggleDown}`],[ATTR.xTooltips,RS.Tooltips_Contextmenu],["enable",[_State.EDITING]])],[MainToolbarActions._EDIT_NODE,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEdit}`],[ATTR.xTooltips,RS.Tooltips_EditNode],["enable",[_State.EDITING]])],[MainToolbarActions._SELECT,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaChevronCircleUp}`],[ATTR.xTooltips,RS.Tooltips_SelectParent],["enable",[_State.EDITING]])],[MainToolbarActions._EDIT,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaEdit}`],[ATTR.xTooltips,RS.Tooltips_Edit],["enable",[_State.BROWSING]])],[MainToolbarActions._BACK,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowCircleLeft}`],[ATTR.xTooltips,RS.Tooltips_GoBackInHistory],["enable",[_State.INVALID,_State.BROWSING,_State.IMAGE,_State.AUDIO,_State.PDF,_State.VIDEO]])],[MainToolbarActions._FORWARD,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowCircleRight}`],[ATTR.xTooltips,RS.Tooltips_GoForwardInHistory],["enable",[_State.INVALID,_State.BROWSING,_State.IMAGE,_State.AUDIO,_State.PDF,_State.VIDEO]])],[MainToolbarActions._HOME,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaHome}`],[ATTR.xTooltips,RS.Tooltips_Home],["enable",[_State.INVALID,_State.BROWSING,_State.IMAGE,_State.AUDIO,_State.PDF,_State.VIDEO]])],[MainToolbarActions._SAVE,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSave}`],[ATTR.xTooltips,RS.Tooltips_SaveAndQuit],["enable",[_State.EDITING]])],[MainToolbarActions._CANCEL,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaTrash}`],[ATTR.xTooltips,RS.Tooltips_QuitWithoutSave],["enable",[_State.EDITING]])],[MainToolbarActions._IMAGE_MENU,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaToggleDown}`],[ATTR.xTooltips,RS.Tooltips_ImageViewerContextmenu],["enable",[_State.IMAGE]])],[MainToolbarActions._IMAGE_ROTATE,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaRotateRight}`],[ATTR.xTooltips,RS.Tooltips_RotateImage],["enable",[_State.IMAGE]])],[MainToolbarActions._TOGGLE_LEFTSIDEPANEL,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaToggleRight}`],[ATTR.xTooltips,RS.Tooltips_ShowOrHideLeftSidepanel],["enable",[_State.INVALID,_State.BROWSING,_State.EDITING,_State.IMAGE,_State.AUDIO,_State.PDF,_State.VIDEO]])],[MainToolbarActions._TOOLBAR_RECORDING,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMicrophone}`],[ATTR.xTooltips,RS.Tooltips_StopAudioRecording],["enable",null])],[MainToolbarActions._SEARCHBAR_RECORDING,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMicrophone}`],[ATTR.xTooltips,RS.Tooltips_StopAudioRecording],["enable",null])],[MainToolbarActions._SYSTEMBAR_RECORDING,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMicrophone}`],[ATTR.xTooltips,RS.Tooltips_StopAudioRecording],["enable",null])],[MainToolbarActions._TOOLBAR_PLAYBACK,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaVolumeUp}`],[ATTR.xTooltips,RS.Tooltips_StopAudioPlayback],["enable",null])],[MainToolbarActions._SEARCHBAR_PLAYBACK,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaVolumeUp}`],[ATTR.xTooltips,RS.Tooltips_StopAudioPlayback],["enable",null])],[MainToolbarActions._SYSTEMBAR_PLAYBACK,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaVolumeUp}`],[ATTR.xTooltips,RS.Tooltips_StopAudioPlayback],["enable",null])],[MainToolbarActions._SEARCH_REPLACE,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaSearchPlus} toogle`],[ATTR.xTooltips,RS.Tooltips_Replace],["enable",[]])],[MainToolbarActions._SEARCH_NEXT,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaArrowCircleDown}`],[ATTR.xTooltips,RS.Tooltips_NextMatch],["enable",[]])],[MainToolbarActions._SEARCH_PREV,json_(["class",`${CSS.AnButton} ${CSS.AnToggleOff} ${CSS.Fa} ${CSS.FaArrowCircleUp}`],[ATTR.xTooltips,RS.Tooltips_PreviousMatch],["enable",[]])],[MainToolbarActions._SEARCH_IGNORECASE,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaInfo}`],[ATTR.xTooltips,RS.Tooltips_ToggleIgnoreCase],["enable",[]])],[MainToolbarActions._SYSTEM_PRINT,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPrint}`],[ATTR.xTooltips,RS.Tooltips_Print],["enable",[]])],[MainToolbarActions._SYSTEM_BACKUP,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaUpload}`],[ATTR.xTooltips,RS.Tooltips_Backup],["enable",[]])],[MainToolbarActions._SYSTEM_RESTORE,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaDownload}`],[ATTR.xTooltips,RS.Tooltips_Restore],["enable",[]])],[MainToolbarActions._SYSTEM_CONTEXTMENU,json_(["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaToggleDown}`],[ATTR.xTooltips,RS.Tooltips_Contextmenu],["enable",[]])],[MainToolbarActions._SYSTEM_FACTORY_RESET,json_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaToggleOff}`],[ATTR.xTooltips,RS.Tooltips_FactoryReset],["enable",[]])],[MainToolbarActions._SYSTEM_MANAGE_BACKUP_KEYS,json_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaKey}`],[ATTR.xTooltips,RS.BackupKeyManagerTooltips],["enable",[]])],[MainToolbarActions._SYSTEM_RESET_USER_SETTINGS,json_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaTimesCircle}`],[ATTR.xTooltips,RS.Tooltips_ResetUserSettings],["enable",[]])]),_MainToolbar._homeCount=0;class MainContextActions{}MainContextActions._FONT_BG_IMG="Xbgi",MainContextActions._FONT_FG_STYLE="Xfgs",MainContextActions._BORDER="XqG",MainContextActions._UNDO_HISTORY="XWu",MainContextActions._PARA_STYLES="XSj",MainContextActions._LIST_OL="XCV",MainContextActions._LIST_ITEM="XvD",MainContextActions._SCAN_DOCUMENT="X9D",MainContextActions._CALCULATOR="XhJ",MainContextActions._SUBMENU_PARA="X2c",MainContextActions._LIST_ITEM_TEXT="XCa",MainContextActions._MOVETO_PARENT="X3l",MainContextActions._INSERT_ELEMENT="XbC",MainContextActions._INSERT_SYMBOL="Xji",MainContextActions._INSERT_WIDGET="Xp3",MainContextActions._MOVETO_NEXT="X3X",MainContextActions._RECORD_VIDEO="X4p",MainContextActions._LIST_COMPACT="XIx",MainContextActions._FONT_NAME="XAX",MainContextActions._HIGHLIGHT_STYLES="Xos",MainContextActions._REDO="Xck",MainContextActions._SUBMENU_LIST="Xt8",MainContextActions._INSERT_ALARM="XXp",MainContextActions._PASTE_CHILD="XE6",MainContextActions._INSERT_LINK="XaL",MainContextActions._DESTRUCT_WIDGET="XyR",MainContextActions._LIST_UL_NONE="X3P",MainContextActions._PARA_HIDDEN="XAw",MainContextActions._UNWRAP="XaI",MainContextActions._LIST_ITEM_TIME="X6K",MainContextActions._TO_SPACE="Xzm",MainContextActions._UNDO="XW3",MainContextActions._CHAR_HIDDEN="XAc",MainContextActions._SUBMENU_CHAR="XRX",MainContextActions._LIST_DATE="XlX",MainContextActions._SUBMENU_FONT="XcA",MainContextActions._SELECT_NEXT_SIBLING="XpQ",MainContextActions._TO_NBSP="XnQ",MainContextActions._EDIT_SIZE="X8G",MainContextActions._INSERT_DATE="XT6",MainContextActions._EDIT_NODE="XKy",MainContextActions._TAKE_PHOTO="XGW",MainContextActions._INSERT_CALENDAR="XwI",MainContextActions._CUT="XVl",MainContextActions._FONT_FG="XvP",MainContextActions._INSERT_TEXT="XB3",MainContextActions._FONT_CATEGORY="XED",MainContextActions._LIST_UL="XZx",MainContextActions._LIST_ITEM_SYMBOL="XVO",MainContextActions._DELETE="X7q",MainContextActions._LIST_SYMBOLS="XYk",MainContextActions._ANNOTATE_IMG="XdC",MainContextActions._INSERT_IMG="XlQ",MainContextActions._INSERT_AUDIO="Xiao",MainContextActions._INSERT_VIDEO="Xivo",MainContextActions._MOVETO_PREV="Xde",MainContextActions._EDIT_STYLE="Xas",MainContextActions._EDIT_NODE_RAW="XEV",MainContextActions._SUBMENU_OTHERS="XjA",MainContextActions._COPY="XM7",MainContextActions._EDIT_ALIGN="X6o",MainContextActions._CHAR_STYLES="XjM",MainContextActions._WRAP="X7z",MainContextActions._TOGGLE_RIGHTSIDEBAR="XRN",MainContextActions._SUBMENU_MEDIA="XM8",MainContextActions._FONT_STYLE="XkM",MainContextActions._PARENT_NODE="XhO",MainContextActions._SPAWN_NODE="Xmh",MainContextActions._LIST_UL_NONE_INDENTED="XCr",MainContextActions._PARAGRAPH="XmP",MainContextActions._EDIT_STYLE_RAW="XDT",MainContextActions._RECORD_AUDIO="XbI",MainContextActions._PASTE_SIBLING="XP5",MainContextActions._FONT_BG="X9v",MainContextActions._LIST_EXPAND="XtC",MainContextActions._LIST_ITEM_DATE="Xug",MainContextActions._LINEBREAK="XaA",MainContextActions._INSERT_CANVAS="Xkq",MainContextActions._FONT_SIZE="Xfb",MainContextActions._STYLE_ALIGN_CENTER=CSS.xAlignCenter,MainContextActions._STYLE_ALIGN_JUSTIFY=CSS.xAlignJustify,MainContextActions._STYLE_ALIGN_LEFT=CSS.xAlignLeft,MainContextActions._STYLE_ALIGN_RIGHT=CSS.xAlignRight,MainContextActions._STYLE_BOLD=CSS.xBold,MainContextActions._STYLE_FLOAT_LEFT=CSS.xFloatLeft,MainContextActions._STYLE_FLOAT_RIGHT=CSS.xFloatRight,MainContextActions._STYLE_ITALIC=CSS.xItalic,MainContextActions._STYLE_STRIKETHROUGH=CSS.xStrikethrough,MainContextActions._STYLE_SUBSCRIPT=CSS.xSubscript,MainContextActions._STYLE_SUPERSCRIPT=CSS.xSuperscript,MainContextActions._STYLE_UNDERLINE=CSS.xUnderline;class _MainContextmenu extends _ContextmenuBase{constructor(t){super(_MainContextmenu.createContextmenu(t)),this._buttons=new Map,this._menubarButtons=new Map,this._menubarPanels=new Map;const e=new DomBuilderEx(this._contextmenu);e.table_({class:CSS.AnContextmenu}).push_(),this._upperMainmenu=e.tr1_(CSS.AnUpperMainMenu).cursor_(),e.td_().table_().push_(),_MainContextmenu._createbuttons(this._buttons,e,[[MainContextActions._COPY,MainContextActions._CUT,MainContextActions._PASTE_CHILD,MainContextActions._PASTE_SIBLING,MainContextActions._SELECT_NEXT_SIBLING,MainContextActions._PARENT_NODE],[MainContextActions._MOVETO_PARENT,MainContextActions._MOVETO_PREV,MainContextActions._MOVETO_NEXT,MainContextActions._REDO,MainContextActions._UNDO_HISTORY,MainContextActions._UNDO],[MainContextActions._PARAGRAPH,MainContextActions._INSERT_TEXT,MainContextActions._INSERT_ELEMENT,MainContextActions._SPAWN_NODE,MainContextActions._EDIT_NODE_RAW,MainContextActions._EDIT_STYLE_RAW],[MainContextActions._INSERT_LINK,MainContextActions._INSERT_IMG,MainContextActions._INSERT_SYMBOL,MainContextActions._INSERT_DATE,MainContextActions._UNWRAP,MainContextActions._WRAP],[MainContextActions._LIST_SYMBOLS,MainContextActions._LIST_ITEM_SYMBOL,MainContextActions._LIST_DATE,MainContextActions._LIST_ITEM_DATE,MainContextActions._DESTRUCT_WIDGET,MainContextActions._INSERT_WIDGET]]),this._upperFontmenu=e.pop_().peek_().tr1_(CSS.AnUpperFontMenu).cursor_(),An.hide_(this._upperFontmenu),e.td_().table_().push_(),this._createUpperFontmenu(e),e.pop_().peek_(),_MainContextmenu._createmenubar(this._menubarButtons,e,[MainContextActions._SUBMENU_FONT,MainContextActions._SUBMENU_CHAR,MainContextActions._SUBMENU_PARA,MainContextActions._SUBMENU_LIST,MainContextActions._SUBMENU_MEDIA,MainContextActions._SUBMENU_OTHERS]),e.peek_().tr_().td_({class:CSS.AnRuler,colspan:"6"}),e.peek_().tr_().td_({class:CSS.AnSubmenuContainer,colspan:"6"}).push_().cursor_(),this._menubarPanels.set(MainContextActions._SUBMENU_FONT,e.peek_().table_({name:NAME.submenuFont,style:"display: none;"}).cursor_()),this._createLowerFontmenu(e),this._menubarPanels.set(MainContextActions._SUBMENU_CHAR,e.peek_().table_({name:NAME.submenuChar,style:"display: none;"}).cursor_()),_MainContextmenu._createbuttons(this._buttons,e,[[MainContextActions._STYLE_BOLD,MainContextActions._STYLE_ITALIC,MainContextActions._STYLE_UNDERLINE,MainContextActions._STYLE_STRIKETHROUGH,MainContextActions._STYLE_SUBSCRIPT,MainContextActions._STYLE_SUPERSCRIPT],[MainContextActions._STYLE_FLOAT_LEFT,MainContextActions._STYLE_FLOAT_RIGHT,DEF.NOOP,MainContextActions._CHAR_HIDDEN,MainContextActions._HIGHLIGHT_STYLES,MainContextActions._CHAR_STYLES]]),this._menubarPanels.set(MainContextActions._SUBMENU_PARA,e.peek_().table_({name:NAME.submenuPara,style:"display: none;"}).cursor_()),_MainContextmenu._createbuttons(this._buttons,e,[[MainContextActions._STYLE_ALIGN_LEFT,MainContextActions._STYLE_ALIGN_CENTER,MainContextActions._STYLE_ALIGN_JUSTIFY,MainContextActions._STYLE_ALIGN_RIGHT,MainContextActions._EDIT_ALIGN,MainContextActions._EDIT_STYLE],[MainContextActions._BORDER,MainContextActions._EDIT_SIZE,DEF.NOOP,DEF.NOOP,MainContextActions._PARA_HIDDEN,MainContextActions._PARA_STYLES]]),this._menubarPanels.set(MainContextActions._SUBMENU_LIST,e.peek_().table_({name:NAME.submenuList,style:"display: none;"}).cursor_()),_MainContextmenu._createbuttons(this._buttons,e,[[MainContextActions._LIST_OL,MainContextActions._LIST_UL,MainContextActions._LIST_UL_NONE_INDENTED,MainContextActions._LIST_UL_NONE,MainContextActions._LIST_COMPACT,MainContextActions._LIST_EXPAND],[MainContextActions._LIST_ITEM_TIME,MainContextActions._LIST_ITEM_TEXT,MainContextActions._LIST_ITEM,DEF.NOOP,DEF.NOOP,DEF.NOOP]]),this._menubarPanels.set(MainContextActions._SUBMENU_MEDIA,e.peek_().table_({name:NAME.submenuMedia,style:"display: none;"}).cursor_()),_MainContextmenu._createbuttons(this._buttons,e,[[MainContextActions._TO_SPACE,MainContextActions._TO_NBSP,MainContextActions._CALCULATOR,MainContextActions._INSERT_CALENDAR,MainContextActions._INSERT_ALARM,MainContextActions._INSERT_CANVAS,MainContextActions._ANNOTATE_IMG],[DEF.NOOP,MainContextActions._INSERT_VIDEO,MainContextActions._INSERT_AUDIO,MainContextActions._TAKE_PHOTO,MainContextActions._RECORD_VIDEO,MainContextActions._RECORD_AUDIO]]),this._menubarPanels.set(MainContextActions._SUBMENU_OTHERS,e.peek_().table_({name:NAME.submenuOthers,style:"display: none;"}).cursor_()),_MainContextmenu._createbuttons(this._buttons,e,[[DEF.NOOP,DEF.NOOP,DEF.NOOP,DEF.NOOP,DEF.NOOP,MainContextActions._TOGGLE_RIGHTSIDEBAR]]),t.append(this._contextmenu),this._buttons.get(MainContextActions._ANNOTATE_IMG).style.display="none",super.setupHandlers_(this._contextmenu,`td.${CSS.AnContextButton}`)}static _info(t){return _MainContextmenu._BUTTONS[t]}static createContextmenu(t){return DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenu}).cursor_()}static _setStyle2(t,e){const i=native$.getIFrameSelectionRange_();if(null==i)return void toasters$.warnKey_(RS.InvalidSelection);const n=native$.getSingleSelectedNodeOfRange_(i);_MainContextmenu._setStyle3(i,n,t,e)}static _setStyle3(t,e,i,n){history$.group_(RS.Tooltips_EditStyle,`${i}: ${n}`,()=>{null!=e&&e.nodeType==Node.ELEMENT_NODE||(e=RangeUtil.wrapRange_("span",{},t)),native$.replaceStyle_(e,i,n)})}_createUpperFontmenu(t){const e=CSS.AnMenurow;t.push_().tr1_(e).td_(),this._inputFontcat=new SelectOptions(accessories$,t.div1_(CSS.AnMenuSelect,CSS.AnWidth6).cursor_()).setOptions_(settings$.fontCategories_()),t.peek_().tr1_(e).td_(),this._inputFontname=new SelectOptions(accessories$,t.div1_(CSS.AnMenuSelect,CSS.AnWidth6).cursor_()),DialogUt.populateFontName_(this._inputFontname,[""],settings$.fontFamilies_(),this._inputFontcat.getValue_(""),""),t.peek_().tr1_(e).td_(),this._inputFontstyle=new SelectOptions(accessories$,t.div1_(CSS.AnMenuSelect,CSS.AnWidth6).cursor_()),this._inputFontsize=t.peek_().tr1_(e).td_().div1_(CSS.AnMenurow6).cursor_(),this._inputFG=t.peek_().tr1_(e).td_().push_().div1_(CSS.AnColorInput2,CSS.AnColorFG,CSS.AnWidth1).text_(MSG.string_(RS.FGColor)).cursor_(),this._inputFGStyle=t.peek_().div_(["class",`${CSS.AnColorCell}`],["style","overflow:hidden;display:flex;height:-webkit-fill-availalble;"]).div_(["class",`${CSS.AnColorCell}`],["style","border:none;"]).cursor_(),t.div1_(CSS.AnFlexCenter,CSS.AnFill).text_("A"),this._inputFGColor=t.peek_().div1_(CSS.AnColorCell,CSS.AnColorFG).cursor_(),this._inputBG=t.peek_().div1_(CSS.AnColorInput2,CSS.AnColorBG,CSS.AnWidth1).text_(MSG.string_(RS.BGColor)).cursor_(),this._inputBGImage=t.peek_().div1_(CSS.AnColorCell).cursor_(),this._inputBGColor=t.peek_().div1_(CSS.AnColorCell,CSS.AnColorBG).cursor_(),t.pop_(2)}_createLowerFontmenu(t){const e=cache$.ui$.buttonSize_();t.push_().tr1_(CSS.AnMenurow).td_(),this._inputFontsample=t.div_({class:CSS.AnMenurow6,style:"white-space:nowrap;overflow:hidden;"+`min-height:${e}px;`}).cursor_(),t.pop_(),this._setupFontmenuHandlers()}getActionButton(t){var e;return null!==(e=this._buttons.get(t))&&void 0!==e?e:null}getMenubarButton(t){var e;return null!==(e=this._menubarButtons.get(t))&&void 0!==e?e:null}updateFontSubmenuState(t){const e=native$.getNearestSelectedElementOfRange_(t);if(null!=e){const t=e.style,i=native$.getStyleOrComputedStyle_(e,null,["font-family","font-size","color","background-color","text-shadow","background-image","backdrop-filter","filter"]);i.set("transform",CSSUtil.ignoreInheritNone(t.transform)),i.set("transform-origin",CSSUtil.ignoreInheritNone(t.transformOrigin));const n=i.get("font-family"),s=FontUtil.getFontStackNameStyle_(settings$,n);if(null!=s){this._inputFontname.setValue_(s[0]),DialogUt.populateFontStyle_(this._inputFontstyle,[],settings$.fontInfo_(s[0]),s[1]);const t=FontUtil.fontFamilyOf_(s[0],s[1]);this._setFontsize(i.get("font-size"));const e=CSSUtil.ignoreInherit(i.get("color")),n=CSSUtil.ignoreInherit(i.get("background-color")),o=CSSUtil.humanCSSUrls_(CSSUtil.ignoreInheritNone(i.get("background-image")),native$.getIFrameUri_()),l=CSSUtil.ignoreInheritNone(i.get("filter")),a=CSSUtil.ignoreInheritNone(i.get("backdrop-filter"));let r=CSSUtil.ignoreInherit(i.get("text-shadow")),_=CSSUtil.ignoreInheritNone(i.get("transform")),c=CSSUtil.ignoreInheritNone(i.get("transform-origin"));this._inputFGStyle.style.textShadow=r,this._inputFGStyle.style.transform=_,this._inputFGStyle.style.transformOrigin=c,this._inputFGStyle.style.filter=l,this._inputFGStyle.setAttribute(ATTR.AnInfo,JSON.stringify(smap_(["text-shadow",r],["transform",_],["transform-origin",_.length>0?c:""],["filter",l]))),this._inputFGColor.style.backgroundColor=e,this._inputFGColor.setAttribute(ATTR.AnInfo,e),this._inputBGImage.style.backgroundImage=o,this._inputBGImage.style.setProperty("backdrop-filter",a),this._inputBGImage.setAttribute(ATTR.AnInfo,JSON.stringify([o,a])),this._inputBGColor.style.backgroundColor=n,this._inputBGColor.setAttribute(ATTR.AnInfo,n),this._inputFontsample.textContent=t;const h=this._inputFontsample.style;h.fontFamily=t,h.color=e,h.textShadow=r,h.transform=_,h.transformOrigin=_.length>0?c:"",h.filter=l,h.backgroundColor=n,h.backgroundImage=o,h.setProperty("backdrop-filter",a)}}}showSubmenu_(t){const e=this._menubarButtons.get(t),i=this._menubarPanels.get(t);if(void 0!==e&&void 0!==i)if(e.classList.add(CSS.AnSelected),An.show_(i),t==MainContextActions._SUBMENU_FONT){An.hide_(this._upperMainmenu),An.show_(this._upperFontmenu);const t=native$.getIFrameSelectionRange_();null!=t&&this.updateFontSubmenuState(t)}else An.hide_(this._upperFontmenu),An.show_(this._upperMainmenu)}hideSubmenu_(t){const e=this._menubarButtons.get(t),i=this._menubarPanels.get(t);void 0!==e&&void 0!==i&&(e.classList.remove(CSS.AnSelected),An.hide_(i))}static _createbuttons(t,e,i){e.push_();for(const n of i)if(0!=n.length){e.peek_().tr_().push_();for(const i of n){if(DEF.NOOP==i){ContextmenuBase.createnoop_(e);continue}const n=_MainContextmenu._BUTTONS[i],s=e.peek_().td_(n).cursor_();null!=t&&t.set(i,s)}e.pop_()}e.pop_()}static _createmenubar(t,e,i){const n=e.push_().tr1_(CSS.AnMenubar).cursor_();e.push_();for(const n of i){if(DEF.NOOP==n){ContextmenuBase.createnoop_(e);continue}const i=_MainContextmenu._BUTTONS[n],s=e.peek_().td_(i).cursor_();null!=t&&t.set(n,s)}return e.pop_(2),n}static _setSampleFontFamily(t,e){t.style.fontFamily=e,t.textContent=0==e.length?MSG.string_(RS.FontSample):e,_MainContextmenu._setStyle2("font-family",e)}static _getComputedStyle(t){const e=native$.getIFrameSelectionRange_();if(null==e)return toasters$.warnKey_(RS.InvalidSelection),null;let i=native$.getSingleSelectedNodeOfRange_(e);for(;null!=i&&i.nodeType!=Node.ELEMENT_NODE;)i=i.parentNode;return null==i||An.isBodyElement_(i.nodeName)?null:native$.getComputedStyle1_(i,null,t)}_setFontsize(t){const e=An.doubleStringSizeUnit_(t),i=null==e?t:e.join("");this._inputFontsize.textContent=i,this._inputFontsample.style.fontSize=t}_setupFontmenuHandlers(){this._inputFontcat.onChange_(t=>{const e=this._inputFontname.getValue_("");DialogUt.populateFontName_(this._inputFontname,[""],settings$.fontFamilies_(),t,e)}),this._inputFontname.onChange_(t=>{const e=this._inputFontstyle.getValue_(""),i=DialogUt.populateFontStyle_(this._inputFontstyle,[],settings$.fontInfo_(t),e),n=FontUtil.fontFamilyOf_(t,i);_MainContextmenu._setSampleFontFamily(this._inputFontsample,n)}),this._inputFontstyle.onChange_(t=>{const e=this._inputFontname.getValue_(""),i=FontUtil.fontFamilyOf_(e,t);_MainContextmenu._setSampleFontFamily(this._inputFontsample,i)}),An.onClick_(this._inputFontname.element_(),()=>{host$.hideKeyboard_()}),An.onClick_(this._inputFontcat.element_(),()=>{host$.hideKeyboard_()}),An.onClick_(this._inputFontstyle.element_(),()=>{host$.hideKeyboard_()});const t=cache$.ui$.buttonSize_();An.onClick_(this._inputFontsize,()=>{host$.hideKeyboard_(()=>{var t,e,i;let n=An.doubleStringSizeUnit_(null!==(e=null===(t=this._inputFontsize.textContent)||void 0===t?void 0:t.trim())&&void 0!==e?e:"");if(null==n){const t=null!==(i=native$.getComputedStyle1_(this._inputFontsample,null,"font-size"))&&void 0!==i?i:"";if(null==(n=An.doubleStringSizeUnit_(t)))return toasters$.warn_(MSG.string1_(RS.InvalidValue_,t)),this._setFontsize(""),void _MainContextmenu._setStyle2("font-size","")}const s=new PromptCSSLength(accessories$,RS.FontSize,n,RS.FontSize);s.above_(this._contextmenu),s.onOK_(t=>{this._setFontsize(t),_MainContextmenu._setStyle2("font-size",t)}),s.show_()})}),An.onClick_(this._inputFontsample,t=>{An.stopevent_(t),host$.hideKeyboard_(()=>{const t=_Util.promptFont_(this._inputFontsample.style.fontFamily);t.onOK_(t=>{const e=FontUtil.splitNameStyle_(t);e[0]==this._inputFontname.getValue_("")&&e[1]==this._inputFontstyle.getValue_("")||(this._inputFontname.setValue_(e[0]),DialogUt.populateFontStyle_(this._inputFontstyle,[],settings$.fontInfo_(e[0]),e[1]),_MainContextmenu._setSampleFontFamily(this._inputFontsample,t))}),t.show_()})});const e=(e,i,n,s)=>{An.stopevent_(s),host$.hideKeyboard_(()=>{var s;const o=Callbacks.promptColor_(t,DEF.zindexPrompt,null!==(s=e.getAttribute(ATTR.AnInfo))&&void 0!==s?s:"",n);o.onOK_((t,n)=>{if(null==t){if(_MainContextmenu._setStyle2(i,null),null!=(t=ColorUtil.getColorValue_(_MainContextmenu._getComputedStyle(i)))){const n=t.toCSSString_();e.style.backgroundColor=n,e.setAttribute(ATTR.AnInfo,n),this._inputFontsample.style.setProperty(i,n)}return}const s=ColorUtil.formatCSSString_(n,t);e.style.backgroundColor=s,e.setAttribute(ATTR.AnInfo,s),this._inputFontsample.style.setProperty(i,s),_MainContextmenu._setStyle2(i,s)}),o.show_()})},i=t=>{e(this._inputFGColor,"color",ColorValue.X_BLACK,t)},n=t=>{e(this._inputBGColor,"background-color",ColorValue.X_WHITE,t)};An.onClick_(this._inputFG,i),An.onClick_(this._inputFGStyle.parentElement,()=>{var e;const i=native$.getIFrameSelectionRange_();if(null==i)return;const n=native$.getSingleSelectedNodeOfRange_(i),s=t=>{this._inputFGStyle.setAttribute(ATTR.AnInfo,JSON.stringify(t));for(const[e,s]of Object.entries(t))this._inputFGStyle.style.setProperty(e,s),this._inputFontsample.style.setProperty(e,s),_MainContextmenu._setStyle3(i,n,e,s)},o=DomUt.asHTMLElement_(n),l=JSON.parse(null!==(e=this._inputFGStyle.getAttribute(ATTR.AnInfo))&&void 0!==e?e:"{}");new PromptFgStyle(accessories$,o,t,this._inputFontsample.style,l,PromptFgStyle._SAMPLES,DEF.zindexPrompt).onOK_(t=>{s(t)}).onCancel_(()=>{null!=o&&s(l)}).show_()}),An.onClick_(this._inputFGColor,i),An.onClick_(this._inputBG,n),An.onClick_(this._inputBGColor,n),An.onClick_(this._inputBGImage,()=>{var e;const i=native$.getIFrameSelectionRange_();if(null==i)return;const n=native$.getSingleSelectedNodeOfRange_(i),s=native$.getIFrameUri_();if(null==s)return;const o=DomUt.asHTMLElement_(n);let l=null!==(e=An.parseJSONArrayOrNull_(this._inputBGImage.getAttribute(ATTR.AnInfo)))&&void 0!==e?e:An.getComputedStylesArray_(o,"background-image","backdrop-filter");new PromptBgImage(accessories$,o,t,s,[l[0],l[1]],settings$.getBgImgSamples(),DEF.zindexPrompt).onOK_((t,e)=>{this._inputBGImage.style.backgroundImage=t,this._inputBGImage.style.setProperty("backdrop-filter",e),this._inputBGImage.setAttribute(ATTR.AnInfo,JSON.stringify([t,e])),this._inputFontsample.style.backgroundImage=t,this._inputFontsample.style.setProperty("backdrop-filter",e),_MainContextmenu._setStyle3(i,n,"background-image",t),_MainContextmenu._setStyle3(i,n,"backdrop-filter",e)}).onCancel_(()=>{null!=o&&(_MainContextmenu._setStyle3(i,n,"background-image",l[0]),_MainContextmenu._setStyle3(i,n,"backdrop-filter",l[1]))}).show_()})}submenuActions_(t,e){if(!t.classList.contains(CSS.AnDisabled)){for(const t of this._menubarButtons.values())t.classList.remove(CSS.AnSelected);t.classList.add(CSS.AnSelected);for(const t of this._menubarPanels.values())An.hide_(t);With.optional_(this._menubarPanels.get(e),t=>An.show_(t)),e==MainContextActions._SUBMENU_FONT?(An.hide_(this._upperMainmenu),An.show_(this._upperFontmenu),With.optional_(native$.getIFrameSelectionRange_(),t=>this.updateFontSubmenuState(t))):(An.hide_(this._upperFontmenu),An.show_(this._upperMainmenu))}}}_MainContextmenu._BUTTONS=smap_([DEF.NOOP,smap_([ATTR.AnAction,DEF.NOOP])],[MainContextActions._COPY,smap_([ATTR.AnAction,MainContextActions._COPY],[ATTR.xTooltips,RS.Tooltips_CopySelection],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCopy}`])],[MainContextActions._CUT,smap_([ATTR.AnAction,MainContextActions._CUT],[ATTR.xTooltips,RS.Tooltips_CutSelection],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCut}`])],[MainContextActions._PASTE_CHILD,smap_([ATTR.AnAction,MainContextActions._PASTE_CHILD],[ATTR.xTooltips,RS.Tooltips_PasteAsChild],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaHandORight}`])],[MainContextActions._PASTE_SIBLING,smap_([ATTR.AnAction,MainContextActions._PASTE_SIBLING],[ATTR.xTooltips,RS.Tooltips_PasteAsNextSibling],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaHandODown}`])],[MainContextActions._UNDO,smap_([ATTR.AnAction,MainContextActions._UNDO],[ATTR.xTooltips,RS.Tooltips_Undo],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaReply}`])],[MainContextActions._UNDO_HISTORY,smap_([ATTR.AnAction,MainContextActions._UNDO_HISTORY],[ATTR.xTooltips,RS.Tooltips_UndoHistory],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaReplyAll}`])],[MainContextActions._REDO,smap_([ATTR.AnAction,MainContextActions._REDO],[ATTR.xTooltips,RS.Tooltips_Redo],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaShare}`])],[MainContextActions._PARENT_NODE,smap_([ATTR.AnAction,MainContextActions._PARENT_NODE],[ATTR.xTooltips,RS.Tooltips_SelectParent],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaChevronCircleUp}`])],[MainContextActions._SELECT_NEXT_SIBLING,smap_([ATTR.AnAction,MainContextActions._SELECT_NEXT_SIBLING],[ATTR.xTooltips,RS.Tooltips_ExtendSelection],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaArrowCircleDown}`])],[MainContextActions._WRAP,smap_([ATTR.AnAction,MainContextActions._WRAP],[ATTR.xTooltips,RS.Tooltips_WrapSelection],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaPlusSquare}`])],[MainContextActions._UNWRAP,smap_([ATTR.AnAction,MainContextActions._UNWRAP],[ATTR.xTooltips,RS.Tooltips_UnwrapSelection],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaMinusSquare}`])],[MainContextActions._INSERT_ELEMENT,smap_([ATTR.AnAction,MainContextActions._INSERT_ELEMENT],[ATTR.xTooltips,RS.Tooltips_InsertElement],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCode}`])],[MainContextActions._INSERT_TEXT,smap_([ATTR.AnAction,MainContextActions._INSERT_TEXT],[ATTR.xTooltips,RS.Tooltips_InsertText],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaTumblr}`])],[MainContextActions._SPAWN_NODE,smap_([ATTR.AnAction,MainContextActions._SPAWN_NODE],[ATTR.xTooltips,RS.Tooltips_SpawnSibling],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaDeviantart}`])],[MainContextActions._EDIT_SIZE,smap_([ATTR.AnAction,MainContextActions._EDIT_SIZE],[ATTR.xTooltips,RS.Tooltips_ResizeElement],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaArrows}`])],[MainContextActions._EDIT_ALIGN,smap_([ATTR.AnAction,MainContextActions._EDIT_ALIGN],[ATTR.xTooltips,RS.Tooltips_EditAlignments],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaExchange}`])],[MainContextActions._EDIT_STYLE,smap_([ATTR.AnAction,MainContextActions._EDIT_STYLE],[ATTR.xTooltips,RS.Tooltips_EditStyle],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaThList}`])],[MainContextActions._EDIT_STYLE_RAW,smap_([ATTR.AnAction,MainContextActions._EDIT_STYLE_RAW],[ATTR.xTooltips,RS.Tooltips_EditStyleAsRawText],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaPencilSquare}`])],[MainContextActions._EDIT_NODE,smap_([ATTR.AnAction,MainContextActions._EDIT_NODE],[ATTR.xTooltips,RS.Tooltips_EditNode],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaEdit}`])],[MainContextActions._EDIT_NODE_RAW,smap_([ATTR.AnAction,MainContextActions._EDIT_NODE_RAW],[ATTR.xTooltips,RS.Tooltips_EditNodeAsRawText],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaEdit}`])],[MainContextActions._ANNOTATE_IMG,smap_([ATTR.AnAction,MainContextActions._ANNOTATE_IMG],[ATTR.xTooltips,RS.Tooltips_AnnotateImage],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaPencil}`])],[MainContextActions._MOVETO_NEXT,smap_([ATTR.AnAction,MainContextActions._MOVETO_NEXT],[ATTR.xTooltips,RS.Tooltips_SwapPositionWithNextSibling],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAngleDoubleDown}`])],[MainContextActions._MOVETO_PREV,smap_([ATTR.AnAction,MainContextActions._MOVETO_PREV],[ATTR.xTooltips,RS.Tooltips_SwapPositionWithPrevSibling],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAngleDoubleUp}`])],[MainContextActions._MOVETO_PARENT,smap_([ATTR.AnAction,MainContextActions._MOVETO_PARENT],[ATTR.xTooltips,RS.Tooltips_MoveUpAsNextSiblingOfParent],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAngleDoubleLeft}`])],[MainContextActions._TOGGLE_RIGHTSIDEBAR,smap_([ATTR.AnAction,MainContextActions._TOGGLE_RIGHTSIDEBAR],[ATTR.xTooltips,RS.Tooltips_ShowOrHideRightSidebar],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaToggleRight}`])],[MainContextActions._LINEBREAK,smap_([ATTR.AnAction,MainContextActions._LINEBREAK],[ATTR.xTooltips,RS.Tooltips_InsertLinebreak],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaGbp}`])],[MainContextActions._PARAGRAPH,smap_([ATTR.AnAction,MainContextActions._PARAGRAPH],[ATTR.xTooltips,RS.Tooltips_InsertParagraph],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaRub}`])],[MainContextActions._DELETE,smap_([ATTR.AnAction,MainContextActions._DELETE],[ATTR.xTooltips,RS.Tooltips_Delete],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaMinus}`])],[MainContextActions._CHAR_HIDDEN,smap_([ATTR.AnAction,MainContextActions._CHAR_HIDDEN],[ATTR.xTooltips,RS.Tooltips_HideSelection],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaEyeSlash}`])],[MainContextActions._CHAR_STYLES,smap_([ATTR.AnAction,MainContextActions._CHAR_STYLES],[ATTR.xTooltips,RS.Tooltips_CharacterStyles],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaEllipsisV}`])],[MainContextActions._HIGHLIGHT_STYLES,smap_([ATTR.AnAction,MainContextActions._HIGHLIGHT_STYLES],[ATTR.xTooltips,RS.Tooltips_HighlightStyles],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSpinner}`])],[MainContextActions._PARA_HIDDEN,smap_([ATTR.AnAction,MainContextActions._PARA_HIDDEN],[ATTR.xTooltips,RS.Tooltips_HideSelection],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaEyeSlash}`])],[MainContextActions._PARA_STYLES,smap_([ATTR.AnAction,MainContextActions._PARA_STYLES],[ATTR.xTooltips,RS.Tooltips_ParagraphStyles],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaEllipsisV}`])],[MainContextActions._INSERT_LINK,smap_([ATTR.AnAction,MainContextActions._INSERT_LINK],[ATTR.xTooltips,RS.Tooltips_InsertLinkElement],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaLink}`])],[MainContextActions._INSERT_AUDIO,smap_([ATTR.AnAction,MainContextActions._INSERT_AUDIO],[ATTR.xTooltips,RS.InsertAudioTooltips],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaFileAudioO}`])],[MainContextActions._INSERT_VIDEO,smap_([ATTR.AnAction,MainContextActions._INSERT_VIDEO],[ATTR.xTooltips,RS.InsertVideoTooltips],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaFileVideoO}`])],[MainContextActions._INSERT_IMG,smap_([ATTR.AnAction,MainContextActions._INSERT_IMG],[ATTR.xTooltips,RS.Tooltips_InsertImageElement],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaImage}`])],[MainContextActions._TAKE_PHOTO,smap_([ATTR.AnAction,MainContextActions._TAKE_PHOTO],[ATTR.xTooltips,RS.Tooltips_TakePhoto],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCamera}`])],[MainContextActions._RECORD_AUDIO,smap_([ATTR.AnAction,MainContextActions._RECORD_AUDIO],[ATTR.xTooltips,RS.Tooltips_RecordAudio],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaMicrophone}`])],[MainContextActions._RECORD_VIDEO,smap_([ATTR.AnAction,MainContextActions._RECORD_VIDEO],[ATTR.xTooltips,RS.Tooltips_RecordVideo],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaVideoCamera}`])],[MainContextActions._CALCULATOR,smap_([ATTR.AnAction,MainContextActions._CALCULATOR],[ATTR.xTooltips,RS.Tooltips_Calculator],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCalculator}`])],[MainContextActions._INSERT_DATE,smap_([ATTR.AnAction,MainContextActions._INSERT_DATE],[ATTR.xTooltips,RS.Tooltips_InsertDateTimeString],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaClockO}`])],[MainContextActions._INSERT_CALENDAR,smap_([ATTR.AnAction,MainContextActions._INSERT_CALENDAR],[ATTR.xTooltips,RS.Tooltips_InsertCalendar],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCalendar}`])],[MainContextActions._INSERT_ALARM,smap_([ATTR.AnAction,MainContextActions._INSERT_ALARM],[ATTR.xTooltips,RS.Tooltips_CreateEvent],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaBellO}`])],[MainContextActions._TO_NBSP,smap_([ATTR.AnAction,MainContextActions._TO_NBSP],[ATTR.xTooltips,RS.Tooltips_ConvertSpacesToNonBreakSpaces],["class",`${CSS.AnContextButton} ${CSS.AnFaNbsp}`])],[MainContextActions._TO_SPACE,smap_([ATTR.AnAction,MainContextActions._TO_SPACE],[ATTR.xTooltips,RS.Tooltips_ConvertNonBreakSpacesToSpaces],["class",`${CSS.AnContextButton} ${CSS.AnFaSpace}`])],[MainContextActions._INSERT_SYMBOL,smap_([ATTR.AnAction,MainContextActions._INSERT_SYMBOL],[ATTR.xTooltips,RS.Tooltips_InsertSymbol],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSmileO}`])],[MainContextActions._INSERT_CANVAS,smap_([ATTR.AnAction,MainContextActions._INSERT_CANVAS],[ATTR.xTooltips,RS.Tooltips_InsertCanvas],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaPaintBrush}`])],[MainContextActions._INSERT_WIDGET,smap_([ATTR.AnAction,MainContextActions._INSERT_WIDGET],[ATTR.xTooltips,RS.Tooltips_InsertWidget],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSquare}`])],[MainContextActions._DESTRUCT_WIDGET,smap_([ATTR.AnAction,MainContextActions._DESTRUCT_WIDGET],[ATTR.xTooltips,RS.Tooltips_DestructWidget],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaShareSquare} ${CSS.FaFlipHorizontal}`])],[MainContextActions._BORDER,smap_([ATTR.AnAction,MainContextActions._BORDER],[ATTR.xTooltips,RS.Tooltips_AddBorder],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSquareO}`])],[MainContextActions._STYLE_BOLD,smap_([ATTR.AnAction,MainContextActions._STYLE_BOLD],[ATTR.xTooltips,RS.Tooltips_Bold],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaBold}`])],[MainContextActions._STYLE_ITALIC,smap_([ATTR.AnAction,MainContextActions._STYLE_ITALIC],[ATTR.xTooltips,RS.Tooltips_Italic],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaItalic}`])],[MainContextActions._STYLE_UNDERLINE,smap_([ATTR.AnAction,MainContextActions._STYLE_UNDERLINE],[ATTR.xTooltips,RS.Tooltips_Underline],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaUnderline}`])],[MainContextActions._STYLE_STRIKETHROUGH,smap_([ATTR.AnAction,MainContextActions._STYLE_STRIKETHROUGH],[ATTR.xTooltips,RS.Tooltips_StrikeThrough],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaStrikethrough}`])],[MainContextActions._STYLE_SUBSCRIPT,smap_([ATTR.AnAction,MainContextActions._STYLE_SUBSCRIPT],[ATTR.xTooltips,RS.Tooltips_Subscript],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSubscript}`])],[MainContextActions._STYLE_SUPERSCRIPT,smap_([ATTR.AnAction,MainContextActions._STYLE_SUPERSCRIPT],[ATTR.xTooltips,RS.Tooltips_Superscript],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSuperscript}`])],[MainContextActions._STYLE_FLOAT_LEFT,smap_([ATTR.AnAction,MainContextActions._STYLE_FLOAT_LEFT],[ATTR.xTooltips,RS.Tooltips_FloatLeft],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAlignLeft}`])],[MainContextActions._STYLE_FLOAT_RIGHT,smap_([ATTR.AnAction,MainContextActions._STYLE_FLOAT_RIGHT],[ATTR.xTooltips,RS.Tooltips_FloatRight],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAlignRight}`])],[MainContextActions._STYLE_ALIGN_LEFT,smap_([ATTR.AnAction,MainContextActions._STYLE_ALIGN_LEFT],[ATTR.xTooltips,RS.Tooltips_AlignLeft],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAlignLeft}`])],[MainContextActions._STYLE_ALIGN_RIGHT,smap_([ATTR.AnAction,MainContextActions._STYLE_ALIGN_RIGHT],[ATTR.xTooltips,RS.Tooltips_AlignRight],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAlignRight}`])],[MainContextActions._STYLE_ALIGN_CENTER,smap_([ATTR.AnAction,MainContextActions._STYLE_ALIGN_CENTER],[ATTR.xTooltips,RS.Tooltips_AlignCenter],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAlignCenter}`])],[MainContextActions._STYLE_ALIGN_JUSTIFY,smap_([ATTR.AnAction,MainContextActions._STYLE_ALIGN_JUSTIFY],[ATTR.xTooltips,RS.Tooltips_AlignJustify],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaAlignJustify}`])],[MainContextActions._LIST_OL,smap_([ATTR.AnAction,MainContextActions._LIST_OL],[ATTR.xTooltips,RS.Tooltips_ListOrdered],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaListOl}`])],[MainContextActions._LIST_UL,smap_([ATTR.AnAction,MainContextActions._LIST_UL],[ATTR.xTooltips,RS.Tooltips_ListUnordered],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaListUl}`])],[MainContextActions._LIST_UL_NONE_INDENTED,smap_([ATTR.AnAction,MainContextActions._LIST_UL_NONE_INDENTED],[ATTR.xTooltips,RS.Tooltips_ListWithoutBullet],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaIndent}`])],[MainContextActions._LIST_UL_NONE,smap_([ATTR.AnAction,MainContextActions._LIST_UL_NONE],[ATTR.xTooltips,RS.Tooltips_ListWithoutBulletAndIndent],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaBars}`])],[MainContextActions._LIST_ITEM,smap_([ATTR.AnAction,MainContextActions._LIST_ITEM],[ATTR.xTooltips,RS.Tooltips_ListItem],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaMinus}`])],[MainContextActions._LIST_SYMBOLS,smap_([ATTR.AnAction,MainContextActions._LIST_SYMBOLS],[ATTR.xTooltips,RS.Tooltips_ListWithSymbolBullet],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCommentsO}`])],[MainContextActions._LIST_DATE,smap_([ATTR.AnAction,MainContextActions._LIST_DATE],[ATTR.xTooltips,RS.Tooltips_ListWithDateBullet],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCalendar}`])],[MainContextActions._LIST_COMPACT,smap_([ATTR.AnAction,MainContextActions._LIST_COMPACT],[ATTR.xTooltips,RS.Tooltips_MakeListCompact],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCompress}`])],[MainContextActions._LIST_EXPAND,smap_([ATTR.AnAction,MainContextActions._LIST_EXPAND],[ATTR.xTooltips,RS.Tooltips_MakeListNotCompact],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaExpand}`])],[MainContextActions._LIST_ITEM_SYMBOL,smap_([ATTR.AnAction,MainContextActions._LIST_ITEM_SYMBOL],[ATTR.xTooltips,RS.Tooltips_ListItemWithSymbolBullet],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCommentO}`])],[MainContextActions._LIST_ITEM_TEXT,smap_([ATTR.AnAction,MainContextActions._LIST_ITEM_TEXT],[ATTR.xTooltips,RS.Tooltips_ListItemWithTextBullet],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaTumblr}`])],[MainContextActions._LIST_ITEM_DATE,smap_([ATTR.AnAction,MainContextActions._LIST_ITEM_DATE],[ATTR.xTooltips,RS.Tooltips_ListItemWithDateBullet],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaCalendarO}`])],[MainContextActions._LIST_ITEM_TIME,smap_([ATTR.AnAction,MainContextActions._LIST_ITEM_TIME],[ATTR.xTooltips,RS.Tooltips_ListItemWithTimeBullet],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaClockO}`])],[MainContextActions._SUBMENU_FONT,smap_([ATTR.AnAction,MainContextActions._SUBMENU_FONT],[ATTR.xTooltips,RS.Tooltips_FontStyles],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaFont}`])],[MainContextActions._SUBMENU_CHAR,smap_([ATTR.AnAction,MainContextActions._SUBMENU_CHAR],[ATTR.xTooltips,RS.Tooltips_CharacterStyles],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaStrikethrough}`])],[MainContextActions._SUBMENU_PARA,smap_([ATTR.AnAction,MainContextActions._SUBMENU_PARA],[ATTR.xTooltips,RS.Tooltips_ParagraphStyles],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaParagraph}`])],[MainContextActions._SUBMENU_LIST,smap_([ATTR.AnAction,MainContextActions._SUBMENU_LIST],[ATTR.xTooltips,RS.Tooltips_ListStyles],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaList}`])],[MainContextActions._SUBMENU_MEDIA,smap_([ATTR.AnAction,MainContextActions._SUBMENU_MEDIA],[ATTR.xTooltips,RS.Tooltips_InsertObjects],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaPaperclip}`])],[MainContextActions._SUBMENU_OTHERS,smap_([ATTR.AnAction,MainContextActions._SUBMENU_OTHERS],[ATTR.xTooltips,RS.Tooltips_OtherActions],["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaEllipsisH}`])]);class _ImageContextmenu extends _ContextmenuBase{constructor(t){super(_ImageContextmenu.createContextmenu(t));const e=new DomBuilderEx(this._contextmenu);e.table_({class:CSS.AnContextmenu}).push_();const i=e.tr_().td_().table_().push_().cursor_();_ImageContextmenu._createbuttons(e,[[_ImageContextmenu._IMAGE_EXPORT,_ImageContextmenu._IMAGE_INFO],[_ImageContextmenu._ANNOTATE_IMAGE,_ImageContextmenu._IMAGE_BGCOLOR]]),super.setupHandlers_(i,`td.${CSS.AnContextButton}`)}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuImage}).cursor_()}static _createbuttons(t,e){t.push_();for(const i of e)if(0!=i.length){t.peek_().tr_().push_();for(const e of i){if(DEF.NOOP==e){ContextmenuBase.createnoop_(t);continue}const i=_ImageContextmenu._BUTTONS[e],n=smap_([ATTR.AnAction,e],["class",i.class],[ATTR.xTooltips,i[ATTR.xTooltips]]);t.peek_().td_(n)}t.pop_()}t.pop_()}hide_(){super.destroy_()}}_ImageContextmenu._ANNOTATE_IMAGE="XlK",_ImageContextmenu._FIX_PERSPECTIVE="Xso",_ImageContextmenu._SCAN_BARCODE="XRA",_ImageContextmenu._IMAGE_INFO="X0g",_ImageContextmenu._IMAGE_EXPORT="XTc",_ImageContextmenu._IMAGE_FILTER="Xift",_ImageContextmenu._IMAGE_BGCOLOR="Xibg",_ImageContextmenu._PREVIEW="Xap",_ImageContextmenu._CROP="XbG",_ImageContextmenu._OCR="Xk0",_ImageContextmenu._BUTTONS=smap_([_ImageContextmenu._ANNOTATE_IMAGE,smap_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaPencil}`],[ATTR.xTooltips,RS.Tooltips_Annotation])],[_ImageContextmenu._IMAGE_EXPORT,smap_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaExternalLink}`],[ATTR.xTooltips,RS.Tooltips_ExportImage])],[_ImageContextmenu._IMAGE_BGCOLOR,smap_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSpinner}`],[ATTR.xTooltips,RS.Tooltips_SetBackgroundColor])],[_ImageContextmenu._IMAGE_FILTER,smap_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaSearchMinus}`],[ATTR.xTooltips,RS.ImageFilter])],[_ImageContextmenu._IMAGE_INFO,smap_(["class",`${CSS.AnContextButton} ${CSS.Fa} ${CSS.FaInfoCircle}`],[ATTR.xTooltips,RS.Tooltips_ShowInfo])]);class PromptAncestors extends DialogBase{constructor(t,e){super(t),this._ancestors=e,this._selected=null,this._selectedIndex=null,this._okCallback=null,this.init_(this.create_(t)),An.addClickListenerMatching_(this._content,`div[${ATTR.AnAction}]`,(t,e)=>{An.stopevent_(e);const i=An.parseInt_(t.getAttribute(ATTR.AnAction),-1);this._select(t,i)})}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),BUT.infos_(BUT.Child,BUT.After,BUT.Cancel),t=>this._toolbarActions(t))}_createContent(t){this._content=new DomBuilderEx(t).div1_(CSS.AnVerticalViewportWide).addStyle_("margin-top","10px").div1_(CSS.AnTextList).push_().cursor_(),this._populate(this._content)}_populate(t){const e=new DomBuilderEx(t).empty_().push_();for(let t=0;t<this._ancestors.length;++t){const i=this._ancestors[t],n=i.nodeName,s="BODY"==n;if(e.peek_().div2_(ATTR.AnAction,t.toString()).div_().child1_("span",s?CSS.AnSec:CSS.AnTag).text_(n),!s&&i.nodeType==Node.ELEMENT_NODE){const t=i.getAttribute("class");null!=t&&t.length>0&&e.up_().text_("").span1_(CSS.AnAtt).text_(` .${t.replace(RX.Spaces," .")}`)}}}onSmokescreenCreated_(t){super.onSmokescreenCreated_(t),t.on_(Conf.touchend,t=>{An.stopevent_(t),this.actionCancelConfirmed_()})}onOK_(t){return this._okCallback=t,this}_select(t,e){if(null!=this._selected&&(this._selected.classList.remove(CSS.AnSelected),this._selectedIndex==e))return this._selected=null,void(this._selectedIndex=null);t.classList.add(CSS.AnSelected),this._selected=t,this._selectedIndex=e}_toolbarActions(t){var e,i;switch(this.clearStatus_(),t){case BUT.Cancel:const n=this._cancelCallback;this.close_(),null==n||n();break;case BUT.Child:case BUT.After:const s=this._ancestors[null!==(e=this._selectedIndex)&&void 0!==e?e:0];this.close_(),null===(i=this._okCallback)||void 0===i||i.call(this,s,t==BUT.After),this._okCallback=null;break;default:this.actionInvalid_(t)}}}class _AncestorsContextmenu extends _ContextmenuBase{constructor(t,e,i,n=null){super(_AncestorsContextmenu.createContextmenu(t)),this._ancestors=e,this._focus=i,this._done=n;const s=new DomBuilderEx(this._contextmenu).table1_(CSS.AnContextmenu).tr_().td_().div1_(CSS.AnVerticalViewport).div1_(CSS.AnTextList).push_();this._create(s,this._ancestors),super.setupHandlers_(s.pop_().cursor_(),`div[${ATTR.AnAction}]`),this.onAction_(t=>{var i;this._focus&&native$.focusIFrame_();const n=An.parseInt_(t,-1);if(n>=0&&n<e.length-1){const t=e[n];native$.iSelectNode_(t,null,!0),this.hide_(),null===(i=this._done)||void 0===i||i.call(this)}})}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuSelect}).cursor_()}_create(t,e){for(let i=0;i<e.length;++i){const n=e[i],s=n.nodeName,o="BODY"==s;if(t.peek_(),o?t.div_():t.div2_(ATTR.AnAction,i.toString()),t.div_().child1_("span",o?CSS.AnSec:CSS.AnTag).text_(s),!o&&n.nodeType==Node.ELEMENT_NODE){const e=n.getAttribute("class");null!=e&&e.length>0&&t.up_().text_("").span1_(CSS.AnAtt).text_(` .${e.replace(RX.Spaces," .")}`)}}}hide_(){super.destroy_()}}class _CharContextmenu extends _ContextmenuBase{constructor(t){super(_CharContextmenu.createContextmenu(t));const e=new DomBuilderEx(this._contextmenu).table1_(CSS.AnContextmenu).tr_().td_().div1_(CSS.AnVerticalViewport).div1_(CSS.AnTextList).push_();this._createstyles(e,settings$.charStyles_()),super.setupHandlers_(e.pop_().cursor_(),`div[${ATTR.AnAction}]`)}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuChar}).cursor_()}_createstyles(t,e){for(const i of e){const e=i.name_();let n="margin:0";e==CSS.xHidden&&(n+=";display:inline !important"),t.peek_().div2_(ATTR.AnAction,e).span_({class:e,style:n}).text_(i.label_())}}hide_(){super.destroy_()}}class _HighlightContextmenu extends _ContextmenuBase{constructor(t){super(_HighlightContextmenu.createContextmenu(t));const e=new DomBuilderEx(this._contextmenu).table1_(CSS.AnContextmenu).push_();this._createstyles(e,settings$.highlightStyles_()),super.setupHandlers_(e.pop_().cursor_(),`td.${CSS.AnContextButton}`)}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuHighlight}).cursor_()}_createstyles(t,e){t.push_().tr_().push_();let i=0;for(let n=0;n<e.length;++n){++i>6&&(i=1,t.pop_().peek_().tr_().push_());const s=e[n],o=s.name_(),l=s.label_(),a=smap_([ATTR.AnAction,o],[ATTR.xTooltips,l],["class",`${CSS.AnContextButton} ${o}`]);t.peek_().td_(a).text_("Aa")}for(;++i<=6;)t.peek_().td_({class:CSS.AnContextButton}).text_("");t.pop_(2)}}class _ParaContextmenu extends _ContextmenuBase{constructor(t){super(_ParaContextmenu.createContextmenu(t));const e=new DomBuilderEx(this._contextmenu).table1_(CSS.AnContextmenu).tr_().td_().div1_(CSS.AnVerticalViewport).div1_(CSS.AnTextList).push_();this._createstyles(e,settings$.paraStyles_()),super.setupHandlers_(e.pop_().cursor_(),`div[${ATTR.AnAction}]`)}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuPara}).cursor_()}_createstyles(t,e){for(let i=0;i<e.length;++i){const n=e[i],s=n.name_();let o="margin:0;width:100%";s==CSS.xHidden&&(o+=";display:block !important"),t.peek_().div2_(ATTR.AnAction,s).div_({class:s,style:o}).text_(n.label_())}}hide_(){super.destroy_()}}class _WidgetContextmenu extends _ContextmenuBase{constructor(t,e){super(_WidgetContextmenu.createContextmenu(t));const i=new DomBuilderEx(this._contextmenu).div1_(CSS.AnVerticalMenu).div1_(CSS.AnVerticalViewport).div1_(CSS.AnTextList,CSS.AnBulletList).push_();this._populate(i,e),super.setupHandlers_(i.pop_().cursor_(),`[${ATTR.AnAction}`)}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,name:NAME.contextmenuWidget,style:"display:none;visibility:hidden;"}).cursor_()}_populate(t,e){for(let i=0;i<e.length;++i){const n=e[i],s=n[0],o=n.length>1?n[1]:"";t.peek_().div2_(ATTR.AnAction,s).append1_("span",o).text_(MSG.string_(s))}}hide_(){super.destroy_()}}class _SystemActionContextmenu extends _ContextmenuBase{constructor(t){super(_SystemActionContextmenu.createContextmenu(t));const e=new DomBuilderEx(this._contextmenu),i=e.table_({class:`${CSS.AnContextmenu}`}).push_().cursor_();for(const t of[MainToolbarActions._SYSTEM_MANAGE_BACKUP_KEYS,MainToolbarActions._SYSTEM_RESET_USER_SETTINGS,MainToolbarActions._SYSTEM_FACTORY_RESET]){const i=_MainToolbar._BUTTONS[t];e.peek_().tr_().td_(["class",i.class],[ATTR.AnAction,t],[ATTR.xTooltips,i[ATTR.xTooltips]])}e.pop_(),super.setupHandlers_(i,`td[${ATTR.AnAction}]`)}static createContextmenu(t){return new DomBuilderEx(t).div_({class:CSS.AnContextmenu,style:"display: none; visibility: hidden;"}).cursor_()}hide_(){super.destroy_()}}class _Metainfo{constructor(t=null){try{const e=An.parseJSONObjectOrNull_(t);if(null!=e&&"object"==typeof e){this.info$=e;const t=this.info$.calc;return void(null!=t&&(this.info$.remove("calc"),"boolean"==typeof t&&1==t&&this.addFeature(MetainfoKey.FeatureCalc)))}}catch(t){}this.info$=smap_()}stringify(){return JSON.stringify(this.info$)}get createdBy$(){return An.ifnull_(this.info$[MetainfoKey.CreatedBy],0)}get modifiedBy$(){return An.ifnull_(this.info$[MetainfoKey.ModifiedBy],0)}setCreatedBy(t=BUILD_VERSION){this.info$[MetainfoKey.CreatedBy]=t}setModifiedBy(t=BUILD_VERSION){this.info$[MetainfoKey.ModifiedBy]=t}hasPatch(t){const e=this.info$[MetainfoKey.Patches];return!An.isempty_(e)&&e.indexOf(t)>=0}hasFeature(t){const e=this.info$[MetainfoKey.Features];return!An.isempty_(e)&&e.indexOf(t)>=0}addPatch(t){return this._add(MetainfoKey.Patches,t)}addFeature(t){return this._add(MetainfoKey.Features,t)}_add(t,e){const i=this.info$[t];return An.isempty_(i)?(this.info$[t]=e,!0):i.indexOf(e)<0&&(this.info$[t]=i+e,!0)}}class _Fixer{constructor(t){this._info=t}fix(){this._info.modifiedBy$<201101&&_Fixer.fixRightSidebarStyleMenuImages()}static fixRightSidebarStyleMenuImages(){const t=native$.iGetElementById_(ID.xRightSidebar);if(null!=t)for(const e of Array.from(native$.iQueryAll_(`div.${CSS.xTemplateButton}.fa-toggle-down`,t))){const t=e.getAttribute(ATTR.xTemplate);if(null==t||!t.startsWith("{"))continue;let i;try{i=JSON.parse(t)}catch(t){continue}const n=i[TemplateMenuKey.lcCat];if(null!=n&&"string"==typeof n)try{switch(n){case"canvas":case"home":case"memo":case"shopping":case"todo":const t=i[TemplateMenuKey.menu];if(null==t||!(t instanceof Array))break;const s=new RegExp(`^(\\./${n})(-\\d+-button\\.jpg)$`);let o=0;for(const e of t)for(const t of e){const e=t[TemplateMenuKey.backgroundImage];if(null==e||"string"!=typeof e)continue;const i=s.exec(e);if(null==i)continue;const n=i[1]+"-v2"+i[2];t[TemplateMenuKey.backgroundImage]=n,++o}o>0&&JsUtil.setAttribute_(e,ATTR.xTemplate,JSON.stringify(i))}}catch(t){}}}}class _MainPanel{constructor(t){this._highlightContextmenu=null,this._isTransparent=!1,this._isLoggedIn=!1,this._iframeReadyCallbacks=[],this._iframeReadyOneshotCallbacks=[],this._iframeUnloadCallbacks=[],this._onResumeOneshotCallbacks=[],this._metainfo=null,this._videographer=null,this._iframeMediaViewer=null,this._iframeEditListeners=new Array,this._clientHidden=null,this._lastIFrameSelectionRange=null,this._docClickX=0,this._docClickY=0,this._navigation=RecentsCmd.INFO,this._hideRightSidebarTimer=null;const e=t.ownerDocument;this._mainToolbar=new _MainToolbar(e.getElementById(ID.toolbar)),this._contextmenu=this._createMainContextmenu(),native$.addCallback_(AjaxAction.audioStatusChanged,t=>this.onAudioStatusChanged(t)),native$.addCallback_(AjaxAction.pause,t=>this.onPauseCallback(t)),native$.addCallback_(AjaxAction.resume,t=>this.onResumeCallback(t)),native$.addCallback_(AjaxAction.browse,t=>this.onBrowse(t)),native$.addCallback_(AjaxAction.toaster,t=>this.onPostToaster(t)),native$.addCallback_(AjaxAction.takePhotoResult,t=>this.photoResult(t)),_Main._windowResizer=new _WindowResizer(window),native$.addCallback_(AjaxAction.onResizeWindow,()=>_Main._onResizeWindow()),native$.addCallback_(AjaxAction.gesture,t=>_Main._onGestureEvent(t)),native$.addCallback_(AjaxAction.videoRecordingResult,t=>this.videoRecordingResult(t))}_createMainContextmenu(){const t=new _MainContextmenu(accessories$);return t.onAction_((t,e,i)=>this._contextActions(t,e,i)),t.onCancel_(()=>native$.focusIFrame_()),t.onContextmenu_(toasters$.onTooltipsKey_),t}onAudioStatusChanged(t){var e;const i=An.parseJSONObjectOrNull_(t);if(null==i)return null;toasters$.warn_(i)||toasters$.warn_(i[Key.warns])||toasters$.ok_(i[Key.text],{attop:!0}),this._mainToolbar.updateAudioStatus1_(i);const n=i[Key.recorder];if(null!=n){!(null!==(e=n[Key.status])&&void 0!==e&&e)&&null!=mainPanel$&&mainPanel$.isEditing()&&null!=history$&&(history$.startGroup_(RS.action_UpdateAudioInfo,""),mainPanel$._updateAudioInfos(()=>{history$.endGroup_()}))}return null}onBrowse(t){const e=An.parseJSONObjectOrNull_(t);if(null==e)return null;const i=e[Param.path];if(An.isempty_(i))return null;const n=e[Param.fragment];if(_state.isEditing())_Util.promptSave_(()=>{this._onbrowse1(i,n)}).show_();else{const t=DialogUt.confirm_(accessories$,MSG.format1_(RS.confirmOpenDocument1,Basepath.nameWithSuffix_(i)),t=>{t&&this._onbrowse1(i,n)});t.zindex_(DEF.zindexPromptSave),t.showWarning_()}return null}_onbrowse1(t,e){Timer.sleep0_(()=>{Timer.sleep_(250,()=>{if(An.isempty_(e))_Util.browseFile_(t);else{const i=An.uriFromSafe_(null,t.split("/"),"",e);_Util.browse_(i,t+"#"+e)}})})}onSaveCSS(t,e){_state==_State.BROWSING||_state==_State.EDITING?native$.updateIFrameStylesheets_(t,e):e()}onPostToaster(t){const e=An.parseJSONObjectOrNull_(t);if(null==e)return null;const i=e[Key.text],n=1==e[Key.hold];null!=i&&toasters$.ok_(i,{attop:!0,hold:n});const s=e[Key.warns];return null!=s&&toasters$.warn_(s,{attop:!0,hold:n}),null}onEmptyChanged(t){null!=this._contextmenu&&this._contextmenu.isShown_()&&(this._setbutton(MainContextActions._UNDO,!t),this._setbutton(MainContextActions._UNDO_HISTORY,!t))}onRedoEmpty(t){null!=this._contextmenu&&this._contextmenu.isShown_()&&this._setbutton(MainContextActions._REDO,!t)}onUndone(t){const e=null==t||0==t.length?"OK":t+" OK";toasters$.info_(`${MSG.string_(RS.Undo)}: ${e}`,{attop:!1})}onRedone(t){const e=null==t||0==t.length?"OK":t+" OK";toasters$.info_(`${MSG.string_(RS.Redo)}: ${e}`,{attop:!1})}onPauseCallback(t){if(null!=this._iframeMediaViewer&&this._iframeMediaViewer.onPause_(),null!=_AudioPlayerDialog._singleton&&_AudioPlayerDialog._singleton.onPause_(),this.isEditing()){const t=this._onBeforeSaveForPause();if(null!=t){const e=native$.serializeIFrameDocument_();host$.saveRecovery_(t,e,t=>{toasters$.warn_(t);const e=An.messagesList_(t);0==e.length&&e.push(MSG.string_(RS.SaveOnPauseMessage)),this._addOnResumeOneshotCallback(()=>{toasters$.info_(e,{attop:!0})}),this._enableEditActions(!0)})}}const e=native$.getIFrameUri_();if(null==e)return"[]";const i=this._saveSession1(e);return host$.hideKeyboard_(),JSON.stringify([e.path$,i])}_addOnResumeOneshotCallback(t){Conf.isMobile&&this._onResumeOneshotCallbacks.push(t)}onResumeCallback(t){if(null!=t&&t.length>0)try{const e=An.parseJSONObjectOrNull_(t);null!=e&&toasters$.warn_(e[Key.warns],{hold:!0})}catch(t){}return null!=this._iframeMediaViewer&&this._iframeMediaViewer.onResume_(),null!=_AudioPlayerDialog._singleton&&_AudioPlayerDialog._singleton.onResume_(),An.fireOneshotCallbacks_(this._onResumeOneshotCallbacks),null}isLoggedIn(){return this._isLoggedIn}isEditing(){return _state==_State.EDITING}isBrowsing(){return _state==_State.BROWSING}canPrint(){return _state==_State.BROWSING||_state==_State.IMAGE}saveEdit(t=null){const e=_MainPanel._startGroup(RS.action_Save,"");this._onBeforeSave(i=>{this._processPlaceholdersOnSave(()=>{if(null!=i){null==this._metainfo&&(this._metainfo=new _Metainfo),this._metainfo.setModifiedBy(),native$.iSetMetainfo_(this._metainfo.stringify());const n=native$.serializeIFrameDocument_();_MainPanel._endGroup(e),this._savenow(i,n,t)}})})}_onBeforeSaveForPause(){if(null==native$.getIFrameDocument_())return toasters$.warnKey_(RS.InvalidDocument),null;const t=native$.getIFrameContextPath_();return null==t?(toasters$.warnKey_(RS.InvalidDocument),null):(this._onStopEdit0(),t)}_onBeforeSave(t){host$.hideKeyboard_(()=>{const e=this._onBeforeSaveForPause();_MainPanel._recalculateTotals(),native$.fixIFrameHrefs_(),native$.fixIFrameSrcs_(),native$.fixIFrameStyles_(),native$.fixIFrameInputs_(),t(e)})}_onStopEdit0(){native$.iRemoveSelections_(),native$.setDisplayById_(ID.xRightSidepanel,"none"),native$.setDisplayById_(ID.xLeftSidepanel,"none");const t=native$.iGetElementById_(ID.xRightSidebar);null!=t&&t.classList.remove(CSS.xHidetemp),this._clientActionHideDone(),this._enableEditActions(!1),this._hideAnnotations()}_onStopEdit(t){for(;0!=this._iframeEditListeners.length;)native$.iRemoveEventListener_(this._iframeEditListeners.pop());host$.hideKeyboard_(()=>{null!=history$&&history$.disconnect_(),this._onStopEdit0();const e=native$.getIFrameDocument_();if(null!=e){const t=e.body;native$.removeAttributes_(t,[ATTR.contenteditable,ATTR.autocapitalize,ATTR.AnUndoing,ATTR.AnRedoing,ATTR.AnToggleGroup])}this._lastIFrameSelectionRange=null,t()})}_savenow(t,e,i=null){const n=new StepTimer;this._mainToolbar.setEnabled(!1),host$.saveHtml_(t,e,t=>{if(toasters$.warn_(t))return this._enableEditActions(!0),void this._mainToolbar.setEnabled(!0);const e=t[Key.result];this.stopEdit(!1,()=>{if(n.debug_(`# saveEdit(): ${e}`),null!=i)_state=_State.BROWSING,this._mainToolbar.onStateChange(),this._mainToolbar.setEnabled(!0),i(e);else if(t[Key.status]==HttpStatus.NOT_MODIFIED)_state=_State.BROWSING,this._mainToolbar.onStateChange(),this._mainToolbar.setEnabled(!0);else{const t=this._saveSession(null);this.addIFrameReadyOneshotCallback(e=>{this._restoreSession(t),this._mainToolbar.setEnabled(!0),e()}),Timer.sleep00_(()=>{native$.reload_()})}})})}startEdit(t,e=null){var i,n;const s=docInfo$;if(null==s||!s.fileInfo$.writable$)return toasters$.warnKey_(RS.DocumentIsNotEditable),void(null==e||e());if(null!==(n=null===(i=s.uri$)||void 0===i?void 0:i.queryParameters$.has(Param.searchtext))&&void 0!==n&&n)return Timer.sleep0_(()=>{var t,e;const i=null!==(e=null===(t=s.uri$)||void 0===t?void 0:t.path$)&&void 0!==e?e:null;if(null!=i){const t=this._saveSession(null);this.addIFrameReadyOneshotCallback(e=>{this._restoreSession(t),e()}),_Util.browseFile_(i,null,!0)}}),void(null==e||e());_state=_State.EDITING;const o=native$.getIFrameWindow_();if(null==o)return void(null==e||e());const l=o.document,a=l.body;if(JsUtil.setAttribute_(a,ATTR.contenteditable,"true"),JsUtil.setAttribute_(a,ATTR.autocapitalize,"none"),JsUtil.setAttribute_(a,ATTR.AnRedoing,""),JsUtil.setAttribute_(a,ATTR.AnUndoing,""),JsUtil.setAttribute_(a,ATTR.AnToggleGroup,""),l.execCommand("enableObjectResizing",!0,"true"),l.execCommand("enableInlineTableEditing",!0,"true"),l.execCommand("insertBrOnReturn",!0,"true"),this._iframeEditListeners.push(native$.iAddEventListener_(o,"keydown",t=>this._keydownListener(t),!1,!0)),this._iframeEditListeners.push(native$.iAddEventListener_(o,"keypress",t=>this._keypressListener(t),!1,!0)),this._iframeEditListeners.push(native$.iAddEventListener_(o,"paste",t=>this._pasteListener(t),!1,!0)),this._iframeEditListeners.push(native$.iAddEventListener_(o,Conf.touchstart,t=>this._touchStartListener(t),!1,!0)),null==native$.getValidIFrameSelectionRange_()){const t=native$.iQuery(`.${CSS.xRoot}`);native$.iSelect_(null!=t?t:a,0,0)}null!=this._metainfo&&this._metainfo.modifiedBy$<BUILD_VERSION&&new _Fixer(this._metainfo).fix(),this._enableEditActions(!0);const r=null!=native$.iQuery(`.${CSS.xCalcContext}`);null==docInfo$||docInfo$.setRecalc_(r),history$.addOnUndoEmptyListener_(t=>this.onEmptyChanged(t)),history$.addOnUndoneListener_(t=>this.onUndone(t)),history$.addOnRedoEmptyListener_(t=>this.onRedoEmpty(t)),history$.addOnRedoneListener_(t=>this.onRedone(t)),history$.connect_(),_state=_State.EDITING,this._mainToolbar.onStateChange();const _=native$.iQueryAll_(`[${ATTR.xPlaceholder}]`).filter(t=>{const e=t.getAttribute(ATTR.xPlaceholder);return e!=Placeholder.xpVideoinfo&&e!=Placeholder.xpAudioinfo});this.processPlaceholders_(_,()=>{null==t||t()})}_touchStartListener(t){this._lastIFrameSelectionRange=null;let e=1,i=null;if("touchstart"==Conf.touchstart){const n=t;(e=n.touches.length)>0&&(i=n.touches[0])}else(i=t).ctrlKey&&(e=2);const n=t.target;if(null!=n&&n.nodeType==Node.ELEMENT_NODE&&e<2){const e=n.classList;if(e.contains(CSS.xTemplateButton)&&(this._lastIFrameSelectionRange=native$.getIFrameSelectionRange_()),(e.contains(CSS.xCalcPrice)||e.contains(CSS.xCalcQuantity))&&!JsUtil.isInput_(n)&&null!=i){JsUtil.stopevent_(t);const e=i.pageX,s=i.pageY;this._onCalcCell(n,e,s)}}}_keypressListener(t){"Enter"==t.key&&_MainPanel._actionOnEnter()&&JsUtil.stopEventImmediately_(t)}_keydownListener(t){const e=t.key;this.isEditing&&"Backspace"==e&&_MainPanel._actionOnBackspace()&&JsUtil.stopevent_(t)}_pasteListener(t){JsUtil.stopevent_(t);try{const e=t.clipboardData;if(null!=e){const t=Array.from(e.items);if(null!=t){for(const e of[MimeUtil.TEXT_PLAIN,MimeUtil.HTML])for(const i of t){const t=i.type,n=i.kind;if(e==t&&"string"==n)return void this._pasteText(i)}for(const e of t){if("string"==e.kind)return void this._pasteText(e)}}}}catch(t){}toasters$.warn_(MSG.stringArray_(RS.ClipboardPasteStringOnly))}_pasteText(t){t.getAsString(t=>{this._pasteText1(t)})}_pasteText1(t){const e=native$.getIFrameSelectionRange_();null!=t&&null!=e&&(null!=history$?history$.group_(RS.Tooltips_PasteFromSystemClipboard,"",()=>{this._pasteText2(e,t)}):this._pasteText2(e,t))}_pasteText2(t,e){const i=RangeUtil.rangeOwnerDocument_(t);if(null==i)return;const n=i.createTextNode(e);RangeUtil.replaceRange_(t,n)}_dragStartListener(t){JsUtil.stopevent_(t)}_dragListener(t){JsUtil.stopevent_(t)}_dropListener(t){JsUtil.stopevent_(t),toasters$.warn_(MSG.string_(RS.DropActionNotSupported))}startEditCallback(t){this.startEdit(()=>{t()},()=>{t()})}_addIFrameUnloadCallback(t){this._iframeUnloadCallbacks.push(t)}static _showAnnotation0(t){host$.hideKeyboard_(()=>{_MainPanel._showAnnotation1(t)})}static _showAnnotation1(t){let e=JsUtil.childElementWithClass_(t,CSS.xAnnotationTarget);null==e&&(e=JsUtil.childElementWithClass_(t,CSS.xAnnotation));const i=JsUtil.childElementWithClass_(t,CSS.xSmokescreen);if(null==e||null==i)return!1;const n=JsUtil.childElementWithClass_(i,CSS.xAnnotationContent);if(null==n)return!1;const s=_MainPanel._startGroup(RS.action_AnnotationShow,"");try{native$.iClearSelection_(),_MainPanel._showAnnotation2(i,e,n)}finally{return _MainPanel._endGroup(s),!0}}static _showAnnotation2(t,e,i){const n=cache$.ui$.iwinWidth_(),s=cache$.ui$.iwinHeight_(),o=DEF.contextmenuMargin;native$.setStyles_(t,map_(["top","0px"],["left","0px"],["width","100%"],["height","100%"],["visibility","hidden"],["display","block"]));const l=native$.getBoundingClientRect_(t);let a,r,_=Math.round(l.left),c=Math.round(l.top),h=Math.round(l.width),u=Math.round(l.height);_<0?(a=-_,_=0):a=0,c<0?(r=-c,c=0):r=0,native$.setStyles_(t,map_(["left",`${a}px`],["top",`${r}px`]));let d=Math.min(n-_,h)-2*o;d=Math.min(d,3*n/4);let S=Math.min(s-c,u)-2*o;S=Math.min(S,3*s/4),native$.setStyles_(i,map_(["top",`${o}px`],["left",`${o}px`],["max-width",`${d}px`],["max-height",`${S}px`]));const p=native$.getBoundingClientRect_(i),m=native$.getBoundingClientRect_(e),g=Math.round(m.left+m.width/2),f=Math.round(m.top);let C=Math.round(p.width),T=f-Math.round(p.height)-o/2-c,A=g-C/2-_;T<o&&(T=o),A+_+C+o>n&&(A=n-_-C-o),A<o&&(A=o),native$.setStyles_(i,map_(["top",`${T+c}px`],["left",`${A+_}px`])),native$.setStyles_(t,map_(["top",`-${c-r}px`],["left",`-${_-a}px`],["width",`${n}px`],["height",`${s}px`],["visibility",null]))}_hideAnnotations(){const t=native$.iQueryAll_(`div.${CSS.xAnnotation} > div.${CSS.xSmokescreen}`);for(const e of t)_MainPanel._hideAnnotation1(e)}static _hideAnnotation1(t){const e=_MainPanel._startGroup(RS.action_AnnotationHide,"");native$.setStyles_(t,map_(["display",null],["top",null],["left",null],["width",null],["height",null]));const i=JsUtil.childElementWithClass_(t,CSS.xAnnotationContent);null!=i&&native$.setStyles_(i,map_(["top",null],["left",null],["max-width",null],["max-height",null])),_MainPanel._endGroup(e)}_enableEditActions(t){const e=native$.iQueryAll_(`.${CSS.xTemplateButton}`),i=t?"block":null;for(const t of e)native$.setDisplay_(t,i);const n=native$.iGetElementById_(ID.xRightSidebar);null!=n&&n.classList.remove(CSS.xHidden)}_processPlaceholdersOnSave(t){t()}_updateAudioInfos(t){const e=native$.iQueryAll_(`[${ATTR.xPlaceholder}]`),i=new Array;for(const t of e){const e=t.getAttribute(ATTR.xPlaceholder);Placeholder.xpAudioinfo==e&&i.push(t)}_MainPanel._processPlaceholdersAudioInfos(i,t)}processPlaceholders_(t,e){const i=native$.getIFrameUri_();null!=t&&0!=t.length&&null!=i?this._processPlaceholders1(t,i,e):e(null)}_processPlaceholders1(t,e,i){const n=_MainPanel._startGroup(RS.history_placeholders,""),s=new Array,o=new Array,l=Array.from(t);for(let e=l.length;e>0;){const i=l[--e],n=i.getAttribute(ATTR.xPlaceholder);let a=null;switch(n){case Placeholder.xpDatetime:case Placeholder.xpShortDatetime:case Placeholder.xpDate:case Placeholder.xpShortDate:case Placeholder.xpTime:case Placeholder.xpShortTime:a=new _PlaceholderDateFormatter(i,n);break;case Placeholder.xpAudioinfo:s.push(i),t.splice(e,1);break;case Placeholder.xpVideoinfo:o.push(i),t.splice(e,1)}null!=a&&null!=a.datestring&&(i.removeAttribute(ATTR.xPlaceholder),An.setDatetime(i,a),t.splice(e,1))}_MainPanel._processPlaceholdersAudioInfos(s,()=>{_MainPanel._processPlaceholdersVideoInfos(o,()=>{this._processPlaceholders2(t,e,t=>{_MainPanel._endGroup(n),i(t)})})})}_processPlaceholders2(t,e,i){let n=null;const s=An.cdirOfUri_(e);An.iterateList_(t,(t,i,o)=>{switch(t.getAttribute(ATTR.xPlaceholder)){case Placeholder.xpCanvas:t.classList.contains(CSS.xCanvas)||o(!1),t.removeAttribute(ATTR.xPlaceholder),this._actionAnnotateCanvas0(t,e=>{e||_MainPanel._destroyDrawing(t),o(!1)});break;case Placeholder.xpCanvasImage:native$.hasClass_(t,CSS.xCanvas)||o(!1),t.removeAttribute(ATTR.xPlaceholder),this._actionAnnotateCanvasImage(t,s,e=>{e||_MainPanel._destroyDrawing(t),o(!1)});break;case Placeholder.xpAudio:case Placeholder.xpAudio2:case Placeholder.xpVideo:o(!1);break;case Placeholder.xpPhoto:case Placeholder.xpAnnotationPhoto:case Placeholder.xpCanvasPhoto:o(!1);break;case Placeholder.xpImage:{t.removeAttribute(ATTR.xPlaceholder),n=native$.iSelectContents_(t);const e=native$.getIFrameUri_();null!=n&&null!=e&&_MainPanel._actionInsertImg1(n,`class ${CSS.xImageholder}`,e,()=>{o(!1)}).show_();break}case Placeholder.xpImageNoCaption:{t.removeAttribute(ATTR.xPlaceholder),n=native$.iSelectContents_(t);const e=native$.getIFrameUri_();if(null!=n&&null!=e){const t=_MainPanel._actionInsertImg1(n,`class ${CSS.xImageholder}`,e,()=>{o(!1)});t.showCaption_(!1),t.show_()}break}case Placeholder.xpCalendar:{t.removeAttribute(ATTR.xPlaceholder);const e=cache$.ui$.buttonSize_(),i=new PromptCalendar(accessories$,e);i.titleKey_(RS.PromptDateTimeTitle),i.zindex_(DEF.zindexPrompt),i.dateFormat_(settings$.monthFormat_()),i.onOK_((e,i,s,l)=>{null==l&&(l=settings$.monthString_(e));const a=native$.getIFrameDocument_();if(null!=a){const o=_MainPanel._createCalendar(a,e,null,i,s,l);new DomBuilderEx(t).empty_().appendNodes_(o);const r=native$.iQuery(`div.${CSS.xCalHead} span`,o);null!=r&&(n=native$.iSetCaretAtStart_(r))}o(!1)}),i.onCancel_(()=>{o(!1)}),i.show_();break}case Placeholder.xpAnnotationImage:{t.removeAttribute(ATTR.xPlaceholder);const e=DomBuilderEx.createText_(MSG.XXX$);new DomBuilderEx(t).empty_().appendNodes_(e);const i=native$.iSelectNode_(t);null==i?o(!1):_WidgetTemplates._annotationImage(i,()=>{o(!1)});break}case Placeholder.xpAnnotation:{t.removeAttribute(ATTR.xPlaceholder);const i=DomBuilderEx.createText_(MSG.XXX$);new DomBuilderEx(t).empty_().appendNodes_(i);const s=native$.iSelectNode_(t);null!=s&&_WidgetTemplates._annotation(s,e,()=>{n=native$.iSelectNode_(i),o(!1)});break}case Placeholder.xpDraggable:t.removeAttribute(ATTR.xPlaceholder),this.actionEditSize0_(t,()=>{o(!1)});break;default:o(!1)}},()=>{i(n)})}static _destroyDrawing(t){const e=JsUtil.parentOrSelfWithClasses_(t,[CSS.xxDrawing]);null!=e&&JsUtil.remove_(e)}static _startGroup(t,e){return null!=history$&&(history$.startGroup_(t,e),!0)}static _endGroup(t){t&&null!=history$&&history$.endGroup_()}static audioInfos_(t,e){host$.audioInfos_([json_([Key.path,t],[Key.time,0])],i=>{var n;e(null===(n=i[Key.result])||void 0===n?void 0:n[t])})}static videoInfos_(t,e){host$.videoInfos_([json_([Key.path,t],[Key.time,0])],i=>{var n;e(null===(n=i[Key.result])||void 0===n?void 0:n[t])})}static _updateAudioInfo(t,e){const i=_MainPanel._startGroup(RS.action_UpdateAudioInfo,"");t.removeAttribute(ATTR.xTooltips),_MainPanel._processPlaceholdersAudioInfos([t],()=>{_MainPanel._endGroup(i),e()})}static _updateVideoInfo(t,e){const i=_MainPanel._startGroup(RS.action_UpdateVideoInfo,"");t.removeAttribute(ATTR.xTooltips),_MainPanel._processPlaceholdersVideoInfos([t],()=>{_MainPanel._endGroup(i),e()})}static _getPlaceholderInfo(t){const e=t.tagName;return"AUDIO"==e||"VIDEO"==e?t.getAttribute(ATTR.xInfo):null}static _processPlaceholdersAudioInfos(t,e){var i;const n=native$.getIFrameUri_();if(0==t.length||null==n)return void e();const s=new Array,o=new Array;for(const e of t){let t=null;const l=_MainPanel._audioInfoAnchor(e);if(o.push(l),null!=l){const e=this._getPlaceholderInfo(l);t=An.cpathOfHref2_(n,null!==(i=null!=e?e:l.getAttribute("src"))&&void 0!==i?i:l.getAttribute("href"))}if(null==t){s.push({});continue}const a=An.parseInt_(e.getAttribute(ATTR.xTooltips),-1);s.push(json_([Key.path,t],[Key.time,a]))}host$.audioInfos_(s,i=>{var n;if(An.hasMessage_(i))return void e();const l=null!==(n=i[Key.result])&&void 0!==n?n:null;if(null==l)return void e();const a=_MainPanel._startGroup(RS.action_UpdateAudioInfo,"");Ut.asyncIterate_(t,(t,e,i)=>{const n=s[e][Key.path];if(null!=n&&null!=l){const t=l[n];if(null!=t&&0==Object.keys(t).length)return void i()}const a=o[e],r=native$.iQuery(`.${CSS.xAudioFilename}`,t),_=native$.iQuery(`.${CSS.xAudioFilesize}, .${CSS.xMediaFilesize}`,t),c=native$.iQuery(`.${CSS.xAudioDatetime}`,t),h=native$.iQuery(`.${CSS.xAudioDuration}`,t),u=native$.iQuery(`.${CSS.xAudioRate}`,t),d=native$.iQuery(`.${CSS.xAudioChannels}`,t),S=[[c,h],[r,u],[_,d]];if(null==n||null==l)return _MainPanel._mediaInfoError(t,a,S),void i();const p=l[n];this._updateMediaInfo(p,a,()=>{var e,s,o;const l=MediaInfo.of_(p),m=null!==(e=null==l?void 0:l.error_())&&void 0!==e?e:null,g=null!==(s=null==l?void 0:l.fileExists_())&&void 0!==s&&s;if(null==l||null!=m||!g)return _MainPanel._mediaInfoError(t,a,S),void i();const f=null!==(o=l.fileDate_())&&void 0!==o?o:0;JsUtil.setAttribute_(t,ATTR.xTooltips,f.toString()),_MainPanel._updateAudioinfo0(a,r,_,c,h,u,d,n,l),i()})},()=>{_MainPanel._endGroup(a),e()})})}static _updateMediaInfo(t,e,i){if(null==e||"AUDIO"!=e.tagName&&"VIDEO"!=e.tagName)return void i();const n=e;n.setAttribute("preload","none"),Timer.frame11_(()=>{const e=()=>{if(n.removeEventListener("loadedmetadata",e),t[MediaInfo.Duration]=n.duration,"VIDEO"==n.tagName){const e=n;t[MediaInfo.Width]=e.videoWidth,t[MediaInfo.Height]=e.videoHeight}};n.addEventListener("loadedmetadata",e),n.setAttribute("preload","metadata"),i()})}static _updateAudioInfo1(t,e,i){const n=native$.iQuery(`a.${CSS.xAudio}`,t),s=native$.iQuery(`.${CSS.xAudioFilename}`,t),o=native$.iQuery(`.${CSS.xAudioFilesize}, .${CSS.xMediaFilesize}`,t),l=native$.iQuery(`.${CSS.xAudioDatetime}`,t),a=native$.iQuery(`.${CSS.xAudioDuration}`,t),r=native$.iQuery(`.${CSS.xAudioRate}`,t),_=native$.iQuery(`.${CSS.xAudioChannels}`,t),c=i.error_(),h=i.fileExists_();if(null!=i&&null==c&&h)_MainPanel._updateAudioinfo0(n,s,o,l,a,r,_,e,i);else{const e=[[l,a],[s,r],[o,_]];_MainPanel._mediaInfoError(t,n,e)}}static _updateAudioinfo0(t,e,i,n,s,o,l,a,r){var _;if(null!=e&&new DomBuilderEx(e).empty_().text_(Basepath.nameWithSuffix_(a)),null!=i){const t=new DomBuilderEx(i).empty_(),e=r.fileSize_();null!=e&&t.text_("  "+An.filesizeUnit4_(e))}if(null!=n){const t=r.creationDate_(),e=Math.round(1e3*r.duration1_(0)),i=null!==(_=r.fileDate_())&&void 0!==_?_:e,s=null!=t?DateTime.fromMillisecondsSinceEpoch_(Math.max(0,t-e),!0):DateTime.fromMillisecondsSinceEpoch_(Math.max(0,i-e),!1),o=JsUtil.datetimeStringWithXFormat_(n,settings$.dateFormat_(),"",s);new DomBuilderEx(n).empty_().addClass_(CSS.xDate).text_(o)}if(null!=s){const t=r.duration_(),e=null==t||isNaN(t)||!isFinite(t)?"??:??":An.timeStringFromSeconds_(t);new DomBuilderEx(s).empty_().text_(e)}if(null!=o){let t="??";const e=r.bitrate_(),i=new DomBuilderEx(o).empty_();null!=e&&e>0&&(t=`${An.decUnit4_(e)}${MSG.string_(RS.BitPerSecond)}`),i.text_(t)}if(null!=l){let t="?";const e=r.channels_();null!=e&&e>1&&(t=` ${e} `+MSG.string_(RS.AudioChannels)),new DomBuilderEx(l).empty_().text_(t)}null!=t&&t.classList.remove(CSS.xxError)}static _mediaInfoError(t,e,i){if(t.removeAttribute(ATTR.xTooltips),null!=e&&e.classList.add(CSS.xxError),i.length>=1){for(const t of i[0])null!=t&&new DomBuilderEx(t).empty_().text_("??:??");if(i.length>=2){for(const t of i[1])null!=t&&new DomBuilderEx(t).empty_().text_("??");if(i.length>=3)for(const t of i[2])null!=t&&(t.classList.contains(CSS.xVideoPoster)?_MainPanel._emptyPosterElement(t):new DomBuilderEx(t).empty_())}}}static _audioInfoAnchor(t){var e;return t.classList.contains(CSS.xAudio)?t:null!==(e=native$.iQuery(`audio.${CSS.xAudio}`,t))&&void 0!==e?e:native$.iQuery(`a.${CSS.xAudio}`,t)}static _videoInfoAnchor(t){var e;return t.classList.contains(CSS.xVideo)?t:null!==(e=native$.iQuery(`video.${CSS.xVideo}`,t))&&void 0!==e?e:native$.iQuery(`a.${CSS.xVideo}`,t)}static _processPlaceholdersVideoInfos(t,e){var i;const n=native$.getIFrameUri_();if(0==t.length||null==n)return void e();const s=[],o=[];for(const e of t){let t=null,l=null;const a=_MainPanel._videoInfoAnchor(e);if(o.push(a),null!=a){const e=null!==(i=a.getAttribute("src"))&&void 0!==i?i:a.getAttribute("href");null!=e&&(t=An.cpathOfHref2_(n,e))}if(null==t){s.push({});continue}const r=new _VideoParam;null!=l&&_MainPanel._getVideoParams(r,l);const _=An.parseInt_(e.getAttribute(ATTR.xTooltips),-1);s.push(json_([Key.path,t],[Key.time,_],[Key.poster,r.poster]))}host$.videoInfos_(s,i=>{var n;if(An.hasMessage_(i))return void e();const l=null!==(n=i[Key.result])&&void 0!==n?n:null;if(null==l)return void e();const a=_MainPanel._startGroup(RS.action_UpdateVideoInfo,"");Ut.asyncIterate_(t,(t,e,i)=>{var n;const a=null!==(n=s[e][Key.path])&&void 0!==n?n:null;if(null==a)return void i();if(null!=l){const t=l[a];if(null!=t&&0==Object.keys(t).length)return void i()}const r=o[e],_=l[a];this._updateMediaInfo(_,r,()=>{const e=MediaInfo.of_(_);_MainPanel._updateVideoInfo0(t,r,a,e),i()})},()=>{_MainPanel._endGroup(a),e()})})}static _updateVideoInfo0(t,e,i,n){var s;const o=native$.iQuery(`.${CSS.xVideoFilename}`,t),l=native$.iQuery(`.${CSS.xVideoFilesize}, .${CSS.xMediaFilesize}`,t),a=native$.iQuery(`.${CSS.xVideoDatetime}`,t),r=native$.iQuery(`.${CSS.xVideoDuration}`,t),_=native$.iQuery(`.${CSS.xVideoResolution}`,t),c=native$.iQuery(`.${CSS.xVideoPoster}`,t),h=[[a,r],[o],[l,_,c]];if(0==i.length||null==n)return void _MainPanel._mediaInfoError(t,e,h);const u=n.error_(),d=n.fileExists_(),S=null!==(s=n.fileDate_())&&void 0!==s?s:0;null!=n&&null==u&&d?(JsUtil.setAttribute_(t,ATTR.xTooltips,S.toString()),1==n.playable_()?_MainPanel._updateVideoInfo1(t,e,o,l,a,_,r,c,i,n):_MainPanel._mediaInfoError(t,e,h)):_MainPanel._mediaInfoError(t,e,h)}static _updateVideoInfo1(t,e,i,n,s,o,l,a,r,_){var c;if(null!=e&&e.classList.remove(CSS.xxError),null!=i&&new DomBuilderEx(i).empty_().text_(Basepath.nameWithSuffix_(r)),null!=n){const t=new DomBuilderEx(n).empty_(),e=_.fileSize_();null!=e&&t.text_("  "+An.filesizeUnit4_(e))}if(null!=s){const t=_.creationDate_(),e=1e3*_.duration1_(0),i=null!==(c=_.fileDate_())&&void 0!==c?c:e,n=null!=t?DateTime.fromMillisecondsSinceEpoch_(Math.max(0,t-e),!0):DateTime.fromMillisecondsSinceEpoch_(Math.max(0,i-e),!1),o=JsUtil.datetimeStringWithXFormat_(s,settings$.dateFormat_(),"",n);new DomBuilderEx(s).empty_().addClass_(CSS.xDate).text_(o)}if(null!=l){const t=Math.round(_.duration_()),e=null==t||isNaN(t)||!isFinite(t)?"??:??":An.timeStringFromSeconds_(t);new DomBuilderEx(l).empty_().text_(e)}if(null!=o){const t=_.width_(),e=_.height_();let i="?? x ??";null!=t&&null!=e&&t>0&&e>0&&(i=`${t} x ${e}`),new DomBuilderEx(o).empty_().text_(i)}if(null!=a){const t=_.dataUrl_(),i=["max-width","max-height"];if(null!=t){const n=native$.getInlineStyles_(a,i),s=smapOf_("src",t);n.size>0&&(s.style=CSSUtil.joinStyles_(n)),null==e||e.classList.remove(CSS.xxBullet),new DomBuilderEx(a).empty_().div_().append_("img",s).append_("div",{class:CSS.xPlay})}else _MainPanel._emptyPosterElement(a),null==e||e.classList.add(CSS.xxBullet)}}static _emptyPosterElement(t){const e=native$.iQuery("img",t);if(null!=e){const i=native$.getInlineStyles_(e,["max-width","max-height"]);i.size>0&&native$.setStyles_(t,i)}new DomBuilderEx(t).empty_()}stopEdit(t,e=null){this._onStopEdit(()=>{if(_state=_State.BROWSING,t){this._mainToolbar.setEnabled(!1);const t=this._saveSession(null);null!=t&&this.addIFrameReadyOneshotCallback(i=>{this._restoreSession(t),this._mainToolbar.setEnabled(!0),i(),null==e||e()}),Timer.sleep00_(()=>{native$.reload_()})}else null==e||e()})}_restoreSession(t){if(null==t)return;const e=An.ifnull_(t[SessionParam.x],0),i=An.ifnull_(t[SessionParam.y],0),n=t[SessionParam.type];if(e>0||i>0)if(null==n);else if(SessionParam.XROOT==n||SessionParam.X_ROOT==n){const t=native$.iQuery(`.${CSS.xRoot}`);null!=t&&(t.scrollLeft=e,t.scrollTop=i)}}cancelEdit(){const t=cache$.ui$.rem_(),e=cache$.ui$.buttonSize_(),i=Math.min(Math.max(12*t,8*t+3*e),3*window.innerWidth/4),n=new PromptOKFixedSize(accessories$,i,e);n.titleKey_(RS.Confirm),n.messageKey_(RS.CancelEdit),n.zindex_(DEF.zindexPrompt),n.onOK_(t=>{t(!0),host$.hideKeyboard_(()=>{const t=this._onBeforeSaveForPause();if(null!=t){const e=native$.serializeIFrameDocument_();host$.saveRecovery_(t,e,t=>{toasters$.warn_(t),this.stopEdit(!0)})}})}),n.showWarning_()}addIFrameReadyCallback(t){this._iframeReadyCallbacks.push(t)}addIFrameReadyCallback0(t){this._iframeReadyCallbacks.push(e=>{e(),t()})}removeIFrameReadyCallback(t){return An.identityRemove_(this._iframeReadyCallbacks,t)}addIFrameReadyOneshotCallback(t){this._iframeReadyOneshotCallbacks.push(t)}addIFrameReadyOneshotCallback0(t){this._iframeReadyOneshotCallbacks.push(e=>{e(),t()})}onIFrameLoad(t){var e,i;this._navigation=RecentsCmd.INFO;let n=_State.INVALID,s=settings$.getUrl_(Conf.errorPath);this._resetIFrame();const o=native$.getIFrameWindow_();native$.iAddEventListener_(o,"dragstart",t=>this._dragStartListener(t),!0,!0),native$.iAddEventListener_(o,"drag",t=>this._dragListener(t),!0,!0),native$.iAddEventListener_(o,"drop",t=>this._dropListener(t),!0,!0);const l=null!==(e=null==docInfo$?void 0:docInfo$.uri$)&&void 0!==e?e:null;t:{const e=null!==(i=null==docInfo$?void 0:docInfo$.fileInfo$)&&void 0!==i?i:null;if(null==e||e.notexists$){s=settings$.getUrl_(Conf.notfoundPath),s+=native$.asPathQuery_(l);break t}if(!e.readable$||e.isdir$)break t;if(null==l)break t;if(null!=l.queryParameters$.get(Param.view)){const t=MimeUtil.mediaMimeFromUri(l);if(null==t)break t;n=this._onIFrameViewerReady(l,t)}else if(l.path$.endsWith(".pdf"))n=this._onIFrameViewerReady(l,MimeUtil.PDF);else if(l.path$.endsWith(".html")){const t=native$.getIFrameWindow_();if(null==t)break t;native$.fixIFrameHrefs_(),native$.fixIFrameSrcs_(),native$.fixIFrameStyles_(),native$.fixIFrameRightsidebar_(),native$.fixIFrameMedia_(),n=this._onIFrameDocReady(t)}if(_state=n,this._mainToolbar.onIFrameLoad(t),_state==_State.INVALID)break t;const o=[];return ArrayUt.addAll_(o,...this._iframeReadyCallbacks),ArrayUt.addAll_(o,...this._iframeReadyOneshotCallbacks),this._iframeReadyOneshotCallbacks.length=0,void An.iterateList_(o,(t,e,i)=>{Timer.sleep1_(()=>{t(()=>{i(!1)})})},()=>{})}this._iframeReadyOneshotCallbacks.length=0,_Util.browse_(An.parseUriSafe_(s,null),s)}onIFrameError(){this._iframeReadyOneshotCallbacks.length=0}onIFrameUnload(t){for(An.ignoreException_(()=>{if(this._showRightsidebar(),_state==_State.EDITING){const e=null==t?null:An.cpathOfUri_(t);if(null!=e){const t=native$.serializeIFrameDocument_();this.stopEdit(!1,()=>{host$.saveRecovery_(e,t,t=>{toasters$.warn_(t);const e=_Util.promptWarning_(RS.EditAbortedTitle,MSG.string_(RS.editAbortedMessage));e.zindex_(DEF.zindexPrompt),e.onDismiss_(()=>{}),e.show_()})})}}const e=native$.getIFrameContextPath_();if(null!=e){const t=this._saveSession(null);host$.recentsPut_(this._navigation,e,t,t=>toasters$.warn_(t))}this._navigation=RecentsCmd.INVALID});this._iframeUnloadCallbacks.length>0;){const t=this._iframeUnloadCallbacks.pop();An.ignoreException_(()=>{t()})}null!=this._iframeMediaViewer&&this._iframeMediaViewer.hide_(),An.ignoreException_(()=>{this._resetIFrame()}),_state=_State.INVALID,this._mainToolbar.onIFrameUnload()}_saveSession1(t){return this._saveSession(_state==_State.VIDEO?null==t?void 0:t.queryParameters$:null)}_saveSession(t){var e,i;if(_state==_State.EDITING||_state==_State.BROWSING){let t=0,e=0,i=null;const n=native$.iQuery(`.${CSS.xRoot}`);return null!=n&&(t=n.scrollLeft,e=n.scrollTop,i=SessionParam.XROOT),json_([SessionParam.type,i],[SessionParam.x,t],[SessionParam.y,e])}if(_state==_State.AUDIO){if(null==this._iframeMediaViewer)return null;let t=0,n=0;const s=this._iframeMediaViewer;return null!=s&&null!=s.player$&&(t=null!==(e=s.player$.played$)&&void 0!==e?e:0,n=null!==(i=s.player$.total$)&&void 0!==i?i:0),smap_([SessionParam.x,t],[SessionParam.y,n])}if(_state==_State.IMAGE)return{};if(_state==_State.VIDEO){const e=json_(),i=null==t?null:An.parseInt_(t.get(Param.poster),null);null!=i&&(e[SessionParam.poster]=i);const n=null==t?null:An.parseInt_(t.get(Param.seek),null);return null!=n&&(e[SessionParam.x]=n),e}return _state==_State.PDF?{}:null}_resetIFrame(){this._iframeUnloadCallbacks.length=0,this._iframeMediaViewer=null,this._videographer=null,sidePanel$.hideSidepanel_(),this._hideAnnotations(),_Util.hideContextmenus_()}onWindowSizeChanged(){var t;this._contextmenu.destroy_(),this._contextmenu=this._createMainContextmenu(),null===(t=this._iframeMediaViewer)||void 0===t||t.onresize_(null,null),_state!=_State.EDITING&&_state!=_State.BROWSING||this._hideAnnotations()}_onIFrameDocReady(t){const e=t.document;if(null==e)return _State.INVALID;const i=e.body;if(null==i)return _State.INVALID;const n=_State.BROWSING;if(this._metainfo=new _Metainfo(native$.iGetMetainfo_()),_Hacks.fixBody(),gestureHandler$.push_(GestureEvent.rightOutward,_MainPanel._toggleRightSidebarHandler),this._addIFrameUnloadCallback(()=>{gestureHandler$.pop_(GestureEvent.rightOutward),gestureHandler$.pop_(GestureEvent.rightInward)}),null!=docInfo$){const t=docInfo$.uri$;if(null!=t){t.queryParameters$.has(Param.edit)&&docInfo$.fileInfo$.writable$&&this.addIFrameReadyOneshotCallback(t=>this.startEditCallback(t));const e=t.queryParameters$.get(Param.session),i=An.parseJSONObjectOrNull_(e);null!=i&&this.addIFrameReadyOneshotCallback(t=>{this._restoreSession(i),t()})}}return native$.iAddEventListener_(t,Conf.touchstart,t=>{if("touchstart"==Conf.touchstart){const e=t;if(e.touches.length>0){const t=e.touches[0];this._docClickX=Math.round(t.screenX),this._docClickY=Math.round(t.screenY),searchSpotlight$.hide_()}}this._clientActionHideDone();const e=t.target,i=e.getAttribute(ATTR.xButton);if(null!=i&&i.startsWith(ClientAction.hide))return JsUtil.stopevent_(t),void this._clientActionHide(i,e);if(null!=i&&i.startsWith(ClientAction.show))return JsUtil.stopevent_(t),void this._clientActionShow(i,e);const n=e.nodeName;"INPUT"!=n&&"BUTTON"!=n||_MainPanel._isSupportedInputType(e.getAttribute("type"))||JsUtil.stopevent_(t)},!0,!0),native$.iAddEventListener_(t,Conf.touchend,t=>{const e=this.isEditing();if("touchend"==Conf.touchend){const e=t.changedTouches;if(null!=e){if(e.length>0){const t=e[0],i=Math.round(t.screenX),n=Math.round(t.screenY),s=i-this._docClickX,o=n-this._docClickY;if(s*s+o*o>64)return}}}host$.heartbeat_(),e&&this._mainToolbar.showMainbar_();const i=t.target;this._idocClickHandler(e,this._lastIFrameSelectionRange,i,t)},!0,!0),native$.iAddEventListener_(i,"contextmenu",t=>{JsUtil.stopevent_(t),_MainPanel._openCSS0(1==t.shiftKey)},!0),n}static _openCSS0(t){if(_state!=_State.BROWSING&&_state!=_State.EDITING)return;if(null==docInfo$||Smokescreen.liveCount()>0)return;const e=native$.getIFrameContextPath_();if(null==e)return;const i=new Basepath(e),n=i.dir$,s=i.dirAndNameWithoutSuffix_()+DEF.cssSuffix;_MainPanel._getLastWritableIFrameStylesheetContextPath(e=>{null!=e?t?_MainPanel._openCSS1(e,!0):_MainPanel._promptCSS(n,e):_MainPanel._promptCSS(n,s)})}static _getLastWritableIFrameStylesheetContextPath(t){const e=native$.getIFrameDocument_();if(null==e)return void t(null);const i=Array.from(e.styleSheets).reverse(),n=native$.getIFrameUri_();0!=i.length&&null!=n?An.iterateList_(i,(e,i,s)=>{const o=null==e?null:e.href,l=An.cpathOfHref2_(n,o);if(null==l)return void s(!1);const a=e.ownerNode;"LINK"==(null==a?void 0:a.nodeName)?fileinfoUt$.fileInfo_(l,e=>{if(An.hasMessage_(e))return void s(!1);const i=FileInfo.of_(e[Key.fileinfo]);null!=i&&i.writable$?(s(!0),t(l)):s(!1)}):s(!1)},()=>{t(null)}):t(null)}static _promptCSS(t,e){const i=_Util.promptFilepath_(MSG.string_(RS.CSS),FilepickerKind.ANY,"",t,e);i.setDelegate_(FilepickerCssDelegate.singleton$),i.zindex_(DEF.zindexPrompt),i.onOK_((t,e,i)=>{t(!0),i.exists$?_MainPanel._openCSS1(e,i.writable$):_MainPanel._newCSS1(e)}),i.show_()}static _openCSS1(t,e){host$.readCSS_(t,i=>{var n;if(toasters$.warn_(i))return;const s=null!==(n=i[Key.status])&&void 0!==n?n:null;_MainPanel._openCSS2(e,t,i[Key.result],s)})}static _openCSS2(t,e,i,n){_MainPanel._addStylesheetLink(e),toasters$.info_(Basepath.nameWithSuffix_(e),{attop:!1});const s=new CSSEditor(accessories$,gestureHandler$,e,t,t,i.trim(),n);s.zindex_(DEF.zindexPrompt),s.show_()}static _newCSS1(t){host$.saveCSS_(t,"",null,e=>{toasters$.warn_(e)||_MainPanel._openCSS2(!0,t,"",[1,1])})}static _addStylesheetLink(t){const e=native$.getIFrameUri_();if(!mainPanel$.isEditing()||null!=native$.findIFrameStylesheet_(t)||null==e)return;let i=t;const n=An.cdirOfUri_(e);if(PathUtil.isDocumentsSubtree(t)&&null!=n){const e=An.rpath2_(n,t);null!=e&&(i=e)}const s=An.uriOfFilepath2_(e,i);if(null==s)return void toasters$.warn_(MSG.string_(RS.InvalidURL));const o=native$.getIFrameDocument_();if(null==o)return;const l=o.head,a=smap_(["rel","stylesheet"],["href",s.toString()],["type",MimeUtil.CSS]);new DomBuilderEx(l).append_("LINK",a)}static _isValidInputElement(t){const e=DomUt.asHTMLElement_(t);if(null!=e){const t=e.nodeName;if("TEXTAREA"==t||"SELECT"==t||"OPTION"==t)return!0;if(("INPUT"==t||"BUTTON"==t)&&_MainPanel._isSupportedInputType(e.getAttribute("type")))return!0}return!1}static _isSupportedInputType(t){return null==t||0==t.length||(t=t.trim().toLowerCase(),_MainPanel._VALID_INPUT_TYPE.has(t))}static _toggleRightSidebarHandler(){return Timer.sleep1_(()=>{if(null==docInfo$||Smokescreen.liveCount()>0)return;const t=native$.iGetElementById_(ID.xRightSidebar);null!=t&&t.classList.toggle(CSS.xHidetemp)}),!0}_cancelShowRightsidebar(){null!=this._hideRightSidebarTimer&&(this._hideRightSidebarTimer.cancel_(),this._hideRightSidebarTimer=null)}_showRightsidebar(){var t;this._cancelShowRightsidebar(),null===(t=native$.iGetElementById_(ID.xRightSidebar))||void 0===t||t.classList.remove(CSS.xHidetemp)}_idocClickHandler(t,e,i,n){if(null==i)return;const s=i.nodeType,o=i.nodeName;if(s!=Node.ELEMENT_NODE)return;const l=Array.from(i.classList);if(t&&l.includes(CSS.xPlaceholder)){const t=native$.getIFrameUri_();null!=t&&_MainPanel._onPlaceholder1(i,o,t,n)}else t&&this._idocClickEditing(i,e,o,l)?JsUtil.stopevent_(n):this._idocClickBoth(i,t,s,o,l)?JsUtil.stopevent_(n):this._idocClickBubbleBoth(i,t,o)?JsUtil.stopevent_(n):t||!this._idocClickBrowsing(i,e,o,l)?l.includes(CSS.xBubble)&&this._idocClickHandler(t,e,i.parentElement,n):JsUtil.stopevent_(n)}_idocClickBoth(t,e,i,n,s){var o;if(s.includes(CSS.xSmokescreen))return host$.hideKeyboard_(()=>{let e=!1;if(null!=history$){const i=t.parentElement;null!=i&&i.classList.contains(CSS.xAnnotation)&&(history$.startGroup_(RS.action_AnnotationHide,""),e=!0)}for(const e of native$.iQueryAll_(`div.${CSS.xSmokescreen}`,t))native$.setDisplay_(e,null);native$.setDisplay_(t,null),e&&history$.endGroup_()}),!0;if(s.includes(CSS.xRightSidebarPadding))return this._cancelShowRightsidebar(),null===(o=native$.iGetElementById_(ID.xRightSidebar))||void 0===o||o.classList.add(CSS.xHidetemp),this._hideRightSidebarTimer=new Timer(DEFUtil.hideRightSidebarDuration$,()=>{this._showRightsidebar()}),!0;const l=_TemplateAction.parse_(t.getAttribute(ATTR.xButton));if(null!=l){const e=native$.iSelectNode_(t);return l.run_(t,e,null),!0}if(s.includes(CSS.xAnnotation)&&(e||!s.includes(CSS.xPeek))&&null!=_MainPanel._showAnnotation(t,e,n))return!0;if(s.includes(CSS.xAnnotationTarget)){const i=t.parentElement;if(null!=i&&"DIV"==i.nodeName){const t=i.classList;if(t.contains(CSS.xAnnotation)&&(e||!t.contains(CSS.xPeek)))return _MainPanel._showAnnotation0(i),!0}return!1}if(s.includes(CSS.xSlideshow))return AVALUE.xStop!=t.getAttribute(ATTR.xInfo)&&this._showSlides(t),!0;if(s.includes(CSS.xSlideshowImage)){const e=t.parentElement;if(null!=e){const i=t.style.opacity;An.parseDouble_(i,1)>.75?e.setAttribute(ATTR.xInfo,AVALUE.xStop):AVALUE.xStop!=e.getAttribute(ATTR.xInfo)&&this._showSlides(e)}return!0}const a=t.getAttribute("id");return ID.xOpenRightSidepanel==a?(native$.setDisplayById_(ID.xRightSidepanel,"block"),!0):ID.xOpenLeftSidepanel==a&&(native$.setDisplayById_(ID.xLeftSidepanel,"block"),!0)}_idocClickBrowsing(t,e,i,n){if(n.includes(CSS.xAlarm))return _MainPanel._showEventsPanel(t),!0;if(n.includes(CSS.xRightSidebarTab)){const i=t.getAttribute(ATTR.xTemplate);if(null!=i&&i.length>0&&i.startsWith("{"))try{const n=An.parseJSONObjectOrNull_(i);if(null!=n&&"object"==typeof n)return this._rsbTabAction(t,()=>{this._browsingTemplateAction(t,n,e,An.noop_)}),!0}catch(t){}}const s=this._getxAudio(t,n),o=native$.getIFrameUri_();if(null!=s&&null!=o){const t=s.getAttribute("href");if(this._playxaudio(t,o))return!0}const l=this._getxVideo(t,n);if(null!=l&&null!=o){const t=l.getAttribute("href"),e=An.parseUriSafe_(t,o);if(this._playxvideo(e))return!0}const a=t.getAttribute(ATTR.xPageTemplate);if(null!=a)return _MainPanel._pageTemplate(a),!0;const r=CSSUtil.validateClassesOf(t.getAttribute(ATTR.xAction));if(1==(null==r?void 0:r.includes(XAction.view)))if("IMG"==i||"PICTURE"==i){const e=t.getAttribute("src"),i=An.parseUriSafe_(e,o);if(null!=i&&MimeUtil.isImagePath(i.path$)){const t=An.addViewParam_(i,o);if(null!=t)return native$.browse_(t),!0}}else if("VIDEO"==i&&null!=l&&null!=o){const t=l.getAttribute("src"),e=An.parseUriSafe_(t,o),i=null==e?null:An.cpathOfUri_(e);if(null!=i&&null!=MimeUtil.videoMimeFromPath(i)){const t=l;this._pauseOnPlay(t);const e=new FullscreenVideoPlayer(accessories$,t).on_("click",()=>{t.currentTime=e.currentTime_(),e.destroy_()});e.show_()}}return!1}_playxaudio(t,e){const i=An.cpathOfHref2_(e,t);return null!=i&&null!=MimeUtil.audioPlaybackMimeFromPath(i)&&(_AudioPlayerDialog.createAndShow_(accessories$,i),!0)}_playxvideo(t){const e=null==t?null:An.cpathOfUri_(t);if(null!=e&&null!=MimeUtil.videoMimeFromPath(e)){const i=new _VideoParam;return null!=t&&_MainPanel._getVideoParams(i,t),host$.playVideo_(e,!1,i.seek,i.poster,t=>{toasters$.warn_(t)}),!0}return!1}_idocClickEditing(t,e,i,n){var s;if(n.includes(CSS.xCanvas))return host$.hideKeyboard_(()=>{native$.iClearSelection_(),this._actionAnnotateCanvas(t,()=>{})}),!0;if(n.includes(CSS.xImageholder))return _MainPanel._onImageHolder(t),!0;const o=t.getAttribute(ATTR.xTemplate);if(null!=o)return history$.startGroup_(RS.history_templateButtonAction,""),this._rsbTabAction(t,()=>{this._templateAction(t,o,e,t=>{_MainPanel._recalculateTotals(),history$.endGroup_(),null==t?native$.iRemoveSelections_():native$.iSelectRange_(t)})}),!0;if(n.includes(CSS.xCalcTotal)||n.includes(CSS.xCalcSubtotal))return _MainPanel._recalculateTotals(),!0;if(n.includes(CSS.xBullet)||n.includes(CSS.xSymbol))return host$.hideKeyboard_(()=>{_MainPanel._actionEditSymbol(t)}),!0;if(n.includes(CSS.xBulletText)){const e=t.firstChild;return null!=e&&_MainPanel._actionEditText1(e,!0),!0}if(n.includes(CSS.xDate))return host$.hideKeyboard_(()=>{const e=native$.iSelectNode_(t);null!=e&&_MainPanel._actionInsertDate1(e,t)}),!0;if(n.includes(CSS.xTodoStatus)){let e=t;for(;null!=(e=e.parentElement);){const t=e.classList;if(t.contains(CSS.xTodoItem)){history$.group_(RS.history_templateButtonAction,CSS.xTodoDone,()=>{t.toggle(CSS.xTodoDone),_MainPanel._recalculateTotals()});break}}return!0}if(n.includes(CSS.xxStatus)){let e=t;for(;null!=(e=e.parentElement);){const t=e.classList;if(t.contains(CSS.xxTodo)){history$.group_(RS.history_templateButtonAction,CSS.xxDone,()=>{t.toggle(CSS.xxDone),_MainPanel._recalculateTotals()});break}}return!0}const l=native$.getIFrameUri_(),a=this._getxAudio(t,n);if(null!=a)return null!=l&&_MainPanel._editAudioLink(a,l,t=>{null!=t&&_MainPanel._updateAudioInfo(t,()=>{})}),!0;const r=this._getxVideo(t,n);if(null!=r)return null!=l&&("VIDEO"==r.tagName&&this._pauseOnPlay(r),null===(s=_MainPanel._editVideoLink(r,l,t=>{null!=t&&_MainPanel._updateVideoInfo(t,()=>{})}))||void 0===s||s.show_()),!0;if("A"==i)return null!=l&&_MainPanel._actionEditLink(t,!1,l,()=>{}),!0;const _=t.parentElement;if(null!=_){const e=_.classList;if(e.contains(CSS.xCalBody)||e.contains(CSS.xCalHead)){if(n.includes(CSS.xGray))return Timer.sleep00_(()=>{native$.iClearSelection_()}),!0;{const e=JsUtil.getFirstTextnode_(t);if(null!=e)return native$.focusIFrame_(),Timer.sleep00_(()=>{native$.iSelectNode_(e)}),!0}}}return!1}_pauseOnPlay(t){let e=null;e=i=>{An.stopevent_(i),t.pause(),null!=e&&(t.removeEventListener("play",e),e=null)},t.addEventListener("play",e)}_getxAudio(t,e){if(e.includes(CSS.xAudio))return t;const i=CSS.xAudio+"-";if(ArrayUt.any_(e,t=>t.startsWith(i))){let e=t.parentElement;for(;null!=e&&!An.isBodyElement_(e.tagName);){if(e.getAttribute(ATTR.xPlaceholder)==Placeholder.xpAudioinfo)return DomUt.query_(e,`audio.${CSS.xAudio}`);e=e.parentElement}}return null}_getxVideo(t,e){if(e.includes(CSS.xVideo))return t;const i=CSS.xVideo+"-";if(ArrayUt.any_(e,t=>t.startsWith(i))){let e=t.parentElement;for(;null!=e&&!An.isBodyElement_(e.tagName);){if(e.getAttribute(ATTR.xPlaceholder)==Placeholder.xpVideoinfo)return DomUt.query_(e,`video.${CSS.xVideo}`);e=e.parentElement}}return null}_rsbTabAction(t,e){const i=t.classList;i.add(CSS.xFlashRightsidebar),FrameLimiter.requestAnimationFrame(10,()=>{i.remove(CSS.xFlashRightsidebar),e()})}_idocClickBubbleBoth(t,e,i){let n=t;for(;_MainPanel._isBubbleTag(i)&&null!=(n=n.parentElement);){i=n.nodeName;const t=n.classList;if(t.contains(CSS.xAnnotation)&&(e||!t.contains(CSS.xPeek))){if(null!=_MainPanel._showAnnotation(n,e,i))return!0;break}}return!1}_onCalcCell(t,e,i){var n;const s=null!==(n=t.textContent)&&void 0!==n?n:"";if(0==t.children.length){const n=native$.getIFrameScroll_(),o=null==e||null==n?null:Math.round(e-n.x),l=null==i||null==n?null:Math.round(i-n.y),a=JsUtil.getFirstTextnode_(t);native$.iSelectNode_(null!=a?a:t);const r=new PromptCalc(accessories$,cache$.ui$.buttonSize_());r.zindex_(DEF.zindexPrompt),r.at_(o,l),r.value_(s),r.onOK_(e=>{null!=history$&&e.length>0&&history$.group_(RS.history_calcTotal,e,()=>{JsUtil.isInput_(t)?t.value=e:t.textContent=e,_MainPanel._recalculateTotals()})}),r.show_()}}_clientActionHide(t,e){this._clientActionHideShow(t,e,CSS.xClientHide)}_clientActionShow(t,e){this._clientActionHideShow(t,e,CSS.xClientShow)}_clientActionHideShow(t,e,i){this._clientActionHideDone();let n=CSS.xHideable;const s=t.split("/");if(s.length>1){const t=s[1];CSSUtil.validateClass(t)&&(n=t)}const o=JsUtil.parentOrSelfWithClasses_(e,[n]);if(null!=o){const t=new Smokescreen(accessories$,DEF.zindexResizer,DEF.opacityTransparent);t.on_(Conf.touchstart,e=>{An.stopevent_(e),this._clientActionHideDone(),t.destroy_()}),t.show_(()=>{this._clientHidden=o,o.classList.add(i)})}}_clientActionHideDone(){null!=this._clientHidden&&(native$.removeAddClasses_(this._clientHidden,[CSS.xClientHide,CSS.xClientShow],null),this._clientHidden=null)}static _pageTemplate(t){Timer.sleep1_(()=>{if(!t.startsWith("/")){const e=settings$.htmlTemplatesByName_().get(t);if(void 0!==e&&e.cat_()==TemplateCat.Blog){const e=_Util.getBlogDayHtmlPath_(DateTime.now_());fileinfoUt$.fileInfo_(e,i=>{toasters$.warn_(i)||_Util.onSaveOrDiscard_(()=>{const n=FileInfo.of_(i[Key.fileinfo]);if(null!=n&&n.exists$)return mainPanel$.addIFrameReadyOneshotCallback(t=>mainPanel$.startEditCallback(t)),void _Util.browseFile_(e);sidePanel$.hideSidepanel_(),_Util.newPageFromTemplate3_(e,t)})})}else sidePanel$.hideSidepanel_(),_Util.newPageFromTemplateName_(t);return}const e=Basepath.cleanFilepath_(t);e.endsWith(".html")?fileinfoUt$.fileInfo_(e,i=>{if(An.hasMessage_(i))return void toasters$.warn_([MSG.string_(RS.InvalidPath_),t]);const n=FileInfo.of_(i[Key.fileinfo]);null==n||n.isdir$?toasters$.warn_([MSG.string_(RS.DestinationIsADirectory),t]):_Util.onSaveOrDiscard_(()=>{if(n.exists$)return void _Util.openExisting_(e);const t=new PageContextmenu(accessories$);t.onAction_(i=>{t.destroy_(),sidePanel$.hideSidepanel_(),_Util.newPageFromTemplate3_(e,i)}),t.onCancel_(()=>{t.destroy_()}),t.show_(window.innerWidth/2,cache$.ui$.toolbarHeight_())})}):toasters$.warn_([MSG.string_(RS.ExpectingHtml),t])})}static _onImageHolder(t){Timer.sleep1_(()=>{let e,i,n=t.nodeName;const s=native$.getIFrameUri_();if(null!=s)if("IMG"==n)i=HumanLink.fromHref_(JsUtil.optAttribute_(t,"src","")),e=RS.EditImgTitle,_MainPanel._onImageHolderImg(t,n,i,e,s);else{const e=t.style.backgroundImage,i=t.style.getPropertyValue("backdrop-filter"),n=CSSUtil.humanCSSUrls_(e,s);new PromptBgImage(accessories$,t,cache$.ui$.buttonSize_(),s,[n,i],settings$.getBgImgSamples(),DEF.zindexPrompt).onOK_((e,i)=>{history$.group_(RS.history_imageholder,native$.filenameFromCSSURL_(e,s),()=>{_JsUtil.setStyleUrlValue_(t,"background-image",e,An.noop_),t.style.setProperty("backdrop-filter",i)})}).show_()}})}static _onImageHolderImg(t,e,i,n,s){let o=HumanLink.Empty$,l=t.parentElement;null!=l&&"A"==l.nodeName?o=HumanLink.fromHref_(JsUtil.optAttribute_(l,"href","")):l=null;const a=JsUtil.sortedAttributes_(t),r=An.attributesToStringForEdit_(a," ",["xmlns","src"]),_=_Util.promptImageUrl2_(n,DEF.zindexPrompt,i,r,o,s,Callbacks.onAnyImageFolderButton_);_.onChange_(t=>{if("#0"==t.spec$.key$){const t=_.getValueAt_(0),e=An.cpathOfHref2_(s,t);if(null==e)return;const i=_.getValueAt_(1),n=An.attributesFromEditString_(i);_Util.setImageOrientationOfPath_(n,e,()=>{const t=An.attributesToStringForEdit_(JsUtil.sortedAttributes1_(n)," ",[]);_.setValueAt_(1,t)})}}).onOK_((i,n,o,a,_,c)=>{Sanitizers.checkAttrs_(o,s,o=>{var h;if(i.warn_(o))return void c(!1);const u=null!==(h=o[Key.attrs])&&void 0!==h?h:smap_(),d=An.attributesToStringForEdit_(JsUtil.sortedAttributes1_(u)," ",["xmlns","src"]);if(0==n.length)return c(!0),void _MainPanel._onImageHolderImgResult(t,e,null,d==r?null:u,a,l,null);Sanitizers.checkRequiredImageOptionalLink_(n,_,s).onFail_(t=>{c(!1),i.warn_(t)}).onOK_(([i,n])=>{c(!0),_MainPanel._onImageHolderImgResult(t,e,i,d==r?null:u,a,l,n)})})}).show_()}static _onImageHolderImgResult(t,e,i,n,s,o,l){if(_MainPanel._onImageHolderImgSetSrc(t,e,i,n),s)null==o&&(o=JsUtil.wrapNode_(t,"A")),JsUtil.setAttribute_(o,"href",null==l?"":l.toString());else if(null!=o&&!An.isBodyElement_(o.nodeName)){const t=o.parentElement;null!=t&&new DomBuilderEx(t).unwrap_(o)}}static _onImageHolderImgSetSrc(t,e,i,n){const s=An.filenameFromUri_(i);if(null==i)return void history$.group_(RS.history_imageholder,s,()=>{t.removeAttribute("src")});const o=i.toString();"IMG"==e?history$.group_(RS.history_imageholder,s,()=>{if(null==n)t.setAttribute("src",o);else{n.src=o;const e=Object.keys(n);for(const i of Array.from(t.attributes))e.includes(i.name)||t.removeAttributeNode(i);for(const[e,i]of Object.entries(n))t.setAttribute(e,null!=i?i:"")}}):history$.group_(RS.history_imageholder,s,()=>{_JsUtil.setStyleUrlValue_(t,"background-image",CSSUtil.toCSSUrl_(o))})}static _showEventsPanel(t){const e=ID.sidebarExplore,i=RS.Tooltips_EventsPanel;sidePanel$.showSidepanel_(e,!1,()=>{Timer.sleep1_(()=>{const t=`span[${ATTR.xTooltips}='${i}']`,e=document.querySelector(`#${ID.sidepanel} div.${CSS.AnTabbar} ${t}`);null!=e&&e.click()})})}static _onPlaceholder1(t,e,i,n){history$.group_(RS.history_placeholder,e,()=>{switch(t.classList.remove(CSS.xPlaceholder),e){case"A":JsUtil.stopevent_(n),_MainPanel._actionEditLink(t,!0,i,null);break;case"IMG":JsUtil.stopevent_(n),_MainPanel._actionEditImg(t,i);break;default:JsUtil.stopevent_(n),Timer.sleep1_(()=>{native$.iSelectContents_(t)})}})}static _isBubbleTag(t){return _MainPanel._bubbletags.has(t)}static _showAnnotation(t,e,i){if(null==t)return null;if("DIV"==i)return _MainPanel._showAnnotation0(t),t;if("SPAN"==i){const i=t.parentElement;if(null!=i&&"DIV"==i.nodeName){const t=i.classList;if(t.contains(CSS.xAnnotation)&&(e||!t.contains(CSS.xPeek)))return _MainPanel._showAnnotation0(i),i}}return null}_showSlides(t){const e=An.parseTime_(t.style.animationDuration,3e3),i=new Array;for(const e of Array.from(t.children))"IMG"==e.nodeName&&i.push(e);if(i.length>0){i[0].style.opacity="1.0";const n=[0];let s=new PeriodicTimer(e,e=>{_MainPanel._showslides(e,t,i,n)});this._addIFrameUnloadCallback(()=>{s.cancel_()})}}static _showslides(t,e,i,n){let s=n[0];++s,n[0]=s;const o=AVALUE.xStop==e.getAttribute(ATTR.xInfo);if(s<i.length&&!o)i[s].style.display="inline",i[s-1].style.display="none";else{t.cancel_(),o&&(i[s-1].style.opacity="1.0"),e.removeAttribute(ATTR.xInfo);const n=i[0].style;n.opacity="0.5",n.display="inline",s>1&&(i[s-1].style.display="none")}}_browsingTemplateAction(t,e,i,n){const s=e[TemplateMenuKey.cmd];if(An.isempty_(s))n();else if(s!=TemplateAction.save)n();else{const t=e[TemplateMenuKey.path];this._templateActionSave(t,n)}}_templateActionSave(t,e){function i(t){return PathUtil.getHomeDir(mainPanel$.isLoggedIn())+t}const n=An.simpleDateTimeString_()+".html";null==t&&(t="");let s=t+n;s.startsWith("/")||(s=i(s));const o=Basepath.dir_(s);if(null==o)return toasters$.warnKey_(RS.InvalidPath),void e();fileinfoUt$.mkDirs_(o,t=>{toasters$.warn_(t)&&(s=i(n));const o=_Util.getCurrentDir_(),l=_Util.promptFilepath_(MSG.string_(RS.SaveAs),FilepickerKind.WRITE_FILE,"",o,s);l.setDelegate_(FilepickerHtmlDelegate.singleton$),l.zindex_(DEF.zindexPrompt),l.onOK_((t,i)=>{t(!0),native$.fixIFrameInputs_();const n=native$.serializeIFrameDocument_();host$.saveHtml_(i,n,t=>{toasters$.warn_(t)||toasters$.ok_([RS.DocumentBrowsingSaved,i]),e(),Timer.sleep0_(()=>{_Util.browseFile_(i)})})}),l.onCancel_(e),l.show_()})}_templateAction(t,e,i,n=null){if(e.startsWith("{"))return void this._templateMenu(t,i,e,n);const s=_TemplateAction.parse_(e);this._templateAction1(t,s,i,n)}_templateAction1(t,e,i,n=null){if(null==e)return toasters$.error_(MSG.string_(RS.InvalidTemplate)),void(null==n||n(null));e.run_(t,i,n)}static _getmarker(t,e){if(null!=t){const i=t.classList;for(const t of e)if(i.contains(t))return t}return null}static _findMarker(t){const e=native$.getIFrameBody_();if(null==e)return null;if(e.classList.contains(t))return e;let i=native$.iGetElementById_(ID.xRightSidebar);null==i&&(i=e.firstElementChild);const n=new Array;for(let t=null==i?void 0:i.previousElementSibling;null!=t;t=t.previousElementSibling)n.unshift(t);for(let t=null==i?void 0:i.nextElementSibling;null!=t;t=t.nextElementSibling)n.push(t);let s=null;for(const e of n){if(e.classList.contains(t)){s=e;break}for(const i of native$.iQueryAll_(`.${t}`,e))if(null!=i.parentNode&&native$.isVisible_(i.parentNode)){s=i;break}}return s}_templateMenu(t,e,i,n=null){let s;try{s=JSON.parse(i)}catch(t){return toasters$.error_(MSG.string_(RS.InvalidTemplate)),void(null==n||n(null))}this._templateMenu1(s,i=>{if(null==i)return void(null==n||n(null));const s=_TemplateAction.clientActionFrom_(ClientActionInfo.of_(i));null!=s?this._templateAction1(t,s,e,n):null==n||n(null)})}_templateMenu1(t,e){host$.hideKeyboard_(()=>{const i=t[TemplateMenuKey.lcCat],n=t[TemplateMenuKey.menu];if(An.isempty_(i)||null==n)return void e(null);let s;const o=new DomBuilderEx(accessories$).div_().cursor_();try{s=new _TemplateContextmenu(o,i,n)}catch(t){return o.remove(),toasters$.error_(MSG.string_(RS.InvalidTemplate)),void e(null)}const l=cache$.ui$.toolbarHeight_();s.onAction_(t=>{s.destroy_(),o.remove(),native$.focusIFrameBody_(),Timer.sleep1_(()=>{for(const i of n)for(const n of i)if(n[TemplateMenuKey.action]==t)return void e(n)})}),s.onCancel_(()=>{s.destroy_(),o.remove(),e(null)}),s.show_(window.innerWidth,2*l,!1)})}static _recalculateTotals(){null!=history$&&null!=docInfo$&&1==docInfo$.getRecalc_()&&history$.group_(RS.history_calcTotal,"",()=>{_MainPanel._recalculateTotals2()})}static _recalculateTotals2(){for(const t of native$.iQueryAll_(`.${CSS.xCalcTotal}`))_MainPanel._calculateTotal(t)}static _calculateTotal(t){const e=JsUtil.parentOrSelfWithClass_(t,CSS.xCalcContext);if(null==e)return void toasters$.warnKey_(RS.CalculationContextNotFound);if(null!=JsUtil.parentOrSelf_(e,t=>JsUtil.isElementWIthName_(t)&&t.getAttribute("id")==ID.xRightSidebar))return;const i=native$.iQueryAll_(`.${CSS.xCalcItem}`,e);if(i.length>0)return void _MainPanel._calculateItems(t,i);const n=native$.iQueryAll_(`.${CSS.xCalcPrice}`,e);if(null==n)return;const s=n.length;let o=0;for(let t=0;t<s;++t){const e=n[t],i=JsUtil.parentOrSelfWithName_(e,"TR");null!=i&&native$.isVisible1_(i)&&(o+=_MainPanel._calculateSubtotal(i,e))}const l=o.toFixed(2);JsUtil.setValue_(t,l)}static _calculateItems(t,e){let i=0;for(const t of e){if(!native$.isVisible1_(t))continue;const e=native$.iQuery(`.${CSS.xCalcPrice}`,t);null!=e&&(i+=_MainPanel._calculateSubtotal(t,e))}const n=i.toFixed(2);JsUtil.setValue_(t,n)}static _calculateSubtotal(t,e){const i=native$.iQuery(`.${CSS.xCalcQuantity}`,t),n=native$.iQuery(`.${CSS.xCalcSubtotal}`,t),s=_MainPanel._calculateValue(e,0)*(null==i?1:_MainPanel._calculateValue(i,1));if(null!=n){const t=s.toFixed(2);JsUtil.setValue_(n,t)}return s}static _calculateValue(t,e){if(null==t)return e;const i=An.parseDouble_(JsUtil.getCalcValue_(t),null);return native$.removeAddClasses_(t,null==i?null:_MainPanel._xcalcerror,null==i?_MainPanel._xcalcerror:null),null!=i?i:e}_onIFrameViewerReady(t,e){let i=_State.INVALID;if(this._iframeMediaViewer=null,null==e)return i;try{if(e.startsWith("image/")){const t=native$.iGetElementById_(ID.xViewer),e=JsUtil.asHTMLImageElement_(native$.iGetElementById_(ID.xContent));if(null==t||null==e)return toasters$.warnKey_(RS.ImageNotFound),i;i=_State.IMAGE,_Hacks.fixBody(),this._iframeMediaViewer=new IFrameImageViewer(t,e.parentElement,e,0)}else if(e.startsWith("video/")){const e=native$.iGetElementById_(ID.xContent),n=null==e?null:native$.iQuery(`a.${CSS.xVideo}`,e),s=null==n?null:n.getAttribute("href");if(null==s)return toasters$.warn_(MSG.string_(RS.VideoNotFound)),i;i=_State.VIDEO;const o=An.parseUriSafe_(s,native$.getIFrameUri_()),l=null==o?null:An.cpathOfUri_(o),a=native$.getIFrameDocument_();if(null!=a&&null!=l){const i=new _VideoParam;null!=o&&_MainPanel._getVideoParams(i,o);const s=t.queryParameters$.get(Param.session),r=An.parseJSONObjectOrNull_(s);if(null!=r){const t=r[SessionParam.poster],e=r[SessionParam.x];null!=t&&(i.poster=t),null!=e&&(i.seek=e)}null!=e&&(native$.iAddEventListener_(a,"click",t=>{JsUtil.stopevent_(t),this._playVideo(e,n,l,!1,i.seek,i.poster)},!0),this._playVideo(e,n,l,!0,i.seek,i.poster))}}else if(e.startsWith("audio/")){const e=native$.iGetElementById_(ID.xContent);if(null==e)return toasters$.warnKey_(RS.AudioNotFound),i;const n=An.cpathOfUri_(t);if(null==n)return i;i=_State.AUDIO,_Hacks.fixBody();let s=null;const o=t.queryParameters$.get(Param.session),l=An.parseJSONObjectOrNull_(o);if(null!=l){const t=l[SessionParam.x];null!=t&&t>0&&(s=t)}_AudioPlayerDialog.createAndShow_(accessories$,n,s,!0,t=>{if(null==t)return this._iframeMediaViewer=null,void(i=_State.INVALID);this._iframeMediaViewer=t[0],_MainPanel._updateAudioInfo1(e,n,t[1])})}else e==MimeUtil.PDF&&(i=_State.PDF);return i}catch(t){return _State.INVALID}}_playVideo(t,e,i,n,s,o){null!=i&&null!=MimeUtil.videoMimeFromPath(i)&&host$.playVideo_(i,n,s,o,s=>{if(toasters$.warn_(s))return;if(!n)return;const o=s[Key.mediainfo];if(null==o)return;const l=o.playable(),a=native$.iQuery(`.${CSS.xVideoFilesize}, .${CSS.xMediaFilesize}`,t),r=native$.iQuery(`.${CSS.xVideoFilename}`,t),_=native$.iQuery(`.${CSS.xVideoDatetime}`,t),c=native$.iQuery(`.${CSS.xVideoDuration}`,t),h=native$.iQuery(`.${CSS.xVideoResolution}`,t),u=native$.iQuery(`.${CSS.xVideoPoster}`,t);if(null!=l&&l)_MainPanel._updateVideoInfo1(t,e,r,a,_,h,c,u,i,o);else{const i=[[_,c],[r],[a,h,u]];_MainPanel._mediaInfoError(t,e,i)}})}static _getVideoParams(t,e){const i=e.queryParameters$,n=An.parseInt_(i.get(Param.poster),null),s=An.parseInt_(i.get(Param.seek),null);return null!=n&&(t.poster=n),null!=s&&(t.seek=s),t}_showMainContextmenu(t,e){history$.group_(RS.HistoryIgnore,"",()=>{}),this.updateContextmenuState_(),this._contextmenu.show_(t,e,!1)}hideMainContextmenu(){null!=this._contextmenu&&this._contextmenu.isShown_()&&(this._contextmenu.hide_(),native$.focusIFrame_())}hideMainContextmenuWithoutFocus_(){var t;null===(t=this._contextmenu)||void 0===t||t.hide_()}_createImageContextmenu(){const t=new _ImageContextmenu(accessories$);return t.onAction_(e=>{toasters$.hideAll_(),t.destroy_(),native$.focusIFrame_(),mainPanel$._imageActions(e)}),t.onCancel_(()=>{t.destroy_(),native$.focusIFrame_()}),t.onContextmenu_(toasters$.onTooltipsKey_),t}_showImageContextmenu(t,e){this._createImageContextmenu().show_(t,e,!1)}_createCharContextmenu(){const t=new _CharContextmenu(accessories$);return t.onAction_(e=>{t.destroy_(),native$.focusIFrame_(),_MainPanel._charStyle1(settings$.charStylesByName_(),e)}),t.onCancel_(()=>{t.destroy_(),native$.focusIFrame_()}),t}_showCharContextmenu(t){const e=native$.getIFrameSelectionRange_();if(null==e||e.collapsed)return void toasters$.warnKey_(RS.ActionRequireANonCollapsedSelection);const i=e.startContainer,n=e.endContainer;null!=i&&null!=n&&i==n?this._createCharContextmenu().show_(t.pageX,t.pageY):toasters$.warnKey_(RS.ActionRequireASelectionThatStartsAndEndsUnderTheSameParent)}_createHighlightContextmenu(){const t=new _HighlightContextmenu(accessories$);return t.onAction_(t=>{this.hideHighlightContextmenuWithoutFocus_(),native$.focusIFrame_(),_MainPanel._charStyle1(settings$.highlightStylesByName_(),t)}),t.onCancel_(()=>native$.focusIFrame_()),t}_showHighlightContextmenu(t){null==this._highlightContextmenu&&(this._highlightContextmenu=this._createHighlightContextmenu());const e=native$.getIFrameSelectionRange_();if(null==e||e.collapsed)return void toasters$.warnKey_(RS.ActionRequireANonCollapsedSelection);const i=e.startContainer,n=e.endContainer;null!=i&&null!=n&&i==n?this._highlightContextmenu.show_(t.pageX,t.pageY):toasters$.warnKey_(RS.ActionRequireASelectionThatStartsAndEndsUnderTheSameParent)}hideHighlightContextmenuWithoutFocus_(){null!=this._highlightContextmenu&&this._highlightContextmenu.hide_()}_createParaContextmenu(){const t=new _ParaContextmenu(accessories$);return t.onAction_(e=>{t.destroy_(),native$.focusIFrame_(),_MainPanel._paraStyle1(settings$.paraStylesByName_(),e)}),t.onCancel_(()=>{t.destroy_(),native$.focusIFrame_()}),t}_showParaContextmenu(t){const e=native$.getIFrameSelectionRange_();if(null==e)return void toasters$.warnKey_(RS.ActionRequireAValidSelection);const i=e.startContainer,n=e.endContainer;null!=i&&null!=n&&i==n?this._createParaContextmenu().show_(t.pageX,t.pageY):toasters$.warnKey_(RS.ActionRequireASelectionThatStartsAndEndsUnderTheSameParent)}_createWidgetContextmenu(){const t=new _WidgetContextmenu(accessories$,_WidgetTemplates._INFOS);return t.onAction_(e=>(t.destroy_(),native$.focusIFrame_(),_MainPanel._widgetContextAction(e))),t.onCancel_(()=>{t.destroy_(),native$.focusIFrame_()}),t}_showWidgetContextmenu(t){this._createWidgetContextmenu().show_(t.pageX,t.pageY)}toolbarActions_(t,e,i){switch(toasters$.hideAll_(),An.stopevent_(t),i){case MainToolbarActions._HOME:_MainPanel._actionGoHome(_MainToolbar._homeCount>2);break;case MainToolbarActions._EDIT_NODE:_MainPanel._actionEditNode();break;case MainToolbarActions._TOGGLE_LEFTSIDEPANEL:_MainPanel._actionToggleLeftSidepanel();break;default:host$.hideKeyboard_(()=>{switch(i){case MainToolbarActions._EDITINGMENU:if(this.isEditing()){const t=An.documentOffset_(this._mainToolbar.button(MainToolbarActions._EDITINGMENU));this._showMainContextmenu(t.x,cache$.ui$.toolbarHeight_())}break;case MainToolbarActions._SELECT:{const t=An.documentOffset_(e);this._actionSelect(t.x,cache$.ui$.toolbarHeight_());break}case MainToolbarActions._CANCEL:this.cancelEdit();break;case MainToolbarActions._SAVE:Timer.sleep1_(()=>{this.saveEdit()});break;case MainToolbarActions._BACK:this._actionGoBack();break;case MainToolbarActions._FORWARD:this._actionGoForward();break;case MainToolbarActions._EDIT:this._mainToolbar.setEnabled(!1),this.startEdit(()=>{this._mainToolbar.setEnabled(!0)},()=>{this._mainToolbar.setEnabled(!0)});break;case MainToolbarActions._TOOLBAR_RECORDING:case MainToolbarActions._SEARCHBAR_RECORDING:case MainToolbarActions._SYSTEMBAR_RECORDING:this._actionStopAudioRecording();break;case MainToolbarActions._TOOLBAR_PLAYBACK:case MainToolbarActions._SEARCHBAR_PLAYBACK:case MainToolbarActions._SYSTEMBAR_PLAYBACK:this._actionShowAudioPlayer();break;case MainToolbarActions._IMAGE_ROTATE:null!=this._iframeMediaViewer&&this._iframeMediaViewer.rotate_();break;case MainToolbarActions._IMAGE_MENU:{const t=An.documentOffset_(this._mainToolbar.button(MainToolbarActions._IMAGE_MENU));this._showImageContextmenu(t.x,cache$.ui$.toolbarHeight_());break}default:switch(i){case MainToolbarActions._SYSTEM_PRINT:{const t=native$.getIFrameUri_(),e=native$.getIFrameContextPath_();if(null==t||null==e)break;const i=this._saveSession1(t);host$.actionPrint_(e,i,t=>{toasters$.toastResult_(t)&&this._addOnResumeOneshotCallback(()=>{this._mainToolbar.showMainbar_()})});break}case MainToolbarActions._SYSTEM_BACKUP:host$.actionBackup_(settings$.dateFormat_());break;case MainToolbarActions._SYSTEM_RESTORE:host$.actionRestore_(settings$.dateFormat_());break;case MainToolbarActions._SYSTEM_CONTEXTMENU:{const e=new _SystemActionContextmenu(accessories$);e.onAction_(t=>{e.destroy_(),this._systemContextActions(t)}),e.onCancel_(()=>{e.destroy_()}),e.show_(t.pageX,t.pageY);break}default:Assert.notReach_()}}})}}_imageActions(t){switch(t){case _ImageContextmenu._IMAGE_BGCOLOR:{const t=this._iframeMediaViewer;Callbacks.promptColor_(cache$.ui$.buttonSize_(),DEF.zindexPrompt,t.content_().parentElement.style.backgroundColor,ColorValue.X_WHITE).onOK_((e,i)=>{const n=ColorUtil.formatCSSString_(i,e);t.content_().parentElement.style.backgroundColor=n}).show_();break}case _ImageContextmenu._ANNOTATE_IMAGE:Assert.assertion_(_state==_State.IMAGE),Assert.assertion_(null!=this._iframeMediaViewer);const e=this._iframeMediaViewer.content_(),i=native$.getIFrameUri_();null!=i&&this._actionAnnotateImg(e,i,t=>{null!=t&&_Util.browse1_(t)});break;case _ImageContextmenu._IMAGE_EXPORT:null!=this._iframeMediaViewer&&this._iframeMediaViewer.export_();break;case _ImageContextmenu._IMAGE_INFO:if(null==native$.iGetElementById_(ID.xContent)){toasters$.warnKey_(RS.ImageNotFound);break}const n=native$.getIFrameUri_(),s=null==n?null:An.cpathOfUri_(n);null!=s&&Callbacks.showImageInfo_(s);break;default:Assert.notReach_()}}_systemContextActions(t){switch(toasters$.hideAll_(),t){case MainToolbarActions._SYSTEM_MANAGE_BACKUP_KEYS:_SystemActionsHelper.actionManageBackupKeys_(settings$.dateFormat_());break;case MainToolbarActions._SYSTEM_RESET_USER_SETTINGS:host$.actionResetUserSettings_();break;case MainToolbarActions._SYSTEM_FACTORY_RESET:host$.actionFactoryReset_();break;default:Assert.notReach_()}}_contextActions(t,e,i){switch(toasters$.hideAll_(),t){case MainContextActions._PARENT_NODE:const n=An.documentOffset_(e);this._actionSelect1(n.x,n.y);break;case MainContextActions._SELECT_NEXT_SIBLING:this._actionSelectNextSibling();break;case MainContextActions._MOVETO_PARENT:this._actionMovetoParent();break;case MainContextActions._MOVETO_PREV:this._actionMovetoPrev();break;case MainContextActions._MOVETO_NEXT:this._actionMovetoNext();break;case MainContextActions._UNDO:this._actionUndo();break;case MainContextActions._REDO:this._actionRedo();break;case DEF.NOOP:break;case MainContextActions._SUBMENU_FONT:case MainContextActions._SUBMENU_CHAR:case MainContextActions._SUBMENU_PARA:case MainContextActions._SUBMENU_LIST:case MainContextActions._SUBMENU_MEDIA:case MainContextActions._SUBMENU_OTHERS:this._contextmenu.submenuActions_(e,t);break;default:this._contextActions1(t,i)}}_contextActions1(t,e){switch(this.hideMainContextmenuWithoutFocus_(),An.stopevent_(e),t){case MainContextActions._LIST_OL:case MainContextActions._LIST_UL:case MainContextActions._LIST_UL_NONE_INDENTED:case MainContextActions._LIST_UL_NONE:case MainContextActions._LIST_ITEM:case MainContextActions._LIST_SYMBOLS:case MainContextActions._LIST_DATE:case MainContextActions._LIST_COMPACT:case MainContextActions._LIST_EXPAND:case MainContextActions._LIST_ITEM_SYMBOL:case MainContextActions._LIST_ITEM_TEXT:case MainContextActions._LIST_ITEM_DATE:case MainContextActions._LIST_ITEM_TIME:this._listStyleActions(t);break;case MainContextActions._UNDO_HISTORY:_MainPanel._actionUndoHistory();break;case MainContextActions._CALCULATOR:_MainPanel._actionCalculator();break;case MainContextActions._INSERT_LINK:_MainPanel._actionInsertLink();break;case MainContextActions._INSERT_IMG:_MainPanel._actionInsertImg();break;case MainContextActions._INSERT_AUDIO:_MainPanel._actionInsertAudio();break;case MainContextActions._INSERT_VIDEO:_MainPanel._actionInsertVideo();break;case MainContextActions._PARAGRAPH:_MainPanel._actionParagraph(e);break;case MainContextActions._INSERT_TEXT:_MainPanel._actionInsertText(e);break;case MainContextActions._WRAP:_MainPanel._actionWrap();break;case MainContextActions._INSERT_ELEMENT:_MainPanel._actionInsertElement();break;case MainContextActions._SPAWN_NODE:_MainPanel._actionSpawnNode();break;case MainContextActions._EDIT_SIZE:this._actionEditSize();break;case MainContextActions._EDIT_ALIGN:_MainPanel._actionEditAlign();break;case MainContextActions._EDIT_STYLE:_MainPanel._actionEditStyle();break;case MainContextActions._EDIT_STYLE_RAW:const i=_MainPanel._requireSingleOrCollapsedElementSelection();null!=i&&(native$.iSelectNode_(i),_MainPanel._actionEditRawStyle1(i));break;case MainContextActions._EDIT_NODE:_MainPanel._actionEditNode();break;case MainContextActions._EDIT_NODE_RAW:_MainPanel._actionEditNode1(!0,t=>{const e=native$.getIFrameUri_();null!=e&&_MainPanel._actionEditElementRaw1(t,e)});break;case MainContextActions._ANNOTATE_IMG:const n=DomUt.asHTMLElement_(native$.getSingleSelectedNode_());if("IMG"!=(null==n?void 0:n.nodeName)){toasters$.warnKey_(RS.InvalidSelection);break}if(native$.hasClass_(n,CSS.xCanvas))this._actionAnnotateCanvas(n,()=>{});else{const t=native$.getIFrameUri_();null!=t&&this._actionAnnotateImg(n,t,t=>{null!=t&&history$.group_(RS.action_AnnotateImage,An.filenameFromUri_(t),()=>{n.setAttribute("src",t.toString())})})}break;case MainContextActions._CHAR_HIDDEN:_MainPanel._charStyle1(settings$.charStylesByName_(),CSS.xHidden),native$.iClearSelection_();break;case MainContextActions._PARA_HIDDEN:_MainPanel._paraStyle1(settings$.paraStylesByName_(),CSS.xHidden),native$.iClearSelection_();break;case MainContextActions._CHAR_STYLES:this._showCharContextmenu(e);break;case MainContextActions._HIGHLIGHT_STYLES:this._showHighlightContextmenu(e);break;case MainContextActions._PARA_STYLES:this._showParaContextmenu(e);break;case MainContextActions._BORDER:_MainPanel._actionBorder();break;case MainContextActions._INSERT_CANVAS:this._actionInsertCanvas();break;case MainContextActions._INSERT_DATE:_MainPanel._actionInsertDate();break;case MainContextActions._INSERT_CALENDAR:_MainPanel._actionInsertCalendar();break;case MainContextActions._INSERT_ALARM:_MainPanel._actionInsertAlarm();break;case MainContextActions._INSERT_SYMBOL:_MainPanel._actionInsertSymbol();break;case MainContextActions._INSERT_WIDGET:this._showWidgetContextmenu(e);break;case MainContextActions._DESTRUCT_WIDGET:_WidgetTemplates._actionDestructWidget();break;case MainContextActions._RECORD_AUDIO:{const t=_MainPanel._requireNonBodySelection(),e=native$.getIFrameUri_(),i=null==e?null:An.cdirOfUri_(e);null!=t&&null!=i&&null!=e&&toasters$.error_(MSG.string_(RS.DesktopOperationRecordAudioNotAvailable));break}case MainContextActions._TAKE_PHOTO:toasters$.error_(MSG.string_(RS.DesktopOperationTakePhotoNotAvailable));break;case MainContextActions._RECORD_VIDEO:{const t=_MainPanel._requireNonBodySelection(),e=native$.getIFrameDir_();null!=t&&null!=e&&toasters$.error_(MSG.string_(RS.DesktopOperationRecordVideoNotAvailable));break}default:this._contextActions2(t)}}_contextActions2(t){switch(native$.focusIFrame_(),t){case MainContextActions._STYLE_BOLD:case MainContextActions._STYLE_ITALIC:case MainContextActions._STYLE_UNDERLINE:case MainContextActions._STYLE_STRIKETHROUGH:case MainContextActions._STYLE_SUBSCRIPT:case MainContextActions._STYLE_SUPERSCRIPT:case MainContextActions._STYLE_FLOAT_LEFT:case MainContextActions._STYLE_FLOAT_RIGHT:_MainPanel._charStyle1(settings$.builtinCharStylesByName_(),t);break;case MainContextActions._STYLE_ALIGN_LEFT:case MainContextActions._STYLE_ALIGN_RIGHT:case MainContextActions._STYLE_ALIGN_CENTER:case MainContextActions._STYLE_ALIGN_JUSTIFY:_MainPanel._paraStyle1(settings$.builtinParaStylesByName_(),t);break;case MainContextActions._COPY:_MainPanel._actionCopy();break;case MainContextActions._CUT:_MainPanel._actionCut();break;case MainContextActions._PASTE_CHILD:_MainPanel._actionPasteChild();break;case MainContextActions._PASTE_SIBLING:_MainPanel._actionPasteSibling();break;case MainContextActions._TOGGLE_RIGHTSIDEBAR:_MainPanel._actionToggleRightSidebar();break;case MainContextActions._TO_NBSP:_MainPanel._actionToNbsp();break;case MainContextActions._TO_SPACE:_MainPanel._actionToSpace();break;case MainContextActions._UNWRAP:_MainPanel._actionUnwrap();break;default:throw Assert.notReach_(t)}}_listStyleActions(t){switch(t){case MainContextActions._LIST_OL:_MainPanel._actionList("OL");break;case MainContextActions._LIST_UL:_MainPanel._actionList("UL");break;case MainContextActions._LIST_UL_NONE_INDENTED:_MainPanel._actionList("UL",{class:CSS.xListStyleNone});break;case MainContextActions._LIST_UL_NONE:_MainPanel._actionList("UL",{class:CSS.xNone});break;case MainContextActions._LIST_SYMBOLS:_MainPanel._actionListSymbols();break;case MainContextActions._LIST_DATE:_MainPanel._actionListDate();break;case MainContextActions._LIST_ITEM:_MainPanel._actionListItem("UL");break;case MainContextActions._LIST_ITEM_SYMBOL:_MainPanel._actionListItemSymbol();break;case MainContextActions._LIST_ITEM_TEXT:_MainPanel._actionListItemText();break;case MainContextActions._LIST_ITEM_DATE:_MainPanel._actionListItemDate();break;case MainContextActions._LIST_ITEM_TIME:_MainPanel._actionListItemTime();break;case MainContextActions._LIST_COMPACT:_MainPanel._actionListCompact(!0);break;case MainContextActions._LIST_EXPAND:_MainPanel._actionListCompact(!1);break;default:toasters$.warn_(MSG.string1_(RS.invalidStyle_,t))}}static _actionGoHome(t){Timer.sleep1_(()=>{const e=mainPanel$.isLoggedIn();t||cache$.onHomeAction_()?native$.reloadHome_():native$.browseHome_(e)})}_recentsBackForwardAction(t,e,i){if(toasters$.warn_(t))return;const n=FileInfo.of_(t);if(null==n)return void toasters$.warnKey_(RS.InvalidFilepath);const s=n.name_(),o=n.state$,l=Basepath.lcExt_(s);DEF.html==l||MimeUtil.isImageLcExt(l)?(this._navigation=e,_Util.browseFile_(s,o)):host$.recentsPut_(e,s,o,()=>{i()})}_goback1(){host$.recentsBack_(t=>{this._recentsBackForwardAction(t,RecentsCmd.BACK,this._goback1)})}_actionGoBack(){_Util.onSaveOrDiscard_(()=>{Timer.sleep1_(()=>this._goback1())})}_goforward1(){host$.recentsForward_(t=>{this._recentsBackForwardAction(t,RecentsCmd.FORWARD,this._goforward1)})}_actionGoForward(){_Util.onSaveOrDiscard_(()=>{Timer.sleep1_(()=>this._goforward1())})}_actionSelect(t,e){const i=native$.iGetAncestors_();null!=i&&0!=i.length?new _AncestorsContextmenu(accessories$,i,!0).onCancel_(()=>native$.focusIFrame_()).show_(t,e,!1):toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection))}_actionSelect1(t,e){const i=native$.iGetAncestors_();null!=i&&0!=i.length?new _AncestorsContextmenu(accessories$,i,!1,()=>this.updateContextmenuState_()).above_(this._contextmenu.element$).show_(t,e,!0):toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection))}static _actionSelectNextSiblingOK(t,e){if(null==t)return void e(MSG.string_(RS.InvalidSelection),null,null);if(t.collapsed)return void e(null,null,null);let i=t.endContainer,n=t.endOffset,s=i.nodeType;if(s==Node.TEXT_NODE)n=native$.getIndexOf_(i)+1,i=i.parentElement;else{if(s!=Node.ELEMENT_NODE)return void e(MSG.string_(RS.InvalidSelection),null,null);{const s=i.childNodes[n];if(null==s)return void e(MSG.string_(RS.NoNextSiblingFound),null,null);const o=s.nodeName;if(An.isBodyElement_(o))return void e(MSG.string_(RS.NoNextSiblingFound),null,null);n=t.endOffset+1}}e(null,i,n)}_actionSelectNextSibling(){let t=native$.getValidIFrameSelectionRange_();_MainPanel._actionSelectNextSiblingOK(t,(e,i,n)=>{if(toasters$.warn_(e))return;if(null==t||null==i||null==n)return;let s=null;t.collapsed?(s=RangeUtil.rangeStart_(t),t=native$.iSelectNode_(s)):(s=i.childNodes[n-1],t.setEnd(i,n),native$.iSelectRange_(t)),this.updateContextmenuState_(),null!=s&&_JsUtil.toastNode_(s)})}static _actionMovetoParent1(t,e=null){if(null==t||An.isBodyElement_(t.nodeName))return MSG.string_(RS.InvalidSelection);const i=t.parentNode;if(null==i||An.isBodyElement_(i.nodeName))return MSG.string_(RS.AlreadyAtTopLevel);const n=i.parentElement;if(null==n)return MSG.string_(RS.AlreadyAtTopLevel);if(!_MainPanel._canInsert1(n.nodeName,t))return MSG.string_(RS.InvalidSelection);const s=i.nextSibling;return history$.group_(RS.action_MoveToParent,t.nodeName,()=>{new DomBuilderEx(n).insertBefore_(s,t),native$.iSelectNode_(t,null,!0),null==e||e()}),null}static _actionMovetoPrev1(t,e=null){if(null==t||An.isBodyElement_(t.nodeName))return MSG.string_(RS.InvalidSelection);const i=_MainPanel._nonEmptySibling(t,t=>t.previousSibling),n=t.parentElement;return null==n?MSG.string_(RS.ThereIsNoPreviousSibling):(history$.group_(RS.action_MoveToPrev,t.nodeName,()=>{new DomBuilderEx(n).removeChild_(t).insertBefore_(i,t),native$.iSelectNode_(t,null,!0),null==e||e()}),null)}static _actionMovetoNext1(t,e=null){if(null==t||An.isBodyElement_(t.nodeName))return MSG.string_(RS.InvalidSelection);const i=t.parentElement;if(null==i)return MSG.string_(RS.ThereIsNoNextSibling);let n=_MainPanel._nonEmptySibling(t,t=>t.nextSibling);if(null==n){if((n=i.firstChild)==t)return null}else n=n.nextSibling;return history$.group_(RS.action_MoveToNext,t.nodeName,()=>{new DomBuilderEx(i).removeChild_(t).insertBefore_(n,t),native$.iSelectNode_(t,null,!0),null==e||e()}),null}_actionMovetoParent(){const t=native$.getSingleSelectedOrCollapsedElement_();toasters$.warn_(_MainPanel._actionMovetoParent1(t)),this.updateContextmenuState_()}_actionMovetoPrev(){const t=native$.getIFrameSelectionRange_();let e;e=null!=t&&t.collapsed?JsUtil.getSplitParent_(t.startContainer):native$.getSingleSelectedNodeOfRange_(t),toasters$.warn_(_MainPanel._actionMovetoPrev1(e)),this.updateContextmenuState_()}_actionMovetoNext(){const t=native$.getIFrameSelectionRange_();let e;e=null!=t&&t.collapsed?JsUtil.getSplitParent_(t.startContainer):native$.getSingleSelectedNodeOfRange_(t),toasters$.warn_(_MainPanel._actionMovetoNext1(e)),this.updateContextmenuState_()}static _actionToggleLeftSidepanel(){sidePanel$.isShown_()?sidePanel$.hideSidepanel_():sidePanel$.showSidepanel_(sidePanel$.lastTabId$,!1)}static _actionToggleRightSidebar(){const t=native$.iGetElementById_(ID.xRightSidebar);null!=t&&native$.toggleClasses_(t,[CSS.xHidetemp])}static _actionRotate(){const t=native$.getIFrameSelectionRange_(),e=null==t?null:native$.getSingleSelectedNodeOfRange_(t);null!=t&&null!=e&&_MainPanel._actionEditOpOK(e)?_MainPanel._actionRotate0(t,e,null):toasters$.warnKey_(RS.ActionRequireASingleElementSelection)}static _actionRotate0(t,e,i=null){const n=native$.getComputedStyle1_(e,null,"position");"absolute"==n||"fixed"==n||"relative"==n?_MainPanel._actionRotate1(e,i):_MainPanel._actionRotate90(e,i)}static _actionRotate1(t,e=null){const i=new CompositeDialog(accessories$,[new InputField("","","0",RS.RotationDeg)]);i.titleKey_(RS.Rotate),i.zindex_(DEF.zindexPrompt),i.onOK_((i,n)=>{const s=i.getValueAt_(0),o=An.parseInt_(s,null);if(null==o)return i.warn_(MSG.string1_(RS.InvalidValue_,s)),void n(!1);n(!0),history$.group_(RS.action_Rotate,t.nodeName,()=>{const i=t.style;i.transform=`rotate(${o}deg)`,i.transformBox="0 0",null==e||e(t)})}),i.show_()}static _actionRotate90(t,e=null){const i=new CompositeDialog(accessories$,[new SelectFIeld("","","90 deg",RS.Rotation,["0 deg","90 deg","180 deg","270 deg"])]);i.titleKey_(RS.Rotate),i.zindex_(DEF.zindexPrompt),i.onOK_((i,n)=>{const s=_Util.getRotation_(i.getValueAt_(0),0);n(!0),history$.group_(RS.action_Rotate,t.nodeName,()=>{const i=JsUtil.wrapNode_(t,"div"),n=JsUtil.wrapNode_(i,"div",{class:CSS.xRotate,style:"display:inline-block;"}),o=i.style;o.transform="";const l=native$.getComputedStyle_(i,null,["width","height"]),a=l.get("width"),r=l.get("height");if(o.width=a,o.height=r,90==s||270==s){const t=n.style;t.width=r,t.height=a}else{const t=n.style;t.width=a,t.height=r}switch(s){case 0:o.transform="",o.transformOrigin="";break;case 90:o.transform=`translateX(${r}) rotate(${s}deg)`,o.transformOrigin="0 0";break;case 180:o.transform=`rotate(${s}deg)`,o.transformOrigin="50% 50%";break;case 270:o.transform=`translateY(${a}) rotate(${s}deg)`,o.transformOrigin="0 0"}native$.iSelectNode_(n),null!=e&&e(n)})}),i.show_()}static _actionOnEnter(){const t=_MainPanel._requireNonBodySelection();if(null==t)return!0;let e=t.startContainer;const i=t.startOffset,n=e.nodeType;let s=null;if(n==Node.TEXT_NODE){s=e.splitText(i);const t=e.parentElement;if(null!=t)return _MainPanel._onEnter1(t,s),!0}else if(n==Node.ELEMENT_NODE)return s=e.childNodes[i],!_MainPanel._isValidInputElement(s)&&(_MainPanel._onEnter1(e,s),!0);return!1}static _onEnter1(t,e){const i=new DomBuilderEx(t).insertBefore_(e,"br");_MainPanel._placeholderXXX(i,e)}static _containsElement(t){return null!=JsUtil.find_(t,t=>t.nodeType==Node.ELEMENT_NODE&&"BR"!=t.nodeName?t:null)}static _actionOnBackspace(){const t=_MainPanel._requireNonBodySelection();if(null==t)return!0;if(!t.collapsed){const e=t.cloneContents();return this._containsElement(e)?(toasters$.warn_(MSG.stringArray_(RS.NotDeletingNodeOnBackspace)),!0):(history$.group_(RS.Backspace,"#range",()=>{t.deleteContents()}),!0)}const e=t.startContainer;if(null==e)return!0;const i=e.nodeType;if(i==Node.TEXT_NODE)return this._backspace1(e,t.startOffset);if(i==Node.ELEMENT_NODE&&t.startOffset>0){const i=e.childNodes[t.startOffset-1];return"BR"==i.nodeName?(native$.iSelectNode_(i),!0):this._backspace1(i,null)}return toasters$.warn_(MSG.string_(RS.NotDeletingNodeOnBackspace)),native$.iClearSelection_(),!0}static _backspace1(t,e){var i;if(t.nodeType==Node.TEXT_NODE){const n=null!==(i=JsUtil.nodeValue_(t))&&void 0!==i?i:"",s=null==e?n.length:e;if(0!=s)return history$.group_(RS.Backspace,n.substring(s-1,s),()=>{const e=n.substring(0,s-1)+n.substring(s);0==e.length?(JsUtil.setTextContent_(t,""),native$.iSelectNode_(t)):(JsUtil.setTextContent_(t,e),native$.iSelect_(t,s-1,s-1))}),!0;{if(0==n.trim().length)return history$.group_(RS.Backspace,"",()=>{JsUtil.setTextContent_(t,""),native$.iSelectNode_(t)}),!0;const e=t.previousSibling;if(null!=e)return"BR"==e.nodeName?(history$.group_(RS.Backspace,"BR",()=>{JsUtil.remove_(e)}),!0):this._backspace1(e,null)}}return toasters$.warn_(MSG.string1_(RS.NotDeletingNodeOnBackspace,t.nodeName)),native$.iClearSelection_(),!0}static _requireNonBodySelection(){return _MainPanel._requireNonBodySelection1(native$.getIFrameSelectionRange_())}static _requireNonBodySelection1(t){return null==t?(toasters$.warnKey_(RS.ActionRequireAValidSelection),null):RangeUtil.isValidNonBodyRange_(t)?t:(toasters$.warnKey_(RS.ActionNotPermittedOnBodyElement),null)}static _actionCalculator(){const t=new PromptCalc(accessories$,cache$.ui$.buttonSize_());t.zindex_(DEF.zindexPrompt),t.onOK_(t=>{t.length>0&&(clipboard$.string_(t),host$.copyToClipboard_(t,An.noop_),toasters$.ok_([MSG.string_(RS.CopiedToLocalAndSystemClipboard_),t],{attop:!0}))}),t.show_()}static _actionCopy(){let t=_MainPanel._requireNonBodySelection();if(null==t)return;if(t.collapsed){const e=JsUtil.getSplitParent_(t.startContainer);if(null==e)return void toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection));if(null==(t=native$.iSelectNode_(e)))return}const e=native$.cloneRange_(t),i=JsUtil.getContextHtml_(t.startContainer);clipboard$.dom_(native$.serializeClone_(e),i),_MainPanel._toastSingleNodeOrKey(t,RS.CopyOK)}static _actionCut(){let t=_MainPanel._requireNonBodySelection();if(null==t)return;if(t.collapsed){const e=JsUtil.getSplitParent_(t.startContainer);if(null==e)return void toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection));t=native$.iSelectNode_(e)}if(null==t)return;const e=t;history$.group_(RS.action_Cut,"",()=>{const i=native$.cloneRange_(e),n=JsUtil.getContextHtml_(e.startContainer);clipboard$.dom_(native$.serializeClone_(i),n),_MainPanel._toastSingleNodeOrKey(t,RS.CutOK),e.deleteContents(),_MainPanel._recalculateTotals()})}static _toastSingleNodeOrKey(t,e){const i=native$.getSingleSelectedNodeOfRange_(t);null!=i?_JsUtil.toastNode_(i):toasters$.infoKey_(e)}static _actionPasteOK(){const t=native$.getIFrameSelectionRange_();return _MainPanel._actionPasteOK1(t)}static _actionPasteOK1(t){return null==_MainPanel._requireNonBodySelection1(t)?null:clipboard$.isEmpty_()?(toasters$.warnKey_(RS.ClipboardIsEmptyOrInvalid),null):t}static _actionPasteChild(){const t=_MainPanel._actionPasteOK();if(null==t)return;const e=native$.cloneClipboard_(clipboard$.get_()),i=null==e?null:e.nodeType;null!=e&&(i==Node.TEXT_NODE||i==Node.ELEMENT_NODE&&null!=(null==e?void 0:e.firstChild))?history$.group_(RS.action_PasteChild,"",()=>{if(e.nodeType==Node.TEXT_NODE)t.deleteContents(),t.insertNode(e);else{const i=t.startContainer,n=null==i?null:i.nodeName;if(null==n)return void toasters$.warnKey_(RS.InvalidSelection);const s=Array.from(e.childNodes);if(_MainPanel._canInsertAll(n,s)){t.deleteContents();for(let i,n=e.lastChild;null!=n;n=i)i=n.previousSibling,t.insertNode(n)}else{if(null==JsUtil.findChildElement_(e,"LI")||!_MainPanel._canInsertAll("UL",s))return void toasters$.warnKey_(RS.InvalidSelection);{const i=_MainPanel._insertnode(t,"ul");if(null!=i){t.deleteContents();for(let t,n=e.firstChild;null!=n;n=t)t=n.nextSibling,i.append(n)}}}native$.iSelectRange_(t,!0),_MainPanel._recalculateTotals()}}):toasters$.warnKey_(RS.ClipboardIsEmptyOrInvalid)}static _insertnode(t,e){const i=RangeUtil.rangeOwnerDocument_(t);if(null==i)return null;const n=DomBuilderEx.offline_(i,e).cursor_();return t.insertNode(n),n}static _canInsertAll(t,e){var i,n;const s=null!==(i=Html5.validChildren.get(t))&&void 0!==i?i:null;for(const i of e){if(i.nodeType!=Node.ELEMENT_NODE)continue;const e=i.nodeName;if(null!=s&&!s.includes(e))return!1;const o=null!==(n=Html5.validParent.get(e))&&void 0!==n?n:null;if(null!=o&&!o.includes(t))return!1}return!0}static _canInsert1(t,e){var i,n;if(e.nodeType!=Node.ELEMENT_NODE)return!0;const s=e.nodeName,o=null!==(i=Html5.validChildren.get(t))&&void 0!==i?i:null;if(null!=o&&!o.includes(s))return!1;const l=null!==(n=Html5.validParent.get(s))&&void 0!==n?n:null;return!(null!=l&&!l.includes(t))}static _actionPasteSibling(){let t=null;const e=native$.getIFrameSelectionRange_();if(null!=e&&e.collapsed)t=native$.getNearestSelectedElement_();else{const i=native$.getSelectedNodesOfRange_(e);for(null!=i&&i.length>0&&(t=i[i.length-1]);null!=t&&t.nodeType!=Node.ELEMENT_NODE&&!An.isBodyElement_(t.nodeName);)t=t.parentNode}if(null==t||An.isBodyElement_(t.nodeName))return void toasters$.warnKey_(RS.InvalidSelection);const i=native$.cloneClipboard_(clipboard$.get_()),n=null==i?null:i.nodeType;if(null==i||n!=Node.TEXT_NODE&&(n!=Node.ELEMENT_NODE||null==i.firstChild))return void toasters$.warnKey_(RS.ClipboardIsEmptyOrInvalid);if(n==Node.ELEMENT_NODE&&null!=e&&e.collapsed){const e=i.firstElementChild;if(null!=e){const i=e.nodeName;for(;null!=t&&t.nodeName!=i;)t=t.parentNode;if(null==t||An.isBodyElement_(t.nodeName))return void toasters$.warnKey_(RS.InvalidSelection)}}const s=t.parentElement;null==s||An.isHtmlElement_(s.nodeName)?toasters$.warnKey_(RS.InvalidSelection):_MainPanel._actionPasteSibling1(s,t,n,i)}static _actionPasteSibling1(t,e,i,n){let s=1;return history$.group_(RS.action_PasteSibling,e.nodeName,()=>{const o=e.nextSibling,l=new DomBuilderEx(t);if(i==Node.TEXT_NODE)l.appendNodes_(n),native$.iSelectNode_(n);else{s=n.childNodes.length;const e=n.firstChild,i=n.lastChild;if(!_MainPanel._pasteSibling(l,t,o,n))return void toasters$.warnKey_(RS.InvalidSelection);null!=e&&native$.iSelectNodes_(e,i,!0),_MainPanel._recalculateTotals()}}),s}static _pasteSibling(t,e,i,n){const s=e.nodeName,o=Array.from(n.childNodes),l=n.firstChild;if(_MainPanel._canInsertAll(s,o)){for(let e,n=l;null!=n;n=e)e=n.nextSibling,t.insertBefore_(i,n);return!0}if(null!=JsUtil.findChildElement_(n,"LI")&&_MainPanel._canInsertAll("UL",o)){t.childBefore_(i,"ul");for(let e,i=l;null!=i;i=e)e=i.nextSibling,t.appendNodes_(i);return!0}return!1}_actionUndo(){history$.undo_()||toasters$.warnKey_(RS.NothingToUndo),this.updateContextmenuState_()}static _actionUndoHistory(){if(history$.isUndoEmpty_())return void toasters$.warnKey_(RS.NothingToUndo);const t=new PromptUndo(accessories$,history$);t.titleKey_(RS.Undo),t.zindex_(DEF.zindexPrompt),t.onOK_(t=>{null!=t&&history$.undo_(t)}),t.show_()}_actionRedo(){history$.redo_()||toasters$.warnKey_(RS.NothingToRedo),this.updateContextmenuState_()}static _actionWrap1(t,e){const i=new PromptElement(accessories$);i.titleKey_(RS.WrapSelection),i.messageKey_(RS.PromptElementMessage),i.zindex_(DEF.zindexPrompt),i.tag_("DIV"),i.onOK_((i,n,s,o)=>{Sanitizers.checkTagAttrs_(n,s,native$.getIFrameUri_(),n=>{if(i.warn_(n))return void o(!1);o(!0),toasters$.warn_(n[Key.warns]);const s=n[Key.tag],l=n[Key.attrs];history$.group_(RS.action_Wrap,s,()=>{const i=RangeUtil.wrapRange_(s,l,t);if(null==i)return void toasters$.error_("Wrap action failed");let n=!0;for(let t=i.firstChild;null!=t;t=t.nextSibling)if(!JsUtil.isWhitespaceNode_(t)){n=!1;break}if(n){const t=new DomBuilderEx(i);_MainPanel._placeholder(t,null)}else native$.iSelectNode_(i);_JsUtil.toastElement_(i),null!=e&&e(i)})})}),i.show_()}static _actionWrap(){native$.focusIFrame_();const t=native$.getIFrameSelectionRange_();toasters$.warn_(JsUtil.actionWrapOK_(t))||null==t||_MainPanel._actionWrap1(t,An.noop_)}static _actionUnwrapOK(t){return null!=t&&t.nodeType==Node.ELEMENT_NODE&&!An.isBodyElement_(t.nodeName)&&null!=t.firstChild}static _actionUnwrap(){var t;const e=native$.getSingleSelectedNode_(),i=null!==(t=null==e?void 0:e.parentElement)&&void 0!==t?t:null;_MainPanel._actionUnwrapOK(e)&&null!=e&&null!=i?history$.group_(RS.action_Unwrap,e.nodeName,()=>{const t=new DomBuilderEx(i),n=e.firstChild;null!=n&&(t.moveChildrenBefore_(e,n,null),native$.iSelectNodes_(n,e.lastChild)),t.removeChild_(e)}):toasters$.warnKey_(RS.ActionRequireASingleElementSelection)}static _noplaceholder(t){return"A"==t.nodeName&&null==t.getAttribute("href")&&null!=t.getAttribute("name")}static _actionInsertElement(){const t=native$.getIFrameSelectionRange_();if(null!=t&&t.collapsed){const e=_Util.promptInsertElement_();e.onChild_((e,i)=>{history$.group_(RS.action_InsertElementChild,e,()=>{const n=DomBuilderEx.offline_(RangeUtil.rangeOwnerDocument_(t),e,i),s=n.cursor_();RangeUtil.replaceRange_(t,s),_MainPanel._noplaceholder(s)||_MainPanel._placeholder(n,null),_JsUtil.toastElement_(s)})}),e.show_()}else{const e=native$.getSingleSelectedNodeOfRange_(t);if(null==e)return void toasters$.warnKey_(RS.ActionRequireASingleNodeSelection);_MainPanel._actionInsertElement1(e,null)}}static _actionInsertElement1(t,e=null){native$.iSelectNode_(t);const i=_Util.promptInsertElement_(),n=t.nodeName,s=An.isBodyElement_(n),o=t.parentElement;s||null==o||i.onAfter_((i,n)=>{history$.group_(RS.action_InsertElementSibling,i,()=>{const s=new DomBuilderEx(o),l=s.childBefore_(t.nextSibling,i,n).cursor_();native$.iRevealNode_(l),_MainPanel._noplaceholder(l)||_MainPanel._placeholder(s,null),_JsUtil.toastElement_(l),null==e||e(l,!0)})});const l=DomUt.asHTMLElement_(t),a=null!=l&&!Html5.isEmptyTag(n);a&&null!=l&&i.onChild_((i,n)=>{history$.group_(RS.action_InsertElementChild,i,()=>{const s=new DomBuilderEx(l),o=s.childBefore_(t.firstChild,i,n).cursor_();native$.iRevealNode_(o),_MainPanel._noplaceholder(o)||_MainPanel._placeholder(s,null),_JsUtil.toastElement_(o),null!=e&&e(o,!1)})}),!s||a?i.show_():toasters$.warnKey_(RS.InvalidSelection)}static _actionInsertText1(t,e=null){native$.iSelectNode_(t),_SymbolPreferences.get_(i=>{const n=JsUtil.getElementSelfOrParent_(t);if(null==n)return void toasters$.warnKey_(RS.InvalidSelection);const s=native$.getComputedStyle1_(n,null,"font-family"),o=_Util.promptInsertText_(s,i),l=t.nodeName,a=An.isBodyElement_(l),r=t.parentElement;a||null==r||o.onAfter_((i,n,s)=>{s(!0),history$.group_(RS.action_InsertTextSibling,l,()=>{const i=new DomBuilderEx(r),s=DomBuilderEx.createText_(n);i.insertBefore_(t.nextSibling,s),native$.iSelectNode_(s,null,!0),null==e||e(s,!0)})});const _=DomUt.asHTMLElement_(t),c=null!=_&&!Html5.isEmptyTag(l);c&&null!=_&&o.onChild_((i,n,s)=>{s(!0),history$.group_(RS.action_InsertTextChild,l,()=>{const i=new DomBuilderEx(_),s=DomBuilderEx.createText_(n);i.insertBefore_(t.firstChild,s),native$.iSelectNode_(s,null,!0),null==e||e(s,!1)})}),!a||c?o.show_():toasters$.warnKey_(RS.InvalidSelection)})}static _actionSpawnNode(){const t=native$.getIFrameSelectionRange_();let e;if(null!=t&&t.collapsed)for(e=RangeUtil.rangeStart_(t);null!=e&&(e.nodeType!=Node.ELEMENT_NODE||!Html5.canSplitTag(e.nodeName));)e=e.parentNode;else e=native$.getSingleSelectedNodeOfRange_(t);const i=DomUt.asHTMLElement_(e);null!=i?_MainPanel._spawnNode0(i,t=>{native$.focusIFrame_(),null!=t&&(_MainPanel._recalculateTotals(),_JsUtil.toastNode_(t))}):toasters$.warnKey_(RS.ActionRequireASingleElementOrACollapsedSelection)}static _spawnNode0(t,e){const i=t.parentElement,n=t.nodeName,s=DomUt.asHTMLElement_(t);if(null==i||null!=s&&An.isBodyElement_(n))return toasters$.warnKey_(RS.ActionNotPermittedOnBodyElement),void e(null);history$.group_(RS.action_Spawn,n,()=>{const n=_MainPanel._spawnNode1(i,t);native$.iSelectNode_(n,null,!0),e(n)})}static _spawnNode1(t,e){const i=native$.cloneNode_(e);return new DomBuilderEx(t).insertBefore_(e.nextSibling,i),i}static _actionEditOpOK(t){return null!=t&&t.nodeType==Node.ELEMENT_NODE&&!An.isBodyElement_(t.nodeName)}static _requireSingleNonBodyElementSelection(){const t=native$.getSingleSelectedNode_();return _MainPanel._actionEditOpOK(t)?t:(toasters$.warnKey_(RS.ActionRequireASingleElementSelection),null)}static _requireSingleOrCollapsedElementSelection(){const t=native$.getSingleSelectedOrCollapsedElement_();return _MainPanel._actionEditOpOK(t)?t:(toasters$.warnKey_(RS.ActionRequireASingleElementOrACollapsedSelection),null)}static _resizeInfo(t,e=!0,i=!0){const n=native$.getComputedStyle_(t,null,[SK.Display,SK.Visibility,SK.Position,SK.Width,SK.Height,SK.Top,SK.Left]),s=n.get(SK.Display),o=n.get(SK.Visibility),l=n.get(SK.Position);if(s==SV.None||o==SV.Hidden)return null;const a=An.parseDoublePx_(n.get(SK.Left),null),r=An.parseDoublePx_(n.get(SK.Top),null),_=An.parseDoublePx_(n.get(SK.Width),null),c=An.parseDoublePx_(n.get(SK.Height),null),h=null!=a&&null!=r&&(l==SV.Fixed||l==SV.Absolute||l==SV.Relative),u=e&&null!=_&&null!=c;let d=JsUtil.isBody_(t);if(!d){const e=t.parentNode;d=null==e||JsUtil.isBody_(e)}return new ElementResizerInfo(t,h,u,i&&!d,l,a,r,_,c)}_actionEditSize(){const t=_MainPanel._requireSingleNonBodyElementSelection();null!=t&&(native$.iSelectNode_(t),this.actionEditSize0_(t,null))}actionEditSize0_(t,e=null){const i=_MainPanel._resizeInfo(t,!1,!0);if(null==i||!i.canReposition&&!i.canRotate)return toasters$.warnKey_(RS.CannotRepositionResizeOrRotateElement),void(null==e||e());this.actionEditSize1_(i,e)}actionEditSize1_(t,e=null){this.isEditing()?this._actionEditSizeEditing(t,e):this._actionEditSizeBrowsing(t,e)}_actionEditSizeEditing(t,e=null){const i=this._mainToolbar.button(MainToolbarActions._EDITINGMENU).classList;i.remove(CSS.FaToggleDown),i.add(CSS.FaArrows),new Smokescreen(accessories$,DEF.zindexResizer,DEF.opacityResizing).show_(n=>{const s=_MainPanel._startGroup(RS.action_Reposition,t.target.nodeName),o=new ElementResizer(n,t);o.onDone(()=>{_MainPanel._endGroup(s),toasters$.hideInfo_(),i.remove(CSS.FaArrows),i.add(CSS.FaToggleDown),null==e||e()}),o.bind()})}_actionEditSizeBrowsing(t,e=null){new Smokescreen(accessories$,DEF.zindexResizer,DEF.opacityResizing).show_(i=>{const n=new ElementResizer(i,t);n.onDone(()=>{toasters$.hideInfo_(),null==e||e()}),n.bind()})}static _actionEditAlign(){const t=_MainPanel._requireSingleNonBodyElementSelection();null!=t&&(native$.iSelectNode_(t),_MainPanel._actionEditAlign1(t))}static _actionEditAlign1(t,e=null){const i=t.nodeName;if(!Html5.canEditTag(i))return void toasters$.warn_(MSG.string1_(RS.elementNotEditable_,i));const n=t.getAttribute("style"),s=native$.getStyleOrComputedStyle_(t,null,["text-align","vertical-align","float","clear"]);history$.startGroup_(RS.action_EditAlign,t.nodeName);const o=new CompositeDialog(accessories$,[new SelectFIeld(RS.TextAlign,"text-align",s.get("text-align"),RS.TextAlign,PV.TextAlign),new SelectFIeld(RS.VerticalAlign,"vertical-align",s.get("vertical-align"),RS.VerticalAlign,PV.VerticalAlign),new SelectFIeld(RS.Float,"float",s.get("float"),RS.Float,PV.Float),new SelectFIeld(RS.Clear,"clear",s.get("clear"),RS.Clear,PV.Clear)]);o.titleKey_(RS.EditAlign),o.zindex_(DEF.zindexPrompt),o.onChange_((e,i)=>{const n=e.spec$.key$,s=i.getValue_("");t.style.setProperty(n,s)}),o.onCancel_(()=>{JsUtil.setAttribute0_(t,"style",n),history$.endGroup_()}),o.onOK_((i,n)=>{const o=i.getChanged_(s);cssParser$.sanitizeStyle_(CSSUtil.joinStylesRemovingEmptyValues_(o),native$.getIFrameUri_(),i=>{if(toasters$.warn_(i))return void n(!1);n(!0);for(const e of o.keys())t.style.setProperty(e,"'");const s=i[Key.style];for(const[e,i]of Object.entries(s))t.style.setProperty(e,i);null==e||e(t),history$.endGroup_()})}),o.show_()}static _actionEditRawStyle1(t,e=null){var i,n;const s=t.nodeName;if(!Html5.canEditTag(s))return void toasters$.warn_(MSG.string1_(RS.elementNotEditable_,s));const o=null!==(n=null===(i=t.getAttribute("style"))||void 0===i?void 0:i.trim())&&void 0!==n?n:"",l=native$.getIFrameContextPath_(),a=native$.getIFrameUri_();null!=a&&null!=l&&(0!=o.length?cssParser$.sanitizeStyle_(o,a,i=>{toasters$.warn_(i);const n=i[Key.style];if(null==n)return;const s=CSSUtil.joinlnStyleList_(Object.entries(n)).trim();this._actionEditRawStyle2(t,s,l,a,e)}):this._actionEditRawStyle2(t,"",l,a,e))}static _actionEditRawStyle2(t,e,i,n,s=null){const o=t.getAttribute(ATTR.xAnnotation),l=t.style.width,a=t.style.height;_Util.styleEditor_(accessories$,e,i,n,DEF.zindexPrompt,toasters$,e=>{const i=CSSUtil.joinStyles1_(Object.entries(e)),r=t.nodeName;history$.group_(RS.action_EditRawStyle,r,()=>{JsUtil.setAttribute0_(t,"style",i),"IMG"==r&&native$.hasClass_(t,CSS.xCanvas)&&_MainPanel._rerenderCanvas(t,n,l,a,o,!1),null==s||s()})}).show_()}static _actionEditStyle(){const t=_MainPanel._requireSingleOrCollapsedElementSelection();null!=t&&(native$.iSelectNode_(t),_MainPanel._actionEditStyle1(t))}static _actionEditStyle1(t,e=null){const i=t.nodeName;if(!Html5.canEditTag(i))return void toasters$.warn_(MSG.string1_(RS.elementNotEditable_,i));const n=native$.getIFrameUri_();if(null==n)return;const s=t.getAttribute("style");null==s||0==s.length?_MainPanel._actionEditStyle2(t,"",smap_(),n,e):cssParser$.sanitizeStyle_(s,n,i=>{var o;if(toasters$.warn_(i))return;const l=null!==(o=i[Key.style])&&void 0!==o?o:smap_();_MainPanel._actionEditStyle2(t,s,l,n,e)})}static _actionEditStyle2(t,e,i,n,s=null){_JsUtil.getBgImgFromStyleAttribute_(t,n,o=>{null!=o&&"none"!=o||(o="");const l=CSSUtil.humanCSSUrl_(o),a=t.style,r=a.display,_=a.lineHeight,c=a.width,h=a.height,u=a.margin,d=a.padding,S=CSSUtil.cssLengthUnit_(c),p=CSSUtil.cssLengthUnit_(h);history$.startGroup_(RS.action_EditStyle,t.nodeName);const m=_Util.promptValues_(RS.EditStyleTitle,[new SelectFIeld(RS.Display,"display",r,RS.Display,PV.Display),new UriField(RS.BGImageURL,"background-image",l,RS.BGImageURL,n,[BUT.PathKind,BUT.Folder],Callbacks.onAnyImageFolderButton_),new InputField(RS.LineHeight,"line-height",_,RS.LineHeight),new InputSelectField(RS.Width,"width",null==S?"":`${S[0]}`,RS.Width,null==S?"":S[1],CSSLengths),new InputSelectField(RS.Height,"height",null==p?"":`${p[0]}`,RS.Height,null==p?"":p[1],CSSLengths),new InputField(RS.Padding,"padding",d,RS.Padding),new InputField(RS.Margin,"margin",u,RS.Margin)]);m.largeWidth_(),m.messageKey_(RS.EditSpacingMessage),m.zindex_(DEF.zindexPrompt),m.onOK_((e,l)=>{var a;const S=e.getChanged_(map_(["display",r],["background-image",null!=o?o:""],["line-height",_],["width",c],["height",h],["padding",d],["margin",u])),p=null!==(a=S.get("background-image"))&&void 0!==a?a:null;null!=p&&0!=p.length&&"unset"!=p&&"none"!=p?Sanitizers.checkImageHref_(p,n).onFail_(t=>{l(!1),e.warn_(t)}).onOK_(o=>{l(!0),S.set("background-image",CSSUtil.toCSSUrl_(o.toString())),_MainPanel._actionEditStyle3(e,S,n,l,t,i,s)}):_MainPanel._actionEditStyle3(e,S,n,l,t,i,s)}),m.onCancel_(()=>{JsUtil.setAttribute0_(t,"style",e),history$.endGroup_()}),m.show_()})}static _actionEditStyle3(t,e,i,n,s,o,l=null){cssParser$.sanitizeStyle_(CSSUtil.joinStylesRemovingEmptyValues_(e),i,t=>{if(toasters$.warn_(t))return void n(!1);n(!0);for(const t of e.keys())o[t]="";const a=t[Key.style];for(const[t,e]of Object.entries(a))o[t]=e;JsUtil.setAttribute0_(s,"style",CSSUtil.joinStyles1_(Object.entries(o)));const r=native$.getStyleOrComputedStyle_(s,null,["background-image"]),_=s.nodeName,c=s.getAttribute(ATTR.xAnnotation),h=s.style,u=h.width,d=h.height;_MainPanel._cleanupBackgroundImageStyle(r,h),"IMG"==_&&native$.hasClass_(s,CSS.xCanvas)&&_MainPanel._rerenderCanvas(s,i,u,d,c,!1),null!=l&&l(s),history$.endGroup_()})}static _cssurl(t,e,i){const n=t.parseUri_(e,i);return null!=n?CSSUtil.toCSSUrl_(n.toString()):null}static _cleanupBackgroundImageStyle(t,e){const i=t.get("background-image");if(null==i||0==i.length){e.backgroundImage="",e.backgroundPosition="";for(const t of["background-attachment","background-color","background-size","background-origin","background-clip","background-repeat"])"initial"==e.getPropertyValue(t)&&e.setProperty(t,"")}}static _actionEditNode(){_MainPanel._actionEditNode1(!0,t=>{_MainPanel._actionEditElement1(t)})}static _actionEditNode1(t,e){const i=native$.getIFrameSelectionRange_();if(null!=i){let n=null,s=null,o=null;if(null!=i&&i.collapsed)n=i.startContainer,s=i.startOffset;else{const t=i.commonAncestorContainer;t.nodeType==Node.TEXT_NODE?(n=t,s=i.startOffset,o=i.endOffset):n=native$.getSingleSelectedNodeOfRange_(i)}if(null!=n){const i=n.nodeType;if(i==Node.ELEMENT_NODE&&!An.isBodyElement_(n.nodeName))return void e(n);if(i==Node.TEXT_NODE)return void _MainPanel._actionEditText1(n,t,s,o)}}toasters$.warnKey_(RS.ActionRequireASingleNodeSelection)}static _actionEditElement1(t,e=null){var i;const n=native$.getIFrameUri_();if(null==n)return;const s=t.nodeName;if("A"!=s)if("IMG"!=s)if("AUDIO"!=s&&"VIDEO"!=s)if("SOURCE"!=s)"TRACK"!=s?Html5.canEditTag(s)?_MainPanel._actionEditElementRaw1(t,n,e):toasters$.warn_(MSG.string1_(RS.elementNotEditable_,s)):_MainPanel._actionEditMedia(t,s,n,e);else{const s=null===(i=t.parentNode)||void 0===i?void 0:i.nodeName;"AUDIO"!=s&&"VIDEO"!=s||_MainPanel._actionEditMedia(t,s,n,e)}else _MainPanel._actionEditMedia(t,s,n,e);else _MainPanel._actionEditImg(t,n,e);else _MainPanel._actionEditLink(t,!1,n,e)}static _actionEditElementRaw1(t,e,i=null){const n=t.nodeName,s=t.getAttribute(ATTR.xAnnotation),o=t.style.width,l=t.style.height,a=JsUtil.sortedAttributes_(t),r=new PromptEditElement(accessories$);r.titleText_(n),r.zindex_(DEF.zindexPrompt),r.messageKey_(RS.PromptElementMessage),r.tag_(n),r.attributes_(An.attributesToStringForEdit_(a," ",["xmlns"])),r.onOK_((a,r,_,c)=>{Sanitizers.checkTagAttrs_(r,_,e,r=>{if(a.warn_(r))return void c(!1);c(!0),toasters$.warn_(r[Key.warns]);const _=r[Key.tag],h=r[Key.attrs];history$.group_(RS.action_EditElement,n,()=>{let a,r=!1;_==n?(native$.removeAttributes_(t),new DomBuilderEx(t).attrs_(h),a=t):(a=new DomBuilderEx(t).up_().childBefore_(t,_,h).moveChildren_(t.firstChild,null).push_().up_().removeChild_(t).pop_().cursor_(),native$.iSelectNode_(a),r=!0),"IMG"==_&&native$.hasClass_(a,CSS.xCanvas)&&_MainPanel._rerenderCanvas(a,e,o,l,s,r),native$.iSelectNode_(a),null==i||i(a,!1)})})}),r.show_()}static _actionEditText1(t,e,i=null,n=null,s=null){var o;const l=null!==(o=t.nodeValue)&&void 0!==o?o:"",a=JsUtil.getElementSelfOrParent_(t);if(null==a)return toasters$.warnKey_(RS.InvalidSelection),void(e&&native$.focusIFrame_());const r=native$.getComputedStyle1_(a,null,"font-family");null!=r&&Callbacks.promptEditText_(l,r,DEF.zindexPrompt,i=>{i.onOK_((i,n,o,a)=>{a(!0),e&&native$.focusIFrame_(),history$.group_(RS.action_EditTextNode,An.truncate_(l,DEF.historyTextLength),()=>{t.nodeValue=n,(null==o||o<0)&&(o=0),o>=n.length&&(o=n.length),native$.iSelect_(t,o,o)}),null==s||s(n)}),i.onCancel_(()=>{e&&native$.focusIFrame_()}),i.show_()})}static _actionEditLink(t,e,i,n=null){var s;const o=JsUtil.sortedAttributes_(t),l=HumanLink.fromHref_(null!==(s=o.get("href"))&&void 0!==s?s:""),a=JsUtil.trimmedTextContent_(t),r=An.attributesToStringForEdit_(o," ",["xmlns","href"]);if(_MainPanel._textchildonly(t)){_Util.promptLink3_(RS.EditLinkTitle,e,l,a,r,i,(e,i,s)=>{history$.group_(RS.action_EditLink,An.filenameFromUri_(e),()=>{null==e?delete s.href:s.href=e.toString();const o=DomBuilderEx.offline_(t.ownerDocument,"A",s).text_(i).cursor_(),l=t.parentElement;if(null!=l){const e=new DomBuilderEx(l);e.push_().childBefore_(t,o),e.pop_().removeChild_(t),native$.iSelectNode_(o)}null==n||n(o,!1)})}).show_()}else{_Util.promptLink21_(RS.EditLinkTitle,l,r,i,Callbacks.onLinkFolderButton_,(e,i)=>{const s=t.parentElement;if(null!=e&&null!=s){i.href=e.toString();const o=_MainPanel.replaceLink(s,t,e,i);null==n||n(o,!1)}}).show_()}}static _editAudioLink(t,e,i){var n;null===(n=this._actionEditMediaElement(t,t.nodeName,e,(e,n)=>{const s=t.parentElement;if(null!=e&&null!=s){n.src=e.toString(),_MainPanel.replaceLink(s,t,e,n);const o=JsUtil.parentOrSelfWithAttr_(s,ATTR.xPlaceholder,Placeholder.xpAudioinfo);i(o)}}))||void 0===n||n.show_()}static _editVideoLink(t,e,i){return this._actionEditMediaElement(t,t.nodeName,e,(e,n)=>{const s=t.parentElement;if(null!=e&&null!=s){n.src=e.toString(),_MainPanel.replaceLink(s,t,e,n);const o=JsUtil.parentOrSelfWithAttr_(s,ATTR.xPlaceholder,Placeholder.xpVideoinfo);i(o)}})}static replaceLink(t,e,i,n){const s=DomBuilderEx.offline_(e.ownerDocument,e.tagName,n).cursor_();return history$.group_(RS.action_EditLink,An.filenameFromUri_(i),()=>{const i=new DomBuilderEx(t);i.push_().childBefore_(e,s),i.moveChildren_(e.firstChild,null),i.pop_().removeChild_(e),native$.iSelectNode_(s)}),s}static _textchildonly(t){for(let e=t.firstChild;null!=e;e=e.nextSibling)if(e.nodeType!=Node.TEXT_NODE)return!1;return!0}static _actionEditImg(t,e,i=null){const n=t.parentElement,s=t.getAttribute("src");null!=n?null!=s&&s.startsWith("data:image/")?_MainPanel._actionEditElementRaw1(t,e,i):_MainPanel._actionEditImg2(t,RS.EditImgTitle,s,e,(e,s)=>{null!=e&&(s.src=e.toString(),history$.group_(RS.action_EditIMG,An.filenameFromUri_(e),()=>{const e=DomBuilderEx.offline_(t.ownerDocument,"IMG",s).cursor_();n.replaceChild(e,t),native$.iSelectNode_(e),null==i||i(e,!1)}))}):toasters$.warn_(MSG.string_(RS.InvalidSelection))}static _actionEditImg2(t,e,i,n,s){const o=JsUtil.sortedAttributes_(t);o.delete("src");let l=HumanLink.Empty$;null!=i&&i.length>0&&(l=HumanLink.fromHref_(i));const a=new PromptEditMedia(accessories$,null!=l?l:HumanLink.Empty$,An.attributesToStringForEdit_(o," ",["xmlns"]),n,[BUT.PathKind,BUT.ImportImageFromPhotoLibrary,BUT.Folder],Callbacks.onAnyImageFolderButton_);a.titleKey_(e),a.zindex_(DEF.zindexPrompt),a.onOK_((t,e,i,o)=>{const l=null==e?null:_Util.getUriOfKind1_(t.getFieldAt_(0).getButton_(BUT.PathKind),e);Sanitizers.checkRequiredUri_(l).onFail_(e=>{o(!1),t.warn_(e)}).onOK_(e=>{Sanitizers.checkAttrs_(i,n,i=>{t.warn_(i)?o(!1):(toasters$.warn_(i[Key.warns]),o(!0),null==s||s(e,i[Key.attrs]))})})}),a.show_()}static _actionEditMedia(t,e,i,n=null){var s;const o=t.parentElement;null!=o?null===(s=_MainPanel._actionEditMediaElement(t,e,i,(e,i)=>{null!=e&&history$.group_(RS.action_EditIMG,An.filenameFromUri_(e),()=>{i.src=e.toString();const s=DomBuilderEx.offline_(t.ownerDocument,t.tagName,i).cursor_();o.replaceChild(s,t),native$.iSelectNode_(s),null==n||n(s,!1)})}))||void 0===s||s.show_():toasters$.warn_(MSG.string_(RS.InvalidSelection))}static _actionEditMediaElement(t,e,i,n){const s=t.getAttribute("src"),o=JsUtil.sortedAttributes_(t);o.delete("src");const l=An.attributesToStringForEdit_(o," ",["xmlns"]);return this.promptEditMedia_(e,s,l,i,n)}static promptEditMedia_(t,e,i,n,s){let o=HumanLink.Empty$;null!=e&&e.length>0&&(o=HumanLink.fromHref_(e));const l="AUDIO"==t?Callbacks.onAudioPlaybackFolderButton_:"VIDEO"==t?Callbacks.onVideoPlaybackFolderButton_:"TRACK"==t?Callbacks.onVideoTrackFolderButton_:null;return null==l?null:new PromptEditMedia(accessories$,o,i,n,[BUT.PathKind,BUT.Folder],l).titleText_(t).zindex_(DEF.zindexPrompt).onOK_((t,e,i,o)=>{const l=null==e?null:_Util.getUriOfKind1_(t.getFieldAt_(0).getButton_(BUT.PathKind),e);Sanitizers.checkRequiredUri_(l).onFail_(e=>{o(!1),t.warn_(e)}).onOK_(e=>{Sanitizers.checkAttrs_(i,n,i=>{t.warn_(i)?o(!1):(toasters$.warn_(i[Key.warns]),o(!0),null==s||s(e,i[Key.attrs]))})})})}static _actionInsertNode(t,e,i){const n=_MainPanel._requireNonBodySelection();if(null==n)return;const s=native$.iGetAncestors_();null!=s&&0!=s.length?new PromptAncestors(accessories$,s).titleKey_(t).zindex_(DEF.zindexPrompt).onOK_((e,s)=>{native$.focusIFrame_(),host$.showKeyboard_(),history$.group_(t,MSG.string_(s?RS.Tooltips_InsertAsNextSibling:RS.Tooltips_InsertAsFirstChild),()=>{i(e,s,n)})}).showAt_(e.x,e.y,!0):toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection))}static _actionParagraph(t){const e=native$.getIFrameDocument_();if(null==e)return;const i=DomBuilderEx.offline_(e,"div").append_("br").cursor_();this._actionInsertNode(RS.Paragraph,t,(t,e,n)=>{if(e){const e=t.parentElement;null!=e&&new DomBuilderEx(e).childBefore_(t.nextSibling,i)}else{const e=DomUt.asHTMLElement_(t);null!=e?new DomBuilder(e).childBeforeFirst_(i):(n.collapse(!1),n.insertNode(i))}Timer.sleep0_(()=>{native$.iSetCaretAtStart_(i.firstChild,!0)})})}static _actionInsertText(t){const e=native$.getIFrameDocument_();if(null==e)return;const i=e.createTextNode(" "+MSG.XXX$);this._actionInsertNode(RS.Text,t,(t,e,n)=>{if(e){const e=t.parentElement;null!=e&&new DomBuilderEx(e).insertBefore_(t.nextSibling,i)}else{const e=DomUt.asHTMLElement_(t);null!=e?new DomBuilder(e).insertBefore_(e.firstChild,i):(n.collapse(!1),n.insertNode(i))}native$.iSelect_(i,1,i.length)})}static _actionCreateLinkOK(t){if(null==t)return MSG.string_(RS.ActionRequireAValidSelection);const e=t.startContainer,i=t.endContainer;return null==e||null==i?MSG.string_(RS.InvalidSelection):e!=i?MSG.string_(RS.ActionRequireASelectionThatStartsAndEndsUnderTheSameParent):e.nodeType==Node.ELEMENT_NODE&&An.isHtmlElement_(e.nodeName)?MSG.string_(RS.ActionNotPermittedOnBodyElement):null}static _actionCreateLink2(t,e){_Util.promptLink2_(RS.InsertLinkTitle,HumanLink.Empty$,"",e,(e,i)=>{history$.group_(RS.action_InsertLink,An.filenameFromUri_(e),()=>{null==e?delete i.href:i.href=e.toString();const n=RangeUtil.wrapRange_("A",i,t);Timer.sleep0_(()=>{native$.iSelectNode_(n)})})}).show_()}static _actionCreateLink3(t,e,i){_Util.promptLink3_(RS.InsertLinkTitle,!1,HumanLink.Empty$,e,"",i,(e,i,n)=>{history$.group_(RS.action_InsertLink,An.filenameFromUri_(e),()=>{null==e?delete n.href:n.href=e.toString();const s=RangeUtil.rangeOwnerDocument_(t),o=DomBuilderEx.offline_(s,"A",n).text_(i).cursor_();RangeUtil.replaceRange_(t,o),Timer.sleep0_(()=>{native$.iSelectNode_(o)})})}).show_()}static _actionInsertLink(){const t=native$.getIFrameSelectionRange_();if(toasters$.warn_(_MainPanel._actionCreateLinkOK(t))||null==t)return;let e=null;if(t.collapsed)e="";else{const i=native$.getSingleSelectedNodeOfRange_(t);null!=i&&i.nodeType==Node.TEXT_NODE&&(e=JsUtil.trimmedTextContent_(i))}const i=native$.getIFrameUri_();null!=i&&(null!=e?_MainPanel._actionCreateLink3(t,e,i):_MainPanel._actionCreateLink2(t,i))}static _actionInsertImg(){const t=_MainPanel._requireNonBodySelection(),e=native$.getIFrameUri_();null!=t&&null!=e&&_MainPanel._actionInsertImg1(t,`class ${CSS.xImageholder} ${CSS.xImageDef}`,e,An.noop_).show_()}static _actionInsertImg0(t,e,i,n){return _Util.promptInsertImg_(RS.InsertImageTitle,t,e,i,n)}static _actionInsertImg1(t,e,i,n){return _MainPanel._actionInsertImg0(e,i,Callbacks.onAnyImageFolderButton_,e=>{const i=null==e?null:An.cpathOfUri_(e.src);null!=e&&null!=i?_Util.setImageOrientationOfPath_(e.attrs,i,()=>{_MainPanel._createimg(t,e.caption,e),null==n||n(!0)}):null==n||n(!1)})}static _createimg(t,e,i){const n=RangeUtil.rangeOwnerDocument_(t),s=DomBuilderEx.offline_(n,"img",{src:i.src.toString()}).attrs_(i.attrs).cursor_();let o=s;return history$.group_(RS.action_InsertImage,An.filenameFromUri_(i.src),()=>{if(null!=i.link&&(o=(MimeUtil.mediaMimeFromUri(i.link),DomBuilderEx.offline_(n,"a",{href:i.link.toString()}).appendNodes_(s).cursor_())),null!=e&&e.length>0){const t=DomBuilderEx.offline1_(n,"div",CSS.xVlayout).push_().div_().child_(o).peek_().div1_(CSS.xVcaption);t.span_().text_(e),o=t.pop_().cursor_()}RangeUtil.replaceRange_(t,o)}),s}static _actionInsertAudio(){var t;const e=_MainPanel._requireNonBodySelection(),i=null==e?null:RangeUtil.rangeOwnerDocument_(e),n=native$.getIFrameUri_();if(null==e||null==i||null==n)return;const s="/Home/drafts/audio-"+An.simpleDateTimeString_()+MimeUtil.audioRecordExts()[0];null===(t=this.promptEditMedia_("AUDIO",s,"",n,(t,n)=>{this._createAudioElement(e,i,t,n)}))||void 0===t||t.show_()}static _createAudioElement(t,e,i,n){history$.group_(RS.InsertAudioTooltips,i.toString(),()=>{const s=DomBuilderEx.offline_(e,"div",smap_(["class",CSS.xWidgetAudio],[ATTR.xPlaceholder,Placeholder.xpAudioinfo])).push_();WidgetUt._createAudio(s,i.toString(),n),WidgetUt._captionWithAudioInfo(s),t.collapse();const o=s.pop_().cursor_();RangeUtil.replaceRange_(t,o),mainPanel$.processPlaceholders_([o],()=>{native$.iSetCaretAtEnd_(o,!0)})})}static _actionInsertVideo(){var t;const e=_MainPanel._requireNonBodySelection(),i=null==e?null:RangeUtil.rangeOwnerDocument_(e),n=native$.getIFrameUri_();if(null==e||null==i||null==n)return;const s="/Home/drafts/video-"+An.simpleDateTimeString_()+MimeUtil.videoRecordExts()[0];null===(t=this.promptEditMedia_("VIDEO",s,"",n,(t,n)=>{this._createVideoElement(e,i,t,n)}))||void 0===t||t.show_()}static _createVideoElement(t,e,i,n){history$.group_(RS.InsertVideoTooltips,i.toString(),()=>{const s=DomBuilderEx.offline_(e,"div",smap_(["class",CSS.xWidgetVideo],[ATTR.xPlaceholder,Placeholder.xpVideoinfo])).push_();WidgetUt._createVideo(s,i.toString(),n),WidgetUt._captionWithVideoInfo(s),t.collapse();const o=s.pop_().cursor_();RangeUtil.replaceRange_(t,o),mainPanel$.processPlaceholders_([o],()=>{native$.iSetCaretAtEnd_(o,!0)})})}static _actionListItem(t,e=null){const i=native$.getIFrameSelectionRange_();return null==i?(toasters$.warnKey_(RS.ActionRequireAValidSelection),!1):(native$.focusIFrame_(),history$.group_(RS.action_ListItem,t,()=>{const n=RangeUtil.wrapRange_("li",null,i);let s=null,o=null;for(let t=n.parentElement;null!=t;t=t.parentElement){const e=t.nodeName;if("UL"==e||"OL"==e){o=t;break}"LI"==e&&(s=t)}null==o?JsUtil.wrapNode_(n,t,e):null==s?new DomBuilderEx(o).appendNodes_(n):new DomBuilderEx(o).insertBefore_(s.nextSibling,n),_MainPanel._actionListPlaceholder(n)}),!0)}static _actionListCompact(t){let e=native$.getNearestSelectedElement_();for(;null!=e;){const i=e.nodeName;if("UL"==i||"OL"==i){const i=e.classList;return t?i.add(CSS.xCompact):i.remove(CSS.xCompact),!0}if("BODY"==i)break;e=e.parentElement}return toasters$.warnKey_(RS.ListElementNotFound),!1}static _actionListPlaceholder(t){const e=_MainPanel._shouldCreatePlaceholder(t);if(null!=e){const i=DomBuilderEx.createText_(e);new DomBuilderEx(t).appendNodes_(i),native$.iSelectNode_(i)}else native$.iSetCaretAtEnd_(t.lastChild,!0);return t}static _shouldCreatePlaceholder(t){var e;const i=JsUtil.childNodes_(t),n=MSG.XXX$;if(0==i.length)return n;const s=[];for(const t of i){if(t.nodeType!=Node.TEXT_NODE)return null;s.push(null!==(e=t.nodeValue)&&void 0!==e?e:"")}return 0==s.join().trim().length?n:null}static _actionListItemSymbol(){const t=native$.getIFrameSelectionRange_(),e=_MainPanel._findEnclosingList(t);if(null==e||null==t)return void toasters$.warnKey_(RS.InvalidSelection);const i=e[0],n=e[1];_SymbolPreferences.get_(e=>{const s=new PromptSymbol(accessories$,e);s.titleKey_(RS.PickSymbol),s.zindex_(DEF.zindexPrompt),s.onOK_((e,s,o)=>{native$.focusIFrame_(),history$.group_(RS.action_ListSymbol,null!=s?s:"",()=>{let s;const l=RangeUtil.wrapRange_("span",{class:CSS.xListContent},t);null!=i?(s=new DomBuilderEx(i),null==n?s.childBefore_(i.firstChild,"li",{class:CSS.xList}):s.childBefore_(n.nextSibling,"li",{class:CSS.xList})):(s=new DomBuilderEx(l.parentElement)).childBefore_(l,"ul",{class:CSS.xNone}).li1_(CSS.xList),s.push_().span1_(CSS.xBullet).addStyles_(o).text_(e+" "),s.pop_().child_(l),_MainPanel._actionListPlaceholder(l)})}),s.onCancel_(()=>native$.focusIFrame_()),s.show_()})}static _actionListSymbols(){const t=native$.getIFrameSelectionRange_();null!=t?_SymbolPreferences.get_(e=>{const i=new PromptSymbol(accessories$,e);i.titleKey_(RS.PickSymbol),i.zindex_(DEF.zindexPrompt),i.onOK_((e,i,n)=>{native$.focusIFrame_(),history$.group_(RS.action_ListSymbol,null!=i?i:"",()=>{const i=RangeUtil.wrapRange_("span",{class:CSS.xListContent},t),s=new DomBuilderEx(i.parentElement);s.childBefore_(i,"ul",{class:CSS.xNone}).li1_(CSS.xList),JsUtil.remove_(i),s.push_().span1_(CSS.xBullet).addStyles_(n).text_(e+" "),s.pop_().child_(i),_MainPanel._actionListPlaceholder(i)})}),i.onCancel_(()=>native$.focusIFrame_()),i.show_()}):toasters$.warnKey_(RS.ActionRequireAValidSelection)}static _actionListItemText(){const t=native$.getIFrameSelectionRange_(),e=_MainPanel._findEnclosingList(t);if(null==e||null==t)return toasters$.warnKey_(RS.InvalidSelection),!1;const i=e[0],n=e[1],s=new PromptInput(accessories$,RS.TextBullet_Title,MSG.XXX$);return s.messageKey_(RS.TextBullet_Message),s.onOK_((e,s,o)=>{o(!0),native$.focusIFrame_(),history$.group_(RS.action_ListText,s,()=>{const e=RangeUtil.wrapRange_("span",{class:CSS.xListContent},t);let o;null!=i?(o=new DomBuilderEx(i),null!=n?o.childBefore_(n.nextSibling,"li",{class:CSS.xList}):o.childBefore_(null,"li",{class:CSS.xList})):(o=new DomBuilderEx(e.parentElement)).childBefore_(e,"ul",{class:CSS.xNone}).li1_(CSS.xList),JsUtil.remove_(e),s=replaceAll_(s," ",""),o.push_().span1_(CSS.xBulletText).text_(s+" "),o.pop_().child_(e),_MainPanel._actionListPlaceholder(e)})}),s.onCancel_(()=>native$.focusIFrame_()),s.show_(),!0}static _actionListDate(){const t=native$.getValidIFrameSelectionRange_();if(null==t)return toasters$.warnKey_(RS.InvalidSelection),!1;const e=An.now00_(),i=new PromptDate(accessories$,e,e,PromptDate.ALL,cache$.ui$.buttonSize_());return i.titleKey_(RS.PromptDateTimeTitle),i.zindex_(DEF.zindexPrompt),i.dateFormat_(settings$.shortDateFormat_()),i.timeFormat_(settings$.timeFormat_()),i.defaultFormat(PromptDate.DATE),i.onOK_((e,i,n,s,o)=>{native$.focusIFrame_(),history$.group_(RS.action_ListDatetime,s,()=>{const l=RangeUtil.wrapRange_("span",{class:CSS.xListContent},t),a=l.parentElement,r=new DomBuilderEx(a);r.childBefore_(l,"ul",{class:CSS.xNone}).li1_(CSS.xList),JsUtil.remove_(l),r.push_().span_(["class",`${CSS.xDate} ${CSS.xBulletDatetime}`],[ATTR.xFormat,An.datetimeXFormatValue_(i,n,e)]).text_(replaceAll_(s," ","")+""),null!=o&&o.length>0&&r.attr_(ATTR.xTooltips,o),r.pop_().child_(l),_MainPanel._actionListPlaceholder(l)})}),i.onCancel_(()=>native$.focusIFrame_()),i.showTab_(PromptDate.DATE),!0}static _actionListItemDate(){return _MainPanel._actionListItemDatetime(PromptDate.DATE)}static _actionListItemTime(){return _MainPanel._actionListItemDatetime(PromptDate.TIME)}static _actionListItemDatetime(t){const e=native$.getValidIFrameSelectionRange_();if(null==e)return toasters$.warnKey_(RS.InvalidSelection),!1;const[i,n]=_MainPanel._findEnclosingList(e),s=An.now00_(),o=new PromptDate(accessories$,s,s,PromptDate.ALL,cache$.ui$.buttonSize_());return o.titleKey_(RS.PromptDateTimeTitle),o.zindex_(DEF.zindexPrompt),o.dateFormat_(settings$.shortDateFormat_()),o.timeFormat_(settings$.timeFormat_()),o.defaultFormat(t),o.onOK_((t,s,o,l,a)=>{native$.focusIFrame_(),history$.group_(RS.action_ListDatetime,l,()=>{const r=RangeUtil.wrapRange_("span",{class:CSS.xListContent},e);let _;null!=i?(_=new DomBuilderEx(i),null!=n?_.childBefore_(n.nextSibling,"li",{class:CSS.xList}):_.childBefore_(null,"li",{class:CSS.xList})):(_=new DomBuilderEx(r.parentElement)).childBefore_(r,"ul",{class:CSS.xNone}).li1_(CSS.xList),JsUtil.remove_(r),_.push_().span_(["class",`${CSS.xDate} ${CSS.xBulletDatetime}`],[ATTR.xFormat,An.datetimeXFormatValue_(s,o,t)]).text_(replaceAll_(l," ","")+""),null!=a&&a.length>0&&_.attr_(ATTR.xTooltips,a),_.pop_().child_(r),_MainPanel._actionListPlaceholder(r)})}),o.onCancel_(()=>native$.focusIFrame_()),o.showTab_(t),!0}static _getStartElement(t){var e;if(null==t)return null;let i=null,n=t.startContainer;const s=t.startOffset;return n.nodeType==Node.ELEMENT_NODE&&(n=n.childNodes[s]),null!=n&&(i=null!==(e=DomUt.asHTMLElement_(n))&&void 0!==e?e:n.parentElement),i}static _findEnclosingList(t){let e=_MainPanel._getStartElement(t);if(null==e)return[null,null];let i=null,n=null;for(;null!=e;){const t=e.nodeName;if("LI"==t)i=e;else{if("UL"==t||"OL"==t){n=e;break}if("BODY"==t)break}e=e.parentElement}return[n,i]}_setbutton(t,e){const i=this._contextmenu._buttons.get(t);void 0!==i&&An.enableButton_(i,e)}updateContextmenuState_(){const t=native$.getIFrameSelectionRange_(),e=native$.getSingleSelectedNodeOfRange_(t),i=null==t?null:t.startContainer,n=null!=e?e.nodeName:null,s=null!=e&&null!=n&&An.isBodyElement_(n)||null!=i&&An.isHtmlElement_(i.nodeName),o=null!=e&&!s,l=o&&null!=e&&e.nodeType==Node.ELEMENT_NODE,a=null!=t&&t.collapsed,r=null!=t&&!t.collapsed,_=a&&null!=i&&!An.isHtmlElement_(i.nodeName);let c=null;_&&null!=i&&(c=JsUtil.getSplitParent_(i));const h=null!=i&&An.isBodyElement_(i.nodeName);this._setbutton(MainContextActions._COPY,r&&!s||null!=c),this._setbutton(MainContextActions._CUT,r&&!s||null!=c);const u=null!=t&&!s&&!clipboard$.isEmpty_();this._setbutton(MainContextActions._PASTE_CHILD,u),this._setbutton(MainContextActions._PASTE_SIBLING,u);const d=!history$.isUndoEmpty_(),S=!history$.isRedoEmpty_();this._setbutton(MainContextActions._UNDO,d),this._setbutton(MainContextActions._UNDO_HISTORY,d),this._setbutton(MainContextActions._REDO,S),this._setbutton(MainContextActions._PARENT_NODE,null!=t&&!s),_MainPanel._actionSelectNextSiblingOK(t,t=>{this._setbutton(MainContextActions._SELECT_NEXT_SIBLING,null==t)}),this._setbutton(MainContextActions._WRAP,null==JsUtil.actionWrapOK_(t)),this._setbutton(MainContextActions._INSERT_ELEMENT,null!=e||_),this._setbutton(MainContextActions._PARAGRAPH,o||_),this._setbutton(MainContextActions._INSERT_TEXT,o||_&&!h),this._setbutton(MainContextActions._UNWRAP,l&&null!=e&&null!=e.firstChild),this._setbutton(MainContextActions._SPAWN_NODE,null!=c||l),this._setbutton(MainContextActions._EDIT_STYLE,_||l),this._setbutton(MainContextActions._EDIT_STYLE_RAW,_||l),this._setbutton(MainContextActions._EDIT_NODE,_||o),this._setbutton(MainContextActions._EDIT_NODE_RAW,_||o),this._setbutton(MainContextActions._EDIT_ALIGN,l),this._setbutton(MainContextActions._BORDER,l),this._setbutton(MainContextActions._EDIT_SIZE,l),this._setbutton(MainContextActions._MOVETO_PARENT,o&&!h),this._setbutton(MainContextActions._MOVETO_PREV,null!=c&&_MainPanel._hasNonEmptySibling(c)||o&&null!=e&&_MainPanel._hasNonEmptySibling(e)),this._setbutton(MainContextActions._MOVETO_NEXT,null!=c&&_MainPanel._hasNonEmptySibling(c)||o&&null!=e&&_MainPanel._hasNonEmptySibling(e));const p=null!=t&&!s;this._setbutton(MainContextActions._INSERT_IMG,p),this._setbutton(MainContextActions._INSERT_AUDIO,p),this._setbutton(MainContextActions._INSERT_VIDEO,p),this._setbutton(MainContextActions._INSERT_CANVAS,p),this._setbutton(MainContextActions._INSERT_SYMBOL,p),this._setbutton(MainContextActions._INSERT_DATE,p),this._setbutton(MainContextActions._INSERT_CALENDAR,p),this._setbutton(MainContextActions._INSERT_ALARM,p),this._setbutton(MainContextActions._LIST_SYMBOLS,p),this._setbutton(MainContextActions._LIST_ITEM_SYMBOL,p),this._setbutton(MainContextActions._LIST_DATE,p),this._setbutton(MainContextActions._LIST_ITEM_DATE,p),this._setbutton(MainContextActions._INSERT_WIDGET,p),this._setbutton(MainContextActions._DESTRUCT_WIDGET,l),this._setbutton(MainContextActions._INSERT_LINK,null==_MainPanel._actionCreateLinkOK(t)),this._setbutton(MainContextActions._TAKE_PHOTO,!1),this._setbutton(MainContextActions._RECORD_VIDEO,!1),this._setbutton(MainContextActions._RECORD_AUDIO,!1),"IMG"==n||"CANVAS"==n?(this._setbutton(MainContextActions._ANNOTATE_IMG,!0),An.show_(this._contextmenu._buttons.get(MainContextActions._ANNOTATE_IMG)),An.hide_(this._contextmenu._buttons.get(MainContextActions._INSERT_CANVAS))):(An.show_(this._contextmenu._buttons.get(MainContextActions._INSERT_CANVAS)),An.hide_(this._contextmenu._buttons.get(MainContextActions._ANNOTATE_IMG)));const m=this._contextmenu._menubarButtons;let g=null;for(const t of m.keys())if(m.get(t).classList.contains(CSS.AnSelected)){g=t;break}if(null==t){null!=g&&this._contextmenu.hideSubmenu_(g);for(const t of m.values())An.enableButton_(t,!1);return}const f=MainContextActions._SUBMENU_FONT,C=MainContextActions._SUBMENU_CHAR,T=MainContextActions._SUBMENU_PARA,A=MainContextActions._SUBMENU_LIST,b=MainContextActions._SUBMENU_MEDIA,x=MainContextActions._SUBMENU_OTHERS;if(An.enableButton_(m.get(f),r&&!s),An.enableButton_(m.get(C),r&&!s),An.enableButton_(m.get(T),l),An.enableButton_(m.get(A),!s),An.enableButton_(m.get(b),!s),An.enableButton_(m.get(x),!0),s)return null!=g&&g!=x&&(this._contextmenu.hideSubmenu_(g),g=null),void(null==g&&(this._contextmenu.showSubmenu_(x),g=x));if(null==t||a)null!=g&&g!=C&&g!=f&&g!=T||(null!=g&&this._contextmenu.hideSubmenu_(g),this._contextmenu.showSubmenu_(A));else{if(null!=g)return g!=T||l?void(g==f&&this._contextmenu.updateFontSubmenuState(t)):(this._contextmenu.hideSubmenu_(g),this._contextmenu.showSubmenu_(C),void(g=C));this._contextmenu.showSubmenu_(l?T:C)}}static _nonEmptySibling(t,e){let i=e(t);for(;null!=i;i=e(i))if(!JsUtil.isEmptyTextNode_(i))return i;return null}static _hasNonEmptySibling(t){const e=t.parentNode;if(null!=e)for(let i=e.firstChild;null!=i;i=i.nextSibling)if(i!=t&&!JsUtil.isEmptyTextNode_(i))return!0;return!1}static _revealHierarchy(t){var e;const i=new Array;for(let e=t.parentElement;null!=e&&"BODY"!=e.nodeName;e=e.parentElement)i.unshift(e);const n=Array.from(native$.iQueryAll_(`#${ID.xRightSidepanel}, #${ID.xLeftSidepanel}`));for(const t of n)i.includes(t)||native$.setDisplay_(t,"none");const s=Array.from(native$.iQueryAll_(`div.${CSS.xAnnotation} > div.${CSS.xSmokescreen}`));for(const t of s)i.includes(t)||_MainPanel._hideAnnotation1(t);for(const t of i){const i=t.getAttribute("id");if(null==t||ID.xRightSidepanel!=i&&ID.xLeftSidepanel!=i){if(t.classList.contains(CSS.xAnnotationContent)){const i=null===(e=t.parentElement)||void 0===e?void 0:e.parentElement;if(null!=i&&native$.hasClass_(i,CSS.xAnnotation)&&_MainPanel._showAnnotation1(i))break}}else native$.setDisplay_(t,"block")}}static _isTesting(){return!1}static _paraStyle1(t,e){const i=native$.getIFrameSelectionRange_();if(null==i)return void toasters$.warnKey_(RS.InvalidSelection);const n=RS.action_ParaStyle,s=native$.getSingleSelectedNodeOfRange_(i);if(null!=s){const i=s.nodeName;if("DIV"==i||"P"==i||s.nodeType==Node.ELEMENT_NODE&&void 0!==settings$.builtinParaStylesByName_().get(e))return _MainPanel._toggleStyle1(n,t,e,s),native$.iSelectNode_(s),void native$.focusIFrame_()}history$.group_(n,e,()=>{const n=RangeUtil.wrapRange_("div",null,i);if(null!=n){_MainPanel._toggleStyle(t,e,n),i.collapsed?_MainPanel._placeholderXXX(new DomBuilderEx(n),null):native$.iSelectNode_(n),native$.focusIFrame_()}})}static _toggleStyle1(t,e,i,n){history$.group_(t,i,()=>{_MainPanel._toggleStyle(e,i,n)})}static _toggleStyle(t,e,i){if(null==e)return;if(0==e.length||e==CSS.xNone)return void _MainPanel._removeAllStyles(i,t);const n=t.get(e),s=void 0===n?null:n.group_();if(null==s||0==s.length||i.classList.contains(e))return void i.classList.toggle(e);const o=sarray_(),l=[e];_MainPanel._removeStylesInGroup(o,s,t),native$.removeAddClasses_(i,o,l)}static _removeAllStyles(t,e){const i=[];_MainPanel._removeStyles(i,e),native$.removeAddClasses_(t,i,null)}static _removeStyles(t,e){for(const i of e.values()){const e=i.name_();e.length>0&&t.push(e)}}static _removeStylesInGroup(t,e,i){for(const n of i.values())if(n.group_()==e){const e=n.name_();e.length>0&&t.push(e)}}static _charStyle1(t,e){const i=native$.getIFrameSelectionRange_();if(null==i)return void toasters$.warnKey_(RS.InvalidSelection);const n=RS.action_CharStyle,s=native$.getSingleSelectedNodeOfRange_(i);if(null!=s&&s.nodeType==Node.ELEMENT_NODE)return _MainPanel._toggleStyle1(n,t,e,s),void native$.iSelectNode_(s);history$.group_(n,e,()=>{const n=RangeUtil.wrapRange_("span",null,i);null!=n&&(_MainPanel._toggleStyle(t,e,n),native$.iSelectNode_(n))})}static _widgetContextAction(t){_state.isEditing()?_WidgetTemplates.create(t):toasters$.warnKey_(RS.NotEditing)}static _actionBorder(){const t=native$.getSingleSelectedNode_();null!=t&&t.nodeType==Node.ELEMENT_NODE?_MainPanel._actionBorder1(t,null):toasters$.warnKey_(RS.ActionRequireASingleElementSelection)}static _actionBorder1(t,e){var i,n,s,o,l,a,r,_;const c=["border-top","border-right","border-bottom","border-left","border-top-width","border-top-style","border-right-width","border-right-style","border-bottom-width","border-bottom-style","border-left-width","border-left-style","border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","box-shadow"],h=_JsUtil.nodeStyles_(t,c),u=native$.getComputedStyle_(t,null,c);for(const t of["border-top","border-right","border-bottom","border-left"]){const e=h.get(t),a=null!==(i=h.get(t+"-width"))&&void 0!==i?i:null,r=null!==(n=h.get(t+"-style"))&&void 0!==n?n:null;if(void 0===e||0==e.length||!DialogUt.hasBorder_(a,r)){const e=null!==(s=u.get(t+"-width"))&&void 0!==s?s:null,i=null!==(o=u.get(t+"-style"))&&void 0!==o?o:null;h.set(t,DialogUt.hasBorder_(e,i)&&null!==(l=u.get(t))&&void 0!==l?l:"")}}for(const t of["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"]){let e=DialogUt.getCorner_(null!==(a=h.get(t))&&void 0!==a?a:"",null);null==e&&(e=DialogUt.getCorner_(null!==(r=u.get(t))&&void 0!==r?r:"","")),h.set(t,e)}if(An.isempty_(h.get("box-shadow"))){const t=null!==(_=u.get("box-shadow"))&&void 0!==_?_:"";h.set("box-shadow",t)}history$.startGroup_(RS.action_AddBorder,"");const d=new PromptBorders(accessories$,cache$.ui$.buttonSize_(),h,t);d.titleKey_(RS.Borders),d.zindex_(DEF.zindexPrompt),d.onOK_((i,n,s)=>{var o,l,a,r,_,h,u,d,S,p,m,g,f,C,T,A,b,x;s(!0),native$.setStyles_(t,map_(["border",null],["border-radius",null],["box-shadow",null]));const y=native$.getComputedStyle_(t,null,c),R=new Map;DialogUt.normalizeBorder_(R,null!==(o=y.get("border-top"))&&void 0!==o?o:"",null!==(l=y.get("border-right"))&&void 0!==l?l:"",null!==(a=y.get("border-bottom"))&&void 0!==a?a:"",null!==(r=y.get("border-left"))&&void 0!==r?r:"",null!==(_=y.get("border-top-width"))&&void 0!==_?_:"",null!==(h=y.get("border-top-style"))&&void 0!==h?h:"",null!==(u=y.get("border-right-width"))&&void 0!==u?u:"",null!==(d=y.get("border-right-style"))&&void 0!==d?d:"",null!==(S=y.get("border-bottom-width"))&&void 0!==S?S:"",null!==(p=y.get("border-bottom-style"))&&void 0!==p?p:"",null!==(m=y.get("border-left-width"))&&void 0!==m?m:"",null!==(g=y.get("border-left-style"))&&void 0!==g?g:"");const v=null!==(f=n.get("border"))&&void 0!==f?f:null;if(null!=v)v==R.get("border")&&n.delete("border");else{const t=null!==(C=R.get("border"))&&void 0!==C?C:null;for(const[e,i]of n.entries())i==(null!=t?t:R.get(e))&&n.delete(e)}const E=DialogUt.normalizeBorderRadius_(null!==(T=y.get("border-top-left-radius"))&&void 0!==T?T:"",null!==(A=y.get("border-top-right-radius"))&&void 0!==A?A:"",null!==(b=y.get("border-bottom-right-radius"))&&void 0!==b?b:"",null!==(x=y.get("border-bottom-left-radius"))&&void 0!==x?x:"");n.get("border-radius")==E&&n.delete("border-radius"),n.get("box-shadow")==y.get("box-shadow")&&n.delete("box-shadow"),n.size>0&&native$.setStyles_(t,n),null!=e&&e(t),history$.endGroup_()}),d.onCancel_(()=>{history$.endGroup_()}),d.show_()}static _placeholder(t,e){const i=t.cursor_(),n=i.nodeName;if(Html5.isEmptyTag(n))native$.iSetCaretAtEnd_(i,!0);else{const i=t.push_().childBefore_(e,"br").cursor_();native$.iSetCaretAtEnd_(i,!0),t.pop_()}return t}static _placeholderXXX(t,e){const i=DomBuilderEx.createText_(MSG.XXX$);return t.insertBefore_(e,i),native$.iSelectNode_(i),t}static _actionInsertDate(){const t=native$.getIFrameSelectionRange_();if(null==t)return;const e=native$.getSingleSelectedNodeOfRange_(t);_MainPanel._actionInsertDate1(t,e)}static _actionInsertDate1(t,e){const i=native$.getIFrameDocument_();if(null==i)return;const n=DomUt.asHTMLElement_(e),s=null!=n&&native$.hasClass_(n,CSS.xDate),o=An.now00_(),l=PromptDate.ALL;let a=PromptDate.DATE,r=PromptDate.DATE,_=settings$.shortDateFormat_(),c=settings$.timeFormat_(),h=null;if(s&&null!=n){const t=An.splitDatetimeXFormat_(n.getAttribute(ATTR.xFormat));if(t.length>=2&&(_=DateFormat.validate(t[0],_),c=TimeFormat.validate(t[1],c),0==_.length&&c.length>0?(a=PromptDate.TIME,r=PromptDate.TIME):_.length>0&&c.length>0&&(r=PromptDate.DATE|PromptDate.TIME)),t.length>=3){const e=An.parseInt_(t[2],null);null!=e&&(h=An.now01_(DateTime.fromMillisecondsSinceEpoch_(e)))}0==_.length&&(_=settings$.shortDateFormat_()),0==c.length&&(c=settings$.timeFormat_())}null==h&&(h=o),new PromptDate(accessories$,o,h,l,cache$.ui$.buttonSize_()).titleKey_(RS.PromptDateTimeTitle).zindex_(DEF.zindexPrompt).dateFormat_(_).timeFormat_(c).defaultFormat(r).onOK_((o,l,a,r,_)=>{native$.focusIFrame_(),null!=n&&n.classList.contains(CSS.xBulletDatetime)&&(r=replaceAll_(r," ","")),history$.group_(RS.action_InsertDate,r,()=>{const c=smapOf_(ATTR.xFormat,An.datetimeXFormatValue_(l,a,o));if(An.isempty_(_)||(c[ATTR.xTooltips]=_),s&&null!=n){const t=n.textContent;if(null!=t){const e=new RegExp("^.*?(\\s*)$").exec(t);null!=e&&(r+=e[1])}n.textContent=r,new DomBuilderEx(n).attrs_(c)}else{c.class=CSS.xDate;const n=DomBuilderEx.offline_(i,"span",c).text_(r).cursor_();null!=e?new DomBuilderEx(e.parentElement).replaceChild_(e,n):RangeUtil.replaceRange_(t,n),e=DomBuilderEx.createText_(""),new DomBuilderEx(n).up_().insertBefore_(n.nextSibling,e)}native$.iSetCaretAtEnd_(e,!0)})}).onCancel_(()=>{native$.focusIFrame_(),native$.iSetCaretAtEnd_(e,!0)}).showTab_(a)}static _actionList(t,e=null){const i=native$.getIFrameSelectionRange_();return null==i?(toasters$.warnKey_(RS.ActionRequireAValidSelection),!1):(history$.group_(RS.action_List,t,()=>{native$.focusIFrame_();const n=RangeUtil.wrapRange_("li",null,i);null!=t&&JsUtil.wrapNode_(n,t,e),_MainPanel._actionListPlaceholder(n)}),!0)}static _actionToNbsp(){const t=native$.getIFrameSelectionRange_();null!=t?t.collapsed?history$.group_(RS.action_ToNbsp,"",()=>{const e=RangeUtil.insertText_(t,"");native$.iSelectNode_(e)}):history$.group_(RS.action_ToNbsp,"",()=>{const e=RangeUtil.extractContents_(t);JsUtil.transverse_(e,t=>{if(t.nodeType==Node.TEXT_NODE){const e=JsUtil.nodeValue_(t);null!=e&&(t.nodeValue=replaceAll_(e," ",""))}return t.nextSibling}),RangeUtil.insertNode_(t,e),native$.iSelectRange_(t)}):toasters$.warnKey_(RS.ActionRequireAValidSelection)}static _actionToSpace(){const t=native$.getIFrameSelectionRange_();null!=t?t.collapsed?history$.group_(RS.action_ToSpace,"",()=>{const e=RangeUtil.insertText_(t," ");native$.iSelectNode_(e)}):history$.group_(RS.action_ToSpace,"",()=>{const e=RangeUtil.extractContents_(t);JsUtil.transverse_(e,t=>{if(t.nodeType==Node.TEXT_NODE){const e=JsUtil.nodeValue_(t);null!=e&&(t.nodeValue=replaceAll_(e,""," "))}return t.nextSibling}),RangeUtil.insertNode_(t,e),native$.iSelectRange_(t)}):toasters$.warnKey_(RS.ActionRequireAValidSelection)}static _actionInsertCalendar(){const t=native$.getIFrameDocument_();if(null==t)return;const e=native$.getIFrameSelectionRange_();if(null==e)return void toasters$.warn_(MSG.string_(RS.ActionRequireAValidSelection));const i=new PromptCalendar(accessories$,cache$.ui$.buttonSize_());i.titleKey_(RS.InsertCalendarTitle),i.zindex_(DEF.zindexPrompt),i.dateFormat_(settings$.monthFormat_()),i.onOK_((i,n,s,o)=>{native$.focusIFrame_(),null==o&&(o=settings$.monthString_(i)),history$.group_(RS.action_InsertCalendar,o,()=>{const l=_MainPanel._createCalendar(t,i,"#444",n,s,o);RangeUtil.replaceRange_(e,l)})}),i.onCancel_(()=>native$.focusIFrame_()),i.show_()}static _createCalendar(t,e,i,n,s,o){const l=_MainPanel._createCalendarBody(t,e,n,s),a=smap_(["class",CSS.xCalendar],[ATTR.xTooltips,An.simpleDateString_(e)]),r=smap_();return null!=i&&(r.style=`color:${i};`),DomBuilderEx.offline_(t,"div",a).push_().div_({class:CSS.xCalHead}).span_(r).text_(o).peek_().child_(l).pop_().cursor_()}static _createCalendarBody(t,e,i,n){let s=e.subtract_(DateTime.DAY*(e.day$-1));s=7==s.weekday$?s:s.subtract_(DateTime.DAY*s.weekday$);const o=e.month$,l=DateTime.DAY,a=An.ifempty_(i,"",`width:${i};`)+An.ifempty_(n,"",`height:${n};`),r=DomBuilderEx.offline_(t,"div",{class:CSS.xCalBody,style:a}).push_();for(let t=0;t<6;++t)for(let t=0;t<7;++t){let t=sarray_();const e=s.weekday$;s.month$==o?6!=e&&7!=e||t.push(CSS.xDateHoliday):t.push(CSS.xGray),r.peek_().div_().addClasses_(t).text_(`${s.day$}`).cursor_(),s=s.add_(l)}return r.peek_().cursor_()}static _actionEditSymbol(t){native$.hasAnyClass_(t,[CSS.xxSymbol,CSS.xxBullet])?toasters$.warnKey_(RS.CannotReplaceReservedSymbol):_SymbolPreferences.get_(e=>{const i=new PromptSymbol(accessories$,e);i.titleKey_(RS.ReplaceSymbolTitle),i.zindex_(DEF.zindexPrompt),i.onOK_((e,i,n)=>{native$.focusIFrame_(),history$.group_(RS.action_InsertSymbol,null!=i?i:"",()=>{_MainPanel._actionEditSymbol1(t,e,i,n)})}),i.onCancel_(()=>{native$.focusIFrame_(),native$.iSetCaretAtEnd_(t,!0)}),i.show_()})}static _actionEditSymbol1(t,e,i,n){const s=n["font-family"];t.style.fontFamily=null!=s?s:"",t.textContent=e,native$.iSetCaretAtEnd_(t,!0),toasters$.info_(MSG.string_(RS.ReplacedSymbol_)+(null!=i?i:""),{attop:!1})}static _actionInsertSymbol(){const t=_MainPanel._requireNonBodySelection();null!=t&&_SymbolPreferences.get_(e=>{const i=new PromptSymbol(accessories$,e);i.titleKey_(RS.InsertSymbolTitle),i.zindex_(DEF.zindexPrompt),i.onOK_((e,i,n)=>{native$.focusIFrame_(),history$.group_(RS.action_InsertSymbol,null!=i?i:"",()=>{_MainPanel._actionInsertSymbol1(t,e,n)})}),i.onCancel_(()=>{native$.focusIFrame_()}),i.show_()})}static _actionInsertSymbol1(t,e,i){const n=i["font-family"],s=DomBuilderEx.offline_(RangeUtil.rangeOwnerDocument_(t),"span",{class:CSS.xSymbol,style:`font-family: ${n};`}),o=s.text_(e).cursor_();RangeUtil.replaceRange_(t,o);const l=s.textSiblingAfter_(" ");native$.iSetCaretAtEnd_(l,!0)}static _actionInsertAlarm(){const t=native$.getIFrameDocument_();if(null==t)return;const e=_MainPanel._requireNonBodySelection();null!=e&&_ClientActionPostAlarm.post_(e,i=>{if(i)return;const n=e.commonAncestorContainer;let s="";if(n.nodeType==Node.TEXT_NODE){const t=e.startOffset,i=e.endOffset;s=n.nodeValue.substring(t,i)}else e.collapsed||(s=JsUtil.textContent_(RangeUtil.cloneContents_(e)));const o=An.now00_(),l=_AlarmUtil.createId_(),a=native$.getIFrameUri_(),r=null==a?"":`${a.encodedPath$}#${l}`,_=_EventsPanelBase._promptNewEvent(EventInfo.create_(l,o.millisecondsSinceEpoch$,mainPanel$.isLoggedIn(),s,"",r),i=>{native$.focusIFrame_(),host$.postEvent_(i,n=>{toasters$.warn_(n);const s=_MainPanel._createAlarm(t,l,i);RangeUtil.insertNode_(e,s),host$.getPendingAlarmCount_(t=>{if(toasters$.warn_(t))return;const e=t[Key.result];toasters$.info_(`${MSG.string_(RS.AlarmsPending_)}${e}`,{attop:!1}),sidePanel$.showEventsPanel_(t=>null==t?void 0:t.selectAndReveal_(l))})})});_.onCancel_(()=>native$.focusIFrame_()),_.show_()})}static _createAlarm(t,e,i){const n=new EventInfo(i),s=MSG.XXX$,o=DateTime.fromMillisecondsSinceEpoch_(n.ms$),l=n.desc$,a=_TodoWidget.createTodo_(t,"",t=>{t.code_(["class",`${CSS.xDate}`],[ATTR.xFormat,`${settings$.shortDateFormat_()};;${o.millisecondsSinceEpoch$}`],[ATTR.xRole,EventKey.Ms]).text_(settings$.shortDateString_(o))},t=>{t.span_(["class",CSS.xWidgetTodoSubject],[ATTR.xRole,EventKey.Description]).text_(l)},t=>{t.indent_(t.push_().li1_(CSS.xList).indent_(t.push_().span_(["class",`${CSS.xBulletFa} fa-bell-o`]),t.pop_().span_(["class",CSS.xListContent],[ATTR.xRole,EventKey.Repeat]).text_(n.repeat$)),t.pop_().li1_(CSS.xList).indent_(t.push_().span_(["class",CSS.xBullet],["style","font-family: FontAwesome"]).text_(" "),t.pop_().span1_(CSS.xListContent,CSS.xPlaceholder).text_(s)))});return new DomBuilderEx(a).attrs_(smap_(["name",e],[ATTR.xInfo,JSON.stringify(n.filterx_())])),a}static _isSymbol(t){return null!=t&&t.nodeType==Node.ELEMENT_NODE&&native$.hasAnyClass_(t,[CSS.xSymbol,CSS.xBullet])}_actionShowAudioPlayer(){host$.getAudioStatus_(t=>{var e,i,n;const s=null!==(e=t[Key.player])&&void 0!==e?e:{},o=null!==(i=s[Key.status])&&void 0!==i&&i,l=s[Key.path];if(!o||null==l)return void toasters$.warn_(RS.AudioPlaybackNotInProgress);const a=null!==(n=s[Key.isplaying])&&void 0!==n&&n;_AudioPlayerDialog.createAndShow_(accessories$,l,void 0,a)})}static _createAudioInfo(t,e,i,n){const s=RangeUtil.rangeOwnerDocument_(t);if(An.isempty_(e))n.href="";else{const t=An.uriOfFilepath2_(i,e);n.href=t+"?view"}return n.class=`${CSS.xAudio} ${CSS.xxError}`,history$.group_(RS.action_InsertAudio,Basepath.nameWithSuffix_(e),()=>{const e=DomBuilderEx.offline_(s,"div",smap_(["class",CSS.xAudioinfo],[ATTR.xPlaceholder,Placeholder.xpAudioinfo])),i=e.cursor_(),o=e.push_().a_(n).cursor_();return e.peek_().div_().indent_(e.push_().div_().indent_(e.push_().div_().indent_(e.push_().span1_(CSS.xAudioDatetime).text_("??:??"),e.peek_().text_("  ").span1_(CSS.xAudioDuration).text_("??:??"),e.pop_().text_("  ").span1_(CSS.xAudioRate).text_("??")),e.pop_().div_().indent_(e.push_().span1_(CSS.xAudioFilename).text_("??"),e.pop_().append1_("span",CSS.xAudioFilesize))),e.pop_().div_().span_({class:CSS.xBullet}).text_("").up_().text_(MSG.string_(RS.Description))),RangeUtil.replaceRange_(t,e.pop_().cursor_()),[i,o]})}static _createVideoInfo(t,e,i,n){var s,o;const l=RangeUtil.rangeOwnerDocument_(t);n.href=An.isempty_(e)?"":null!==(o=null===(s=An.uriFromSafe_(null,e.split("/"),`?${Param.view}&${Param.poster}=${i}`))||void 0===s?void 0:s.toString())&&void 0!==o?o:"",n.class=`${CSS.xVideo} ${CSS.xVideoPoster} ${CSS.xxError}`;const a=DomBuilderEx.offline_(l,"div",smap_(["class",CSS.xVideoinfo],[ATTR.xPlaceholder,Placeholder.xpVideoinfo])),r=a.cursor_(),_=a.push_().a_(n).cursor_();return a.peek_().div_().indent_(a.push_().div_().indent_(a.push_().div_().indent_(a.push_().span1_(CSS.xVideoDatetime).text_("??:??"),a.peek_().text_("  ").span1_(CSS.xVideoDuration).text_("??:??"),a.pop_().text_("  ").span1_(CSS.xVideoResolution).text_("??")),a.pop_().div_().indent_(a.push_().span1_(CSS.xVideoFilename).text_("??"),a.pop_().append1_("span",CSS.xVideoFilesize))),a.pop_().div_().span_({class:CSS.xBullet}).text_("").up_().text_(MSG.string_(RS.Description))),history$.group_(RS.InsertVideoTooltips,Basepath.nameWithSuffix_(e),()=>{RangeUtil.replaceRange_(t,a.pop_().cursor_())}),[r,_]}photoResult(t){return null}videoRecordingResult(t){return null}_actionStopAudioRecording(){host$.stopAudioRecording_(t=>{toasters$.warn_(t)||this._mainToolbar.updateAudioStatus_()})}_actionAnnotateCanvas(t,e){const i=t.getAttribute(ATTR.xAnnotation);if(null!=i)try{const n=ScribblerHistory.fromJson_(JSON.parse(i)),s=n.getWidth_(),o=n.getHeight_(),l=native$.getBoundingClientRect_(t),a=t.style,r=a.width,_=a.height;let c=null,h=null;null!=r&&r.length>0&&"auto"!=r&&(c=Math.round(l.width)),null!=_&&_.length>0&&"auto"!=_&&(h=Math.round(l.height)),this.actionAnnotateCanvas1_(t,s,o,c,h,n.getBGColor_(),n.history_(),e)}catch(t){return toasters$.warnKey_(RS.ErrorDecodingAnnotation),void(null!=e&&e(!1))}else this._actionAnnotateCanvas0(t,e)}_actionAnnotateCanvasImage(t,e,i){const n=new PromptImageFilepath(accessories$,HumanFilepath.Empty$,e,RS.PlaceholderRequiredFilepath,Callbacks.onReadImageFolderButton_);n.titleKey_(RS.PickImage),n.zindex_(DEF.zindexPrompt),n.onOK_((e,n,s)=>{Sanitizers.checkRequiredImageFilepath_(n).onFail_(t=>{s(!1),e.warn_(t)}).onOK_(n=>{host$.localImageInfo_(n,o=>{if(e.warn_(o[Key.errors]))return void s(!1);s(!0);const l=MediaInfo.of_(o[Key.result]);null!=l&&Timer.sleep0_(()=>{this._actionAnnotateCanvasImage1(t,n,l,i)})})})}),n.onCancel_(()=>{i(!1)}),n.show_()}_actionAnnotateCanvasImage1(t,e,i,n){const s=i.width_(),o=i.height_(),l=window.innerWidth,a=2*ImageAnnotator.PADDING+2+4,r=An.multipleOf_(16,l-a),_=An.multipleOf_(16,window.innerHeight-cache$.ui$.toolbarHeight_()-a);let c=MediaUtil.fit_(s,o,r,_);c=MediaUtil.limitImageArea_(c.x,c.y);const h=MSG.string1_(RS.OriginalSize,`: ${s}x${o}`),u=_Util.promptCanvasDimension_(h,c.x,c.y,(i,s,o,l,a)=>{const r=[new ScribblerCmd(ScribblerAction.IMAGE,new ScribblerSetting({x_stroke:!1,x_fill:!1,x_rotation:0,x_data:e}),[0,0,i,s])];this.actionAnnotateCanvas1_(t,i,s,o,l,a,r,n)});u.onCancel_(()=>{null==n||n(!1)}),u.show_()}_actionAnnotateCanvas0(t,e){const i=window.innerWidth,n=2*ImageAnnotator.PADDING+2+4+6,s=An.multipleOf_(16,i-n),o=An.multipleOf_(16,window.innerHeight-cache$.ui$.toolbarHeight_()-n-20),l=MediaUtil.limitImageArea_(s,o);this.actionAnnotateCanvas1_(t,l.x,l.y,null,null,null,null,e)}actionAnnotateCanvas1_(t,e,i,n,s,o,l,a){gestureHandler$.pause_(),Timer.sleep0_(()=>{this._actionAnnotationCanvasX(t,e,i,n,s,o,l,t=>{gestureHandler$.resume_(),a(t)})})}_actionAnnotationCanvasX(t,e,i,n,s,o,l,a){if(MediaUtil.isInvalidDimension_(e,i))return toasters$.warnKey_(RS.InvalidDimensionAbort),void(null==a||a(!1));const r=new ScribblerHandler,_=new ImageAnnotator(accessories$,gestureHandler$,cache$.ui$.buttonSize_(),cache$.ui$.dpi_(),e,i,r);_.bgColor_(o),_.history_(l),_.zindex_(DEF.zindexImageAnnotator),_.titleKey_(RS.EditDrawingTitle),_.path_(native$.getIFrameContextPath_()),_.onPromptColor_(Callbacks.promptColor_),_.onEditText_(Callbacks.promptEditText_),_.onOK_((o,l,r)=>{history$.group_(RS.action_AnnotateCanvas,"",()=>{const _=o.width,c=o.height,h=JSON.stringify(l.toJson_(_,c));if(JsUtil.setAttribute_(t,ATTR.xAnnotation,h),null!=n||null!=s){const e=ssmap_();null!=n&&(e.width=`${n}px`),null!=s&&(e.height=`${s}px`),new DomBuilderEx(t).addStyles_(e)}const u=MediaUtil.optionalDimension0_(n,s,_,c);if(null==n&&null==s||u.x==_&&u.y==c){const e=_MainPanel._todataurl(l,o);_MainPanel._annotationCanvas2(t,e,a,r)}else{const n=native$.getIFrameUri_();null!=n&&_MainPanel._renderAnnotation2(n,e,i,u.x,u.y,l,e=>{_MainPanel._annotationCanvas2(t,e,a,r)})}})}),_.onCancel_(()=>{null==a||a(!1)}),_.show_()}static _annotationCanvas2(t,e,i,n){t.setAttribute("src",e),null==i||i(!0),n(!0)}_actionAnnotateImg(t,e,i){gestureHandler$.pause_(),_MainPanel._actionAnnotateImgX(t,e,t=>{gestureHandler$.resume_(),i(t)})}static _actionAnnotateImgX(t,e,i){const n=t.src,s=An.parseUriAndWarn_(n,e,toasters$),o=null==s?null:An.cdirOfUri_(s);if(null==o||null==s)return;const l=t.naturalWidth,a=t.naturalHeight,r=new ScribblerHandler,_=new ImageAnnotator(accessories$,gestureHandler$,cache$.ui$.buttonSize_(),cache$.ui$.dpi_(),l,a,r);_.zindex_(DEF.zindexImageAnnotator),_.bgImage_(e=>{native$.iDrawImage_(e,t)}),_.onPromptColor_(Callbacks.promptColor_),_.onEditText_(Callbacks.promptEditText_),_.path_(o),_.onOK_((t,n,l)=>{const a=An.cdirOfUri_(e),r=new PromptImageFilepath(accessories$,new HumanFilepath(o),a,RS.PlaceholderRequiredFilepath,Callbacks.onWriteImageFolderButton_);r.titleKey_(RS.SaveAs),r.messageKey_(RS.PromptCopyOverwrite1),r.zindex_(DEF.zindexPrompt),r.onOK_((e,n,o)=>{Sanitizers.checkRequiredImageFilepath_(n).onFail_(t=>{o(!1),e.warn_(t)}).onOK_(n=>{fileinfoUt$.checkFileWritable2_(n,t=>{e.warn_(t),o(!1)},e=>{e.exists$?DialogUt.confirmOverwriting_(n,e=>{e?_MainPanel._actionAnnotateImg2(s,n,t,t=>{o(null!=t),null!=t&&(l(!0),i(t))}):o(!1)}):_MainPanel._actionAnnotateImg2(s,n,t,t=>{o(null!=t),null!=t&&(l(!0),i(t))})})})}),r.onCancel_(()=>{l(!1),i(null)}),r.show_()}),_.onCancel_(()=>{i(null)}),_.show_()}static _actionAnnotateImg2(t,e,i,n){let s=100;const o=MimeUtil.imageMimeFromPath(e);switch(o){case MimeUtil.JPEG:s=DEF.jpegQuality;break;case MimeUtil.PNG:break;default:return toasters$.warn_(MSG.string1_(RS.UnsupportedOutputFormat_,null!=o?o:"")),void n(null)}const l=i.toDataURL(o,s/100);host$.saveBase64Image_(e,l,i=>{if(toasters$.warn_(i))return void n(null);const s=Uri.asMap_(t.queryParameters$);s.set("t",An.msString_()),s.set("view","");const o=An.uriFromSafe_(null,e.split("/"),s,t.hash$);n(o)})}static _rerenderCanvas(t,e,i,n,s,o){const l=t.getAttribute(ATTR.xAnnotation),a=t.style.width,r=t.style.height;if((o=o||l!=s||a!=i||r!=n)&&null!=l&&l.length>2){let i=null,n=null;if(!An.isempty_(a)||!An.isempty_(r)){const e=native$.getBoundingClientRect_(t);null!=e&&(i=Math.round(e.width),n=Math.round(e.height))}_MainPanel._renderAnnotation1(t,e,i,n,l)}}static _renderAnnotation1(t,e,i,n,s){try{const o=JSON.parse(s),l=ScribblerHistory.fromJson_(o),a=l.getWidth_(),r=l.getHeight_();null==i&&(i=a),null==n&&(n=r),_MainPanel._renderAnnotation2(e,a,r,i,n,l,e=>{t.setAttribute("src",e)})}catch(t){}}static _renderAnnotation2(t,e,i,n,s,o,l){const a=native$.getIFrameDocument_();if(null==a)return;const r=a.createElement("canvas");r.width=n,r.height=s;const _=r.getContext("2d");n==e&&s==i||_.scale(n/e,s/i),o.exec_(_,new ScribblerHandler,e=>{var i;if(null!=e&&e.length>0){const n=[MSG.string_(RS.ErrorLoading)];for(const s of e)if(s.startsWith("#"))n.push(s);else{const e=null!==(i=An.cpathOfHref2_(t,s))&&void 0!==i?i:MSG.string_(RS.MissingURIParameter);n.push(e)}toasters$.warn_(n)}l(_MainPanel._todataurl(o,r))})}static _todataurl(t,e){return t.getBGColor_().a$<=.99?e.toDataURL("image/png"):e.toDataURL("image/jpeg",DEF.jpegQuality)}_actionInsertCanvas(){Timer.sleep0_(()=>this._actionInsertCanvas1())}_actionInsertCanvas1(){const t=native$.getIFrameDocument_();if(null==t)return;const e=native$.getIFrameSelectionRange_();if(null==e)return;const i=DialogUt.defaultCanvasDimension_(cache$.ui$.toolbarHeight_()),n=MSG.format1_(RS.PromptCanvasMessage,`${DEF.maxOutputImageArea/1024/1024}M`);_Util.promptCanvasDimension_(n,i.x,i.y,(i,n,s,o,l)=>{const a=smap_(["class",CSS.xCanvas],[ATTR.xAnnotation,`{${ScribblerHistory.WIDTH}:${i},${ScribblerHistory.HEIGHT}:${n}`]),r=DomBuilderEx.offline_(t,"img",a).cursor_();this.actionAnnotateCanvas1_(r,i,n,s,o,l,null,t=>{t&&e.insertNode(r)})}).show_()}static createPhoto_(t,e,i){const n=RangeUtil.rangeOwnerDocument_(t);history$.group_(RS.TakePhotoTitle,An.filenameFromUri_(e),()=>{const s=DomBuilderEx.offline_(n,"a",{href:e.toString()}).append_("img",i).cursor_();RangeUtil.replaceRange_(t,s)})}}_MainPanel._VALID_INPUT_TYPE=new Set(["hidden","text","search","tel","url","email","password","datetime","date","month","week","time","number","range","color","checkbox","radio","image","reset","button"]),_MainPanel._bubbletags=new Set(["BR","B","EM","I","IMG","S","SPAN","SUB","SUP","U"]),_MainPanel._xcalcerror=[CSS.xCalcError];class _PlaceholderDateFormatter{constructor(t,e,i=DateTime.now_()){this.now=i,this.dateformat=settings$.dateFormat_(),this.timeformat=settings$.timeFormat_(),this.datestring=null;const n=An.splitDatetimeXFormat_(t.getAttribute(ATTR.xFormat));if(n.length>=2)return this.dateformat=DateFormat.validate(n[0],settings$.dateFormat_()),this.timeformat=TimeFormat.validate(n[1],settings$.timeFormat_()),void(this.datestring=An.datetimeString_(this.dateformat,this.timeformat,this.now));switch(e){case Placeholder.xpDatetime:this.datestring=settings$.datetimeString_(this.now);break;case Placeholder.xpShortDatetime:this.datestring=settings$.shortDatetimeString_(this.now),this.dateformat=settings$.shortDateFormat_();break;case Placeholder.xpDate:this.datestring=settings$.dateString_(this.now),this.timeformat="";break;case Placeholder.xpShortDate:this.datestring=settings$.shortDateString_(this.now),this.dateformat=settings$.shortDateFormat_(),this.timeformat="";break;case Placeholder.xpTime:case Placeholder.xpShortTime:this.datestring=settings$.timeString_(this.now),this.dateformat=""}}}class _TemplateContextmenu extends _ContextmenuBase{constructor(t,e,i){super(_TemplateContextmenu.createContextmenu(t)),this._create(t,e,i)}static createContextmenu(t){return DomBuilderEx.offline_(t.ownerDocument,"div",{class:CSS.AnContextmenu,style:"display: none; visibility: hidden;",name:NAME.contextmenuTemplate}).cursor_()}_create(t,e,i){if(An.isempty_(e)||null==i)return;const n=new DomBuilderEx(this._contextmenu).table_({class:`${CSS.AnContextmenu} ${CSS.AnTemplateMenu}`}).push_();for(const t of i)_TemplateContextmenu._createbuttons(n,e,t);t.append(this._contextmenu),super.setupHandlers_(this._contextmenu,`td.${CSS.AnContextButton}`)}static _createbuttons(t,e,i){const n=(t,e)=>{const i=this.symbolOf[ClientActionInfo.actionOf_(t)];if(null!=i)return`${CSS.AnContextButton} ${CSS.Fa} ${i}`;const n=An.famap_(e[TemplateMenuKey.classes]);return null!=n?`${CSS.AnContextButton} ${CSS.Fa} ${n}`:CSS.AnContextButton};t.peek_().tr_().push_();for(const s of i){const i=s[TemplateMenuKey.action];if(null==i||0==i.length||DEF.NOOP==i){ContextmenuBase.createnoop_(t);continue}const o=s[TemplateMenuKey.background],l=s[TemplateMenuKey.backgroundSize];let a=s[TemplateMenuKey.backgroundImage],r=n(i,s);const _=s[TemplateMenuKey.label],c=smap_(["class",r],[ATTR.AnAction,i]);let h="";if(null!=o){const t=ColorUtil.getColorValue_(o);null!=t&&(h+=`background-color:${t.toCSSString_()};`)}if(null!=a){a.startsWith("./")&&(a=`/assets/templates/${e}/${a}`);const t=Basepath.cleanFilepath_(a);null!=t&&PathUtil.isValidFilepath(t)&&null!=An.parseUriSafe_(t,null)&&(h+=`background-image:url("${t}");`)}"cover"!=l&&"contain"!=l||(h+=`background-size:${l};`),h.length>0&&(c.style=h),t.peek_().td_(c).text_(null==_?"":_).cursor_()}t.pop_()}hide_(){super.destroy_()}}_TemplateContextmenu.symbolOf={"widget,form,row,1":CSS.FaEllipsisH,"widget,form,col,1":CSS.FaEllipsisV,"widget,form,head,1":CSS.FaHeader,"widget,form,label,1":CSS.FaTumblr,"widget,form,input,1":CSS.FaPencil,"widget,form,input-with-borer,1":CSS.FaEdit,"widget,form,textarea,1":CSS.FaTerminal,"widget,form,textarea-with-border,1":CSS.FaStickyNoteO,"widget,form,checkbox,1":CSS.FaCheckSquareO,"widget,form,radio-group,1":CSS.FaListUl,"widget,form,radio-button,1":CSS.FaCircleO,"widget,form,save-button,1":CSS.FaSave,"widget,media-wall,section,1":CSS.FaBars,"widget,media-wall,text,1":CSS.FaTumblr,"widget,media-wall,image,1":CSS.FaFileImageO,"widget,media-wall,audio-file,1":CSS.FaFileAudioO,"widget,media-wall,video-file,1":CSS.FaFileVideoO,"widget,media-wall,photo,1":`${CSS.FaCamera} ${CSS.AnDisabled}`,"widget,media-wall,audio-recording,1":`${CSS.FaMicrophone} ${CSS.AnDisabled}`,"widget,media-wall,video-recording,1":`${CSS.FaVideoCamera} ${CSS.AnDisabled}`,"widget,media-sticker,section,1":CSS.FaBars,"widget,media-sticker,text,1":CSS.FaTumblr,"widget,media-sticker,image,1":CSS.FaFileImageO,"widget,media-sticker,audio-file,1":CSS.FaFileAudioO,"widget,media-sticker,video-file,1":CSS.FaFileVideoO,"widget,media-sticker,photo,1":`${CSS.FaCamera} ${CSS.AnDisabled}`,"widget,media-sticker,audio-recording,1":`${CSS.FaMicrophone} ${CSS.AnDisabled}`,"widget,media-sticker,video-recording,1":`${CSS.FaVideoCamera} ${CSS.AnDisabled}`};class _ViewerBase{constructor(t,e,i,n=0){this._viewer=t,this._content=e,this._image=i,this._zoom=n,this._rotation=0,this._overlay=new DomBuilderEx(i).siblingAfter_("div",smap_(["style","position:absolute;pointer-events:none;"])).cursor_()}zoom_(){return this._zoom}show_(){JsUtil.showVisible_(this._image,"block")}hide_(){}_resize(t,e,i){const n=cache$.ui$.iwinWidth_(),s=cache$.ui$.iwinHeight_();return this._resize1(t,e,n,s,i)}_resize1(t,e,i,n,s){if(null==this._viewer||null==this._image)return new Point(0,0);const o=t,l=e;let a=!1;switch(this._rotation){case 0:case 180:break;case 90:case 270:t=l,e=o,a=!0;break;default:throw Assert.notReach_(`${this._rotation}`)}const r=i-40,_=n-40-4,c=MediaUtil.zoomOf_(MediaUtil.fit_(t,e,r,_),t,e);0==this._zoom&&(this._zoom=c,s=null);const h=MediaUtil.zoomOf_(MediaUtil.limitImageArea_(this._zoom*t,this._zoom*e,IFramePinchZoomListener.MAX_AREA),t,e);this._zoom=An.clamp_(0,IFramePinchZoomListener.MAX_ZOOM,this._zoom),this._zoom>h&&(this._zoom=h);let u=Math.floor(this._zoom*t),d=Math.floor(this._zoom*e),S=20;const p=this._viewer.parentElement,m=p.scrollLeft,g=p.scrollTop;let f;const C=JsUtil.getBoundingClientRect_(this._image),T=null!=s?s.x:i/2-C.left,A=null!=s?s.y:Math.min(n/2-C.top,C.height/2),b=Math.floor(u*T/C.width),x=Math.floor(d*A/C.height),y=m+(b-T),R=g+(x-A);return f=new Point(b,x),S=Math.max(20,(i-u)/2),native$.setStyles_(this._viewer,map_(["width",`${u+2*S}px`],["height",`${d+40+20}px`])),this._resizeContent(a,S,20,u,d),p.scrollLeft=y,p.scrollTop=R,f}_resizeContent(t,e,i,n,s){const o=t?s:n,l=t?n:s;native$.setStyles_(this._image,map_(["width",`${o}px`],["height",`${l}px`],["top","0"],["left","0"],["clip",`rect(0, ${o}px, ${l}px, 0)`])),native$.setStyles_(this._overlay,map_(["width",`${o}px`],["height",`${l}px`]));const a=this._image.style;switch(this._rotation){case 0:a.transform="",a.transformOrigin="";break;case 90:a.transform=`translateX(${n}px) rotate(${this._rotation}deg)`,a.transformOrigin="0 0";break;case 180:a.transform=`rotate(${this._rotation}deg)`,a.transformOrigin="50% 50%";break;case 270:a.transform=`translateY(${s}px) rotate(${this._rotation}deg)`,a.transformOrigin="0 0";break;default:throw Assert.notReach_(`${this._rotation}`)}native$.setStyles_(this._content,map_(["position","absolute"],["left",`${e}px`],["top",`${i}px`],["width",`${o}px`],["height",`${l}px`],["box-shadow",DEF.themeBoxShadow]))}content_(){return this._image}onclick_(t){native$.iAddEventListener_(this._image,"click",e=>t(e),!1)}}class IFrameImageViewer extends _ViewerBase{constructor(t,e,i,n){super(t,e,i,n),this._limiter=new FrameLimiter(4),this._center=null,JsUtil.showHidden_(this._image,"block"),this.onresize_(null,null),i.ownerDocument.addEventListener("click",t=>{t.ctrlKey||t.shiftKey||(JsUtil.stopevent_(t),this._zoom=1==this._zoom?0:1,this.onresize_(Math.floor(t.pageX),Math.floor(t.pageY)))}),new IFramePinchZoomListener(i.ownerDocument,"touchstart"==Conf.touchstart,(t,e)=>{if(null!=t){const i=JsUtil.getBoundingClientRect_(this._image);return this._center=new Point(t.x-i.left,t.y-i.top),e}if(null!=this._center){let t=this._zoom;for(;e<=-DEF.zoomDelta;)t*=1-DEF.zoomScale,e+=DEF.zoomDelta;for(;e>=DEF.zoomDelta;)t*=1+DEF.zoomScale,e-=DEF.zoomDelta;(t=An.clamp_(0,IFramePinchZoomListener.MAX_ZOOM,t))!=this._zoom&&(this._zoom=t,this._limiter.queue_(()=>{this._center=this._onresize(this._center)}))}return e}),this.show_()}filter_(t,e,i){const n=this._overlay.style,s=n.getPropertyValue("backdrop-filter"),o=CSSUtil.updateFilter_(s,t,e,i);return n.setProperty("backdrop-filter",o),o}onPause_(){}onResume_(){}onresize_(t,e){this._onresize(null==t||null==e?null:new Point(t,e))}_onresize(t){const e=this._image.naturalWidth,i=this._image.naturalHeight;return 0==e&&0==i?new Point(0,0):this._resize(e,i,t)}rotate_(){this._rotation=(this._rotation+90)%360,toasters$.info_(`${MSG.string_(RS.Rotation)}: ${this._rotation}`,{attop:!1}),this.onresize_(null,null)}export_(){const t=native$.getIFrameContextPath_(),e=native$.getIFrameDir_();if(null==t||null==e)return void toasters$.warn_(MSG.string_(RS.InvalidPath));const i=Basepath.lcExt_(t);if(!MimeUtil.canWriteImageLcExt(i))return void toasters$.warn_(MSG.string1_(RS.UnsupportedFileType_,null!=i?i:""));const n=this._image.naturalWidth,s=this._image.naturalHeight;host$.localImageThumbnail_(t,DEF.previewPhotoSize,DEF.jpegQuality,i=>{if(toasters$.warn_(i))return;const o=i[Key.result];_Util.promptOutputImage1_(t,e,n,s,DEF.jpegQualityHigh,DEF.zindexPrompt,o,e=>{host$.writeImage_(t,e,t=>{toasters$.warn_(t)||(toasters$.okKey_(RS.ExportOK,{attop:!0}),_Util.browseFile_(e.cpath))})},t=>{t.show_()})})}}class FullscreenVideoPlayer extends Smokescreen{constructor(t,e){super(t,DEF.zindexMax,DEF.opacityOpaque),this._video=e,this._clone=null}show_(t=null){return super.show_(t=>{const e=null==t?void 0:t.element_();if(null==e)return;const i=this._video.getAttribute("src");null!=i&&(this._clone=new DomBuilderEx(e).addStyle_("display","flex").child_("video",{class:`${CSS.AnFullscreenVideoPlayer} ${CSS.xVideo}`,src:i,controls:"true",preload:"medadata"}).cursor_(),this._clone.currentTime=this._video.currentTime,Timer.sleep00_(()=>{var t;null===(t=this._clone)||void 0===t||t.play()}))}),null==t||t(this),this}currentTime_(){var t,e;return null!==(e=null===(t=this._clone)||void 0===t?void 0:t.currentTime)&&void 0!==e?e:0}hide_(){return this._clone=null,this.destroy_(),!0}}class _AudioPlayerDialog extends DialogBase{constructor(t,e,i,n){super(t),this.playerId=e,this._seek=i,this._autoplay=n,this._player=null,super.init_(this.create_(t)),this.titleText_(""),this.zindex_(DEF.zindexPrompt),this.smokescreenOpacity_(DEF.opacitySmoke),this.dialog_().classList.add(CSS.AnAudioPlayer),this._toolbar.button_(BUT.Stop).style.fontSize="0.8em",this._toolbar.element_().style.marginBottom="0"}static createAndShow_(t,e,i=null,n=!0,s){null!=_AudioPlayerDialog._singleton&&(_AudioPlayerDialog._singleton._stop(!0),_AudioPlayerDialog._singleton=null),host$.createAudioPlayer_(e,e=>{if(toasters$.warn_(e))return void(null==s||s(null));const o=MediaInfo.of_(e[Key.mediainfo]);if(null==o)return toasters$.warnKey_(RS.AudioPlaybackFailed),void(null==s||s(null));const l=e[Key.result];if(null==l)return toasters$.error_(MSG.string_(RS.AudioPlaybackFailed)),void(null==s||s(null));_AudioPlayerDialog._singleton=new _AudioPlayerDialog(t,l,i,n),_AudioPlayerDialog._singleton.onCancel_(()=>{_AudioPlayerDialog._singleton=null}),_AudioPlayerDialog._singleton.show_(),null==s||s([_AudioPlayerDialog._singleton,o])})}get player$(){return this._player}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),[BUT.info_(BUT.Stop),BUT.info_(BUT.Cancel)],t=>this._toolbarActions(t))}_createContent(t){this._toolbar.enableButton_(BUT.Cancel,!1),this._toolbar.enableButton_(BUT.Stop,!1),this._createContent1(t),this._toolbar.enableButton_(BUT.Cancel,!0),this._toolbar.enableButton_(BUT.Stop,!0)}_createContent1(t){this._player=new _AudioPlayerDialogHostPlayer(t,this.playerId),null!=this._seek&&(this._player.seek_=this._seek,this._seek=null),this._autoplay&&this._player.play_()}close_(){super.close_()}content_(){return this.dialog_()}zoom_(){return 0}hide_(){this._stop(!0)}onclick_(t){}onresize_(t,e){}getTableCellWidth_(t,e,i){return e-2}constraintTableWidth_(t,e,i,n){return e>400&&(e=400),n<i&&(n=i),n>e&&(n=e),n}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.Stop:this._stop(!0);break;case BUT.Cancel:this._stop(!1);break;default:this.actionInvalid_(t)}}_stop(t){null!=this._player&&(this._player.destroy_(t),this._player=null),this.actionCancel_(),mainPanel$._mainToolbar.updateAudioStatus_()}onPause_(){null!=this._player&&this._player.onPause_()}onResume_(){null!=this._player&&this._player.onResume_()}seek(t){null!=this._player?this._player.seek_=t:this._seek=t}}_AudioPlayerDialog._singleton=null;class _AudioPlayerDialogHostPlayer{constructor(t,e){this._content=t,this._playerId=e,this._playing=!1,this._poller=null,this._played=null,this._total=null,this.seek_=null,this._polling=()=>{null!=this._playerId&&(null!=this.seek_?host$.audioSeek_(this._playerId,this.seek_,t=>{toasters$.warn_(t),this.seek_=null,this._polling1()}):this._polling1())},this._control=new _AudioPlayerDialogControl(this._content,Basepath.nameWithSuffix_(e)),this._control.onPlayButton_(t=>{An.stopevent_(t),!this._playing?this.play_():this.pause_()}),this._control.onSlider_(t=>{const e=t.target.value,i=An.parseInt_(e,-1);i>=0&&null!=this._total&&this._total>=0&&(this.seek_=this._total*i/_AudioPlayerDialogControl.TICKS,this._startPolling())}),this._startPolling()}get played$(){return this._played}get total$(){return this._total}play_(){null!=this._playerId&&host$.audioPlay_(this._playerId,t=>{toasters$.warn_(t),this._startPolling()})}pause_(){null!=this._playerId&&host$.audioPause_(this._playerId,t=>toasters$.warn_(t))}destroy_(t){null!=this._playerId&&(this._stopPolling(),t?host$.destroyAudioPlayer_(this._playerId,t=>{toasters$.warn_(t)}):host$.releaseAudioPlayer_(this._playerId,t=>{toasters$.warn_(t)}))}onPause_(){this._stopPolling()}onResume_(){null!=this._playerId&&this._startPolling()}_startPolling(){if(null==this._poller){let t=_AudioPlayerDialogHostPlayer.MAX_POLLING_INTERVAL;if(null!=this._total){const e=this._total/_AudioPlayerDialogControl.TICKS;e<_AudioPlayerDialogHostPlayer.MIN_POLLING_INTERVAL?t=_AudioPlayerDialogHostPlayer.MIN_POLLING_INTERVAL:e<_AudioPlayerDialogHostPlayer.MAX_POLLING_INTERVAL&&(t=e)}this._polling(),this._poller=new PeriodicTimer(t,this._polling)}}_stopPolling(){null!=this._poller&&(this._poller.cancel_(),this._poller=null)}_polling1(){host$.pollAudioPlayer_(this._playerId,t=>{const e=t[Key.result];if(null==e||e.length<3)return;const i=e[0];let n=e[1];const s=0!=e[2],o=this._playing;n<0&&(n=i),i==this._played&&n==this._total||(this._control.setTime_(i,n),this._played=i,this._total=n),s!=this._playing&&(this._playing=s,this._control.setPlaying_(s)),o||s||this._stopPolling()})}}_AudioPlayerDialogHostPlayer.MIN_POLLING_INTERVAL=100,_AudioPlayerDialogHostPlayer.MAX_POLLING_INTERVAL=500;class _AudioPlayerDialogControl{constructor(t,e){this._totaltime=null,this._playedtime=null,this._ticks=null,_destroyed_12.set(this,!1);const i=new DomBuilderEx(t).addClass_(CSS.AnAudioPlayer).push_();this._control=i.div1_(CSS.AnAudioControl).push_().cursor_(),this._slider=i.peek_().input_({class:CSS.AnAudioSlider,type:"range",min:"0",max:`${_AudioPlayerDialogControl.TICKS}`,step:"1",value:"0",style:"flex:1 1 auto;"}).cursor_(),this._playButton=i.pop_().div1_(CSS.Fa,CSS.FaPlay,CSS.AnAudioButton).cursor_(),i.peek_().div_({class:CSS.AnAudioTimeline,style:"padding-bottom: 1ex"}),this._total=i.div1_(CSS.AnAudioPlaytime).text_(" --:--   ").cursor_(),this._time=i.up_().div1_(CSS.AnAudioPlaytime).text_("   --:--").cursor_(),i.peek_().div1_(CSS.AnAudioTimeline).div1_(CSS.AnAudioFilename).text_(e),i.peek_().div1_(CSS.AnAudioBanner,CSS.AnFlexCenter,CSS.Fa,CSS.FaVolumeUp),i.pop_()}onPlayButton_(t){An.onClick_(this._playButton,e=>t(e))}onSlider_(t){An.onInput_(this._slider,e=>t(e))}destroy_(){__classPrivateFieldGet(this,_destroyed_12)||(__classPrivateFieldSet(this,_destroyed_12,!0),this._control.remove())}setTime_(t,e){if(e!=this._totaltime){const t=An.timeStringFromMs_(e);this._total.textContent=" "+t,this._totaltime=e}if(t!=this._playedtime){this._playedtime=t;const i=An.timeStringFromMs_(t);this._time.textContent=i;const n=Math.round(t*_AudioPlayerDialogControl.TICKS/e);n!=this._ticks&&(this._ticks=n,this._slider.value=n.toString())}}setPlaying_(t){const e=this._playButton.classList;e.remove(t?CSS.FaPlay:CSS.FaPause),e.add(t?CSS.FaPause:CSS.FaPlay)}}_destroyed_12=new WeakMap,_AudioPlayerDialogControl.TICKS=200;class _VideoParam{constructor(){this.poster=0,this.seek=null}}const mainPanel$=new _MainPanel(document.body);class DocumentPanelBase extends UIPanelBase{}class _OutlineTreeListener{constructor(t){this._baseuri=native$.getIFrameUri_(),this._panel=t}onDblClick_(t){if(this.ondblclick1(t)){const e=native$.getIFrameSelectionRange_(),i=_OutlineUtil.getTarget_(t);null!=e&&null!=i&&RangeUtil.setEndAfter_(e,i),null!=e&&native$.iSelectRange_(e)}}ondblclick1(t){var e,i,n;const s=t.tree_(),o=s.getSelection_();if(0!=o.length){const l=null!==(e=ArrayUt.first_(o))&&void 0!==e?e:null,a=null!==(n=null===(i=ArrayUt.last_(o))||void 0===i?void 0:i.nextSibling_())&&void 0!==n?n:null;let r=l;for(;null!=r&&r!==a;r=r.nextSibling_())if(r===t){for(let t=r.nextSibling_();null!=t&&t!==a;t=t.nextSibling_())s.deselect_(t,!0);return!0}for(let e=a;null!=e;e=e.nextSibling_())if(t===e){for(let t=a;null!=t&&t!==e;t=t.nextSibling_())s.select_(t,!0);return s.select_(e,!0),!0}}return!1}onExpand_(t){if(!t.isPopulated_()&&null!=this._baseuri){const e=t.getTargetPath_();if(null!=e){const i=native$.getIFrameNodeByPath_(e);null!=i&&this._panel.populateOutlineChildren_(t,i,this._baseuri)}}}onSelectionChanged_(t,e){if(e){const e=t.getTargetPath_();null!=e&&native$.iSelectNodeByPath_(e,!0,!0)}else native$.iClearSelection_()}}class _OutlineUtil{static getTarget_(t){const e=t.getTargetPath_();return null==e?null:native$.getIFrameNodeByPath_(e)}static getTag_(t){return null==t?null:_OutlineUtil.getTag1_(t.content_())}static getTag1_(t){var e,i;if(null==t)return null;const n=t.firstChild;return null==n?null:null!==(i=null===(e=n.textContent)||void 0===e?void 0:e.trim())&&void 0!==i?i:""}static getOlAttr_(t){return null==t?null:_OutlineUtil.getOlAttr1_(t.content_())}static getOlAttr1_(t){if(null==t)return null;const e=t.children;for(const t of Array.from(e))if(t.classList.contains(CSS.AnAtt))return t;return null}static getNodeInfo_(t,e){var i;let n=native$.getNodeInfo_(t);if(t.nodeType==Node.ELEMENT_NODE){let s=CSSUtil.humanCSSUrls_(null!==(i=t.getAttribute("style"))&&void 0!==i?i:"",e);0!=s.length&&(s.length>DEF.maxNodeInfoLen&&(s=An.truncate_(s+"...",DEF.maxNodeInfoLen)),n+=` style (${s})`)}return n}}class _DocumentOutlinePanel extends DocumentPanelBase{constructor(t){super(),this._smokescreen=null,this._treeListener=null,this._tree=null,this._targetPath=null,this._targetTreenode=null,this._matcher=null,this._showWhitespaces=!1,this._shown=!1,this._actionNextMatch=()=>{this._searchbar.button_(BUT.NextMatch).classList.remove(CSS.AnToggleOff),this._searchbar.button_(BUT.PrevMatch).classList.add(CSS.AnToggleOff),this._actionIncrementalSearch()},this._container=t,this._treeListener=new _OutlineTreeListener(this);const e=new DomBuilderEx(t).push_();this._toolbar=new Toolbar(e.cursor_(),[BUT.info_(BUT.CollapseAll),BUT.info_(BUT.ExpandAll),BUT.info_(BUT.ExtendSelection),BUT.info_(BUT.Contextmenu)]),this._toolbar.onAction_((t,e)=>this._toolbarActions(t,e)),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._searchbar=new Toolbar(e.cursor_(),[INPUT.info_(INPUT.SearchBox),BUT.info_(BUT.NextMatch),BUT.info_(BUT.PrevMatch),BUT.info_(BUT.Contextmenu)]),this._searchbar.onAction_((t,e)=>this._searchbarActions(t,e)),this._searchbar.onTooltips_(toasters$.onTooltipsKey_),e.pop_().div1_(CSS.AnContentPanel),this._content=e.div1_(CSS.AnContentViewport).cursor_(),this._contextmenu=this._createContextmenu(),this._searchbox=this._searchbar.querySelector_(Conf.input),this._searchbar.hide_(),An.onContextmenu_(this._container,t=>{An.stopevent_(t),this.showContextmenu_(t)}),An.onFocus_(this._searchbox,()=>{Timer.sleep0_(()=>{An.select_(this._searchbox)}),null!=this._matcher&&this._matcher.resetAnchor_()}),An.onKeypress_(this._searchbox,t=>{"Enter"==t.key&&(An.stopevent_(t),this._actionNextMatch())}),An.onInput_(this._searchbox,()=>{const t=An.isButtonOff_(this._searchbar.button_(BUT.NextMatch));this._actionIncrementalSearch(!1,!0,t)}),An.onKeypress_(this.element_(),t=>{!t.ctrlKey||"f"!=t.key&&"F"!=t.key||(An.stopevent_(t),t.shiftKey?this._showMainbar():this._showSearchbar())})}static _getNodeType(t){const e=t.content_();return null==e?null:e.classList.contains(CSS.AnTxt)?Node.TEXT_NODE:Node.ELEMENT_NODE}static _getNodeName(t){var e,i,n,s;const o=null!==(i=null===(e=t.content_())||void 0===e?void 0:e.firstChild)&&void 0!==i?i:null;return null==o?null:o.nodeType==Node.ELEMENT_NODE?null!==(s=null===(n=o.textContent)||void 0===n?void 0:n.trim())&&void 0!==s?s:null:"#text"}_createContextmenu(){const t=new Contextmenu(accessories$,DEF.zindexContextmenu,[[_MainContextmenu._info(_DocumentOutlinePanel._COPY),_MainContextmenu._info(_DocumentOutlinePanel._CUT),_MainContextmenu._info(_DocumentOutlinePanel._PASTE_CHILD),_MainContextmenu._info(_DocumentOutlinePanel._PASTE_SIBLING),_MainContextmenu._info(_DocumentOutlinePanel._UNDO)],[_MainContextmenu._info(_DocumentOutlinePanel._MOVETO_PARENT),_MainContextmenu._info(_DocumentOutlinePanel._MOVETO_PREV),_MainContextmenu._info(_DocumentOutlinePanel._MOVETO_NEXT),_MainContextmenu._info(_DocumentOutlinePanel._EDIT_ELEMENT),_MainContextmenu._info(_DocumentOutlinePanel._EDIT_RAW_STYLE)],[_MainContextmenu._info(_DocumentOutlinePanel._LINEBREAK),_MainContextmenu._info(_DocumentOutlinePanel._INSERT_TEXT),_MainContextmenu._info(_DocumentOutlinePanel._INSERT_ELEMENT),_MainContextmenu._info(_DocumentOutlinePanel._WRAP),_MainContextmenu._info(_DocumentOutlinePanel._UNWRAP)],[_MainContextmenu._info(_DocumentOutlinePanel._PARAGRAPH),_MainContextmenu._info(_DocumentOutlinePanel._DELETE),_MainContextmenu._info(_DocumentOutlinePanel._SPAWN_NODE),_MainContextmenu._info(_DocumentOutlinePanel._DESTRUCT_WIDGET),_MainContextmenu._info(_DocumentOutlinePanel._INSERT_WIDGET)],[smap_([ATTR.AnAction,_DocumentOutlinePanel._INITIAL_SELECTION],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaFlag}`],[ATTR.xTooltips,RS.Tooltips_ShowInitialSelection]),smap_([ATTR.AnAction,_DocumentOutlinePanel._HIDDEN],["class",`${CSS.Fa} ${CSS.FaEyeSlash}`],[ATTR.xTooltips,RS.Tooltips_ToggleHidden]),smap_([ATTR.AnAction,_DocumentOutlinePanel._WHITESPACE],["class",`${CSS.Fa} ${CSS.FaCircleThin}`],[ATTR.xTooltips,RS.Tooltips_ShowWhitespaceNodes]),BUT.info_(BUT.IgnoreCase),BUT.info_(BUT.Searchbar)]]);return t.onAction_((t,e,i)=>this._contextActions(t,e,i)),t.onDrag_(Contextmenu.contextmenuDragOK_),t.onShow_(()=>this._updateContextmenuState()),t.onTooltips_(toasters$.onTooltipsKey_),t}element_(){return this._container}show_(){this._shown||(this._shown=!0,host$.hideKeyboard_(()=>{const t=new StepTimer;t.debug_("# OutlinePanel.show(): start"),An.showHidden_(this._container),this.refresh(),An.showVisible_(this._container),t.debug_("# OutlinePanel.show(): end")}))}hide_(){if(this._shown){this._shown=!1;const t=new StepTimer;t.debug_("# OutlinePanel.hide(): start"),this._matcher=null,this.hideContextmenu_(),An.hide_(this._container),new DomBuilderEx(this._content).empty_(),null!=this._tree&&(this._tree.destroy_(),this._tree=null),this._targetPath=null,this._targetTreenode=null,t.debug_("# OutlinePanel.hide(): end")}}refresh(){var t;this._matcher=null;const e=new StepTimer;if(e.debug_("# OutlinePanel.refresh(): start"),new DomBuilderEx(this._content).empty_(),null===(t=null==docInfo$?void 0:docInfo$.isHtml$)||void 0===t||!t)return null!=this._tree&&(this._tree.destroy_(),this._tree=null),this._enableToolbar(!1),void e.debug_("# OutlinePanel.refresh(): end");this._tree=this._populateOutlineTree(),null!=this._treeListener&&this._tree.addListener_(this._treeListener);const i=Math.round(this._content.getBoundingClientRect().width);this._tree.setWidth_(i),this._enableToolbar(!0),e.debug_("# OutlinePanel.refresh(): end")}showContextmenu_(t){this._contextmenu.show_(t)}hideContextmenu_(){this._contextmenu.hide_()}onWindowSizeChanged_(){this._contextmenu.destroy_(),this._contextmenu=this._createContextmenu()}resizeContent_(t){const e=t-cache$.ui$.toolbarHeight_()-DEF.sidepanelMarginBottom;if(this._content.style.height=`${e}px`,this._shown&&null!=this._tree){const t=Math.round(this._content.getBoundingClientRect().width);this._tree.setWidth_(t)}}_actionIncrementalSearch(t=!1,e=!1,i=!1){if(toasters$.hideWarn_(),null==this._tree)return;for(let t=this._tree.root_().firstChild_();null!=t;t=t.nextSibling_())t.expandAll_();null==this._matcher&&(this._matcher=new OutlineSearchMatcher(this._tree));const n=this._searchbox.value,s=An.isButtonOn_(this._contextmenu.button_(BUT.IgnoreCase));t&&this._matcher.resetAnchor_(),this._matcher.incrementalSearch_(n,s,e,i)||toasters$.warnKey_(RS.NoMatchFound,{attop:!1})}_refresh1(t,e){const i=native$.getIFrameUri_();null!=t&&null!=i&&(this._matcher=null,t.removeDescendants_(),this.populateOutlineChildren_(t,e,i),t.revealExpand_())}_refreshParent1(t,e,i){const n=t.parent_();if(null==this._tree||null==n||null==e.parentNode)return;const s=n.indexOf_(t);this._tree.deselectAll_(),this._refresh1(n,e.parentNode),n.expand_();const o=n.get_(s+i);null!=o&&(o.reveal_(),o.expand_(),o.select_(!0))}_refreshParent(t,e,i,n){const s=t.parent_();if(null==this._tree||null==s)return;if(this._tree.deselectAll_(),n<=0)return void this._refresh1(s,e);const o=s.indexOf_(t);this._refresh1(s,e),s.expand_();let l=s.get_(o+i);for(;--n>=0&&null!=l;)l.select_(!0),l=l.nextSibling_()}_populateOutlineTree(){const t=new StepTimer;t.debug_("# populateOutlineTree: start");const e=DomBuilderEx.offline1_(this._content.ownerDocument,"div",CSS.AnViewportContent).cursor_(),i=new OutlineTree(e,cache$.ui$.buttonSize_()/4),n=i.root_(),s=native$.getIFrameBody_(),o=native$.getIFrameUri_();return null!=s&&null!=o&&(this._targetPath=native$.getIFrameSelectionPath_(),null!=this._targetPath&&this._targetPath.length>0?(n.expand_(),this._targetTreenode=this._populateOutlinePath(n,s,o,this._targetPath,0)):(this.populateOutlineChildren_(n,s,o),n.expand_()),t.debug_("# populateOutlineRoot: populate"),this._content.append(e),null!=this._targetTreenode&&null!=this._targetPath&&(native$.iSelectNodeByPath_(this._targetPath,!0),this._targetTreenode.revealSelect_(),this._targetTreenode.scrollIntoView_()),t.debug_("# populateOutlineRoot: append")),t.debug_("# populateOutlineTree: done"),i}populateOutlineChildren_(t,e,i){let n=-1;for(let s=e.firstChild;null!=s;s=s.nextSibling){++n;const e=s.nodeType,o=_OutlineUtil.getNodeInfo_(s,i);let l=!1;if(e==Node.TEXT_NODE){if(l=An.isWhitespaces_(o),!this._showWhitespaces&&l)continue}else if(e!=Node.ELEMENT_NODE)continue;_DocumentOutlinePanel._createOutlineItem(t.append_(),this._showWhitespaces,l,s,e,o).setData_(n)}t.setPopulated_(!0)}_populateOutlinePath(t,e,i,n,s){const o=n[s];t.isPopulated_()||this.populateOutlineChildren_(t,e,i),t.expand_();let l=null,a=null;for(l=t.firstChild_();null!=l&&l.getData_()!=o;l=l.nextSibling_())a=l;if(null==l){if(s==n.length-1)return a;throw Assert.notReach_(`level=${s}, index=${o}`)}return++s<n.length?this._populateOutlinePath(l,e.childNodes[o],i,n,s):l}static _createOutlineItem(t,e,i,n,s,o){const l=t.content_();if(null==l)return t;if(s==Node.ELEMENT_NODE){const t=new DomBuilderEx(l),e=n.nodeName;t.push_().span1_(CSS.AnTag).text_(e).pop_(),An.isBodyElement_(e)||o.length>0&&t.text_("").span1_(CSS.AnAtt).text_(o)}else{if(s!=Node.TEXT_NODE)throw MSG.string_(RS.AssertNotReach);i&&t.element_().classList.add(CSS.AnWsp),new DomBuilderEx(l,{class:CSS.AnTxt}).text_(o)}return e?t.setKind_(n.hasChildNodes()?OutlineTreenode.COLLAPSED:OutlineTreenode.LEAF):t.setKind_(JsUtil.isEmptyNode_(n)?OutlineTreenode.LEAF:OutlineTreenode.COLLAPSED),t}validOutlineSelection(t){return null==t||0==t.length?null:_state!=_State.EDITING?null:t}_validOutlineSelectionOrWarn(t){const e=this.validOutlineSelection(t);return null==e&&toasters$.warnKey_(RS.ActionRequireAValidSelection),e}_outlineSelected1(t){const e=this.validOutlineSelection(t);return null!=e&&1==e.length?e[0]:null}_outlineSelectedLast(t){const e=this.validOutlineSelection(t);return null!=e&&e.length>0?e[e.length-1]:null}_outlineTarget1(t,e){const i=this._outlineSelected1(t);if(null==i)return void toasters$.warnKey_(RS.ActionRequireASingleNodeSelection);const n=_OutlineUtil.getTarget_(i);null!=n&&e(i,n)}_outlineTargetLast(t,e){const i=this._outlineSelectedLast(t);if(null==i)return void toasters$.warnKey_(RS.ActionRequireAValidSelection);const n=_OutlineUtil.getTarget_(i);null!=n&&e(i,n)}_updateContextmenuState(){var t,e,i,n;const s=this._contextmenu.button_(_DocumentOutlinePanel._WHITESPACE).classList;this._showWhitespaces?s.remove(CSS.AnToggleOff):s.add(CSS.AnToggleOff),An.enableButton_(this._contextmenu.button_(_DocumentOutlinePanel._INITIAL_SELECTION),null!=this._targetTreenode);const o=this._contextmenu.button_(BUT.Searchbar).classList,l=this._toolbar.isShown_();if(o.remove(l?CSS.FaEllipsisH:CSS.FaSearch),o.add(l?CSS.FaSearch:CSS.FaEllipsisH),_state==_State.EDITING){const t=null!==(n=null===(i=this._tree)||void 0===i?void 0:i.getSelection_())&&void 0!==n?n:[];if(0==t.length){for(const t of _DocumentOutlinePanel._ACTIONS)t!=_DocumentOutlinePanel._UNDO?An.enableButton_(this._contextmenu.button_(t),!1):this._contextmenu.enableButton_(_DocumentOutlinePanel._UNDO,!history$.isUndoEmpty_());return}const e=t[0],s=e.parent_(),o=_DocumentOutlinePanel._getNodeType(e),l=_DocumentOutlinePanel._getNodeName(e);this._contextmenu.enableButton_(_DocumentOutlinePanel._UNDO,!history$.isUndoEmpty_());const a="BODY"!=l,r=o==Node.ELEMENT_NODE,_=null==l||Html5.isEmptyTag(l),c=clipboard$.isEmpty_(),h=a&&1==t.length,u=h&&r;this._contextmenu.enableButtons_([_DocumentOutlinePanel._COPY,_DocumentOutlinePanel._CUT,_DocumentOutlinePanel._DELETE,_DocumentOutlinePanel._WRAP,_DocumentOutlinePanel._INSERT_WIDGET,_DocumentOutlinePanel._HIDDEN],a),this._contextmenu.enableButton_(_DocumentOutlinePanel._PASTE_SIBLING,!c&&a),this._contextmenu.enableButton_(_DocumentOutlinePanel._PASTE_CHILD,!c&&1==t.length&&r&&!_),this._contextmenu.enableButtons_([_DocumentOutlinePanel._INSERT_ELEMENT,_DocumentOutlinePanel._INSERT_TEXT,_DocumentOutlinePanel._LINEBREAK,_DocumentOutlinePanel._PARAGRAPH],h),this._contextmenu.enableButton_(_DocumentOutlinePanel._MOVETO_PARENT,h&&null!=s&&!s.isRoot_()&&"BODY"!=_DocumentOutlinePanel._getNodeName(s));const d=h&&null!=s&&s.childCount_()>1;this._contextmenu.enableButton_(_DocumentOutlinePanel._MOVETO_PREV,d),this._contextmenu.enableButton_(_DocumentOutlinePanel._MOVETO_NEXT,d),this._contextmenu.enableButtons_([_DocumentOutlinePanel._SPAWN_NODE,_DocumentOutlinePanel._EDIT_RAW_STYLE,_DocumentOutlinePanel._DESTRUCT_WIDGET],u),this._contextmenu.enableButton_(_DocumentOutlinePanel._EDIT_ELEMENT,u||o==Node.TEXT_NODE),this._contextmenu.enableButton_(_DocumentOutlinePanel._SPAWN_NODE,u),this._contextmenu.enableButton_(_DocumentOutlinePanel._UNWRAP,u&&!_)}else for(const i of _DocumentOutlinePanel._ACTIONS)if(i!=_DocumentOutlinePanel._COPY)An.enableButton_(this._contextmenu.button_(i),!1);else{let n=!1;const s=null!==(e=null===(t=this._tree)||void 0===t?void 0:t.getSelection_())&&void 0!==e?e:[];if(s.length>0){const t=s[0];n="BODY"!=_DocumentOutlinePanel._getNodeName(t)}An.enableButton_(this._contextmenu.button_(i),n)}}_contextActions(t,e,i){const n=null==this._tree?null:this._tree.getSelection_();switch(t){case _DocumentOutlinePanel._COPY:this._actionCopy(n);break;case _DocumentOutlinePanel._CUT:this._actionCut(n);break;case _DocumentOutlinePanel._DELETE:this._actionDelete(n);break;case _DocumentOutlinePanel._PASTE_SIBLING:this._actionPasteSibling(n);break;case _DocumentOutlinePanel._PASTE_CHILD:this._actionPasteChild(n);break;case _DocumentOutlinePanel._UNDO:this._actionUndo();break;case _DocumentOutlinePanel._LINEBREAK:this._actionLInebreak(n);break;case _DocumentOutlinePanel._PARAGRAPH:this._actionParagraphBreak(n,e);break;case _DocumentOutlinePanel._INSERT_ELEMENT:this._actionInsertElement(n);break;case _DocumentOutlinePanel._INSERT_TEXT:this._actionInsertText(n);break;case _DocumentOutlinePanel._HIDDEN:this._actionToggleHidden(n);break;case _DocumentOutlinePanel._WRAP:this._actionWrap(n);break;case _DocumentOutlinePanel._UNWRAP:this._actionUnwrap(n);break;case _DocumentOutlinePanel._INSERT_WIDGET:this._actionInsertWidget(n,e);break;case _DocumentOutlinePanel._DESTRUCT_WIDGET:this._actionDestroyWidget(n);break;case _DocumentOutlinePanel._SPAWN_NODE:this._actionSpawnNode(n);break;case _DocumentOutlinePanel._MOVETO_PARENT:return this._actionMovetoParent(n),void this._updateContextmenuState();case _DocumentOutlinePanel._MOVETO_PREV:return this._actionMovetoPrev(n),void this._updateContextmenuState();case _DocumentOutlinePanel._MOVETO_NEXT:return this._actionMovetoNext(n),void this._updateContextmenuState();case _DocumentOutlinePanel._EDIT_RAW_STYLE:this._actionEditStyle(n);break;case _DocumentOutlinePanel._EDIT_ELEMENT:this._actionEditNode(n);break;case _DocumentOutlinePanel._INITIAL_SELECTION:null!=this._targetTreenode?(this._targetTreenode.revealSelect_(),this._targetTreenode.scrollIntoView_()):toasters$.warnKey_(RS.ThereIsNoInitialDocumentSelection);break;case _DocumentOutlinePanel._WHITESPACE:this._showWhitespaces=!this._showWhitespaces,_Util.toastOnOffButton_(MSG.string_(RS.Tooltips_ShowWhitespaceNodes),this._showWhitespaces),this.refresh();break;case BUT.IgnoreCase:_Util.toggleIgnorecase_(this._contextmenu.button_(BUT.IgnoreCase));break;case BUT.Searchbar:{const t=An.classlist_(i);t.contains_(CSS.FaSearch)?this._showSearchbar():this._showMainbar(),t.toggleAll_(CSS.FaSearch,CSS.FaEllipsisH);break}case DEF.NOOP:return}this.hideContextmenu_()}_showSearchbar(){this._toolbar.hide_(),this._searchbar.show_(),Timer.sleep00_(()=>{this._searchbox.focus(),host$.showKeyboard_()})}_showMainbar(){this._searchbar.hide_(),this._toolbar.show_()}_actionUndo(){history$.undo_()||toasters$.warnKey_(RS.NothingToUndo),this.refresh()}_actionSpawnNode(t){this._outlineTarget1(t,(t,e)=>{_MainPanel._spawnNode0(e,()=>{this._refreshParent1(t,e,1)})})}_actionMovetoParent(t){this._outlineTarget1(t,(t,e)=>{_MainPanel._actionMovetoParent1(e,()=>{const i=t.parent_();null!=i&&this._refreshParent1(i,e,1)})})}_actionMovetoPrev(t){this._outlineTarget1(t,(t,e)=>{_MainPanel._actionMovetoPrev1(e,()=>{const i=t.parent_();if(null==i)return;const n=i.indexOf_(t);this._refreshParent1(t,e,0==n?i.childCount_()-1:-1)})})}_actionMovetoNext(t){this._outlineTarget1(t,(t,e)=>{_MainPanel._actionMovetoNext1(e,()=>{const i=t.parent_();if(null==i)return;const n=i.indexOf_(t);this._refreshParent1(t,e,n==i.childCount_()-1?-n:1)})})}_actionEditStyle(t){this._outlineTarget1(t,(t,e)=>{e.nodeType==Node.ELEMENT_NODE?_MainPanel._actionEditRawStyle1(e,()=>{this._refreshParent1(t,e,0)}):toasters$.warnKey_(RS.ActionRequireASingleElementSelection)})}_actionEditNode(t){this._outlineTarget1(t,(t,e)=>{const i=native$.getIFrameUri_();if(null==i)return;const n=e.nodeType;n==Node.ELEMENT_NODE?_MainPanel._actionEditElementRaw1(e,i,(e,i)=>{if(i){const i=t.parent_();null!=i&&this._refreshParent1(i,e,0)}else this._refreshParent1(t,e,0)}):n==Node.TEXT_NODE?_MainPanel._actionEditText1(e,!1,null,null,e=>{const i=t.content_();null!=i&&(i.textContent=An.truncate_(e,_DEF.OutlineTextLen))}):toasters$.warnKey_(RS.InvalidSelection)})}_actionUnwrap(t){this._outlineTarget1(t,(t,e)=>{var i;const n=DomUt.asHTMLElement_(e);if(null==n)return void toasters$.warnKey_(RS.ActionRequireASingleElementSelection);const s=native$.getIFrameUri_();null!=s&&(t.isPopulated_()||this.populateOutlineChildren_(t,n,s),history$.group_(RS.action_Unwrap,null!==(i=n.nodeName)&&void 0!==i?i:"",()=>{const e=n.parentElement,i=n.firstChild;if(null==e||null==i)return;const s=n.lastChild,o=t.childCount_(),l=new DomBuilderEx(n),a=new DomBuilderEx(e);let r=i;for(;null!=r;){const t=r.nextSibling;l.removeChild_(r),a.insertBefore_(n,r),r=t}a.removeChild_(n),native$.iSelectNodes_(i,s,!0,!0),this._refreshParent(t,e,0,o)}))})}_actionWrap(t){const e=this._validOutlineSelectionOrWarn(t);if(null==e||0==e.length)return!1;const i=e[0],n=_OutlineUtil.getTarget_(i);if(null==n)return toasters$.warnKey_(RS.InvalidSelection),!1;const s=n.nodeName;if(An.isBodyElement_(s))return toasters$.warnKey_(RS.InvalidSelection),!1;const o=new PromptElement(accessories$);return o.titleKey_(RS.WrapSelection),o.messageKey_(RS.PromptElementMessage),o.zindex_(DEF.zindexPrompt),o.tag_("DIV"),o.onOK_((t,s,o,l)=>{Sanitizers.checkTagAttrs_(s,o,native$.getIFrameUri_(),s=>{if(t.warn_(s))return void l(!1);l(!0),toasters$.warn_(s[Key.warns]);const o=s[Key.tag],a=s[Key.attrs];history$.group_(RS.action_Wrap,o,()=>{var t;const s=n.parentElement,l=ArrayUt.last_(e),r=i.parent_();if(null==s||null==r||void 0===l)return;const _=_OutlineUtil.getTarget_(l);if(null==_)return;const c=r.indexOf_(i),h=_.nextSibling;new DomBuilderEx(s).childBefore_(n,o,a).moveChildren_(n,h),native$.iSelectNodes_(n,h,!0,!0),null===(t=this._tree)||void 0===t||t.deselectAll_(),this._refresh1(r,s),r.get_(c),r.select_(!0),r.expand_()})})}),o.show_(),!0}_actionInsertWidget(t,e){const i=this._validOutlineSelectionOrWarn(t);if(null==i||0==i.length)return;const n=new _WidgetContextmenu(accessories$,_WidgetTemplates._INFOS);n.onAction_(t=>{n.destroy_(),_MainPanel._widgetContextAction(t)}),n.onCancel_(()=>{n.destroy_()}),n.show_(e.pageX,e.pageY)}_actionDestroyWidget(t){this._outlineTarget1(t,(t,e)=>{e.nodeType==Node.ELEMENT_NODE?_WidgetTemplates._actionDestructWidget()&&sidePanel$.hideSidepanel_():toasters$.warnKey_(RS.ActionRequireASingleElementSelection)})}_actionToggleHidden(t){const e=this._validOutlineSelectionOrWarn(t);if(null==e||0==e.length)return;const i=e[0],n=_OutlineUtil.getTarget_(i);if(null==n)return void toasters$.warnKey_(RS.InvalidSelection);const s=n.nodeName;An.isBodyElement_(s)?toasters$.warnKey_(RS.InvalidSelection):history$.group_(RS.action_ToggleVisibility,s,()=>{var t;if(1==e.length&&n.nodeType==Node.ELEMENT_NODE)return native$.toggleClasses_(n,[CSS.xHidden]),void this._refreshParent1(i,n,0);const s=n.parentElement,o=ArrayUt.last_(e),l=i.parent_();if(null==l||null==s||void 0===o)return;const a=_OutlineUtil.getTarget_(o);if(null==a)return;const r=l.indexOf_(i),_=a.nextSibling;new DomBuilderEx(s).childBefore_(n,"div",{class:CSS.xHidden}).moveChildren_(n,_),null===(t=this._tree)||void 0===t||t.deselectAll_(),this._refresh1(l,s),l.get_(r),l.select_(!0),l.expand_()})}_actionInsertElement(t){this._outlineTarget1(t,(t,e)=>{_MainPanel._actionInsertElement1(e,(i,n)=>{var s;null===(s=this._tree)||void 0===s||s.deselectAll_(),n?this._refreshParent1(t,e,1):(this._refresh1(t,e),t.firstChild_(),t.select_(!0),t.reveal_(),t.expand_())})})}_actionInsertText(t){this._outlineTarget1(t,(t,e)=>{_MainPanel._actionInsertText1(e,(i,n)=>{this._refreshParent1(t,e,n?1:0)})})}_actionParagraphBreak(t,e){this._outlineTarget1(t,(t,i)=>{const n=new _ParaContextmenu(accessories$);n.onAction_(e=>{n.hide_();const s=e==CSS.xNone?{}:{class:e};history$.group_(RS.action_InsertParagraph,e,()=>{const e=i.parentElement;null!=e&&(new DomBuilderEx(e).childBefore_(i.nextSibling,"div",s).br_(),this._refreshParent1(t,i,1))})}),n.show_(e.pageX,e.pageY)})}_actionLInebreak(t){this._outlineTarget1(t,(t,e)=>{history$.group_(RS.action_InsertLinebreak,"",()=>{const i=e.parentElement;null!=i&&(new DomBuilderEx(i).childBefore_(e.nextSibling,"br"),this._refreshParent1(t,e,1))})})}_actionPasteChild(t){this._outlineTarget1(t,(t,e)=>{const i=DomUt.asHTMLElement_(e);if(null==i)return void toasters$.warnKey_(RS.ActionRequireASingleElementSelection);const n=native$.cloneClipboard_(clipboard$.get_()),s=null==n?null:n.nodeType;if(null==s||s!=Node.TEXT_NODE&&(s!=Node.ELEMENT_NODE||null==n||null==n.firstChild)||null==n)return void toasters$.warnKey_(RS.ClipboardIsEmptyOrInvalid);const o=new DomBuilderEx(i),l=i.firstChild;let a=1;history$.group_(RS.action_Paste,"",()=>{var e;if(s==Node.TEXT_NODE)o.insertBefore_(l,n),native$.iSelectNode_(n);else{a=n.childNodes.length;const t=n.firstChild,e=n.lastChild;if(!_MainPanel._pasteSibling(o,i,l,n))return void toasters$.warnKey_(RS.InvalidSelection);null!=t&&native$.iSelectNodes_(t,e)}null===(e=this._tree)||void 0===e||e.deselectAll_(),this._refresh1(t,i);let r=t.firstChild_();for(;--a>=0&&null!=r;)r.select_(!0),r=r.nextSibling_()})})}_actionPasteSibling(t){this._outlineTargetLast(t,(t,e)=>{const i=e.parentElement,n=native$.cloneClipboard_(clipboard$.get_()),s=null==n?null:n.nodeType;if(null==s||s!=Node.TEXT_NODE&&(s!=Node.ELEMENT_NODE||null==n||null==n.firstChild)||null==n||null==i)return void toasters$.warnKey_(RS.ClipboardIsEmptyOrInvalid);const o=_MainPanel._actionPasteSibling1(i,e,s,n);this._refreshParent(t,i,1,o)})}_actionCopy(t){if(null==t||0==t.length)return toasters$.warnKey_(RS.ActionRequireAValidSelection),!1;const e=new Array;for(const i of t){const t=_OutlineUtil.getTarget_(i);if(null==t)return toasters$.error_(MSG.string_(RS.TargetNodeNotExists)),!1;e.push(t)}const i=native$.iCreateDocumentFragment_(e);if(null!=i){const t=native$.serializeClone_(i),n=e[0].parentNode,s=null==n?"":JsUtil.getContextHtml_(n);clipboard$.dom_(t,s)}return!0}_actionCut(t){const e=this._actionDelete(t);if(null==e)return!1;const i=e[0],n=e[1],s=native$.iCreateDocumentFragment_(n);if(null==s||null==i)return!1;const o=native$.serializeClone_(s),l=JsUtil.getContextHtml_(i);return clipboard$.dom_(o,l),!0}_actionDelete(t){var e;const i=this._validOutlineSelectionOrWarn(t);if(null==i||0==i.length)return null;const n=i[0],s=n.parent_(),o=_OutlineUtil.getTarget_(n),l=null!==(e=null==o?void 0:o.parentElement)&&void 0!==e?e:null;if(null==s||null==o||null==l)return null;const a=new Array;for(const t of i){if(null==t)return null;const e=_OutlineUtil.getTarget_(t);if(null==e)return null;a.push(e),Assert.assertionKey_(e.parentNode==l,RS.AssertMultiSelectionMustBeUnderTheSameParent),Assert.assertionKey_(t.parent_()==s,RS.AssertMultiSelectionMustBeUnderTheSameParent)}const r=new DomBuilderEx(l);for(history$.group_(RS.action_Cut,"",()=>{for(const t of a)r.removeChild_(t)});i.length>0;)i.pop().remove_();return this._refresh1(s,l),[l,a]}_toolbarActions(t,e){switch(toasters$.hideAll_(),t){case BUT.CollapseAll:this._actionCollapseAll();break;case BUT.ExpandAll:this._actionExpandAll();break;case BUT.ExtendSelection:this._actionExtend();break;case BUT.Contextmenu:this.showContextmenu_(e);break;default:throw Assert.notReach_(t)}}_searchbarActions(t,e){switch(t){case BUT.Contextmenu:this.showContextmenu_(e);break;case BUT.NextMatch:this._actionNextMatch();break;case BUT.PrevMatch:this._searchbar.button_(BUT.NextMatch).classList.add(CSS.AnToggleOff),this._searchbar.button_(BUT.PrevMatch).classList.remove(CSS.AnToggleOff),this._actionIncrementalSearch(!1,!1,!0);break;default:throw Assert.notReach_(t)}}_actionExtend(){var t,e;if(null==this._tree)return;const i=this._tree.getSelection_();if(0==i.length)return void(null===(t=this._tree.root_().firstChild_())||void 0===t||t.select_(!0));const n=ArrayUt.last_(i),s=null!==(e=null==n?void 0:n.nextSibling_())&&void 0!==e?e:null;if(null==s)return void toasters$.infoKey_(RS.NoMoreChild);s.select_(!0);const o=native$.getIFrameSelectionRange_();if(null!=o){const t=_OutlineUtil.getTarget_(s);null!=t&&o.setEndAfter(t),native$.iSelectRange_(o)}}_actionExpandAll(){if(null==this._tree)return;const t=new StepTimer,e=this._tree.getSelection_();if(0==e.length)for(let t=this._tree.root_().firstChild_();null!=t;t=t.nextSibling_())t.expandAll_();else for(const t of e)t.expandAll_();t.debug_("# actionExpandAll()")}_actionCollapseAll(){if(null==this._tree)return;const t=new StepTimer,e=this._tree.getSelection_();if(0==e.length)for(let t=this._tree.root_().firstChild_();null!=t;t=t.nextSibling_())t.collapseAll_();else for(const t of e)t.collapseAll_();t.debug_("# actionCollapsedAll()")}_enableToolbar(t){t?(this._searchbar.hide_(),this._toolbar.show_(),this._matcher=null):(this._searchbar.hide_(),this._toolbar.showHidden_(),this._matcher=null)}}_DocumentOutlinePanel._COPY=MainContextActions._COPY,_DocumentOutlinePanel._CUT=MainContextActions._CUT,_DocumentOutlinePanel._DELETE=MainContextActions._DELETE,_DocumentOutlinePanel._DESTRUCT_WIDGET=MainContextActions._DESTRUCT_WIDGET,_DocumentOutlinePanel._EDIT_ELEMENT=MainContextActions._EDIT_NODE,_DocumentOutlinePanel._EDIT_RAW_STYLE=MainContextActions._EDIT_STYLE_RAW,_DocumentOutlinePanel._HIDDEN="H",_DocumentOutlinePanel._INSERT_ELEMENT=MainContextActions._INSERT_ELEMENT,_DocumentOutlinePanel._INSERT_TEXT=MainContextActions._INSERT_TEXT,_DocumentOutlinePanel._INSERT_WIDGET=MainContextActions._INSERT_WIDGET,_DocumentOutlinePanel._LINEBREAK=MainContextActions._LINEBREAK,_DocumentOutlinePanel._MOVETO_NEXT=MainContextActions._MOVETO_NEXT,_DocumentOutlinePanel._MOVETO_PARENT=MainContextActions._MOVETO_PARENT,_DocumentOutlinePanel._MOVETO_PREV=MainContextActions._MOVETO_PREV,_DocumentOutlinePanel._PARAGRAPH=MainContextActions._PARAGRAPH,_DocumentOutlinePanel._PASTE_CHILD=MainContextActions._PASTE_CHILD,_DocumentOutlinePanel._PASTE_SIBLING=MainContextActions._PASTE_SIBLING,_DocumentOutlinePanel._SPAWN_NODE=MainContextActions._SPAWN_NODE,_DocumentOutlinePanel._INITIAL_SELECTION="T",_DocumentOutlinePanel._UNDO=MainContextActions._UNDO,_DocumentOutlinePanel._UNWRAP=MainContextActions._UNWRAP,_DocumentOutlinePanel._WHITESPACE="W",_DocumentOutlinePanel._WRAP=MainContextActions._WRAP,_DocumentOutlinePanel._ACTIONS=[_DocumentOutlinePanel._COPY,_DocumentOutlinePanel._CUT,_DocumentOutlinePanel._DELETE,_DocumentOutlinePanel._DESTRUCT_WIDGET,_DocumentOutlinePanel._EDIT_ELEMENT,_DocumentOutlinePanel._EDIT_RAW_STYLE,_DocumentOutlinePanel._HIDDEN,_DocumentOutlinePanel._INSERT_ELEMENT,_DocumentOutlinePanel._INSERT_TEXT,_DocumentOutlinePanel._INSERT_WIDGET,_DocumentOutlinePanel._LINEBREAK,_DocumentOutlinePanel._MOVETO_NEXT,_DocumentOutlinePanel._MOVETO_PARENT,_DocumentOutlinePanel._MOVETO_PREV,_DocumentOutlinePanel._PARAGRAPH,_DocumentOutlinePanel._PASTE_CHILD,_DocumentOutlinePanel._PASTE_SIBLING,_DocumentOutlinePanel._SPAWN_NODE,_DocumentOutlinePanel._UNDO,_DocumentOutlinePanel._UNWRAP,_DocumentOutlinePanel._WRAP];class _DocumentLinksPanel extends DocumentPanelBase{constructor(t){super(),this._container=t,this._linkInfos=null,this._linkStatus=null,this._showBrokenOnly=!1,this._selected=null,this._rateLimiter=new FireLimiter(DEFUtil.filterDelay$);const e=new DomBuilderEx(t).push_();this._toolbar=new Toolbar(e.cursor_(),[BUT.info_(BUT.OpenStylesheet),BUT.info_(BUT.EditLink),smap_([ATTR.AnAction,_DocumentLinksPanel._ADD],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaPlus}`],[ATTR.xTooltips,RS.Tooltips_AddLink]),smap_([ATTR.AnAction,_DocumentLinksPanel._REMOVE],["class",`${CSS.AnButton} ${CSS.Fa} ${CSS.FaMinus}`],[ATTR.xTooltips,RS.Tooltips_RemoveLink]),BUT.info_(BUT.ShowBrokenOnly),BUT.info_(BUT.Toolbar)]),this._toolbar.onAction_(t=>this._toolbarActions(t)),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._filterbar=new Toolbar(e.cursor_(),[INPUT.info_(INPUT.FilterBox),BUT.info_(BUT.ClearSearchText),BUT.info_(BUT.Toolbar1)]),this._content=e.peek_().div1_(CSS.AnContentViewport).cursor_(),this._filterbar.onAction_(t=>this._toolbarActions(t)),this._filterbar.onTooltips_(toasters$.onTooltipsKey_),this._filterbox=this._filterbar.querySelector_(Conf.input),An.onInputFocusSelect_(this._filterbox),An.onKeypress_(this._filterbox,t=>{"Enter"==t.key&&(An.stopevent_(t),this._filter())}),An.onInput_(this._filterbox,()=>{this._rateLimiter.queue_(()=>{this._filter()})}),An.onKeypress_(this.element_(),t=>{!t.ctrlKey||"f"!=t.key&&"F"!=t.key||(An.stopevent_(t),t.shiftKey?this._showMainbar():this._showFilterbar())}),this._enableToolbar(!0)}element_(){return this._container}show_(){this._shown||(this._shown=!0,host$.hideKeyboard_(()=>{const t=new StepTimer;t.debug_("# DocumentLinksPanel.show(): start"),An.showHidden_(this._container),this.resizeContent_(window.innerHeight-cache$.ui$.toolbarHeight_()),this.refresh(),An.setVisible_(this._container),t.debug_("# DocumentLinksPanel.show(): end")}))}hide_(){this._shown&&(this._shown=!1,this.hideContextmenu_(),An.hide_(this._container),new DomBuilderEx(this._content).empty_())}refresh(t=null){const e=new StepTimer;if(e.debug_("# DocumentLinksPanel.refresh(): start"),this._selected=null,null==docInfo$||!docInfo$.isHtml$)return void this._disablePanel();this._linkInfos=native$.getIFrameLinks_();const i=An.parseJSONObjectOrNull_(native$.stringify_(this._linkInfos));if(null==i)return void this._disablePanel();const n=i[Key.baseurl],s=i[Key.links],o=smap_([Key.baseurl,n],[Key.links,s]);host$.linkInfos_(o,t=>{e.debug_("# DocumentLinksPanel.refresh(): linkinfos done");const i=t[Key.errors];if(null!=i)return this._disablePanel(),void toasters$.warn_(i);this._linkStatus=t[Key.result],this._populate(e),this._enableToolbar(!0),this._updateToolbarState(),e.debug_("# DocumentLinksPanel.refresh(): end")})}_disablePanel(){new DomBuilderEx(this._content).empty_(),this._enableToolbar(!1)}_updateToolbarState(){const t=this._editok(!1);An.enableButton_(this._toolbar.button_(BUT.EditLink),null!=t);const[e,i]=this._getlinkinfoOf(t);this._toolbar.enableButton_(BUT.OpenStylesheet,this._openStylesheetOK(e,i));const n=null!=t,s=null!=t&&null!=e&&i;An.enableButton_(this._toolbar.button_(_DocumentLinksPanel._REMOVE),n),An.enableButton_(this._toolbar.button_(_DocumentLinksPanel._ADD),s)}resizeContent_(t){if(this._shown){const e=t-cache$.ui$.toolbarHeight_()-DEF.sidepanelMarginBottom,i=Math.round(this._container.getBoundingClientRect().width);this._content.style.height=`${e}px`,this._content.style.minWidth=`${i}px`}}_enableToolbar(t){t?(this._filterbar.hide_(),this._toolbar.show_()):(this._filterbar.hide_(),this._toolbar.showHidden_())}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.Toolbar:this._showFilterbar();break;case BUT.Toolbar1:this._showMainbar();break;case BUT.ShowBrokenOnly:this._showBrokenOnly=An.toggleOnOffButton_(this._toolbar.button_(BUT.ShowBrokenOnly)),this.refresh();break;case BUT.EditLink:this._actionEditLink();break;case BUT.OpenStylesheet:this._actionOpenStylesheet();break;case BUT.ClearSearchText:this._filterbox.value="",this._filter();break;case _DocumentLinksPanel._ADD:this._actionAdd();break;case _DocumentLinksPanel._REMOVE:this._actionRemove();break;case BUT.EditLink:this._actionEditLink();break;default:throw Assert.notReach_(t)}}_showFilterbar(){this._toolbar.hide_(),this._filterbar.show_(),Timer.sleep00_(()=>{this._filterbox.focus(),An.select_(this._filterbox),host$.showKeyboard_()})}_showMainbar(){this._filterbar.hide_(),this._toolbar.show_()}showContextmenu_(){}hideContextmenu_(){}onWindowSizeChanged_(){}_actionEditLink(){const t=this._editok(),e=native$.getIFrameUri_(),[i,n]=this._getlinkinfoOf(t);if(null==t||null==e||null==i)return;const s=i[LinkInfoKey.name$],o=i[LinkInfoKey.value];if(null==s||null==o)return void toasters$.warnKey_(RS.SelectedNodeIsNotEditable);const l=i[LinkInfoKey.tag],a=i[LinkInfoKey.targetpath],r=DomUt.asHTMLElement_(null==a?null:native$.getIFrameNodeByPath_(a,n));if(null!=r)if(n)this._editlink(l,s,HumanLink.fromHref_(o),e,n=>{i[LinkInfoKey.value]=null==n?"":n.toString(),this._actionEditLink1(t,r,s,n,e)});else switch(s){case"name":_Util.promptName_(RS.Name,null,"",o,e=>{JsUtil.setAttribute_(r,"name",e),i[LinkInfoKey.value]=e,this._updateNameValue(t,LinkInfoStatus.EXISTS,"name",e)}).show_();break;case"src":case"href":{const n="IMG"==l&&"src"==s;this._edithref(HumanLink.fromHref_(o),e,n,n=>{i[LinkInfoKey.value]=null==n?"":n.toString(),this._actionEditLink1(t,r,s,n,e)});break}default:toasters$.error_(MSG.string_(RS.InvalidSelection)+": "+s)}else toasters$.warnKey_(RS.TargetNodeNotExists)}_edithref(t,e,i,n){_Util.promptLink_(RS.EditLinkTitle,"",t,e,RS.URL).onOK_((t,s,o)=>{Sanitizers.checkOptionalHref_(s,e).onFail_(e=>{t.warn_(e),o(!1)}).onOK_(e=>{if(null==e)return o(!0),void n(null);i&&null==Sanitizers.checkIsImageUri_(e).onFail_(e=>{t.warn_(e),o(!1)})||(o(!0),n(e))})}).show_()}_editlink(t,e,i,n,s){_Util.promptCssOutputUrl_(RS.EditLinkTitle,MSG.format2_(RS.editLinkMessage,null!=t?t:"",e),i,FilepickerKind.EXISTING_FILE,n,RS.URL).onOK_((t,e,i)=>{var o;null===(o=Sanitizers.checkOptionalHref_(e,n))||void 0===o||o.onFail_(e=>{t.warn_(e),i(!1)}).onOK_(e=>{if(null==e)return i(!0),void s(null);const n=An.cpathOfUri_(e);if(null==n||!this._addcssok(n))return t.warnKey_(RS.InvalidDestination),void i(!1);Sanitizers.checkIsSameExt_(e,"css").onFail_(e=>{t.warn_(e),i(!1)}).onOK_(t=>{i(!0),s(t)})})}).show_()}_actionEditLink1(t,e,i,n,s){if(null==n)return e.removeAttribute(i),void this.refresh();const o=n.toString();host$.linkInfo_(s.toString(),o,s=>{const l=toasters$.warn_(s)?LinkInfoStatus.INVALID:s[Key.linkinfo];null!=this._linkStatus&&(this._linkStatus[o]=l),e.setAttribute(i,o),this._updateNameValue(t,l,i,HumanLink.fromUri_(n).humanHref$)})}_actionAdd(){const t=this._editok(),e=native$.getIFrameUri_(),[i,n]=this._getlinkinfoOf(t);if(null==t||null==e||null==i)return;if(!("HEAD"==i[LinkInfoKey.tag])&&!n)return void toasters$.warnKey_(RS.ActionNotPermitted);let s,o=native$.getIFrameContextPath_();s=null==o?HumanLink.fromFilepath_(PathUtil.getHomeDir(mainPanel$.isLoggedIn())+"XXX.css"):HumanLink.fromHref_(Basepath.nameWithoutSuffix_(o)+".css"),_Util.promptCssOutputUrl_(RS.AddStylesheetTitle,MSG.string_(RS.AddStylesheetMessage),s,FilepickerKind.WRITE_FILE,e,RS.PlaceholderRequiredUrl).onOK_((i,s,o)=>{Sanitizers.checkRequiredHref_(s,e).onFail_(t=>{o(!1),i.warn_(t)}).onOK_(e=>{const s=An.fileExtFromUri_(e);if("css"!=s)return i.warn_(MSG.string1_(RS.ExpectingCSSExt_,null!=s?s:"")),void o(!1);const l=An.cpathOfUri_(e);if(null==l||!this._addcssok(l))return i.warn_([MSG.string_(RS.InvalidDestination),l]),void o(!1);o(!0),this._actionAddStylesheet(t,e.toString(),l,n)})}).show_()}_addcssok(t){return t=An.apath_(t),PathUtil.isDocumentsSubtree(t)||PathUtil.isBackupsSubtree(t)||t.startsWith(PATH._assetsTemplates_)||t.startsWith(PATH._assetsManual_)||t.startsWith(PATH._assetsClient)||t.startsWith(PATH._assetsCore)}_isClientCss(t){return(t=An.apath_(t)).startsWith(PATH._assetsClient)}_actionAddStylesheet(t,e,i,n){(new FilepickerHandler).fileInfo_(i,s=>{const o=FileInfo.of_(s[Key.fileinfo]);toasters$.warn_(s)||null==o||(o.exists$?this._actionAddStylesheet1(t,"stylesheet",MimeUtil.CSS,e,i,n):host$.saveCSS_(i,"",null,s=>{toasters$.warn_(s)||Timer.sleep0_(()=>{this._actionAddStylesheet1(t,"stylesheet",MimeUtil.CSS,e,i,n)})}))})}_actionAddStylesheet1(t,e,i,n,s,o){const l={rel:e,href:n};if(null!=i&&(l.type=i),o){const t=native$.getIFrameDocument_();if(null!=t){const e=t.head;new DomBuilderEx(e).childBefore_(e.firstChild,"LINK",l)}}else{const[e]=this._getlinkinfoOf(t),i=null==e?void 0:e[LinkInfoKey.targetpath],n=DomUt.asHTMLElement_(null==i?null:native$.getIFrameNodeByPath_(i,!0));if(null==n)return void toasters$.warnKey_(RS.TargetNodeNotExists);new DomBuilderEx(n).siblingAfter_("LINK",l)}this.refresh()}_actionRemove(){const t=this._editok(),e=native$.getIFrameUri_(),[i,n]=this._getlinkinfoOf(t);if(null==t||null==i||null==e)return;const s=i[LinkInfoKey.targetpath],o=DomUt.asHTMLElement_(null==s?null:native$.getIFrameNodeByPath_(s,n));if(null==o)return void toasters$.warnKey_(RS.TargetNodeNotExists);if(n&&"LINK"==o.nodeName){const t=o.getAttribute("href");if(null!=t){let i;const n=o.getAttribute("rel");if("stylesheet"==n){const n=An.cpathOfHref2_(e,t);if(null==n)i=[MSG.string_(RS.ConfirmUnlinkStylesheet),t];else{const t=this._isClientCss(n);(i=[MSG.string_(t?RS.ConfirmUnlinkDefaultStylesheet:RS.ConfirmUnlinkStylesheet)]).push(n)}}else i="next"==n?[MSG.string_(RS.ConfirmDeletingNextPageLink),t]:"prev"==n?[MSG.string_(RS.ConfirmDeletingPrevPageLink),t]:[t];return void DialogUt.confirm_(accessories$,i,t=>{t&&this._actionRemove1(o)}).zindex_(DEF.zindexConfirm).showWarning_()}}const l=i[LinkInfoKey.tag];_Util.confirmSmall_(MSG.format1_(RS.confirmDeletingElement,null!=l?l:""),DEF.zindexConfirm,t=>{t&&this._actionRemove1(o)})}_actionRemove1(t){JsUtil.remove_(t),this.refresh()}_editok(t=!0){return null!=this._selected&&mainPanel$.isEditing()?this._selected:(t&&toasters$.warnKey_(RS.ActionNotPermitted),null)}static _openCSS(t,e){sidePanel$.hideSidepanel_(),host$.readCSS_(t,i=>{var n;if(toasters$.warn_(i))return;const s=i[Key.result],o=null!==(n=i[Key.status])&&void 0!==n?n:null,l=new CSSEditor(accessories$,gestureHandler$,t,e,e,s.trim(),o);l.zindex_(DEF.zindexPrompt),l.show_()})}_openStylesheetOK(t,e){var i;return null!=t&&(e&&"LINK"==t[LinkInfoKey.tag]&&"href"==t[LinkInfoKey.name$]&&".css"==Basepath.lcSuffix_(null!==(i=t[LinkInfoKey.value])&&void 0!==i?i:""))}_select(t,e){t.classList.toggle(CSS.AnSelected)?(this._unselect(),this._selected=t,null!=e&&native$.iSelectNodeByPath_(e,!0,!0)):this._selected=null}_unselect(){null!=this._selected&&(this._selected.classList.remove(CSS.AnSelected),this._selected=null)}_actionOpenStylesheet(){const t=this._selected;if(null==t)return void toasters$.warnKey_(RS.ActionRequireASingleElementSelection);const e=native$.getIFrameUri_(),[i,n]=this._getlinkinfoOf(t);if(null==e||null==i||!this._openStylesheetOK(i,n))return void toasters$.warnKey_(RS.InvalidSelection);const s=i[LinkInfoKey.value],o=An.cpathOfHref2_(e,s);null!=o&&null!=s?fileinfoUt$.fileInfo_(o,t=>{if(toasters$.warn_(t))return;const e=FileInfo.of_(t[Key.fileinfo]);null!=e&&e.exists$?_DocumentLinksPanel._openCSS(o,e.writable$):toasters$.warnKey_(RS.FileNotFound)}):toasters$.warnKey_(RS.InvalidSelection)}_filter(){this._populate(new StepTimer)}_populate(t){t.debug_("# DocumentLinksPanel.refresh(): populate start"),new DomBuilderEx(this._content).empty_();const e=this._linkInfos,i=this._linkStatus;null!=e&&null!=i&&(this._populateOutlineTree(e,i),t.debug_("# DocumentLinksPanel.refresh(): populate end"))}_populateOutlineTree(t,e){const i=DomBuilderEx.offline1_(this.element_().ownerDocument,"div",CSS.AnViewportContent).push_(),n=i.cursor_();i.div1_(CSS.AnTextList,CSS.AnZebra).push_();const s=t[LinkInfoKey.HEAD];this._populateOutlineSection(i,s,e,!0);const o=t[LinkInfoKey.BODY];this._populateOutlineSection(i,o,e,!1),new DomBuilderEx(this._content).empty_().appendNodes_(n),An.addClickListenerMatching_(n,`.${CSS.AnTextList}>div`,(t,e)=>{An.stopevent_(e);const[i]=this._getlinkinfoOf(t),n=null==i?void 0:i[LinkInfoKey.targetpath];null!=n&&n instanceof Array?this._select(t,n):(native$.iClearSelection_(),this._unselect()),this._updateToolbarState()})}_populateOutlineSection(t,e,i,n){t.peek_().div2_(ATTR.AnInfo,JSON.stringify([!0,-1])).span1_(CSS.AnSec).text_(n?"HEAD":"BODY");const s=this._filterbox.value.trim().toLowerCase();null==e||e.forEach((e,o)=>{const l=e[LinkInfoKey.value],a=i[l];(!this._showBrokenOnly||null!=a&&a!=LinkInfoStatus.EXISTS)&&(s.length>0&&!l.toLowerCase().includes(s)||this._populateOutlineItem(t,n,o,e,a))})}_populateOutlineItem(t,e,i,n,s){if(null==n)return void t.peek_().div_().span1_(CSS.AnErr).text_("Error");const o=n[LinkInfoKey.tag],l=n[LinkInfoKey.rel];if("LINK"==o&&(null==l||"stylesheet"!=l.toLowerCase()))return;t.peek_().div2_(ATTR.AnInfo,JSON.stringify([e,i])).indent_(t.push_().span1_(CSS.AnTag).text_(o),null!=l?t.peek_().text_("").span1_(CSS.AnTxt).text_(l):t,t.pop_().text_("").span1_(CSS.AnAtt));const a=n[LinkInfoKey.name$],r=n[LinkInfoKey.value];this._createlink(t,s,a,r)}_updateNameValue(t,e,i,n){const s=DomUt.query_(t,`span.${CSS.AnAtt}`);if(null==s)return;const o=new DomBuilderEx(s).empty_();this._createlink(o,e,i,n)}_createlink(t,e,i,n){let s=CSS.AnLnk,o=n;"name"==i||(n.startsWith("data:")?o=An.truncate_(n,DEF.maxNodeInfoLen):(o=HumanLink.fromHref_(n).humanHref$,LinkInfoStatus.NOTEXISTS==e?s+=" "+CSS.AnNot:LinkInfoStatus.EXISTS!=e&&(s+=" "+CSS.AnErr))),this._createlink1(t,s,i,o)}_createlink1(t,e,i,n){t.text_(` ${i} (`).span2_("class",e).text_(n).up_().text_(")")}_getlinkinfoOf(t){const e=null==t?null:An.parseJSONOrNull_(t.getAttribute(ATTR.AnInfo));return null==e?[e,!1]:[this._getlinkinfo(e[0],e[1]),e[0]]}_getlinkinfo(t,e){var i,n;const s=null!==(n=null===(i=this._linkInfos)||void 0===i?void 0:i[t?LinkInfoKey.HEAD:LinkInfoKey.BODY])&&void 0!==n?n:null;return null==s||e<0?null:s[e]}}_DocumentLinksPanel._ADD="a",_DocumentLinksPanel._REMOVE="R";class _DocumentStylesPanel extends DocumentPanelBase{constructor(t){super(),this._container=t,this._target=null,this._contextmenu=null,this._rateLimiter=new FireLimiter(DEFUtil.filterDelay$),this._selected=null,this._toolbar=new Toolbar(t,[INPUT.info_(INPUT.FilterBox),BUT.info_(BUT.ClearSearchText),BUT.info_(BUT.RulesetEdit)]),this._toolbar.onAction_(t=>this._toolbarActions(t)),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._toolbar.enableButton_(BUT.RulesetEdit,!1),this._content=new DomBuilderEx(t).div1_(CSS.AnContentViewport).cursor_(),this._filterbox=this._toolbar.querySelector_(Conf.input),An.onInputFocusSelect_(this._filterbox),An.onInputEnterKey_(this._filterbox,()=>{this._actionFilter()}),An.onInput_(this._filterbox,()=>{this._rateLimiter.queue_(()=>{if(null!=this._target){const t=new StepTimer;this._populate(t,this._target)}})})}element_(){return this._container}show_(){if(!this._shown){const t=new StepTimer;t.debug_("# DocumentStylesPanel.show(): start"),this._shown=!0,An.showHidden_(this._container),this.resizeContent_(window.innerHeight-cache$.ui$.toolbarHeight_()),this.refresh(),An.setVisible_(this._container),t.debug_("# DocumentStylesPanel.show(): end")}}hide_(){this._shown&&(this._shown=!1,this.hideContextmenu_(),An.hide_(this._container),new DomBuilderEx(this._content).empty_())}showContextmenu_(t){null!=this._contextmenu&&this._contextmenu.show_(t)}hideContextmenu_(){null!=this._contextmenu&&this._contextmenu.hide_()}onWindowSizeChanged_(){}refresh(){const t=new StepTimer;if(t.debug_("# DocumentStylesPanel.refresh(): start"),this._selected=null,null==docInfo$||!docInfo$.isHtml$)return void this._disablePanel();const e=native$.getNearestSelectedElement_();null!=e?(this._populate(t,e),t.debug_("# DocumentStylesPanel.refresh(): end")):this._disablePanel()}_disablePanel(){new DomBuilderEx(this._content).empty_(),this._toolbar.showHidden_()}resizeContent_(t){if(this._shown){const e=t-cache$.ui$.toolbarHeight_()-DEF.sidepanelMarginBottom;this._content.style.height=`${e}px`}}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.ClearSearchText:this._filterbox.value="",null!=this._target&&this._populate(new StepTimer,this._target);break;case BUT.RulesetEdit:null!=this._selected&&this._edit(this._selected);break;default:throw Assert.notReach_(t)}}_actionFilter(){null!=this._target&&this._populate(new StepTimer,this._target)}_populate(t,e){t.debug_("# DocumentStylesPanel.refresh(): populate start");const i=native$.getIFrameUri_();if(null==e||null==i)return void this._disablePanel();const n=native$.getComputedStyles_(e),s=e.getAttribute(ATTR.style);null==s||0==s.length?this._populate1(t,e,n,{},i):cssParser$.sanitizeStyle_(s,i,s=>{const o=s[Key.style];this._populate1(t,e,n,o,i)})}_populate1(t,e,i,n,s){this._populateOutlineTree(e,i,n,s),this._updateToolbarState(),this._toolbar.show_(),t.debug_("# DocumentStylesPanel.refresh(): populate end")}_populateOutlineTree(t,e,i,n){this._target=t;const s=new DomBuilderEx(this._content).empty_(),o=t.nodeName;if(An.isBodyElement_(o))return;const l=DomBuilderEx.offline1_(t.ownerDocument,"div",CSS.AnViewportContent).push_(),a=l.cursor_();l.div1_(CSS.AnTextList,CSS.AnZebra).push_().cursor_();const r=_OutlineUtil.getNodeInfo_(t,n);l.peek_().div_().push_().span1_(CSS.AnSec).text_(o).pop_(),r.length>0&&(l.span1_(CSS.AnAtt),l.text_(""),l.text_(r)),this._populateStyles(l,this._filterbox.value,e,i,n),s.appendNodes_(a),An.addClickListenerMatching_(a,`div.${CSS.AnTextList}>div`,(t,e)=>{An.stopevent_(e),null==t.getAttribute(ATTR.AnInfo)?this._unselect():this._select(t),this._updateToolbarState()})}_select(t){t.classList.toggle(CSS.AnSelected)?(this._unselect(),this._selected=t):this._selected=null}_unselect(){return null!=this._selected&&(this._selected.classList.remove(CSS.AnSelected),this._selected=null,!0)}_populateStyles(t,e,i,n,s){const o=0!=(e=e.trim().toLowerCase()).length,l=new Set,a=new Set;for(let t=0,e=i.length;t<e;++t){const e=i[t];e.startsWith("-")?l.add(e):a.add(e)}for(const t of a)l.delete(DEF.webkitPrefix+t);const r=o?Ut.codepoints_(e):[];for(const e of[a,l])for(const l of e){let e=i.getPropertyValue(l);if(null==e)continue;const a=n[l];a&&a.length>0&&(e=a),e=CSSUtil.humanCSSUrls_(e,s),(!o||An.fuzzyMatch1_(r,l.toLowerCase())||An.fuzzyMatch1_(r,e.toLowerCase()))&&t.peek_().div2_(ATTR.AnInfo,l).span1_(CSS.AnTag).text_(l).up_().text_(":").child1_(a?"b":"span",CSS.AnAtt).text_(e)}}_edit(t){var e,i,n,s;if(!mainPanel$.isEditing()||null==this._target)return;const o=native$.getIFrameUri_(),l=null===(i=null===(e=t.querySelector(`.${CSS.AnTag}`))||void 0===e?void 0:e.textContent)||void 0===i?void 0:i.trim(),a=null===(s=null===(n=t.querySelector(`.${CSS.AnAtt}`))||void 0===n?void 0:n.textContent)||void 0===s?void 0:s.trim();if(null==l||null==a||null==o)return;const r=this._target.nodeName;Html5.canEditTag(r)?this._editStyleProperty(l,a,o,()=>{if(null!=this._target){const t=new StepTimer;this._populate(t,this._target)}}):toasters$.warn_(MSG.string1_(RS.elementNotEditable_,r))}_editStyleProperty(t,e,i,n){if(null==this._target)return;const s=native$.getIFrameContextPath_();if(null==i||null==s)return;const o=this._target.nodeName,l=this._target.getAttribute(ATTR.xAnnotation),a=this._target.style.width,r=this._target.style.height;e=CSSUtil.escCSSValue_(t,e),_Util.styleEditor_(accessories$,`${t}: ${e}`,s,i,DEF.zindexPrompt,toasters$,e=>{var s;const _=null!==(s=e[t])&&void 0!==s?s:"";history$.group_(RS.action_EditStyle,t,()=>{null!=this._target&&(native$.replaceStyle_(this._target,t,_),"IMG"==o&&native$.hasClass_(this._target,CSS.xCanvas)&&_MainPanel._rerenderCanvas(this._target,i,a,r,l,!1))}),n()}).onCancel_(n).show_()}_updateToolbarState(){const t=mainPanel$.isEditing()&&null!=this._selected;this._toolbar.enableButton_(BUT.RulesetEdit,t)}}class _DocumentPanel extends TabPanel{constructor(t){super(t),this._shown=!1,this._container=t,An.onContextmenu_(this._container,t=>{An.stopevent_(t)});const e=this.addTab(RS.Tooltips_DocumentOutline,`${CSS.Fa} ${CSS.FaThList}`,t=>new _DocumentOutlinePanel(t));this.addTab(RS.Tooltips_DocumentLinks,`${CSS.Fa} ${CSS.FaLink}`,t=>new _DocumentLinksPanel(t)),this.addTab(RS.Tooltips_DocumentStyles,`${CSS.Fa} ${CSS.FaStrikethrough}`,t=>new _DocumentStylesPanel(t)),this.onTooltips(toasters$.onTooltipsKey_),this.activeTab(e)}element_(){return this._container}show_(){this._shown||(this._shown=!0,An.showHidden_(this._container),this.resizeContent_(window.innerHeight),this.selectTab(this.activeTab()),An.setVisible_(this._container))}refresh(){const t=this.activePanel();null!=t&&t instanceof DocumentPanelBase&&t.refresh()}hide_(){if(this._shown){this._shown=!1,An.hide_(this._container);const t=this.activePanel();null!=t&&t.hide_()}}destroy(){new DomBuilderEx(this._container).empty_()}showContextmenu_(){}hideContextmenu_(){const t=this.activePanel();null!=t&&t.hideContextmenu_()}onWindowSizeChanged_(){super.onWindowSizeChanged()}resizeContent_(t){super.resizeContent1(t,cache$.ui$.toolbarHeight_())}}class _FilesFinder{constructor(t,e){this._fromDir=t,this._searchText=e,this._searchResult=[],this._index=0}find_(t){host$.findFiles_(this._fromDir,this._searchText,e=>{if(toasters$.warn_(e))return this._searchResult=[],void(this._index=-1);this._searchResult=e[Key.result],this._index=-1,t(this)})}searchText_(){return this._searchText}hasNext_(){return this._index+1>=0&&this._index+1<this._searchResult.length}hasPrev_(){return this._index>0&&this._index<=this._searchResult.length}next_(){return this.hasNext_()?this._searchResult[++this._index]:null}prev_(){return this.hasPrev_()?this._searchResult[--this._index]:null}index_(){return this._index}resultCount_(){return this._searchResult.length}reset_(){this._index=0}}class _FilesPanel extends FilepickerBase{constructor(t){super(accessories$,"",fileinfoUt$),this._top=t,_toolbar_1.set(this,void 0),_searchbar_1.set(this,void 0),_searchbox_1.set(this,void 0),_finder.set(this,null),_shown_2.set(this,!1),this._create(),this.onPaste(Callbacks.pasteFromClipboard_),this.onCopy(Callbacks.copyToClipboard_)}_create(){const t=new StepTimer;t.debug_("# ExploreFilesPanel.create(): start");const e=new DomBuilderEx(this.element_()).push_();__classPrivateFieldSet(this,_toolbar_1,new Toolbar(e.cursor_(),[BUT.info_(BUT.OpenDocument),BUT.info_(BUT.PickImage),BUT.info_(BUT.Clear),BUT.info_(BUT.CurrentDocument),BUT.info_(BUT.Contextmenu)])),__classPrivateFieldGet(this,_toolbar_1).onAction_((t,e)=>this._toolbarActions(t,e)),__classPrivateFieldGet(this,_toolbar_1).onTooltips_(toasters$.onTooltipsKey_),__classPrivateFieldSet(this,_searchbar_1,new Toolbar(e.cursor_(),[INPUT.searchbox(RS.Tooltips_SearchFilename,"1"),BUT.info_(BUT.NextMatch),BUT.info_(BUT.PrevMatch),BUT.info_(BUT.Contextmenu)])),__classPrivateFieldGet(this,_searchbar_1).onAction_((t,e)=>this._toolbarActions(t,e)),__classPrivateFieldGet(this,_searchbar_1).onTooltips_(toasters$.onTooltipsKey_),e.peek_().div1_(CSS.AnContentPanel).cursor_(),e.div_({class:CSS.AnFilesPanel}).push_(),this._createFilepicker(e),__classPrivateFieldSet(this,_searchbox_1,__classPrivateFieldGet(this,_searchbar_1).querySelector_(Conf.input)),__classPrivateFieldGet(this,_searchbar_1).hide_(),__classPrivateFieldGet(this,_searchbox_1),An.onFocus_(__classPrivateFieldGet(this,_searchbox_1),()=>{Timer.sleep0_(()=>{__classPrivateFieldSet(this,_finder,null),this._updateSearchbarState()})}),An.onKeypress_(__classPrivateFieldGet(this,_searchbox_1),t=>{"Enter"==t.key&&(this._actionFind(),An.stopevent_(t))}),An.onInput_(__classPrivateFieldGet(this,_searchbox_1),()=>{__classPrivateFieldSet(this,_finder,null),this._updateSearchbarState()}),An.onKeypress_(this.element_(),t=>{!t.ctrlKey||"f"!=t.key&&"F"!=t.key||(An.stopevent_(t),t.shiftKey?this._showMainbar():this._showSearchbar())}),this.element_().addEventListener("contextmenu",t=>{An.stopevent_(t)}),this.setupEventHandlers(),t.debug_("# ExploreFilesPanel.create(): end")}_createFilepicker(t){const e=t.peek_().child_(Conf.input,INPUT.info_(INPUT.Filename)).cursor_();t.peek_().div_({class:CSS.AnDirpath,style:"padding-left:0;"}).push_();const i=t.div_(["class",`${CSS.AnFlexButton} ${CSS.AnLink} ${CSS.Fa} ${CSS.FaBookmarkO}`],["style","align-self:baseline"],[ATTR.xTooltips,RS.Tooltips_RootFolder]).cursor_(),n=t.pop_().div1_(CSS.AnDirpathDir).cursor_(),s=t.peek_().div1_(CSS.AnDirtree).cursor_();this.populateFilepicker_(i,e,null,n,s)}element_(){return this._top}toClipboard_(t){clipboard$.string_(t),host$.copyToClipboard_(t,An.noop_)}fileDateString_(t,e){if(null==e)return"";const i=DateTime.fromMillisecondsSinceEpoch_(e);return i.isAfter_(t)?""+settings$.shortDateString_(i)+"":""+An.to04d_(i.year$)+""}updateContextmenuState_(){With.optional_(this.contextmenu$,t=>{const e=__classPrivateFieldGet(this,_toolbar_1).isShown_(),i=t.button_(BUT.Searchbar).classList;i.remove(e?CSS.FaEllipsisH:CSS.FaSearch),i.add(e?CSS.FaSearch:CSS.FaEllipsisH),super.updateContextmenuState_()})}updateContextmenuStateWithFilename(t,e,i,n){With.optional_(this.contextmenu$,s=>{const o=null==i?null:Basepath.lcExt_(i.name_()),l=PathUtil.isDocumentsTree(n),a=null!=e&&e.writable$,r=null!=i&&i.exists$;s.enableButtons_([BUT.Nobackup,BUT.OpenDocument,BUT.ImportImageFromPhotoLibrary,BUT.TakePhoto,BUT.RecordAudio,BUT.RecordVideo],a),s.enableButtons_([BUT.Recover],l&&a||"/"==n||""==n),s.enableButton_(BUT.ExportToPhotoLibrary,!1),s.enableButton_(BUT.Preview,r&&MimeUtil.isSharableLcExt(o)),super.updateContextmenuStateWithFilename(t,e,i,n)})}updateContextmenuStateWithoutFilename(t,e,i){With.optional_(this.contextmenu$,n=>{const s=null!=e&&e.writable$,o=PathUtil.isDocumentsTree(i);n.enableButtons_([BUT.Nobackup,BUT.OpenDocument,BUT.ImportImageFromPhotoLibrary,BUT.TakePhoto,BUT.RecordAudio,BUT.RecordVideo],s),n.enableButtons_([BUT.Recover],o&&s||"/"==i||""==i),n.enableButton_(BUT.ExportToPhotoLibrary,!1),n.enableButton_(BUT.Preview,!1),super.updateContextmenuStateWithoutFilename(t,e,i)})}createContextmenu_(){const t=new Contextmenu(accessories$,DEF.zindexContextmenu,[[BUT.info_(BUT.CopyFile),BUT.info_(BUT.CutFile),BUT.info_(BUT.PasteFile),BUT.info_(BUT.CloneFile)],[BUT.info_(BUT.DeleteFile),BUT.info_(BUT.DeleteEmptyDirs),BUT.info_(BUT.Mkdir),BUT.info_(BUT.RenameFile)],[BUT.info_(BUT.ImportImageFromPhotoLibrary),BUT.info_(BUT.ExportToPhotoLibrary),BUT.info_(BUT.Nobackup),BUT.info_(BUT.CurrentDocument)],[BUT.info_(BUT.Noop),BUT.info_(BUT.Recover),BUT.info_(BUT.Preview),BUT.info_(BUT.OpenDocument)],[BUT.info_(BUT.Noop),BUT.info_(BUT.TakePhoto),BUT.info_(BUT.RecordVideo),BUT.info_(BUT.RecordAudio)],[BUT.info_(BUT.Noop),BUT.info_(BUT.GenerateGallery),BUT.info_(BUT.ImageConversion),BUT.info_(BUT.Searchbar)]]);return t.onAction_((t,e,i)=>this._contextActions(t,e,i)),t.onDrag_(Contextmenu.contextmenuDragOK_),t.onShow_(()=>this.updateContextmenuState_()),t.onTooltips_(toasters$.onTooltipsKey_),t}onFileInfo_(t){const e=this.currentPath_(t);sidePanel$.hideSidepanel_();const i=Basepath.lcExt_(t);null==MimeUtil.audioPlaybackMimeFromLcExt(i)?null==MimeUtil.videoMimeFromLcExt(i)?i!=DEF.css?_Util.onSaveOrDiscard_(()=>{_Util.browseFile_(e)}):this._handler.fileInfo_(e,t=>{if(toasters$.warn_(t))return;const i=FileInfo.of_(t[Key.fileinfo]),n=null!=i&&i.writable$;_FilesPanel._openCSS(e,n)}):host$.playVideo_(e,!1,null,0,t=>{toasters$.warn_(t)}):_AudioPlayerDialog.createAndShow_(accessories$,e)}renameDir_(t){const e=Basepath.nameWithSuffix_(t),i=this.promptSimpleName_(RS.RenameTitle,MSG.string_(RS.RenameMessage),e,(i,n,s)=>{n=n.trim(),i.warn_(FilepickerBase.renameDirValidator(n,e))?s(!1):(s(!0),this.rename1_(t,n))});i.zindex_(DEF.zindexPrompt),i.show_()}renameFile_(t){const e=new Basepath(t);this.promptRename1_(RS.RenameTitle,MSG.string_(RS.RenameMessage),e.dir$,e.nameWithSuffix$,(t,i)=>{this.renameFileValidator(t,e,i)},e=>{var i;const n=this.dirtreeFind(e);if(null!=n&&n.exists$&&!n.isdir$){const n=Basepath.joinPath_(null!==(i=Basepath.dir_(t))&&void 0!==i?i:"",e);this._handler.delete_(n,i=>{toasters$.warn_(i)||this.rename1_(t,e)})}else this.rename1_(t,e)}).show_()}rename1_(t,e){this._handler.rename_(t,e,t=>{toasters$.warn_(t)||this.refresh_(t)})}pasteFile1_(t,e,i,n,s,o,l){this.promptRename1_(RS.PromptPasteTitle,i,n,s,(t,e)=>{this.pasteFileValidator(t,n,o,e)},i=>{const s=null==n?i:Basepath.joinPath_(n,i);this._handler.copy_(t,e,s,o,null,l)}).show_()}promptRename1_(t,e,i,n,s,o){return _Util.promptBasename_(t,e,i,n,(t,e,i)=>{s(e,(e,n)=>{t.warn_(e)?i(!1):(i(!0),o(n))})})}updateToolbarState_(t){if(null==t)return;let e=!1;for(const i of t)if(MimeUtil.isImagePath(i.name_())&&i.readable$){e=!0;break}__classPrivateFieldGet(this,_toolbar_1).enableButton_(BUT.PickImage,e),__classPrivateFieldGet(this,_toolbar_1).showButton_(BUT.OpenDocument,!0)}onWindowSizeChanged_(){this.recreateContextmenu_()}show_(){if(!__classPrivateFieldGet(this,_shown_2)){__classPrivateFieldSet(this,_shown_2,!0),null==this.dirtreePanel$&&this._create(),this._showPanel();let t=null==this.currentDirInfo_()?native$.getIFrameContextPath_():this.currentPath_(this.getFilename());null==t&&(t=""),this._handler.listDir_(t,e=>{toasters$.warn_(e)?this._handler.listDir_("",e=>{e[Key.filename]=Basepath.nameWithSuffix_(null!=t?t:""),this.refresh_(e)}):this.refresh_(e)})}}hide_(){__classPrivateFieldGet(this,_shown_2)&&(__classPrivateFieldSet(this,_shown_2,!1),this._hidePanel())}resizeContent_(t){if(__classPrivateFieldGet(this,_shown_2)){const t=An.documentOffset_(this.dirtreePanel$).y,e=window.innerHeight-t-12-DEF.sidepanelMarginBottom,i=this.dirtreePanel$.style;i.height=`${e}px`,i.maxHeight=`${e}px`}}_toolbarActions(t,e){switch(toasters$.hideAll_(),t){case BUT.Clear:this.setFilename(""),this.deselect_();break;case BUT.OpenDocument:this._actionOpenDocument(e);break;case BUT.CurrentDocument:this._actionCurrent();break;case BUT.PickImage:this.actionPickImage();break;case BUT.Contextmenu:Timer.sleep1_(()=>{this.showContextmenu_(e)});break;case BUT.NextMatch:if(null==__classPrivateFieldGet(this,_finder))this._actionFind();else{const t=__classPrivateFieldGet(this,_finder).next_();if(null!=t){this._handler.listDir_(t,t=>{this.refresh_(t)});const e=__classPrivateFieldGet(this,_finder).index_(),i=__classPrivateFieldGet(this,_finder).resultCount_();toasters$.info_(`${e+1}/${i}`,{attop:!0})}else toasters$.warnKey_(RS.NoMoreMatches),__classPrivateFieldGet(this,_finder).reset_()}this._updateSearchbarState();break;case BUT.PrevMatch:if(null==__classPrivateFieldGet(this,_finder))this._actionFind();else{const t=__classPrivateFieldGet(this,_finder).prev_();if(null!=t){this._handler.listDir_(t,t=>{this.refresh_(t)});const e=__classPrivateFieldGet(this,_finder).index_(),i=__classPrivateFieldGet(this,_finder).resultCount_();toasters$.info_(`${e+1}/${i}`,{attop:!0})}else toasters$.warnKey_(RS.NoMoreMatches),__classPrivateFieldGet(this,_finder).reset_()}this._updateSearchbarState();break;default:throw Assert.notReach_(t)}}_actionRecover(){let t=this.filenameInput$.value.trim();0!=t.length?this._handler.fileInfo1_(toasters$,this.currentPath_(t),e=>{e.isfile$?this._actionRecover1(this.currentPath_(t)):this._actionRecover1(this.currentPath_(t)+"/")}):this._actionRecover1(this.currentDir$+"/")}_actionRecover1(t){new HistoryFilepicker(accessories$,t,gestureHandler$,fileinfoUt$,historyFileinfoUt$,settings$.dateFormat_(),settings$.timeFormat_()).zindex_(DEF.zindexPrompt).onOK_(t=>{this._handler.listDir_(t,t=>{this.refresh_(t)})}).onCancel_(()=>{this.refreshCurrentDir_()}).show_()}_actionOpenDocument(t){const e=this.filenameInput$.value.trim();let i=this.currentDir$;e.length>0&&(i=this.currentPath_(e));const n=Basepath.dir_(i);null!=n?this._handler.fileInfo_(i,e=>{if(toasters$.warn_(e))return;const s=FileInfo.of_(e[Key.fileinfo]);if(null==s)return;if(s.isdir$)return s.writable$?void _Util.onSaveOrDiscard_(()=>{_FilesPanel._newpage1(t,!0,i)}):void toasters$.warn_(MSG.string_(RS.DestinationNotWritable)+": "+i);const o=Basepath.lcExt_(i),l="html"==o,a="css"==o,r=s.writable$;s.exists$?_Util.onSaveOrDiscard_(()=>{a?_FilesPanel._openCSS(i,r):_FilesPanel._openpage1(i,l&&r)}):this._handler.fileInfo_(n,e=>{if(toasters$.warn_(e))return;const s=FileInfo.of_(e[Key.fileinfo]);null!=s&&!s.notexists$&&s.writable$?_Util.onSaveOrDiscard_(()=>{a?_FilesPanel._newCSS(i,!0):(l||(i+=".html"),_FilesPanel._newpage1(t,!1,i))}):toasters$.warn_(MSG.string_(RS.DestinationNotWritable)+": "+n)})}):toasters$.warnKey_(RS.InvalidPath)}_actionNobackup(){host$.toggleNobackup_(this.currentDir$,t=>{toasters$.warn_(t)||(_Util.toastOnOffButton_(MSG.string_(RS.Backup),!t[Key.status]),this.refresh_(t))})}_actionCurrent(){const t=native$.getIFrameContextPath_();null==t?toasters$.warnKey_(RS.InvalidDocument):this._handler.listDir_(t,t=>this.refresh_(t))}_actionFind(){const t=__classPrivateFieldGet(this,_searchbox_1).value;if(0==t.length)return __classPrivateFieldSet(this,_finder,null),void this._actionCurrent();__classPrivateFieldSet(this,_finder,new _FilesFinder(this.currentDir$,t)),__classPrivateFieldGet(this,_finder).find_(t=>{__classPrivateFieldGet(this,_searchbox_1).blur(),host$.hideKeyboard_(()=>{const e=t.resultCount_();toasters$.info_(e>1?`${e} matches`:`${e} match`,{attop:!0});const i=t.next_();null!=i&&this._handler.listDir_(i,t=>{this._updateSearchbarState(),this.refresh_(t)})})})}static _openpage1(t,e){sidePanel$.hideSidepanel_(),e&&mainPanel$.addIFrameReadyOneshotCallback(t=>mainPanel$.startEditCallback(t)),_Util.browseFile_(t)}static _newpage1(t,e,i){const n=new PageContextmenu(accessories$);n.onAction_(t=>{n.destroy_(),_FilesPanel._newpage2(t,e,i)}),n.onCancel_(()=>{n.destroy_()}),n.show_(t.pageX,t.pageY)}static _newpage2(t,e,i){if(!e)return void _FilesPanel._newpage3(t,i);const n=settings$.htmlTemplatesByName_().get(t),s=void 0===n?null:_Util.defaultNewPageFilename_(n);null!=s?_Util.newPageFromTemplate1_(Basepath.joinPath_(i,s),t):toasters$.warn_(MSG.string_(RS.InvalidTemplate)+": "+t)}static _newpage3(t,e){sidePanel$.hideSidepanel_(),e.endsWith(".html")||(e+=".html"),host$.addPage_(e,t,t=>{toasters$.error_(t)||(mainPanel$.addIFrameReadyOneshotCallback(t=>mainPanel$.startEditCallback(t)),_Util.browseFile_(e))})}static _openCSS(t,e){sidePanel$.hideSidepanel_(),host$.readCSS_(t,i=>{var n;if(toasters$.warn_(i))return;const s=i[Key.result],o=null!==(n=i[Key.status])&&void 0!==n?n:null,l=new CSSEditor(accessories$,gestureHandler$,t,e,!1,s.trim(),o);l.zindex_(DEF.zindexPrompt),l.show_()})}static _newCSS(t,e){sidePanel$.hideSidepanel_(),host$.saveCSS_(t,"",null,i=>{toasters$.error_(i)||_FilesPanel._openCSS(t,e)})}_checkExportable(t,e,i,n){if(An.isempty_(e))return void toasters$.warnKey_(RS.PleaseSpecifyAFilename);if(!i(Basepath.lcExt_(e)))return void toasters$.warn_(MSG.string1_(RS.MediaTypeNotSupported,e));const s=Basepath.joinPath_(t,e);fileinfoUt$.fileInfo_(s,t=>{if(toasters$.warn_(t))return;const i=FileInfo.of_(t[Key.fileinfo]);null!=i&&i.exists$?n(s):toasters$.warn_([MSG.string_(RS.FileNotFound),e])})}_preview(){const t=this.filenameInput$.value.trim();this._checkExportable(this.currentDir$,t,t=>MimeUtil.isSharableLcExt(t),t=>{host$.actionPreview_(t)})}_importFromPhotoLibrary(){fileinfoUt$.checkDirWritable1_(toasters$,this.currentDir$,t=>{!t.exists$||t.writable$?this._importFromPhotoLibrary1(this.currentDir$):toasters$.warnKey_(RS.DestinationNotWritable)})}_importFromPhotoLibrary1(t){this.hideContextmenu_();const e=new Imagepicker(accessories$,RS.ImportImageTitle,gestureHandler$,new PhotoLibraryImageInfoHandler);e.above_(sidePanel$.sidepanel$),e.onView_((t,e,i)=>{const n=e.isVideo_();host$.viewPhotoLibraryThumbnail_(DEF.previewPhotoSize,e,s=>{if(toasters$.warn_(s))return;const o=s[Key.result],l=new ImageViewer(accessories$,cache$.ui$.buttonSize_(),o);l.above_(t,10),l.titleKey_(n?RS.Video:RS.Image),l.onImageInfo_(()=>{toasters$.modal_((t,i)=>new ImageInfoBuilder(t,i,settings$.dateFormat_(),e).build_())}),l.onCancel_(()=>{i(!1)}),l.onOK_(()=>{i(!0)}),l.show_()})}),e.onOK_(e=>{this._importFromPhotoLibrary2(t,e)}),e.show_()}_importFromPhotoLibrary2(t,e){e.isVideo_()?this._importVideoFromPhotoLibrary(t,e):this._importImageFromPhotoLibrary(t,null,e,()=>{})}_importImageFromPhotoLibrary(t,e,i,n){_Util.importImageFromPhotoLibrary_(t,e,i,DEF.zindexPrompt,n,(e,i)=>{toasters$.warn_(i)||toasters$.okKey_(RS.ImportImageOK,{attop:!0}),this._handler.listDir_(t,t=>this.refresh_(t))})}_importVideoFromPhotoLibrary(t,e){const i=e.mime_(),n=MimeUtil.videoExtFromMime(i);if(null==n)return void toasters$.warn_(MSG.string1_(RS.UnsupportedFileType_,null!=i?i:""));let s=PathUtil.getFilenameFromMediaInfo(e);s=null==s?"video-"+An.simpleDateTimeString_():Basepath.nameWithoutSuffix_(s)+"."+n;const o=_Util.promptBasename_(RS.Video,null,t,s,(i,n,s)=>{s(!0);const o=Basepath.joinPath_(t,n);host$.importVideoFromPhotoLibrary_(o,e.json_(),e=>{toasters$.warnErrorsOrResult_(e,RS.ImportOK),this._handler.listDir_(t,t=>this.refresh_(t))})});o.zindex_(DEF.zindexPrompt),o.show_()}actionPickImage(){const t=this.filenameInput$.value.trim(),e=new Imagepicker(accessories$,RS.PickImage,gestureHandler$,new LocalMediaInfoHandler(this.currentDir$,this._handler));e.above_(sidePanel$.sidepanel$),e.setFilename_(t),e.onResize_(()=>{e.cancel_()}),e.onView_(Callbacks.onViewLocalImage_),e.onOK_(t=>{var e;this.filenameInput$.value=null!==(e=t.title_())&&void 0!==e?e:""}),e.show_()}_contextActions(t,e,i){switch(toasters$.hideAll_(),t){case BUT.ImportImageFromPhotoLibrary:return void this._importFromPhotoLibrary();default:switch(this.hideContextmenu_(),t){case BUT.CurrentDocument:this._actionCurrent();break;case BUT.CopyFile:this.actionCopy();break;case BUT.CutFile:this.actionCutFile();break;case BUT.PasteFile:this.actionPaste(!1);break;case BUT.DeleteFile:this.actionDelete();break;case BUT.Mkdir:this.actionMkdir(sidePanel$.sidepanel$);break;case BUT.RenameFile:this.actionRename();break;case BUT.DeleteEmptyDirs:this.actionDeleteEmptyDirs();break;case BUT.OpenDocument:this._actionOpenDocument(e);break;case BUT.Nobackup:this._actionNobackup();break;case BUT.Recover:this._actionRecover();break;case BUT.Searchbar:const n=An.classlist_(i);n.contains_(CSS.FaSearch)?this._showSearchbar():this._showMainbar(),n.toggleAll_(CSS.FaSearch,CSS.FaEllipsisH);break;case BUT.ExportToPhotoLibrary:break;case BUT.Preview:this._preview();break;case BUT.TakePhoto:toasters$.error_(MSG.string_(RS.DesktopOperationTakePhotoNotAvailable));break;case BUT.RecordVideo:toasters$.error_(MSG.string_(RS.DesktopOperationRecordVideoNotAvailable));break;case BUT.RecordAudio:toasters$.error_(MSG.string_(RS.DesktopOperationRecordAudioNotAvailable));break;case BUT.GenerateGallery:this._actionGenerateGallery(e,()=>this.refreshCurrentDir_());break;case BUT.ImageConversion:this._actionImageConversion();break;case BUT.CloneFile:this.actionPaste(!0);break;case DEF.NOOP:break;default:throw Assert.notReach_(t)}}}_showSearchbar(){__classPrivateFieldGet(this,_toolbar_1).hide_(),__classPrivateFieldGet(this,_searchbar_1).show_(),this._updateSearchbarState(),Timer.sleep00_(()=>{__classPrivateFieldGet(this,_searchbox_1).focus(),host$.showKeyboard_()})}_showMainbar(){__classPrivateFieldGet(this,_searchbox_1).blur(),__classPrivateFieldGet(this,_searchbar_1).hide_(),__classPrivateFieldGet(this,_toolbar_1).show_()}_updateSearchbarState(){const t=An.classlist_(__classPrivateFieldGet(this,_searchbar_1).button_(BUT.NextMatch)),e=t.contains_(CSS.FaArrowCircleDown);(null==__classPrivateFieldGet(this,_finder)&&e||null!=__classPrivateFieldGet(this,_finder)&&!e)&&t.toggleAll_(CSS.FaArrowCircleDown,CSS.FaSearch),__classPrivateFieldGet(this,_searchbar_1).enableButton_(BUT.NextMatch,null!=__classPrivateFieldGet(this,_finder)&&__classPrivateFieldGet(this,_finder).hasNext_()||null==__classPrivateFieldGet(this,_finder)&&__classPrivateFieldGet(this,_searchbox_1).value.length>0),__classPrivateFieldGet(this,_searchbar_1).enableButton_(BUT.PrevMatch,null!=__classPrivateFieldGet(this,_finder)&&__classPrivateFieldGet(this,_finder).hasPrev_())}_actionGenerateGallery(t,e){_Util.onSaveOrDiscard_(()=>{const i=new GalleryContextmenu(accessories$);i.onAction_(t=>{i.destroy_();const n=settings$.htmlTemplatesByName_().get(t);void 0!==n&&new _GalleryGenerator(n,i.isRecursive(),i.isDescending(),i.isSingleSection(),this.currentDir$,this._handler).run_(),e()}),i.onCancel_(()=>{i.destroy_()}),i.show_(t.pageX,t.pageY)})}_actionImageConversion(){var t;const e=null===(t=this._dirtree)||void 0===t?void 0:t.filter(t=>MimeUtil.isImagePath(t.name_()));if(null==e||0==e.length)return void toasters$.warnKey_(RS.NoImageFound);const i=this.getFilename();new PromptImageConversion(accessories$,i,e).zindex_(DEF.zindexPrompt).onOK_(t=>{var e;if(0==t.length)return;const i=this.currentPath_(t[0]),n=null!==(e=native$.getIFrameDir_())&&void 0!==e?e:"/";host$.localImageThumbnail_(i,DEF.previewPhotoSize,DEF.jpegQuality,e=>{if(toasters$.warn_(e))return;const s=e[Key.result];_Util.promptOutputImage1_(i,n,0,0,DEF.jpegQuality,DEF.zindexPrompt+DEF.zindexAbove10,s,e=>{this._checkOverwrite(e.cpath,t,()=>{new Spinner(this._container).show_(i=>{host$.imageConversion_(this.currentDir$,t,e,t=>{var e,n;if(toasters$.warn_(t))return;const s=null!==(e=t[Key.result])&&void 0!==e?e:0,o=null!==(n=t[Key.fails])&&void 0!==n?n:0,l=MSG.format2_(RS.Result2,`${s}`,`${o}`);0==o?toasters$.ok_(l):toasters$.warn_(l),this.refreshCurrentDir_(),i.destroy_()})})})},t=>{t.show_()})})}).show_()}_checkOverwrite(t,e,i){const n=new Basepath(t),s=n.dir$;if(null==s)return void toasters$.warnKey_(RS.InvalidPath);const o=e.map(t=>Basepath.changeSuffix_(t,n.suffix$));fileinfoUt$.checkDirWritable1_(toasters$,s,()=>{fileinfoUt$.fileInfos_(s,o,t=>{if(toasters$.warn_(t))return;const e=t[Key.result],n=sarray_(),s=[MSG.string_(RS.DestinationNotValid)];for(const t of o){const i=FileInfo.of_(e[t]);null==i||i.notexists$||(i.isfile$?n.push(t):s.push(t))}s.length>1?toasters$.warn_(s):0!=n.length?DialogUt.confirmOverwriting_(n,t=>{t&&i()}):i()})})}_showPanel(){An.showHidden_(this.element_()),this._setDirtreeHeight(),An.setVisible_(this.element_())}_hidePanel(){this.hideContextmenu_(),An.hide_(this.element_())}_setDirtreeHeight(){const t=An.documentOffset_(this.dirtreePanel$).y,e=window.innerHeight-t-DEF.sidepanelMarginBottom,i=this.dirtreePanel$.style;i.height=`${e}px`,i.maxHeight=`${e}px`}}_toolbar_1=new WeakMap,_searchbar_1=new WeakMap,_searchbox_1=new WeakMap,_finder=new WeakMap,_shown_2=new WeakMap;class _GalleryGeneratorBase{constructor(t,e,i){this.idoc$=t,this.baseuri$=e,this.info$=i,this.sectionnames=sarray_(),this.itemkeys=sarray_(),this.result$=this.info$[Key.result],this.reverse$=this.info$[Key.backward];for(const[t,e]of Object.entries(this.result$)){this.sectionnames.push(t);for(const t of Object.keys(e))this.itemkeys.push(t)}}_imageInfo(t,e){var i;const n=FileStat.of_(e[Key.filestat]),s=null!==(i=null==n?void 0:n.date$)&&void 0!==i?i:null;if(t.push_(),null!=s){const e=t.span_().cursor_();An.setDatetime(e,new _PlaceholderDateFormatter(e,Placeholder.xpDatetime,DateTime.fromMillisecondsSinceEpoch_(s))),t.peek_().span_().text_("")}t.pop_()}_updateFailed(){return toasters$.warnKey_(RS.GalleryUpdateFailed),!1}_getSectionName(t){var e;return null!==(e=t.getAttribute(ATTR.AnInfo))&&void 0!==e?e:null}_sortKeys(t){const e=Object.keys(t).sort();return this.reverse$&&e.reverse(),e}_getExistings(t,e,i,n){const s=smap_();for(const o of DomUt.queryAll_(t,e)){const t=this._getSectionName(o);if(null==t)continue;const e=smap_();for(const t of DomUt.queryAll_(o,i)){const i=t.querySelector("a[href]"),s=null==i?void 0:i.getAttribute("href"),o=An.parseUriSafe_(s,this.baseuri$);if(null==o){t.remove();continue}const l=Basepath.trimLeading_(o.toAbsolute_().path$);n.includes(l)?e[l]=t:t.remove()}s[t]=[o,o,smap_(...this._sortKeys(e).map(t=>[t,e[t]]))]}return smap_(...this._sortKeys(s).map(t=>[t,s[t]]))}_getExistingsLinear(t,e,i,n,s){const o=smap_();let l=null;const a=DomUt.queryAll_(n,e);for(let e=0,n=a.length;e<n;++e){const r=a[e];if(r.classList.contains(t)){const i=this._getSectionName(r);if(null==i){for(;e+1<n;){if(a[e+1].classList.contains(t))break;++e}continue}l=smap_(),o[i]=[r,r,l];continue}const _=r.querySelector(i),c=null==_?void 0:_.getAttribute("href"),h=An.parseUriSafe_(c,this.baseuri$);if(null==h){r.remove();continue}const u=Basepath.trimLeading_(h.toAbsolute_().path$);s.includes(u)?null!=l&&(l[u]=r):r.remove()}for(const t of Object.values(o)){const e=t[2];t[2]=smap_(...this._sortKeys(e).map(t=>[t,e[t]]))}return smap_(...this._sortKeys(o).map(t=>[t,o[t]]))}static _createIFrame(t,e,i,n,s){this._createIFrame1(i,t,t=>{s(t,!0)})}static _createIFrame1(t,e,i){if(null==t||0==t.length)return void i(null);for(const t of Array.from(accessories$.querySelectorAll("iframe")))t.remove();const n=new DomBuilder(accessories$).iframe_({style:"display:none;visibility:hidden"}).cursor_();n.addEventListener("error",()=>{n.remove(),i(null)}),n.addEventListener("load",()=>{var t;const s=null===(t=n.contentDocument)||void 0===t?void 0:t.head;s&&null!=e&&new DomBuilderEx(s).insertBefore_(s.firstChild,"base",{href:e.href$}),i(n)}),n.baseURI,n.srcdoc=t}}_GalleryGeneratorBase.XXX=MSG.XXX$;class _HomeGalleryGenerator extends _GalleryGeneratorBase{constructor(t,e,i,n){super(t,e,i),this.created$=n}run_(){var t;const e=this._getSectionsElement();if(null==e)return this._updateFailed();const i=this._getExistings(e,`div.${XX.xxSection}`,`ul.${XX.xxTocs} > li`,this.itemkeys),n=sarray_();for(const t of Object.values(i)){const e=t[0],i=DomUt.query_(e,`ul.${XX.xxTocs}`);if(null==i)return this._updateFailed();t[1]=i,n.push(...Object.keys(t[2]))}for(const[s,o]of Object.entries(this.result$)){const l=()=>{let t=null;for(const e of Object.keys(i))if(s<e){t=i[e][0];break}const n=new DomBuilderEx(e).childBefore_(t,"div",smap_(["class",XX.xxSection],[ATTR.xInfo,s]));return[n.cursor_(),n.push_().div1_(XX.xxHeader).text_(0==s.length?".":s).pop_().ul1_(XX.xxTocs).cursor_(),smap_()]};let a=null!==(t=i[s])&&void 0!==t?t:With.value_(l(),t=>{i[s]=t});for(const[t,e]of Object.entries(o)){if(n.includes(t))continue;let i=null;const s=a[2];for(const e of Object.keys(s))if(t<e){i=s[e];break}const o=Basepath.lcSuffix_(t)==DEF.htmlSuffix?XX.xxToc2:XX.xxToc3;new DomBuilderEx(a[1]).childBefore1_(i,"li",o).push_().span1_(XX.xxBullet).pop_().span_().ahref1_(e[Key.url],CSS.xPlaceholder).text_(e[Key.text])}}for(const[t]of Object.values(i))0==DomUt.queryAll_(t,`li.${XX.xxToc1}, li.${XX.xxToc2}, li.${XX.xxToc3}, li.${XX.xxToc4}`).length&&t.remove();return!0}_getSectionsElement(){var t,e;const i=DomUt.query_(this.idoc$,`div.${CSS.xRoot} div.${XX.xxRight}`);if(null==i)return null;let n=null==i?void 0:i.querySelector(`div.${XX.xxSections}[${ATTR.xRole}~='${ROLE.Generated}']`);if(null!=n)return n;let s=i.querySelector(`div.${XX.xxSections}`),o=null;if(null!=s){if(this.created$)return Role.addRole(s,ROLE.Generated),s;o=null!==(t=null==s?void 0:s.parentElement)&&void 0!==t?t:null}else null!=(s=DomUt.query_(this.idoc$,`div.${XX.xxContent}`))?(o=s.parentElement,s=s.nextElementSibling):s=null!==(e=null==(o=i.firstElementChild)?void 0:o.firstElementChild)&&void 0!==e?e:null;return null==o?null:new DomBuilderEx(o).childBefore_(s,"div",smap_(["class",XX.xxSections],[ATTR.xRole,ROLE.Generated])).cursor_()}}class _MediaStickerGalleryGenerator extends _GalleryGeneratorBase{constructor(t,e,i,n){super(t,e,i),this.created$=n}run_(){var t;const e=this._getSectionsElement();if(null==e)return this._updateFailed();const i=this._getExistingsLinear(XX.xxComment,`div.${CSS.xSticker}`,`div.${CSS.xPhoto} > a[href]`,e,this.itemkeys),n=sarray_();for(const t of Object.values(i))t[1]=e,n.push(...Object.keys(t[2]));for(const[s,o]of Object.entries(this.result$)){const l=()=>{let t=null;for(const e of Object.keys(i))if(s<e){t=i[e][0];break}const n=new DomBuilderEx(e).childBefore_(t,"div",smap_(["class",`${XX.xxComment} ${CSS.xSticker} ${CSS.xStickOnDocument} ${CSS.xDraggable} ${CSS.xZMiddle} ${XX.xxStyle00}`],[ATTR.xInfo,s])),o=n.cursor_();return n.push_().div1_(CSS.xSubject).indent_(n.push_().span_(["class",`${CSS.xFloatRightClearNone} fa fa-arrows`],[ATTR.xButton,"m/"]),n.peek_().span_(["class",`${CSS.xFloatRightClearNone} fa fa-retweet`],[ATTR.xButton,`c/${CSS.xZBottom} ${CSS.xZLower} ${CSS.xZMiddle} ${CSS.xZUpper} ${CSS.xZTop}/${XX.xxPhoto}`]),n.pop_().span_().text_(0==s.length?".":s)),n.pop_().div_().div1_(XX.xxCaption).span_().text_(XXX),[o,e,smap_()]};let a=null!==(t=i[s])&&void 0!==t?t:With.value_(l(),t=>{i[s]=t});for(const[t,e]of Object.entries(o)){if(n.includes(t))continue;let i=null;const s=a[2];for(const e of Object.keys(s))if(t<e){i=s[e];break}const o=e[Key.url],l=Basepath.lcExt_(t),r=MimeUtil.isImageLcExt(l)?"image":MimeUtil.isVideoLcExt(l)?"video-file":MimeUtil.isAudioPlaybackLcExt(l)?"audio-file":null;if(null==r)continue;const _=_ClientActionWidget._createMediaStickerWidget(a[1].ownerDocument,r,o);null!=_&&a[1].insertBefore(_,i)}}for(const[t]of Object.values(i)){const e=t.nextElementSibling;null!=e?An.classlist_(e).containsAll_(CSS.xSticker,XX.xxComment)&&t.remove():t.remove()}return!0}_getSectionsElement(){let t=DomUt.query_(this.idoc$,`div.${XX.xxTop}[${ATTR.xRole}~='${ROLE.Generated}']`);if(null!=t)return t;let e=DomUt.query_(this.idoc$,`div.${XX.xxTop}`);return null!=e?(Role.addRole(e,ROLE.Generated),e):null}}class _MediaWallGalleryGenerator extends _GalleryGeneratorBase{constructor(t,e,i,n){super(t,e,i),this.created$=n}run_(){var t;const e=this._getSectionsElement();if(null==e)return this._updateFailed();const i=this._getExistings(e,`div.${XX.xxSection}`,`ul.${XX.xxMedias} > li`,this.itemkeys),n=sarray_();for(const t of Object.values(i)){const e=t[0],i=DomUt.query_(e,`ul.${XX.xxMedias}`);if(null==i)return this._updateFailed();t[1]=i,n.push(...Object.keys(t[2]))}for(const[s,o]of Object.entries(this.result$)){const l=()=>{let t=null;for(const e of Object.keys(i))if(s<e){t=i[e][0];break}const n=new DomBuilderEx(e).childBefore_(t,"div",smap_(["class",XX.xxSection],[ATTR.xInfo,s])).push_().div1_(XX.xxHeader).div1_(XX.xxSubject).text_(0==s.length?".":s).peek_().ul1_(XX.xxMedias),o=n.cursor_();return[n.pop_().cursor_(),o,smap_()]};let a=null!==(t=i[s])&&void 0!==t?t:With.value_(l(),t=>{i[s]=t});const r=(t,e,i)=>{const n=e[Key.url],s=Basepath.lcExt_(t),o=MimeUtil.isImageLcExt(s)?"image":MimeUtil.isVideoLcExt(s)?"video-file":MimeUtil.isAudioPlaybackLcExt(s)?"audio-file":null;if(null==o)return;const l=_ClientActionWidget._createMediaWallWidget(a[1].ownerDocument,o,n);null!=l&&a[1].insertBefore(l,i)};for(const[t,e]of Object.entries(o)){if(n.includes(t))continue;let i=null;const s=a[2];for(const e of Object.keys(s))if(t<e){i=s[e];break}r(t,e,i)}}for(const[t]of Object.values(i))0==DomUt.queryAll_(t,`li.${XX.xxMedia}`).length&&t.remove();return!0}_getSectionsElement(){let t=DomUt.query_(this.idoc$,`div.${XX.xxBody}[${ATTR.xRole}~='${ROLE.Generated}']`);if(null!=t)return t;let e=DomUt.query_(this.idoc$,`div.${XX.xxBody}`);return null!=e?(Role.addRole(e,ROLE.Generated),e):null}}class _AlarmGalleryGenerator{constructor(t,e){this.idoc$=t,this.info$=e,this.pendings$=new StringMap,this.dones$=new StringMap,this.ids$=sarray_();const i=this.info$[Key.result];for(const t of EventInfo.arrayOf_(Object.values(i)).sort((t,e)=>e.ms$-t.ms$)){const e=t.id$;(t.done$?this.dones$:this.pendings$)[e]=t,this.ids$.push(e)}}run_(){const t=this._getSectionElement();return null==t?this._updateFailed():this._update(t[0],this.pendings$)&&!!this._update(t[1],this.dones$)||this._updateFailed()}_update(t,e){const i=DomUt.query_(t,`ul.${XX.xxTodos}`);if(null==i)return!1;const n=t=>t.createTodoItem(this.idoc$),s=t=>{new DomBuilderEx(i).appendNodes_(n(t))};for(const[t,i]of Object.entries(e))s(i);return!0}_getSectionElement(){const t=DomUt.query_(this.idoc$,`div.${CSS.xRoot} div.${XX.xxBody}`);if(null==t)return null;const e=new DomBuilderEx(t).push_();e.empty_();const i=this._createAutogenSection(e,MSG.string_(RS.Done));return[this._createAutogenSection(e,MSG.string_(RS.Pending)),i]}_createAutogenSection(t,e){return t.peek_().childBefore_(t.cursor_().firstElementChild,"div",smap_(["class",XX.xxSection],[ATTR.xRole,ROLE.Generated])).indent_(t.push_().div1_(XX.xxHeader).text_(e),t.peek_().ul1_(XX.xxTodos),t.pop_()).cursor_()}_updateFailed(){return toasters$.warnKey_(RS.GalleryUpdateFailed),!1}}class _GalleryGenerator{constructor(t,e,i,n,s,o){this.tinfo$=t,this.recursive$=e,this.descending$=i,this.singlesection$=n,this.currentDir$=s,this.handler$=o}run_(){this.recursive$?this.handler$.listRecursive_(this.currentDir$,t=>{if(toasters$.warn_(t))return;const e=t[Key.dirtree];this._generateGallery3(e)}):this.handler$.listDir_(this.currentDir$,t=>{var e;if(toasters$.warn_(t))return;const i=null!==(e=FileInfo.arrayOf_(t[Key.dirtree]))&&void 0!==e?e:[];if(null==i)return;const n=[];for(const t of i)t.isdir$||n.push(t.name_());this._generateGallery3(n)})}_generateGallery3(t){const e=this._getTemplateFilter(this.tinfo$);if(null==e)return;const i=e(t),n=i[0],s=i[1];if(n.length+s.length==0)return void toasters$.warn_(MSG.string_(RS.NoSuitableMediaFileFound));n.sort(),s.sort(),this.descending$&&(n.reverse(),s.reverse());const o=new PromptFilelist(accessories$,smap_([Key.copying,smap_(...n.map(t=>[t,[!1,!1]]))],[Key.overwriting,smap_(...s.map(t=>[t,[!1,!1]]))]));o.titleKey_(RS.PickFiles),o.zindex_(DEF.zindexPrompt),o.onOK_(t=>{const e=_Util.promptFilepath_(this.tinfo$.cat_(),FilepickerKind.ANY,"",this.currentDir$,Basepath.joinPath_(this.currentDir$,"index.html"));e.setDelegate_(FilepickerHtmlDelegate.singleton$),e.zindex_(DEF.zindexPrompt),e.onOK_((e,i)=>{e(!0),sidePanel$.hideSidepanel_(),this._generateGallery4(i,t)}),e.show_()}),o.show_()}_generateGallery4(t,e){if(0==e.length)return void toasters$.warn_(MSG.string_(RS.NoSuitableMediaFileFound));const i=_Util.getTemplateHtmlFromInfo_(this.tinfo$);null!=i&&(t.endsWith(DEF.htmlSuffix)||(t+=DEF.htmlSuffix),host$.generateGallery_(t,i,this.descending$,this.singlesection$,this.currentDir$,e,e=>{if(toasters$.error_(e))return;const n=An.parseUriSafe_(t,null),s=e[Key.template],o=e[Key.text];_GalleryGeneratorBase._createIFrame(n,i,s,o,(i,s)=>{const o=null==i?void 0:i.contentDocument;if(null!=o&&null!=i)try{const l=e[Key.type];let a=!0;switch(l){case TemplateName.homeSimpler:a=new _HomeGalleryGenerator(o,n,e,s).run_();break;case TemplateName.mediaSticker:a=new _MediaStickerGalleryGenerator(o,n,e,s).run_();break;case TemplateName.mediaWall:a=new _MediaWallGalleryGenerator(o,n,e,s).run_()}if(a){const e=native$.serializeDocument_(o);host$.saveHtml_(t,e,()=>{mainPanel$.addIFrameReadyOneshotCallback(t=>{mainPanel$.startEditCallback(()=>{_MainPanel._processPlaceholdersAudioInfos(native$.iQueryAll_(`[${ATTR.xPlaceholder}='${Placeholder.xpAudioinfo}']`),()=>{_MainPanel._processPlaceholdersVideoInfos(native$.iQueryAll_(`[${ATTR.xPlaceholder}='${Placeholder.xpVideoinfo}']`),()=>{t()})})})}),_Util.browseFile_(t)})}}finally{i.remove}})}))}audioFileFilter(t){const e=sarray_();for(const i of t){const t=Basepath.lcExt_(i);(MimeUtil.isAudioPlaybackLcExt(t)||MimeUtil.isVideoLcExt(t))&&e.push(i)}return[e,[]]}htmlFileFilter(t){const e=sarray_(),i=sarray_();for(const n of t){const t=Basepath.lcExt_(n);null!=t&&(t==DEF.html||t==DEF.pdf?e.push(n):MimeUtil.isMediaLcExt(t)&&i.push(n))}return[e,i]}mediaFileFilter(t){const e=sarray_();for(const i of t){const t=Basepath.lcExt_(i);(MimeUtil.isImageLcExt(t)||MimeUtil.isVideoLcExt(t)||MimeUtil.isAudioPlaybackLcExt(t))&&e.push(i)}return[e,[]]}photoFileFilter(t){const e=sarray_();for(const i of t)MimeUtil.isImagePath(i)&&e.push(i);return[e,[]]}_getTemplateFilter(t){switch(t.name_()){case TemplateName.audioV2:return this.audioFileFilter;case TemplateName.homeSimpler:return this.htmlFileFilter;case TemplateName.photoSticker1:case TemplateName.photoWall:return this.photoFileFilter;case TemplateName.mediaSticker:case TemplateName.mediaWall:return this.mediaFileFilter;default:return null}}}class _CalendarPanel extends UIPanelBase{constructor(t){super(),this._top=t,this._selectedCell=null,this._blogRegex=RegExp("^.*/(\\d\\d\\d\\d)/(\\d\\d)/(\\d\\d)(/\\d\\d)?\\.html$");const e=new DomBuilderEx(t).push_();this._toolbar=new Toolbar(e.cursor_(),[BUT.info_(BUT.PrevBlog),BUT.info_(BUT.NextBlog),BUT.info_(BUT.OpenDocument),BUT.info_(BUT.Today)]),this._toolbar.onAction_(t=>this._toolbarActions(t)),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._createContent(e)}_createContent(t){const e=An.now00_();this._selectedDate=e;const i=6*cache$.ui$.buttonSize_();this._content=t.peek_().div1_(CSS.AnContentViewport).cursor_(),t.div1_(CSS.AnViewportContent),this._createCalendar(t.cursor_(),i),this._createAlarms(t.cursor_(),this._selectedDate),An.addContextmenuListenerMatching_(this._dateContainer,"div",(t,e)=>{An.stopevent_(e)}),An.addEventListenerMatching_(this._dateContainer,Conf.touchstart,"div",(t,e)=>{An.stopevent_(e),t.classList.contains(CSS.AnDateSelected)?this._open(!1):this._onSelectDate(t)}),An.onInputFocusSelectIgnoreEnterKey_(this._inputYear),An.onChange_(this._inputYear,t=>{An.stopevent_(t);const e=this._selectedDate.year$,i=An.parseInt_(this._inputYear.value,e);this._inputYear.value=`${e}`,i!=e&&this.refresh_(DateTime.local_(i,this._selectedDate.month$,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onInputFocusSelectIgnoreEnterKey_(this._inputMonth),An.onChange_(this._inputMonth,t=>{An.stopevent_(t);const e=this._selectedDate.month$,i=An.parseInt_(this._inputMonth.value,e);this._inputMonth.value=`${e}`,i!=e&&this.refresh_(DateTime.local_(this._selectedDate.year$,i,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonNextYear,t=>{An.stopevent_(t),this.refresh_(DateTime.local_(this._selectedDate.year$+1,this._selectedDate.month$,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonPrevYear,t=>{An.stopevent_(t),this.refresh_(DateTime.local_(this._selectedDate.year$-1,this._selectedDate.month$,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonNextMonth,t=>{An.stopevent_(t),this.refresh_(DateTime.local_(this._selectedDate.year$,this._selectedDate.month$+1,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),An.onClick_(this._buttonPrevMonth,t=>{An.stopevent_(t),this.refresh_(DateTime.local_(this._selectedDate.year$,this._selectedDate.month$-1,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}),this.refresh_(this._selectedDate)}_createCalendar(t,e){const i=new DomBuilderEx(t);i.div_({class:CSS.AnFlexCenter}).div_({style:`padding:5px;border-bottom:${DEF.themeBorder};`}),i.push_(),i.div_({class:CSS.AnFlex,style:"padding-top: 5px; padding-bottom:5px; "}),i.push_(),this._buttonPrevYear=i.div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronLeft).cursor_(),this._inputYear=i.peek_().child_(Conf.input,{class:CSS.AnPromptInput,style:"text-align:center;",rows:"1"}).cursor_(),this._buttonNextYear=i.peek_().div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronRight).cursor_(),this._buttonPrevMonth=i.peek_().div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronLeft).cursor_(),this._inputMonth=i.peek_().child_(Conf.input,{class:CSS.AnPromptInput,style:"text-align:center;",rows:"1"}).cursor_(),this._buttonNextMonth=i.peek_().div1_(CSS.AnFlexButton,CSS.Fa,CSS.FaChevronRight).cursor_(),i.pop_(),i.peek_().div1_(CSS.AnCalHead),i.push_();for(const t of MSG.stringArray_(RS.Weekdays))i.peek_().div_().text_(t);i.pop_(),this._dateContainer=i.peek_().div_({class:CSS.AnCalBody,style:`flex-flow: row wrap; height: ${e}px; padding-bottom: 4px;`}).cursor_()}_createAlarms(t,e){this._eventsPanel=new _CalendarEventsPanel(t,this,e)}_onSelectDate(t){if(t.classList.contains(CSS.AnGray))return!1;const e=An.parseInt_(t.getAttribute(ATTR.AnInfo),-1);return e>=0&&t!=this._selectedCell&&(null!=this._selectedCell&&this._selectedCell.classList.remove(CSS.AnDateSelected),this._selectedCell=t,this._selectedCell.classList.add(CSS.AnDateSelected),this._selectedDate=this._startDate.add_(DateTime.DAY*e),this._inputYear.value=`${this._selectedDate.year$}`,this._inputMonth.value=`${this._selectedDate.month$}`,this._updateToolbarState(),this._eventsPanel.setDate1(this._selectedDate),!0)}element_(){return this._top}show_(){this._shown||(this._shown=!0,this._setContentHeight(),this.refresh_(this._selectedDate),gestureHandler$.push_(GestureEvent.leftInward,this._flingHandler),gestureHandler$.push_(GestureEvent.leftOutward,this._flingHandler),An.show_(this._top))}hide_(){this._shown&&(gestureHandler$.pop_(GestureEvent.leftInward),gestureHandler$.pop_(GestureEvent.leftOutward),this._shown=!1,An.hide_(this._top))}_setContentHeight(){this.resizeContent_(window.innerHeight-cache$.ui$.toolbarHeight_())}resizeContent_(t){if(this._shown){const e=t-cache$.ui$.toolbarHeight_()-DEF.sidepanelMarginBottom,i=this._content.style;i.height=`${e}px`,i.maxHeight=`${e}px`}}_flingHandler(t){return Timer.sleep1_(()=>{switch(t){case GestureEvent.leftOutward:this.refresh_(DateTime.local_(this._selectedDate.year$,this._selectedDate.month$+1,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$));break;case GestureEvent.leftInward:this.refresh_(DateTime.local_(this._selectedDate.year$,this._selectedDate.month$-1,this._selectedDate.day$,this._selectedDate.hour$,this._selectedDate.minute$,this._selectedDate.second$))}}),!0}onRefreshEvents_(){this._shown&&this.refresh_(this._selectedDate)}refresh_(t){host$.getEvents_(!1,!1,e=>{toasters$.warn_(e);const i=e[Key.result];this._refreshCalendar(t,i),this._eventsPanel.setDate(t,i)})}_refreshCalendar(t,e){this._selectedDate=t,this._inputYear.value=this._selectedDate.year$.toString(),this._inputMonth.value=this._selectedDate.month$.toString();let i=this._selectedDate.subtract_(DateTime.DAY*(this._selectedDate.day$-1));i=7==i.weekday$?i:i.subtract_(DateTime.DAY*i.weekday$),this._startDate=i,this.populate_(this._dateContainer,this._selectedDate,this._startDate,e)}refreshCalendar1_(t){this.populate_(this._dateContainer,this._selectedDate,this._startDate,t)}populate_(t,e,i,n){const s=An.simpleDateString_(),o=null==e?null:An.simpleDateString_(e),l=e.month$,a=new Array,r=new Array;if(null!=n){const t=DateTime.local_(i.year$,i.month$,i.day$).millisecondsSinceEpoch$,e=t+42*DateTime.DAY,s=Object.values(n);for(const i of s){if(1==i[EventKey.Done])continue;const n=i[EventKey.Ms];if(!(n>=t&&n<e))continue;const s=DateTime.fromMillisecondsSinceEpoch_(n);i[EventKey.Repeat]===EventRepeat.Off?r.push(s):a.push(s)}}host$.listBlogs_(e.year$,e.month$,e=>{let n=new StringMap;An.hasMessage_(e)||(n=e[Key.result]);const _=DateTime.DAY;let c=null;const h=new DomBuilderEx(t).empty_().push_();for(let t=0;t<6;++t)for(let e=0;e<7;++e){const u=7*t+e,d=sarray_(),S=i.weekday$;let p=!1;if(i.month$==l){const t=An.to02d_(i.day$);p=n[`${t}/${t}.html`]||n[`${t}.html`],6!=S&&7!=S||d.push(CSS.AnDateHoliday)}else d.push(CSS.AnGray);p&&d.push(CSS.AnUnderline);const m=An.simpleDateString_(i);m==s&&(ArrayUt.delete_(d,CSS.AnDateHoliday),d.push(CSS.AnBold)),m==o&&d.push(CSS.AnDateSelected);t:{for(const t of a)if(An.isSameDay_(i,t)){d.push(CSS.AnIndicatorTopRight),d.push(CSS.AnIndicatorAlarm);break t}for(const t of r)if(An.isSameDay_(i,t)){d.push(CSS.AnIndicatorTopRight),d.push(CSS.AnIndicatorEvent);break}}const g=smapOf_(ATTR.AnInfo,u.toString());d.length>0&&(g.class=d.join(" "));const f=h.peek_().div_(g).text_(i.day$.toString()).cursor_();m==o&&(c=f),i=i.add_(_)}this._selectedCell=c,this._updateToolbarState()})}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.PrevBlog:this._findBlog(!1,this._selectedDate);break;case BUT.NextBlog:this._findBlog(!0,this._selectedDate);break;case BUT.Today:this.refresh_(An.now00_());break;case BUT.OpenDocument:this._open(!0);break;default:throw Assert.notReach_(t)}}_updateToolbarState(){}_findBlog(t,e){host$.findBlog_(e.year$,e.month$,e.day$,t,t=>{if(toasters$.warn_(t))return;const e=t[Key.result];if(null!=e){const t=this._blogRegex.exec(e);if(null!=t){const e=An.parseInt_(t[1],null),i=An.parseInt_(t[2],null),n=An.parseInt_(t[3],null);if(null!=e&&null!=i&&null!=n){const t=DateTime.now_();this.refresh_(DateTime.local_(e,i,n,t.hour$,t.minute$,0))}}}})}_open(t){const e=_Util.getBlogMonthPath_(this._selectedDate),i=An.to02d_(this._selectedDate.day$),n=`${i}/${i}.html`,s=`${i}.html`;fileinfoUt$.fileInfos_(e,[n,s],i=>{if(toasters$.warn_(i))return;const o=i[Key.result];let l=`${e}/${n}`,a=FileInfo.of_(o[n]),r=1==(null==a?void 0:a.exists$);r||(a=FileInfo.of_(o[s]),(r=1==(null==a?void 0:a.exists$))&&(l=`${e}/${s}`)),(r||t)&&_Util.onSaveOrDiscard_(()=>{this._open1(t,r,l)})})}_open1(t,e,i){if(e)return sidePanel$.hideSidepanel_(),void _Util.browseFile_(i);t&&(sidePanel$.hideSidepanel_(),host$.addPage_(i,TemplateCat.Blog.toLowerCase(),t=>{toasters$.error_(t)||(mainPanel$.addIFrameReadyOneshotCallback(t=>{Timer.sleep0_(()=>{mainPanel$.startEdit(()=>{const e=native$.iQuery(`div.${CSS.xxTitle}`);null!=e&&(e.textContent=settings$.shortDateString_(this._selectedDate)),t()},()=>{t()})})}),_Util.browseFile_(i))}))}}class _EventsPanelBase extends UIPanelBase{constructor(t){super(),this._container=t,this._sorted=[],this._selected=null,this._excludeDone=!1,this._shown=!1,this._populated=!1;const e=new DomBuilderEx(this._container).push_();this._toolbar=this._createEventsToolbars(e),this._content=e.div1_(CSS.AnContentViewport).push_().cursor_(),this._eventsPanel=e.peek_().div_({style:"padding: 0;"}).cursor_(),An.onContextmenu_(this._content,t=>{An.stopevent_(t)}),this._eventsPanel.addEventListener("click",t=>{An.stopevent_(t),t.stopImmediatePropagation(),With.optionalOrFalse_(DomUt.matchingTarget_(t,`.${CSS.AnFile}`),t=>{toasters$.hideModal_();const e=t.getAttribute(ATTR.xTooltips);null==e||0==e.length?toasters$.warnKey_(RS.PleaseSelectAFileToOpen):this._openurl(e)})||With.optional_(DomUt.matchingTarget_(t,`span.${CSS.FaCheckSquare}, span.${CSS.FaSquareO}, span.${CSS.FaBellO}, span.${CSS.FaBell}`),t=>(this._toggleDone(t,()=>{this._refreshAndReportPending(!0,null)}),!0))||With.optional_(DomUt.matchingTarget_(t,`div.${CSS.AnEventsPanel} > div`),t=>{toasters$.hideModal_(),this._select(t),this._updateToolbarState()})||this._deselect()})}element_(){return this._container}_deselect(){null!=this._selected&&(this._selected.classList.remove(_EventsPanelBase._FA_SELECTED),this._selected=null,this._updateToolbarState())}_select(t){const e=t.classList;e.contains(_EventsPanelBase._FA_SELECTED)?(e.remove(_EventsPanelBase._FA_SELECTED),this._selected=null):(null!=this._selected&&this._selected.classList.remove(_EventsPanelBase._FA_SELECTED),e.add(_EventsPanelBase._FA_SELECTED),this._selected=t),this._updateToolbarState()}selectAndReveal_(t,e=null){if(!this._populated)return void Timer.sleep_(250,()=>{this.selectAndReveal_(t)});const i=this._sorted.findIndex(e=>t==e[EventKey.Id]);if(i>=0){const t=DomUt.query_(this._eventsPanel,`div.${CSS.AnEventsPanel}`);if(null!=t){const e=t.children.item(i);e&&(this._select(e),e.scrollIntoViewIfNeeded(!0))}}null==e||e()}_getAlarm(t){const e=null==t?void 0:t.getAttribute(ATTR.AnInfo);if(null==t||null==e)return null;const i=this._sorted.findIndex(t=>e==t[EventKey.Id]);return i>=0?this._sorted[i]:null}_setContentHeight(){const t=this._eventsPanel.parentElement;if(null==t)return;const e=An.documentOffset_(t).y,i=window.innerHeight-e-DEF.sidepanelMarginBottom,n=t.style;n.height=`${i}px`,n.maxHeight=`${i}px`}resizeContent_(t){this._setContentHeight()}_refresh(t){this._sorted=new Array,this._selected=null,new DomBuilderEx(this._eventsPanel).empty_(),this._refresh1(t),this._updateToolbarState()}_refresh1(t){if(null==t)return;if(toasters$.warn_(t))return;const e=t[Key.result];this._refresh2(this._eventsPanel,e)}_refresh2(t,e){if(null==e)return;const i=Array.from(Object.values(e));i.sort((t,e)=>{const i=t[EventKey.Ms],n=e[EventKey.Ms];return i>n?1:n>i?-1:0});const n=DomBuilderEx.offline_(document,"div",{class:`${CSS.AnEventsPanel} ${CSS.AnZebra}`}).push_(),s=An.now00_(),o=s.add_(DateTime.DAY),l=this._nextTrigger(i,o);for(const t of i)this._includes(t)&&(this._sorted.push(t),this._populate1(n,s,o,l,t));this._sorted.length>0&&new DomBuilderEx(t).empty_().appendNodes_(n.pop_().cursor_())}_days(t,e){return Math.round(Math.abs(t.millisecondsSinceEpoch$-e.millisecondsSinceEpoch$)/DateTime.DAY)}_datestring(t,e,i,n){const s=this._days(t,e);return i?MSG.string_(RS.Today)+""+settings$.timeString_(t):n?MSG.string_(RS.Tomorrow)+""+settings$.timeString_(t):s<=30?t.year$==e.year$?settings$.shortDatetimeString_(t):settings$.datetimeString_(t):t.year$==e.year$?settings$.shortDateString_(t):settings$.dateString_(t)}_populate1(t,e,i,n,s){var o;const l=new EventInfo(s),a=l.id$,r=l.repeat$,_=l.url$,c=l.desc$,h=l.color$,u=l.pending$,d=l.private$,S=l.doneMs$,p=r==EventRepeat.Off,m=l.ms$,g=!S&&!u&&!p&&this._shouldPostAlarm(s,e),f=DateTime.fromMillisecondsSinceEpoch_(m),C=An.isSameDay_(e,f),T=An.isSameDay_(i,f),A=null!=n&&An.isSameDay_(n,f),b=An.parseUriSafe_(_,null),x=null==b?"":b.path$,y=An.isempty_(x),R=!y&&l.exists$,v=this._datestring(f,e,C,T),E={class:S?` ${CSS.AnEventsDone}`:C?` ${CSS.AnEventsToday}`:A?` ${CSS.AnEventsTomorrow}`:` ${CSS.AnEventsPending}`},$=S?CSS.FaCheckSquare:u?CSS.FaBellO:g?CSS.FaBell:CSS.FaSquareO,F=An.isempty_(c)?y?"":Basepath.nameWithoutSuffix_(x):c,w=smapOf_("class",CSS.AnEventsItem);if(w[ATTR.AnInfo]=a,!An.isempty_(h)){const t=ColorUtil.getColorValue_(h);null!=t&&(w.style=`background-color:${t.toCSSString_()};`)}t.peek_().div_(w).indent_(t.push_().div_(E).indent_(t.push_().span1_(CSS.AnBulletLeft,CSS.Fa,$,CSS.AnLink),t.peek_().span1_(CSS.AnEventsDate).text_(v),t.peek_().span1_(CSS.AnEventsRepeat).text_(`-${null!==(o=_EventsPanelBase._REPEATS.get(r))&&void 0!==o?o:""}`),t.peek_().span1_(CSS.AnBullet,CSS.AnSmall,CSS.Fa,d?CSS.FaLock:""),t.pop_()),t.pop_().div_(E).push_().span1_(CSS.AnBulletLeft)),R?t.peek_().ahref_(_,["class",`${CSS.AnEventsDesc} ${CSS.AnFile}`],[ATTR.xTooltips,_]).text_(F):t.peek_().span_({class:y?CSS.AnEventsDesc:`${CSS.AnEventsDesc} ${CSS.AnNot}`}).text_(F),t.pop_()}_nextTrigger(t,e){const i=DateTime.local_(e.year$,e.month$,e.day$).millisecondsSinceEpoch$;for(const e of t){if(1==e[EventKey.Done])continue;const t=e[EventKey.Ms];if(!(t<i))return DateTime.fromMillisecondsSinceEpoch_(t)}return null}_shouldPostAlarm(t,e){if(EventRepeat.Once==t[EventKey.Repeat]){const i=t[EventKey.Ms],n=t[EventKey.Lastms],s=e.millisecondsSinceEpoch$+DEF.alarmMargin;if(null!=n&&i<=n||i<=s)return!1}return!0}show_(){this._shown||(this._shown=!0,An.showHidden_(this._container),this._setContentHeight(),this._refreshAndReportPending(!0,()=>{An.setVisible_(this._container)}))}hide_(){this._shown&&(this._shown=!1,this._populated=!1,An.hide_(this._container),this._sorted=[],this._selected=null,new DomBuilderEx(this._eventsPanel).empty_())}_getSelectedAlarm(){return EventInfo.of_(this._getAlarm(this._selected))}_toggleDone(t,e){var i,n;const s=null!==(n=null===(i=t.parentElement)||void 0===i?void 0:i.parentElement)&&void 0!==n?n:null,o=this._getAlarm(s);if(null==o)return;const l=!(1==o[EventKey.Done]);o[EventKey.Done]=l,l?o[EventKey.DoneMs]=DateTime.ms_():delete o[EventKey.DoneMs],host$.postEvent_(o,t=>{toasters$.warn_(t),e()})}_updateToolbarState(){const t=null!=this._selected;this._toolbar.enableButtons_([BUT.Remove,BUT.EditEvent],t)}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.CreateEvent:this._addEvent();break;case BUT.EditEvent:this._editEvent();break;case BUT.Remove:this._removeEvent();break;case BUT.Refresh:this._refreshAndReportPending(!0,null);break;default:throw Assert.notReach_(t)}}_postEvent(t,e=null){host$.postEvent_(t,t=>{toasters$.warn_(t),this._refreshAndReportPending(!0,e)})}_removeEvent(){const t=this._getSelectedAlarm();null!=t&&_Util.confirmSmall_(MSG.format1_(RS.ConfirmRemove_Event,"1"),DEF.zindexConfirm,e=>{if(!e)return;const i=[t.id$];host$.removeEvents_(i,t=>{if(!toasters$.warn_(t)){const e=t[Key.result];toasters$.info_(MSG.format1_(RS.removed_events,`${e}`))}this._refreshAndReportPending(!0,null)})})}_editEvent(){const t=this._getSelectedAlarm();null!=t&&this.promptAlarm_(t)}promptAlarm_(t,e=null){var i;new PromptEvent(accessories$,cache$.ui$.buttonSize_(),settings$.dateFormat_(),settings$.timeFormat_(),null!==(i=native$.getIFrameUri_())&&void 0!==i?i:Uri.ROOT$,t).titleKey_(RS.CreateEventTitle).zindex_(DEF.zindexPrompt).onOK_(t=>{this._postEvent(t,()=>{this.selectAndReveal_(t[EventKey.Id],e)})}).onCancel_(()=>{null==e||e()}).show_()}_openurl(t){sidePanel$.hideSidepanel_();const e=An.cpathOfFilepath2_("/",t);if(null!=e){const t=Basepath.lcExt_(e);if(null!=MimeUtil.audioPlaybackMimeFromLcExt(t))return void _AudioPlayerDialog.createAndShow_(accessories$,e);if(null!=MimeUtil.videoMimeFromLcExt(t))return void host$.playVideo_(e,!1,null,0,t=>{toasters$.warn_(t)})}_Util.onSaveOrDiscard_(()=>{_Util.browse1_(An.parseUriSafe_(t,null))})}static _createAlarmForDate(t,e){const i=_AlarmUtil.createId_();_EventsPanelBase._promptNewEvent(EventInfo.create_(i,t.millisecondsSinceEpoch$,mainPanel$.isLoggedIn(),"","",""),e).show_()}static _promptNewEvent(t,e){var i;const n=new PromptEvent(accessories$,cache$.ui$.buttonSize_(),settings$.dateFormat_(),settings$.timeFormat_(),null!==(i=native$.getIFrameUri_())&&void 0!==i?i:Uri.ROOT$,t);return n.titleKey_(RS.CreateEventTitle),n.zindex_(DEF.zindexPrompt),n.onOK_(e),n}}_EventsPanelBase._FA_SELECTED=CSS.AnSelectedHighlight,_EventsPanelBase.ColorDisabled="#bbb",_EventsPanelBase._REPEATS=map_([EventRepeat.Off,MSG.string_(RS.RepeatOffMarker)],[EventRepeat.Once,MSG.string_(RS.RepeatOnceMarker)],[EventRepeat.Daily,MSG.string_(RS.RepeatDailyMarker)],[EventRepeat.Workdays,MSG.string_(RS.RepeatWorkdaysMarker)],[EventRepeat.Weekly,MSG.string_(RS.RepeatWeeklyMarker)],[EventRepeat.Monthly,MSG.string_(RS.RepeatMonthlyMarker)],[EventRepeat.Yearly,MSG.string_(RS.RepeatYearlyMarker)]);class _CalendarEventsPanel extends _EventsPanelBase{constructor(t,e,i){super(t),this._calendarPanel=e,this._date=i,this._excludeDone=!1;const n=this._eventsPanel.style;n.width="-webkit-fit-content",n.minWidth="100%"}_createEventsToolbars(t){const e=new Toolbar(t.cursor_(),[BUT.info_(BUT.Refresh),BUT.info_(BUT.EditEvent),BUT.info_(BUT.Remove),BUT.info_(BUT.CreateEvent)]);return e.onAction_(t=>this._toolbarActions(t)),e.onTooltips_(toasters$.onTooltipsKey_),e}_refreshAndReportPending(t,e=null){this._populated=!1,host$.getEvents_(t,this._excludeDone,t=>{toasters$.warn_(t);const i=t[Key.result];this._calendarPanel.refreshCalendar1_(i),super._refresh(t),host$.getPendingAlarmCount_(t=>{if(!toasters$.warn_(t)){const e=t[Key.result];toasters$.info_(`${MSG.string_(RS.AlarmsPending_)}${e}`,{attop:!1})}this._populated=!0,null==e||e()})})}_addEvent(){const t=DateTime.now_(),e=DateTime.local_(this._date.year$,this._date.month$,this._date.day$,t.hour$,t.minute$);_EventsPanelBase._createAlarmForDate(e,t=>this._postEvent(t))}_includes(t){const e=t[EventKey.Ms],i=DateTime.fromMillisecondsSinceEpoch_(e);return An.isSameDay_(this._date,i)}setDate1(t){this._date=t,host$.getEvents_(!1,this._excludeDone,t=>{this._refresh(t)})}setDate(t,e){this._date=t,this._sorted=[],this._selected=null,new DomBuilderEx(this._eventsPanel).empty_(),this._refresh2(this._eventsPanel,e),this._updateToolbarState()}showContextmenu_(){}hideContextmenu_(){}onWindowSizeChanged_(){}}class _EventsPanel extends _EventsPanelBase{constructor(t){super(t);const e=cache$.ui$.iwinPadding_(),i=this._eventsPanel.style;i.paddingBottom=`${e}px`,i.width="-webkit-fit-content",i.minWidth="100%"}_createEventsToolbars(t){const e=new Toolbar(t.cursor_(),[BUT.info_(BUT.Refresh),BUT.info_(BUT.EditEvent),BUT.info_(BUT.Remove),BUT.info_(BUT.CreateEvent),BUT.info_(BUT.Toolbar)]);return e.onAction_(t=>this._toolbarActions0(t)),e.onTooltips_(toasters$.onTooltipsKey_),this._editbar=new Toolbar(t.cursor_(),[BUT.info_(BUT.ExportToFile),BUT.info_(BUT.ShowDoneEvents),BUT.info_(BUT.ClearEvents),BUT.info_(BUT.Toolbar1)]),this._editbar.onAction_(t=>this._toolbarActions0(t)),this._editbar.onTooltips_(toasters$.onTooltipsKey_),this._editbar.hide_(),e}_refreshAndReportPending(t,e=null){this._populated=!1,host$.getEvents_(t,this._excludeDone,t=>{this._refresh(t),host$.getPendingAlarmCount_(t=>{if(!toasters$.warn_(t)){const e=t[Key.result];toasters$.info_(`${MSG.string_(RS.AlarmsPending_)}${e}`,{attop:!1})}this._populated=!0,null==e||e()})})}_addEvent(){_EventsPanelBase._createAlarmForDate(An.now00_(),t=>this._postEvent(t))}_includes(t){return!0}_updateToolbarState(){this._editbar.enableButton_(BUT.ClearEvents,mainPanel$.isLoggedIn()),super._updateToolbarState()}showContextmenu_(){}hideContextmenu_(){}onWindowSizeChanged_(){}show_(){host$.getSessionPreferences_(t=>{const e=t[Key.result];if(null!=e){const t=e[SessionPreferencesKey.showDoneEvents];this._excludeDone=1!=t;const i=this._editbar.button_(BUT.ShowDoneEvents).classList;this._excludeDone?i.add(CSS.AnToggleOff):i.remove(CSS.AnToggleOff)}super.show_()})}onRefreshEvents_(){this._shown&&this._refreshAndReportPending(!1)}_toolbarActions0(t){switch(toasters$.hideAll_(),t){case BUT.Toolbar:this._toolbar.hide_(),this._editbar.show_();break;case BUT.Toolbar1:this._editbar.hide_(),this._toolbar.show_();break;case BUT.ExportToFile:this._exportToFile();break;case BUT.ShowDoneEvents:this._excludeDone=!this._excludeDone,this._editbar.button_(BUT.ShowDoneEvents).classList.toggle(CSS.AnToggleOff),host$.updateSessionPreferences_(smapOf_(SessionPreferencesKey.showDoneEvents,!this._excludeDone),()=>{}),this._refreshAndReportPending(!0);break;case BUT.ClearEvents:if(!mainPanel$.isLoggedIn()){toasters$.error_(MSG.string_(RS.YouMustLoginToClearEvents));break}_Util.confirmKeySmall_(RS.ConfirmClearEvents,DEF.zindexConfirm,t=>{t&&host$.clearEvents_(t=>{toasters$.warn_(t),this._refreshAndReportPending(!0)})});break;default:super._toolbarActions(t)}}_exportToFile(){let t=native$.getIFrameContextPath_();const e=new Basepath(`Home/drafts/alarms-${An.simpleDateTimeString_()}.html`),i=e.dir$;Filepicker.withTitleKey_(accessories$,RS.DestinationFile,FilepickerKind.WRITE_FILE,"",null==t?null:Basepath.dir_(t),i,e.nameWithSuffix$,gestureHandler$,fileinfoUt$).zindex_(DEF.zindexPrompt).setDelegate_(FilepickerHtmlDelegate.singleton$).onOK_((t,e)=>{t(!0),host$.exportEvents_(e,t=>{if(toasters$.warn_(t))return;const i=t[Key.template],n=t[Key.text],s=An.parseUriSafe_(e,null);_GalleryGeneratorBase._createIFrame(s,"/assets/templates/todo/todo-v2.html",i,n,i=>{const n=null==i?void 0:i.contentDocument;if(null!=n&&null!=i)try{if(new _AlarmGalleryGenerator(n,t).run_()){const t=native$.serializeDocument_(n);host$.saveHtml_(e,t,()=>{mainPanel$.addIFrameReadyOneshotCallback(t=>mainPanel$.startEditCallback(t)),_Util.browseFile_(e)})}}finally{i.remove}})})}).show_()}}class _RecentsPanel extends UIPanelBase{constructor(t){super(),this._container=t,this._dirtree=[],this._sorted=!1,this._recentsHandler=new RecentsHandler;const e=new DomBuilderEx(t).push_();this._toolbar=new Toolbar(e.cursor_(),[INPUT.info_(INPUT.FilterBox),BUT.info_(BUT.Filter),BUT.info_(BUT.Sort),BUT.info_(BUT.ClearHistory),BUT.info_(BUT.RemoveBrokenEntries)]),this._toolbar.onAction_(t=>this._toolbarActions(t)),this._toolbar.onTooltips_(toasters$.onTooltipsKey_),this._dirtreePanel=e.peek_().div1_(CSS.AnViewportContent).cursor_(),An.onContextmenu_(t,t=>{An.stopevent_(t)}),An.addClickListenerMatching_(this._dirtreePanel,`div.${CSS.AnRecents} > div`,(t,e)=>{An.stopevent_(e);const i=An.parseInt_(t.getAttribute(ATTR.AnAction),null);if(null==i||i<0||i>=this._dirtree.length)return;const n=this._dirtree[i],s=n.name_(),o=n.state$;this._openfile(s,o)}),this._filterbox=this._toolbar.querySelector_(Conf.input),An.onInputFocusSelect_(this._filterbox),An.onKeypress_(this._filterbox,t=>{"Enter"==t.key&&(An.stopevent_(t),this._actionFilter())})}element_(){return this._container}_showPanel(){An.showHidden_(this._container),this._setDirtreeHeight(),An.setVisible_(this._container)}_hidePanel(){this.hideContextmenu_(),An.hide_(this._container)}resizeContent_(){}_setDirtreeHeight(){const t=this._dirtreePanel.parentElement;if(null==t)return;const e=An.documentOffset_(t).y,i=window.innerHeight-e-DEF.sidepanelMarginBottom,n=t.style;n.padding="0",n.height=`${i}px`,n.maxHeight=`${i}px`}show_(){this._shown||(this._shown=!0,this._showPanel(),this._recentsHandler.info_(t=>{this._refresh(t)}))}hide_(){this._shown&&(this._shown=!1,this._hidePanel())}_refresh(t){var e;null==t||toasters$.warn_(t)||(this._dirtree=null!==(e=FileInfo.arrayOf_(t[Key.dirtree]))&&void 0!==e?e:[],this._refreshdirtree(this._dirtreePanel,this._dirtree))}_refreshdirtree(t,e){var i,n;if(new DomBuilderEx(t).empty_(),0==e.length)return;this._sorted&&e.sort((t,e)=>t.name_().localeCompare(e.name_()));const s=this._filterbox.value.trim().toLowerCase(),o=DomBuilderEx.offline_(document,"div",{class:`${CSS.AnRecents} ${CSS.AnTextList} ${CSS.AnZebra}`}).push_(),l=e.length;for(let t=0;t<l;++t){const l=e[t],a=l.readable$,r=l.flag$,_=l.name_(),c=null!==(n=null===(i=l.state$)||void 0===i?void 0:i.y)&&void 0!==n?n:null,h=null!=c?` @${c}`:"";s.length>0&&!_.toLowerCase().includes(s)||(a?o.peek_().div_([ATTR.AnAction,`${t}`],["class",r?CSS.AnRedoItem:""]).a1_(CSS.AnFile).text_(_+h):o.peek_().div1_(r?CSS.AnRedoItem:"").span_().text_(_))}new DomBuilderEx(t).appendNodes_(o.pop_().cursor_())}_actionFilter(){this._refreshdirtree(this._dirtreePanel,this._dirtree)}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.Filter:this._actionFilter();break;case BUT.RemoveBrokenEntries:this._recentsHandler.clean_(t=>{toasters$.warn_(t),this._refresh(t)});break;case BUT.Sort:this._sorted=An.toggleOnOffButton_(this._toolbar.button_(BUT.Sort)),this._recentsHandler.info_(t=>{this._refresh(t)});break;case BUT.ClearHistory:_Util.confirmKeySmall_(RS.ActionClearHistoryMessage,DEF.zindexConfirm,t=>{t&&this._recentsHandler.clear_(t=>{toasters$.warn_(t),this._refresh(t)})});break;default:throw Assert.notReach_(t)}}_openfile(t,e){sidePanel$.hideSidepanel_(),_Util.onSaveOrDiscard_(()=>{_Util.browseFile_(t,e)})}}class _ExplorePanel extends TabPanel{constructor(t){super(t),this._shown=!1;const e=this.addTab(RS.Tooltips_FilesPanel,`${CSS.Fa} ${CSS.FaFolder}`,t=>new _FilesPanel(t));this.addTab(RS.Tooltips_CalendarPanel,`${CSS.Fa} ${CSS.FaCalendar}`,t=>new _CalendarPanel(t)),this.addTab(RS.Tooltips_EventsPanel,`${CSS.Fa} ${CSS.FaBellO}`,t=>new _EventsPanel(t)),this.addTab(RS.Tooltips_RecentsPanel,`${CSS.Fa} ${CSS.FaHistory}`,t=>new _RecentsPanel(t)),this.onTooltips(toasters$.onTooltipsKey_),this.activeTab(e),native$.addCallback_(AjaxAction.refreshEvents,()=>this._onRefreshEvents())}element_(){return this._container}_onRefreshEvents(){if(!this._shown)return null;const t=this.activePanel();return t instanceof _EventsPanel?Timer.sleep0_(()=>{t.onRefreshEvents_()}):t instanceof _CalendarPanel&&Timer.sleep0_(()=>{t.onRefreshEvents_()}),null}show_(){this._shown||(this._shown=!0,An.showHidden_(this._container),this.resizeContent_(window.innerHeight),this.selectTab(this.activeTab()),An.setVisible_(this._container))}hide_(){if(this._shown){this._shown=!1,An.hide_(this._container);const t=this.activePanel();null!=t&&t.hide_()}}resizeContent_(t){this._container.style.height=`${t}px`,super.resizeContent1(t,cache$.ui$.toolbarHeight_())}showContextmenu_(){}hideContextmenu_(){const t=this.activePanel();null!=t&&t.hideContextmenu_()}onWindowSizeChanged_(){super.onWindowSizeChanged()}}class _HtmlTemplatesPanel extends UIPanelBase{constructor(t){super(),this._shown=!1,this._populated=!1,this._container=t;const e=new DomBuilderEx(this._container).div_({class:CSS.AnContentViewport});this._viewport=e.cursor_(),e.div_({class:CSS.AnViewportContent,style:"overflow:auto"}),this._content=e.div_({class:`${CSS.AnPanel} ${CSS.AnTemplateContainer}`,style:`border-bottom:${DEF.themeBorder}`}).cursor_(),An.addClickListenerMatching_(this._content,`div.${CSS.AnTemplateCell}`,(t,e)=>{An.stopevent_(e);const i=t.getAttribute(ATTR.AnInfo);null!=i&&i.length>0&&(sidePanel$.hideSidepanel_(),_Util.newPageFromTemplateName_(i))}),Conf.useFlash&&new Flash(this._content,`div.${CSS.AnTemplateCell}`,CSS.AnFlashLowlight,DEFUtil.flashDuration),An.onContextmenu_(this._container,t=>{An.stopevent_(t)})}element_(){return this._container}show_(){this._shown||(this._shown=!0,this._populated||(this._populate(settings$.htmlTemplates_()),this._populated=!0),An.showVisible_(this._container))}resizeContent_(t){const e=t-DEF.sidepanelMarginBottom;this._viewport.style.height=`${e}px`}_populate(t){const e=new DocumentFragment,i=new Set(Object.keys(t));for(const n of i){const i=n.toLowerCase(),s=DomBuilderEx.offline_(this._content.ownerDocument,"div",smap_(["class",CSS.AnTemplateCategory],[ATTR.AnInfo,n]));e.append(s.cursor_()),s.div1_(CSS.AnTemplateHeader,`x-emoji-${i}`).text_(`${n}`),s.up_().div1_(CSS.AnTemplateContent).push_();const o=t[n];for(const t of o){const e=new TemplatesInfo(t).name_(),n=`assets/templates/${i}/${e}-tn.jpg`;s.peek_().div_(["class",CSS.AnTemplateCell],[ATTR.AnInfo,e]).img_(n)}}new DomBuilderEx(this._content).empty_().appendNodes_(e)}}class _WidgetTemplates{static create(t){sidePanel$.hideSidepanel_();const e=native$.getIFrameUri_();if(null!=e)if(t==RS.widgetAccordionTitle){const t=native$.getIFrameSelectionRange_();null!=t&&_WidgetTemplates._accordion(t)}else if(t==RS.widgetAnnotationTitle){const t=_WidgetTemplates._getAnnotationTargetRange();null!=t&&_WidgetTemplates._annotation(t,e)}else if(t==RS.widgetFlexboxTitle){const t=native$.getIFrameSelectionRange_();null!=t&&_FlexboxWidget._flexbox(t)}else if(t==RS.widgetPictureFrameTitle){const t=native$.getIFrameSelectionRange_();_WidgetTemplates._pictureframe(t,e)}else if(t==RS.widgetShoppingTitle){const t=native$.getIFrameDocument_(),e=native$.getIFrameSelectionRange_();null!=t&&null!=e&&_ShoppingWidget.create_(t,e)}else if(t==RS.widgetSidebarTabTitle)_WidgetTemplates._sidebarTab(e);else if(t==RS.widgetSidepanelTitle)_WidgetTemplates._sidepanel(e);else if(t==RS.widgetSlideshowTitle){const t=native$.getValidIFrameSelectionRange_();null!=t&&_WidgetTemplates._slideshow(t,e)}else if(t==RS.widgetStickerTitle)_WidgetTemplates._sticker(e);else if(t==RS.widgetTocTitle){const t=native$.getIFrameDocument_(),e=native$.getIFrameSelectionRange_();null!=t&&null!=e&&_TocWidget.create_(t,e)}else{if(t!=RS.widgetTodoTitle)throw Assert.notReach_(t);{const t=native$.getIFrameDocument_(),e=native$.getIFrameSelectionRange_();null!=t&&null!=e&&_TodoWidget.create_(t,e)}}}static promptStyle_(t,e){new _PromptWidgetStyle(t).zindex_(DEF.zindexPrompt).onOK_(e).show_()}static _getAnnotationTargetRange(){const t=native$.getIFrameSelectionRange_();return toasters$.warn_(JsUtil.actionWrapOK_(t))?null:t}static _accordion(t){history$.group_(RS.widgetAccordionTitle,"",()=>{const e=t.collapsed;if(e){const i=JsUtil.parentOrSelfWithClasses_(t.startContainer,[CSS.xAccordionShow,CSS.xAccordionHide]);null!=i?_WidgetTemplates._accordionSibling(i):_WidgetTemplates._accordionWrap(t,e)}else{const i=DomUt.asHTMLElement_(native$.getSingleSelectedNodeOfRange_(t));null!=i&&JsUtil.hasClasses_(i,[CSS.xAccordionShow,CSS.xAccordionHide])?_WidgetTemplates._accordionSibling(i):_WidgetTemplates._accordionWrap(t,e)}})}static _accordionSibling(t){const e=t.parentElement;null!=e&&new DomBuilderEx(e).childBefore_(t.nextSibling,"article",{class:CSS.xAccordionHide}).push_().child_("header",smap_(["class",CSS.xAccordionButton],[ATTR.xButton,`r/${CSS.xAccordionShow} ${CSS.xAccordionHide}`])).text_(""+MSG.string_(RS.Subject)).pop_().div1_(CSS.xAccordionContent).text_(MSG.string_(RS.Content))}static _accordionWrap(t,e){const i=RangeUtil.wrapRange_("div",{class:CSS.xAccordionContent},t);e&&new DomBuilderEx(i).text_(MSG.string_(RS.Content));const n=JsUtil.wrapNode_(i,"article",{class:`${CSS.xAccordionShow}`});new DomBuilderEx(n).childBefore_(i,"header",smap_(["class",CSS.xAccordionButton],[ATTR.xButton,`r/${CSS.xAccordionShow} ${CSS.xAccordionHide}`])).text_(""+MSG.string_(RS.Subject))}static _destructAccordion(t){_Util.confirmSmall_(MSG.formatArray1_(RS.destructWidgetAndContent,MSG.string_(RS.widgetAccordionTitle)),DEF.zindexConfirm,e=>{e&&JsUtil.remove_(t)})}static _annotation(t,e,i=null){const n=cache$.ui$.buttonSize_();new _PromptAnnotationStyle(accessories$,n).titleKey_(RS.PickStyle).zindex_(DEF.zindexPrompt).onOK_(e=>{const n=t.collapsed?XXX:"",s=map_();switch(function(t,e){e.withBorder&&t.set("border",DEF.themeBorder),e.withCorners&&t.set("border-radius",DEF.themeBorderRadius),e.withShadow&&t.set("box-shadow",DEF.themeBoxShadow),t.set("background-color",e.bgColor)}(s,e),e.style){case RS.widgetAnnotationStyleBasic:case RS.widgetAnnotationStyleList:this._annotationBasic(e.style,n,s,t,i);break;case RS.widgetAnnotationStyleImage:this._annotationImage1(n,s,t,i)}}).onCancel_(()=>{null==i||i(null)}).show_()}static _annotationBasic(t,e,i,n,s){_WidgetTemplates._createAnnotation(n,RS.widgetAnnotationTitle,e,CSS.xAnnotationStyleText,i,(e,i)=>{const n=new DomBuilderEx(e);t==RS.widgetAnnotationStyleList?(n.empty_().ul1_(CSS.xNone).li1_(CSS.xList),n.push_().span_({class:CSS.xBullet,style:`font-family:${DEF.FontAwesome}`}).text_(" "),n.pop_().span1_(CSS.xListContent,CSS.xPlaceholder).text_(MSG.XXX$)):n.addClass_(CSS.xPlaceholder),_MainPanel._showAnnotation1(i),null==s||s(e)})}static _destructAnnotation0(t){var e;const i=DomUt.asHTMLElement_(null===(e=t.parentNode)||void 0===e?void 0:e.parentNode);return null!=i&&native$.hasClass_(i,CSS.xAnnotation)?(_WidgetTemplates._destructAnnotation(i,!0),null):t}static _annotationImage(t,e=null){const i=map_(["border",DEF.themeBorder],["padding","10px"]);this._annotationImage1(MSG.XXX$,i,t,t=>{null==e||e(null!=t)})}static _annotationImage1(t,e,i,n=null){const s=native$.getIFrameUri_();null!=s?_MainPanel._actionInsertImg0(`class ${CSS.xImageholder} ${CSS.xImageDef}`,s,Callbacks.onReadImageFolderButton_,s=>{null!=s?_WidgetTemplates._createAnnotation(i,RS.widgetAnnotationImageTitle,t,CSS.xAnnotationStyleImage,e,(t,e)=>{const i=An.cpathOfUri_(s.src);null!=t&&null!=i?_Util.setImageOrientationOfPath_(s.attrs,i,()=>{const i=native$.iSelectNode_(t.firstChild);if(null!=i){const t=_MainPanel._createimg(i,s.caption,s);native$.replaceStyle_(t,"float","left")}_MainPanel._showAnnotation1(e),null==n||n(t)}):null==n||n(null)}):null==n||n(null)}).onCancel_(()=>{null==n||n(null)}).showCaption_(!1).show_():null==n||n(null)}static _createAnnotation(t,e,i,n,s,o){const[l,a]=history$.group_(e,"",()=>{null!=i&&i.length>0&&RangeUtil.replaceRange_(t,DomBuilderEx.createText_(i));const e=RangeUtil.wrapRange_("span",{class:CSS.xAnnotationTarget},t),o=JsUtil.wrapNode_(e,"div",{class:CSS.xAnnotation}),l=new DomBuilderEx(o);l.div1_(CSS.xSmokescreen);const a=l.div_({class:`${CSS.xAnnotationContent} ${n}`,style:CSSUtil.joinStyles_(s)}).cursor_();return l.text_(MSG.string_(RS.widgetSampleAnnotation)),[a,o]});null==o||o(l,a)}static _destructAnnotation(t,e=!1){for(const i of JsUtil.childElements_(t))if("DIV"==i.nodeName&&native$.hasClass_(i,CSS.xSmokescreen))for(const n of JsUtil.childElements_(i))if("DIV"==n.nodeName&&native$.hasClass_(n,CSS.xAnnotationContent))return void(e?_WidgetTemplates._destructAnnotation1(t,i):_Util.confirmSmall_(MSG.formatArray1_(RS.destructWidgetAndContent,MSG.string_(RS.widgetAnnotationTitle)),DEF.zindexConfirm,e=>{e&&_WidgetTemplates._destructAnnotation1(t,i)}));_WidgetTemplates._destructAnnotation1(t,null)}static _destructAnnotation1(t,e){history$.group_(RS.action_DestructAnnotation,"",()=>{try{for(const e of JsUtil.childElements_(t))if(native$.hasClass_(e,CSS.xAnnotationTarget)){new DomBuilderEx(e).up_().unwrap_(e);break}const i=new DomBuilderEx(t);null!=e&&i.removeChild_(e),i.up_().unwrap_(t)}catch(t){return void toasters$.warnKey_(RS.ERROR)}})}static _sidepanel(t){const e=native$.getIFrameBody_();if(null==e)return;const i=null!=native$.iGetElementById_(ID.xLeftSidepanel),n=null!=native$.iGetElementById_(ID.xRightSidepanel);if(i&&n)return void toasters$.warnKey_(RS.LeftAndRightSidepanelAlreadyExistsAbort);const s=MSG.string_(RS.Left),o=MSG.string_(RS.Right),l=`${cache$.ui$.toolbarFontSize_()}px`,a=_WidgetTemplates._colorGreen,r=sarray_();n||r.push(o),i||r.push(s);const _=new CompositeDialog(accessories$,[new SelectFIeld("","#side",n?s:o,RS.LeftOrRight,r),new InputSelectField("","width",`${DEF.xSidepanelWidth}`,RS.Width,CSSLength.VW,CSSLengths),new ColorField("","background-color",a,cache$.ui$.buttonSize_(),RS.BGColor)]);_.titleKey_(RS.widgetSidepanelTitle),_.zindex_(DEF.zindexPrompt),_.onOK_((i,n)=>{const s=i.getChanged_(new Map);Sanitizers.onValidateStyles_(s,t,t=>{var s;if(i.warn_(t))return void n(!1);const o=sarray_();if(Sanitizers.onValidateNonEmptyValues_(o,mapOf_("width",MSG.string_(RS.Width)),i,["width"]),o.length>0)return i.warn_(o),void n(!1);const a=i.getValueAt_(0);n(!0);const r=t[Key.result],_=r.width,c=r["background-color"],h=null!==(s=ColorUtil.getColorValue_(c,1))&&void 0!==s?s:ColorValue.X_GREY,u=ColorUtil.getAlphaColor_(h,.5).toCSSString_();history$.group_(RS.widgetSidepanelTitle,"",()=>{const t=new DomBuilderEx(e);"Left"==a?(_WidgetTemplates._createSidebarTab(e,ID.xOpenLeftSidepanel,["fa","fa-toggle-down"],u,l),t.div_({id:ID.xLeftSidepanel,class:CSS.xSmokescreen}).div_({class:CSS.xLeftSidepanel,style:`background-color:${c}; width:${_};`}).cursor_(),t.div_().text_(MSG.string_(RS.widgetSidepanelSample))):(_WidgetTemplates._createSidebarTab(e,ID.xOpenRightSidepanel,["fa","fa-toggle-up"],u,l),t.div_({class:CSS.xSmokescreen,id:ID.xRightSidepanel}).div_({class:CSS.xRightSidepanel,style:`background-color:${c}; width:${_}; left:calc(100vw - ${_});`}).cursor_(),t.div_().text_(MSG.string_(RS.widgetSidepanelSample)))})})}),_.show_()}static _destructSidepanel(t){_Util.confirmSmall_(MSG.formatArray1_(RS.destructWidgetAndContent,MSG.string_(RS.widgetSidepanelTitle)),DEF.zindexConfirm,e=>{e&&history$.group_(RS.action_DestructSidepanel,"",()=>{let e=null;switch(t.id){case ID.xRightSidepanel:e=native$.iGetElementById_(ID.xOpenRightSidepanel);break;case ID.xLeftSidepanel:e=native$.iGetElementById_(ID.xOpenLeftSidepanel);break;default:return void toasters$.warnKey_(RS.WidgetNotFound)}JsUtil.remove_(t),null!=e&&JsUtil.remove_(e)})})}static _sidebarTab(t){_Util.promptValues_(RS.widgetSidebarTabTitle,[new UriField("","",HumanLink.Empty$,RS.URL,t,[BUT.PathKind,BUT.Folder],Callbacks.onLinkFolderButton_),new InputField("","","",RS.PlaceholderRequiredText),new ColorField("","",_WidgetTemplates._sidebarPalette0,cache$.ui$.buttonSize_(),RS.BGColor)]).zindex_(DEF.zindexPrompt).onOK_((e,i)=>{var n,s;const o=sarray_(),l=e.getValueAt_(1);0==l.length&&o.push(MSG.string1_(RS.inputMustNotBeEmpty_,MSG.string_(RS.Text)));const a=e.getValueAt_(2),r=ColorUtil.getColorValue_(a);null==r&&o.push(MSG.string_(RS.InvalidColor_)+a);const _=e.getValueAt_(0),c=null===(n=Sanitizers.checkOptionalHref_(_,t).onFail_(t=>{o.push(...t)}))||void 0===n?void 0:n.result_();if(o.length>0||null==r)return e.warn_(o),void i(!1);i(!0),_WidgetTemplates._sidebarTab1(r,l,null!==(s=null==c?void 0:c.toString())&&void 0!==s?s:null)}).show_()}static _sidebarTab1(t,e,i){const n=native$.getIFrameBody_();if(null==n)return;const s=t.toCSSString_();history$.group_(RS.widgetSidebarTabTitle,e,()=>{_WidgetTemplates._createSidebarTab(n,null,null,s,null,i).text_(e)})}static _createSidebarTab(t,e,i,n,s,o=null){let l,a=native$.iGetElementById_(ID.xRightSidebar);if(null==a)a=(l=new DomBuilderEx(t)).div_({id:ID.xRightSidebar}).cursor_(),l.div1_(CSS.xRightSidebarContent),l.div1_(CSS.xRightSidebarPadding);else{const t=a.firstElementChild;null==t||null==t.lastElementChild?(toasters$.warnKey_(RS.InvalidSidebarStructure),(l=new DomBuilderEx(a)).div1_(CSS.xRightSidebarContent),l.div1_(CSS.xRightSidebarPadding)):l=new DomBuilderEx(t.lastElementChild)}null!=o&&o.length>0?l.siblingBefore_("a",{class:CSS.xRightSidebarTab,href:null!=o?o:""}):l.siblingBefore_("div",{class:CSS.xRightSidebarTab}),null!=e&&l.attr_("id",e),null!=i&&l.addClasses_(i);const r=ssmap_();return null!=n&&(r["background-color"]=n),null!=s&&(r["font-size"]=s),l.addStyles_(r),l}static _destructSidebarTab(t){_Util.confirmSmall_(MSG.format1_(RS.destructWidget,MSG.string_(RS.widgetSidebarTabTitle)),DEF.zindexConfirm,e=>{e&&history$.group_(RS.action_DestructSidebarTab,"",()=>{let e=null;const i=t.getAttribute("id");ID.xOpenLeftSidepanel==i?e=native$.iGetElementById_(ID.xLeftSidepanel):ID.xOpenRightSidepanel==i&&(e=native$.iGetElementById_(ID.xRightSidepanel)),null!=e&&JsUtil.remove_(e),JsUtil.remove_(t)})})}static _slideshow(t,e){const i=native$.getSelectedNodesOfRange_(t);if(null==i)return void toasters$.warnKey_(RS.widgetSlideshowInvalidSelection);let n=0,s=0;const o=new Array;for(const t of i)switch(t.nodeType){case Node.ELEMENT_NODE:{if("IMG"!=t.nodeName){JsUtil.hide_(t);continue}const e=t;o.push(e);const i=e.naturalWidth,l=e.naturalHeight;null!=i&&i>n&&(n=i),null!=l&&l>s&&(s=l);break}case Node.TEXT_NODE:JsUtil.isWhitespaceNode_(t)||toasters$.warnKey_(RS.widgetSlideshowInvalidSelection);break;case Node.COMMENT_NODE:break;default:toasters$.warnKey_(RS.widgetSlideshowInvalidSelection)}if(0==o.length)return void toasters$.okKey_(RS.widgetSlideshowNoImageFound,{attop:!0});const l=n>0?n:window.innerWidth/2,a=s>0?s:window.innerHeight/2,r=new CompositeDialog(accessories$,[new InputSelectField(RS.Width,"width",`${l}`,RS.PlaceholderRequiredWidth,CSSLength.PX,CSSLengths),new InputSelectField(RS.Height,"height",`${a}`,RS.PlaceholderRequiredHeight,CSSLength.PX,CSSLengths),new InputSelectField(RS.Duration,"#Xr2","5",RS.PlaceholderRequiredDuration,MSG.string_(RS.sec),[MSG.string_(RS.ms),MSG.string_(RS.sec),MSG.string_(RS.min),MSG.string_(RS.hour)]),new InputField(RS.Caption,"#XIy","",RS.Caption)]);r.titleKey_(RS.widgetSlideshowTitle),r.zindex_(DEF.zindexPrompt),r.onOK_((i,n)=>{const s=map_(["width",i.getValue_("width")],["height",i.getValue_("height")]);Sanitizers.onValidateStyles_(s,e,e=>{if(i.warn_(e))return void n(!1);const s=sarray_();if(Sanitizers.onValidateNonEmptyValues_(s,map_(["width",MSG.string_(RS.Width)],["height",MSG.string_(RS.Height)],["#Xr2",MSG.string_(RS.Duration)]),i,["width","height","#Xr2"]),s.length>0)return i.warn_(s),void n(!1);const l=i.getValue_("#XIy"),a=i.getValue_("#Xr2");n(!0);const r=e[Key.result],_=r.width,c=r.height,h=An.msFromStringTimeUnit_(a,5e3);history$.group_(RS.widgetSlideshowTitle,"",()=>{if(null!=l&&l.length>0){const e=RangeUtil.wrapRange_("div",{class:CSS.xSlideshowContent,style:`flex: 0 0 auto;width:${_};height:${c};animation-duration:${h}ms;`},t);new DomBuilderEx(e).append_("div",{class:CSS.xSlideshowPlay}).up_().childBefore_(e,"div",{class:CSS.xSlideshow}).appendNodes_(e).div_({style:`flex: 0 0 auto;box-sizing:border-box;width:${_};padding:5px 0;`}).text_(l)}else{const e=RangeUtil.wrapRange_("div",{class:CSS.xSlideshowContent,style:`flex: 0 0 auto;width:${_};height:${c};animation-duration:${h}ms;`},t);JsUtil.wrapNode_(e,"div",{class:CSS.xSlideshow}),new DomBuilderEx(e).append_("div",{class:CSS.xSlideshowPlay})}const e=[CSS.xSlideshowImage];for(let t=0;t<o.length;++t){const i=o[t];native$.removeAddClasses_(i,null,e);const n=i.getAttribute("style");JsUtil.setAttribute0_(i,ATTR.AnSaved,n);const s=i.style;0==t&&(s.display="inline",s.opacity="0.5"),s.width=_,s.height=c}})})}),r.show_()}static _destructSlideshow(t){_Util.confirmSmall_(MSG.format1_(RS.destructWidget,MSG.string_(RS.widgetSlideshowTitle)),DEF.zindexConfirm,e=>{e&&history$.group_(RS.action_DestructSlideshow,"",()=>{const e=JsUtil.childElementWithClass_(t,CSS.xSlideshowContent);if(null!=e){for(let i=t.firstChild,n=null;null!=i;i=n)n=i.nextSibling,native$.hasClass_(i,CSS.xSlideshowContent)?(_WidgetTemplates._undoSlideshow1(e),new DomBuilderEx(i).up_().unwrap_(i)):t.removeChild(i);new DomBuilderEx(t).up_().unwrap_(t)}else toasters$.warnKey_(RS.InvalidWidgetStructureForUndo)})})}static _undoSlideshow1(t){for(let e=t.firstChild,i=null;null!=e;e=i){if(i=e.nextSibling,e.nodeType!=Node.ELEMENT_NODE)continue;switch(e.nodeName){case"IMG":{const t=e;t.classList.remove(CSS.xSlideshowImage);const i=t.getAttribute(ATTR.AnSaved);t.removeAttribute(ATTR.AnSaved),JsUtil.setAttribute0_(t,"style",i);break}case"DIV":t.removeChild(e)}}}static _pictureframe(t,e){if(toasters$.warn_(JsUtil.actionWrapOK_(t))||null==t)return;const i=cache$.ui$.buttonSize_(),n=MSG.string_(RS.Static),s=new CompositeDialog(accessories$,[new SelectFIeld(RS.Positioning,"#XgF",n,RS.Positioning,[MSG.string_(RS.Static),MSG.string_(RS.FloatLeft),MSG.string_(RS.FloatRight)]),new SelectFIeld(RS.Clear,"clear",MSG.string_(RS.None),RS.Clear,[MSG.string_(RS.None),MSG.string_(RS.Left),MSG.string_(RS.Right),MSG.string_(RS.Both)]),new SelectFIeld(RS.Scrollable,"#XIG",MSG.string_(RS.True),RS.Scrollable,[MSG.string_(RS.True),MSG.string_(RS.False)]),new InputSelectField(RS.Width,"width","",RS.Width,CSSLength.PX,CSSLengths),new InputSelectField(RS.Height,"height","",RS.Height,CSSLength.PX,CSSLengths),new InputSelectField(RS.Padding,"padding","10",RS.Padding,CSSLength.PX,CSSLengths),new InputField(RS.Border,"border",DEF.themeBorder,RS.Border),new InputSelectField(RS.Margin,"margin","10",RS.Margin,CSSLength.PX,CSSLengths),new ColorField(RS.BGColor,"background-color","",i,RS.BGColor),new InputField(RS.Caption,"#XNQ","",RS.Caption)]);s.titleKey_(RS.widgetPictureFrameTitle),s.zindex_(DEF.zindexPrompt),s.setVisible_("clear",!1),s.onChange_((t,e)=>{if("#XgF"==t.spec$.key$){const t=e.getValue_(n);s.setVisible_("clear",t==MSG.string_(RS.FloatLeft)||t==MSG.string_(RS.FloatRight))}}),s.onOK_((i,n)=>{Sanitizers.onValidateStyles_(i.getChanged_(new Map),e,e=>{if(i.warn_(e))return void n(!1);const s=e[Key.result],o=i.getValue_("#XgF"),l=s.clear;s.clear=void 0;const a=_Util.getRotation_(i.getValue_("#XNa"),0),r="True"==i.getValue_("#XIG"),_=i.getValue_("#XNQ");n(!0);const c=null!=_&&_.trim().length>0,h=r?"auto":"hidden";s.transform="",s.display="inline-block";const u=t.collapsed;history$.group_(RS.widgetPictureFrameTitle,"",()=>{let e;if(0==a){s.overflow=h,c&&(s.flex="0 0 auto"),s["box-sizing"]="content-box";const i=CSSUtil.joinStyles1_(Object.entries(s));e=RangeUtil.wrapRange_("div",{style:i},t),u&&new DomBuilderEx(e).addClass_(CSS.xPlaceholder).text_(MSG.XXX$)}else{const i=map_(["box-sizing","border-box"],["width",s.width],["height",s.height],["overflow",h]);c&&i.set("flex","0 0 auto"),e=RangeUtil.wrapRange_("div",{style:CSSUtil.joinStyles_(i)},t),u&&new DomBuilderEx(e).addClass_(CSS.xPlaceholder).text_(MSG.XXX$);const n=e.style,o=native$.getComputedStyle_(e,null,["width","height"]),l=o.get("height"),r=o.get("width");switch(a){case 0:n.transform="",n.transformOrigin="";break;case 90:n.width=r,n.height=l,n.transform=`translateX(${l}) rotate(${a}deg)`,n.transformOrigin="0 0";break;case 180:n.transform=`rotate(${a}deg)`,n.transformOrigin="50% 50%";break;case 270:n.width=r,n.height=l,n.transform=`translateY(${r}) rotate(${a}deg)`,n.transformOrigin="0 0"}const _=map_(["display","inline-block"],["box-sizing","content-box"],["margin",s.margin],["border",s.border],["padding",s.padding],["background-color",s["background-color"]]);An.removeEmptyValues_(_);const d=new DomBuilderEx(e).wrap_("div",{class:`${CSS.xRotate} ${CSS.xPictureframeRotated}`,style:CSSUtil.joinStyles_(_)}).cursor_();if(90==a||270==a){const t=d.style;t.width=`${l}`,t.height=`${r}`}else{const t=d.style;t.width=`${r}`,t.height=`${l}`}e=d}c?(o==MSG.string_(RS.FloatRight)&&native$.replaceStyle_(e,"align-self","flex-end"),e=_WidgetTemplates._wrapWithCaption1(e,_)):0==a&&(e=JsUtil.wrapNode_(e,"div")),o==MSG.string_(RS.FloatLeft)?native$.setStyles_(e,map_(["float","left"],["clear",l])):o==MSG.string_(RS.FloatRight)&&native$.setStyles_(e,map_(["float","right"],["clear",l])),null==e||e.classList.add(CSS.xPictureframe)})})}),s.show_()}static _destructPictureFrame(t){const e=t.children;switch(e.length){case 1:return void _WidgetTemplates._destructPictureFrame1(t,e[0]);case 2:const i=e[0];if(!native$.hasClass_(i,CSS.xPictureframeRotated))return void _WidgetTemplates._destructPictureFrame1(t,i);{const e=i.children;if(1==e.length)return void _WidgetTemplates._destructPictureFrame1(t,e[0])}}toasters$.warnKey_(RS.InvalidWidgetStructureForUndo)}static _destructPictureFrame1(t,e){_Util.confirmSmall_(MSG.format1_(RS.destructWidget,MSG.string_(RS.widgetPictureFrameTitle)),DEF.zindexConfirm,i=>{i&&history$.group_(RS.action_DestructPictureFrame,"",()=>{new DomBuilderEx(t).up_().moveChildrenBefore_(t,e.firstChild,null).removeChild_(t)})})}static _sticker(t){const e=native$.getValidIFrameSelectionRange_();if(null==e)return void toasters$.warnKey_(RS.ActionRequireAValidSelection);const i=new _PromptStickerStyle(accessories$,cache$.ui$.buttonSize_());i.titleKey_(RS.PickStyle),i.zindex_(DEF.zindexPrompt),i.onOK_(i=>{_WidgetTemplates._sticker1(e,t,i)}),i.show_()}static _sticker1(t,e,i){const n=native$.getIFrameBody_();if(null==n)return;const s=MSG.string_(RS.StickOnDocument),o=new CompositeDialog(accessories$,[new SelectFIeld("","",s,RS.Positioning,[s,MSG.string_(RS.StickOnScreen)]),new InputSelectField("","width","16",RS.PlaceholderRequiredWidth,CSSLength.REM,CSSLengths)]);switch(o.titleKey_(RS.widgetStickerTitle),o.zindex_(DEF.zindexPrompt),o.onOK_((o,l)=>{Sanitizers.onValidateStyles_(o.getChanged_(),e,e=>{if(o.warn_(e))return void l(!1);const a=sarray_();if(Sanitizers.onValidateNonEmptyValues_(a,mapOf_("width",MSG.string_(RS.Width)),o,["width"]),a.length>0)return o.warn_(a),void l(!1);const r=o.getValueAt_(0);l(!0);const _=e[Key.result];An.removeEmptyValues1_(_),history$.group_(RS.widgetStickerTitle,"",()=>{_["box-sizing"]="border-box";let e=40,o=40,l=RangeUtil.rangeStart_(t);for(null==l&&(l=t.startContainer);null!=l&&l.nodeType!=Node.ELEMENT_NODE;)l=l.parentNode;const a=null==l?null:l;if(r==s)null!=a&&(e=a.offsetLeft,o=a.offsetTop);else if(null!=a){const t=native$.getBoundingClientRect_(a);null!=t&&(e=Math.round(t.left),o=Math.round(t.top))}_.left=`${e}px`,_.top=`${o}px`;const c=_WidgetTemplates._sticker2(i,n,_);if(r==s){if(t.collapsed)RangeUtil.insertNode_(t,c);else{let e=null,i=t.endContainer;i.nodeType==Node.ELEMENT_NODE?e=i.childNodes[t.endOffset]:(e=i.nextSibling,i=i.parentNode),null==i||i.insertBefore(c,e)}native$.removeAddClasses_(c,null,[CSS.xSticker,CSS.xStickOnDocument,CSS.xDraggable,CSS.xZTop])}else new DomBuilderEx(n).appendNodes_(c),native$.removeAddClasses_(c,null,[CSS.xSticker,CSS.xStickOnScreen,CSS.xDraggable,CSS.xZTop])})})}),i.style){case RS.widgetStickerStyleBadge:o.setValue_("width","8rem");break;case RS.widgetStickerStyleCanvas:const l=DialogUt.defaultCanvasDimension_(cache$.ui$.toolbarHeight_()),a=MediaUtil.fit_(l.x,l.y,180,240);o.setValue_("width",`${a.x}px`)}o.show_()}static _sticker2(t,e,i){const n=MSG.XXX$;let s,o;switch(t.withBorder&&(i.border=DEF.themeBorder),t.withShadow&&(i["box-shadow"]=DEF.themeBoxShadow),t.withCorners&&t.style!=RS.widgetStickerStyleBadge&&(i["border-radius"]=DEF.themeBorderRadius),i.padding="1.5ex 1em",i["background-color"]=t.bgcolor,t.style){case RS.widgetStickerStyleBadge:return _WidgetTemplates._createStickerBadge(t,e,i);case RS.widgetStickerStyleImage:s=e=>{_WidgetTemplates._stickerActionsCallback(e,t.withHeader)},o=t=>{t.push_().div_().ahref_(PATH._assetsImagesSamplesLamp+`?${Param.view}`).img_(PATH._assetsImagesSamplesLamp,{class:CSS.xImageholder,style:"max-width:100%;float:left;"}).up_().div_({style:"clear:both;padding-top:1ex;"}).text_(n).pop_()};break;case RS.widgetStickerStyleCanvas:s=e=>{_WidgetTemplates._stickerActionsCallback(e,t.withHeader)},o=t=>{const e=DialogUt.defaultCanvasDimension_(cache$.ui$.toolbarHeight_()),n=i.width;delete i.width;const s=t.push_().div_().img_(["class",CSS.xCanvas],["style",`max-width:${n};`],[ATTR.xAnnotation,`{${ScribblerHistory.WIDTH}:${e.x},${ScribblerHistory.HEIGHT}:${e.y}`]).cursor_();t.pop_(),Timer.sleep0_(()=>{const t=An.parseIntUnit_(n),i=null==t?180:t[0],o=MediaUtil.optionalDimension0_(i,null,e.x,e.y).y;mainPanel$.actionAnnotateCanvas1_(s,e.x,e.y,i,o,ColorValue.X_TRANSPARENT,null,()=>{})})};break;default:s=e=>{_WidgetTemplates._stickerActionsCallback(e,t.withHeader)},o=t=>{t.push_().div1_(CSS.xPlaceholder).text_(n).pop_()}}return t.withHeader?_WidgetTemplates._createStickerWithSubject1(e,i,s,o):_WidgetTemplates._createSticker1(e,i,s,o)}static _createStickerBadge(t,e,i){i["border-radius"]="50%",i.height=i.width,i["align-items"]="center",i["justify-content"]="center",i.display="flex",i["flex-direction"]="column",i["text-align"]="center";const n=CSSUtil.joinStyles1_(Object.entries(i)),s=DomBuilderEx.offline_(e.ownerDocument,"div",{style:n});return s.push_().div_({class:CSS.xShowInEdit,style:"margin-bottom:0.5ex"}).span_(["class","fa fa-arrows"],[ATTR.xButton,ClientAction.move]),t.withHeader&&s.peek_().div1_(CSS.xSubject).div1_(CSS.xPlaceholder).text_(MSG.string_(RS.Subject)),s.peek_().div_({class:CSS.xContent,style:t.withHeader?"flex:unset;":"flex:unset;padding:0;"}).div1_(CSS.xPlaceholder).text_(MSG.XXX$),s.pop_().cursor_()}static _stickerActionsCallback(t,e){const i=smap_(["class",`${CSS.xFloatRightClearNone} ${CSS.xShowInEdit} fa fa-arrows`],[ATTR.xButton,ClientAction.move]);e||(i.style="padding-bottom:10px");const n=smap_(["class",`${CSS.xFloatRightClearNone}  ${CSS.xShowInEdit} fa fa-retweet`],[ATTR.xButton,`${ClientAction.cycle}${CSS.xZTop} ${CSS.xZUpper} ${CSS.xZMiddle} ${CSS.xZLower} ${CSS.xZBottom}/${CSS.xSticker}`]),s=smap_(["class",`${CSS.xFloatRightClearNone}  ${CSS.xShowInEdit} fa fa-eye-slash`],[ATTR.xButton,`${ClientAction.hide}${CSS.xSticker}`]);e||(s.style="padding-bottom:10px;"),t.push_().span_(i),t.peek_().span_(n),t.peek_().span_(s),t.pop_()}static _createSticker1(t,e,i,n){const s=CSSUtil.joinStyles1_(Object.entries(e)),o=DomBuilderEx.offline_(t.ownerDocument,"div",{style:s});return i(o),n(o),o.cursor_()}static _createStickerWithSubject1(t,e,i,n){e.display="flex",e["flex-direction"]="column";const s=CSSUtil.joinStyles1_(Object.entries(e)),o=DomBuilderEx.offline_(t.ownerDocument,"div",{style:s});return o.indent_(o.push_().div1_(CSS.xSubject).indent_(o.push_(),i(o),o.pop_().div1_(CSS.xPlaceholder).text_(MSG.string_(RS.Subject))),o.peek_().div1_(CSS.xContent),n(o),o.pop_()).cursor_()}static _wrapWithCaption1(t,e){const i=native$.getComputedStyle_(t,null,["width","margin-left","margin-right","margin-bottom"]),n=new DomBuilderEx(t).addStyles_({"margin-bottom":null}).up_().childBefore_(t,"div").push_(),s=n.cursor_();return n.up_().removeChild_(t).pop_().child_(t).up_().div_({style:CSSUtil.joinStyles1_(Object.entries({flex:"0 0 auto","box-sizing":"border-box","margin-top":"5px","margin-left":`${i.get("margin-left")}`,"margin-right":`${i.get("margin-right")}`,"margin-bottom":`${i.get("margin-bottom")}`}))}).text_(e),s}static _destructSticker(t){_WidgetTemplates._destructSticker1(t)}static _destructSticker1(t){_Util.confirmSmall_(MSG.formatArray1_(RS.destructWidgetAndContent,MSG.string_(RS.widgetStickerTitle)),DEF.zindexConfirm,e=>{e&&history$.group_(RS.action_DestructSticker,"",()=>{JsUtil.remove_(t)})})}static _actionDestructWidget(){const t=native$.getSingleSelectedNode_();if(null==t||t.nodeType!=Node.ELEMENT_NODE)return toasters$.warnKey_(RS.ActionRequireASingleElementSelection),!1;const e=t,i=e.nodeName,n=e.classList;if(n.contains(CSS.xAccordionShow)||n.contains(CSS.xAccordionHide))return _WidgetTemplates._destructAccordion(e),!0;if(n.contains(CSS.xAccordionContent)){const t=JsUtil.parentWithClasses_(e,[CSS.xAccordionShow,CSS.xAccordionHide]);if(null!=t)return _WidgetTemplates._destructAccordion(t),!0}if(n.contains(CSS.xAnnotationTarget)){const t=e.parentElement;return null!=t&&_WidgetTemplates._destructAnnotation(t),!0}if(n.contains(CSS.xRightSidebarTab))return _WidgetTemplates._destructSidebarTab(e),!0;if("DIV"==i){if(n.contains(CSS.xAnnotation))return _WidgetTemplates._destructAnnotation(e),!0;if(n.contains(CSS.xFlexbox))return _FlexboxWidget._destructFlexbox(e),!0;if(n.contains(CSS.xPictureframe))return _WidgetTemplates._destructPictureFrame(e),!0;if(n.contains(CSS.xSticker))return _WidgetTemplates._destructSticker(e),!0;if(n.contains(CSS.xSlideshow))return _WidgetTemplates._destructSlideshow(e),!0}if(n.contains(CSS.xSlideshowImage))for(let t=e.parentElement;null!=t;t=t.parentElement)if("DIV"==t.nodeName&&native$.hasClass_(t,CSS.xSlideshow))return _WidgetTemplates._destructSlideshow(t),!0;const s=e.id;return s==ID.xRightSidepanel||s==ID.xLeftSidepanel?(_WidgetTemplates._destructSidepanel(e),!0):(toasters$.warnKey_(RS.WidgetNotFound),!1)}}_WidgetTemplates._sidebarPalette0="rgba(160,160,160,0.5)",_WidgetTemplates._colorYellow="#fff000",_WidgetTemplates._colorGreen="#8c7",_WidgetTemplates._colorBlue="#9cf",_WidgetTemplates._colorWhite="#fff",_WidgetTemplates._INFOS=[[RS.widgetAccordionTitle,`${CSS.Fa} ${CSS.FaChevronCircleUp}`],[RS.widgetAnnotationTitle,`${CSS.Fa} ${CSS.FaCommentO}`],[RS.widgetFlexboxTitle,`${CSS.Fa} ${CSS.FaColumns}`],[RS.widgetPictureFrameTitle,`${CSS.Fa} ${CSS.FaImage}`],[RS.widgetShoppingTitle,`${CSS.Fa} ${CSS.FaShoppingCart}`],[RS.widgetSidebarTabTitle,`${CSS.Fa} ${CSS.FaBookmark}`],[RS.widgetSidepanelTitle,`${CSS.Fa} ${CSS.FaSignOut}`],[RS.widgetSlideshowTitle,`${CSS.Fa} ${CSS.FaSlideshare}`],[RS.widgetStickerTitle,`${CSS.Fa} ${CSS.FaCertificate}`],[RS.widgetTocTitle,`${CSS.Fa} ${CSS.FaListUl}`],[RS.widgetTodoTitle,`${CSS.Fa} ${CSS.FaCheckSquareO}`]];class _GlobalSearchPanel extends UIPanelBase{constructor(t){super(),this._shown=!1,this._searchText=null,this._container=t,this._searchbar=new Toolbar(this._container,[INPUT.searchbox(RS.Tooltips_SearchRegex,"1"),BUT.info_(BUT.IgnoreCase),BUT.info_(BUT.RegexSearch)]),this._searchbar.onAction_(t=>this._toolbarActions(t)),this._searchbar.onTooltips_(toasters$.onTooltipsKey_),this._filterbar=new Toolbar(this._container,[INPUT.searchbox(RS.Tooltips_FilepathFilter,"2"),BUT.info_(BUT.IgnoreCaseFilter),BUT.info_(BUT.ClearSearchText)]),this._filterbar.onAction_(t=>this._toolbarActions(t)),this._filterbar.onTooltips_(toasters$.onTooltipsKey_),this._searchbar.element_().style.borderBottomColor="transparent";const e=new DomBuilderEx(this._container).div1_(CSS.AnViewport);this._content=e.div_().cursor_(),this._filefilter=this._filterbar.querySelector_(Conf.input),this._searchbox=this._searchbar.querySelector_(Conf.input),An.onInputFocusSelect_(this._filefilter),An.onInputEnterKeyStop_(this._filefilter),An.onInputFocusSelect_(this._searchbox),An.onInputEnterKey_(this._searchbox,()=>{this._toolbarActions(BUT.RegexSearch)})}element_(){return this._container}show_(){if(!this._shown){if(this._shown=!0,0==this._searchbox.value.length){const t=native$.getIFrameSelectionRange_();if(null!=t&&!t.collapsed){const e=this._getsimpletext(t).trim();this._searchbox.value=e,An.select_(this._searchbox)}}An.showVisible_(this._container)}}hide_(){this._shown&&(this._shown=!1,An.hide_(this._container))}_getsimpletext(t){var e,i;const n=RangeUtil.rangeStart_(t);if(RangeUtil.rangeEnd_(t)!=n)return"";const s=n.nodeType;if(s==Node.TEXT_NODE)return(null!==(e=n.nodeValue)&&void 0!==e?e:"").substring(t.startOffset,t.endOffset);if(s!=Node.ELEMENT_NODE)return"";const o=n.childNodes;return null!=o&&1==o.length&&o[0].nodeType==Node.TEXT_NODE&&null!==(i=o[0].nodeValue)&&void 0!==i?i:""}resizeContent_(t){const e=t-2*cache$.ui$.toolbarHeight_()-DEF.sidepanelMarginBottom;this._content.style.height=`${e}px`}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.RegexSearch:this._search(!0);break;case BUT.IgnoreCase:_Util.toggleIgnorecase_(this._searchbar.button_(BUT.IgnoreCase));break;case BUT.IgnoreCaseFilter:_Util.toggleIgnorecase_(this._filterbar.button_(BUT.IgnoreCaseFilter));break;case BUT.ClearSearchText:this._filefilter.value="",this._searchbox.value="",new DomBuilderEx(this._content).empty_();break;default:throw Assert.notReach_(t)}}_search(t){const e=new StepTimer;e.debug_("# _GlobalSearchPanel.search(): start");const i=this._searchbox.value;if(0==i.length)return toasters$.infoKey_(RS.PleaseSpecifySearchText,{attop:!0}),void new DomBuilderEx(this._content).empty_();const n=this._filefilter.value,s=An.isButtonOn_(this._filterbar.button_(BUT.IgnoreCaseFilter)),o=An.isButtonOn_(this._searchbar.button_(BUT.IgnoreCase));host$.globalSearch_(s,n,o,i,t,n=>{const s=n[Key.result],l=n=>{if(!toasters$.warn_(n)&&this._shown){if(null!=n[Key.busy])return toasters$.infoKey_(RS.PleaseWaitWhileIndexerIsBusy,{attop:!0}),void Timer.sleep_(250,()=>{host$.globalSearchResult_(s,t,l)});toasters$.hideInfo_(),this._refresh(e,o,i,t,n)}};host$.globalSearchResult_(s,t,l)})}refresh(){}_refresh(t,e,i,n,s){t.debug_("# _GlobalSearchPanel.refresh(): start"),this._populate(e,i,n,s),t.debug_("# _GlobalSearchPanel.refresh(): end")}_populate(t,e,i,n){var s;const o=new DomBuilderEx(this._content).empty_(),l=null!==(s=n[Key.result])&&void 0!==s?s:json_(),a=Object.keys(l);if(0==a.length)return toasters$.infoKey_(RS.SearchResultIsEmpty,{attop:!0}),void new DomBuilderEx(this._content).empty_();const r=a.sort().map(t=>[t,l[t]]),_=DomBuilderEx.offline1_(document,"div",CSS.AnViewportContent).push_();_.div1_(CSS.AnTextList,CSS.AnZebra).push_(),_.div1_(CSS.AnSec).text_(`${MSG.string_(RS.Result)}: ${r.length}`);for(const[t,e]of r)_.peek_().div2_(ATTR.AnAction,t).span1_(CSS.AnLnk).text_(t),null!=e&&_.up_().text_(":").span1_(CSS.AnTag).text_(`${e.length}`);const c=_.pop_(2).cursor_();o.appendNodes_(c),An.addClickListenerMatching_(c,`div.${CSS.AnTextList} > div`,(n,s)=>{An.stopevent_(s);const o=n.getAttribute(ATTR.AnAction);null!=o&&this._openfile1(o,t,e,i)})}_openfile1(t,e,i,n){sidePanel$.hideSidepanel_(),_Util.onSaveOrDiscard_(()=>{_Util.browseFile_(t,null,!1,e,i,n)})}}class _UISettingsPanel extends UIPanelBase{constructor(t){super(),this._toolbarButtons=new Map,this._shown=!1,this._container=t;const e=new Toolbar(this._container,[BUT.info_(BUT.ResetUISettings),BUT.info_(BUT.Apply),BUT.info_(BUT.Cancel)]);e.onAction_(t=>this._toolbarActions(t)),e.onTooltips_(toasters$.onTooltipsKey_);const i=new DomBuilderEx(this._container).div1_(CSS.AnContentViewport);this._viewport=i.cursor_(),this._content=i.div_().cursor_()}element_(){return this._container}show_(){this._shown||(this._shown=!0,null==this._toolbarSample?this._create():this._reset(settings$.current_()),An.showVisible_(this._container))}hide_(){this._shown&&(this._shown=!1,this._reset(settings$.current_()),An.hide_(this._container))}resizeContent_(t){if(null!=this._viewport){const e=t-cache$.ui$.toolbarHeight_()-DEF.sidepanelMarginBottom;this._viewport.style.height=`${e}px`}}contextActions(){}_buttonsample(t,e){const i=`${e}px`,n=`${e/2}px`;t.style.height=i;for(const e of Array.from(DomUt.queryAll_(t,`div.${CSS.AnButton}`))){const t=e.style;t.flexBasis=i,t.lineHeight=i,t.minHeight=i,t.height=i,t.fontSize=n}}_setuifont(t,e,i){this._inputFontName.setValue_(t);const n=DialogUt.populateFontStyle_(this._inputFontStyle,[],settings$.fontInfo_(t),e);i>DEF.maxFontSize&&(i=DEF.maxFontSize),this._inputFontSize.setValue_(i.toString()),this._fontSample.style.fontFamily=FontUtil.fontFamilyOf_(t,n),this._fontSample.style.fontSize=`${i}px`}_setfixedfont(t,e,i){this._inputFixedName.setValue_(t);const n=DialogUt.populateFontStyle_(this._inputFixedStyle,[],settings$.fontInfo_(t),e);this._fixedSample.style.fontFamily=FontUtil.fontFamilyOf_(t,n),this._fixedSample.style.fontSize=`${i}px`}_reset(t){DialogUt.populateFontName_(this._inputFontName,[],settings$.fontFamilies_(),FontCategories.All,t.uiFontName$),this._inputButtonSize.setValue_(t.buttonSize$.toString()),this._buttonsample(this._toolbarSample,t.buttonSize$),this._inputFontCategory.setValue_(FontCategories.All),this._setuifont(t.uiFontName$,t.uiFontStyle$,t.uiFontSize$),this._setfixedfont(t.fixedFontName$,t.fixedFontStyle$,t.uiFontSize$),this._inputDialogBGColor.textContent=ColorUtil.validateColor_(t.dialogBGColor$,"red"),this._dialogBGColorSample.style.backgroundColor=t.dialogBGColor$,this._inputHeadingColor.textContent=ColorUtil.validateColor_(t.headingColor$,"red"),this._headingColorSample.style.backgroundColor=t.headingColor$,this._inputLinkColor.textContent=ColorUtil.validateColor_(t.linkColor$,"red"),this._linkColorSample.style.backgroundColor=t.linkColor$,this._inputAnnotationColor.textContent=ColorUtil.validateColor_(t.annotationColor$,"red"),this._annotationColorSample.style.backgroundColor=t.annotationColor$,this._inputHighlightColor.textContent=ColorUtil.validateColor_(t.highlightColor$,"red"),this._highlightColorSample.style.backgroundColor=t.highlightColor$,this._inputDateFormat.setValue_(t.dateFormat$),this._inputTimeFormat.setValue_(t.timeFormat$),this._inputImportImageDimension.setValue_(`${t.imageDimension$}`)}_create(){const t=new StepTimer;t.debug_("# UiSettingsPanel.create(): start");const e=settings$,i=e.current_(),n=DomBuilderEx.offline_(this._content.ownerDocument,"div",{class:CSS.AnPanel,style:`padding: 10px; border-bottom: ${DEF.themeBorder}; `}).push_(),s=n.cursor_();this._inputButtonSize=DialogUt.textSelect_(accessories$,n,MSG.string_(RS.ButtonSize),RS.ButtonSize),this._toolbarSample=n.peek_().div1_(CSS.AnMarginV5).div_({class:CSS.AnToolbar,style:`overflow:hidden;border:${DEF.themeBorder};border-radius: 3px;`}).push_().cursor_(),n.peek_().div1_(CSS.AnButton,CSS.Fa,CSS.FaEdit),n.peek_().div1_(CSS.AnButton,CSS.Fa,CSS.FaPlusCircle),n.peek_().div1_(CSS.AnButton,CSS.Fa,CSS.FaArrowCircleLeft),n.peek_().div1_(CSS.AnButton,CSS.Fa,CSS.FaHome),n.pop_(),this._inputFontCategory=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.Category),RS.Category),this._inputFontName=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.UIFont),RS.UIFont),this._inputFontStyle=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.Style),RS.Style),this._inputFontSize=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.Size),RS.Size),this._fontSample=this._fontsample(n.peek_()),this._inputFixedName=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.Monospace),RS.Monospace),this._inputFixedStyle=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.Style),RS.Style),this._fixedSample=this._fontsample(n),[this._inputDialogBGColor,this._dialogBGColorSample]=this._createColorInput(n,RS.ColorDialogBG),[this._inputHeadingColor,this._headingColorSample]=this._createColorInput(n,RS.ColorHeading),[this._inputLinkColor,this._linkColorSample]=this._createColorInput(n,RS.ColorLink),[this._inputAnnotationColor,this._annotationColorSample]=this._createColorInput(n,RS.ColorAnnotation),[this._inputHighlightColor,this._highlightColorSample]=this._createColorInput(n,RS.HighlightColor),this._inputDateFormat=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.DateFormat),RS.DateFormat),this._inputTimeFormat=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.TimeFormat),RS.TimeFormat),this._inputImportImageDimension=DialogUt.textSelect_(accessories$,n.peek_(),MSG.string_(RS.ImageDimension),RS.ImageDimension),n.pop_(),this._inputImportImageDimension.setOptions_(["256","512","1024","1536","2048","2560","3072","3584","4096","4608","5120"]),this._inputButtonSize.setOptions_(An.createStringList1_([[16,32,1],[32,64,2],[64,129,4]])),this._inputFontCategory.setOptions_(e.fontCategories_()),this._inputFontSize.setOptions_(An.createStringList1_([[DEF.minFontSize,DEF.maxFontSize+1,1]]));{const t=[];let n=0;const s=i.fixedFontName$;for(const i of e.fontFamilies_()){const e=i.category_();if(null!=e&&FontCategories.Monospace==e){const e=i.fontname_();e==s&&(n=t.length),t.push(e)}}this._inputFixedName.setOptions_(t,null,n)}this._inputDateFormat.setOptions_(DateFormat.SETTINGS_LIST),this._inputTimeFormat.setOptions_(TimeFormat.SETTINGS_LIST),this._reset(i),this._inputButtonSize.onChange_(t=>{const e=An.parseInt_(t,i.buttonSize$);this._buttonsample(this._toolbarSample,e)}),this._inputFontCategory.onChange_(t=>{const i=this._inputFontName.getValue_("");DialogUt.populateFontName_(this._inputFontName,[],e.fontFamilies_(),t,i)}),this._inputFontName.onChange_(t=>{const i=this._inputFontStyle.getValue_(""),n=DialogUt.populateFontStyle_(this._inputFontStyle,[],e.fontInfo_(t),i);this._fontSample.style.fontFamily=FontUtil.fontFamilyOf_(t,n)}),this._inputFontStyle.onChange_(t=>{const e=this._inputFontName.getValue_("");this._fontSample.style.fontFamily=FontUtil.fontFamilyOf_(e,t)}),this._inputFontSize.onChange_(t=>{const e=`${An.parseInt_(t,i.uiFontSize$)}px`;this._fontSample.style.fontSize=e,this._fixedSample.style.fontSize=e});const o=sarray_(),l=sarray_();for(const t of settings$.fontFamilies_()){if(t.category_()==FontCategories.System)continue;const e=t.fontname_(),i=t.category_()==FontCategories.Monospace,n=t.styles_();for(const t of n){const n=FontUtil.fontFamilyOf_(e,t);o.push(n),i&&l.push(n)}}An.onClick_(this._fontSample,t=>{An.stopevent_(t);const i=new PromptFont(accessories$,cache$.ui$.buttonSize_(),cache$.ui$.dpi_(),this._fontSample.style.fontFamily,o,PATH._assetsFontsPng);i.zindex_(DEF.zindexPrompt),i.onOK_(t=>{const i=FontUtil.splitNameStyle_(t);i[0]==this._inputFontName.getValue_("")&&i[1]==this._inputFontStyle.getValue_("")||(this._inputFontName.setValue_(i[0]),DialogUt.populateFontStyle_(this._inputFontStyle,[],e.fontInfo_(i[0]),i[1]),this._fontSample.style.fontFamily=t)}),i.show_()}),this._inputFixedName.onChange_(t=>{const i=this._inputFixedStyle.getValue_(""),n=DialogUt.populateFontStyle_(this._inputFixedStyle,[],e.fontInfo_(t),i);this._fixedSample.style.fontFamily=FontUtil.fontFamilyOf_(t,n)}),this._inputFixedStyle.onChange_(t=>{const e=this._inputFixedName.getValue_("");this._fixedSample.style.fontFamily=FontUtil.fontFamilyOf_(e,t)}),An.onClick_(this._fixedSample,t=>{An.stopevent_(t);const i=new PromptFont(accessories$,cache$.ui$.buttonSize_(),cache$.ui$.dpi_(),this._fixedSample.style.fontFamily,l,PATH._assetsMonoPng);i.zindex_(DEF.zindexPrompt),i.onOK_(t=>{const i=FontUtil.splitNameStyle_(t);i[0]==this._inputFixedName.getValue_("")&&i[1]==this._inputFixedStyle.getValue_("")||(this._inputFixedName.setValue_(i[0]),DialogUt.populateFontStyle_(this._inputFixedStyle,[],e.fontInfo_(i[0]),i[1]),this._fixedSample.style.fontFamily=t)}),i.show_()});for(const[t,e]of[[this._inputDialogBGColor,this._dialogBGColorSample],[this._inputHeadingColor,this._headingColorSample],[this._inputLinkColor,this._linkColorSample],[this._inputAnnotationColor,this._annotationColorSample],[this._inputHighlightColor,this._highlightColorSample]])An.onClick_(t,i=>{An.stopevent_(i),this._promptcolor(t,e)}),An.onClick_(e,i=>{An.stopevent_(i),this._promptcolor(t,e)});const a=cache$.ui$.iwinPadding_();this._content.style.paddingBottom=`${a}px`,new DomBuilderEx(this._content).empty_().appendNodes_(s),An.stopAllInputEnterKey_(s),t.debug_("# UiSettingsPanel.create(): end")}_createColorInput(t,e){return t.peek_().textContainer_(DEF.BASIS_40,MSG.string_(e)),[t.push_().div_(_UISettingsPanel._readonlyInputAttributes).cursor_(),t.pop_().div1_(CSS.AnColorCell).cursor_()]}_fontsample(t){const e=t.peek_().div1_(CSS.AnMarginV5).div1_(CSS.AnSettingsSample).push_().cursor_();return t.peek_().span_().text_("ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz 0123456789"),t.pop_(),e}_promptcolor(t,e){var i;const n=Callbacks.promptColor_(cache$.ui$.buttonSize_(),DEF.zindexPrompt,null!==(i=t.textContent)&&void 0!==i?i:"",ColorValue.X_BLACK);n.onOK_((i,n)=>{null!=i&&(t.textContent=ColorUtil.formatString_(n,i),e.style.backgroundColor=ColorUtil.formatCSSString_(n,i))}),n.show_()}_toolbarActions(t){switch(toasters$.hideAll_(),t){case BUT.ResetUISettings:this._reset(settings$.defaults_());break;case BUT.Cancel:this._reset(settings$.current_()),sidePanel$.hideSidepanel_();break;case BUT.Apply:const e=this._saveState(settings$.current_());_Util.onSaveOrDiscard_(()=>{this._apply(e)});break;default:throw Assert.notReach_(t)}}_apply(t){this._updateState(settings$.current_(),t),host$.updateUISettings_(settings$.current_(),t=>{toasters$.warn_(t),native$.reloadHome_()})}_getcsscolor(t,e){var i;const n=ColorUtil.validateCSSColor_(null!==(i=t.textContent)&&void 0!==i?i:"");return An.isempty_(n)?e.style.backgroundColor:n}_saveState(t){return map_([SettingsKey.buttonSize,An.parseInt_(this._inputButtonSize.getValue_(""),t.buttonSize$)],[SettingsKey.uiFontName,this._inputFontName.getValue_("")],[SettingsKey.uiFontStyle,this._inputFontStyle.getValue_("")],[SettingsKey.uiFontSize,An.parseInt_(this._inputFontSize.getValue_(""),t.uiFontSize$)],[SettingsKey.fixedFontName,this._inputFixedName.getValue_("")],[SettingsKey.fixedFontStyle,this._inputFixedStyle.getValue_("")],[SettingsKey.dialogBGColor,this._getcsscolor(this._inputDialogBGColor,this._dialogBGColorSample)],[SettingsKey.headingColor,this._getcsscolor(this._inputHeadingColor,this._headingColorSample)],[SettingsKey.linkColor,this._getcsscolor(this._inputLinkColor,this._linkColorSample)],[SettingsKey.annotationColor,this._getcsscolor(this._inputAnnotationColor,this._annotationColorSample)],[SettingsKey.highlightColor,this._getcsscolor(this._inputHighlightColor,this._highlightColorSample)],[SettingsKey.dateFormat,this._inputDateFormat.getValue_("")],[SettingsKey.timeFormat,this._inputTimeFormat.getValue_("")],[SettingsKey.imageDimension,An.parseInt_(this._inputImportImageDimension.getValue_(""),t.imageDimension$)])}_updateState(t,e){for(const[i,n]of e.entries())t.set_(i,n)}}_UISettingsPanel._readonlyInputAttributes=smap_(["class",CSS.AnPromptSelect],["style","flex-basis:100%;white-space:nowrap"]);class _TemplatesPanel extends TabPanel{constructor(t){super(t),this._shown=!1,this._container=t;const e=this.addTab(RS.Tooltips_PageTemplates,`${CSS.Fa} ${CSS.FaMagic}`,t=>new _HtmlTemplatesPanel(t));this.addTab(RS.Tooltips_GlobalSearchPanel,`${CSS.Fa} ${CSS.FaSearch}`,t=>new _GlobalSearchPanel(t)),this.addTab(RS.Tooltips_GlobalSettingsPanel,`${CSS.Fa} ${CSS.FaGear}`,t=>new _UISettingsPanel(t)),this.onTooltips(toasters$.onTooltipsKey_),this.activeTab(e)}element_(){return this._container}destroy(){new DomBuilderEx(this._container).empty_()}show_(){var t;this._shown||(this._shown=!0,An.showHidden_(this._container),this.resizeContent_(window.innerHeight),null===(t=this.activePanel())||void 0===t||t.show_(),An.setVisible_(this._container))}hide_(){var t;this._shown&&(this._shown=!1,An.hide_(this._container),null===(t=this.activePanel())||void 0===t||t.hide_())}resizeContent_(t){super.resizeContent1(t,cache$.ui$.toolbarHeight_())}showContextmenu_(){}hideContextmenu_(){const t=this.activePanel();null!=t&&t.hideContextmenu_()}onWindowSizeChanged_(){super.onWindowSizeChanged()}}class _AnnotationOptions{constructor(t,e,i,n,s){this.style=t,this.withBorder=e,this.withCorners=i,this.withShadow=n,this.bgColor=s}}class _PromptAnnotationStyle extends FixedSizeDialogBase{constructor(t,e){super(t,e),this._xxx=MSG.XXX$,this._okCallback=null,this._width=4*this._buttonSize,this.init_(this.create_(t))}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),BUT.infosCancel,t=>this._toolbarActions(t))}_createContent(t){const e=`width: ${this._width}px`,i=CSSUtil.joinStyles1_(Object.entries({border:DEF.themeBorder,padding:"1.5ex 1em",width:"100%",height:`${5*this._width/16}px`,margin:"5px","box-sizing":"border-box",overflow:"hidden"})),n=new DomBuilderEx(t),s=n.div_({style:`${e}; padding-top: 5px; border-top: ${DEF.themeBorder}; `}).push_().cursor_();n.div_({style:`${e}; box-sizing: border-box; margin: 10px 0; overflow: hidden; `+"display:flex;justify-content:center;"});const o=DialogUt.createBorderButton_(n.push_(),this._buttonSize,!0),l=DialogUt.createRoundCornersButton_(n.peek_(),this._buttonSize,!0),a=DialogUt.createBoxShadowButton_(n.peek_(),this._buttonSize,!1),r=DialogUt.createColorButton_(n.pop_(),this._buttonSize,"");n.pop_().div_({style:`${e}; font-size: 0.7rem; `+"box-sizing:border-box;padding:5px;display:flex;flex-flow:row wrap;justify-content:center;align-items:center;"}).indent_(n.push_().div_(["class",`${CSS.AnLink} ${CSS.AnRoundCorners} ${CSS.AnAnnotationStyleText}`],["style",i],[ATTR.xTooltips,RS.widgetAnnotationStyleBasic]),_PromptAnnotationStyle._basicStyle(n,this._xxx),n.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnRoundCorners} ${CSS.AnAnnotationStyleText}`],["style",i],[ATTR.xTooltips,RS.widgetAnnotationStyleList]),_PromptAnnotationStyle._listStyle(n,this._xxx),n.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnRoundCorners} ${CSS.AnAnnotationStyleImage}`],["style",i],[ATTR.xTooltips,RS.widgetAnnotationStyleImage]),_PromptAnnotationStyle._imageStyle(n,this._width/8)),An.onToggleToggle_(o,t=>{for(const e of Array.from(DomUt.queryAll_(s,`div.${CSS.AnLink}`)))e.style.border=t?DEF.themeBorder:""}),An.onToggleToggle_(l,t=>{for(const e of Array.from(DomUt.queryAll_(s,`div.${CSS.AnLink}`)))t?e.classList.add(CSS.AnRoundCorners):e.classList.remove(CSS.AnRoundCorners)}),An.onToggleToggle_(a,t=>{for(const e of Array.from(DomUt.queryAll_(s,`div.${CSS.AnLink}`)))t?e.classList.add(CSS.AnBoxShadow):e.classList.remove(CSS.AnBoxShadow)}),An.onClick_(r,()=>{const t=Callbacks.promptColor_(this._buttonSize,An.above_(this.dialog_()),r.style.backgroundColor,ColorValue.X_WHITE);t.onOK_((t,e)=>{const i=ColorUtil.formatCSSString_(e,t);r.style.backgroundColor=i;for(const t of Array.from(DomUt.queryAll_(s,`div.${CSS.AnLink}`)))t.style.backgroundColor=i}),t.show_()}),An.addClickListenerMatching_(s,`div.${CSS.AnLink}`,(t,e)=>{An.stopevent_(e);const i=t.getAttribute(ATTR.xTooltips),n=l.classList.contains(CSS.AnButtonDown),s=l.classList.contains(CSS.AnButtonDown),o=a.classList.contains(CSS.AnButtonDown),_=r.style.backgroundColor,c=this._okCallback;this.close_(),c(new _AnnotationOptions(i,n,s,o,_))}),An.addContextmenuListenerMatching_(s,`div.${CSS.AnLink}`,toasters$.onTooltipsKey_)}close_(){this._okCallback=null,super.close_()}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}static _basicStyle(t,e){t.text_(e)}static _listStyle(t,e){t.ul1_(CSS.xNone).li1_(CSS.xList),t.push_().span_({class:CSS.xBullet,style:`font-family: ${DEF.FontAwesome}; width: 1.5em; margin-right: 0.5em; text-align: center; `}).text_(" "),t.pop_().span1_(CSS.xListContent).text_(e)}static _imageStyle(t,e){const i=t.cursor_();i.classList.add(CSS.Fa,CSS.FaImage),i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.fontSize=`${e}px`}static _photoStyle(t,e){const i=t.cursor_();i.classList.add(CSS.Fa,CSS.FaCamera),i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.fontSize=`${e}px`}_toolbarActions(t){switch(t){case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}}class _FlexboxOptions{constructor(t,e,i){this.style=t,this.vertical=e,this.gutter=i}hasGutter(){return null!=this.gutter&&0!=this.gutter[0]}gutterString(){return null==this.gutter?"0":`${this.gutter[0]} ${this.gutter[1]}`}}class _PromptFlexboxStyle extends FixedSizeDialogBase{constructor(t,e){super(t,e),this._xxx=MSG.XXX$,this._vertical=!1,this._gutter=[.5,"em"],this._okCallback=null,this._width=4*this._buttonSize,this.init_(this.create_(t))}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),BUT.infosCancel,t=>this._toolbarActions(t))}_createContent(t){const e=`width: ${this._width}px`,i=new DomBuilderEx(t),n=i.div_({style:`${e}; padding-top: 5px; border-top: ${DEF.themeBorder}; `}).push_().cursor_();i.div_({style:`${e}; box-sizing: border-box; margin: 10px 0; overflow: hidden; `+"display:flex;justify-content:center;"});const s=DialogUt.createOrientationButton_(i,this._buttonSize,this._vertical),o=DialogUt.createGutterButton_(i,this._buttonSize,this._vertical),l=i.pop_().div_({style:`${e}; font-size: 0.7rem; `+"box-sizing:border-box;display:flex;flex-flow:column wrap;justify-content:flex-start;align-items:stretch;"}).cursor_();this._basicStyle(i),this._imageStyle(i),s.addEventListener("click",()=>{this._vertical=!this._vertical,this._refresh(s,o,l)}),o.addEventListener("click",()=>{const t=new PromptDoubleUnit(accessories$,RS.Gutter,this._gutter);t.above_(this.dialog_()),t.onOK_((t,e,i)=>{const n=An.doubleSizeUnit_(e);if(null==n)return t.warn_(MSG.format2_(RS.invalidNameValue,MSG.string_(RS.Gutter),e)),void i(!1);i(!0),this._gutter=n,this._refresh(s,o,l)}),t.show_()}),An.addClickListenerMatching_(n,`div.${CSS.AnLink}`,(t,e)=>{An.stopevent_(e);const i=t.getAttribute(ATTR.xTooltips),n=this._okCallback;this.close_(),n(new _FlexboxOptions(i,this._vertical,this._gutter))}),An.addContextmenuListenerMatching_(n,`div.${CSS.AnLink}`,toasters$.onTooltipsKey_)}close_(){this._okCallback=null,super.close_()}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}_refresh(t,e,i){DialogUt.updateOrientationButton_(new DomBuilderEx(t).empty_(),this._vertical),DialogUt.updateGutterButton_(new DomBuilderEx(e).empty_(),this._vertical);const n=new DomBuilderEx(i).empty_();this._basicStyle(n),this._imageStyle(n)}_basicStyle(t){const e=this._gutter[0]+this._gutter[1];t.push_().div_(["class",`${CSS.AnLink}`],["style","display:flex;"+`flex-flow: ${this._vertical?"column nowrap":"row nowrap"}; `+(this._vertical?`flex:1 1 100%;height:${3*this._buttonSize}px;`:`height:${2*this._buttonSize}px;`)+"background-color:#eee;margin:5px 0;border:1px solid rgba(0,0,0,0.5);box-sizing:border-box"],[ATTR.xTooltips,RS.widgetFlexboxStyleBasic]).indent_(t.push_().div_(["style","flex: 1 1 100%;padding:5px;"]).text_(this._xxx),t.peek_().div_(["class",CSS.xGutter],["style",`flex: 0 0 ${e}; ${this._vertical?"max-height":"max-width"}: ${this._buttonSize}px; `+"background-color:rgba(0, 0, 0, 0.1);"]),t.pop_().div_({style:"flex: 1 1 100%;padding:5px;"}).text_(this._xxx)).pop_()}_imageStyle(t){const e=this._gutter[0]+this._gutter[1];t.push_().div_(["class",`${CSS.AnLink}`],["style",`display: flex; flex-flow: ${this._vertical?"column nowrap":"row nowrap"}; `+"background-color:#eee;"+`${this._vertical?"flex:1 1 100%;height:${this._buttonSize * 3};":"height:${this._buttonSize * 2}px;"}`+"border:1px solid rgba(0,0,0,0.5);margin:5px 0;box-sizing:border-box"],[ATTR.xTooltips,RS.widgetFlexboxStyleImage]).indent_(t.push_().div_({style:"flex: 0 0 0%;"}).img_(this._vertical?PATH._assetsImagesLandscapeSample:PATH._assetsImagesPortraitSample,{style:this._vertical?"display:block;width:100%;":`display: block; height: ${2*this._buttonSize-2}px; `}),t.peek_().div_({class:CSS.xGutter,style:`flex: 0 0 ${e}; ${this._vertical?"max-height":"max-width"}: ${this._buttonSize}px; `+"background-color:rgba(0, 0, 0, 0.1);"}),t.pop_().div_({style:"flex:1 1 100%;padding:5px;"}).text_(this._xxx)).pop_()}_toolbarActions(t){switch(t){case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}}class _StickerOptions{constructor(t,e,i,n,s,o){this.style=t,this.withBorder=e,this.withCorners=i,this.withShadow=n,this.withHeader=s,this.bgcolor=o}}class _PromptStickerStyle extends FixedSizeDialogBase{constructor(t,e){super(t,e),this._msgSubject=MSG.string_(RS.Subject),this._msgXXX=MSG.XXX$,this._okCallback=null,this._width=6*this._buttonSize,this.init_(this.create_(t))}create_(t){return this._createDialogWithoutMessageStatus(t,t=>this._createContent(t),BUT.infosCancel,t=>this._toolbarActions(t))}_createContent(t){const e=`width: ${this._width}px`,i=new DomBuilderEx(t),n=i.div_({style:`${e}; padding-top: 5px; border-top: ${DEF.themeBorder}; `}).push_().cursor_();i.div_({style:`${e}; box-sizing: border-box; margin: 10px 0; overflow: hidden; `+"display:flex;justify-content:center;"}).cursor_();const s=DialogUt.createBorderButton_(i,this._buttonSize,!0),o=DialogUt.createRoundCornersButton_(i,this._buttonSize,!0),l=DialogUt.createBoxShadowButton_(i,this._buttonSize,!1),a=DialogUt.createHeaderButton_(i,this._buttonSize,!1),r=DialogUt.createColorButton_(i,this._buttonSize,_WidgetTemplates._colorYellow),_=CSSUtil.joinStyles1_(Object.entries({border:DEF.themeBorder,padding:"1.5ex 1em","background-color":_WidgetTemplates._colorYellow,width:"calc(50% - 10px)",height:`${3*this._buttonSize-15}px`,margin:"5px","box-sizing":"border-box",overflow:"hidden"}));i.pop_().div_({style:`${e}; font-size: 0.7rem; `+"box-sizing:border-box;padding:5px;display:flex;flex-flow:row wrap;justify-content:center;align-items:center;"}).push_(),this._basicStyle(i,_),this._badgeStyle(i,this._buttonSize),this._imageStyle(i,_),this._canvasStyle(i,_),An.onToggleToggle_(s,t=>{for(const e of Array.from(DomUt.queryAll_(n,`div.${CSS.AnLink}`)))e.style.border=t?DEF.themeBorder:""}),An.onToggleToggle_(o,()=>{for(const t of Array.from(n.querySelectorAll(`div.${CSS.AnLink}`)))t.classList.toggle(CSS.AnRoundCorners)}),An.onToggleToggle_(l,()=>{for(const t of Array.from(n.querySelectorAll(`div.${CSS.AnLink}`)))t.classList.toggle(CSS.AnBoxShadow)}),An.onToggleToggle_(a,t=>{for(const e of Array.from(DomUt.queryAll_(n,`div.${CSS.AnLink}`))){const i=DomUt.query_(e,`div.${CSS.AnMarker}`);null!=i&&(i.style.display=t?"block":"none");const n=DomUt.query_(e,`span.${CSS.AnMarker}`);null!=n&&(t?(n.classList.remove(CSS.FaEyeSlash),n.style.display="none"):(n.classList.add(CSS.FaEyeSlash),n.style.display="inline-block"))}}),An.onClick_(r,()=>{const t=Callbacks.promptColor_(this._buttonSize,An.above_(this.dialog_()),r.style.backgroundColor,ColorValue.X_WHITE);t.onOK_((t,e)=>{const i=ColorUtil.formatCSSString_(e,t);r.style.backgroundColor=i;for(const t of Array.from(DomUt.queryAll_(n,`div.${CSS.AnLink}`)))t.style.backgroundColor=i}),t.show_()}),An.addClickListenerMatching_(n,`div.${CSS.AnLink}`,(t,e)=>{An.stopevent_(e);const i=new _StickerOptions(t.getAttribute(ATTR.xTooltips),s.classList.contains(CSS.AnButtonDown),o.classList.contains(CSS.AnButtonDown),l.classList.contains(CSS.AnButtonDown),a.classList.contains(CSS.AnButtonDown),r.style.backgroundColor),n=this._okCallback;this.close_(),n(i)}),An.addContextmenuListenerMatching_(n,`div.${CSS.AnLink}`,toasters$.onTooltipsKey_)}close_(){this._okCallback=null,super.close_()}getContentWidth_(){return this._width}onOK_(t){return this._okCallback=t,this}_basicStyle(t,e){t.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnRoundCorners}`],[ATTR.xTooltips,RS.widgetStickerStyleBasic],["style",e]).div_().push_().span_({class:`${CSS.xFloatRightClearNone} ${CSS.Fa} ${CSS.FaEyeSlash}`,style:"margin-bottom:0.5ex;"}).peek_().div_({class:CSS.AnMarker,style:"display:none;font-weight:bold;"+`border-bottom: ${DEF.themeBorder}; `+"padding-bottom:0.75ex;margin-bottom:1ex;"}).text_(this._msgSubject).peek_().div_().text_(this._msgXXX).pop_()}_badgeStyle(t,e){t.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnRoundCorners}`],[ATTR.xTooltips,RS.widgetStickerStyleBadge],["style",`border: ${DEF.themeBorder}; `+`background-color: ${_WidgetTemplates._colorYellow}; `+"box-sizing:border-box;width:calc(50% - 10px);"+`height: ${3*e-10}px; `+"padding:1.5ex 1em;margin:5px;overflow:hidden;display:flex;align-items:center;justify-content:center;border-radius:50%;"]).div_().push_().div_({class:CSS.AnMarker,style:"display:none;font-weight:bold;text-align:center;"+`border-bottom: ${DEF.themeBorder}; `+"padding-bottom:0.75ex;margin-bottom:1ex;"}).text_(this._msgSubject).span_({class:`${CSS.xFloatRightClearNone} ${CSS.Fa} ${CSS.FaEyeSlash}`,style:"margin-bottom:0.5ex;"}).pop_().div_({style:"text-align:center"}).text_(this._msgXXX).span_({class:`${CSS.xFloatRightClearNone} ${CSS.Fa} ${CSS.FaEyeSlash} ${CSS.AnMarker}`,style:"margin-bottom:0.5ex;"})}_imageStyle(t,e){t.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnRoundCorners}`],[ATTR.xTooltips,RS.widgetStickerStyleImage],["style",`${e} display: flex; flex-flow: column; `]).div_().push_().span_({class:`${CSS.xFloatRightClearNone} ${CSS.Fa} ${CSS.FaEyeSlash}`,style:"margin-bottom:0.5ex;"}).peek_().div_({class:CSS.AnMarker,style:"display:none;font-weight:bold;"+`border-bottom: ${DEF.themeBorder}; `+"padding-bottom:0.75ex;margin-bottom:1ex;"}).text_(this._msgSubject).pop_().up_().div_({style:"overflow:hidden;flex:1 1 auto;"+`background-image: url('${PATH._assetsImagesSamplesLamp}'); `+"background-size:cover;overflow:hidden;"})}_canvasStyle(t,e){t.peek_().div_(["class",`${CSS.AnLink} ${CSS.AnRoundCorners}`],[ATTR.xTooltips,RS.widgetStickerStyleCanvas],["style",`${e} display: flex; flex-flow: column; `]).div_().push_().span_({class:`${CSS.xFloatRightClearNone} ${CSS.Fa} ${CSS.FaEyeSlash}`,style:"margin-bottom:0.5ex;"}).peek_().div_({class:CSS.AnMarker,style:"display:none;font-weight:bold;"+`border-bottom: ${DEF.themeBorder}; `+"padding-bottom:0.75ex;margin-bottom:1ex;"}).text_(this._msgSubject).pop_().up_().div_({style:`background-image: url('${PATH._assetsImagesSig01Png}'); `+"background-size:contain;background-position:center;background-repeat:no-repeat;flex:1 1 auto;overflow:hidden;"})}_toolbarActions(t){switch(t){case BUT.Cancel:this.actionCancel_();break;default:this.actionInvalid_(t)}}}class _FlexboxWidget{static _flexbox(t){const e=native$.getIFrameDocument_();if(null!=e)if(t.collapsed){const i=new _PromptFlexboxStyle(accessories$,cache$.ui$.buttonSize_());i.titleKey_(RS.PickStyle),i.zindex_(DEF.zindexPrompt),i.onOK_(i=>{_FlexboxWidget._flexbox0(e,t,i)}),i.show_()}else _FlexboxWidget._flexbox1(e,t)}static _flexbox0(t,e,i){_FlexboxWidget._flexbox3(t,i.vertical,t=>{const n=i.style==RS.widgetFlexboxStyleBasic;t.push_(),i.vertical?(n?t.peek_().div_({style:"flex: 1 1 100%;"}).text_(MSG.XXX$):t.div_({style:"flex: 0 0 auto"}).ahref_(PATH._assetsImagesPortraitSample+`? ${Param.view}`).img_(PATH._assetsImagesLandscapeSample,{class:CSS.xImageholder,style:"display:block;width:100%;"}),_FlexboxWidget._flexboxSecondBox(t,i)):(n?t.peek_().div_({style:"flex: 1 1 100%;"}).text_(MSG.XXX$):t.div_({style:"flex: 0 0 auto;max-width:50%"}).ahref_(PATH._assetsImagesPortraitSample+`? ${Param.view}`).img_(PATH._assetsImagesPortraitSample,{class:CSS.xImageholder,style:"display:block;width:100%;"}),_FlexboxWidget._flexboxSecondBox(t,i)),RangeUtil.insertNode_(e,t.pop_().cursor_())})}static _flexbox1(t,e){_FlexboxWidget._flexbox2(t,(t,i)=>{const n=RangeUtil.extractContents_(e),s=n.childElementCount,o=i.hasGutter();let l,a=n.firstChild,r=n.firstElementChild;t.push_(),0==s&&t.peek_().div_({style:"flex: 1 1 100%"});for(let e=0;e<s;++e){o&&e>0&&t.peek_().div_({class:CSS.xGutter,style:`flex: 0 0 ${i.gutterString()}`}),t.peek_().div_({style:"flex: 1 1 100%"});for(let e=null;null!=a&&a!=r;a=e)e=a.nextSibling,t.appendNodes_(a);a=r.nextSibling;const n=r;r=r.nextElementSibling,t.appendNodes_(n)}for(;null!=a;a=l)l=a.nextSibling,t.appendNodes_(a);s<=1&&_FlexboxWidget._flexboxSecondBox(t,i),RangeUtil.insertNode_(e,t.pop_().cursor_())})}static _flexboxSecondBox(t,e){e.hasGutter()&&t.peek_().div_({class:CSS.xGutter,style:`flex: 0 0 ${e.gutterString()}`}),t.peek_().div_({style:"flex:1 1 100%;"}).text_(MSG.XXX$)}static _flexbox2(t,e){const i=new CompositeDialog(accessories$,[new SelectFIeld(RS.Direction,_FlexboxWidget.XDIRECTION,MSG.string_(RS.Horizontal),RS.Direction,[MSG.string_(RS.Horizontal),MSG.string_(RS.Vertical)]),new InputSelectField(RS.Gutter,_FlexboxWidget.XGUTTER,"0.5",RS.Gutter,CSSLength.EM,CSSLengths)]);i.titleKey_(RS.widgetFlexboxTitle),i.messageKey_(RS.widgetFlexboxMessage),i.zindex_(DEF.zindexPrompt),i.onOK_((i,n)=>{const s=sarray_(),o=i.getValue_(_FlexboxWidget.XGUTTER);if(CSSUtil.validateOptionalCSSLength_(o)||s.push(MSG.format2_(RS.invalidNameValue,MSG.string_(RS.Gutter),o)),s.length>0)return i.warn_(s),void n(!1);const l=i.getValue_(_FlexboxWidget.XDIRECTION)==MSG.string_(RS.Vertical);n(!0);const a=An.doubleSizeUnit_(o);_FlexboxWidget._flexbox3(t,l,t=>{e(t,new _FlexboxOptions(null,l,a))})}),i.show_()}static _flexbox3(t,e,i){const n=`box-sizing: border-box; width: 100 %; ${e?"flex-direction:column;":""}; align-items: stretch; `;history$.group_(RS.widgetFlexboxTitle,"",()=>{const e=DomBuilderEx.offline_(t,"div",{class:CSS.xFlexbox,style:n});i(e)})}static _destructFlexbox(t){_Util.confirmSmall_(MSG.format1_(RS.destructWidget,MSG.string_(RS.widgetFlexboxTitle)),DEF.zindexConfirm,e=>{e&&history$.group_(RS.action_DestructFlexbox,"",()=>{const e=new DomBuilderEx(t);for(let i=t.firstChild,n=null;null!=i;i=n)n=i.nextSibling,i.nodeType==Node.ELEMENT_NODE&&(native$.hasClass_(i,CSS.xGutter)?t.removeChild(i):"DIV"==i.nodeName&&e.unwrap_(i));e.up_().unwrap_(t)})})}}_FlexboxWidget.XDIRECTION="#X15",_FlexboxWidget.XGUTTER="#XVi";class _ShoppingWidget{static create_(t,e,i=null){_WidgetTemplates.promptStyle_(accessories$,n=>{const s=DateTime.now_(),o=DomBuilderEx.offline1_(t,"div",CSS.xWidgetShopping,n),l=o.push_().table1_(CSS.xWidgetShopping).tbody_().indent_(o.push_().tr1_(CSS.xWidgetShoppingHeader).indent_(o.push_().th_(["class",CSS.xWidgetShoppingDesc],["colspan","2"]).text_(MSG.string_(RS.Description)),o.peek_().th1_(CSS.xWidgetShoppingQuantity).text_("#"),o.pop_().th1_(CSS.xWidgetShoppingPrice).text_("$")),o.peek_().tr1_(CSS.xWidgetShopping,CSS.xTodoItem).indent_(o.push_().td1_(CSS.xTodoStatus),o.peek_().td1_(CSS.xWidgetShoppingDesc).indent_(o.push_().code_(["class",CSS.xDate],["style","color:inherit;"],[ATTR.xFormat,`${settings$.shortDateFormat_()};;${s.millisecondsSinceEpoch$}`]).text_(settings$.shortDateString_(s)),o.pop_().text_("").span1_(CSS.xPlaceholder).text_(MSG.XXX$)),o.peek_().td1_(CSS.xCalcQuantity).text_("1"),o.pop_().td1_(CSS.xCalcPrice).text_("0.00")),o.peek_().tr1_(CSS.xWidgetShopping,CSS.xTodoItem).indent_(o.push_().td1_(CSS.xTodoStatus),o.peek_().td1_(CSS.xWidgetShoppingDesc).indent_(o.push_().code_(["class",CSS.xDate],[ATTR.xFormat,`${settings$.shortDateFormat_()};;${s.millisecondsSinceEpoch$}`]).text_(settings$.shortDateString_(s)),o.pop_().text_("").span1_(CSS.xPlaceholder).text_(MSG.XXX$)),o.peek_().td1_(CSS.xCalcQuantity).text_("1"),o.pop_().td1_(CSS.xCalcPrice).text_("0.00")),o.pop_().tr1_(CSS.xWidgetShoppingTotal).td_(["class",CSS.xCalcTotal],["colspan","4"]).text_("0.00")).pop_().cursor_();history$.group_(RS.widgetShoppingTitle,RS.widgetShoppingDesc,()=>{e.collapse(!0),RangeUtil.replaceRange_(e,l)}),null==i||i(l)})}}class _TocWidget{static create_(t,e,i=null){_WidgetTemplates.promptStyle_(accessories$,n=>{const s=DomBuilderEx.offline1_(t,"div",CSS.xWidgetToc,n),o=s.push_().ul1_(CSS.xWidgetToc).indent_(s.push_().li1_(CSS.xWidgetToc1).text_("Subject"),s.peek_().li1_(CSS.xWidgetToc2).indent_(s.push_().span1_(CSS.xWidgetTocBullet),s.pop_().span1_(CSS.xPlaceholder).text_(MSG.XXX$)),s.pop_().li1_(CSS.xWidgetToc4).indent_(s.push_().span1_(CSS.xWidgetTocBullet),s.pop_().span1_(CSS.xPlaceholder).text_(MSG.XXX$))).pop_().cursor_();history$.group_(RS.widgetTocTitle,RS.widgetTocDesc,()=>{e.collapse(!0),RangeUtil.replaceRange_(e,o)}),null==i||i(o)})}}class _TodoWidget{static create_(t,e,i=null){_WidgetTemplates.promptStyle_(accessories$,n=>{const s=DateTime.now_(),o=MSG.XXX$,l=_TodoWidget.createTodo_(t,n,t=>{t.code_(["class",`${CSS.xDate}`],["style","color:inherit;"],[ATTR.xFormat,`${settings$.shortDateFormat_()};;${s.millisecondsSinceEpoch$}`]).text_(settings$.shortDateString_(s))},t=>{t.span1_(CSS.xWidgetTodoSubject,CSS.xPlaceholder).text_(o)},t=>{t.li1_(CSS.xList).indent_(t.push_().span_(["class",CSS.xBullet],["style","font-family: FontAwesome"]).text_(" "),t.pop_().span1_(CSS.xListContent,CSS.xPlaceholder).text_(o))});history$.group_(RS.widgetTodoTitle,RS.widgetTodoDesc,()=>{e.collapse(!0),RangeUtil.replaceRange_(e,l)}),null==i||i(l)})}static createTodo_(t,e,i,n,s){const o=DomBuilderEx.offline1_(t,"div",CSS.xWidgetTodo,e).push_();return o.ul1_(CSS.xWidgetTodo).li1_(CSS.xWidgetTodo,CSS.xTodoItem).indent_(o.push_().div1_(CSS.xTodoStatus),o.pop_().div1_(CSS.xWidgetTodoContent).indent_(o.push_().div1_(CSS.xWidgetTodoSubject).indent_(o.push_(),i(o),o.pop_().text_(""),n(o)),o.pop_().div1_(CSS.xWidgetTodoBody).ul1_(CSS.xNone),s(o))),o.pop_().cursor_()}}class _PromptWidgetStyle extends CompositeDialogBase{constructor(t){super(t,[new SelectFIeld(RS.Style,"",_PromptWidgetStyle.NONE,RS.Style,[_PromptWidgetStyle.NONE,MSG.string_(RS.Theme_Light),MSG.string_(RS.Theme_Dark)])]),this._okCallback=null,this.titleKey_(RS.PickStyle),this.getFieldAt_(0).element_().style.marginTop="10px"}onOK_(t){return this._okCallback=t,this}_onOK(){var t;const e=this.getValueAt_(0),i=e==_PromptWidgetStyle.NONE?"":`${CSS.xStyle}-${e.toLowerCase()}`;super.close_(),null===(t=this._okCallback)||void 0===t||t.call(this,i),this._okCallback=null}}_PromptWidgetStyle.NONE=MSG.string_(RS.None);class _SidePanel{constructor(){var t;this._shownPanel=null,this._sidebarTabs=new Map,this._panels=new Map,this._sidebarTimer=null,this._isShowing=!1,this._isHiding=!1,this._isShown=!1,this._isTransparent=!1,this._sidepanelwidth=DEF.sidepanelWidth,this._iframeSelectionRange=null,this._sidebarTabClickHandlers=[];const e=new StepTimer;this._createSidebar(e),this._createSidepanel(e),document.getElementById(ID.sidebar).replaceWith(this._sidebar),document.getElementById(ID.sidepanel).replaceWith(this._sidepanel),this._lastTabId=ID.sidebarDocument,this._smokescreen=new Smokescreen(accessories$,DEF.zindexSidebar-1),this._constraintSidebarWidth();const i=null!==(t=bootPreferences$[SessionPreferencesKey.sidepanelWidth])&&void 0!==t?t:DEF.sidepanelWidth;this._sidepanelwidth=this._constraintSidepanelWidth(i),this._sidebar.style.transition=`left ${DEFUtil.sidepanelTransition$}ms`,this._sidepanel.style.transition=`left ${DEFUtil.sidepanelTransition$}ms`,An.setWidthLeft_(this._sidepanel,this._sidepanelwidth,-(this._sidepanelwidth+2*_DEF.SidepanelPaddingRight)),this._setupSidebarCollapsedHandlers();const n=this._createResizer();this.sidepanelWidthInit_(),this.resizeContent_(),n.bind_()}_createSidebar(t){t.debug_("# Created sidebar");const e=DomBuilderEx.offline_(document,"div",{id:ID.sidebar}).push_();this._sidebar=e.cursor_(),this._sidebarTabs.set(ID.sidebarTemplates,e.peek_().div_(["id",ID.sidebarTemplates],["class",`${CSS.AnSidebarTab} ${CSS.Fa} ${CSS.FaGlobe}`],[ATTR.xTooltips,RS.Tooltips_SidebarTemplates]).cursor_()),this._sidebarTabs.set(ID.sidebarExplore,e.peek_().div_(["id",ID.sidebarExplore],["class",`${CSS.AnSidebarTab} ${CSS.Fa} ${CSS.FaFolderO}`],[ATTR.xTooltips,RS.Tooltips_SidebarExplore]).cursor_()),this._sidebarTabs.set(ID.sidebarDocument,e.peek_().div_(["id",ID.sidebarDocument],["class",`${CSS.AnSidebarTab} ${CSS.Fa} ${CSS.FaFileTextO}`],[ATTR.xTooltips,RS.Tooltips_SidebarDocument]).cursor_()),this._resizeTab=e.peek_().div_({id:ID.sidebarResize,style:"visibility: hidden;"}).hr_().up_().cursor_(),An.addContextmenuListenerMatching_(this._sidebar,`div[${ATTR.xTooltips}]`,toasters$.onTooltipsKey_),t.debug_("# Created sidebar")}_createSidepanel(t){const e=DomBuilderEx.offline_(document,"div",{id:ID.sidepanel}).push_();this._sidepanel=e.cursor_(),this._panels.set(ID.sidebarTemplates,new _TemplatesPanel(e.peek_().div_({class:`${CSS.AnSidepanel} ${CSS.AnSidepanelTemplates}`,style:"visibility: hidden;"}).cursor_())),t.debug_("# Created templates panel"),this._panels.set(ID.sidebarExplore,new _ExplorePanel(e.peek_().div_({class:`${CSS.AnSidepanel} ${CSS.AnSidepanelExplore}`,style:"visibility: hidden;"}).cursor_())),t.debug_("# Created explore panel"),this._panels.set(ID.sidebarDocument,new _DocumentPanel(e.peek_().div_({class:`${CSS.AnSidepanel} ${CSS.AnSidepanelDocument}`,style:"visibility: hidden;"}).cursor_())),t.debug_("# Created sidepanel")}get sidepanelWidth$(){return this._sidepanelwidth}get sidepanel$(){return this._sidepanel}get sidebar$(){return this._sidebar}get resizebar$(){return this._resizeTab}get activePanel$(){return this._shownPanel}get lastTabId$(){return this._lastTabId}get sidebarTabs$(){return this._sidebarTabs.entries()}getPanel_(t){return this._panels.get(t)}resizeContent_(){const t=window.innerHeight;this._sidepanel.style.height=`${t}px`,null!=this._shownPanel&&this._shownPanel.resizeContent_(t);for(const e of this._panels.values())e!==this._shownPanel&&e.resizeContent_(t)}onIFrameLoad_(){this._isShown&&this._shownPanel instanceof DocumentPanelBase&&this._shownPanel.refresh()}showPanel_(t){const e=this._panels.get(t);void 0!==e&&(null!=this._shownPanel&&this._shownPanel!==e&&this._shownPanel.hide_(),this._shownPanel=e,this._lastTabId=t,e.show_())}toggleShowBackground_(){const t=(this._isTransparent?DEF.opacityOpaque:DEF.opacityShowBackground).toString();sidePanel$.sidebar$.style.opacity=t,sidePanel$.sidepanel$.style.opacity=t,this._isTransparent=!this._isTransparent}sidepanelWidthInit_(){host$.sidepanelChanged_(smapOf_("sidebarHeight",cache$.ui$.sidebarHeight_()))}_setupSidebarCollapsedHandlers(){if(An.cancelSubscriptions_(this._sidebarTabClickHandlers),!Conf.isMobile)for(const t of this._sidebarTabs.values())this._sidebarTabClickHandlers.push(An.subscriptEvent_(t,"click",t=>{An.stopevent_(t),this.showSidepanel_(t.target.id,!1)}))}_setupSidebarExpandedHandlers(){An.cancelSubscriptions_(this._sidebarTabClickHandlers);for(const t of this._sidebarTabs.values())this._sidebarTabClickHandlers.push(An.subscriptEvent_(t,"click",e=>{An.stopevent_(e),this._deselectAllTabs(),this.selectTab_(t),this.showPanel_(t.id)}))}_sidebarAnimate(t){this._sidebarTransform(t)}_sidebarTransform(t){return An.setTransform_(this._sidebar,`translateX(${t}px) rotate(90deg)`)}_sidepanelAnimate(t,e){if(An.documentOffset_(this._sidepanel).x!=t){const i=An.subscriptEvent_(this._sidepanel,"transitionend",()=>{i.cancel_(),e()});this._sidepanel.style.left=`${t}px`}else null!=e&&e()}deselectTab_(t){t.style.marginTop="0px"}selectTab_(t){this._deselectAllTabs(),t.style.marginTop=`${-_DEF.SidebarActive}px`}_deselectAllTabs(){for(const t of this._sidebarTabs.values())this.deselectTab_(t)}onWindowSizeChanged_(){this.hideSidepanel_(),this._constraintSidebarWidth(),this._deselectAllTabs();const t=this._constraintSidepanelWidth(this._sidepanelwidth);t!=this._sidepanelwidth&&(this._sidepanel.style.width=`${t}px`,this._sidepanelwidth=t,An.setWidthLeft_(this._sidepanel,this._sidepanelwidth,-(this._sidepanelwidth+2*_DEF.SidepanelPaddingRight)),this._sidebarTransform(_DEF.SidebarTop));for(const t of this._panels.values())t.onWindowSizeChanged_();this.resizeContent_()}_constraintSidebarWidth(){const t=window.innerHeight,e=t>800?t/2:2*t/3;this._sidebar.style.width=`${e}px`}_constraintSidepanelWidth(t){const e=DEFUtil.sidepanelWidth_(cache$.ui$.buttonSize_()),i=window.innerWidth-2*cache$.ui$.sidebarHeight_();return t<e&&(t=e),t>i&&(t=i),t}resize_(t){t=this._constraintSidepanelWidth(t),this._resize1(t)}_resize1(t){this._sidepanel.style.width=`${t}px`,this._sidepanelwidth=t,this._sidebarTransform(this._sidepanelwidth+cache$.ui$.sidebarHeight_()),this.resizeContent_()}selectSidebarTab_(t){const e=this._sidebarTabs.get(t);null!=e&&(this._deselectAllTabs(),this.selectTab_(e),Timer.sleep1_(()=>{this.showPanel_(t)}))}showSidepanel_(t,e,i=null){this._isShown||this._isShowing||(this._isShowing=!0,this._iframeSelectionRange=native$.getIFrameSelectionRange_(),host$.hideCaret_(t,()=>{null!=this._iframeSelectionRange&&(native$.iSelectRange_(this._iframeSelectionRange),this._iframeSelectionRange=null),this.showSidepanelCallback_(t,()=>{host$.hideKeyboard0_(),null==i||i()})}))}showSidepanelCallback_(t,e=null){if(null==t)return void(null==e||e());const i=this._sidebarTabs.get(t);if(void 0===i)return;An.showVisible_(this._sidepanel),this.selectTab_(i);const n=()=>{this._setupSidebarExpandedHandlers(),this.showPanel_(t),this.selectTab_(i),An.setVisible_(this._resizeTab),this._smokescreen.show_(t=>{this._sidepanel.style.borderRight="1px solid #888";const i=t.element_();_Util.createContentScroller_(i,()=>{native$.focusIFrame_(),this.hideSidepanel_()}),this._isShown=!0,this._isShowing=!1,null==e||e()})},s=this._sidepanelwidth+cache$.ui$.sidebarHeight_();this._sidepanelAnimate(0,()=>{this._sidebarAnimate(s),n()})}showEventsPanel_(t=null){this.showSidepanel_(ID.sidebarExplore,!0,()=>{var e;const i=sidePanel$.activePanel$;null==t||t(null!==(e=null==i?void 0:i.selectTabAt(2))&&void 0!==e?e:null)})}hideSidepanel_(t=null){if(!this._isShown||this._isHiding)return;this._isHiding=!0,null!=this._shownPanel&&this._shownPanel.hideContextmenu_(),toasters$.hideModal_();const e=()=>{null!=this._shownPanel&&(this._shownPanel.hide_(),this._shownPanel=null);const e=DEF.opacityOpaque.toString();this._sidepanel.style.opacity=e,this._sidebar.style.opacity=e,this._isTransparent=!1,this._setupSidebarCollapsedHandlers(),this._isHiding=!1,this._isShown=!1,null==t||t()};this._smokescreen.hide_(),this._deselectAllTabs(),An.setHidden_(this._resizeTab),null!=this._sidebarTimer&&(this._sidebarTimer.cancel_(),this._sidebarTimer=null),this._sidepanel.style.borderRight="",this._deselectAllTabs(),this._sidebarAnimate(_DEF.SidebarTop),this._sidepanelAnimate(-this._sidepanelwidth,()=>{e()})}isShown_(){return this._isShown}_createResizer(){return new Dragger(this._resizeTab,new _SidepanelResizeHandler).rateLimit_(new FrameLimiter(2))}}_SidePanel._handleGesture=(t,e)=>(Timer.sleep1_(()=>{const i=e[GestureKey.y];if(GestureEvent.leftInward==t&&null!=sidePanel$&&!sidePanel$.isShown_()){if(Smokescreen.liveCount()>0)return;let t=null;if(i>cache$.ui$.documentBottom_())return void(mainPanel$.isEditing()?sidePanel$.showSidepanel_(ID.sidebarDocument,!0,()=>{const t=sidePanel$.activePanel$;null!=t&&t.selectTabAt(0)}):sidePanel$.showSidepanel_(ID.sidebarExplore,!0,()=>{const t=sidePanel$.activePanel$;null!=t&&t.selectTabAt(0)}));i>cache$.ui$.exploreBottom_()?t=ID.sidebarDocument:i>cache$.ui$.templatesBottom_()?t=ID.sidebarExplore:i>0&&(t=ID.sidebarTemplates),null!=t&&sidePanel$.showSidepanel_(t,!0)}}),!0);class _SidepanelResizeHandler{constructor(){this._x=0}onDragstart_(t,e,i,n){var s;return this._x=null!==(s=sidePanel$.sidepanelWidth$)&&void 0!==s?s:0,!0}onDragmove_(t){sidePanel$.resize_(this._x+t.state_().cx)}onDragend_(t,e){_SidepanelResizeHandler._sidepanelWidthUpdater.queue_(()=>{host$.updateSessionPreferences_(jsonOf_(SessionPreferencesKey.sidepanelWidth,sidePanel$.sidepanelWidth$),An.noop_)},DateTime.ms_())}}_SidepanelResizeHandler._sidepanelWidthUpdater=new RateLimiter(1e3);const sidePanel$=new _SidePanel;class XX{}XX.xxAudio="xx-audio",XX.xxAudios="xx-audios",XX.xxBackground="xx-background",XX.xxBelow="xx-below",XX.xxAbove="xx-above",XX.xxBlog="xx-blog",XX.xxBlue="xx-blue",XX.xxBody="xx-body",XX.xxBullet="xx-bullet",XX.xxCalendar="xx-calendar",XX.xxCanvas="xx-canvas",XX.xxCaption="xx-caption",XX.xxCaptionContent="xx-caption-content",XX.xxCard="xx-card",XX.xxCards="xx-cards",XX.xxCenter="xx-center",XX.xxColumn="xx-column",XX.xxColumns="xx-columns",XX.xxComment="xx-comment",XX.xxContent="xx-content",XX.xxDate="xx-date",XX.xxDatetime="xx-datetime",XX.xxDesc="xx-desc",XX.xxDetails="xx-details",XX.xxDone="xx-done",XX.xxDrawing="xx-drawing",XX.xxGreen="xx-green",XX.xxHead="xx-head",XX.xxHeader="xx-header",XX.xxHide="xx-hide",XX.xxHigh="xx-high",XX.xxHigher="xx-higher",XX.xxHighest="xx-highest",XX.xxHighlight="xx-highlight",XX.xxItem="xx-item",XX.xxItems="xx-items",XX.xxLeft="xx-left",XX.xxLink="xx-link",XX.xxLow="xx-low",XX.xxMedia="xx-media",XX.xxMedias="xx-medias",XX.xxName="xx-name",XX.xxNote="xx-note",XX.xxPhoto="xx-photo",XX.xxPhotos="xx-photos",XX.xxPrice="xx-price",XX.xxQuantity="xx-quantity",XX.xxRed="xx-red",XX.xxRight="xx-right",XX.xxSection="xx-section",XX.xxSections="xx-sections",XX.xxStatus="xx-status",XX.xxSticker="xx-sticker",XX.xxStyle="xx-style",XX.xxStyle00="xx-style00",XX.xxStyle01="xx-style01",XX.xxStyle02="xx-style02",XX.xxStyle03="xx-style03",XX.xxStyle04="xx-style04",XX.xxStyle05="xx-style05",XX.xxStyle06="xx-style06",XX.xxStyle07="xx-style07",XX.xxStyle08="xx-style08",XX.xxStyle09="xx-style09",XX.xxStyle10="xx-style10",XX.xxStyle11="xx-style11",XX.xxStyle12="xx-style12",XX.xxStyle13="xx-style13",XX.xxStyle14="xx-style14",XX.xxStyle15="xx-style15",XX.xxStyle16="xx-style16",XX.xxStyle17="xx-style17",XX.xxStyle18="xx-style18",XX.xxStyle19="xx-style19",XX.xxStyle20="xx-style20",XX.xxStyle21="xx-style21",XX.xxStyle22="xx-style22",XX.xxStyle23="xx-style23",XX.xxStyle24="xx-style24",XX.xxStyle25="xx-style25",XX.xxStyle26="xx-style26",XX.xxStyle27="xx-style27",XX.xxStyle28="xx-style28",XX.xxStyle29="xx-style29",XX.xxSubject="xx-subject",XX.xxSubheader="xx-subheader",XX.xxSubtitle="xx-subtitle",XX.xxSubtotal="xx-subtotal",XX.xxTime="xx-time",XX.xxTitle="xx-title",XX.xxTocs="xx-tocs",XX.xxToc0="xx-toc0",XX.xxToc1="xx-toc1",XX.xxToc2="xx-toc2",XX.xxToc3="xx-toc3",XX.xxToc4="xx-toc4",XX.xxTodo="xx-todo",XX.xxTodos="xx-todos",XX.xxTop="xx-top",XX.xxTotal="xx-total",XX.xxVerticalToolbar="xx-vertical-toolbar",XX.xxVideo="xx-video",XX.xxWelcome="xx-welcome",XX.xxWhite="xx-white";